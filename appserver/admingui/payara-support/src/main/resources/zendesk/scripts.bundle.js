webpackJsonp([2,5],{

/***/ 1003:
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(524);
__webpack_require__(525);
__webpack_require__(528);
__webpack_require__(527);
module.exports = __webpack_require__(526);


/***/ }),

/***/ 118:
/***/ (function(module, exports) {

/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
module.exports = function(src) {
	if (typeof execScript !== "undefined")
		execScript(src);
	else
		eval.call(null, src);
}


/***/ }),

/***/ 524:
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(118)(__webpack_require__(720))

/***/ }),

/***/ 525:
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(118)(__webpack_require__(721))

/***/ }),

/***/ 526:
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(118)(__webpack_require__(722))

/***/ }),

/***/ 527:
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(118)(__webpack_require__(723))

/***/ }),

/***/ 528:
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(118)(__webpack_require__(724))

/***/ }),

/***/ 720:
/***/ (function(module, exports) {

module.exports = "/*!\n\nJSZipUtils - A collection of cross-browser utilities to go along with JSZip.\n<http://stuk.github.io/jszip-utils>\n\n(c) 2014 Stuart Knightley, David Duponchel\nDual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip-utils/master/LICENSE.markdown.\n\n*/\n!function(a){\"object\"==typeof exports?module.exports=a():\"function\"==typeof define&&define.amd?define(a):\"undefined\"!=typeof window?window.JSZipUtils=a():\"undefined\"!=typeof global?global.JSZipUtils=a():\"undefined\"!=typeof self&&(self.JSZipUtils=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i=\"function\"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error(\"Cannot find module '\"+g+\"'\")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f=\"function\"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){\"use strict\";function c(){try{return new window.XMLHttpRequest}catch(a){}}function d(){try{return new window.ActiveXObject(\"Microsoft.XMLHTTP\")}catch(a){}}var e={};e._getBinaryFromXHR=function(a){return a.response||a.responseText};var f=window.ActiveXObject?function(){return c()||d()}:c;e.getBinaryContent=function(a,b){try{var c=f();c.open(\"GET\",a,!0),\"responseType\"in c&&(c.responseType=\"arraybuffer\"),c.overrideMimeType&&c.overrideMimeType(\"text/plain; charset=x-user-defined\"),c.onreadystatechange=function(){var d,f;if(4===c.readyState)if(200===c.status||0===c.status){d=null,f=null;try{d=e._getBinaryFromXHR(c)}catch(g){f=new Error(g)}b(f,d)}else b(new Error(\"Ajax error for \"+a+\" : \"+this.status+\" \"+this.statusText),null)},c.send()}catch(d){b(new Error(d),null)}},b.exports=e},{}]},{},[1])(1)});"

/***/ }),

/***/ 721:
/***/ (function(module, exports) {

module.exports = "/*!\n\nJSZip v3.1.3 - A Javascript class for generating and reading zip files\n<http://stuartk.com/jszip>\n\n(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>\nDual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.\n\nJSZip uses the library pako released under the MIT license :\nhttps://github.com/nodeca/pako/blob/master/LICENSE\n*/\n!function(a){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=a();else if(\"function\"==typeof define&&define.amd)define([],a);else{var b;b=\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:this,b.JSZip=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i=\"function\"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error(\"Cannot find module '\"+g+\"'\");throw j.code=\"MODULE_NOT_FOUND\",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f=\"function\"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){\"use strict\";var d=a(\"./utils\"),e=a(\"./support\"),f=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";c.encode=function(a){for(var b,c,e,g,h,i,j,k=[],l=0,m=a.length,n=m,o=\"string\"!==d.getTypeOf(a);l<a.length;)n=m-l,o?(b=a[l++],c=l<m?a[l++]:0,e=l<m?a[l++]:0):(b=a.charCodeAt(l++),c=l<m?a.charCodeAt(l++):0,e=l<m?a.charCodeAt(l++):0),g=b>>2,h=(3&b)<<4|c>>4,i=n>1?(15&c)<<2|e>>6:64,j=n>2?63&e:64,k.push(f.charAt(g)+f.charAt(h)+f.charAt(i)+f.charAt(j));return k.join(\"\")},c.decode=function(a){var b,c,d,g,h,i,j,k=0,l=0,m=\"data:\";if(a.substr(0,m.length)===m)throw new Error(\"Invalid base64 input, it looks like a data url.\");a=a.replace(/[^A-Za-z0-9\\+\\/\\=]/g,\"\");var n=3*a.length/4;if(a.charAt(a.length-1)===f.charAt(64)&&n--,a.charAt(a.length-2)===f.charAt(64)&&n--,n%1!==0)throw new Error(\"Invalid base64 input, bad content length.\");var o;for(o=e.uint8array?new Uint8Array(0|n):new Array(0|n);k<a.length;)g=f.indexOf(a.charAt(k++)),h=f.indexOf(a.charAt(k++)),i=f.indexOf(a.charAt(k++)),j=f.indexOf(a.charAt(k++)),b=g<<2|h>>4,c=(15&h)<<4|i>>2,d=(3&i)<<6|j,o[l++]=b,64!==i&&(o[l++]=c),64!==j&&(o[l++]=d);return o}},{\"./support\":30,\"./utils\":32}],2:[function(a,b,c){\"use strict\";function d(a,b,c,d,e){this.compressedSize=a,this.uncompressedSize=b,this.crc32=c,this.compression=d,this.compressedContent=e}var e=a(\"./external\"),f=a(\"./stream/DataWorker\"),g=a(\"./stream/DataLengthProbe\"),h=a(\"./stream/Crc32Probe\"),g=a(\"./stream/DataLengthProbe\");d.prototype={getContentWorker:function(){var a=new f(e.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new g(\"data_length\")),b=this;return a.on(\"end\",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw new Error(\"Bug : uncompressed data size mismatch\")}),a},getCompressedWorker:function(){return new f(e.Promise.resolve(this.compressedContent)).withStreamInfo(\"compressedSize\",this.compressedSize).withStreamInfo(\"uncompressedSize\",this.uncompressedSize).withStreamInfo(\"crc32\",this.crc32).withStreamInfo(\"compression\",this.compression)}},d.createWorkerFrom=function(a,b,c){return a.pipe(new h).pipe(new g(\"uncompressedSize\")).pipe(b.compressWorker(c)).pipe(new g(\"compressedSize\")).withStreamInfo(\"compression\",b)},b.exports=d},{\"./external\":6,\"./stream/Crc32Probe\":25,\"./stream/DataLengthProbe\":26,\"./stream/DataWorker\":27}],3:[function(a,b,c){\"use strict\";var d=a(\"./stream/GenericWorker\");c.STORE={magic:\"\\0\\0\",compressWorker:function(a){return new d(\"STORE compression\")},uncompressWorker:function(){return new d(\"STORE decompression\")}},c.DEFLATE=a(\"./flate\")},{\"./flate\":7,\"./stream/GenericWorker\":28}],4:[function(a,b,c){\"use strict\";function d(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function e(a,b,c,d){var e=h,f=d+c;a^=-1;for(var g=d;g<f;g++)a=a>>>8^e[255&(a^b[g])];return a^-1}function f(a,b,c,d){var e=h,f=d+c;a^=-1;for(var g=d;g<f;g++)a=a>>>8^e[255&(a^b.charCodeAt(g))];return a^-1}var g=a(\"./utils\"),h=d();b.exports=function(a,b){if(\"undefined\"==typeof a||!a.length)return 0;var c=\"string\"!==g.getTypeOf(a);return c?e(0|b,a,a.length,0):f(0|b,a,a.length,0)}},{\"./utils\":32}],5:[function(a,b,c){\"use strict\";c.base64=!1,c.binary=!1,c.dir=!1,c.createFolders=!0,c.date=null,c.compression=null,c.compressionOptions=null,c.comment=null,c.unixPermissions=null,c.dosPermissions=null},{}],6:[function(a,b,c){\"use strict\";var d=null;d=\"undefined\"!=typeof Promise?Promise:a(\"lie\"),b.exports={Promise:d}},{lie:58}],7:[function(a,b,c){\"use strict\";function d(a,b){h.call(this,\"FlateWorker/\"+a),this._pako=new f[a]({raw:!0,level:b.level||-1}),this.meta={};var c=this;this._pako.onData=function(a){c.push({data:a,meta:c.meta})}}var e=\"undefined\"!=typeof Uint8Array&&\"undefined\"!=typeof Uint16Array&&\"undefined\"!=typeof Uint32Array,f=a(\"pako\"),g=a(\"./utils\"),h=a(\"./stream/GenericWorker\"),i=e?\"uint8array\":\"array\";c.magic=\"\\b\\0\",g.inherits(d,h),d.prototype.processChunk=function(a){this.meta=a.meta,this._pako.push(g.transformTo(i,a.data),!1)},d.prototype.flush=function(){h.prototype.flush.call(this),this._pako.push([],!0)},d.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},c.compressWorker=function(a){return new d(\"Deflate\",a)},c.uncompressWorker=function(){return new d(\"Inflate\",{})}},{\"./stream/GenericWorker\":28,\"./utils\":32,pako:59}],8:[function(a,b,c){\"use strict\";function d(a,b,c,d){f.call(this,\"ZipFileWorker\"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=c,this.encodeFileName=d,this.streamFiles=a,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}var e=a(\"../utils\"),f=a(\"../stream/GenericWorker\"),g=a(\"../utf8\"),h=a(\"../crc32\"),i=a(\"../signature\"),j=function(a,b){var c,d=\"\";for(c=0;c<b;c++)d+=String.fromCharCode(255&a),a>>>=8;return d},k=function(a,b){var c=a;return a||(c=b?16893:33204),(65535&c)<<16},l=function(a,b){return 63&(a||0)},m=function(a,b,c,d,f,m){var n,o,p=a.file,q=a.compression,r=m!==g.utf8encode,s=e.transformTo(\"string\",m(p.name)),t=e.transformTo(\"string\",g.utf8encode(p.name)),u=p.comment,v=e.transformTo(\"string\",m(u)),w=e.transformTo(\"string\",g.utf8encode(u)),x=t.length!==p.name.length,y=w.length!==u.length,z=\"\",A=\"\",B=\"\",C=p.dir,D=p.date,E={crc32:0,compressedSize:0,uncompressedSize:0};b&&!c||(E.crc32=a.crc32,E.compressedSize=a.compressedSize,E.uncompressedSize=a.uncompressedSize);var F=0;b&&(F|=8),r||!x&&!y||(F|=2048);var G=0,H=0;C&&(G|=16),\"UNIX\"===f?(H=798,G|=k(p.unixPermissions,C)):(H=20,G|=l(p.dosPermissions,C)),n=D.getUTCHours(),n<<=6,n|=D.getUTCMinutes(),n<<=5,n|=D.getUTCSeconds()/2,o=D.getUTCFullYear()-1980,o<<=4,o|=D.getUTCMonth()+1,o<<=5,o|=D.getUTCDate(),x&&(A=j(1,1)+j(h(s),4)+t,z+=\"up\"+j(A.length,2)+A),y&&(B=j(1,1)+j(h(v),4)+w,z+=\"uc\"+j(B.length,2)+B);var I=\"\";I+=\"\\n\\0\",I+=j(F,2),I+=q.magic,I+=j(n,2),I+=j(o,2),I+=j(E.crc32,4),I+=j(E.compressedSize,4),I+=j(E.uncompressedSize,4),I+=j(s.length,2),I+=j(z.length,2);var J=i.LOCAL_FILE_HEADER+I+s+z,K=i.CENTRAL_FILE_HEADER+j(H,2)+I+j(v.length,2)+\"\\0\\0\\0\\0\"+j(G,4)+j(d,4)+s+z+v;return{fileRecord:J,dirRecord:K}},n=function(a,b,c,d,f){var g=\"\",h=e.transformTo(\"string\",f(d));return g=i.CENTRAL_DIRECTORY_END+\"\\0\\0\\0\\0\"+j(a,2)+j(a,2)+j(b,4)+j(c,4)+j(h.length,2)+h},o=function(a){var b=\"\";return b=i.DATA_DESCRIPTOR+j(a.crc32,4)+j(a.compressedSize,4)+j(a.uncompressedSize,4)};e.inherits(d,f),d.prototype.push=function(a){var b=a.meta.percent||0,c=this.entriesCount,d=this._sources.length;this.accumulate?this.contentBuffer.push(a):(this.bytesWritten+=a.data.length,f.prototype.push.call(this,{data:a.data,meta:{currentFile:this.currentFile,percent:c?(b+100*(c-d-1))/c:100}}))},d.prototype.openedSource=function(a){this.currentSourceOffset=this.bytesWritten,this.currentFile=a.file.name;var b=this.streamFiles&&!a.file.dir;if(b){var c=m(a,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:c.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(a){this.accumulate=!1;var b=this.streamFiles&&!a.file.dir,c=m(a,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(c.dirRecord),b)this.push({data:o(a),meta:{percent:100}});else for(this.push({data:c.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var a=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var c=this.bytesWritten-a,d=n(this.dirRecords.length,c,a,this.zipComment,this.encodeFileName);this.push({data:d,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(a){this._sources.push(a);var b=this;return a.on(\"data\",function(a){b.processChunk(a)}),a.on(\"end\",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),a.on(\"error\",function(a){b.error(a)}),this},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(a){var b=this._sources;if(!f.prototype.error.call(this,a))return!1;for(var c=0;c<b.length;c++)try{b[c].error(a)}catch(a){}return!0},d.prototype.lock=function(){f.prototype.lock.call(this);for(var a=this._sources,b=0;b<a.length;b++)a[b].lock()},b.exports=d},{\"../crc32\":4,\"../signature\":23,\"../stream/GenericWorker\":28,\"../utf8\":31,\"../utils\":32}],9:[function(a,b,c){\"use strict\";var d=a(\"../compressions\"),e=a(\"./ZipFileWorker\"),f=function(a,b){var c=a||b,e=d[c];if(!e)throw new Error(c+\" is not a valid compression method !\");return e};c.generateWorker=function(a,b,c){var d=new e(b.streamFiles,c,b.platform,b.encodeFileName),g=0;try{a.forEach(function(a,c){g++;var e=f(c.options.compression,b.compression),h=c.options.compressionOptions||b.compressionOptions||{},i=c.dir,j=c.date;c._compressWorker(e,h).withStreamInfo(\"file\",{name:a,dir:i,date:j,comment:c.comment||\"\",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(d)}),d.entriesCount=g}catch(h){d.error(h)}return d}},{\"../compressions\":3,\"./ZipFileWorker\":8}],10:[function(a,b,c){\"use strict\";function d(){if(!(this instanceof d))return new d;if(arguments.length)throw new Error(\"The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.\");this.files={},this.comment=null,this.root=\"\",this.clone=function(){var a=new d;for(var b in this)\"function\"!=typeof this[b]&&(a[b]=this[b]);return a}}d.prototype=a(\"./object\"),d.prototype.loadAsync=a(\"./load\"),d.support=a(\"./support\"),d.defaults=a(\"./defaults\"),d.version=\"3.1.3\",d.loadAsync=function(a,b){return(new d).loadAsync(a,b)},d.external=a(\"./external\"),b.exports=d},{\"./defaults\":5,\"./external\":6,\"./load\":11,\"./object\":15,\"./support\":30}],11:[function(a,b,c){\"use strict\";function d(a){return new f.Promise(function(b,c){var d=a.decompressed.getContentWorker().pipe(new i);d.on(\"error\",function(a){c(a)}).on(\"end\",function(){d.streamInfo.crc32!==a.decompressed.crc32?c(new Error(\"Corrupted zip : CRC32 mismatch\")):b()}).resume()})}var e=a(\"./utils\"),f=a(\"./external\"),g=a(\"./utf8\"),e=a(\"./utils\"),h=a(\"./zipEntries\"),i=a(\"./stream/Crc32Probe\"),j=a(\"./nodejsUtils\");b.exports=function(a,b){var c=this;return b=e.extend(b||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:g.utf8decode}),j.isNode&&j.isStream(a)?f.Promise.reject(new Error(\"JSZip can't accept a stream when loading a zip file.\")):e.prepareContent(\"the loaded zip file\",a,!0,b.optimizedBinaryString,b.base64).then(function(a){var c=new h(b);return c.load(a),c}).then(function(a){var c=[f.Promise.resolve(a)],e=a.files;if(b.checkCRC32)for(var g=0;g<e.length;g++)c.push(d(e[g]));return f.Promise.all(c)}).then(function(a){for(var d=a.shift(),e=d.files,f=0;f<e.length;f++){var g=e[f];c.file(g.fileNameStr,g.decompressed,{binary:!0,optimizedBinaryString:!0,date:g.date,dir:g.dir,comment:g.fileCommentStr.length?g.fileCommentStr:null,unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions,createFolders:b.createFolders})}return d.zipComment.length&&(c.comment=d.zipComment),c})}},{\"./external\":6,\"./nodejsUtils\":14,\"./stream/Crc32Probe\":25,\"./utf8\":31,\"./utils\":32,\"./zipEntries\":33}],12:[function(a,b,c){\"use strict\";function d(a,b){f.call(this,\"Nodejs stream input adapter for \"+a),this._upstreamEnded=!1,this._bindStream(b)}var e=a(\"../utils\"),f=a(\"../stream/GenericWorker\");e.inherits(d,f),d.prototype._bindStream=function(a){var b=this;this._stream=a,a.pause(),a.on(\"data\",function(a){b.push({data:a,meta:{percent:0}})}).on(\"error\",function(a){b.isPaused?this.generatedError=a:b.error(a)}).on(\"end\",function(){b.isPaused?b._upstreamEnded=!0:b.end()})},d.prototype.pause=function(){return!!f.prototype.pause.call(this)&&(this._stream.pause(),!0)},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},b.exports=d},{\"../stream/GenericWorker\":28,\"../utils\":32}],13:[function(a,b,c){\"use strict\";function d(a,b,c){e.call(this,b),this._helper=a;var d=this;a.on(\"data\",function(a,b){d.push(a)||d._helper.pause(),c&&c(b)}).on(\"error\",function(a){d.emit(\"error\",a)}).on(\"end\",function(){d.push(null)})}var e=a(\"readable-stream\").Readable,f=a(\"util\");f.inherits(d,e),d.prototype._read=function(){this._helper.resume()},b.exports=d},{\"readable-stream\":16,util:void 0}],14:[function(a,b,c){\"use strict\";b.exports={isNode:\"undefined\"!=typeof Buffer,newBuffer:function(a,b){return new Buffer(a,b)},isBuffer:function(a){return Buffer.isBuffer(a)},isStream:function(a){return a&&\"function\"==typeof a.on&&\"function\"==typeof a.pause&&\"function\"==typeof a.resume}}},{}],15:[function(a,b,c){\"use strict\";function d(a){return\"[object RegExp]\"===Object.prototype.toString.call(a)}var e=a(\"./utf8\"),f=a(\"./utils\"),g=a(\"./stream/GenericWorker\"),h=a(\"./stream/StreamHelper\"),i=a(\"./defaults\"),j=a(\"./compressedObject\"),k=a(\"./zipObject\"),l=a(\"./generate\"),m=a(\"./nodejsUtils\"),n=a(\"./nodejs/NodejsStreamInputAdapter\"),o=function(a,b,c){var d,e=f.getTypeOf(b),h=f.extend(c||{},i);h.date=h.date||new Date,null!==h.compression&&(h.compression=h.compression.toUpperCase()),\"string\"==typeof h.unixPermissions&&(h.unixPermissions=parseInt(h.unixPermissions,8)),h.unixPermissions&&16384&h.unixPermissions&&(h.dir=!0),h.dosPermissions&&16&h.dosPermissions&&(h.dir=!0),h.dir&&(a=q(a)),h.createFolders&&(d=p(a))&&r.call(this,d,!0);var l=\"string\"===e&&h.binary===!1&&h.base64===!1;c&&\"undefined\"!=typeof c.binary||(h.binary=!l);var o=b instanceof j&&0===b.uncompressedSize;(o||h.dir||!b||0===b.length)&&(h.base64=!1,h.binary=!0,b=\"\",h.compression=\"STORE\",e=\"string\");var s=null;s=b instanceof j||b instanceof g?b:m.isNode&&m.isStream(b)?new n(a,b):f.prepareContent(a,b,h.binary,h.optimizedBinaryString,h.base64);var t=new k(a,s,h);this.files[a]=t},p=function(a){\"/\"===a.slice(-1)&&(a=a.substring(0,a.length-1));var b=a.lastIndexOf(\"/\");return b>0?a.substring(0,b):\"\"},q=function(a){return\"/\"!==a.slice(-1)&&(a+=\"/\"),a},r=function(a,b){return b=\"undefined\"!=typeof b?b:i.createFolders,a=q(a),this.files[a]||o.call(this,a,null,{dir:!0,createFolders:b}),this.files[a]},s={load:function(){throw new Error(\"This method has been removed in JSZip 3.0, please check the upgrade guide.\")},forEach:function(a){var b,c,d;for(b in this.files)this.files.hasOwnProperty(b)&&(d=this.files[b],c=b.slice(this.root.length,b.length),c&&b.slice(0,this.root.length)===this.root&&a(c,d))},filter:function(a){var b=[];return this.forEach(function(c,d){a(c,d)&&b.push(d)}),b},file:function(a,b,c){if(1===arguments.length){if(d(a)){var e=a;return this.filter(function(a,b){return!b.dir&&e.test(a)})}var f=this.files[this.root+a];return f&&!f.dir?f:null}return a=this.root+a,o.call(this,a,b,c),this},folder:function(a){if(!a)return this;if(d(a))return this.filter(function(b,c){return c.dir&&a.test(b)});var b=this.root+a,c=r.call(this,b),e=this.clone();return e.root=c.name,e},remove:function(a){a=this.root+a;var b=this.files[a];if(b||(\"/\"!==a.slice(-1)&&(a+=\"/\"),b=this.files[a]),b&&!b.dir)delete this.files[a];else for(var c=this.filter(function(b,c){return c.name.slice(0,a.length)===a}),d=0;d<c.length;d++)delete this.files[c[d].name];return this},generate:function(a){throw new Error(\"This method has been removed in JSZip 3.0, please check the upgrade guide.\")},generateInternalStream:function(a){var b,c={};try{if(c=f.extend(a||{},{streamFiles:!1,compression:\"STORE\",compressionOptions:null,type:\"\",platform:\"DOS\",comment:null,mimeType:\"application/zip\",encodeFileName:e.utf8encode}),c.type=c.type.toLowerCase(),c.compression=c.compression.toUpperCase(),\"binarystring\"===c.type&&(c.type=\"string\"),!c.type)throw new Error(\"No output type specified.\");f.checkSupport(c.type),\"darwin\"!==c.platform&&\"freebsd\"!==c.platform&&\"linux\"!==c.platform&&\"sunos\"!==c.platform||(c.platform=\"UNIX\"),\"win32\"===c.platform&&(c.platform=\"DOS\");var d=c.comment||this.comment||\"\";b=l.generateWorker(this,c,d)}catch(i){b=new g(\"error\"),b.error(i)}return new h(b,c.type||\"string\",c.mimeType)},generateAsync:function(a,b){return this.generateInternalStream(a).accumulate(b)},generateNodeStream:function(a,b){return a=a||{},a.type||(a.type=\"nodebuffer\"),this.generateInternalStream(a).toNodejsStream(b)}};b.exports=s},{\"./compressedObject\":2,\"./defaults\":5,\"./generate\":9,\"./nodejs/NodejsStreamInputAdapter\":12,\"./nodejsUtils\":14,\"./stream/GenericWorker\":28,\"./stream/StreamHelper\":29,\"./utf8\":31,\"./utils\":32,\"./zipObject\":35}],16:[function(a,b,c){b.exports=a(\"stream\")},{stream:void 0}],17:[function(a,b,c){\"use strict\";function d(a){e.call(this,a);for(var b=0;b<this.data.length;b++)a[b]=255&a[b]}var e=a(\"./DataReader\"),f=a(\"../utils\");f.inherits(d,e),d.prototype.byteAt=function(a){return this.data[this.zero+a]},d.prototype.lastIndexOfSignature=function(a){for(var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.length-4;f>=0;--f)if(this.data[f]===b&&this.data[f+1]===c&&this.data[f+2]===d&&this.data[f+3]===e)return f-this.zero;return-1},d.prototype.readAndCheckSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.readData(4);return b===f[0]&&c===f[1]&&d===f[2]&&e===f[3]},d.prototype.readData=function(a){if(this.checkOffset(a),0===a)return[];var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{\"../utils\":32,\"./DataReader\":18}],18:[function(a,b,c){\"use strict\";function d(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}var e=a(\"../utils\");d.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error(\"End of data reached (data length = \"+this.length+\", asked index = \"+a+\"). Corrupted zip ?\")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(a){},readInt:function(a){var b,c=0;for(this.checkOffset(a),b=this.index+a-1;b>=this.index;b--)c=(c<<8)+this.byteAt(b);return this.index+=a,c},readString:function(a){return e.transformTo(\"string\",this.readData(a))},readData:function(a){},lastIndexOfSignature:function(a){},readAndCheckSignature:function(a){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},b.exports=d},{\"../utils\":32}],19:[function(a,b,c){\"use strict\";function d(a){e.call(this,a)}var e=a(\"./Uint8ArrayReader\"),f=a(\"../utils\");f.inherits(d,e),d.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{\"../utils\":32,\"./Uint8ArrayReader\":21}],20:[function(a,b,c){\"use strict\";function d(a){e.call(this,a)}var e=a(\"./DataReader\"),f=a(\"../utils\");f.inherits(d,e),d.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},d.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},d.prototype.readAndCheckSignature=function(a){var b=this.readData(4);return a===b},d.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{\"../utils\":32,\"./DataReader\":18}],21:[function(a,b,c){\"use strict\";function d(a){e.call(this,a)}var e=a(\"./ArrayReader\"),f=a(\"../utils\");f.inherits(d,e),d.prototype.readData=function(a){if(this.checkOffset(a),0===a)return new Uint8Array(0);var b=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{\"../utils\":32,\"./ArrayReader\":17}],22:[function(a,b,c){\"use strict\";var d=a(\"../utils\"),e=a(\"../support\"),f=a(\"./ArrayReader\"),g=a(\"./StringReader\"),h=a(\"./NodeBufferReader\"),i=a(\"./Uint8ArrayReader\");b.exports=function(a){var b=d.getTypeOf(a);return d.checkSupport(b),\"string\"!==b||e.uint8array?\"nodebuffer\"===b?new h(a):e.uint8array?new i(d.transformTo(\"uint8array\",a)):new f(d.transformTo(\"array\",a)):new g(a)}},{\"../support\":30,\"../utils\":32,\"./ArrayReader\":17,\"./NodeBufferReader\":19,\"./StringReader\":20,\"./Uint8ArrayReader\":21}],23:[function(a,b,c){\"use strict\";c.LOCAL_FILE_HEADER=\"PK\u0003\u0004\",c.CENTRAL_FILE_HEADER=\"PK\u0001\u0002\",c.CENTRAL_DIRECTORY_END=\"PK\u0005\u0006\",c.ZIP64_CENTRAL_DIRECTORY_LOCATOR=\"PK\u0006\u0007\",c.ZIP64_CENTRAL_DIRECTORY_END=\"PK\u0006\u0006\",c.DATA_DESCRIPTOR=\"PK\u0007\\b\"},{}],24:[function(a,b,c){\"use strict\";function d(a){e.call(this,\"ConvertWorker to \"+a),this.destType=a}var e=a(\"./GenericWorker\"),f=a(\"../utils\");f.inherits(d,e),d.prototype.processChunk=function(a){this.push({data:f.transformTo(this.destType,a.data),meta:a.meta})},b.exports=d},{\"../utils\":32,\"./GenericWorker\":28}],25:[function(a,b,c){\"use strict\";function d(){e.call(this,\"Crc32Probe\"),this.withStreamInfo(\"crc32\",0)}var e=a(\"./GenericWorker\"),f=a(\"../crc32\"),g=a(\"../utils\");g.inherits(d,e),d.prototype.processChunk=function(a){this.streamInfo.crc32=f(a.data,this.streamInfo.crc32||0),this.push(a)},b.exports=d},{\"../crc32\":4,\"../utils\":32,\"./GenericWorker\":28}],26:[function(a,b,c){\"use strict\";function d(a){f.call(this,\"DataLengthProbe for \"+a),this.propName=a,this.withStreamInfo(a,0)}var e=a(\"../utils\"),f=a(\"./GenericWorker\");e.inherits(d,f),d.prototype.processChunk=function(a){if(a){var b=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=b+a.data.length}f.prototype.processChunk.call(this,a)},b.exports=d},{\"../utils\":32,\"./GenericWorker\":28}],27:[function(a,b,c){\"use strict\";function d(a){f.call(this,\"DataWorker\");var b=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type=\"\",this._tickScheduled=!1,a.then(function(a){b.dataIsReady=!0,b.data=a,b.max=a&&a.length||0,b.type=e.getTypeOf(a),b.isPaused||b._tickAndRepeat()},function(a){b.error(a)})}var e=a(\"../utils\"),f=a(\"./GenericWorker\"),g=16384;e.inherits(d,f),d.prototype.cleanUp=function(){f.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,e.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(e.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=g,b=null,c=Math.min(this.max,this.index+a);if(this.index>=this.max)return this.end();switch(this.type){case\"string\":b=this.data.substring(this.index,c);break;case\"uint8array\":b=this.data.subarray(this.index,c);break;case\"array\":case\"nodebuffer\":b=this.data.slice(this.index,c)}return this.index=c,this.push({data:b,meta:{percent:this.max?this.index/this.max*100:0}})},b.exports=d},{\"../utils\":32,\"./GenericWorker\":28}],28:[function(a,b,c){\"use strict\";function d(a){this.name=a||\"default\",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}d.prototype={push:function(a){this.emit(\"data\",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit(\"end\"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit(\"error\",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit(\"error\",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,b){return this._listeners[a].push(b),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].call(this,b)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error(\"The stream '\"+this+\"' has already been used.\");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var b=this;return a.on(\"data\",function(a){b.processChunk(a)}),a.on(\"end\",function(){b.end()}),a.on(\"error\",function(a){b.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var a=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,b){return this.extraStreamInfo[a]=b,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error(\"The stream '\"+this+\"' has already been used.\");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a=\"Worker \"+this.name;return this.previous?this.previous+\" -> \"+a:a}},b.exports=d},{}],29:[function(a,b,c){\"use strict\";function d(a,b,c,d){var f=null;switch(a){case\"blob\":return h.newBlob(c,d);case\"base64\":return f=e(b,c),k.encode(f);default:return f=e(b,c),h.transformTo(a,f)}}function e(a,b){var c,d=0,e=null,f=0;for(c=0;c<b.length;c++)f+=b[c].length;switch(a){case\"string\":return b.join(\"\");case\"array\":return Array.prototype.concat.apply([],b);case\"uint8array\":for(e=new Uint8Array(f),c=0;c<b.length;c++)e.set(b[c],d),d+=b[c].length;return e;case\"nodebuffer\":return Buffer.concat(b);default:throw new Error(\"concat : unsupported type '\"+a+\"'\")}}function f(a,b){return new m.Promise(function(c,e){var f=[],g=a._internalType,h=a._outputType,i=a._mimeType;a.on(\"data\",function(a,c){f.push(a),b&&b(c)}).on(\"error\",function(a){f=[],e(a)}).on(\"end\",function(){try{var a=d(h,g,f,i);c(a)}catch(b){e(b)}f=[]}).resume()})}function g(a,b,c){var d=b;switch(b){case\"blob\":d=\"arraybuffer\";break;case\"arraybuffer\":d=\"uint8array\";break;case\"base64\":d=\"string\"}try{this._internalType=d,this._outputType=b,this._mimeType=c,h.checkSupport(d),this._worker=a.pipe(new i(d)),a.lock()}catch(e){this._worker=new j(\"error\"),this._worker.error(e)}}var h=a(\"../utils\"),i=a(\"./ConvertWorker\"),j=a(\"./GenericWorker\"),k=a(\"../base64\"),l=a(\"../support\"),m=a(\"../external\"),n=null;if(l.nodestream)try{n=a(\"../nodejs/NodejsStreamOutputAdapter\")}catch(o){}g.prototype={accumulate:function(a){return f(this,a)},on:function(a,b){var c=this;return\"data\"===a?this._worker.on(a,function(a){b.call(c,a.data,a.meta)}):this._worker.on(a,function(){h.delay(b,arguments,c)}),this},resume:function(){return h.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(a){if(h.checkSupport(\"nodestream\"),\"nodebuffer\"!==this._outputType)throw new Error(this._outputType+\" is not supported by this method\");return new n(this,{objectMode:\"nodebuffer\"!==this._outputType},a)}},b.exports=g},{\"../base64\":1,\"../external\":6,\"../nodejs/NodejsStreamOutputAdapter\":13,\"../support\":30,\"../utils\":32,\"./ConvertWorker\":24,\"./GenericWorker\":28}],30:[function(a,b,c){\"use strict\";if(c.base64=!0,c.array=!0,c.string=!0,c.arraybuffer=\"undefined\"!=typeof ArrayBuffer&&\"undefined\"!=typeof Uint8Array,c.nodebuffer=\"undefined\"!=typeof Buffer,c.uint8array=\"undefined\"!=typeof Uint8Array,\"undefined\"==typeof ArrayBuffer)c.blob=!1;else{var d=new ArrayBuffer(0);try{c.blob=0===new Blob([d],{type:\"application/zip\"}).size}catch(e){try{var f=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,g=new f;g.append(d),c.blob=0===g.getBlob(\"application/zip\").size}catch(e){c.blob=!1}}}try{c.nodestream=!!a(\"readable-stream\").Readable}catch(e){c.nodestream=!1}},{\"readable-stream\":16}],31:[function(a,b,c){\"use strict\";function d(){i.call(this,\"utf-8 decode\"),this.leftOver=null}function e(){i.call(this,\"utf-8 encode\")}for(var f=a(\"./utils\"),g=a(\"./support\"),h=a(\"./nodejsUtils\"),i=a(\"./stream/GenericWorker\"),j=new Array(256),k=0;k<256;k++)j[k]=k>=252?6:k>=248?5:k>=240?4:k>=224?3:k>=192?2:1;j[254]=j[254]=1;var l=function(a){var b,c,d,e,f,h=a.length,i=0;for(e=0;e<h;e++)c=a.charCodeAt(e),55296===(64512&c)&&e+1<h&&(d=a.charCodeAt(e+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),e++)),i+=c<128?1:c<2048?2:c<65536?3:4;for(b=g.uint8array?new Uint8Array(i):new Array(i),f=0,e=0;f<i;e++)c=a.charCodeAt(e),55296===(64512&c)&&e+1<h&&(d=a.charCodeAt(e+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),e++)),c<128?b[f++]=c:c<2048?(b[f++]=192|c>>>6,b[f++]=128|63&c):c<65536?(b[f++]=224|c>>>12,b[f++]=128|c>>>6&63,b[f++]=128|63&c):(b[f++]=240|c>>>18,b[f++]=128|c>>>12&63,b[f++]=128|c>>>6&63,b[f++]=128|63&c);return b},m=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return c<0?b:0===c?b:c+j[a[c]]>b?c:b},n=function(a){var b,c,d,e,g=a.length,h=new Array(2*g);for(c=0,b=0;b<g;)if(d=a[b++],d<128)h[c++]=d;else if(e=j[d],e>4)h[c++]=65533,b+=e-1;else{for(d&=2===e?31:3===e?15:7;e>1&&b<g;)d=d<<6|63&a[b++],e--;e>1?h[c++]=65533:d<65536?h[c++]=d:(d-=65536,h[c++]=55296|d>>10&1023,h[c++]=56320|1023&d)}return h.length!==c&&(h.subarray?h=h.subarray(0,c):h.length=c),f.applyFromCharCode(h)};c.utf8encode=function(a){return g.nodebuffer?h.newBuffer(a,\"utf-8\"):l(a)},c.utf8decode=function(a){return g.nodebuffer?f.transformTo(\"nodebuffer\",a).toString(\"utf-8\"):(a=f.transformTo(g.uint8array?\"uint8array\":\"array\",a),n(a))},f.inherits(d,i),d.prototype.processChunk=function(a){var b=f.transformTo(g.uint8array?\"uint8array\":\"array\",a.data);if(this.leftOver&&this.leftOver.length){if(g.uint8array){var d=b;b=new Uint8Array(d.length+this.leftOver.length),b.set(this.leftOver,0),b.set(d,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var e=m(b),h=b;e!==b.length&&(g.uint8array?(h=b.subarray(0,e),this.leftOver=b.subarray(e,b.length)):(h=b.slice(0,e),this.leftOver=b.slice(e,b.length))),this.push({data:c.utf8decode(h),meta:a.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:c.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},c.Utf8DecodeWorker=d,f.inherits(e,i),e.prototype.processChunk=function(a){this.push({data:c.utf8encode(a.data),meta:a.meta})},c.Utf8EncodeWorker=e},{\"./nodejsUtils\":14,\"./stream/GenericWorker\":28,\"./support\":30,\"./utils\":32}],32:[function(a,b,c){\"use strict\";function d(a){var b=null;return b=i.uint8array?new Uint8Array(a.length):new Array(a.length),f(a,b)}function e(a){return a}function f(a,b){for(var c=0;c<a.length;++c)b[c]=255&a.charCodeAt(c);return b}function g(a){var b=65536,d=c.getTypeOf(a),e=!0;if(\"uint8array\"===d?e=n.applyCanBeUsed.uint8array:\"nodebuffer\"===d&&(e=n.applyCanBeUsed.nodebuffer),e)for(;b>1;)try{return n.stringifyByChunk(a,d,b)}catch(f){b=Math.floor(b/2)}return n.stringifyByChar(a)}function h(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b}var i=a(\"./support\"),j=a(\"./base64\"),k=a(\"./nodejsUtils\"),l=a(\"core-js/library/fn/set-immediate\"),m=a(\"./external\");c.newBlob=function(a,b){c.checkSupport(\"blob\");try{return new Blob(a,{type:b})}catch(d){try{for(var e=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,f=new e,g=0;g<a.length;g++)f.append(a[g]);\nreturn f.getBlob(b)}catch(d){throw new Error(\"Bug : can't construct the Blob.\")}}};var n={stringifyByChunk:function(a,b,c){var d=[],e=0,f=a.length;if(f<=c)return String.fromCharCode.apply(null,a);for(;e<f;)\"array\"===b||\"nodebuffer\"===b?d.push(String.fromCharCode.apply(null,a.slice(e,Math.min(e+c,f)))):d.push(String.fromCharCode.apply(null,a.subarray(e,Math.min(e+c,f)))),e+=c;return d.join(\"\")},stringifyByChar:function(a){for(var b=\"\",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(a){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,k.newBuffer(1)).length}catch(a){return!1}}()}};c.applyFromCharCode=g;var o={};o.string={string:e,array:function(a){return f(a,new Array(a.length))},arraybuffer:function(a){return o.string.uint8array(a).buffer},uint8array:function(a){return f(a,new Uint8Array(a.length))},nodebuffer:function(a){return f(a,k.newBuffer(a.length))}},o.array={string:g,array:e,arraybuffer:function(a){return new Uint8Array(a).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBuffer(a)}},o.arraybuffer={string:function(a){return g(new Uint8Array(a))},array:function(a){return h(new Uint8Array(a),new Array(a.byteLength))},arraybuffer:e,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBuffer(new Uint8Array(a))}},o.uint8array={string:g,array:function(a){return h(a,new Array(a.length))},arraybuffer:function(a){var b=new Uint8Array(a.length);return a.length&&b.set(a,0),b.buffer},uint8array:e,nodebuffer:function(a){return k.newBuffer(a)}},o.nodebuffer={string:g,array:function(a){return h(a,new Array(a.length))},arraybuffer:function(a){return o.nodebuffer.uint8array(a).buffer},uint8array:function(a){return h(a,new Uint8Array(a.length))},nodebuffer:e},c.transformTo=function(a,b){if(b||(b=\"\"),!a)return b;c.checkSupport(a);var d=c.getTypeOf(b),e=o[d][a](b);return e},c.getTypeOf=function(a){return\"string\"==typeof a?\"string\":\"[object Array]\"===Object.prototype.toString.call(a)?\"array\":i.nodebuffer&&k.isBuffer(a)?\"nodebuffer\":i.uint8array&&a instanceof Uint8Array?\"uint8array\":i.arraybuffer&&a instanceof ArrayBuffer?\"arraybuffer\":void 0},c.checkSupport=function(a){var b=i[a.toLowerCase()];if(!b)throw new Error(a+\" is not supported by this platform\")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(a){var b,c,d=\"\";for(c=0;c<(a||\"\").length;c++)b=a.charCodeAt(c),d+=\"\\\\x\"+(b<16?\"0\":\"\")+b.toString(16).toUpperCase();return d},c.delay=function(a,b,c){l(function(){a.apply(c||null,b||[])})},c.inherits=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c},c.extend=function(){var a,b,c={};for(a=0;a<arguments.length;a++)for(b in arguments[a])arguments[a].hasOwnProperty(b)&&\"undefined\"==typeof c[b]&&(c[b]=arguments[a][b]);return c},c.prepareContent=function(a,b,e,f,g){var h=m.Promise.resolve(b).then(function(a){var b=i.blob&&(a instanceof Blob||[\"[object File]\",\"[object Blob]\"].indexOf(Object.prototype.toString.call(a))!==-1);return b&&\"undefined\"!=typeof FileReader?new m.Promise(function(b,c){var d=new FileReader;d.onload=function(a){b(a.target.result)},d.onerror=function(a){c(a.target.error)},d.readAsArrayBuffer(a)}):a});return h.then(function(b){var h=c.getTypeOf(b);return h?(\"arraybuffer\"===h?b=c.transformTo(\"uint8array\",b):\"string\"===h&&(g?b=j.decode(b):e&&f!==!0&&(b=d(b))),b):m.Promise.reject(new Error(\"The data of '\"+a+\"' is in an unsupported format !\"))})}},{\"./base64\":1,\"./external\":6,\"./nodejsUtils\":14,\"./support\":30,\"core-js/library/fn/set-immediate\":36}],33:[function(a,b,c){\"use strict\";function d(a){this.files=[],this.loadOptions=a}var e=a(\"./reader/readerFor\"),f=a(\"./utils\"),g=a(\"./signature\"),h=a(\"./zipEntry\"),i=(a(\"./utf8\"),a(\"./support\"));d.prototype={checkSignature:function(a){if(!this.reader.readAndCheckSignature(a)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error(\"Corrupted zip or bug : unexpected signature (\"+f.pretty(b)+\", expected \"+f.pretty(a)+\")\")}},isSignature:function(a,b){var c=this.reader.index;this.reader.setIndex(a);var d=this.reader.readString(4),e=d===b;return this.reader.setIndex(c),e},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var a=this.reader.readData(this.zipCommentLength),b=i.uint8array?\"uint8array\":\"array\",c=f.transformTo(b,a);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var a,b,c,d=this.zip64EndOfCentralSize-44,e=0;e<d;)a=this.reader.readInt(2),b=this.reader.readInt(4),c=this.reader.readData(b),this.zip64ExtensibleData[a]={id:a,length:b,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error(\"Multi-volumes zip are not supported\")},readLocalFiles:function(){var a,b;for(a=0;a<this.files.length;a++)b=this.files[a],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(g.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var a;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(g.CENTRAL_FILE_HEADER);)a=new h({zip64:this.zip64},this.loadOptions),a.readCentralPart(this.reader),this.files.push(a);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error(\"Corrupted zip or bug: expected \"+this.centralDirRecords+\" records in central dir, got \"+this.files.length)},readEndOfCentral:function(){var a=this.reader.lastIndexOfSignature(g.CENTRAL_DIRECTORY_END);if(a<0){var b=!this.isSignature(0,g.LOCAL_FILE_HEADER);throw b?new Error(\"Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html\"):new Error(\"Corrupted zip : can't find end of central directory\")}this.reader.setIndex(a);var c=a;if(this.checkSignature(g.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===f.MAX_VALUE_16BITS||this.diskWithCentralDirStart===f.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===f.MAX_VALUE_16BITS||this.centralDirRecords===f.MAX_VALUE_16BITS||this.centralDirSize===f.MAX_VALUE_32BITS||this.centralDirOffset===f.MAX_VALUE_32BITS){if(this.zip64=!0,a=this.reader.lastIndexOfSignature(g.ZIP64_CENTRAL_DIRECTORY_LOCATOR),a<0)throw new Error(\"Corrupted zip : can't find the ZIP64 end of central directory locator\");if(this.reader.setIndex(a),this.checkSignature(g.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,g.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(g.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error(\"Corrupted zip : can't find the ZIP64 end of central directory\");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(g.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var e=c-d;if(e>0)this.isSignature(c,g.CENTRAL_FILE_HEADER)||(this.reader.zero=e);else if(e<0)throw new Error(\"Corrupted zip: missing \"+Math.abs(e)+\" bytes.\")},prepareReader:function(a){this.reader=e(a)},load:function(a){this.prepareReader(a),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},b.exports=d},{\"./reader/readerFor\":22,\"./signature\":23,\"./support\":30,\"./utf8\":31,\"./utils\":32,\"./zipEntry\":34}],34:[function(a,b,c){\"use strict\";function d(a,b){this.options=a,this.loadOptions=b}var e=a(\"./reader/readerFor\"),f=a(\"./utils\"),g=a(\"./compressedObject\"),h=a(\"./crc32\"),i=a(\"./utf8\"),j=a(\"./compressions\"),k=a(\"./support\"),l=0,m=3,n=function(a){for(var b in j)if(j.hasOwnProperty(b)&&j[b].magic===a)return j[b];return null};d.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},readLocalPart:function(a){var b,c;if(a.skip(22),this.fileNameLength=a.readInt(2),c=a.readInt(2),this.fileName=a.readData(this.fileNameLength),a.skip(c),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error(\"Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)\");if(b=n(this.compressionMethod),null===b)throw new Error(\"Corrupted zip : compression \"+f.pretty(this.compressionMethod)+\" unknown (inner file : \"+f.transformTo(\"string\",this.fileName)+\")\");this.decompressed=new g(this.compressedSize,this.uncompressedSize,this.crc32,b,a.readData(this.compressedSize))},readCentralPart:function(a){this.versionMadeBy=a.readInt(2),a.skip(2),this.bitFlag=a.readInt(2),this.compressionMethod=a.readString(2),this.date=a.readDate(),this.crc32=a.readInt(4),this.compressedSize=a.readInt(4),this.uncompressedSize=a.readInt(4);var b=a.readInt(2);if(this.extraFieldsLength=a.readInt(2),this.fileCommentLength=a.readInt(2),this.diskNumberStart=a.readInt(2),this.internalFileAttributes=a.readInt(2),this.externalFileAttributes=a.readInt(4),this.localHeaderOffset=a.readInt(4),this.isEncrypted())throw new Error(\"Encrypted zip are not supported\");a.skip(b),this.readExtraFields(a),this.parseZIP64ExtraField(a),this.fileComment=a.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var a=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),a===l&&(this.dosPermissions=63&this.externalFileAttributes),a===m&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||\"/\"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(a){if(this.extraFields[1]){var b=e(this.extraFields[1].value);this.uncompressedSize===f.MAX_VALUE_32BITS&&(this.uncompressedSize=b.readInt(8)),this.compressedSize===f.MAX_VALUE_32BITS&&(this.compressedSize=b.readInt(8)),this.localHeaderOffset===f.MAX_VALUE_32BITS&&(this.localHeaderOffset=b.readInt(8)),this.diskNumberStart===f.MAX_VALUE_32BITS&&(this.diskNumberStart=b.readInt(4))}},readExtraFields:function(a){var b,c,d,e=a.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});a.index<e;)b=a.readInt(2),c=a.readInt(2),d=a.readData(c),this.extraFields[b]={id:b,length:c,value:d}},handleUTF8:function(){var a=k.uint8array?\"uint8array\":\"array\";if(this.useUTF8())this.fileNameStr=i.utf8decode(this.fileName),this.fileCommentStr=i.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(null!==b)this.fileNameStr=b;else{var c=f.transformTo(a,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(c)}var d=this.findExtraFieldUnicodeComment();if(null!==d)this.fileCommentStr=d;else{var e=f.transformTo(a,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(e)}}},findExtraFieldUnicodePath:function(){var a=this.extraFields[28789];if(a){var b=e(a.value);return 1!==b.readInt(1)?null:h(this.fileName)!==b.readInt(4)?null:i.utf8decode(b.readData(a.length-5))}return null},findExtraFieldUnicodeComment:function(){var a=this.extraFields[25461];if(a){var b=e(a.value);return 1!==b.readInt(1)?null:h(this.fileComment)!==b.readInt(4)?null:i.utf8decode(b.readData(a.length-5))}return null}},b.exports=d},{\"./compressedObject\":2,\"./compressions\":3,\"./crc32\":4,\"./reader/readerFor\":22,\"./support\":30,\"./utf8\":31,\"./utils\":32}],35:[function(a,b,c){\"use strict\";var d=a(\"./stream/StreamHelper\"),e=a(\"./stream/DataWorker\"),f=a(\"./utf8\"),g=a(\"./compressedObject\"),h=a(\"./stream/GenericWorker\"),i=function(a,b,c){this.name=a,this.dir=c.dir,this.date=c.date,this.comment=c.comment,this.unixPermissions=c.unixPermissions,this.dosPermissions=c.dosPermissions,this._data=b,this._dataBinary=c.binary,this.options={compression:c.compression,compressionOptions:c.compressionOptions}};i.prototype={internalStream:function(a){var b=a.toLowerCase(),c=\"string\"===b||\"text\"===b;\"binarystring\"!==b&&\"text\"!==b||(b=\"string\");var e=this._decompressWorker(),g=!this._dataBinary;return g&&!c&&(e=e.pipe(new f.Utf8EncodeWorker)),!g&&c&&(e=e.pipe(new f.Utf8DecodeWorker)),new d(e,b,\"\")},async:function(a,b){return this.internalStream(a).accumulate(b)},nodeStream:function(a,b){return this.internalStream(a||\"nodebuffer\").toNodejsStream(b)},_compressWorker:function(a,b){if(this._data instanceof g&&this._data.compression.magic===a.magic)return this._data.getCompressedWorker();var c=this._decompressWorker();return this._dataBinary||(c=c.pipe(new f.Utf8EncodeWorker)),g.createWorkerFrom(c,a,b)},_decompressWorker:function(){return this._data instanceof g?this._data.getContentWorker():this._data instanceof h?this._data:new e(this._data)}};for(var j=[\"asText\",\"asBinary\",\"asNodeBuffer\",\"asUint8Array\",\"asArrayBuffer\"],k=function(){throw new Error(\"This method has been removed in JSZip 3.0, please check the upgrade guide.\")},l=0;l<j.length;l++)i.prototype[j[l]]=k;b.exports=i},{\"./compressedObject\":2,\"./stream/DataWorker\":27,\"./stream/GenericWorker\":28,\"./stream/StreamHelper\":29,\"./utf8\":31}],36:[function(a,b,c){a(\"../modules/web.immediate\"),b.exports=a(\"../modules/_core\").setImmediate},{\"../modules/_core\":40,\"../modules/web.immediate\":56}],37:[function(a,b,c){b.exports=function(a){if(\"function\"!=typeof a)throw TypeError(a+\" is not a function!\");return a}},{}],38:[function(a,b,c){var d=a(\"./_is-object\");b.exports=function(a){if(!d(a))throw TypeError(a+\" is not an object!\");return a}},{\"./_is-object\":51}],39:[function(a,b,c){var d={}.toString;b.exports=function(a){return d.call(a).slice(8,-1)}},{}],40:[function(a,b,c){var d=b.exports={version:\"2.3.0\"};\"number\"==typeof __e&&(__e=d)},{}],41:[function(a,b,c){var d=a(\"./_a-function\");b.exports=function(a,b,c){if(d(a),void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}}},{\"./_a-function\":37}],42:[function(a,b,c){b.exports=!a(\"./_fails\")(function(){return 7!=Object.defineProperty({},\"a\",{get:function(){return 7}}).a})},{\"./_fails\":45}],43:[function(a,b,c){var d=a(\"./_is-object\"),e=a(\"./_global\").document,f=d(e)&&d(e.createElement);b.exports=function(a){return f?e.createElement(a):{}}},{\"./_global\":46,\"./_is-object\":51}],44:[function(a,b,c){var d=a(\"./_global\"),e=a(\"./_core\"),f=a(\"./_ctx\"),g=a(\"./_hide\"),h=\"prototype\",i=function(a,b,c){var j,k,l,m=a&i.F,n=a&i.G,o=a&i.S,p=a&i.P,q=a&i.B,r=a&i.W,s=n?e:e[b]||(e[b]={}),t=s[h],u=n?d:o?d[b]:(d[b]||{})[h];n&&(c=b);for(j in c)k=!m&&u&&void 0!==u[j],k&&j in s||(l=k?u[j]:c[j],s[j]=n&&\"function\"!=typeof u[j]?c[j]:q&&k?f(l,d):r&&u[j]==l?function(a){var b=function(b,c,d){if(this instanceof a){switch(arguments.length){case 0:return new a;case 1:return new a(b);case 2:return new a(b,c)}return new a(b,c,d)}return a.apply(this,arguments)};return b[h]=a[h],b}(l):p&&\"function\"==typeof l?f(Function.call,l):l,p&&((s.virtual||(s.virtual={}))[j]=l,a&i.R&&t&&!t[j]&&g(t,j,l)))};i.F=1,i.G=2,i.S=4,i.P=8,i.B=16,i.W=32,i.U=64,i.R=128,b.exports=i},{\"./_core\":40,\"./_ctx\":41,\"./_global\":46,\"./_hide\":47}],45:[function(a,b,c){b.exports=function(a){try{return!!a()}catch(b){return!0}}},{}],46:[function(a,b,c){var d=b.exports=\"undefined\"!=typeof window&&window.Math==Math?window:\"undefined\"!=typeof self&&self.Math==Math?self:Function(\"return this\")();\"number\"==typeof __g&&(__g=d)},{}],47:[function(a,b,c){var d=a(\"./_object-dp\"),e=a(\"./_property-desc\");b.exports=a(\"./_descriptors\")?function(a,b,c){return d.f(a,b,e(1,c))}:function(a,b,c){return a[b]=c,a}},{\"./_descriptors\":42,\"./_object-dp\":52,\"./_property-desc\":53}],48:[function(a,b,c){b.exports=a(\"./_global\").document&&document.documentElement},{\"./_global\":46}],49:[function(a,b,c){b.exports=!a(\"./_descriptors\")&&!a(\"./_fails\")(function(){return 7!=Object.defineProperty(a(\"./_dom-create\")(\"div\"),\"a\",{get:function(){return 7}}).a})},{\"./_descriptors\":42,\"./_dom-create\":43,\"./_fails\":45}],50:[function(a,b,c){b.exports=function(a,b,c){var d=void 0===c;switch(b.length){case 0:return d?a():a.call(c);case 1:return d?a(b[0]):a.call(c,b[0]);case 2:return d?a(b[0],b[1]):a.call(c,b[0],b[1]);case 3:return d?a(b[0],b[1],b[2]):a.call(c,b[0],b[1],b[2]);case 4:return d?a(b[0],b[1],b[2],b[3]):a.call(c,b[0],b[1],b[2],b[3])}return a.apply(c,b)}},{}],51:[function(a,b,c){b.exports=function(a){return\"object\"==typeof a?null!==a:\"function\"==typeof a}},{}],52:[function(a,b,c){var d=a(\"./_an-object\"),e=a(\"./_ie8-dom-define\"),f=a(\"./_to-primitive\"),g=Object.defineProperty;c.f=a(\"./_descriptors\")?Object.defineProperty:function(a,b,c){if(d(a),b=f(b,!0),d(c),e)try{return g(a,b,c)}catch(h){}if(\"get\"in c||\"set\"in c)throw TypeError(\"Accessors not supported!\");return\"value\"in c&&(a[b]=c.value),a}},{\"./_an-object\":38,\"./_descriptors\":42,\"./_ie8-dom-define\":49,\"./_to-primitive\":55}],53:[function(a,b,c){b.exports=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}}},{}],54:[function(a,b,c){var d,e,f,g=a(\"./_ctx\"),h=a(\"./_invoke\"),i=a(\"./_html\"),j=a(\"./_dom-create\"),k=a(\"./_global\"),l=k.process,m=k.setImmediate,n=k.clearImmediate,o=k.MessageChannel,p=0,q={},r=\"onreadystatechange\",s=function(){var a=+this;if(q.hasOwnProperty(a)){var b=q[a];delete q[a],b()}},t=function(a){s.call(a.data)};m&&n||(m=function(a){for(var b=[],c=1;arguments.length>c;)b.push(arguments[c++]);return q[++p]=function(){h(\"function\"==typeof a?a:Function(a),b)},d(p),p},n=function(a){delete q[a]},\"process\"==a(\"./_cof\")(l)?d=function(a){l.nextTick(g(s,a,1))}:o?(e=new o,f=e.port2,e.port1.onmessage=t,d=g(f.postMessage,f,1)):k.addEventListener&&\"function\"==typeof postMessage&&!k.importScripts?(d=function(a){k.postMessage(a+\"\",\"*\")},k.addEventListener(\"message\",t,!1)):d=r in j(\"script\")?function(a){i.appendChild(j(\"script\"))[r]=function(){i.removeChild(this),s.call(a)}}:function(a){setTimeout(g(s,a,1),0)}),b.exports={set:m,clear:n}},{\"./_cof\":39,\"./_ctx\":41,\"./_dom-create\":43,\"./_global\":46,\"./_html\":48,\"./_invoke\":50}],55:[function(a,b,c){var d=a(\"./_is-object\");b.exports=function(a,b){if(!d(a))return a;var c,e;if(b&&\"function\"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;if(\"function\"==typeof(c=a.valueOf)&&!d(e=c.call(a)))return e;if(!b&&\"function\"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;throw TypeError(\"Can't convert object to primitive value\")}},{\"./_is-object\":51}],56:[function(a,b,c){var d=a(\"./_export\"),e=a(\"./_task\");d(d.G+d.B,{setImmediate:e.set,clearImmediate:e.clear})},{\"./_export\":44,\"./_task\":54}],57:[function(a,b,c){(function(a){\"use strict\";function c(){k=!0;for(var a,b,c=l.length;c;){for(b=l,l=[],a=-1;++a<c;)b[a]();c=l.length}k=!1}function d(a){1!==l.push(a)||k||e()}var e,f=a.MutationObserver||a.WebKitMutationObserver;if(f){var g=0,h=new f(c),i=a.document.createTextNode(\"\");h.observe(i,{characterData:!0}),e=function(){i.data=g=++g%2}}else if(a.setImmediate||\"undefined\"==typeof a.MessageChannel)e=\"document\"in a&&\"onreadystatechange\"in a.document.createElement(\"script\")?function(){var b=a.document.createElement(\"script\");b.onreadystatechange=function(){c(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},a.document.documentElement.appendChild(b)}:function(){setTimeout(c,0)};else{var j=new a.MessageChannel;j.port1.onmessage=c,e=function(){j.port2.postMessage(0)}}var k,l=[];b.exports=d}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{}],58:[function(a,b,c){\"use strict\";function d(){}function e(a){if(\"function\"!=typeof a)throw new TypeError(\"resolver must be a function\");this.state=s,this.queue=[],this.outcome=void 0,a!==d&&i(this,a)}function f(a,b,c){this.promise=a,\"function\"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),\"function\"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}function g(a,b,c){o(function(){var d;try{d=b(c)}catch(e){return p.reject(a,e)}d===a?p.reject(a,new TypeError(\"Cannot resolve promise with itself\")):p.resolve(a,d)})}function h(a){var b=a&&a.then;if(a&&\"object\"==typeof a&&\"function\"==typeof b)return function(){b.apply(a,arguments)}}function i(a,b){function c(b){f||(f=!0,p.reject(a,b))}function d(b){f||(f=!0,p.resolve(a,b))}function e(){b(d,c)}var f=!1,g=j(e);\"error\"===g.status&&c(g.value)}function j(a,b){var c={};try{c.value=a(b),c.status=\"success\"}catch(d){c.status=\"error\",c.value=d}return c}function k(a){return a instanceof this?a:p.resolve(new this(d),a)}function l(a){var b=new this(d);return p.reject(b,a)}function m(a){function b(a,b){function d(a){g[b]=a,++h!==e||f||(f=!0,p.resolve(j,g))}c.resolve(a).then(d,function(a){f||(f=!0,p.reject(j,a))})}var c=this;if(\"[object Array]\"!==Object.prototype.toString.call(a))return this.reject(new TypeError(\"must be an array\"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=new Array(e),h=0,i=-1,j=new this(d);++i<e;)b(a[i],i);return j}function n(a){function b(a){c.resolve(a).then(function(a){f||(f=!0,p.resolve(h,a))},function(a){f||(f=!0,p.reject(h,a))})}var c=this;if(\"[object Array]\"!==Object.prototype.toString.call(a))return this.reject(new TypeError(\"must be an array\"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=-1,h=new this(d);++g<e;)b(a[g]);return h}var o=a(\"immediate\"),p={},q=[\"REJECTED\"],r=[\"FULFILLED\"],s=[\"PENDING\"];b.exports=e,e.prototype[\"catch\"]=function(a){return this.then(null,a)},e.prototype.then=function(a,b){if(\"function\"!=typeof a&&this.state===r||\"function\"!=typeof b&&this.state===q)return this;var c=new this.constructor(d);if(this.state!==s){var e=this.state===r?a:b;g(c,e,this.outcome)}else this.queue.push(new f(c,a,b));return c},f.prototype.callFulfilled=function(a){p.resolve(this.promise,a)},f.prototype.otherCallFulfilled=function(a){g(this.promise,this.onFulfilled,a)},f.prototype.callRejected=function(a){p.reject(this.promise,a)},f.prototype.otherCallRejected=function(a){g(this.promise,this.onRejected,a)},p.resolve=function(a,b){var c=j(h,b);if(\"error\"===c.status)return p.reject(a,c.value);var d=c.value;if(d)i(a,d);else{a.state=r,a.outcome=b;for(var e=-1,f=a.queue.length;++e<f;)a.queue[e].callFulfilled(b)}return a},p.reject=function(a,b){a.state=q,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a},e.resolve=k,e.reject=l,e.all=m,e.race=n},{immediate:57}],59:[function(a,b,c){\"use strict\";var d=a(\"./lib/utils/common\").assign,e=a(\"./lib/deflate\"),f=a(\"./lib/inflate\"),g=a(\"./lib/zlib/constants\"),h={};d(h,e,f,g),b.exports=h},{\"./lib/deflate\":60,\"./lib/inflate\":61,\"./lib/utils/common\":62,\"./lib/zlib/constants\":65}],60:[function(a,b,c){\"use strict\";function d(a){if(!(this instanceof d))return new d(a);this.options=i.assign({level:s,method:u,chunkSize:16384,windowBits:15,memLevel:8,strategy:t,to:\"\"},a||{});var b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg=\"\",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=h.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(c!==p)throw new Error(k[c]);if(b.header&&h.deflateSetHeader(this.strm,b.header),b.dictionary){var e;if(e=\"string\"==typeof b.dictionary?j.string2buf(b.dictionary):\"[object ArrayBuffer]\"===m.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,c=h.deflateSetDictionary(this.strm,e),c!==p)throw new Error(k[c]);this._dict_set=!0}}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg;return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}function g(a,b){return b=b||{},b.gzip=!0,e(a,b)}var h=a(\"./zlib/deflate\"),i=a(\"./utils/common\"),j=a(\"./utils/strings\"),k=a(\"./zlib/messages\"),l=a(\"./zlib/zstream\"),m=Object.prototype.toString,n=0,o=4,p=0,q=1,r=2,s=-1,t=0,u=8;d.prototype.push=function(a,b){var c,d,e=this.strm,f=this.options.chunkSize;if(this.ended)return!1;d=b===~~b?b:b===!0?o:n,\"string\"==typeof a?e.input=j.string2buf(a):\"[object ArrayBuffer]\"===m.call(a)?e.input=new Uint8Array(a):e.input=a,e.next_in=0,e.avail_in=e.input.length;do{if(0===e.avail_out&&(e.output=new i.Buf8(f),e.next_out=0,e.avail_out=f),c=h.deflate(e,d),c!==q&&c!==p)return this.onEnd(c),this.ended=!0,!1;0!==e.avail_out&&(0!==e.avail_in||d!==o&&d!==r)||(\"string\"===this.options.to?this.onData(j.buf2binstring(i.shrinkBuf(e.output,e.next_out))):this.onData(i.shrinkBuf(e.output,e.next_out)))}while((e.avail_in>0||0===e.avail_out)&&c!==q);return d===o?(c=h.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===p):d!==r||(this.onEnd(p),e.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===p&&(\"string\"===this.options.to?this.result=this.chunks.join(\"\"):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Deflate=d,c.deflate=e,c.deflateRaw=f,c.gzip=g},{\"./utils/common\":62,\"./utils/strings\":63,\"./zlib/deflate\":67,\"./zlib/messages\":72,\"./zlib/zstream\":74}],61:[function(a,b,c){\"use strict\";function d(a){if(!(this instanceof d))return new d(a);this.options=h.assign({chunkSize:16384,windowBits:0,to:\"\"},a||{});var b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||a&&a.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg=\"\",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=g.inflateInit2(this.strm,b.windowBits);if(c!==j.Z_OK)throw new Error(k[c]);this.header=new m,g.inflateGetHeader(this.strm,this.header)}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg;return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}var g=a(\"./zlib/inflate\"),h=a(\"./utils/common\"),i=a(\"./utils/strings\"),j=a(\"./zlib/constants\"),k=a(\"./zlib/messages\"),l=a(\"./zlib/zstream\"),m=a(\"./zlib/gzheader\"),n=Object.prototype.toString;d.prototype.push=function(a,b){var c,d,e,f,k,l,m=this.strm,o=this.options.chunkSize,p=this.options.dictionary,q=!1;if(this.ended)return!1;d=b===~~b?b:b===!0?j.Z_FINISH:j.Z_NO_FLUSH,\"string\"==typeof a?m.input=i.binstring2buf(a):\"[object ArrayBuffer]\"===n.call(a)?m.input=new Uint8Array(a):m.input=a,m.next_in=0,m.avail_in=m.input.length;do{if(0===m.avail_out&&(m.output=new h.Buf8(o),m.next_out=0,m.avail_out=o),c=g.inflate(m,j.Z_NO_FLUSH),c===j.Z_NEED_DICT&&p&&(l=\"string\"==typeof p?i.string2buf(p):\"[object ArrayBuffer]\"===n.call(p)?new Uint8Array(p):p,c=g.inflateSetDictionary(this.strm,l)),c===j.Z_BUF_ERROR&&q===!0&&(c=j.Z_OK,q=!1),c!==j.Z_STREAM_END&&c!==j.Z_OK)return this.onEnd(c),this.ended=!0,!1;m.next_out&&(0!==m.avail_out&&c!==j.Z_STREAM_END&&(0!==m.avail_in||d!==j.Z_FINISH&&d!==j.Z_SYNC_FLUSH)||(\"string\"===this.options.to?(e=i.utf8border(m.output,m.next_out),f=m.next_out-e,k=i.buf2string(m.output,e),m.next_out=f,m.avail_out=o-f,f&&h.arraySet(m.output,m.output,e,f,0),this.onData(k)):this.onData(h.shrinkBuf(m.output,m.next_out)))),0===m.avail_in&&0===m.avail_out&&(q=!0)}while((m.avail_in>0||0===m.avail_out)&&c!==j.Z_STREAM_END);return c===j.Z_STREAM_END&&(d=j.Z_FINISH),d===j.Z_FINISH?(c=g.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===j.Z_OK):d!==j.Z_SYNC_FLUSH||(this.onEnd(j.Z_OK),m.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===j.Z_OK&&(\"string\"===this.options.to?this.result=this.chunks.join(\"\"):this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Inflate=d,c.inflate=e,c.inflateRaw=f,c.ungzip=e},{\"./utils/common\":62,\"./utils/strings\":63,\"./zlib/constants\":65,\"./zlib/gzheader\":68,\"./zlib/inflate\":70,\"./zlib/messages\":72,\"./zlib/zstream\":74}],62:[function(a,b,c){\"use strict\";var d=\"undefined\"!=typeof Uint8Array&&\"undefined\"!=typeof Uint16Array&&\"undefined\"!=typeof Int32Array;c.assign=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if(\"object\"!=typeof c)throw new TypeError(c+\"must be non-object\");for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}}return a},c.shrinkBuf=function(a,b){return a.length===b?a:a.subarray?a.subarray(0,b):(a.length=b,a)};var e={arraySet:function(a,b,c,d,e){if(b.subarray&&a.subarray)return void a.set(b.subarray(c,c+d),e);for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){var b,c,d,e,f,g;for(d=0,b=0,c=a.length;b<c;b++)d+=a[b].length;for(g=new Uint8Array(d),e=0,b=0,c=a.length;b<c;b++)f=a[b],g.set(f,e),e+=f.length;return g}},f={arraySet:function(a,b,c,d,e){for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,e)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,f))},c.setTyped(d)},{}],63:[function(a,b,c){\"use strict\";function d(a,b){if(b<65537&&(a.subarray&&g||!a.subarray&&f))return String.fromCharCode.apply(null,e.shrinkBuf(a,b));for(var c=\"\",d=0;d<b;d++)c+=String.fromCharCode(a[d]);return c}var e=a(\"./common\"),f=!0,g=!0;try{String.fromCharCode.apply(null,[0])}catch(h){f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(h){g=!1}for(var i=new e.Buf8(256),j=0;j<256;j++)i[j]=j>=252?6:j>=248?5:j>=240?4:j>=224?3:j>=192?2:1;i[254]=i[254]=1,c.string2buf=function(a){var b,c,d,f,g,h=a.length,i=0;for(f=0;f<h;f++)c=a.charCodeAt(f),55296===(64512&c)&&f+1<h&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),i+=c<128?1:c<2048?2:c<65536?3:4;for(b=new e.Buf8(i),g=0,f=0;g<i;f++)c=a.charCodeAt(f),55296===(64512&c)&&f+1<h&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),c<128?b[g++]=c:c<2048?(b[g++]=192|c>>>6,b[g++]=128|63&c):c<65536?(b[g++]=224|c>>>12,b[g++]=128|c>>>6&63,b[g++]=128|63&c):(b[g++]=240|c>>>18,b[g++]=128|c>>>12&63,b[g++]=128|c>>>6&63,b[g++]=128|63&c);return b},c.buf2binstring=function(a){return d(a,a.length)},c.binstring2buf=function(a){for(var b=new e.Buf8(a.length),c=0,d=b.length;c<d;c++)b[c]=a.charCodeAt(c);return b},c.buf2string=function(a,b){var c,e,f,g,h=b||a.length,j=new Array(2*h);for(e=0,c=0;c<h;)if(f=a[c++],f<128)j[e++]=f;else if(g=i[f],g>4)j[e++]=65533,c+=g-1;else{for(f&=2===g?31:3===g?15:7;g>1&&c<h;)f=f<<6|63&a[c++],g--;g>1?j[e++]=65533:f<65536?j[e++]=f:(f-=65536,j[e++]=55296|f>>10&1023,j[e++]=56320|1023&f)}return d(j,e)},c.utf8border=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return c<0?b:0===c?b:c+i[a[c]]>b?c:b}},{\"./common\":62}],64:[function(a,b,c){\"use strict\";function d(a,b,c,d){for(var e=65535&a|0,f=a>>>16&65535|0,g=0;0!==c;){g=c>2e3?2e3:c,c-=g;do e=e+b[d++]|0,f=f+e|0;while(--g);e%=65521,f%=65521}return e|f<<16|0}b.exports=d},{}],65:[function(a,b,c){\"use strict\";b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],66:[function(a,b,c){\"use strict\";function d(){\nfor(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function e(a,b,c,d){var e=f,g=d+c;a^=-1;for(var h=d;h<g;h++)a=a>>>8^e[255&(a^b[h])];return a^-1}var f=d();b.exports=e},{}],67:[function(a,b,c){\"use strict\";function d(a,b){return a.msg=I[b],b}function e(a){return(a<<1)-(a>4?9:0)}function f(a){for(var b=a.length;--b>=0;)a[b]=0}function g(a){var b=a.state,c=b.pending;c>a.avail_out&&(c=a.avail_out),0!==c&&(E.arraySet(a.output,b.pending_buf,b.pending_out,c,a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))}function h(a,b){F._tr_flush_block(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,b),a.block_start=a.strstart,g(a.strm)}function i(a,b){a.pending_buf[a.pending++]=b}function j(a,b){a.pending_buf[a.pending++]=b>>>8&255,a.pending_buf[a.pending++]=255&b}function k(a,b,c,d){var e=a.avail_in;return e>d&&(e=d),0===e?0:(a.avail_in-=e,E.arraySet(b,a.input,a.next_in,e,c),1===a.state.wrap?a.adler=G(a.adler,b,e,c):2===a.state.wrap&&(a.adler=H(a.adler,b,e,c)),a.next_in+=e,a.total_in+=e,e)}function l(a,b){var c,d,e=a.max_chain_length,f=a.strstart,g=a.prev_length,h=a.nice_match,i=a.strstart>a.w_size-la?a.strstart-(a.w_size-la):0,j=a.window,k=a.w_mask,l=a.prev,m=a.strstart+ka,n=j[f+g-1],o=j[f+g];a.prev_length>=a.good_match&&(e>>=2),h>a.lookahead&&(h=a.lookahead);do if(c=b,j[c+g]===o&&j[c+g-1]===n&&j[c]===j[f]&&j[++c]===j[f+1]){f+=2,c++;do;while(j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&f<m);if(d=ka-(m-f),f=m-ka,d>g){if(a.match_start=b,g=d,d>=h)break;n=j[f+g-1],o=j[f+g]}}while((b=l[b&k])>i&&0!==--e);return g<=a.lookahead?g:a.lookahead}function m(a){var b,c,d,e,f,g=a.w_size;do{if(e=a.window_size-a.lookahead-a.strstart,a.strstart>=g+(g-la)){E.arraySet(a.window,a.window,g,g,0),a.match_start-=g,a.strstart-=g,a.block_start-=g,c=a.hash_size,b=c;do d=a.head[--b],a.head[b]=d>=g?d-g:0;while(--c);c=g,b=c;do d=a.prev[--b],a.prev[b]=d>=g?d-g:0;while(--c);e+=g}if(0===a.strm.avail_in)break;if(c=k(a.strm,a.window,a.strstart+a.lookahead,e),a.lookahead+=c,a.lookahead+a.insert>=ja)for(f=a.strstart-a.insert,a.ins_h=a.window[f],a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+ja-1])&a.hash_mask,a.prev[f&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=f,f++,a.insert--,!(a.lookahead+a.insert<ja)););}while(a.lookahead<la&&0!==a.strm.avail_in)}function n(a,b){var c=65535;for(c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);;){if(a.lookahead<=1){if(m(a),0===a.lookahead&&b===J)return ua;if(0===a.lookahead)break}a.strstart+=a.lookahead,a.lookahead=0;var d=a.block_start+c;if((0===a.strstart||a.strstart>=d)&&(a.lookahead=a.strstart-d,a.strstart=d,h(a,!1),0===a.strm.avail_out))return ua;if(a.strstart-a.block_start>=a.w_size-la&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.strstart>a.block_start&&(h(a,!1),0===a.strm.avail_out)?ua:ua}function o(a,b){for(var c,d;;){if(a.lookahead<la){if(m(a),a.lookahead<la&&b===J)return ua;if(0===a.lookahead)break}if(c=0,a.lookahead>=ja&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==c&&a.strstart-c<=a.w_size-la&&(a.match_length=l(a,c)),a.match_length>=ja)if(d=F._tr_tally(a,a.strstart-a.match_start,a.match_length-ja),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=ja){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!==--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else d=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(d&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=a.strstart<ja-1?a.strstart:ja-1,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function p(a,b){for(var c,d,e;;){if(a.lookahead<la){if(m(a),a.lookahead<la&&b===J)return ua;if(0===a.lookahead)break}if(c=0,a.lookahead>=ja&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=ja-1,0!==c&&a.prev_length<a.max_lazy_match&&a.strstart-c<=a.w_size-la&&(a.match_length=l(a,c),a.match_length<=5&&(a.strategy===U||a.match_length===ja&&a.strstart-a.match_start>4096)&&(a.match_length=ja-1)),a.prev_length>=ja&&a.match_length<=a.prev_length){e=a.strstart+a.lookahead-ja,d=F._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-ja),a.lookahead-=a.prev_length-1,a.prev_length-=2;do++a.strstart<=e&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(0!==--a.prev_length);if(a.match_available=0,a.match_length=ja-1,a.strstart++,d&&(h(a,!1),0===a.strm.avail_out))return ua}else if(a.match_available){if(d=F._tr_tally(a,0,a.window[a.strstart-1]),d&&h(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return ua}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(d=F._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<ja-1?a.strstart:ja-1,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function q(a,b){for(var c,d,e,f,g=a.window;;){if(a.lookahead<=ka){if(m(a),a.lookahead<=ka&&b===J)return ua;if(0===a.lookahead)break}if(a.match_length=0,a.lookahead>=ja&&a.strstart>0&&(e=a.strstart-1,d=g[e],d===g[++e]&&d===g[++e]&&d===g[++e])){f=a.strstart+ka;do;while(d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&e<f);a.match_length=ka-(f-e),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=ja?(c=F._tr_tally(a,1,a.match_length-ja),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),c&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function r(a,b){for(var c;;){if(0===a.lookahead&&(m(a),0===a.lookahead)){if(b===J)return ua;break}if(a.match_length=0,c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,c&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function s(a,b,c,d,e){this.good_length=a,this.max_lazy=b,this.nice_length=c,this.max_chain=d,this.func=e}function t(a){a.window_size=2*a.w_size,f(a.head),a.max_lazy_match=D[a.level].max_lazy,a.good_match=D[a.level].good_length,a.nice_match=D[a.level].nice_length,a.max_chain_length=D[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=ja-1,a.match_available=0,a.ins_h=0}function u(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new E.Buf16(2*ha),this.dyn_dtree=new E.Buf16(2*(2*fa+1)),this.bl_tree=new E.Buf16(2*(2*ga+1)),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new E.Buf16(ia+1),this.heap=new E.Buf16(2*ea+1),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new E.Buf16(2*ea+1),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function v(a){var b;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=Z,b=a.state,b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?na:sa,a.adler=2===b.wrap?0:1,b.last_flush=J,F._tr_init(b),O):d(a,Q)}function w(a){var b=v(a);return b===O&&t(a.state),b}function x(a,b){return a&&a.state?2!==a.state.wrap?Q:(a.state.gzhead=b,O):Q}function y(a,b,c,e,f,g){if(!a)return Q;var h=1;if(b===T&&(b=6),e<0?(h=0,e=-e):e>15&&(h=2,e-=16),f<1||f>_||c!==$||e<8||e>15||b<0||b>9||g<0||g>X)return d(a,Q);8===e&&(e=9);var i=new u;return a.state=i,i.strm=a,i.wrap=h,i.gzhead=null,i.w_bits=e,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=f+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+ja-1)/ja),i.window=new E.Buf8(2*i.w_size),i.head=new E.Buf16(i.hash_size),i.prev=new E.Buf16(i.w_size),i.lit_bufsize=1<<f+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new E.Buf8(i.pending_buf_size),i.d_buf=1*i.lit_bufsize,i.l_buf=3*i.lit_bufsize,i.level=b,i.strategy=g,i.method=c,w(a)}function z(a,b){return y(a,b,$,aa,ba,Y)}function A(a,b){var c,h,k,l;if(!a||!a.state||b>N||b<0)return a?d(a,Q):Q;if(h=a.state,!a.output||!a.input&&0!==a.avail_in||h.status===ta&&b!==M)return d(a,0===a.avail_out?S:Q);if(h.strm=a,c=h.last_flush,h.last_flush=b,h.status===na)if(2===h.wrap)a.adler=0,i(h,31),i(h,139),i(h,8),h.gzhead?(i(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),i(h,255&h.gzhead.time),i(h,h.gzhead.time>>8&255),i(h,h.gzhead.time>>16&255),i(h,h.gzhead.time>>24&255),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,255&h.gzhead.os),h.gzhead.extra&&h.gzhead.extra.length&&(i(h,255&h.gzhead.extra.length),i(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(a.adler=H(a.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=oa):(i(h,0),i(h,0),i(h,0),i(h,0),i(h,0),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,ya),h.status=sa);else{var m=$+(h.w_bits-8<<4)<<8,n=-1;n=h.strategy>=V||h.level<2?0:h.level<6?1:6===h.level?2:3,m|=n<<6,0!==h.strstart&&(m|=ma),m+=31-m%31,h.status=sa,j(h,m),0!==h.strstart&&(j(h,a.adler>>>16),j(h,65535&a.adler)),a.adler=1}if(h.status===oa)if(h.gzhead.extra){for(k=h.pending;h.gzindex<(65535&h.gzhead.extra.length)&&(h.pending!==h.pending_buf_size||(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending!==h.pending_buf_size));)i(h,255&h.gzhead.extra[h.gzindex]),h.gzindex++;h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),h.gzindex===h.gzhead.extra.length&&(h.gzindex=0,h.status=pa)}else h.status=pa;if(h.status===pa)if(h.gzhead.name){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.name.length?255&h.gzhead.name.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.gzindex=0,h.status=qa)}else h.status=qa;if(h.status===qa)if(h.gzhead.comment){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.comment.length?255&h.gzhead.comment.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.status=ra)}else h.status=ra;if(h.status===ra&&(h.gzhead.hcrc?(h.pending+2>h.pending_buf_size&&g(a),h.pending+2<=h.pending_buf_size&&(i(h,255&a.adler),i(h,a.adler>>8&255),a.adler=0,h.status=sa)):h.status=sa),0!==h.pending){if(g(a),0===a.avail_out)return h.last_flush=-1,O}else if(0===a.avail_in&&e(b)<=e(c)&&b!==M)return d(a,S);if(h.status===ta&&0!==a.avail_in)return d(a,S);if(0!==a.avail_in||0!==h.lookahead||b!==J&&h.status!==ta){var o=h.strategy===V?r(h,b):h.strategy===W?q(h,b):D[h.level].func(h,b);if(o!==wa&&o!==xa||(h.status=ta),o===ua||o===wa)return 0===a.avail_out&&(h.last_flush=-1),O;if(o===va&&(b===K?F._tr_align(h):b!==N&&(F._tr_stored_block(h,0,0,!1),b===L&&(f(h.head),0===h.lookahead&&(h.strstart=0,h.block_start=0,h.insert=0))),g(a),0===a.avail_out))return h.last_flush=-1,O}return b!==M?O:h.wrap<=0?P:(2===h.wrap?(i(h,255&a.adler),i(h,a.adler>>8&255),i(h,a.adler>>16&255),i(h,a.adler>>24&255),i(h,255&a.total_in),i(h,a.total_in>>8&255),i(h,a.total_in>>16&255),i(h,a.total_in>>24&255)):(j(h,a.adler>>>16),j(h,65535&a.adler)),g(a),h.wrap>0&&(h.wrap=-h.wrap),0!==h.pending?O:P)}function B(a){var b;return a&&a.state?(b=a.state.status,b!==na&&b!==oa&&b!==pa&&b!==qa&&b!==ra&&b!==sa&&b!==ta?d(a,Q):(a.state=null,b===sa?d(a,R):O)):Q}function C(a,b){var c,d,e,g,h,i,j,k,l=b.length;if(!a||!a.state)return Q;if(c=a.state,g=c.wrap,2===g||1===g&&c.status!==na||c.lookahead)return Q;for(1===g&&(a.adler=G(a.adler,b,l,0)),c.wrap=0,l>=c.w_size&&(0===g&&(f(c.head),c.strstart=0,c.block_start=0,c.insert=0),k=new E.Buf8(c.w_size),E.arraySet(k,b,l-c.w_size,c.w_size,0),b=k,l=c.w_size),h=a.avail_in,i=a.next_in,j=a.input,a.avail_in=l,a.next_in=0,a.input=b,m(c);c.lookahead>=ja;){d=c.strstart,e=c.lookahead-(ja-1);do c.ins_h=(c.ins_h<<c.hash_shift^c.window[d+ja-1])&c.hash_mask,c.prev[d&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=d,d++;while(--e);c.strstart=d,c.lookahead=ja-1,m(c)}return c.strstart+=c.lookahead,c.block_start=c.strstart,c.insert=c.lookahead,c.lookahead=0,c.match_length=c.prev_length=ja-1,c.match_available=0,a.next_in=i,a.input=j,a.avail_in=h,c.wrap=g,O}var D,E=a(\"../utils/common\"),F=a(\"./trees\"),G=a(\"./adler32\"),H=a(\"./crc32\"),I=a(\"./messages\"),J=0,K=1,L=3,M=4,N=5,O=0,P=1,Q=-2,R=-3,S=-5,T=-1,U=1,V=2,W=3,X=4,Y=0,Z=2,$=8,_=9,aa=15,ba=8,ca=29,da=256,ea=da+1+ca,fa=30,ga=19,ha=2*ea+1,ia=15,ja=3,ka=258,la=ka+ja+1,ma=32,na=42,oa=69,pa=73,qa=91,ra=103,sa=113,ta=666,ua=1,va=2,wa=3,xa=4,ya=3;D=[new s(0,0,0,0,n),new s(4,4,8,4,o),new s(4,5,16,8,o),new s(4,6,32,32,o),new s(4,4,16,16,p),new s(8,16,32,32,p),new s(8,16,128,128,p),new s(8,32,128,256,p),new s(32,128,258,1024,p),new s(32,258,258,4096,p)],c.deflateInit=z,c.deflateInit2=y,c.deflateReset=w,c.deflateResetKeep=v,c.deflateSetHeader=x,c.deflate=A,c.deflateEnd=B,c.deflateSetDictionary=C,c.deflateInfo=\"pako deflate (from Nodeca project)\"},{\"../utils/common\":62,\"./adler32\":64,\"./crc32\":66,\"./messages\":72,\"./trees\":73}],68:[function(a,b,c){\"use strict\";function d(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name=\"\",this.comment=\"\",this.hcrc=0,this.done=!1}b.exports=d},{}],69:[function(a,b,c){\"use strict\";var d=30,e=12;b.exports=function(a,b){var c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;c=a.state,f=a.next_in,B=a.input,g=f+(a.avail_in-5),h=a.next_out,C=a.output,i=h-(b-a.avail_out),j=h+(a.avail_out-257),k=c.dmax,l=c.wsize,m=c.whave,n=c.wnext,o=c.window,p=c.hold,q=c.bits,r=c.lencode,s=c.distcode,t=(1<<c.lenbits)-1,u=(1<<c.distbits)-1;a:do{q<15&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=r[p&t];b:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,0===w)C[h++]=65535&v;else{if(!(16&w)){if(0===(64&w)){v=r[(65535&v)+(p&(1<<w)-1)];continue b}if(32&w){c.mode=e;break a}a.msg=\"invalid literal/length code\",c.mode=d;break a}x=65535&v,w&=15,w&&(q<w&&(p+=B[f++]<<q,q+=8),x+=p&(1<<w)-1,p>>>=w,q-=w),q<15&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=s[p&u];c:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,!(16&w)){if(0===(64&w)){v=s[(65535&v)+(p&(1<<w)-1)];continue c}a.msg=\"invalid distance code\",c.mode=d;break a}if(y=65535&v,w&=15,q<w&&(p+=B[f++]<<q,q+=8,q<w&&(p+=B[f++]<<q,q+=8)),y+=p&(1<<w)-1,y>k){a.msg=\"invalid distance too far back\",c.mode=d;break a}if(p>>>=w,q-=w,w=h-i,y>w){if(w=y-w,w>m&&c.sane){a.msg=\"invalid distance too far back\",c.mode=d;break a}if(z=0,A=o,0===n){if(z+=l-w,w<x){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}else if(n<w){if(z+=l+n-w,w-=n,w<x){x-=w;do C[h++]=o[z++];while(--w);if(z=0,n<x){w=n,x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}}else if(z+=n-w,w<x){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}for(;x>2;)C[h++]=A[z++],C[h++]=A[z++],C[h++]=A[z++],x-=3;x&&(C[h++]=A[z++],x>1&&(C[h++]=A[z++]))}else{z=h-y;do C[h++]=C[z++],C[h++]=C[z++],C[h++]=C[z++],x-=3;while(x>2);x&&(C[h++]=C[z++],x>1&&(C[h++]=C[z++]))}break}}break}}while(f<g&&h<j);x=q>>3,f-=x,q-=x<<3,p&=(1<<q)-1,a.next_in=f,a.next_out=h,a.avail_in=f<g?5+(g-f):5-(f-g),a.avail_out=h<j?257+(j-h):257-(h-j),c.hold=p,c.bits=q}},{}],70:[function(a,b,c){\"use strict\";function d(a){return(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)}function e(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(a){var b;return a&&a.state?(b=a.state,a.total_in=a.total_out=b.total=0,a.msg=\"\",b.wrap&&(a.adler=1&b.wrap),b.mode=L,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new s.Buf32(pa),b.distcode=b.distdyn=new s.Buf32(qa),b.sane=1,b.back=-1,D):G}function g(a){var b;return a&&a.state?(b=a.state,b.wsize=0,b.whave=0,b.wnext=0,f(a)):G}function h(a,b){var c,d;return a&&a.state?(d=a.state,b<0?(c=0,b=-b):(c=(b>>4)+1,b<48&&(b&=15)),b&&(b<8||b>15)?G:(null!==d.window&&d.wbits!==b&&(d.window=null),d.wrap=c,d.wbits=b,g(a))):G}function i(a,b){var c,d;return a?(d=new e,a.state=d,d.window=null,c=h(a,b),c!==D&&(a.state=null),c):G}function j(a){return i(a,sa)}function k(a){if(ta){var b;for(q=new s.Buf32(512),r=new s.Buf32(32),b=0;b<144;)a.lens[b++]=8;for(;b<256;)a.lens[b++]=9;for(;b<280;)a.lens[b++]=7;for(;b<288;)a.lens[b++]=8;for(w(y,a.lens,0,288,q,0,a.work,{bits:9}),b=0;b<32;)a.lens[b++]=5;w(z,a.lens,0,32,r,0,a.work,{bits:5}),ta=!1}a.lencode=q,a.lenbits=9,a.distcode=r,a.distbits=5}function l(a,b,c,d){var e,f=a.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new s.Buf8(f.wsize)),d>=f.wsize?(s.arraySet(f.window,b,c-f.wsize,f.wsize,0),f.wnext=0,f.whave=f.wsize):(e=f.wsize-f.wnext,e>d&&(e=d),s.arraySet(f.window,b,c-d,e,f.wnext),d-=e,d?(s.arraySet(f.window,b,c-d,d,0),f.wnext=d,f.whave=f.wsize):(f.wnext+=e,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=e))),0}function m(a,b){var c,e,f,g,h,i,j,m,n,o,p,q,r,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa=0,Ba=new s.Buf8(4),Ca=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return G;c=a.state,c.mode===W&&(c.mode=X),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,o=i,p=j,xa=D;a:for(;;)switch(c.mode){case L:if(0===c.wrap){c.mode=X;break}for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(2&c.wrap&&35615===m){c.check=0,Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0),m=0,n=0,c.mode=M;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&m)<<8)+(m>>8))%31){a.msg=\"incorrect header check\",c.mode=ma;break}if((15&m)!==K){a.msg=\"unknown compression method\",c.mode=ma;break}if(m>>>=4,n-=4,wa=(15&m)+8,0===c.wbits)c.wbits=wa;else if(wa>c.wbits){a.msg=\"invalid window size\",c.mode=ma;break}c.dmax=1<<wa,a.adler=c.check=1,c.mode=512&m?U:W,m=0,n=0;break;case M:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.flags=m,(255&c.flags)!==K){a.msg=\"unknown compression method\",c.mode=ma;break}if(57344&c.flags){a.msg=\"unknown header flags set\",c.mode=ma;break}c.head&&(c.head.text=m>>8&1),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=N;case N:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.time=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,Ba[2]=m>>>16&255,Ba[3]=m>>>24&255,c.check=u(c.check,Ba,4,0)),m=0,n=0,c.mode=O;case O:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.xflags=255&m,c.head.os=m>>8),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=P;case P:if(1024&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length=m,c.head&&(c.head.extra_len=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0}else c.head&&(c.head.extra=null);c.mode=Q;case Q:if(1024&c.flags&&(q=c.length,q>i&&(q=i),q&&(c.head&&(wa=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),s.arraySet(c.head.extra,e,g,q,wa)),512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,c.length-=q),c.length))break a;c.length=0,c.mode=R;case R:if(2048&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.name+=String.fromCharCode(wa));while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.name=null);c.length=0,c.mode=S;case S:if(4096&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.comment+=String.fromCharCode(wa));while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.comment=null);c.mode=T;case T:if(512&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(65535&c.check)){a.msg=\"header crc mismatch\",c.mode=ma;break}m=0,n=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),a.adler=c.check=0,c.mode=W;break;case U:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}a.adler=c.check=d(m),m=0,n=0,c.mode=V;case V:if(0===c.havedict)return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,F;a.adler=c.check=1,c.mode=W;case W:if(b===B||b===C)break a;case X:if(c.last){m>>>=7&n,n-=7&n,c.mode=ja;break}for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}switch(c.last=1&m,m>>>=1,n-=1,3&m){case 0:c.mode=Y;break;case 1:if(k(c),c.mode=ca,b===C){m>>>=2,n-=2;break a}break;case 2:c.mode=_;break;case 3:a.msg=\"invalid block type\",c.mode=ma}m>>>=2,n-=2;break;case Y:for(m>>>=7&n,n-=7&n;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if((65535&m)!==(m>>>16^65535)){a.msg=\"invalid stored block lengths\",c.mode=ma;break}if(c.length=65535&m,m=0,n=0,c.mode=Z,b===C)break a;case Z:c.mode=$;case $:if(q=c.length){if(q>i&&(q=i),q>j&&(q=j),0===q)break a;s.arraySet(f,e,g,q,h),i-=q,g+=q,j-=q,h+=q,c.length-=q;break}c.mode=W;break;case _:for(;n<14;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.nlen=(31&m)+257,m>>>=5,n-=5,c.ndist=(31&m)+1,m>>>=5,n-=5,c.ncode=(15&m)+4,m>>>=4,n-=4,c.nlen>286||c.ndist>30){a.msg=\"too many length or distance symbols\",c.mode=ma;break}c.have=0,c.mode=aa;case aa:for(;c.have<c.ncode;){for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.lens[Ca[c.have++]]=7&m,m>>>=3,n-=3}for(;c.have<19;)c.lens[Ca[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,ya={bits:c.lenbits},xa=w(x,c.lens,0,19,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg=\"invalid code lengths set\",c.mode=ma;break}c.have=0,c.mode=ba;case ba:for(;c.have<c.nlen+c.ndist;){for(;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(sa<16)m>>>=qa,n-=qa,c.lens[c.have++]=sa;else{if(16===sa){for(za=qa+2;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m>>>=qa,n-=qa,0===c.have){a.msg=\"invalid bit length repeat\",c.mode=ma;break}wa=c.lens[c.have-1],q=3+(3&m),m>>>=2,n-=2}else if(17===sa){for(za=qa+3;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=3+(7&m),m>>>=3,n-=3}else{for(za=qa+7;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=11+(127&m),m>>>=7,n-=7}if(c.have+q>c.nlen+c.ndist){a.msg=\"invalid bit length repeat\",c.mode=ma;break}for(;q--;)c.lens[c.have++]=wa}}if(c.mode===ma)break;if(0===c.lens[256]){a.msg=\"invalid code -- missing end-of-block\",c.mode=ma;break}if(c.lenbits=9,ya={bits:c.lenbits},xa=w(y,c.lens,0,c.nlen,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg=\"invalid literal/lengths set\",c.mode=ma;break}if(c.distbits=6,c.distcode=c.distdyn,ya={bits:c.distbits},xa=w(z,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,ya),c.distbits=ya.bits,xa){a.msg=\"invalid distances set\",c.mode=ma;break}if(c.mode=ca,b===C)break a;case ca:c.mode=da;case da:if(i>=6&&j>=258){a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,v(a,p),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,c.mode===W&&(c.back=-1);break}for(c.back=0;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(ra&&0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.lencode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,c.length=sa,0===ra){c.mode=ia;break}if(32&ra){c.back=-1,c.mode=W;break}if(64&ra){a.msg=\"invalid literal/length code\",c.mode=ma;break}c.extra=15&ra,c.mode=ea;case ea:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=fa;case fa:for(;Aa=c.distcode[m&(1<<c.distbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.distcode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,64&ra){a.msg=\"invalid distance code\",c.mode=ma;break}c.offset=sa,c.extra=15&ra,c.mode=ga;case ga:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.offset+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){a.msg=\"invalid distance too far back\",c.mode=ma;break}c.mode=ha;case ha:if(0===j)break a;if(q=p-j,c.offset>q){if(q=c.offset-q,q>c.whave&&c.sane){a.msg=\"invalid distance too far back\",c.mode=ma;break}q>c.wnext?(q-=c.wnext,r=c.wsize-q):r=c.wnext-q,q>c.length&&(q=c.length),pa=c.window}else pa=f,r=h-c.offset,q=c.length;q>j&&(q=j),j-=q,c.length-=q;do f[h++]=pa[r++];while(--q);0===c.length&&(c.mode=da);break;case ia:if(0===j)break a;f[h++]=c.length,j--,c.mode=da;break;case ja:if(c.wrap){for(;n<32;){if(0===i)break a;i--,m|=e[g++]<<n,n+=8}if(p-=j,a.total_out+=p,c.total+=p,p&&(a.adler=c.check=c.flags?u(c.check,f,p,h-p):t(c.check,f,p,h-p)),p=j,(c.flags?m:d(m))!==c.check){a.msg=\"incorrect data check\",c.mode=ma;break}m=0,n=0}c.mode=ka;case ka:if(c.wrap&&c.flags){for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(4294967295&c.total)){a.msg=\"incorrect length check\",c.mode=ma;break}m=0,n=0}c.mode=la;case la:xa=E;break a;case ma:xa=H;break a;case na:return I;case oa:default:return G}return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,(c.wsize||p!==a.avail_out&&c.mode<ma&&(c.mode<ja||b!==A))&&l(a,a.output,a.next_out,p-a.avail_out)?(c.mode=na,I):(o-=a.avail_in,p-=a.avail_out,a.total_in+=o,a.total_out+=p,c.total+=p,c.wrap&&p&&(a.adler=c.check=c.flags?u(c.check,f,p,a.next_out-p):t(c.check,f,p,a.next_out-p)),a.data_type=c.bits+(c.last?64:0)+(c.mode===W?128:0)+(c.mode===ca||c.mode===Z?256:0),(0===o&&0===p||b===A)&&xa===D&&(xa=J),xa)}function n(a){if(!a||!a.state)return G;var b=a.state;return b.window&&(b.window=null),a.state=null,D}function o(a,b){var c;return a&&a.state?(c=a.state,0===(2&c.wrap)?G:(c.head=b,b.done=!1,D)):G}function p(a,b){var c,d,e,f=b.length;return a&&a.state?(c=a.state,0!==c.wrap&&c.mode!==V?G:c.mode===V&&(d=1,d=t(d,b,f,0),d!==c.check)?H:(e=l(a,b,f,f))?(c.mode=na,I):(c.havedict=1,D)):G}var q,r,s=a(\"../utils/common\"),t=a(\"./adler32\"),u=a(\"./crc32\"),v=a(\"./inffast\"),w=a(\"./inftrees\"),x=0,y=1,z=2,A=4,B=5,C=6,D=0,E=1,F=2,G=-2,H=-3,I=-4,J=-5,K=8,L=1,M=2,N=3,O=4,P=5,Q=6,R=7,S=8,T=9,U=10,V=11,W=12,X=13,Y=14,Z=15,$=16,_=17,aa=18,ba=19,ca=20,da=21,ea=22,fa=23,ga=24,ha=25,ia=26,ja=27,ka=28,la=29,ma=30,na=31,oa=32,pa=852,qa=592,ra=15,sa=ra,ta=!0;c.inflateReset=g,c.inflateReset2=h,c.inflateResetKeep=f,c.inflateInit=j,c.inflateInit2=i,c.inflate=m,c.inflateEnd=n,c.inflateGetHeader=o,c.inflateSetDictionary=p,c.inflateInfo=\"pako inflate (from Nodeca project)\"},{\"../utils/common\":62,\"./adler32\":64,\"./crc32\":66,\"./inffast\":69,\"./inftrees\":71}],71:[function(a,b,c){\"use strict\";var d=a(\"../utils/common\"),e=15,f=852,g=592,h=0,i=1,j=2,k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],m=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],n=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];b.exports=function(a,b,c,o,p,q,r,s){var t,u,v,w,x,y,z,A,B,C=s.bits,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=null,O=0,P=new d.Buf16(e+1),Q=new d.Buf16(e+1),R=null,S=0;for(D=0;D<=e;D++)P[D]=0;for(E=0;E<o;E++)P[b[c+E]]++;for(H=C,G=e;G>=1&&0===P[G];G--);if(H>G&&(H=G),0===G)return p[q++]=20971520,p[q++]=20971520,s.bits=1,0;for(F=1;F<G&&0===P[F];F++);for(H<F&&(H=F),K=1,D=1;D<=e;D++)if(K<<=1,K-=P[D],K<0)return-1;if(K>0&&(a===h||1!==G))return-1;for(Q[1]=0,D=1;D<e;D++)Q[D+1]=Q[D]+P[D];for(E=0;E<o;E++)0!==b[c+E]&&(r[Q[b[c+E]]++]=E);if(a===h?(N=R=r,y=19):a===i?(N=k,O-=257,R=l,S-=257,y=256):(N=m,R=n,y=-1),M=0,E=0,D=F,x=q,I=H,J=0,v=-1,L=1<<H,w=L-1,a===i&&L>f||a===j&&L>g)return 1;for(var T=0;;){T++,z=D-J,r[E]<y?(A=0,B=r[E]):r[E]>y?(A=R[S+r[E]],B=N[O+r[E]]):(A=96,B=0),t=1<<D-J,u=1<<I,F=u;do u-=t,p[x+(M>>J)+u]=z<<24|A<<16|B|0;while(0!==u);for(t=1<<D-1;M&t;)t>>=1;if(0!==t?(M&=t-1,M+=t):M=0,E++,0===--P[D]){if(D===G)break;D=b[c+r[E]]}if(D>H&&(M&w)!==v){for(0===J&&(J=H),x+=F,I=D-J,K=1<<I;I+J<G&&(K-=P[I+J],!(K<=0));)I++,K<<=1;if(L+=1<<I,a===i&&L>f||a===j&&L>g)return 1;v=M&w,p[v]=H<<24|I<<16|x-q|0}}return 0!==M&&(p[x+M]=D-J<<24|64<<16|0),s.bits=H,0}},{\"../utils/common\":62}],72:[function(a,b,c){\"use strict\";b.exports={2:\"need dictionary\",1:\"stream end\",0:\"\",\"-1\":\"file error\",\"-2\":\"stream error\",\"-3\":\"data error\",\"-4\":\"insufficient memory\",\"-5\":\"buffer error\",\"-6\":\"incompatible version\"}},{}],73:[function(a,b,c){\"use strict\";function d(a){for(var b=a.length;--b>=0;)a[b]=0}function e(a,b,c,d,e){this.static_tree=a,this.extra_bits=b,this.extra_base=c,this.elems=d,this.max_length=e,this.has_stree=a&&a.length}function f(a,b){this.dyn_tree=a,this.max_code=0,this.stat_desc=b}function g(a){return a<256?ia[a]:ia[256+(a>>>7)]}function h(a,b){a.pending_buf[a.pending++]=255&b,a.pending_buf[a.pending++]=b>>>8&255}function i(a,b,c){a.bi_valid>X-c?(a.bi_buf|=b<<a.bi_valid&65535,h(a,a.bi_buf),a.bi_buf=b>>X-a.bi_valid,a.bi_valid+=c-X):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function j(a,b,c){i(a,c[2*b],c[2*b+1])}function k(a,b){var c=0;do c|=1&a,a>>>=1,c<<=1;while(--b>0);return c>>>1}function l(a){16===a.bi_valid?(h(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)}function m(a,b){var c,d,e,f,g,h,i=b.dyn_tree,j=b.max_code,k=b.stat_desc.static_tree,l=b.stat_desc.has_stree,m=b.stat_desc.extra_bits,n=b.stat_desc.extra_base,o=b.stat_desc.max_length,p=0;for(f=0;f<=W;f++)a.bl_count[f]=0;for(i[2*a.heap[a.heap_max]+1]=0,c=a.heap_max+1;c<V;c++)d=a.heap[c],f=i[2*i[2*d+1]+1]+1,f>o&&(f=o,p++),i[2*d+1]=f,d>j||(a.bl_count[f]++,g=0,d>=n&&(g=m[d-n]),h=i[2*d],a.opt_len+=h*(f+g),l&&(a.static_len+=h*(k[2*d+1]+g)));if(0!==p){do{for(f=o-1;0===a.bl_count[f];)f--;a.bl_count[f]--,a.bl_count[f+1]+=2,a.bl_count[o]--,p-=2}while(p>0);for(f=o;0!==f;f--)for(d=a.bl_count[f];0!==d;)e=a.heap[--c],e>j||(i[2*e+1]!==f&&(a.opt_len+=(f-i[2*e+1])*i[2*e],i[2*e+1]=f),d--)}}function n(a,b,c){var d,e,f=new Array(W+1),g=0;\nfor(d=1;d<=W;d++)f[d]=g=g+c[d-1]<<1;for(e=0;e<=b;e++){var h=a[2*e+1];0!==h&&(a[2*e]=k(f[h]++,h))}}function o(){var a,b,c,d,f,g=new Array(W+1);for(c=0,d=0;d<Q-1;d++)for(ka[d]=c,a=0;a<1<<ba[d];a++)ja[c++]=d;for(ja[c-1]=d,f=0,d=0;d<16;d++)for(la[d]=f,a=0;a<1<<ca[d];a++)ia[f++]=d;for(f>>=7;d<T;d++)for(la[d]=f<<7,a=0;a<1<<ca[d]-7;a++)ia[256+f++]=d;for(b=0;b<=W;b++)g[b]=0;for(a=0;a<=143;)ga[2*a+1]=8,a++,g[8]++;for(;a<=255;)ga[2*a+1]=9,a++,g[9]++;for(;a<=279;)ga[2*a+1]=7,a++,g[7]++;for(;a<=287;)ga[2*a+1]=8,a++,g[8]++;for(n(ga,S+1,g),a=0;a<T;a++)ha[2*a+1]=5,ha[2*a]=k(a,5);ma=new e(ga,ba,R+1,S,W),na=new e(ha,ca,0,T,W),oa=new e(new Array(0),da,0,U,Y)}function p(a){var b;for(b=0;b<S;b++)a.dyn_ltree[2*b]=0;for(b=0;b<T;b++)a.dyn_dtree[2*b]=0;for(b=0;b<U;b++)a.bl_tree[2*b]=0;a.dyn_ltree[2*Z]=1,a.opt_len=a.static_len=0,a.last_lit=a.matches=0}function q(a){a.bi_valid>8?h(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0}function r(a,b,c,d){q(a),d&&(h(a,c),h(a,~c)),G.arraySet(a.pending_buf,a.window,b,c,a.pending),a.pending+=c}function s(a,b,c,d){var e=2*b,f=2*c;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function t(a,b,c){for(var d=a.heap[c],e=c<<1;e<=a.heap_len&&(e<a.heap_len&&s(b,a.heap[e+1],a.heap[e],a.depth)&&e++,!s(b,d,a.heap[e],a.depth));)a.heap[c]=a.heap[e],c=e,e<<=1;a.heap[c]=d}function u(a,b,c){var d,e,f,h,k=0;if(0!==a.last_lit)do d=a.pending_buf[a.d_buf+2*k]<<8|a.pending_buf[a.d_buf+2*k+1],e=a.pending_buf[a.l_buf+k],k++,0===d?j(a,e,b):(f=ja[e],j(a,f+R+1,b),h=ba[f],0!==h&&(e-=ka[f],i(a,e,h)),d--,f=g(d),j(a,f,c),h=ca[f],0!==h&&(d-=la[f],i(a,d,h)));while(k<a.last_lit);j(a,Z,b)}function v(a,b){var c,d,e,f=b.dyn_tree,g=b.stat_desc.static_tree,h=b.stat_desc.has_stree,i=b.stat_desc.elems,j=-1;for(a.heap_len=0,a.heap_max=V,c=0;c<i;c++)0!==f[2*c]?(a.heap[++a.heap_len]=j=c,a.depth[c]=0):f[2*c+1]=0;for(;a.heap_len<2;)e=a.heap[++a.heap_len]=j<2?++j:0,f[2*e]=1,a.depth[e]=0,a.opt_len--,h&&(a.static_len-=g[2*e+1]);for(b.max_code=j,c=a.heap_len>>1;c>=1;c--)t(a,f,c);e=i;do c=a.heap[1],a.heap[1]=a.heap[a.heap_len--],t(a,f,1),d=a.heap[1],a.heap[--a.heap_max]=c,a.heap[--a.heap_max]=d,f[2*e]=f[2*c]+f[2*d],a.depth[e]=(a.depth[c]>=a.depth[d]?a.depth[c]:a.depth[d])+1,f[2*c+1]=f[2*d+1]=e,a.heap[1]=e++,t(a,f,1);while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1],m(a,b),n(f,j,a.bl_count)}function w(a,b,c){var d,e,f=-1,g=b[1],h=0,i=7,j=4;for(0===g&&(i=138,j=3),b[2*(c+1)+1]=65535,d=0;d<=c;d++)e=g,g=b[2*(d+1)+1],++h<i&&e===g||(h<j?a.bl_tree[2*e]+=h:0!==e?(e!==f&&a.bl_tree[2*e]++,a.bl_tree[2*$]++):h<=10?a.bl_tree[2*_]++:a.bl_tree[2*aa]++,h=0,f=e,0===g?(i=138,j=3):e===g?(i=6,j=3):(i=7,j=4))}function x(a,b,c){var d,e,f=-1,g=b[1],h=0,k=7,l=4;for(0===g&&(k=138,l=3),d=0;d<=c;d++)if(e=g,g=b[2*(d+1)+1],!(++h<k&&e===g)){if(h<l){do j(a,e,a.bl_tree);while(0!==--h)}else 0!==e?(e!==f&&(j(a,e,a.bl_tree),h--),j(a,$,a.bl_tree),i(a,h-3,2)):h<=10?(j(a,_,a.bl_tree),i(a,h-3,3)):(j(a,aa,a.bl_tree),i(a,h-11,7));h=0,f=e,0===g?(k=138,l=3):e===g?(k=6,l=3):(k=7,l=4)}}function y(a){var b;for(w(a,a.dyn_ltree,a.l_desc.max_code),w(a,a.dyn_dtree,a.d_desc.max_code),v(a,a.bl_desc),b=U-1;b>=3&&0===a.bl_tree[2*ea[b]+1];b--);return a.opt_len+=3*(b+1)+5+5+4,b}function z(a,b,c,d){var e;for(i(a,b-257,5),i(a,c-1,5),i(a,d-4,4),e=0;e<d;e++)i(a,a.bl_tree[2*ea[e]+1],3);x(a,a.dyn_ltree,b-1),x(a,a.dyn_dtree,c-1)}function A(a){var b,c=4093624447;for(b=0;b<=31;b++,c>>>=1)if(1&c&&0!==a.dyn_ltree[2*b])return I;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return J;for(b=32;b<R;b++)if(0!==a.dyn_ltree[2*b])return J;return I}function B(a){pa||(o(),pa=!0),a.l_desc=new f(a.dyn_ltree,ma),a.d_desc=new f(a.dyn_dtree,na),a.bl_desc=new f(a.bl_tree,oa),a.bi_buf=0,a.bi_valid=0,p(a)}function C(a,b,c,d){i(a,(L<<1)+(d?1:0),3),r(a,b,c,!0)}function D(a){i(a,M<<1,3),j(a,Z,ga),l(a)}function E(a,b,c,d){var e,f,g=0;a.level>0?(a.strm.data_type===K&&(a.strm.data_type=A(a)),v(a,a.l_desc),v(a,a.d_desc),g=y(a),e=a.opt_len+3+7>>>3,f=a.static_len+3+7>>>3,f<=e&&(e=f)):e=f=c+5,c+4<=e&&b!==-1?C(a,b,c,d):a.strategy===H||f===e?(i(a,(M<<1)+(d?1:0),3),u(a,ga,ha)):(i(a,(N<<1)+(d?1:0),3),z(a,a.l_desc.max_code+1,a.d_desc.max_code+1,g+1),u(a,a.dyn_ltree,a.dyn_dtree)),p(a),d&&q(a)}function F(a,b,c){return a.pending_buf[a.d_buf+2*a.last_lit]=b>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&b,a.pending_buf[a.l_buf+a.last_lit]=255&c,a.last_lit++,0===b?a.dyn_ltree[2*c]++:(a.matches++,b--,a.dyn_ltree[2*(ja[c]+R+1)]++,a.dyn_dtree[2*g(b)]++),a.last_lit===a.lit_bufsize-1}var G=a(\"../utils/common\"),H=4,I=0,J=1,K=2,L=0,M=1,N=2,O=3,P=258,Q=29,R=256,S=R+1+Q,T=30,U=19,V=2*S+1,W=15,X=16,Y=7,Z=256,$=16,_=17,aa=18,ba=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ca=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],da=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ea=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],fa=512,ga=new Array(2*(S+2));d(ga);var ha=new Array(2*T);d(ha);var ia=new Array(fa);d(ia);var ja=new Array(P-O+1);d(ja);var ka=new Array(Q);d(ka);var la=new Array(T);d(la);var ma,na,oa,pa=!1;c._tr_init=B,c._tr_stored_block=C,c._tr_flush_block=E,c._tr_tally=F,c._tr_align=D},{\"../utils/common\":62}],74:[function(a,b,c){\"use strict\";function d(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg=\"\",this.state=null,this.data_type=2,this.adler=0}b.exports=d},{}]},{},[10])(10)});"

/***/ }),

/***/ 722:
/***/ (function(module, exports) {

module.exports = "/**\n * Compiled inline version. (Library mode)\n */\n\n/*jshint smarttabs:true, undef:true, latedef:true, curly:true, bitwise:true, camelcase:true */\n/*globals $code */\n\n(function(exports, undefined) {\n\t\"use strict\";\n\n\tvar modules = {};\n\n\tfunction require(ids, callback) {\n\t\tvar module, defs = [];\n\n\t\tfor (var i = 0; i < ids.length; ++i) {\n\t\t\tmodule = modules[ids[i]] || resolve(ids[i]);\n\t\t\tif (!module) {\n\t\t\t\tthrow 'module definition dependecy not found: ' + ids[i];\n\t\t\t}\n\n\t\t\tdefs.push(module);\n\t\t}\n\n\t\tcallback.apply(null, defs);\n\t}\n\n\tfunction define(id, dependencies, definition) {\n\t\tif (typeof id !== 'string') {\n\t\t\tthrow 'invalid module definition, module id must be defined and be a string';\n\t\t}\n\n\t\tif (dependencies === undefined) {\n\t\t\tthrow 'invalid module definition, dependencies must be specified';\n\t\t}\n\n\t\tif (definition === undefined) {\n\t\t\tthrow 'invalid module definition, definition function must be specified';\n\t\t}\n\n\t\trequire(dependencies, function() {\n\t\t\tmodules[id] = definition.apply(null, arguments);\n\t\t});\n\t}\n\n\tfunction defined(id) {\n\t\treturn !!modules[id];\n\t}\n\n\tfunction resolve(id) {\n\t\tvar target = exports;\n\t\tvar fragments = id.split(/[.\\/]/);\n\n\t\tfor (var fi = 0; fi < fragments.length; ++fi) {\n\t\t\tif (!target[fragments[fi]]) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttarget = target[fragments[fi]];\n\t\t}\n\n\t\treturn target;\n\t}\n\n\tfunction expose(ids) {\n\t\tvar i, target, id, fragments, privateModules;\n\n\t\tfor (i = 0; i < ids.length; i++) {\n\t\t\ttarget = exports;\n\t\t\tid = ids[i];\n\t\t\tfragments = id.split(/[.\\/]/);\n\n\t\t\tfor (var fi = 0; fi < fragments.length - 1; ++fi) {\n\t\t\t\tif (target[fragments[fi]] === undefined) {\n\t\t\t\t\ttarget[fragments[fi]] = {};\n\t\t\t\t}\n\n\t\t\t\ttarget = target[fragments[fi]];\n\t\t\t}\n\n\t\t\ttarget[fragments[fragments.length - 1]] = modules[id];\n\t\t}\n\n\t\t// Expose private modules for unit tests\n\t\tif (exports.AMDLC_TESTS) {\n\t\t\tprivateModules = exports.privateModules || {};\n\n\t\t\tfor (id in modules) {\n\t\t\t\tprivateModules[id] = modules[id];\n\t\t\t}\n\n\t\t\tfor (i = 0; i < ids.length; i++) {\n\t\t\t\tdelete privateModules[ids[i]];\n\t\t\t}\n\n\t\t\texports.privateModules = privateModules;\n\t\t}\n\t}\n\n// Included from: js/tinymce/plugins/paste/classes/Utils.js\n\n/**\n * Utils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contails various utility functions for the paste plugin.\n *\n * @class tinymce.pasteplugin.Utils\n */\ndefine(\"tinymce/pasteplugin/Utils\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/html/DomParser\",\n\t\"tinymce/html/Schema\"\n], function(Tools, DomParser, Schema) {\n\tfunction filter(content, items) {\n\t\tTools.each(items, function(v) {\n\t\t\tif (v.constructor == RegExp) {\n\t\t\t\tcontent = content.replace(v, '');\n\t\t\t} else {\n\t\t\t\tcontent = content.replace(v[0], v[1]);\n\t\t\t}\n\t\t});\n\n\t\treturn content;\n\t}\n\n\t/**\n\t * Gets the innerText of the specified element. It will handle edge cases\n\t * and works better than textContent on Gecko.\n\t *\n\t * @param {String} html HTML string to get text from.\n\t * @return {String} String of text with line feeds.\n\t */\n\tfunction innerText(html) {\n\t\tvar schema = new Schema(), domParser = new DomParser({}, schema), text = '';\n\t\tvar shortEndedElements = schema.getShortEndedElements();\n\t\tvar ignoreElements = Tools.makeMap('script noscript style textarea video audio iframe object', ' ');\n\t\tvar blockElements = schema.getBlockElements();\n\n\t\tfunction walk(node) {\n\t\t\tvar name = node.name, currentNode = node;\n\n\t\t\tif (name === 'br') {\n\t\t\t\ttext += '\\n';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// img/input/hr\n\t\t\tif (shortEndedElements[name]) {\n\t\t\t\ttext += ' ';\n\t\t\t}\n\n\t\t\t// Ingore script, video contents\n\t\t\tif (ignoreElements[name]) {\n\t\t\t\ttext += ' ';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (node.type == 3) {\n\t\t\t\ttext += node.value;\n\t\t\t}\n\n\t\t\t// Walk all children\n\t\t\tif (!node.shortEnded) {\n\t\t\t\tif ((node = node.firstChild)) {\n\t\t\t\t\tdo {\n\t\t\t\t\t\twalk(node);\n\t\t\t\t\t} while ((node = node.next));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Add \\n or \\n\\n for blocks or P\n\t\t\tif (blockElements[name] && currentNode.next) {\n\t\t\t\ttext += '\\n';\n\n\t\t\t\tif (name == 'p') {\n\t\t\t\t\ttext += '\\n';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\thtml = filter(html, [\n\t\t\t/<!\\[[^\\]]+\\]>/g // Conditional comments\n\t\t]);\n\n\t\twalk(domParser.parse(html));\n\n\t\treturn text;\n\t}\n\n\t/**\n\t * Trims the specified HTML by removing all WebKit fragments, all elements wrapping the body trailing BR elements etc.\n\t *\n\t * @param {String} html Html string to trim contents on.\n\t * @return {String} Html contents that got trimmed.\n\t */\n\tfunction trimHtml(html) {\n\t\tfunction trimSpaces(all, s1, s2) {\n\t\t\t// WebKit &nbsp; meant to preserve multiple spaces but instead inserted around all inline tags,\n\t\t\t// including the spans with inline styles created on paste\n\t\t\tif (!s1 && !s2) {\n\t\t\t\treturn ' ';\n\t\t\t}\n\n\t\t\treturn '\\u00a0';\n\t\t}\n\n\t\thtml = filter(html, [\n\t\t\t/^[\\s\\S]*<body[^>]*>\\s*|\\s*<\\/body[^>]*>[\\s\\S]*$/g, // Remove anything but the contents within the BODY element\n\t\t\t/<!--StartFragment-->|<!--EndFragment-->/g, // Inner fragments (tables from excel on mac)\n\t\t\t[/( ?)<span class=\"Apple-converted-space\">\\u00a0<\\/span>( ?)/g, trimSpaces],\n\t\t\t/<br class=\"Apple-interchange-newline\">/g,\n\t\t\t/<br>$/i // Trailing BR elements\n\t\t]);\n\n\t\treturn html;\n\t}\n\n\t// TODO: Should be in some global class\n\tfunction createIdGenerator(prefix) {\n\t\tvar count = 0;\n\n\t\treturn function() {\n\t\t\treturn prefix + (count++);\n\t\t};\n\t}\n\n\treturn {\n\t\tfilter: filter,\n\t\tinnerText: innerText,\n\t\ttrimHtml: trimHtml,\n\t\tcreateIdGenerator: createIdGenerator\n\t};\n});\n\n// Included from: js/tinymce/plugins/paste/classes/SmartPaste.js\n\n/**\n * SmartPaste.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Tries to be smart depending on what the user pastes if it looks like an url\n * it will make a link out of the current selection. If it's an image url that looks\n * like an image it will check if it's an image and insert it as an image.\n *\n * @class tinymce.pasteplugin.SmartPaste\n * @private\n */\ndefine(\"tinymce/pasteplugin/SmartPaste\", [\n\t\"tinymce/util/Tools\"\n], function (Tools) {\n\tvar isAbsoluteUrl = function (url) {\n\t\treturn /^https?:\\/\\/[\\w\\?\\-\\/+=.&%@~#]+$/i.test(url);\n\t};\n\n\tvar isImageUrl = function (url) {\n\t\treturn isAbsoluteUrl(url) && /.(gif|jpe?g|png)$/.test(url);\n\t};\n\n\tvar createImage = function (editor, url, pasteHtml) {\n\t\teditor.undoManager.extra(function () {\n\t\t\tpasteHtml(editor, url);\n\t\t}, function () {\n\t\t\teditor.insertContent('<img src=\"' + url + '\">');\n\t\t});\n\n\t\treturn true;\n\t};\n\n\tvar createLink = function (editor, url, pasteHtml) {\n\t\teditor.undoManager.extra(function () {\n\t\t\tpasteHtml(editor, url);\n\t\t}, function () {\n\t\t\teditor.execCommand('mceInsertLink', false, url);\n\t\t});\n\n\t\treturn true;\n\t};\n\n\tvar linkSelection = function (editor, html, pasteHtml) {\n\t\treturn editor.selection.isCollapsed() === false && isAbsoluteUrl(html) ? createLink(editor, html, pasteHtml) : false;\n\t};\n\n\tvar insertImage = function (editor, html, pasteHtml) {\n\t\treturn isImageUrl(html) ? createImage(editor, html, pasteHtml) : false;\n\t};\n\n\tvar pasteHtml = function (editor, html) {\n\t\teditor.insertContent(html, {\n\t\t\tmerge: editor.settings.paste_merge_formats !== false,\n\t\t\tpaste: true\n\t\t});\n\n\t\treturn true;\n\t};\n\n\tvar smartInsertContent = function (editor, html) {\n\t\tTools.each([\n\t\t\tlinkSelection,\n\t\t\tinsertImage,\n\t\t\tpasteHtml\n\t\t], function (action) {\n\t\t\treturn action(editor, html, pasteHtml) !== true;\n\t\t});\n\t};\n\n\tvar insertContent = function (editor, html) {\n\t\tif (editor.settings.smart_paste === false) {\n\t\t\tpasteHtml(editor, html);\n\t\t} else {\n\t\t\tsmartInsertContent(editor, html);\n\t\t}\n\t};\n\n\treturn {\n\t\tisImageUrl: isImageUrl,\n\t\tisAbsoluteUrl: isAbsoluteUrl,\n\t\tinsertContent: insertContent\n\t};\n});\n\n// Included from: js/tinymce/plugins/paste/classes/Clipboard.js\n\n/**\n * Clipboard.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains logic for getting HTML contents out of the clipboard.\n *\n * We need to make a lot of ugly hacks to get the contents out of the clipboard since\n * the W3C Clipboard API is broken in all browsers that have it: Gecko/WebKit/Blink.\n * We might rewrite this the way those API:s stabilize. Browsers doesn't handle pasting\n * from applications like Word the same way as it does when pasting into a contentEditable area\n * so we need to do lots of extra work to try to get to this clipboard data.\n *\n * Current implementation steps:\n *  1. On keydown with paste keys Ctrl+V or Shift+Insert create\n *     a paste bin element and move focus to that element.\n *  2. Wait for the browser to fire a \"paste\" event and get the contents out of the paste bin.\n *  3. Check if the paste was successful if true, process the HTML.\n *  (4). If the paste was unsuccessful use IE execCommand, Clipboard API, document.dataTransfer old WebKit API etc.\n *\n * @class tinymce.pasteplugin.Clipboard\n * @private\n */\ndefine(\"tinymce/pasteplugin/Clipboard\", [\n\t\"tinymce/Env\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/util/VK\",\n\t\"tinymce/pasteplugin/Utils\",\n\t\"tinymce/pasteplugin/SmartPaste\",\n\t\"tinymce/util/Delay\"\n], function(Env, RangeUtils, VK, Utils, SmartPaste, Delay) {\n\treturn function(editor) {\n\t\tvar self = this, pasteBinElm, lastRng, keyboardPasteTimeStamp = 0, draggingInternally = false;\n\t\tvar pasteBinDefaultContent = '%MCEPASTEBIN%', keyboardPastePlainTextState;\n\t\tvar mceInternalUrlPrefix = 'data:text/mce-internal,';\n\t\tvar uniqueId = Utils.createIdGenerator(\"mceclip\");\n\n\t\t/**\n\t\t * Pastes the specified HTML. This means that the HTML is filtered and then\n\t\t * inserted at the current selection in the editor. It will also fire paste events\n\t\t * for custom user filtering.\n\t\t *\n\t\t * @param {String} html HTML code to paste into the current selection.\n\t\t */\n\t\tfunction pasteHtml(html) {\n\t\t\tvar args, dom = editor.dom;\n\n\t\t\targs = editor.fire('BeforePastePreProcess', {content: html}); // Internal event used by Quirks\n\t\t\targs = editor.fire('PastePreProcess', args);\n\t\t\thtml = args.content;\n\n\t\t\tif (!args.isDefaultPrevented()) {\n\t\t\t\t// User has bound PastePostProcess events then we need to pass it through a DOM node\n\t\t\t\t// This is not ideal but we don't want to let the browser mess up the HTML for example\n\t\t\t\t// some browsers add &nbsp; to P tags etc\n\t\t\t\tif (editor.hasEventListeners('PastePostProcess') && !args.isDefaultPrevented()) {\n\t\t\t\t\t// We need to attach the element to the DOM so Sizzle selectors work on the contents\n\t\t\t\t\tvar tempBody = dom.add(editor.getBody(), 'div', {style: 'display:none'}, html);\n\t\t\t\t\targs = editor.fire('PastePostProcess', {node: tempBody});\n\t\t\t\t\tdom.remove(tempBody);\n\t\t\t\t\thtml = args.node.innerHTML;\n\t\t\t\t}\n\n\t\t\t\tif (!args.isDefaultPrevented()) {\n\t\t\t\t\tSmartPaste.insertContent(editor, html);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Pastes the specified text. This means that the plain text is processed\n\t\t * and converted into BR and P elements. It will fire paste events for custom filtering.\n\t\t *\n\t\t * @param {String} text Text to paste as the current selection location.\n\t\t */\n\t\tfunction pasteText(text) {\n\t\t\ttext = editor.dom.encode(text).replace(/\\r\\n/g, '\\n');\n\n\t\t\tvar startBlock = editor.dom.getParent(editor.selection.getStart(), editor.dom.isBlock);\n\n\t\t\t// Create start block html for example <p attr=\"value\">\n\t\t\tvar forcedRootBlockName = editor.settings.forced_root_block;\n\t\t\tvar forcedRootBlockStartHtml;\n\t\t\tif (forcedRootBlockName) {\n\t\t\t\tforcedRootBlockStartHtml = editor.dom.createHTML(forcedRootBlockName, editor.settings.forced_root_block_attrs);\n\t\t\t\tforcedRootBlockStartHtml = forcedRootBlockStartHtml.substr(0, forcedRootBlockStartHtml.length - 3) + '>';\n\t\t\t}\n\n\t\t\tif ((startBlock && /^(PRE|DIV)$/.test(startBlock.nodeName)) || !forcedRootBlockName) {\n\t\t\t\ttext = Utils.filter(text, [\n\t\t\t\t\t[/\\n/g, \"<br>\"]\n\t\t\t\t]);\n\t\t\t} else {\n\t\t\t\ttext = Utils.filter(text, [\n\t\t\t\t\t[/\\n\\n/g, \"</p>\" + forcedRootBlockStartHtml],\n\t\t\t\t\t[/^(.*<\\/p>)(<p>)$/, forcedRootBlockStartHtml + '$1'],\n\t\t\t\t\t[/\\n/g, \"<br />\"]\n\t\t\t\t]);\n\n\t\t\t\tif (text.indexOf('<p>') != -1) {\n\t\t\t\t\ttext = forcedRootBlockStartHtml + text;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tpasteHtml(text);\n\t\t}\n\n\t\t/**\n\t\t * Creates a paste bin element as close as possible to the current caret location and places the focus inside that element\n\t\t * so that when the real paste event occurs the contents gets inserted into this element\n\t\t * instead of the current editor selection element.\n\t\t */\n\t\tfunction createPasteBin() {\n\t\t\tvar dom = editor.dom, body = editor.getBody();\n\t\t\tvar viewport = editor.dom.getViewPort(editor.getWin()), scrollTop = viewport.y, top = 20;\n\t\t\tvar scrollContainer;\n\n\t\t\tlastRng = editor.selection.getRng();\n\n\t\t\tif (editor.inline) {\n\t\t\t\tscrollContainer = editor.selection.getScrollContainer();\n\n\t\t\t\t// Can't always rely on scrollTop returning a useful value.\n\t\t\t\t// It returns 0 if the browser doesn't support scrollTop for the element or is non-scrollable\n\t\t\t\tif (scrollContainer && scrollContainer.scrollTop > 0) {\n\t\t\t\t\tscrollTop = scrollContainer.scrollTop;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Returns the rect of the current caret if the caret is in an empty block before a\n\t\t\t * BR we insert a temporary invisible character that we get the rect this way we always get a proper rect.\n\t\t\t *\n\t\t\t * TODO: This might be useful in core.\n\t\t\t */\n\t\t\tfunction getCaretRect(rng) {\n\t\t\t\tvar rects, textNode, node, container = rng.startContainer;\n\n\t\t\t\trects = rng.getClientRects();\n\t\t\t\tif (rects.length) {\n\t\t\t\t\treturn rects[0];\n\t\t\t\t}\n\n\t\t\t\tif (!rng.collapsed || container.nodeType != 1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tnode = container.childNodes[lastRng.startOffset];\n\n\t\t\t\t// Skip empty whitespace nodes\n\t\t\t\twhile (node && node.nodeType == 3 && !node.data.length) {\n\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t}\n\n\t\t\t\tif (!node) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Check if the location is |<br>\n\t\t\t\t// TODO: Might need to expand this to say |<table>\n\t\t\t\tif (node.tagName == 'BR') {\n\t\t\t\t\ttextNode = dom.doc.createTextNode('\\uFEFF');\n\t\t\t\t\tnode.parentNode.insertBefore(textNode, node);\n\n\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\trng.setStartBefore(textNode);\n\t\t\t\t\trng.setEndAfter(textNode);\n\n\t\t\t\t\trects = rng.getClientRects();\n\t\t\t\t\tdom.remove(textNode);\n\t\t\t\t}\n\n\t\t\t\tif (rects.length) {\n\t\t\t\t\treturn rects[0];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Calculate top cordinate this is needed to avoid scrolling to top of document\n\t\t\t// We want the paste bin to be as close to the caret as possible to avoid scrolling\n\t\t\tif (lastRng.getClientRects) {\n\t\t\t\tvar rect = getCaretRect(lastRng);\n\n\t\t\t\tif (rect) {\n\t\t\t\t\t// Client rects gets us closes to the actual\n\t\t\t\t\t// caret location in for example a wrapped paragraph block\n\t\t\t\t\ttop = scrollTop + (rect.top - dom.getPos(body).y);\n\t\t\t\t} else {\n\t\t\t\t\ttop = scrollTop;\n\n\t\t\t\t\t// Check if we can find a closer location by checking the range element\n\t\t\t\t\tvar container = lastRng.startContainer;\n\t\t\t\t\tif (container) {\n\t\t\t\t\t\tif (container.nodeType == 3 && container.parentNode != body) {\n\t\t\t\t\t\t\tcontainer = container.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (container.nodeType == 1) {\n\t\t\t\t\t\t\ttop = dom.getPos(container, scrollContainer || body).y;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Create a pastebin\n\t\t\tpasteBinElm = dom.add(editor.getBody(), 'div', {\n\t\t\t\tid: \"mcepastebin\",\n\t\t\t\tcontentEditable: true,\n\t\t\t\t\"data-mce-bogus\": \"all\",\n\t\t\t\tstyle: 'position: absolute; top: ' + top + 'px;' +\n\t\t\t\t\t'width: 10px; height: 10px; overflow: hidden; opacity: 0'\n\t\t\t}, pasteBinDefaultContent);\n\n\t\t\t// Move paste bin out of sight since the controlSelection rect gets displayed otherwise on IE and Gecko\n\t\t\tif (Env.ie || Env.gecko) {\n\t\t\t\tdom.setStyle(pasteBinElm, 'left', dom.getStyle(body, 'direction', true) == 'rtl' ? 0xFFFF : -0xFFFF);\n\t\t\t}\n\n\t\t\t// Prevent focus events from bubbeling fixed FocusManager issues\n\t\t\tdom.bind(pasteBinElm, 'beforedeactivate focusin focusout', function(e) {\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\n\t\t\tpasteBinElm.focus();\n\t\t\teditor.selection.select(pasteBinElm, true);\n\t\t}\n\n\t\t/**\n\t\t * Removes the paste bin if it exists.\n\t\t */\n\t\tfunction removePasteBin() {\n\t\t\tif (pasteBinElm) {\n\t\t\t\tvar pasteBinClone;\n\n\t\t\t\t// WebKit/Blink might clone the div so\n\t\t\t\t// lets make sure we remove all clones\n\t\t\t\t// TODO: Man o man is this ugly. WebKit is the new IE! Remove this if they ever fix it!\n\t\t\t\twhile ((pasteBinClone = editor.dom.get('mcepastebin'))) {\n\t\t\t\t\teditor.dom.remove(pasteBinClone);\n\t\t\t\t\teditor.dom.unbind(pasteBinClone);\n\t\t\t\t}\n\n\t\t\t\tif (lastRng) {\n\t\t\t\t\teditor.selection.setRng(lastRng);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tpasteBinElm = lastRng = null;\n\t\t}\n\n\t\t/**\n\t\t * Returns the contents of the paste bin as a HTML string.\n\t\t *\n\t\t * @return {String} Get the contents of the paste bin.\n\t\t */\n\t\tfunction getPasteBinHtml() {\n\t\t\tvar html = '', pasteBinClones, i, clone, cloneHtml;\n\n\t\t\t// Since WebKit/Chrome might clone the paste bin when pasting\n\t\t\t// for example: <img style=\"float: right\"> we need to check if any of them contains some useful html.\n\t\t\t// TODO: Man o man is this ugly. WebKit is the new IE! Remove this if they ever fix it!\n\t\t\tpasteBinClones = editor.dom.select('div[id=mcepastebin]');\n\t\t\tfor (i = 0; i < pasteBinClones.length; i++) {\n\t\t\t\tclone = pasteBinClones[i];\n\n\t\t\t\t// Pasting plain text produces pastebins in pastebinds makes sence right!?\n\t\t\t\tif (clone.firstChild && clone.firstChild.id == 'mcepastebin') {\n\t\t\t\t\tclone = clone.firstChild;\n\t\t\t\t}\n\n\t\t\t\tcloneHtml = clone.innerHTML;\n\t\t\t\tif (html != pasteBinDefaultContent) {\n\t\t\t\t\thtml += cloneHtml;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn html;\n\t\t}\n\n\t\t/**\n\t\t * Gets various content types out of a datatransfer object.\n\t\t *\n\t\t * @param {DataTransfer} dataTransfer Event fired on paste.\n\t\t * @return {Object} Object with mime types and data for those mime types.\n\t\t */\n\t\tfunction getDataTransferItems(dataTransfer) {\n\t\t\tvar items = {};\n\n\t\t\tif (dataTransfer) {\n\t\t\t\t// Use old WebKit/IE API\n\t\t\t\tif (dataTransfer.getData) {\n\t\t\t\t\tvar legacyText = dataTransfer.getData('Text');\n\t\t\t\t\tif (legacyText && legacyText.length > 0) {\n\t\t\t\t\t\tif (legacyText.indexOf(mceInternalUrlPrefix) == -1) {\n\t\t\t\t\t\t\titems['text/plain'] = legacyText;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (dataTransfer.types) {\n\t\t\t\t\tfor (var i = 0; i < dataTransfer.types.length; i++) {\n\t\t\t\t\t\tvar contentType = dataTransfer.types[i];\n\t\t\t\t\t\titems[contentType] = dataTransfer.getData(contentType);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn items;\n\t\t}\n\n\t\t/**\n\t\t * Gets various content types out of the Clipboard API. It will also get the\n\t\t * plain text using older IE and WebKit API:s.\n\t\t *\n\t\t * @param {ClipboardEvent} clipboardEvent Event fired on paste.\n\t\t * @return {Object} Object with mime types and data for those mime types.\n\t\t */\n\t\tfunction getClipboardContent(clipboardEvent) {\n\t\t\treturn getDataTransferItems(clipboardEvent.clipboardData || editor.getDoc().dataTransfer);\n\t\t}\n\n\t\tfunction hasHtmlOrText(content) {\n\t\t\treturn hasContentType(content, 'text/html') || hasContentType(content, 'text/plain');\n\t\t}\n\n\t\tfunction getBase64FromUri(uri) {\n\t\t\tvar idx;\n\n\t\t\tidx = uri.indexOf(',');\n\t\t\tif (idx !== -1) {\n\t\t\t\treturn uri.substr(idx + 1);\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction isValidDataUriImage(settings, imgElm) {\n\t\t\treturn settings.images_dataimg_filter ? settings.images_dataimg_filter(imgElm) : true;\n\t\t}\n\n\t\tfunction pasteImage(rng, reader, blob) {\n\t\t\tif (rng) {\n\t\t\t\teditor.selection.setRng(rng);\n\t\t\t\trng = null;\n\t\t\t}\n\n\t\t\tvar dataUri = reader.result;\n\t\t\tvar base64 = getBase64FromUri(dataUri);\n\n\t\t\tvar img = new Image();\n\t\t\timg.src = dataUri;\n\n\t\t\t// TODO: Move the bulk of the cache logic to EditorUpload\n\t\t\tif (isValidDataUriImage(editor.settings, img)) {\n\t\t\t\tvar blobCache = editor.editorUpload.blobCache;\n\t\t\t\tvar blobInfo, existingBlobInfo;\n\n\t\t\t\texistingBlobInfo = blobCache.findFirst(function(cachedBlobInfo) {\n\t\t\t\t\treturn cachedBlobInfo.base64() === base64;\n\t\t\t\t});\n\n\t\t\t\tif (!existingBlobInfo) {\n\t\t\t\t\tblobInfo = blobCache.create(uniqueId(), blob, base64);\n\t\t\t\t\tblobCache.add(blobInfo);\n\t\t\t\t} else {\n\t\t\t\t\tblobInfo = existingBlobInfo;\n\t\t\t\t}\n\n\t\t\t\tpasteHtml('<img src=\"' + blobInfo.blobUri() + '\">');\n\t\t\t} else {\n\t\t\t\tpasteHtml('<img src=\"' + dataUri + '\">');\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Checks if the clipboard contains image data if it does it will take that data\n\t\t * and convert it into a data url image and paste that image at the caret location.\n\t\t *\n\t\t * @param  {ClipboardEvent} e Paste/drop event object.\n\t\t * @param  {DOMRange} rng Rng object to move selection to.\n\t\t * @return {Boolean} true/false if the image data was found or not.\n\t\t */\n\t\tfunction pasteImageData(e, rng) {\n\t\t\tvar dataTransfer = e.clipboardData || e.dataTransfer;\n\n\t\t\tfunction processItems(items) {\n\t\t\t\tvar i, item, reader, hadImage = false;\n\n\t\t\t\tif (items) {\n\t\t\t\t\tfor (i = 0; i < items.length; i++) {\n\t\t\t\t\t\titem = items[i];\n\n\t\t\t\t\t\tif (/^image\\/(jpeg|png|gif|bmp)$/.test(item.type)) {\n\t\t\t\t\t\t\tvar blob = item.getAsFile ? item.getAsFile() : item;\n\n\t\t\t\t\t\t\treader = new FileReader();\n\t\t\t\t\t\t\treader.onload = pasteImage.bind(null, rng, reader, blob);\n\t\t\t\t\t\t\treader.readAsDataURL(blob);\n\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\thadImage = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn hadImage;\n\t\t\t}\n\n\t\t\tif (editor.settings.paste_data_images && dataTransfer) {\n\t\t\t\treturn processItems(dataTransfer.items) || processItems(dataTransfer.files);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Chrome on Android doesn't support proper clipboard access so we have no choice but to allow the browser default behavior.\n\t\t *\n\t\t * @param {Event} e Paste event object to check if it contains any data.\n\t\t * @return {Boolean} true/false if the clipboard is empty or not.\n\t\t */\n\t\tfunction isBrokenAndroidClipboardEvent(e) {\n\t\t\tvar clipboardData = e.clipboardData;\n\n\t\t\treturn navigator.userAgent.indexOf('Android') != -1 && clipboardData && clipboardData.items && clipboardData.items.length === 0;\n\t\t}\n\n\t\tfunction getCaretRangeFromEvent(e) {\n\t\t\treturn RangeUtils.getCaretRangeFromPoint(e.clientX, e.clientY, editor.getDoc());\n\t\t}\n\n\t\tfunction hasContentType(clipboardContent, mimeType) {\n\t\t\treturn mimeType in clipboardContent && clipboardContent[mimeType].length > 0;\n\t\t}\n\n\t\tfunction isKeyboardPasteEvent(e) {\n\t\t\treturn (VK.metaKeyPressed(e) && e.keyCode == 86) || (e.shiftKey && e.keyCode == 45);\n\t\t}\n\n\t\tfunction registerEventHandlers() {\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tfunction removePasteBinOnKeyUp(e) {\n\t\t\t\t\t// Ctrl+V or Shift+Insert\n\t\t\t\t\tif (isKeyboardPasteEvent(e) && !e.isDefaultPrevented()) {\n\t\t\t\t\t\tremovePasteBin();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Ctrl+V or Shift+Insert\n\t\t\t\tif (isKeyboardPasteEvent(e) && !e.isDefaultPrevented()) {\n\t\t\t\t\tkeyboardPastePlainTextState = e.shiftKey && e.keyCode == 86;\n\n\t\t\t\t\t// Edge case on Safari on Mac where it doesn't handle Cmd+Shift+V correctly\n\t\t\t\t\t// it fires the keydown but no paste or keyup so we are left with a paste bin\n\t\t\t\t\tif (keyboardPastePlainTextState && Env.webkit && navigator.userAgent.indexOf('Version/') != -1) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Prevent undoManager keydown handler from making an undo level with the pastebin in it\n\t\t\t\t\te.stopImmediatePropagation();\n\n\t\t\t\t\tkeyboardPasteTimeStamp = new Date().getTime();\n\n\t\t\t\t\t// IE doesn't support Ctrl+Shift+V and it doesn't even produce a paste event\n\t\t\t\t\t// so lets fake a paste event and let IE use the execCommand/dataTransfer methods\n\t\t\t\t\tif (Env.ie && keyboardPastePlainTextState) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\teditor.fire('paste', {ieFake: true});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tremovePasteBin();\n\t\t\t\t\tcreatePasteBin();\n\n\t\t\t\t\t// Remove pastebin if we get a keyup and no paste event\n\t\t\t\t\t// For example pasting a file in IE 11 will not produce a paste event\n\t\t\t\t\teditor.once('keyup', removePasteBinOnKeyUp);\n\t\t\t\t\teditor.once('paste', function() {\n\t\t\t\t\t\teditor.off('keyup', removePasteBinOnKeyUp);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfunction insertClipboardContent(clipboardContent, isKeyBoardPaste, plainTextMode) {\n\t\t\t\tvar content;\n\n\t\t\t\t// Grab HTML from Clipboard API or paste bin as a fallback\n\t\t\t\tif (hasContentType(clipboardContent, 'text/html')) {\n\t\t\t\t\tcontent = clipboardContent['text/html'];\n\t\t\t\t} else {\n\t\t\t\t\tcontent = getPasteBinHtml();\n\n\t\t\t\t\t// If paste bin is empty try using plain text mode\n\t\t\t\t\t// since that is better than nothing right\n\t\t\t\t\tif (content == pasteBinDefaultContent) {\n\t\t\t\t\t\tplainTextMode = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcontent = Utils.trimHtml(content);\n\n\t\t\t\t// WebKit has a nice bug where it clones the paste bin if you paste from for example notepad\n\t\t\t\t// so we need to force plain text mode in this case\n\t\t\t\tif (pasteBinElm && pasteBinElm.firstChild && pasteBinElm.firstChild.id === 'mcepastebin') {\n\t\t\t\t\tplainTextMode = true;\n\t\t\t\t}\n\n\t\t\t\tremovePasteBin();\n\n\t\t\t\t// If we got nothing from clipboard API and pastebin then we could try the last resort: plain/text\n\t\t\t\tif (!content.length) {\n\t\t\t\t\tplainTextMode = true;\n\t\t\t\t}\n\n\t\t\t\t// Grab plain text from Clipboard API or convert existing HTML to plain text\n\t\t\t\tif (plainTextMode) {\n\t\t\t\t\t// Use plain text contents from Clipboard API unless the HTML contains paragraphs then\n\t\t\t\t\t// we should convert the HTML to plain text since works better when pasting HTML/Word contents as plain text\n\t\t\t\t\tif (hasContentType(clipboardContent, 'text/plain') && content.indexOf('</p>') == -1) {\n\t\t\t\t\t\tcontent = clipboardContent['text/plain'];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontent = Utils.innerText(content);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If the content is the paste bin default HTML then it was\n\t\t\t\t// impossible to get the cliboard data out.\n\t\t\t\tif (content == pasteBinDefaultContent) {\n\t\t\t\t\tif (!isKeyBoardPaste) {\n\t\t\t\t\t\teditor.windowManager.alert('Please use Ctrl+V/Cmd+V keyboard shortcuts to paste contents.');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (plainTextMode) {\n\t\t\t\t\tpasteText(content);\n\t\t\t\t} else {\n\t\t\t\t\tpasteHtml(content);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar getLastRng = function() {\n\t\t\t\treturn lastRng || editor.selection.getRng();\n\t\t\t};\n\n\t\t\teditor.on('paste', function(e) {\n\t\t\t\t// Getting content from the Clipboard can take some time\n\t\t\t\tvar clipboardTimer = new Date().getTime();\n\t\t\t\tvar clipboardContent = getClipboardContent(e);\n\t\t\t\tvar clipboardDelay = new Date().getTime() - clipboardTimer;\n\n\t\t\t\tvar isKeyBoardPaste = (new Date().getTime() - keyboardPasteTimeStamp - clipboardDelay) < 1000;\n\t\t\t\tvar plainTextMode = self.pasteFormat == \"text\" || keyboardPastePlainTextState;\n\n\t\t\t\tkeyboardPastePlainTextState = false;\n\n\t\t\t\tif (e.isDefaultPrevented() || isBrokenAndroidClipboardEvent(e)) {\n\t\t\t\t\tremovePasteBin();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!hasHtmlOrText(clipboardContent) && pasteImageData(e, getLastRng())) {\n\t\t\t\t\tremovePasteBin();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Not a keyboard paste prevent default paste and try to grab the clipboard contents using different APIs\n\t\t\t\tif (!isKeyBoardPaste) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\n\t\t\t\t// Try IE only method if paste isn't a keyboard paste\n\t\t\t\tif (Env.ie && (!isKeyBoardPaste || e.ieFake)) {\n\t\t\t\t\tcreatePasteBin();\n\n\t\t\t\t\teditor.dom.bind(pasteBinElm, 'paste', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t});\n\n\t\t\t\t\teditor.getDoc().execCommand('Paste', false, null);\n\t\t\t\t\tclipboardContent[\"text/html\"] = getPasteBinHtml();\n\t\t\t\t}\n\n\t\t\t\t// If clipboard API has HTML then use that directly\n\t\t\t\tif (hasContentType(clipboardContent, 'text/html')) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tinsertClipboardContent(clipboardContent, isKeyBoardPaste, plainTextMode);\n\t\t\t\t} else {\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\tinsertClipboardContent(clipboardContent, isKeyBoardPaste, plainTextMode);\n\t\t\t\t\t}, 0);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('dragstart dragend', function(e) {\n\t\t\t\tdraggingInternally = e.type == 'dragstart';\n\t\t\t});\n\n\t\t\tfunction isPlainTextFileUrl(content) {\n\t\t\t\tvar plainTextContent = content['text/plain'];\n\t\t\t\treturn plainTextContent ? plainTextContent.indexOf('file://') === 0 : false;\n\t\t\t}\n\n\t\t\teditor.on('drop', function(e) {\n\t\t\t\tvar dropContent, rng;\n\n\t\t\t\trng = getCaretRangeFromEvent(e);\n\n\t\t\t\tif (e.isDefaultPrevented() || draggingInternally) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdropContent = getDataTransferItems(e.dataTransfer);\n\n\t\t\t\tif ((!hasHtmlOrText(dropContent) || isPlainTextFileUrl(dropContent)) && pasteImageData(e, rng)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (rng && editor.settings.paste_filter_drop !== false) {\n\t\t\t\t\tvar content = dropContent['mce-internal'] || dropContent['text/html'] || dropContent['text/plain'];\n\n\t\t\t\t\tif (content) {\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t// FF 45 doesn't paint a caret when dragging in text in due to focus call by execCommand\n\t\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\t\teditor.undoManager.transact(function() {\n\t\t\t\t\t\t\t\tif (dropContent['mce-internal']) {\n\t\t\t\t\t\t\t\t\teditor.execCommand('Delete');\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\teditor.selection.setRng(rng);\n\n\t\t\t\t\t\t\t\tcontent = Utils.trimHtml(content);\n\n\t\t\t\t\t\t\t\tif (!dropContent['text/html']) {\n\t\t\t\t\t\t\t\t\tpasteText(content);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tpasteHtml(content);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('dragover dragend', function(e) {\n\t\t\t\tif (editor.settings.paste_data_images) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tself.pasteHtml = pasteHtml;\n\t\tself.pasteText = pasteText;\n\t\tself.pasteImageData = pasteImageData;\n\n\t\teditor.on('preInit', function() {\n\t\t\tregisterEventHandlers();\n\n\t\t\t// Remove all data images from paste for example from Gecko\n\t\t\t// except internal images like video elements\n\t\t\teditor.parser.addNodeFilter('img', function(nodes, name, args) {\n\t\t\t\tfunction isPasteInsert(args) {\n\t\t\t\t\treturn args.data && args.data.paste === true;\n\t\t\t\t}\n\n\t\t\t\tfunction remove(node) {\n\t\t\t\t\tif (!node.attr('data-mce-object') && src !== Env.transparentSrc) {\n\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction isWebKitFakeUrl(src) {\n\t\t\t\t\treturn src.indexOf(\"webkit-fake-url\") === 0;\n\t\t\t\t}\n\n\t\t\t\tfunction isDataUri(src) {\n\t\t\t\t\treturn src.indexOf(\"data:\") === 0;\n\t\t\t\t}\n\n\t\t\t\tif (!editor.settings.paste_data_images && isPasteInsert(args)) {\n\t\t\t\t\tvar i = nodes.length;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tvar src = nodes[i].attributes.map.src;\n\n\t\t\t\t\t\tif (!src) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Safari on Mac produces webkit-fake-url see: https://bugs.webkit.org/show_bug.cgi?id=49141\n\t\t\t\t\t\tif (isWebKitFakeUrl(src)) {\n\t\t\t\t\t\t\tremove(nodes[i]);\n\t\t\t\t\t\t} else if (!editor.settings.allow_html_data_urls && isDataUri(src)) {\n\t\t\t\t\t\t\tremove(nodes[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t};\n});\n\n// Included from: js/tinymce/plugins/paste/classes/WordFilter.js\n\n/**\n * WordFilter.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class parses word HTML into proper TinyMCE markup.\n *\n * @class tinymce.pasteplugin.WordFilter\n * @private\n */\ndefine(\"tinymce/pasteplugin/WordFilter\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/html/DomParser\",\n\t\"tinymce/html/Schema\",\n\t\"tinymce/html/Serializer\",\n\t\"tinymce/html/Node\",\n\t\"tinymce/pasteplugin/Utils\"\n], function(Tools, DomParser, Schema, Serializer, Node, Utils) {\n\t/**\n\t * Checks if the specified content is from any of the following sources: MS Word/Office 365/Google docs.\n\t */\n\tfunction isWordContent(content) {\n\t\treturn (\n\t\t\t(/<font face=\"Times New Roman\"|class=\"?Mso|style=\"[^\"]*\\bmso-|style='[^'']*\\bmso-|w:WordDocument/i).test(content) ||\n\t\t\t(/class=\"OutlineElement/).test(content) ||\n\t\t\t(/id=\"?docs\\-internal\\-guid\\-/.test(content))\n\t\t);\n\t}\n\n\t/**\n\t * Checks if the specified text starts with \"1. \" or \"a. \" etc.\n\t */\n\tfunction isNumericList(text) {\n\t\tvar found, patterns;\n\n\t\tpatterns = [\n\t\t\t/^[IVXLMCD]{1,2}\\.[ \\u00a0]/,  // Roman upper case\n\t\t\t/^[ivxlmcd]{1,2}\\.[ \\u00a0]/,  // Roman lower case\n\t\t\t/^[a-z]{1,2}[\\.\\)][ \\u00a0]/,  // Alphabetical a-z\n\t\t\t/^[A-Z]{1,2}[\\.\\)][ \\u00a0]/,  // Alphabetical A-Z\n\t\t\t/^[0-9]+\\.[ \\u00a0]/,          // Numeric lists\n\t\t\t/^[\\u3007\\u4e00\\u4e8c\\u4e09\\u56db\\u4e94\\u516d\\u4e03\\u516b\\u4e5d]+\\.[ \\u00a0]/, // Japanese\n\t\t\t/^[\\u58f1\\u5f10\\u53c2\\u56db\\u4f0d\\u516d\\u4e03\\u516b\\u4e5d\\u62fe]+\\.[ \\u00a0]/  // Chinese\n\t\t];\n\n\t\ttext = text.replace(/^[\\u00a0 ]+/, '');\n\n\t\tTools.each(patterns, function(pattern) {\n\t\t\tif (pattern.test(text)) {\n\t\t\t\tfound = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\treturn found;\n\t}\n\n\tfunction isBulletList(text) {\n\t\treturn /^[\\s\\u00a0]*[\\u2022\\u00b7\\u00a7\\u25CF]\\s*/.test(text);\n\t}\n\n\tfunction WordFilter(editor) {\n\t\tvar settings = editor.settings;\n\n\t\teditor.on('BeforePastePreProcess', function(e) {\n\t\t\tvar content = e.content, retainStyleProperties, validStyles;\n\n\t\t\t// Remove google docs internal guid markers\n\t\t\tcontent = content.replace(/<b[^>]+id=\"?docs-internal-[^>]*>/gi, '');\n\t\t\tcontent = content.replace(/<br class=\"?Apple-interchange-newline\"?>/gi, '');\n\n\t\t\tretainStyleProperties = settings.paste_retain_style_properties;\n\t\t\tif (retainStyleProperties) {\n\t\t\t\tvalidStyles = Tools.makeMap(retainStyleProperties.split(/[, ]/));\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Converts fake bullet and numbered lists to real semantic OL/UL.\n\t\t\t *\n\t\t\t * @param {tinymce.html.Node} node Root node to convert children of.\n\t\t\t */\n\t\t\tfunction convertFakeListsToProperLists(node) {\n\t\t\t\tvar currentListNode, prevListNode, lastLevel = 1;\n\n\t\t\t\tfunction getText(node) {\n\t\t\t\t\tvar txt = '';\n\n\t\t\t\t\tif (node.type === 3) {\n\t\t\t\t\t\treturn node.value;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((node = node.firstChild)) {\n\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\ttxt += getText(node);\n\t\t\t\t\t\t} while ((node = node.next));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn txt;\n\t\t\t\t}\n\n\t\t\t\tfunction trimListStart(node, regExp) {\n\t\t\t\t\tif (node.type === 3) {\n\t\t\t\t\t\tif (regExp.test(node.value)) {\n\t\t\t\t\t\t\tnode.value = node.value.replace(regExp, '');\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((node = node.firstChild)) {\n\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\tif (!trimListStart(node, regExp)) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} while ((node = node.next));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tfunction removeIgnoredNodes(node) {\n\t\t\t\t\tif (node._listIgnore) {\n\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((node = node.firstChild)) {\n\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\tremoveIgnoredNodes(node);\n\t\t\t\t\t\t} while ((node = node.next));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction convertParagraphToLi(paragraphNode, listName, start) {\n\t\t\t\t\tvar level = paragraphNode._listLevel || lastLevel;\n\n\t\t\t\t\t// Handle list nesting\n\t\t\t\t\tif (level != lastLevel) {\n\t\t\t\t\t\tif (level < lastLevel) {\n\t\t\t\t\t\t\t// Move to parent list\n\t\t\t\t\t\t\tif (currentListNode) {\n\t\t\t\t\t\t\t\tcurrentListNode = currentListNode.parent.parent;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Create new list\n\t\t\t\t\t\t\tprevListNode = currentListNode;\n\t\t\t\t\t\t\tcurrentListNode = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!currentListNode || currentListNode.name != listName) {\n\t\t\t\t\t\tprevListNode = prevListNode || currentListNode;\n\t\t\t\t\t\tcurrentListNode = new Node(listName, 1);\n\n\t\t\t\t\t\tif (start > 1) {\n\t\t\t\t\t\t\tcurrentListNode.attr('start', '' + start);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tparagraphNode.wrap(currentListNode);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurrentListNode.append(paragraphNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tparagraphNode.name = 'li';\n\n\t\t\t\t\t// Append list to previous list if it exists\n\t\t\t\t\tif (level > lastLevel && prevListNode) {\n\t\t\t\t\t\tprevListNode.lastChild.append(currentListNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tlastLevel = level;\n\n\t\t\t\t\t// Remove start of list item \"1. \" or \"&middot; \" etc\n\t\t\t\t\tremoveIgnoredNodes(paragraphNode);\n\t\t\t\t\ttrimListStart(paragraphNode, /^\\u00a0+/);\n\t\t\t\t\ttrimListStart(paragraphNode, /^\\s*([\\u2022\\u00b7\\u00a7\\u25CF]|\\w+\\.)/);\n\t\t\t\t\ttrimListStart(paragraphNode, /^\\u00a0+/);\n\t\t\t\t}\n\n\t\t\t\t// Build a list of all root level elements before we start\n\t\t\t\t// altering them in the loop below.\n\t\t\t\tvar elements = [], child = node.firstChild;\n\t\t\t\twhile (typeof child !== 'undefined' && child !== null) {\n\t\t\t\t\telements.push(child);\n\n\t\t\t\t\tchild = child.walk();\n\t\t\t\t\tif (child !== null) {\n\t\t\t\t\t\twhile (typeof child !== 'undefined' && child.parent !== node) {\n\t\t\t\t\t\t\tchild = child.walk();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (var i = 0; i < elements.length; i++) {\n\t\t\t\t\tnode = elements[i];\n\n\t\t\t\t\tif (node.name == 'p' && node.firstChild) {\n\t\t\t\t\t\t// Find first text node in paragraph\n\t\t\t\t\t\tvar nodeText = getText(node);\n\n\t\t\t\t\t\t// Detect unordered lists look for bullets\n\t\t\t\t\t\tif (isBulletList(nodeText)) {\n\t\t\t\t\t\t\tconvertParagraphToLi(node, 'ul');\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Detect ordered lists 1., a. or ixv.\n\t\t\t\t\t\tif (isNumericList(nodeText)) {\n\t\t\t\t\t\t\t// Parse OL start number\n\t\t\t\t\t\t\tvar matches = /([0-9]+)\\./.exec(nodeText);\n\t\t\t\t\t\t\tvar start = 1;\n\t\t\t\t\t\t\tif (matches) {\n\t\t\t\t\t\t\t\tstart = parseInt(matches[1], 10);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconvertParagraphToLi(node, 'ol', start);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Convert paragraphs marked as lists but doesn't look like anything\n\t\t\t\t\t\tif (node._listLevel) {\n\t\t\t\t\t\t\tconvertParagraphToLi(node, 'ul', 1);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcurrentListNode = null;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// If the root level element isn't a p tag which can be\n\t\t\t\t\t\t// processed by convertParagraphToLi, it interrupts the\n\t\t\t\t\t\t// lists, causing a new list to start instead of having\n\t\t\t\t\t\t// elements from the next list inserted above this tag.\n\t\t\t\t\t\tprevListNode = currentListNode;\n\t\t\t\t\t\tcurrentListNode = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction filterStyles(node, styleValue) {\n\t\t\t\tvar outputStyles = {}, matches, styles = editor.dom.parseStyle(styleValue);\n\n\t\t\t\tTools.each(styles, function(value, name) {\n\t\t\t\t\t// Convert various MS styles to W3C styles\n\t\t\t\t\tswitch (name) {\n\t\t\t\t\t\tcase 'mso-list':\n\t\t\t\t\t\t\t// Parse out list indent level for lists\n\t\t\t\t\t\t\tmatches = /\\w+ \\w+([0-9]+)/i.exec(styleValue);\n\t\t\t\t\t\t\tif (matches) {\n\t\t\t\t\t\t\t\tnode._listLevel = parseInt(matches[1], 10);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Remove these nodes <span style=\"mso-list:Ignore\">o</span>\n\t\t\t\t\t\t\t// Since the span gets removed we mark the text node and the span\n\t\t\t\t\t\t\tif (/Ignore/i.test(value) && node.firstChild) {\n\t\t\t\t\t\t\t\tnode._listIgnore = true;\n\t\t\t\t\t\t\t\tnode.firstChild._listIgnore = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase \"horiz-align\":\n\t\t\t\t\t\t\tname = \"text-align\";\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase \"vert-align\":\n\t\t\t\t\t\t\tname = \"vertical-align\";\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase \"font-color\":\n\t\t\t\t\t\tcase \"mso-foreground\":\n\t\t\t\t\t\t\tname = \"color\";\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase \"mso-background\":\n\t\t\t\t\t\tcase \"mso-highlight\":\n\t\t\t\t\t\t\tname = \"background\";\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase \"font-weight\":\n\t\t\t\t\t\tcase \"font-style\":\n\t\t\t\t\t\t\tif (value != \"normal\") {\n\t\t\t\t\t\t\t\toutputStyles[name] = value;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tcase \"mso-element\":\n\t\t\t\t\t\t\t// Remove track changes code\n\t\t\t\t\t\t\tif (/^(comment|comment-list)$/i.test(value)) {\n\t\t\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (name.indexOf('mso-comment') === 0) {\n\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Never allow mso- prefixed names\n\t\t\t\t\tif (name.indexOf('mso-') === 0) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Output only valid styles\n\t\t\t\t\tif (retainStyleProperties == \"all\" || (validStyles && validStyles[name])) {\n\t\t\t\t\t\toutputStyles[name] = value;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Convert bold style to \"b\" element\n\t\t\t\tif (/(bold)/i.test(outputStyles[\"font-weight\"])) {\n\t\t\t\t\tdelete outputStyles[\"font-weight\"];\n\t\t\t\t\tnode.wrap(new Node(\"b\", 1));\n\t\t\t\t}\n\n\t\t\t\t// Convert italic style to \"i\" element\n\t\t\t\tif (/(italic)/i.test(outputStyles[\"font-style\"])) {\n\t\t\t\t\tdelete outputStyles[\"font-style\"];\n\t\t\t\t\tnode.wrap(new Node(\"i\", 1));\n\t\t\t\t}\n\n\t\t\t\t// Serialize the styles and see if there is something left to keep\n\t\t\t\toutputStyles = editor.dom.serializeStyle(outputStyles, node.name);\n\t\t\t\tif (outputStyles) {\n\t\t\t\t\treturn outputStyles;\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (settings.paste_enable_default_filters === false) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Detect is the contents is Word junk HTML\n\t\t\tif (isWordContent(e.content)) {\n\t\t\t\te.wordContent = true; // Mark it for other processors\n\n\t\t\t\t// Remove basic Word junk\n\t\t\t\tcontent = Utils.filter(content, [\n\t\t\t\t\t// Word comments like conditional comments etc\n\t\t\t\t\t/<!--[\\s\\S]+?-->/gi,\n\n\t\t\t\t\t// Remove comments, scripts (e.g., msoShowComment), XML tag, VML content,\n\t\t\t\t\t// MS Office namespaced tags, and a few other tags\n\t\t\t\t\t/<(!|script[^>]*>.*?<\\/script(?=[>\\s])|\\/?(\\?xml(:\\w+)?|img|meta|link|style|\\w:\\w+)(?=[\\s\\/>]))[^>]*>/gi,\n\n\t\t\t\t\t// Convert <s> into <strike> for line-though\n\t\t\t\t\t[/<(\\/?)s>/gi, \"<$1strike>\"],\n\n\t\t\t\t\t// Replace nsbp entites to char since it's easier to handle\n\t\t\t\t\t[/&nbsp;/gi, \"\\u00a0\"],\n\n\t\t\t\t\t// Convert <span style=\"mso-spacerun:yes\">___</span> to string of alternating\n\t\t\t\t\t// breaking/non-breaking spaces of same length\n\t\t\t\t\t[/<span\\s+style\\s*=\\s*\"\\s*mso-spacerun\\s*:\\s*yes\\s*;?\\s*\"\\s*>([\\s\\u00a0]*)<\\/span>/gi,\n\t\t\t\t\t\tfunction(str, spaces) {\n\t\t\t\t\t\t\treturn (spaces.length > 0) ?\n\t\t\t\t\t\t\t\tspaces.replace(/./, \" \").slice(Math.floor(spaces.length / 2)).split(\"\").join(\"\\u00a0\") : \"\";\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t]);\n\n\t\t\t\tvar validElements = settings.paste_word_valid_elements;\n\t\t\t\tif (!validElements) {\n\t\t\t\t\tvalidElements = (\n\t\t\t\t\t\t'-strong/b,-em/i,-u,-span,-p,-ol,-ul,-li,-h1,-h2,-h3,-h4,-h5,-h6,' +\n\t\t\t\t\t\t'-p/div,-a[href|name],sub,sup,strike,br,del,table[width],tr,' +\n\t\t\t\t\t\t'td[colspan|rowspan|width],th[colspan|rowspan|width],thead,tfoot,tbody'\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Setup strict schema\n\t\t\t\tvar schema = new Schema({\n\t\t\t\t\tvalid_elements: validElements,\n\t\t\t\t\tvalid_children: '-li[p]'\n\t\t\t\t});\n\n\t\t\t\t// Add style/class attribute to all element rules since the user might have removed them from\n\t\t\t\t// paste_word_valid_elements config option and we need to check them for properties\n\t\t\t\tTools.each(schema.elements, function(rule) {\n\t\t\t\t\t/*eslint dot-notation:0*/\n\t\t\t\t\tif (!rule.attributes[\"class\"]) {\n\t\t\t\t\t\trule.attributes[\"class\"] = {};\n\t\t\t\t\t\trule.attributesOrder.push(\"class\");\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!rule.attributes.style) {\n\t\t\t\t\t\trule.attributes.style = {};\n\t\t\t\t\t\trule.attributesOrder.push(\"style\");\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Parse HTML into DOM structure\n\t\t\t\tvar domParser = new DomParser({}, schema);\n\n\t\t\t\t// Filter styles to remove \"mso\" specific styles and convert some of them\n\t\t\t\tdomParser.addAttributeFilter('style', function(nodes) {\n\t\t\t\t\tvar i = nodes.length, node;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\t\tnode.attr('style', filterStyles(node, node.attr('style')));\n\n\t\t\t\t\t\t// Remove pointess spans\n\t\t\t\t\t\tif (node.name == 'span' && node.parent && !node.attributes.length) {\n\t\t\t\t\t\t\tnode.unwrap();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Check the class attribute for comments or del items and remove those\n\t\t\t\tdomParser.addAttributeFilter('class', function(nodes) {\n\t\t\t\t\tvar i = nodes.length, node, className;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnode = nodes[i];\n\n\t\t\t\t\t\tclassName = node.attr('class');\n\t\t\t\t\t\tif (/^(MsoCommentReference|MsoCommentText|msoDel)$/i.test(className)) {\n\t\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode.attr('class', null);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Remove all del elements since we don't want the track changes code in the editor\n\t\t\t\tdomParser.addNodeFilter('del', function(nodes) {\n\t\t\t\t\tvar i = nodes.length;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnodes[i].remove();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Keep some of the links and anchors\n\t\t\t\tdomParser.addNodeFilter('a', function(nodes) {\n\t\t\t\t\tvar i = nodes.length, node, href, name;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\t\thref = node.attr('href');\n\t\t\t\t\t\tname = node.attr('name');\n\n\t\t\t\t\t\tif (href && href.indexOf('#_msocom_') != -1) {\n\t\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (href && href.indexOf('file://') === 0) {\n\t\t\t\t\t\t\thref = href.split('#')[1];\n\t\t\t\t\t\t\tif (href) {\n\t\t\t\t\t\t\t\thref = '#' + href;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!href && !name) {\n\t\t\t\t\t\t\tnode.unwrap();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Remove all named anchors that aren't specific to TOC, Footnotes or Endnotes\n\t\t\t\t\t\t\tif (name && !/^_?(?:toc|edn|ftn)/i.test(name)) {\n\t\t\t\t\t\t\t\tnode.unwrap();\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tnode.attr({\n\t\t\t\t\t\t\t\thref: href,\n\t\t\t\t\t\t\t\tname: name\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Parse into DOM structure\n\t\t\t\tvar rootNode = domParser.parse(content);\n\n\t\t\t\t// Process DOM\n\t\t\t\tif (settings.paste_convert_word_fake_lists !== false) {\n\t\t\t\t\tconvertFakeListsToProperLists(rootNode);\n\t\t\t\t}\n\n\t\t\t\t// Serialize DOM back to HTML\n\t\t\t\te.content = new Serializer({\n\t\t\t\t\tvalidate: settings.validate\n\t\t\t\t}, schema).serialize(rootNode);\n\t\t\t}\n\t\t});\n\t}\n\n\tWordFilter.isWordContent = isWordContent;\n\n\treturn WordFilter;\n});\n\n// Included from: js/tinymce/plugins/paste/classes/Quirks.js\n\n/**\n * Quirks.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2017 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains various fixes for browsers. These issues can not be feature\n * detected since we have no direct control over the clipboard. However we might be able\n * to remove some of these fixes once the browsers gets updated/fixed.\n *\n * @class tinymce.pasteplugin.Quirks\n * @private\n */\ndefine(\"tinymce/pasteplugin/Quirks\", [\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/pasteplugin/WordFilter\",\n\t\"tinymce/pasteplugin/Utils\"\n], function(Env, Tools, WordFilter, Utils) {\n\t\"use strict\";\n\n\treturn function(editor) {\n\t\tfunction addPreProcessFilter(filterFunc) {\n\t\t\teditor.on('BeforePastePreProcess', function(e) {\n\t\t\t\te.content = filterFunc(e.content);\n\t\t\t});\n\t\t}\n\n\t\tfunction addPostProcessFilter(filterFunc) {\n\t\t\teditor.on('PastePostProcess', function(e) {\n\t\t\t\tfilterFunc(e.node);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Removes BR elements after block elements. IE9 has a nasty bug where it puts a BR element after each\n\t\t * block element when pasting from word. This removes those elements.\n\t\t *\n\t\t * This:\n\t\t *  <p>a</p><br><p>b</p>\n\t\t *\n\t\t * Becomes:\n\t\t *  <p>a</p><p>b</p>\n\t\t */\n\t\tfunction removeExplorerBrElementsAfterBlocks(html) {\n\t\t\t// Only filter word specific content\n\t\t\tif (!WordFilter.isWordContent(html)) {\n\t\t\t\treturn html;\n\t\t\t}\n\n\t\t\t// Produce block regexp based on the block elements in schema\n\t\t\tvar blockElements = [];\n\n\t\t\tTools.each(editor.schema.getBlockElements(), function(block, blockName) {\n\t\t\t\tblockElements.push(blockName);\n\t\t\t});\n\n\t\t\tvar explorerBlocksRegExp = new RegExp(\n\t\t\t\t'(?:<br>&nbsp;[\\\\s\\\\r\\\\n]+|<br>)*(<\\\\/?(' + blockElements.join('|') + ')[^>]*>)(?:<br>&nbsp;[\\\\s\\\\r\\\\n]+|<br>)*',\n\t\t\t\t'g'\n\t\t\t);\n\n\t\t\t// Remove BR:s from: <BLOCK>X</BLOCK><BR>\n\t\t\thtml = Utils.filter(html, [\n\t\t\t\t[explorerBlocksRegExp, '$1']\n\t\t\t]);\n\n\t\t\t// IE9 also adds an extra BR element for each soft-linefeed and it also adds a BR for each word wrap break\n\t\t\thtml = Utils.filter(html, [\n\t\t\t\t[/<br><br>/g, '<BR><BR>'], // Replace multiple BR elements with uppercase BR to keep them intact\n\t\t\t\t[/<br>/g, ' '],            // Replace single br elements with space since they are word wrap BR:s\n\t\t\t\t[/<BR><BR>/g, '<br>']      // Replace back the double brs but into a single BR\n\t\t\t]);\n\n\t\t\treturn html;\n\t\t}\n\n\t\t/**\n\t\t * WebKit has a nasty bug where the all computed styles gets added to style attributes when copy/pasting contents.\n\t\t * This fix solves that by simply removing the whole style attribute.\n\t\t *\n\t\t * The paste_webkit_styles option can be set to specify what to keep:\n\t\t *  paste_webkit_styles: \"none\" // Keep no styles\n\t\t *  paste_webkit_styles: \"all\", // Keep all of them\n\t\t *  paste_webkit_styles: \"font-weight color\" // Keep specific ones\n\t\t *\n\t\t * @param {String} content Content that needs to be processed.\n\t\t * @return {String} Processed contents.\n\t\t */\n\t\tfunction removeWebKitStyles(content) {\n\t\t\t// Passthrough all styles from Word and let the WordFilter handle that junk\n\t\t\tif (WordFilter.isWordContent(content)) {\n\t\t\t\treturn content;\n\t\t\t}\n\n\t\t\t// Filter away styles that isn't matching the target node\n\t\t\tvar webKitStyles = editor.settings.paste_webkit_styles;\n\n\t\t\tif (editor.settings.paste_remove_styles_if_webkit === false || webKitStyles == \"all\") {\n\t\t\t\treturn content;\n\t\t\t}\n\n\t\t\tif (webKitStyles) {\n\t\t\t\twebKitStyles = webKitStyles.split(/[, ]/);\n\t\t\t}\n\n\t\t\t// Keep specific styles that doesn't match the current node computed style\n\t\t\tif (webKitStyles) {\n\t\t\t\tvar dom = editor.dom, node = editor.selection.getNode();\n\n\t\t\t\tcontent = content.replace(/(<[^>]+) style=\"([^\"]*)\"([^>]*>)/gi, function(all, before, value, after) {\n\t\t\t\t\tvar inputStyles = dom.parseStyle(value, 'span'), outputStyles = {};\n\n\t\t\t\t\tif (webKitStyles === \"none\") {\n\t\t\t\t\t\treturn before + after;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (var i = 0; i < webKitStyles.length; i++) {\n\t\t\t\t\t\tvar inputValue = inputStyles[webKitStyles[i]], currentValue = dom.getStyle(node, webKitStyles[i], true);\n\n\t\t\t\t\t\tif (/color/.test(webKitStyles[i])) {\n\t\t\t\t\t\t\tinputValue = dom.toHex(inputValue);\n\t\t\t\t\t\t\tcurrentValue = dom.toHex(currentValue);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (currentValue != inputValue) {\n\t\t\t\t\t\t\toutputStyles[webKitStyles[i]] = inputValue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\toutputStyles = dom.serializeStyle(outputStyles, 'span');\n\t\t\t\t\tif (outputStyles) {\n\t\t\t\t\t\treturn before + ' style=\"' + outputStyles + '\"' + after;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn before + after;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Remove all external styles\n\t\t\t\tcontent = content.replace(/(<[^>]+) style=\"([^\"]*)\"([^>]*>)/gi, '$1$3');\n\t\t\t}\n\n\t\t\t// Keep internal styles\n\t\t\tcontent = content.replace(/(<[^>]+) data-mce-style=\"([^\"]+)\"([^>]*>)/gi, function(all, before, value, after) {\n\t\t\t\treturn before + ' style=\"' + value + '\"' + after;\n\t\t\t});\n\n\t\t\treturn content;\n\t\t}\n\n\t\tfunction removeUnderlineAndFontInAnchor(root) {\n\t\t\teditor.$('a', root).find('font,u').each(function(i, node) {\n\t\t\t\teditor.dom.remove(node, true);\n\t\t\t});\n\t\t}\n\n\t\t// Sniff browsers and apply fixes since we can't feature detect\n\t\tif (Env.webkit) {\n\t\t\taddPreProcessFilter(removeWebKitStyles);\n\t\t}\n\n\t\tif (Env.ie) {\n\t\t\taddPreProcessFilter(removeExplorerBrElementsAfterBlocks);\n\t\t\taddPostProcessFilter(removeUnderlineAndFontInAnchor);\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/plugins/paste/classes/Plugin.js\n\n/**\n * Plugin.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains the tinymce plugin logic for the paste plugin.\n *\n * @class tinymce.pasteplugin.Plugin\n * @private\n */\ndefine(\"tinymce/pasteplugin/Plugin\", [\n\t\"tinymce/PluginManager\",\n\t\"tinymce/pasteplugin/Clipboard\",\n\t\"tinymce/pasteplugin/WordFilter\",\n\t\"tinymce/pasteplugin/Quirks\"\n], function(PluginManager, Clipboard, WordFilter, Quirks) {\n\tvar userIsInformed;\n\n\tPluginManager.add('paste', function(editor) {\n\t\tvar self = this, clipboard, settings = editor.settings;\n\n\t\tfunction isUserInformedAboutPlainText() {\n\t\t\treturn userIsInformed || editor.settings.paste_plaintext_inform === false;\n\t\t}\n\n\t\tfunction togglePlainTextPaste() {\n\t\t\tif (clipboard.pasteFormat == \"text\") {\n\t\t\t\tclipboard.pasteFormat = \"html\";\n\t\t\t\teditor.fire('PastePlainTextToggle', {state: false});\n\t\t\t} else {\n\t\t\t\tclipboard.pasteFormat = \"text\";\n\t\t\t\teditor.fire('PastePlainTextToggle', {state: true});\n\n\t\t\t\tif (!isUserInformedAboutPlainText()) {\n\t\t\t\t\tvar message = editor.translate('Paste is now in plain text mode. Contents will now ' +\n\t\t\t\t\t'be pasted as plain text until you toggle this option off.');\n\n\t\t\t\t\teditor.notificationManager.open({\n\t\t\t\t\t\ttext: message,\n\t\t\t\t\t\ttype: 'info'\n\t\t\t\t\t});\n\n\t\t\t\t\tuserIsInformed = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\teditor.focus();\n\t\t}\n\n\t\tfunction stateChange() {\n\t\t\tvar self = this;\n\n\t\t\tself.active(clipboard.pasteFormat === 'text');\n\n\t\t\teditor.on('PastePlainTextToggle', function (e) {\n\t\t\t\tself.active(e.state);\n\t\t\t});\n\t\t}\n\n\t\t// draw back if power version is requested and registered\n\t\tif (/(^|[ ,])powerpaste([, ]|$)/.test(settings.plugins) && PluginManager.get('powerpaste')) {\n\t\t\t/*eslint no-console:0 */\n\t\t\tif (typeof console !== \"undefined\" && console.log) {\n\t\t\t\tconsole.log(\"PowerPaste is incompatible with Paste plugin! Remove 'paste' from the 'plugins' option.\");\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tself.clipboard = clipboard = new Clipboard(editor);\n\t\tself.quirks = new Quirks(editor);\n\t\tself.wordFilter = new WordFilter(editor);\n\n\t\tif (editor.settings.paste_as_text) {\n\t\t\tself.clipboard.pasteFormat = \"text\";\n\t\t}\n\n\t\tif (settings.paste_preprocess) {\n\t\t\teditor.on('PastePreProcess', function(e) {\n\t\t\t\tsettings.paste_preprocess.call(self, self, e);\n\t\t\t});\n\t\t}\n\n\t\tif (settings.paste_postprocess) {\n\t\t\teditor.on('PastePostProcess', function(e) {\n\t\t\t\tsettings.paste_postprocess.call(self, self, e);\n\t\t\t});\n\t\t}\n\n\t\teditor.addCommand('mceInsertClipboardContent', function(ui, value) {\n\t\t\tif (value.content) {\n\t\t\t\tself.clipboard.pasteHtml(value.content);\n\t\t\t}\n\n\t\t\tif (value.text) {\n\t\t\t\tself.clipboard.pasteText(value.text);\n\t\t\t}\n\t\t});\n\n\t\t// Block all drag/drop events\n\t\tif (editor.settings.paste_block_drop) {\n\t\t\teditor.on('dragend dragover draggesture dragdrop drop drag', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\t\t}\n\n\t\t// Prevent users from dropping data images on Gecko\n\t\tif (!editor.settings.paste_data_images) {\n\t\t\teditor.on('drop', function(e) {\n\t\t\t\tvar dataTransfer = e.dataTransfer;\n\n\t\t\t\tif (dataTransfer && dataTransfer.files && dataTransfer.files.length > 0) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\teditor.addCommand('mceTogglePlainTextPaste', togglePlainTextPaste);\n\n\t\teditor.addButton('pastetext', {\n\t\t\ticon: 'pastetext',\n\t\t\ttooltip: 'Paste as text',\n\t\t\tonclick: togglePlainTextPaste,\n\t\t\tonPostRender: stateChange\n\t\t});\n\n\t\teditor.addMenuItem('pastetext', {\n\t\t\ttext: 'Paste as text',\n\t\t\tselectable: true,\n\t\t\tactive: clipboard.pasteFormat,\n\t\t\tonclick: togglePlainTextPaste,\n\t\t\tonPostRender: stateChange\n\t\t});\n\t});\n});\n\nexpose([\"tinymce/pasteplugin/Utils\"]);\n})(window);"

/***/ }),

/***/ 723:
/***/ (function(module, exports) {

module.exports = "(function () {\n\nvar defs = {}; // id -> {dependencies, definition, instance (possibly undefined)}\n\n// Used when there is no 'main' module.\n// The name is probably (hopefully) unique so minification removes for releases.\nvar register_3795 = function (id) {\n  var module = dem(id);\n  var fragments = id.split('.');\n  var target = Function('return this;')();\n  for (var i = 0; i < fragments.length - 1; ++i) {\n    if (target[fragments[i]] === undefined)\n      target[fragments[i]] = {};\n    target = target[fragments[i]];\n  }\n  target[fragments[fragments.length - 1]] = module;\n};\n\nvar instantiate = function (id) {\n  var actual = defs[id];\n  var dependencies = actual.deps;\n  var definition = actual.defn;\n  var len = dependencies.length;\n  var instances = new Array(len);\n  for (var i = 0; i < len; ++i)\n    instances[i] = dem(dependencies[i]);\n  var defResult = definition.apply(null, instances);\n  if (defResult === undefined)\n     throw 'module [' + id + '] returned undefined';\n  actual.instance = defResult;\n};\n\nvar def = function (id, dependencies, definition) {\n  if (typeof id !== 'string')\n    throw 'module id must be a string';\n  else if (dependencies === undefined)\n    throw 'no dependencies for ' + id;\n  else if (definition === undefined)\n    throw 'no definition function for ' + id;\n  defs[id] = {\n    deps: dependencies,\n    defn: definition,\n    instance: undefined\n  };\n};\n\nvar dem = function (id) {\n  var actual = defs[id];\n  if (actual === undefined)\n    throw 'module [' + id + '] was undefined';\n  else if (actual.instance === undefined)\n    instantiate(id);\n  return actual.instance;\n};\n\nvar req = function (ids, callback) {\n  var len = ids.length;\n  var instances = new Array(len);\n  for (var i = 0; i < len; ++i)\n    instances.push(dem(ids[i]));\n  callback.apply(null, callback);\n};\n\nvar ephox = {};\n\nephox.bolt = {\n  module: {\n    api: {\n      define: def,\n      require: req,\n      demand: dem\n    }\n  }\n};\n\nvar define = def;\nvar require = req;\nvar demand = dem;\n// this helps with minificiation when using a lot of global references\nvar defineGlobal = function (id, ref) {\n  define(id, [], function () { return ref; });\n};\n/*jsc\n[\"tinymce.modern.Theme\",\"global!tinymce.Env\",\"global!tinymce.EditorManager\",\"global!tinymce.ThemeManager\",\"tinymce.modern.modes.Iframe\",\"tinymce.modern.modes.Inline\",\"tinymce.modern.ui.Resize\",\"tinymce.modern.ui.ProgressState\",\"global!tinymce.util.Tools\",\"global!tinymce.ui.Factory\",\"global!tinymce.DOM\",\"tinymce.modern.ui.Toolbar\",\"tinymce.modern.ui.Menubar\",\"tinymce.modern.ui.ContextToolbars\",\"tinymce.modern.ui.A11y\",\"tinymce.modern.ui.Sidebar\",\"tinymce.modern.ui.SkinLoaded\",\"global!tinymce.ui.FloatPanel\",\"global!tinymce.ui.Throbber\",\"global!tinymce.util.Delay\",\"global!tinymce.geom.Rect\"]\njsc*/\ndefineGlobal(\"global!tinymce.Env\", tinymce.Env);\ndefineGlobal(\"global!tinymce.EditorManager\", tinymce.EditorManager);\ndefineGlobal(\"global!tinymce.ThemeManager\", tinymce.ThemeManager);\ndefineGlobal(\"global!tinymce.util.Tools\", tinymce.util.Tools);\ndefineGlobal(\"global!tinymce.ui.Factory\", tinymce.ui.Factory);\ndefineGlobal(\"global!tinymce.DOM\", tinymce.DOM);\n/**\n * Toolbar.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\ndefine('tinymce.modern.ui.Toolbar', [\n\t'global!tinymce.util.Tools',\n\t'global!tinymce.ui.Factory'\n], function (Tools, Factory) {\n\tvar defaultToolbar = \"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | \" +\n\t\t\"bullist numlist outdent indent | link image\";\n\n\tvar createToolbar = function (editor, items, size) {\n\t\tvar toolbarItems = [], buttonGroup;\n\n\t\tif (!items) {\n\t\t\treturn;\n\t\t}\n\n\t\tTools.each(items.split(/[ ,]/), function(item) {\n\t\t\tvar itemName;\n\n\t\t\tvar bindSelectorChanged = function () {\n\t\t\t\tvar selection = editor.selection;\n\n\t\t\t\tif (item.settings.stateSelector) {\n\t\t\t\t\tselection.selectorChanged(item.settings.stateSelector, function(state) {\n\t\t\t\t\t\titem.active(state);\n\t\t\t\t\t}, true);\n\t\t\t\t}\n\n\t\t\t\tif (item.settings.disabledStateSelector) {\n\t\t\t\t\tselection.selectorChanged(item.settings.disabledStateSelector, function(state) {\n\t\t\t\t\t\titem.disabled(state);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif (item == \"|\") {\n\t\t\t\tbuttonGroup = null;\n\t\t\t} else {\n\t\t\t\tif (Factory.has(item)) {\n\t\t\t\t\titem = {type: item, size: size};\n\t\t\t\t\ttoolbarItems.push(item);\n\t\t\t\t\tbuttonGroup = null;\n\t\t\t\t} else {\n\t\t\t\t\tif (!buttonGroup) {\n\t\t\t\t\t\tbuttonGroup = {type: 'buttongroup', items: []};\n\t\t\t\t\t\ttoolbarItems.push(buttonGroup);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (editor.buttons[item]) {\n\t\t\t\t\t\t// TODO: Move control creation to some UI class\n\t\t\t\t\t\titemName = item;\n\t\t\t\t\t\titem = editor.buttons[itemName];\n\n\t\t\t\t\t\tif (typeof item == \"function\") {\n\t\t\t\t\t\t\titem = item();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\titem.type = item.type || 'button';\n\t\t\t\t\t\titem.size = size;\n\n\t\t\t\t\t\titem = Factory.create(item);\n\t\t\t\t\t\tbuttonGroup.items.push(item);\n\n\t\t\t\t\t\tif (editor.initialized) {\n\t\t\t\t\t\t\tbindSelectorChanged();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\teditor.on('init', bindSelectorChanged);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\ttype: 'toolbar',\n\t\t\tlayout: 'flow',\n\t\t\titems: toolbarItems\n\t\t};\n\t};\n\n\t/**\n\t * Creates the toolbars from config and returns a toolbar array.\n\t *\n\t * @param {String} size Optional toolbar item size.\n\t * @return {Array} Array with toolbars.\n\t */\n\tvar createToolbars = function (editor, size) {\n\t\tvar toolbars = [], settings = editor.settings;\n\n\t\tvar addToolbar = function (items) {\n\t\t\tif (items) {\n\t\t\t\ttoolbars.push(createToolbar(editor, items, size));\n\t\t\t\treturn true;\n\t\t\t}\n\t\t};\n\n\t\t// Convert toolbar array to multiple options\n\t\tif (Tools.isArray(settings.toolbar)) {\n\t\t\t// Empty toolbar array is the same as a disabled toolbar\n\t\t\tif (settings.toolbar.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tTools.each(settings.toolbar, function(toolbar, i) {\n\t\t\t\tsettings[\"toolbar\" + (i + 1)] = toolbar;\n\t\t\t});\n\n\t\t\tdelete settings.toolbar;\n\t\t}\n\n\t\t// Generate toolbar<n>\n\t\tfor (var i = 1; i < 10; i++) {\n\t\t\tif (!addToolbar(settings[\"toolbar\" + i])) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// Generate toolbar or default toolbar unless it's disabled\n\t\tif (!toolbars.length && settings.toolbar !== false) {\n\t\t\taddToolbar(settings.toolbar || defaultToolbar);\n\t\t}\n\n\t\tif (toolbars.length) {\n\t\t\treturn {\n\t\t\t\ttype: 'panel',\n\t\t\t\tlayout: 'stack',\n\t\t\t\tclasses: \"toolbar-grp\",\n\t\t\t\tariaRoot: true,\n\t\t\t\tariaRemember: true,\n\t\t\t\titems: toolbars\n\t\t\t};\n\t\t}\n\t};\n\n\treturn {\n\t\tcreateToolbar: createToolbar,\n\t\tcreateToolbars: createToolbars\n\t};\n});\n\n/**\n * Menubar.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\ndefine('tinymce.modern.ui.Menubar', [\n\t'global!tinymce.util.Tools'\n], function (Tools) {\n\tvar defaultMenus = {\n\t\tfile: {title: 'File', items: 'newdocument'},\n\t\tedit: {title: 'Edit', items: 'undo redo | cut copy paste pastetext | selectall'},\n\t\tinsert: {title: 'Insert', items: '|'},\n\t\tview: {title: 'View', items: 'visualaid |'},\n\t\tformat: {title: 'Format', items: 'bold italic underline strikethrough superscript subscript | formats | removeformat'},\n\t\ttable: {title: 'Table'},\n\t\ttools: {title: 'Tools'}\n\t};\n\n\tvar createMenuItem = function (menuItems, name) {\n\t\tvar menuItem;\n\n\t\tif (name == '|') {\n\t\t\treturn {text: '|'};\n\t\t}\n\n\t\tmenuItem = menuItems[name];\n\n\t\treturn menuItem;\n\t};\n\n\tvar createMenu = function (editorMenuItems, settings, context) {\n\t\tvar menuButton, menu, menuItems, isUserDefined, removedMenuItems;\n\n\t\tremovedMenuItems = Tools.makeMap((settings.removed_menuitems || '').split(/[ ,]/));\n\n\t\t// User defined menu\n\t\tif (settings.menu) {\n\t\t\tmenu = settings.menu[context];\n\t\t\tisUserDefined = true;\n\t\t} else {\n\t\t\tmenu = defaultMenus[context];\n\t\t}\n\n\t\tif (menu) {\n\t\t\tmenuButton = {text: menu.title};\n\t\t\tmenuItems = [];\n\n\t\t\t// Default/user defined items\n\t\t\tTools.each((menu.items || '').split(/[ ,]/), function(item) {\n\t\t\t\tvar menuItem = createMenuItem(editorMenuItems, item);\n\n\t\t\t\tif (menuItem && !removedMenuItems[item]) {\n\t\t\t\t\tmenuItems.push(createMenuItem(editorMenuItems, item));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Added though context\n\t\t\tif (!isUserDefined) {\n\t\t\t\tTools.each(editorMenuItems, function(menuItem) {\n\t\t\t\t\tif (menuItem.context == context) {\n\t\t\t\t\t\tif (menuItem.separator == 'before') {\n\t\t\t\t\t\t\tmenuItems.push({text: '|'});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (menuItem.prependToContext) {\n\t\t\t\t\t\t\tmenuItems.unshift(menuItem);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmenuItems.push(menuItem);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (menuItem.separator == 'after') {\n\t\t\t\t\t\t\tmenuItems.push({text: '|'});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < menuItems.length; i++) {\n\t\t\t\tif (menuItems[i].text == '|') {\n\t\t\t\t\tif (i === 0 || i == menuItems.length - 1) {\n\t\t\t\t\t\tmenuItems.splice(i, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tmenuButton.menu = menuItems;\n\n\t\t\tif (!menuButton.menu.length) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\treturn menuButton;\n\t};\n\n\tvar createMenuButtons = function (editor) {\n\t\tvar name, menuButtons = [], settings = editor.settings;\n\n\t\tvar defaultMenuBar = [];\n\t\tif (settings.menu) {\n\t\t\tfor (name in settings.menu) {\n\t\t\t\tdefaultMenuBar.push(name);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (name in defaultMenus) {\n\t\t\t\tdefaultMenuBar.push(name);\n\t\t\t}\n\t\t}\n\n\t\tvar enabledMenuNames = typeof settings.menubar == \"string\" ? settings.menubar.split(/[ ,]/) : defaultMenuBar;\n\t\tfor (var i = 0; i < enabledMenuNames.length; i++) {\n\t\t\tvar menu = enabledMenuNames[i];\n\t\t\tmenu = createMenu(editor.menuItems, editor.settings, menu);\n\n\t\t\tif (menu) {\n\t\t\t\tmenuButtons.push(menu);\n\t\t\t}\n\t\t}\n\n\t\treturn menuButtons;\n\t};\n\n\treturn {\n\t\tcreateMenuButtons: createMenuButtons\n\t};\n});\n\ndefineGlobal(\"global!tinymce.util.Delay\", tinymce.util.Delay);\ndefineGlobal(\"global!tinymce.geom.Rect\", tinymce.geom.Rect);\n/**\n * ContextToolbars.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\ndefine('tinymce.modern.ui.ContextToolbars', [\n\t'global!tinymce.DOM',\n\t'global!tinymce.util.Tools',\n\t'global!tinymce.util.Delay',\n\t'tinymce.modern.ui.Toolbar',\n\t'global!tinymce.ui.Factory',\n\t'global!tinymce.geom.Rect'\n], function (DOM, Tools, Delay, Toolbar, Factory, Rect) {\n\tvar toClientRect = function (geomRect) {\n\t\treturn {\n\t\t\tleft: geomRect.x,\n\t\t\ttop: geomRect.y,\n\t\t\twidth: geomRect.w,\n\t\t\theight: geomRect.h,\n\t\t\tright: geomRect.x + geomRect.w,\n\t\t\tbottom: geomRect.y + geomRect.h\n\t\t};\n\t};\n\n\tvar hideAllFloatingPanels = function (editor) {\n\t\tTools.each(editor.contextToolbars, function(toolbar) {\n\t\t\tif (toolbar.panel) {\n\t\t\t\ttoolbar.panel.hide();\n\t\t\t}\n\t\t});\n\t};\n\n\tvar movePanelTo = function (panel, pos) {\n\t\tpanel.moveTo(pos.left, pos.top);\n\t};\n\n\tvar togglePositionClass = function (panel, relPos, predicate) {\n\t\trelPos = relPos ? relPos.substr(0, 2) : '';\n\n\t\tTools.each({\n\t\t\tt: 'down',\n\t\t\tb: 'up'\n\t\t}, function(cls, pos) {\n\t\t\tpanel.classes.toggle('arrow-' + cls, predicate(pos, relPos.substr(0, 1)));\n\t\t});\n\n\t\tTools.each({\n\t\t\tl: 'left',\n\t\t\tr: 'right'\n\t\t}, function(cls, pos) {\n\t\t\tpanel.classes.toggle('arrow-' + cls, predicate(pos, relPos.substr(1, 1)));\n\t\t});\n\t};\n\n\tvar userConstrain = function (handler, x, y, elementRect, contentAreaRect, panelRect) {\n\t\tpanelRect = toClientRect({x: x, y: y, w: panelRect.w, h: panelRect.h});\n\n\t\tif (handler) {\n\t\t\tpanelRect = handler({\n\t\t\t\telementRect: toClientRect(elementRect),\n\t\t\t\tcontentAreaRect: toClientRect(contentAreaRect),\n\t\t\t\tpanelRect: panelRect\n\t\t\t});\n\t\t}\n\n\t\treturn panelRect;\n\t};\n\n\tvar addContextualToolbars = function (editor) {\n\t\tvar scrollContainer, settings = editor.settings;\n\n\t\tvar getContextToolbars = function () {\n\t\t\treturn editor.contextToolbars || [];\n\t\t};\n\n\t\tvar getElementRect = function (elm) {\n\t\t\tvar pos, targetRect, root;\n\n\t\t\tpos = DOM.getPos(editor.getContentAreaContainer());\n\t\t\ttargetRect = editor.dom.getRect(elm);\n\t\t\troot = editor.dom.getRoot();\n\n\t\t\t// Adjust targetPos for scrolling in the editor\n\t\t\tif (root.nodeName === 'BODY') {\n\t\t\t\ttargetRect.x -= root.ownerDocument.documentElement.scrollLeft || root.scrollLeft;\n\t\t\t\ttargetRect.y -= root.ownerDocument.documentElement.scrollTop || root.scrollTop;\n\t\t\t}\n\n\t\t\ttargetRect.x += pos.x;\n\t\t\ttargetRect.y += pos.y;\n\n\t\t\treturn targetRect;\n\t\t};\n\n\t\tvar reposition = function (match, shouldShow) {\n\t\t\tvar relPos, panelRect, elementRect, contentAreaRect, panel, relRect, testPositions, smallElementWidthThreshold;\n\t\t\tvar handler = settings.inline_toolbar_position_handler;\n\n\t\t\tif (editor.removed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!match || !match.toolbar.panel) {\n\t\t\t\thideAllFloatingPanels(editor);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttestPositions = [\n\t\t\t\t'bc-tc', 'tc-bc',\n\t\t\t\t'tl-bl', 'bl-tl',\n\t\t\t\t'tr-br', 'br-tr'\n\t\t\t];\n\n\t\t\tpanel = match.toolbar.panel;\n\n\t\t\t// Only show the panel on some events not for example nodeChange since that fires when context menu is opened\n\t\t\tif (shouldShow) {\n\t\t\t\tpanel.show();\n\t\t\t}\n\n\t\t\telementRect = getElementRect(match.element);\n\t\t\tpanelRect = DOM.getRect(panel.getEl());\n\t\t\tcontentAreaRect = DOM.getRect(editor.getContentAreaContainer() || editor.getBody());\n\t\t\tsmallElementWidthThreshold = 25;\n\n\t\t\tif (DOM.getStyle(match.element, 'display', true) !== 'inline') {\n\t\t\t\t// We need to use these instead of the rect values since the style\n\t\t\t\t// size properites might not be the same as the real size for a table\n\t\t\t\telementRect.w = match.element.clientWidth;\n\t\t\t\telementRect.h = match.element.clientHeight;\n\t\t\t}\n\n\t\t\tif (!editor.inline) {\n\t\t\t\tcontentAreaRect.w = editor.getDoc().documentElement.offsetWidth;\n\t\t\t}\n\n\t\t\t// Inflate the elementRect so it doesn't get placed above resize handles\n\t\t\tif (editor.selection.controlSelection.isResizable(match.element) && elementRect.w < smallElementWidthThreshold) {\n\t\t\t\telementRect = Rect.inflate(elementRect, 0, 8);\n\t\t\t}\n\n\t\t\trelPos = Rect.findBestRelativePosition(panelRect, elementRect, contentAreaRect, testPositions);\n\t\t\telementRect = Rect.clamp(elementRect, contentAreaRect);\n\n\t\t\tif (relPos) {\n\t\t\t\trelRect = Rect.relativePosition(panelRect, elementRect, relPos);\n\t\t\t\tmovePanelTo(panel, userConstrain(handler, relRect.x, relRect.y, elementRect, contentAreaRect, panelRect));\n\t\t\t} else {\n\t\t\t\t// Allow overflow below the editor to avoid placing toolbars ontop of tables\n\t\t\t\tcontentAreaRect.h += panelRect.h;\n\n\t\t\t\telementRect = Rect.intersect(contentAreaRect, elementRect);\n\t\t\t\tif (elementRect) {\n\t\t\t\t\trelPos = Rect.findBestRelativePosition(panelRect, elementRect, contentAreaRect, [\n\t\t\t\t\t\t'bc-tc', 'bl-tl', 'br-tr'\n\t\t\t\t\t]);\n\n\t\t\t\t\tif (relPos) {\n\t\t\t\t\t\trelRect = Rect.relativePosition(panelRect, elementRect, relPos);\n\t\t\t\t\t\tmovePanelTo(panel, userConstrain(handler, relRect.x, relRect.y, elementRect, contentAreaRect, panelRect));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmovePanelTo(panel, userConstrain(handler, elementRect.x, elementRect.y, elementRect, contentAreaRect, panelRect));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tpanel.hide();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttogglePositionClass(panel, relPos, function(pos1, pos2) {\n\t\t\t\treturn pos1 === pos2;\n\t\t\t});\n\n\t\t\t//drawRect(contentAreaRect, 'blue');\n\t\t\t//drawRect(elementRect, 'red');\n\t\t\t//drawRect(panelRect, 'green');\n\t\t};\n\n\t\tvar repositionHandler = function (show) {\n\t\t\treturn function () {\n\t\t\t\tvar execute = function () {\n\t\t\t\t\tif (editor.selection) {\n\t\t\t\t\t\treposition(findFrontMostMatch(editor.selection.getNode()), show);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tDelay.requestAnimationFrame(execute);\n\t\t\t};\n\t\t};\n\n\t\tvar bindScrollEvent = function () {\n\t\t\tif (!scrollContainer) {\n\t\t\t\tscrollContainer = editor.selection.getScrollContainer() || editor.getWin();\n\t\t\t\tDOM.bind(scrollContainer, 'scroll', repositionHandler(true));\n\n\t\t\t\teditor.on('remove', function() {\n\t\t\t\t\tDOM.unbind(scrollContainer, 'scroll');\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tvar showContextToolbar = function (match) {\n\t\t\tvar panel;\n\n\t\t\tif (match.toolbar.panel) {\n\t\t\t\tmatch.toolbar.panel.show();\n\t\t\t\treposition(match);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbindScrollEvent();\n\n\t\t\tpanel = Factory.create({\n\t\t\t\ttype: 'floatpanel',\n\t\t\t\trole: 'dialog',\n\t\t\t\tclasses: 'tinymce tinymce-inline arrow',\n\t\t\t\tariaLabel: 'Inline toolbar',\n\t\t\t\tlayout: 'flex',\n\t\t\t\tdirection: 'column',\n\t\t\t\talign: 'stretch',\n\t\t\t\tautohide: false,\n\t\t\t\tautofix: true,\n\t\t\t\tfixed: true,\n\t\t\t\tborder: 1,\n\t\t\t\titems: Toolbar.createToolbar(editor, match.toolbar.items),\n\t\t\t\toncancel: function() {\n\t\t\t\t\teditor.focus();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tmatch.toolbar.panel = panel;\n\t\t\tpanel.renderTo(document.body).reflow();\n\t\t\treposition(match);\n\t\t};\n\n\t\tvar hideAllContextToolbars = function () {\n\t\t\tTools.each(getContextToolbars(), function(toolbar) {\n\t\t\t\tif (toolbar.panel) {\n\t\t\t\t\ttoolbar.panel.hide();\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tvar findFrontMostMatch = function (targetElm) {\n\t\t\tvar i, y, parentsAndSelf, toolbars = getContextToolbars();\n\n\t\t\tparentsAndSelf = editor.$(targetElm).parents().add(targetElm);\n\t\t\tfor (i = parentsAndSelf.length - 1; i >= 0; i--) {\n\t\t\t\tfor (y = toolbars.length - 1; y >= 0; y--) {\n\t\t\t\t\tif (toolbars[y].predicate(parentsAndSelf[i])) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttoolbar: toolbars[y],\n\t\t\t\t\t\t\telement: parentsAndSelf[i]\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t};\n\n\t\teditor.on('click keyup setContent ObjectResized', function(e) {\n\t\t\t// Only act on partial inserts\n\t\t\tif (e.type === 'setcontent' && !e.selection) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Needs to be delayed to avoid Chrome img focus out bug\n\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\tvar match;\n\n\t\t\t\tmatch = findFrontMostMatch(editor.selection.getNode());\n\t\t\t\tif (match) {\n\t\t\t\t\thideAllContextToolbars();\n\t\t\t\t\tshowContextToolbar(match);\n\t\t\t\t} else {\n\t\t\t\t\thideAllContextToolbars();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\teditor.on('blur hide contextmenu', hideAllContextToolbars);\n\n\t\teditor.on('ObjectResizeStart', function() {\n\t\t\tvar match = findFrontMostMatch(editor.selection.getNode());\n\n\t\t\tif (match && match.toolbar.panel) {\n\t\t\t\tmatch.toolbar.panel.hide();\n\t\t\t}\n\t\t});\n\n\t\teditor.on('ResizeEditor ResizeWindow', repositionHandler(true));\n\t\teditor.on('nodeChange', repositionHandler(false));\n\n\t\teditor.on('remove', function() {\n\t\t\tTools.each(getContextToolbars(), function(toolbar) {\n\t\t\t\tif (toolbar.panel) {\n\t\t\t\t\ttoolbar.panel.remove();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.contextToolbars = {};\n\t\t});\n\n\t\teditor.shortcuts.add('ctrl+shift+e > ctrl+shift+p', '', function() {\n\t\t\tvar match = findFrontMostMatch(editor.selection.getNode());\n\t\t\tif (match && match.toolbar.panel) {\n\t\t\t\tmatch.toolbar.panel.items()[0].focus();\n\t\t\t}\n\t\t});\n\t};\n\n\treturn {\n\t\taddContextualToolbars: addContextualToolbars\n\t};\n});\n\n/**\n * A11y.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\ndefine('tinymce.modern.ui.A11y', [\n], function () {\n\tvar focus = function (panel, type) {\n\t\treturn function () {\n\t\t\tvar item = panel.find(type)[0];\n\n\t\t\tif (item) {\n\t\t\t\titem.focus(true);\n\t\t\t}\n\t\t};\n\t};\n\n\tvar addKeys = function (editor, panel) {\n\t\teditor.shortcuts.add('Alt+F9', '', focus(panel, 'menubar'));\n\t\teditor.shortcuts.add('Alt+F10,F10', '', focus(panel, 'toolbar'));\n\t\teditor.shortcuts.add('Alt+F11', '', focus(panel, 'elementpath'));\n\t\tpanel.on('cancel', function() {\n\t\t\teditor.focus();\n\t\t});\n\t};\n\n\treturn {\n\t\taddKeys: addKeys\n\t};\n});\n\n/**\n * Sidebar.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\ndefine('tinymce.modern.ui.Sidebar', [\n\t'global!tinymce.util.Tools',\n\t'global!tinymce.ui.Factory',\n\t'global!tinymce.Env'\n], function (Tools, Factory, Env) {\n\tvar api = function (elm) {\n\t\treturn {\n\t\t\telement: function () {\n\t\t\t\treturn elm;\n\t\t\t}\n\t\t};\n\t};\n\n\tvar trigger = function (sidebar, panel, callbackName) {\n\t\tvar callback = sidebar.settings[callbackName];\n\t\tif (callback) {\n\t\t\tcallback(api(panel.getEl('body')));\n\t\t}\n\t};\n\n\tvar hidePanels = function (name, container, sidebars) {\n\t\tTools.each(sidebars, function (sidebar) {\n\t\t\tvar panel = container.items().filter('#' + sidebar.name)[0];\n\n\t\t\tif (panel && panel.visible() && sidebar.name !== name) {\n\t\t\t\ttrigger(sidebar, panel, 'onhide');\n\t\t\t\tpanel.visible(false);\n\t\t\t}\n\t\t});\n\t};\n\n\tvar deactivateButtons = function (toolbar) {\n\t\ttoolbar.items().each(function (ctrl) {\n\t\t\tctrl.active(false);\n\t\t});\n\t};\n\n\tvar findSidebar = function (sidebars, name) {\n\t\treturn Tools.grep(sidebars, function (sidebar) {\n\t\t\treturn sidebar.name === name;\n\t\t})[0];\n\t};\n\n\tvar showPanel = function (editor, name, sidebars) {\n\t\treturn function (e) {\n\t\t\tvar btnCtrl = e.control;\n\t\t\tvar container = btnCtrl.parents().filter('panel')[0];\n\t\t\tvar panel = container.find('#' + name)[0];\n\t\t\tvar sidebar = findSidebar(sidebars, name);\n\n\t\t\thidePanels(name, container, sidebars);\n\t\t\tdeactivateButtons(btnCtrl.parent());\n\n\t\t\tif (panel && panel.visible()) {\n\t\t\t\ttrigger(sidebar, panel, 'onhide');\n\t\t\t\tpanel.hide();\n\t\t\t\tbtnCtrl.active(false);\n\t\t\t} else {\n\t\t\t\tif (panel) {\n\t\t\t\t\tpanel.show();\n\t\t\t\t\ttrigger(sidebar, panel, 'onshow');\n\t\t\t\t} else {\n\t\t\t\t\tpanel = Factory.create({\n\t\t\t\t\t\ttype: 'container',\n\t\t\t\t\t\tname: name,\n\t\t\t\t\t\tlayout: 'stack',\n\t\t\t\t\t\tclasses: 'sidebar-panel',\n\t\t\t\t\t\thtml: ''\n\t\t\t\t\t});\n\n\t\t\t\t\tcontainer.prepend(panel);\n\t\t\t\t\ttrigger(sidebar, panel, 'onrender');\n\t\t\t\t\ttrigger(sidebar, panel, 'onshow');\n\t\t\t\t}\n\n\t\t\t\tbtnCtrl.active(true);\n\t\t\t}\n\n\t\t\teditor.fire('ResizeEditor');\n\t\t};\n\t};\n\n\tvar isModernBrowser = function () {\n\t\treturn !Env.ie || Env.ie >= 11;\n\t};\n\n\tvar hasSidebar = function (editor) {\n\t\treturn isModernBrowser() && editor.sidebars ? editor.sidebars.length > 0 : false;\n\t};\n\n\tvar createSidebar = function (editor) {\n\t\tvar buttons = Tools.map(editor.sidebars, function (sidebar) {\n\t\t\tvar settings = sidebar.settings;\n\n\t\t\treturn {\n\t\t\t\ttype: 'button',\n\t\t\t\ticon: settings.icon,\n\t\t\t\timage: settings.image,\n\t\t\t\ttooltip: settings.tooltip,\n\t\t\t\tonclick: showPanel(editor, sidebar.name, editor.sidebars)\n\t\t\t};\n\t\t});\n\n\t\treturn {\n\t\t\ttype: 'panel',\n\t\t\tname: 'sidebar',\n\t\t\tlayout: 'stack',\n\t\t\tclasses: 'sidebar',\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'toolbar',\n\t\t\t\t\tlayout: 'stack',\n\t\t\t\t\tclasses: 'sidebar-toolbar',\n\t\t\t\t\titems: buttons\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t};\n\n\treturn {\n\t\thasSidebar: hasSidebar,\n\t\tcreateSidebar: createSidebar\n\t};\n});\n/**\n * SkinLoaded.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\ndefine('tinymce.modern.ui.SkinLoaded', [\n], function () {\n\tvar fireSkinLoaded = function (editor) {\n\t\tvar done = function () {\n\t\t\teditor._skinLoaded = true;\n\t\t\teditor.fire('SkinLoaded');\n\t\t};\n\n\t\treturn function() {\n\t\t\tif (editor.initialized) {\n\t\t\t\tdone();\n\t\t\t} else {\n\t\t\t\teditor.on('init', done);\n\t\t\t}\n\t\t};\n\t};\n\n\treturn {\n\t\tfireSkinLoaded: fireSkinLoaded\n\t};\n});\n\n/**\n * Resize.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\ndefine('tinymce.modern.ui.Resize', [\n\t'global!tinymce.DOM'\n], function (DOM) {\n\tvar getSize = function (elm) {\n\t\treturn {\n\t\t\twidth: elm.clientWidth,\n\t\t\theight: elm.clientHeight\n\t\t};\n\t};\n\n\tvar resizeTo = function (editor, width, height) {\n\t\tvar containerElm, iframeElm, containerSize, iframeSize, settings = editor.settings;\n\n\t\tcontainerElm = editor.getContainer();\n\t\tiframeElm = editor.getContentAreaContainer().firstChild;\n\t\tcontainerSize = getSize(containerElm);\n\t\tiframeSize = getSize(iframeElm);\n\n\t\tif (width !== null) {\n\t\t\twidth = Math.max(settings.min_width || 100, width);\n\t\t\twidth = Math.min(settings.max_width || 0xFFFF, width);\n\n\t\t\tDOM.setStyle(containerElm, 'width', width + (containerSize.width - iframeSize.width));\n\t\t\tDOM.setStyle(iframeElm, 'width', width);\n\t\t}\n\n\t\theight = Math.max(settings.min_height || 100, height);\n\t\theight = Math.min(settings.max_height || 0xFFFF, height);\n\t\tDOM.setStyle(iframeElm, 'height', height);\n\n\t\teditor.fire('ResizeEditor');\n\t};\n\n\tvar resizeBy = function (editor, dw, dh) {\n\t\tvar elm = editor.getContentAreaContainer();\n\t\tresizeTo(editor, elm.clientWidth + dw, elm.clientHeight + dh);\n\t};\n\n\treturn {\n\t\tresizeTo: resizeTo,\n\t\tresizeBy: resizeBy\n\t};\n});\n\n/**\n * Iframe.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\ndefine('tinymce.modern.modes.Iframe', [\n\t'global!tinymce.util.Tools',\n\t'global!tinymce.ui.Factory',\n\t'global!tinymce.DOM',\n\t'tinymce.modern.ui.Toolbar',\n\t'tinymce.modern.ui.Menubar',\n\t'tinymce.modern.ui.ContextToolbars',\n\t'tinymce.modern.ui.A11y',\n\t'tinymce.modern.ui.Sidebar',\n\t'tinymce.modern.ui.SkinLoaded',\n\t'tinymce.modern.ui.Resize'\n], function (Tools, Factory, DOM, Toolbar, Menubar, ContextToolbars, A11y, Sidebar, SkinLoaded, Resize) {\n\tvar switchMode = function (panel) {\n\t\treturn function(e) {\n\t\t\tpanel.find('*').disabled(e.mode === 'readonly');\n\t\t};\n\t};\n\n\tvar editArea = function (border) {\n\t\treturn {\n\t\t\ttype: 'panel',\n\t\t\tname: 'iframe',\n\t\t\tlayout: 'stack',\n\t\t\tclasses: 'edit-area',\n\t\t\tborder: border,\n\t\t\thtml: ''\n\t\t};\n\t};\n\n\tvar editAreaContainer = function (editor) {\n\t\treturn {\n\t\t\ttype: 'panel',\n\t\t\tlayout: 'stack',\n\t\t\tclasses: 'edit-aria-container',\n\t\t\tborder: '1 0 0 0',\n\t\t\titems: [\n\t\t\t\teditArea('0'),\n\t\t\t\tSidebar.createSidebar(editor)\n\t\t\t]\n\t\t};\n\t};\n\n\tvar render = function (editor, theme, args) {\n\t\tvar panel, resizeHandleCtrl, startSize, settings = editor.settings;\n\n\t\tif (args.skinUiCss) {\n\t\t\tDOM.styleSheetLoader.load(args.skinUiCss, SkinLoaded.fireSkinLoaded(editor));\n\t\t}\n\n\t\tpanel = theme.panel = Factory.create({\n\t\t\ttype: 'panel',\n\t\t\trole: 'application',\n\t\t\tclasses: 'tinymce',\n\t\t\tstyle: 'visibility: hidden',\n\t\t\tlayout: 'stack',\n\t\t\tborder: 1,\n\t\t\titems: [\n\t\t\t\tsettings.menubar === false ? null : {type: 'menubar', border: '0 0 1 0', items: Menubar.createMenuButtons(editor)},\n\t\t\t\tToolbar.createToolbars(editor, settings.toolbar_items_size),\n\t\t\t\tSidebar.hasSidebar(editor) ? editAreaContainer(editor) : editArea('1 0 0 0')\n\t\t\t]\n\t\t});\n\n\t\tif (settings.resize !== false) {\n\t\t\tresizeHandleCtrl = {\n\t\t\t\ttype: 'resizehandle',\n\t\t\t\tdirection: settings.resize,\n\n\t\t\t\tonResizeStart: function() {\n\t\t\t\t\tvar elm = editor.getContentAreaContainer().firstChild;\n\n\t\t\t\t\tstartSize = {\n\t\t\t\t\t\twidth: elm.clientWidth,\n\t\t\t\t\t\theight: elm.clientHeight\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\tonResize: function(e) {\n\t\t\t\t\tif (settings.resize === 'both') {\n\t\t\t\t\t\tResize.resizeTo(editor, startSize.width + e.deltaX, startSize.height + e.deltaY);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tResize.resizeTo(editor, null, startSize.height + e.deltaY);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\t// Add statusbar if needed\n\t\tif (settings.statusbar !== false) {\n\t\t\tpanel.add({type: 'panel', name: 'statusbar', classes: 'statusbar', layout: 'flow', border: '1 0 0 0', ariaRoot: true, items: [\n\t\t\t\t{type: 'elementpath', editor: editor},\n\t\t\t\tresizeHandleCtrl\n\t\t\t]});\n\t\t}\n\n\t\teditor.fire('BeforeRenderUI');\n\t\teditor.on('SwitchMode', switchMode(panel));\n\t\tpanel.renderBefore(args.targetNode).reflow();\n\n\t\tif (settings.readonly) {\n\t\t\teditor.setMode('readonly');\n\t\t}\n\n\t\tif (settings.width) {\n\t\t\tDOM.setStyle(panel.getEl(), 'width', settings.width);\n\t\t}\n\n\t\t// Remove the panel when the editor is removed\n\t\teditor.on('remove', function() {\n\t\t\tpanel.remove();\n\t\t\tpanel = null;\n\t\t});\n\n\t\t// Add accesibility shortcuts\n\t\tA11y.addKeys(editor, panel);\n\t\tContextToolbars.addContextualToolbars(editor);\n\n\t\treturn {\n\t\t\tiframeContainer: panel.find('#iframe')[0].getEl(),\n\t\t\teditorContainer: panel.getEl()\n\t\t};\n\t};\n\n\treturn {\n\t\trender: render\n\t};\n});\n\ndefineGlobal(\"global!tinymce.ui.FloatPanel\", tinymce.ui.FloatPanel);\n/**\n * Inline.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\ndefine('tinymce.modern.modes.Inline', [\n\t'global!tinymce.util.Tools',\n\t'global!tinymce.ui.Factory',\n\t'global!tinymce.DOM',\n\t'global!tinymce.ui.FloatPanel',\n\t'tinymce.modern.ui.Toolbar',\n\t'tinymce.modern.ui.Menubar',\n\t'tinymce.modern.ui.ContextToolbars',\n\t'tinymce.modern.ui.A11y',\n\t'tinymce.modern.ui.SkinLoaded'\n], function (Tools, Factory, DOM, FloatPanel, Toolbar, Menubar, ContextToolbars, A11y, SkinLoaded) {\n\tvar render = function (editor, theme, args) {\n\t\tvar panel, inlineToolbarContainer, settings = editor.settings;\n\n\t\tif (settings.fixed_toolbar_container) {\n\t\t\tinlineToolbarContainer = DOM.select(settings.fixed_toolbar_container)[0];\n\t\t}\n\n\t\tvar reposition = function () {\n\t\t\tif (panel && panel.moveRel && panel.visible() && !panel._fixed) {\n\t\t\t\t// TODO: This is kind of ugly and doesn't handle multiple scrollable elements\n\t\t\t\tvar scrollContainer = editor.selection.getScrollContainer(), body = editor.getBody();\n\t\t\t\tvar deltaX = 0, deltaY = 0;\n\n\t\t\t\tif (scrollContainer) {\n\t\t\t\t\tvar bodyPos = DOM.getPos(body), scrollContainerPos = DOM.getPos(scrollContainer);\n\n\t\t\t\t\tdeltaX = Math.max(0, scrollContainerPos.x - bodyPos.x);\n\t\t\t\t\tdeltaY = Math.max(0, scrollContainerPos.y - bodyPos.y);\n\t\t\t\t}\n\n\t\t\t\tpanel.fixed(false).moveRel(body, editor.rtl ? ['tr-br', 'br-tr'] : ['tl-bl', 'bl-tl', 'tr-br']).moveBy(deltaX, deltaY);\n\t\t\t}\n\t\t};\n\n\t\tvar show = function () {\n\t\t\tif (panel) {\n\t\t\t\tpanel.show();\n\t\t\t\treposition();\n\t\t\t\tDOM.addClass(editor.getBody(), 'mce-edit-focus');\n\t\t\t}\n\t\t};\n\n\t\tvar hide = function () {\n\t\t\tif (panel) {\n\t\t\t\t// We require two events as the inline float panel based toolbar does not have autohide=true\n\t\t\t\tpanel.hide();\n\n\t\t\t\t// All other autohidden float panels will be closed below.\n\t\t\t\tFloatPanel.hideAll();\n\n\t\t\t\tDOM.removeClass(editor.getBody(), 'mce-edit-focus');\n\t\t\t}\n\t\t};\n\n\t\tvar render = function () {\n\t\t\tif (panel) {\n\t\t\t\tif (!panel.visible()) {\n\t\t\t\t\tshow();\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Render a plain panel inside the inlineToolbarContainer if it's defined\n\t\t\tpanel = theme.panel = Factory.create({\n\t\t\t\ttype: inlineToolbarContainer ? 'panel' : 'floatpanel',\n\t\t\t\trole: 'application',\n\t\t\t\tclasses: 'tinymce tinymce-inline',\n\t\t\t\tlayout: 'flex',\n\t\t\t\tdirection: 'column',\n\t\t\t\talign: 'stretch',\n\t\t\t\tautohide: false,\n\t\t\t\tautofix: true,\n\t\t\t\tfixed: !!inlineToolbarContainer,\n\t\t\t\tborder: 1,\n\t\t\t\titems: [\n\t\t\t\t\tsettings.menubar === false ? null : {type: 'menubar', border: '0 0 1 0', items: Menubar.createMenuButtons(editor)},\n\t\t\t\t\tToolbar.createToolbars(editor, settings.toolbar_items_size)\n\t\t\t\t]\n\t\t\t});\n\n\t\t\t// Add statusbar\n\t\t\t/*if (settings.statusbar !== false) {\n\t\t\t\tpanel.add({type: 'panel', classes: 'statusbar', layout: 'flow', border: '1 0 0 0', items: [\n\t\t\t\t\t{type: 'elementpath'}\n\t\t\t\t]});\n\t\t\t}*/\n\n\t\t\teditor.fire('BeforeRenderUI');\n\t\t\tpanel.renderTo(inlineToolbarContainer || document.body).reflow();\n\n\t\t\tA11y.addKeys(editor, panel);\n\t\t\tshow();\n\t\t\tContextToolbars.addContextualToolbars(editor);\n\n\t\t\teditor.on('nodeChange', reposition);\n\t\t\teditor.on('activate', show);\n\t\t\teditor.on('deactivate', hide);\n\n\t\t\teditor.nodeChanged();\n\t\t};\n\n\t\tsettings.content_editable = true;\n\n\t\teditor.on('focus', function() {\n\t\t\t// Render only when the CSS file has been loaded\n\t\t\tif (args.skinUiCss) {\n\t\t\t\tDOM.styleSheetLoader.load(args.skinUiCss, render, render);\n\t\t\t} else {\n\t\t\t\trender();\n\t\t\t}\n\t\t});\n\n\t\teditor.on('blur hide', hide);\n\n\t\t// Remove the panel when the editor is removed\n\t\teditor.on('remove', function() {\n\t\t\tif (panel) {\n\t\t\t\tpanel.remove();\n\t\t\t\tpanel = null;\n\t\t\t}\n\t\t});\n\n\t\t// Preload skin css\n\t\tif (args.skinUiCss) {\n\t\t\tDOM.styleSheetLoader.load(args.skinUiCss, SkinLoaded.fireSkinLoaded(editor));\n\t\t}\n\n\t\treturn {};\n\t};\n\n\treturn {\n\t\trender: render\n\t};\n});\n\ndefineGlobal(\"global!tinymce.ui.Throbber\", tinymce.ui.Throbber);\n/**\n * ProgressState.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\ndefine('tinymce.modern.ui.ProgressState', [\n\t'global!tinymce.ui.Throbber'\n], function (Throbber) {\n\tvar setup = function (editor, theme) {\n\t\tvar throbber;\n\n\t\teditor.on('ProgressState', function(e) {\n\t\t\tthrobber = throbber || new Throbber(theme.panel.getEl('body'));\n\n\t\t\tif (e.state) {\n\t\t\t\tthrobber.show(e.time);\n\t\t\t} else {\n\t\t\t\tthrobber.hide();\n\t\t\t}\n\t\t});\n\t};\n\n\treturn {\n\t\tsetup: setup\n\t};\n});\n\n/**\n * Theme.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\ndefine('tinymce.modern.Theme', [\n\t'global!tinymce.Env',\n\t'global!tinymce.EditorManager',\n\t'global!tinymce.ThemeManager',\n\t'tinymce.modern.modes.Iframe',\n\t'tinymce.modern.modes.Inline',\n\t'tinymce.modern.ui.Resize',\n\t'tinymce.modern.ui.ProgressState'\n], function (Env, EditorManager, ThemeManager, Iframe, Inline, Resize, ProgressState) {\n\tvar renderUI = function(editor, theme, args) {\n\t\tvar settings = editor.settings;\n\t\tvar skin = settings.skin !== false ? settings.skin || 'lightgray' : false;\n\n\t\tif (skin) {\n\t\t\tvar skinUrl = settings.skin_url;\n\n\t\t\tif (skinUrl) {\n\t\t\t\tskinUrl = editor.documentBaseURI.toAbsolute(skinUrl);\n\t\t\t} else {\n\t\t\t\tskinUrl = EditorManager.baseURL + '/skins/' + skin;\n\t\t\t}\n\n\t\t\t// Load special skin for IE7\n\t\t\t// TODO: Remove this when we drop IE7 support\n\t\t\tif (Env.documentMode <= 7) {\n\t\t\t\targs.skinUiCss = skinUrl + '/skin.ie7.min.css';\n\t\t\t} else {\n\t\t\t\targs.skinUiCss = skinUrl + '/skin.min.css';\n\t\t\t}\n\n\t\t\t// Load content.min.css or content.inline.min.css\n\t\t\teditor.contentCSS.push(skinUrl + '/content' + (editor.inline ? '.inline' : '') + '.min.css');\n\t\t}\n\n\t\tProgressState.setup(editor, theme);\n\n\t\tif (settings.inline) {\n\t\t\treturn Inline.render(editor, theme, args);\n\t\t}\n\n\t\treturn Iframe.render(editor, theme, args);\n\t};\n\n\tThemeManager.add('modern', function (editor) {\n\t\treturn {\n\t\t\trenderUI: function (args) {\n\t\t\t\treturn renderUI(editor, this, args);\n\t\t\t},\n\t\t\tresizeTo: function (w, h) {\n\t\t\t\treturn Resize.resizeTo(editor, w, h);\n\t\t\t},\n\t\t\tresizeBy: function (dw, dh) {\n\t\t\t\treturn Resize.resizeBy(editor, dw, dh);\n\t\t\t}\n\t\t};\n\t});\n\n\treturn function () {\n\t};\n});\n\ndem('tinymce.modern.Theme')();\n})();\n"

/***/ }),

/***/ 724:
/***/ (function(module, exports) {

module.exports = "// 4.5.6 (2017-03-30)\n\n/**\n * Compiled inline version. (Library mode)\n */\n\n/*jshint smarttabs:true, undef:true, latedef:true, curly:true, bitwise:true, camelcase:true */\n/*globals $code */\n\n(function(exports, undefined) {\n\t\"use strict\";\n\n\tvar modules = {};\n\n\tfunction require(ids, callback) {\n\t\tvar module, defs = [];\n\n\t\tfor (var i = 0; i < ids.length; ++i) {\n\t\t\tmodule = modules[ids[i]] || resolve(ids[i]);\n\t\t\tif (!module) {\n\t\t\t\tthrow 'module definition dependecy not found: ' + ids[i];\n\t\t\t}\n\n\t\t\tdefs.push(module);\n\t\t}\n\n\t\tcallback.apply(null, defs);\n\t}\n\n\tfunction define(id, dependencies, definition) {\n\t\tif (typeof id !== 'string') {\n\t\t\tthrow 'invalid module definition, module id must be defined and be a string';\n\t\t}\n\n\t\tif (dependencies === undefined) {\n\t\t\tthrow 'invalid module definition, dependencies must be specified';\n\t\t}\n\n\t\tif (definition === undefined) {\n\t\t\tthrow 'invalid module definition, definition function must be specified';\n\t\t}\n\n\t\trequire(dependencies, function() {\n\t\t\tmodules[id] = definition.apply(null, arguments);\n\t\t});\n\t}\n\n\tfunction defined(id) {\n\t\treturn !!modules[id];\n\t}\n\n\tfunction resolve(id) {\n\t\tvar target = exports;\n\t\tvar fragments = id.split(/[.\\/]/);\n\n\t\tfor (var fi = 0; fi < fragments.length; ++fi) {\n\t\t\tif (!target[fragments[fi]]) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttarget = target[fragments[fi]];\n\t\t}\n\n\t\treturn target;\n\t}\n\n\tfunction expose(ids) {\n\t\tvar i, target, id, fragments, privateModules;\n\n\t\tfor (i = 0; i < ids.length; i++) {\n\t\t\ttarget = exports;\n\t\t\tid = ids[i];\n\t\t\tfragments = id.split(/[.\\/]/);\n\n\t\t\tfor (var fi = 0; fi < fragments.length - 1; ++fi) {\n\t\t\t\tif (target[fragments[fi]] === undefined) {\n\t\t\t\t\ttarget[fragments[fi]] = {};\n\t\t\t\t}\n\n\t\t\t\ttarget = target[fragments[fi]];\n\t\t\t}\n\n\t\t\ttarget[fragments[fragments.length - 1]] = modules[id];\n\t\t}\n\n\t\t// Expose private modules for unit tests\n\t\tif (exports.AMDLC_TESTS) {\n\t\t\tprivateModules = exports.privateModules || {};\n\n\t\t\tfor (id in modules) {\n\t\t\t\tprivateModules[id] = modules[id];\n\t\t\t}\n\n\t\t\tfor (i = 0; i < ids.length; i++) {\n\t\t\t\tdelete privateModules[ids[i]];\n\t\t\t}\n\n\t\t\texports.privateModules = privateModules;\n\t\t}\n\t}\n\n// Included from: js/tinymce/classes/geom/Rect.js\n\n/**\n * Rect.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Contains various tools for rect/position calculation.\n *\n * @class tinymce.geom.Rect\n */\ndefine(\"tinymce/geom/Rect\", [\n], function() {\n\t\"use strict\";\n\n\tvar min = Math.min, max = Math.max, round = Math.round;\n\n\t/**\n\t * Returns the rect positioned based on the relative position name\n\t * to the target rect.\n\t *\n\t * @method relativePosition\n\t * @param {Rect} rect Source rect to modify into a new rect.\n\t * @param {Rect} targetRect Rect to move relative to based on the rel option.\n\t * @param {String} rel Relative position. For example: tr-bl.\n\t */\n\tfunction relativePosition(rect, targetRect, rel) {\n\t\tvar x, y, w, h, targetW, targetH;\n\n\t\tx = targetRect.x;\n\t\ty = targetRect.y;\n\t\tw = rect.w;\n\t\th = rect.h;\n\t\ttargetW = targetRect.w;\n\t\ttargetH = targetRect.h;\n\n\t\trel = (rel || '').split('');\n\n\t\tif (rel[0] === 'b') {\n\t\t\ty += targetH;\n\t\t}\n\n\t\tif (rel[1] === 'r') {\n\t\t\tx += targetW;\n\t\t}\n\n\t\tif (rel[0] === 'c') {\n\t\t\ty += round(targetH / 2);\n\t\t}\n\n\t\tif (rel[1] === 'c') {\n\t\t\tx += round(targetW / 2);\n\t\t}\n\n\t\tif (rel[3] === 'b') {\n\t\t\ty -= h;\n\t\t}\n\n\t\tif (rel[4] === 'r') {\n\t\t\tx -= w;\n\t\t}\n\n\t\tif (rel[3] === 'c') {\n\t\t\ty -= round(h / 2);\n\t\t}\n\n\t\tif (rel[4] === 'c') {\n\t\t\tx -= round(w / 2);\n\t\t}\n\n\t\treturn create(x, y, w, h);\n\t}\n\n\t/**\n\t * Tests various positions to get the most suitable one.\n\t *\n\t * @method findBestRelativePosition\n\t * @param {Rect} rect Rect to use as source.\n\t * @param {Rect} targetRect Rect to move relative to.\n\t * @param {Rect} constrainRect Rect to constrain within.\n\t * @param {Array} rels Array of relative positions to test against.\n\t */\n\tfunction findBestRelativePosition(rect, targetRect, constrainRect, rels) {\n\t\tvar pos, i;\n\n\t\tfor (i = 0; i < rels.length; i++) {\n\t\t\tpos = relativePosition(rect, targetRect, rels[i]);\n\n\t\t\tif (pos.x >= constrainRect.x && pos.x + pos.w <= constrainRect.w + constrainRect.x &&\n\t\t\t\tpos.y >= constrainRect.y && pos.y + pos.h <= constrainRect.h + constrainRect.y) {\n\t\t\t\treturn rels[i];\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Inflates the rect in all directions.\n\t *\n\t * @method inflate\n\t * @param {Rect} rect Rect to expand.\n\t * @param {Number} w Relative width to expand by.\n\t * @param {Number} h Relative height to expand by.\n\t * @return {Rect} New expanded rect.\n\t */\n\tfunction inflate(rect, w, h) {\n\t\treturn create(rect.x - w, rect.y - h, rect.w + w * 2, rect.h + h * 2);\n\t}\n\n\t/**\n\t * Returns the intersection of the specified rectangles.\n\t *\n\t * @method intersect\n\t * @param {Rect} rect The first rectangle to compare.\n\t * @param {Rect} cropRect The second rectangle to compare.\n\t * @return {Rect} The intersection of the two rectangles or null if they don't intersect.\n\t */\n\tfunction intersect(rect, cropRect) {\n\t\tvar x1, y1, x2, y2;\n\n\t\tx1 = max(rect.x, cropRect.x);\n\t\ty1 = max(rect.y, cropRect.y);\n\t\tx2 = min(rect.x + rect.w, cropRect.x + cropRect.w);\n\t\ty2 = min(rect.y + rect.h, cropRect.y + cropRect.h);\n\n\t\tif (x2 - x1 < 0 || y2 - y1 < 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn create(x1, y1, x2 - x1, y2 - y1);\n\t}\n\n\t/**\n\t * Returns a rect clamped within the specified clamp rect. This forces the\n\t * rect to be inside the clamp rect.\n\t *\n\t * @method clamp\n\t * @param {Rect} rect Rectangle to force within clamp rect.\n\t * @param {Rect} clampRect Rectable to force within.\n\t * @param {Boolean} fixedSize True/false if size should be fixed.\n\t * @return {Rect} Clamped rect.\n\t */\n\tfunction clamp(rect, clampRect, fixedSize) {\n\t\tvar underflowX1, underflowY1, overflowX2, overflowY2,\n\t\t\tx1, y1, x2, y2, cx2, cy2;\n\n\t\tx1 = rect.x;\n\t\ty1 = rect.y;\n\t\tx2 = rect.x + rect.w;\n\t\ty2 = rect.y + rect.h;\n\t\tcx2 = clampRect.x + clampRect.w;\n\t\tcy2 = clampRect.y + clampRect.h;\n\n\t\tunderflowX1 = max(0, clampRect.x - x1);\n\t\tunderflowY1 = max(0, clampRect.y - y1);\n\t\toverflowX2 = max(0, x2 - cx2);\n\t\toverflowY2 = max(0, y2 - cy2);\n\n\t\tx1 += underflowX1;\n\t\ty1 += underflowY1;\n\n\t\tif (fixedSize) {\n\t\t\tx2 += underflowX1;\n\t\t\ty2 += underflowY1;\n\t\t\tx1 -= overflowX2;\n\t\t\ty1 -= overflowY2;\n\t\t}\n\n\t\tx2 -= overflowX2;\n\t\ty2 -= overflowY2;\n\n\t\treturn create(x1, y1, x2 - x1, y2 - y1);\n\t}\n\n\t/**\n\t * Creates a new rectangle object.\n\t *\n\t * @method create\n\t * @param {Number} x Rectangle x location.\n\t * @param {Number} y Rectangle y location.\n\t * @param {Number} w Rectangle width.\n\t * @param {Number} h Rectangle height.\n\t * @return {Rect} New rectangle object.\n\t */\n\tfunction create(x, y, w, h) {\n\t\treturn {x: x, y: y, w: w, h: h};\n\t}\n\n\t/**\n\t * Creates a new rectangle object form a clientRects object.\n\t *\n\t * @method fromClientRect\n\t * @param {ClientRect} clientRect DOM ClientRect object.\n\t * @return {Rect} New rectangle object.\n\t */\n\tfunction fromClientRect(clientRect) {\n\t\treturn create(clientRect.left, clientRect.top, clientRect.width, clientRect.height);\n\t}\n\n\treturn {\n\t\tinflate: inflate,\n\t\trelativePosition: relativePosition,\n\t\tfindBestRelativePosition: findBestRelativePosition,\n\t\tintersect: intersect,\n\t\tclamp: clamp,\n\t\tcreate: create,\n\t\tfromClientRect: fromClientRect\n\t};\n});\n\n// Included from: js/tinymce/classes/util/Promise.js\n\n/**\n * Promise.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * Promise polyfill under MIT license: https://github.com/taylorhakes/promise-polyfill\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/* eslint-disable */\n/* jshint ignore:start */\n\n/**\n * Modifed to be a feature fill and wrapped as tinymce module.\n */\ndefine(\"tinymce/util/Promise\", [], function() {\n\tif (window.Promise) {\n\t\treturn window.Promise;\n\t}\n\n\t// Use polyfill for setImmediate for performance gains\n\tvar asap = Promise.immediateFn || (typeof setImmediate === 'function' && setImmediate) ||\n\t\tfunction(fn) { setTimeout(fn, 1); };\n\n\t// Polyfill for Function.prototype.bind\n\tfunction bind(fn, thisArg) {\n\t\treturn function() {\n\t\t\tfn.apply(thisArg, arguments);\n\t\t};\n\t}\n\n\tvar isArray = Array.isArray || function(value) { return Object.prototype.toString.call(value) === \"[object Array]\"; };\n\n\tfunction Promise(fn) {\n\t\tif (typeof this !== 'object') throw new TypeError('Promises must be constructed via new');\n\t\tif (typeof fn !== 'function') throw new TypeError('not a function');\n\t\tthis._state = null;\n\t\tthis._value = null;\n\t\tthis._deferreds = [];\n\n\t\tdoResolve(fn, bind(resolve, this), bind(reject, this));\n\t}\n\n\tfunction handle(deferred) {\n\t\tvar me = this;\n\t\tif (this._state === null) {\n\t\t\tthis._deferreds.push(deferred);\n\t\t\treturn;\n\t\t}\n\t\tasap(function() {\n\t\t\tvar cb = me._state ? deferred.onFulfilled : deferred.onRejected;\n\t\t\tif (cb === null) {\n\t\t\t\t(me._state ? deferred.resolve : deferred.reject)(me._value);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar ret;\n\t\t\ttry {\n\t\t\t\tret = cb(me._value);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tdeferred.reject(e);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdeferred.resolve(ret);\n\t\t});\n\t}\n\n\tfunction resolve(newValue) {\n\t\ttry { //Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n\t\t\tif (newValue === this) throw new TypeError('A promise cannot be resolved with itself.');\n\t\t\tif (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n\t\t\t\tvar then = newValue.then;\n\t\t\t\tif (typeof then === 'function') {\n\t\t\t\t\tdoResolve(bind(then, newValue), bind(resolve, this), bind(reject, this));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._state = true;\n\t\t\tthis._value = newValue;\n\t\t\tfinale.call(this);\n\t\t} catch (e) { reject.call(this, e); }\n\t}\n\n\tfunction reject(newValue) {\n\t\tthis._state = false;\n\t\tthis._value = newValue;\n\t\tfinale.call(this);\n\t}\n\n\tfunction finale() {\n\t\tfor (var i = 0, len = this._deferreds.length; i < len; i++) {\n\t\t\thandle.call(this, this._deferreds[i]);\n\t\t}\n\t\tthis._deferreds = null;\n\t}\n\n\tfunction Handler(onFulfilled, onRejected, resolve, reject){\n\t\tthis.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n\t\tthis.onRejected = typeof onRejected === 'function' ? onRejected : null;\n\t\tthis.resolve = resolve;\n\t\tthis.reject = reject;\n\t}\n\n\t/**\n\t * Take a potentially misbehaving resolver function and make sure\n\t * onFulfilled and onRejected are only called once.\n\t *\n\t * Makes no guarantees about asynchrony.\n\t */\n\tfunction doResolve(fn, onFulfilled, onRejected) {\n\t\tvar done = false;\n\t\ttry {\n\t\t\tfn(function (value) {\n\t\t\t\tif (done) return;\n\t\t\t\tdone = true;\n\t\t\t\tonFulfilled(value);\n\t\t\t}, function (reason) {\n\t\t\t\tif (done) return;\n\t\t\t\tdone = true;\n\t\t\t\tonRejected(reason);\n\t\t\t});\n\t\t} catch (ex) {\n\t\t\tif (done) return;\n\t\t\tdone = true;\n\t\t\tonRejected(ex);\n\t\t}\n\t}\n\n\tPromise.prototype['catch'] = function (onRejected) {\n\t\treturn this.then(null, onRejected);\n\t};\n\n\tPromise.prototype.then = function(onFulfilled, onRejected) {\n\t\tvar me = this;\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\thandle.call(me, new Handler(onFulfilled, onRejected, resolve, reject));\n\t\t});\n\t};\n\n\tPromise.all = function () {\n\t\tvar args = Array.prototype.slice.call(arguments.length === 1 && isArray(arguments[0]) ? arguments[0] : arguments);\n\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tif (args.length === 0) return resolve([]);\n\t\t\tvar remaining = args.length;\n\t\t\tfunction res(i, val) {\n\t\t\t\ttry {\n\t\t\t\t\tif (val && (typeof val === 'object' || typeof val === 'function')) {\n\t\t\t\t\t\tvar then = val.then;\n\t\t\t\t\t\tif (typeof then === 'function') {\n\t\t\t\t\t\t\tthen.call(val, function (val) { res(i, val); }, reject);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\targs[i] = val;\n\t\t\t\t\tif (--remaining === 0) {\n\t\t\t\t\t\tresolve(args);\n\t\t\t\t\t}\n\t\t\t\t} catch (ex) {\n\t\t\t\t\treject(ex);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (var i = 0; i < args.length; i++) {\n\t\t\t\tres(i, args[i]);\n\t\t\t}\n\t\t});\n\t};\n\n\tPromise.resolve = function (value) {\n\t\tif (value && typeof value === 'object' && value.constructor === Promise) {\n\t\t\treturn value;\n\t\t}\n\n\t\treturn new Promise(function (resolve) {\n\t\t\tresolve(value);\n\t\t});\n\t};\n\n\tPromise.reject = function (value) {\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\treject(value);\n\t\t});\n\t};\n\n\tPromise.race = function (values) {\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tfor(var i = 0, len = values.length; i < len; i++) {\n\t\t\t\tvalues[i].then(resolve, reject);\n\t\t\t}\n\t\t});\n\t};\n\n\treturn Promise;\n});\n\n/* jshint ignore:end */\n/* eslint-enable */\n\n// Included from: js/tinymce/classes/util/Delay.js\n\n/**\n * Delay.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility class for working with delayed actions like setTimeout.\n *\n * @class tinymce.util.Delay\n */\ndefine(\"tinymce/util/Delay\", [\n\t\"tinymce/util/Promise\"\n], function(Promise) {\n\tvar requestAnimationFramePromise;\n\n\tfunction requestAnimationFrame(callback, element) {\n\t\tvar i, requestAnimationFrameFunc = window.requestAnimationFrame, vendors = ['ms', 'moz', 'webkit'];\n\n\t\tfunction featurefill(callback) {\n\t\t\twindow.setTimeout(callback, 0);\n\t\t}\n\n\t\tfor (i = 0; i < vendors.length && !requestAnimationFrameFunc; i++) {\n\t\t\trequestAnimationFrameFunc = window[vendors[i] + 'RequestAnimationFrame'];\n\t\t}\n\n\t\tif (!requestAnimationFrameFunc) {\n\t\t\trequestAnimationFrameFunc = featurefill;\n\t\t}\n\n\t\trequestAnimationFrameFunc(callback, element);\n\t}\n\n\tfunction wrappedSetTimeout(callback, time) {\n\t\tif (typeof time != 'number') {\n\t\t\ttime = 0;\n\t\t}\n\n\t\treturn setTimeout(callback, time);\n\t}\n\n\tfunction wrappedSetInterval(callback, time) {\n\t\tif (typeof time != 'number') {\n\t\t\ttime = 1; // IE 8 needs it to be > 0\n\t\t}\n\n\t\treturn setInterval(callback, time);\n\t}\n\n\tfunction wrappedClearTimeout(id) {\n\t\treturn clearTimeout(id);\n\t}\n\n\tfunction wrappedClearInterval(id) {\n\t\treturn clearInterval(id);\n\t}\n\n\tfunction debounce(callback, time) {\n\t\tvar timer, func;\n\n\t\tfunc = function() {\n\t\t\tvar args = arguments;\n\n\t\t\tclearTimeout(timer);\n\n\t\t\ttimer = wrappedSetTimeout(function() {\n\t\t\t\tcallback.apply(this, args);\n\t\t\t}, time);\n\t\t};\n\n\t\tfunc.stop = function() {\n\t\t\tclearTimeout(timer);\n\t\t};\n\n\t\treturn func;\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Requests an animation frame and fallbacks to a timeout on older browsers.\n\t\t *\n\t\t * @method requestAnimationFrame\n\t\t * @param {function} callback Callback to execute when a new frame is available.\n\t\t * @param {DOMElement} element Optional element to scope it to.\n\t\t */\n\t\trequestAnimationFrame: function(callback, element) {\n\t\t\tif (requestAnimationFramePromise) {\n\t\t\t\trequestAnimationFramePromise.then(callback);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trequestAnimationFramePromise = new Promise(function(resolve) {\n\t\t\t\tif (!element) {\n\t\t\t\t\telement = document.body;\n\t\t\t\t}\n\n\t\t\t\trequestAnimationFrame(resolve, element);\n\t\t\t}).then(callback);\n\t\t},\n\n\t\t/**\n\t\t * Sets a timer in ms and executes the specified callback when the timer runs out.\n\t\t *\n\t\t * @method setTimeout\n\t\t * @param {function} callback Callback to execute when timer runs out.\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\n\t\t * @return {Number} Timeout id number.\n\t\t */\n\t\tsetTimeout: wrappedSetTimeout,\n\n\t\t/**\n\t\t * Sets an interval timer in ms and executes the specified callback at every interval of that time.\n\t\t *\n\t\t * @method setInterval\n\t\t * @param {function} callback Callback to execute when interval time runs out.\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\n\t\t * @return {Number} Timeout id number.\n\t\t */\n\t\tsetInterval: wrappedSetInterval,\n\n\t\t/**\n\t\t * Sets an editor timeout it's similar to setTimeout except that it checks if the editor instance is\n\t\t * still alive when the callback gets executed.\n\t\t *\n\t\t * @method setEditorTimeout\n\t\t * @param {tinymce.Editor} editor Editor instance to check the removed state on.\n\t\t * @param {function} callback Callback to execute when timer runs out.\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\n\t\t * @return {Number} Timeout id number.\n\t\t */\n\t\tsetEditorTimeout: function(editor, callback, time) {\n\t\t\treturn wrappedSetTimeout(function() {\n\t\t\t\tif (!editor.removed) {\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t}, time);\n\t\t},\n\n\t\t/**\n\t\t * Sets an interval timer it's similar to setInterval except that it checks if the editor instance is\n\t\t * still alive when the callback gets executed.\n\t\t *\n\t\t * @method setEditorInterval\n\t\t * @param {function} callback Callback to execute when interval time runs out.\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\n\t\t * @return {Number} Timeout id number.\n\t\t */\n\t\tsetEditorInterval: function(editor, callback, time) {\n\t\t\tvar timer;\n\n\t\t\ttimer = wrappedSetInterval(function() {\n\t\t\t\tif (!editor.removed) {\n\t\t\t\t\tcallback();\n\t\t\t\t} else {\n\t\t\t\t\tclearInterval(timer);\n\t\t\t\t}\n\t\t\t}, time);\n\n\t\t\treturn timer;\n\t\t},\n\n\t\t/**\n\t\t * Creates debounced callback function that only gets executed once within the specified time.\n\t\t *\n\t\t * @method debounce\n\t\t * @param {function} callback Callback to execute when timer finishes.\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\n\t\t * @return {Function} debounced function callback.\n\t\t */\n\t\tdebounce: debounce,\n\n\t\t// Throttle needs to be debounce due to backwards compatibility.\n\t\tthrottle: debounce,\n\n\t\t/**\n\t\t * Clears an interval timer so it won't execute.\n\t\t *\n\t\t * @method clearInterval\n\t\t * @param {Number} Interval timer id number.\n\t\t */\n\t\tclearInterval: wrappedClearInterval,\n\n\t\t/**\n\t\t * Clears an timeout timer so it won't execute.\n\t\t *\n\t\t * @method clearTimeout\n\t\t * @param {Number} Timeout timer id number.\n\t\t */\n\t\tclearTimeout: wrappedClearTimeout\n\t};\n});\n\n// Included from: js/tinymce/classes/Env.js\n\n/**\n * Env.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains various environment constants like browser versions etc.\n * Normally you don't want to sniff specific browser versions but sometimes you have\n * to when it's impossible to feature detect. So use this with care.\n *\n * @class tinymce.Env\n * @static\n */\ndefine(\"tinymce/Env\", [], function() {\n\tvar nav = navigator, userAgent = nav.userAgent;\n\tvar opera, webkit, ie, ie11, ie12, gecko, mac, iDevice, android, fileApi, phone, tablet, windowsPhone;\n\n\tfunction matchMediaQuery(query) {\n\t\treturn \"matchMedia\" in window ? matchMedia(query).matches : false;\n\t}\n\n\topera = window.opera && window.opera.buildNumber;\n\tandroid = /Android/.test(userAgent);\n\twebkit = /WebKit/.test(userAgent);\n\tie = !webkit && !opera && (/MSIE/gi).test(userAgent) && (/Explorer/gi).test(nav.appName);\n\tie = ie && /MSIE (\\w+)\\./.exec(userAgent)[1];\n\tie11 = userAgent.indexOf('Trident/') != -1 && (userAgent.indexOf('rv:') != -1 || nav.appName.indexOf('Netscape') != -1) ? 11 : false;\n\tie12 = (userAgent.indexOf('Edge/') != -1 && !ie && !ie11) ? 12 : false;\n\tie = ie || ie11 || ie12;\n\tgecko = !webkit && !ie11 && /Gecko/.test(userAgent);\n\tmac = userAgent.indexOf('Mac') != -1;\n\tiDevice = /(iPad|iPhone)/.test(userAgent);\n\tfileApi = \"FormData\" in window && \"FileReader\" in window && \"URL\" in window && !!URL.createObjectURL;\n\tphone = matchMediaQuery(\"only screen and (max-device-width: 480px)\") && (android || iDevice);\n\ttablet = matchMediaQuery(\"only screen and (min-width: 800px)\") && (android || iDevice);\n\twindowsPhone = userAgent.indexOf('Windows Phone') != -1;\n\n\tif (ie12) {\n\t\twebkit = false;\n\t}\n\n\t// Is a iPad/iPhone and not on iOS5 sniff the WebKit version since older iOS WebKit versions\n\t// says it has contentEditable support but there is no visible caret.\n\tvar contentEditable = !iDevice || fileApi || userAgent.match(/AppleWebKit\\/(\\d*)/)[1] >= 534;\n\n\treturn {\n\t\t/**\n\t\t * Constant that is true if the browser is Opera.\n\t\t *\n\t\t * @property opera\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\topera: opera,\n\n\t\t/**\n\t\t * Constant that is true if the browser is WebKit (Safari/Chrome).\n\t\t *\n\t\t * @property webKit\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\twebkit: webkit,\n\n\t\t/**\n\t\t * Constant that is more than zero if the browser is IE.\n\t\t *\n\t\t * @property ie\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tie: ie,\n\n\t\t/**\n\t\t * Constant that is true if the browser is Gecko.\n\t\t *\n\t\t * @property gecko\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tgecko: gecko,\n\n\t\t/**\n\t\t * Constant that is true if the os is Mac OS.\n\t\t *\n\t\t * @property mac\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tmac: mac,\n\n\t\t/**\n\t\t * Constant that is true if the os is iOS.\n\t\t *\n\t\t * @property iOS\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tiOS: iDevice,\n\n\t\t/**\n\t\t * Constant that is true if the os is android.\n\t\t *\n\t\t * @property android\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tandroid: android,\n\n\t\t/**\n\t\t * Constant that is true if the browser supports editing.\n\t\t *\n\t\t * @property contentEditable\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tcontentEditable: contentEditable,\n\n\t\t/**\n\t\t * Transparent image data url.\n\t\t *\n\t\t * @property transparentSrc\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\ttransparentSrc: \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\",\n\n\t\t/**\n\t\t * Returns true/false if the browser can or can't place the caret after a inline block like an image.\n\t\t *\n\t\t * @property noCaretAfter\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tcaretAfter: ie != 8,\n\n\t\t/**\n\t\t * Constant that is true if the browser supports native DOM Ranges. IE 9+.\n\t\t *\n\t\t * @property range\n\t\t * @type Boolean\n\t\t */\n\t\trange: window.getSelection && \"Range\" in window,\n\n\t\t/**\n\t\t * Returns the IE document mode for non IE browsers this will fake IE 10.\n\t\t *\n\t\t * @property documentMode\n\t\t * @type Number\n\t\t */\n\t\tdocumentMode: ie && !ie12 ? (document.documentMode || 7) : 10,\n\n\t\t/**\n\t\t * Constant that is true if the browser has a modern file api.\n\t\t *\n\t\t * @property fileApi\n\t\t * @type Boolean\n\t\t */\n\t\tfileApi: fileApi,\n\n\t\t/**\n\t\t * Constant that is true if the browser supports contentEditable=false regions.\n\t\t *\n\t\t * @property ceFalse\n\t\t * @type Boolean\n\t\t */\n\t\tceFalse: (ie === false || ie > 8),\n\n\t\t/**\n\t\t * Constant if CSP mode is possible or not. Meaning we can't use script urls for the iframe.\n\t\t */\n\t\tcanHaveCSP: (ie === false || ie > 11),\n\n\t\tdesktop: !phone && !tablet,\n\t\twindowsPhone: windowsPhone\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/EventUtils.js\n\n/**\n * EventUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*jshint loopfunc:true*/\n/*eslint no-loop-func:0 */\n\n/**\n * This class wraps the browsers native event logic with more convenient methods.\n *\n * @class tinymce.dom.EventUtils\n */\ndefine(\"tinymce/dom/EventUtils\", [\n\t\"tinymce/util/Delay\",\n\t\"tinymce/Env\"\n], function(Delay, Env) {\n\t\"use strict\";\n\n\tvar eventExpandoPrefix = \"mce-data-\";\n\tvar mouseEventRe = /^(?:mouse|contextmenu)|click/;\n\tvar deprecated = {\n\t\tkeyLocation: 1, layerX: 1, layerY: 1, returnValue: 1,\n\t\twebkitMovementX: 1, webkitMovementY: 1, keyIdentifier: 1\n\t};\n\n\t/**\n\t * Binds a native event to a callback on the speified target.\n\t */\n\tfunction addEvent(target, name, callback, capture) {\n\t\tif (target.addEventListener) {\n\t\t\ttarget.addEventListener(name, callback, capture || false);\n\t\t} else if (target.attachEvent) {\n\t\t\ttarget.attachEvent('on' + name, callback);\n\t\t}\n\t}\n\n\t/**\n\t * Unbinds a native event callback on the specified target.\n\t */\n\tfunction removeEvent(target, name, callback, capture) {\n\t\tif (target.removeEventListener) {\n\t\t\ttarget.removeEventListener(name, callback, capture || false);\n\t\t} else if (target.detachEvent) {\n\t\t\ttarget.detachEvent('on' + name, callback);\n\t\t}\n\t}\n\n\t/**\n\t * Gets the event target based on shadow dom properties like path and deepPath.\n\t */\n\tfunction getTargetFromShadowDom(event, defaultTarget) {\n\t\tvar path, target = defaultTarget;\n\n\t\t// When target element is inside Shadow DOM we need to take first element from path\n\t\t// otherwise we'll get Shadow Root parent, not actual target element\n\n\t\t// Normalize target for WebComponents v0 implementation (in Chrome)\n\t\tpath = event.path;\n\t\tif (path && path.length > 0) {\n\t\t\ttarget = path[0];\n\t\t}\n\n\t\t// Normalize target for WebComponents v1 implementation (standard)\n\t\tif (event.deepPath) {\n\t\t\tpath = event.deepPath();\n\t\t\tif (path && path.length > 0) {\n\t\t\t\ttarget = path[0];\n\t\t\t}\n\t\t}\n\n\t\treturn target;\n\t}\n\n\t/**\n\t * Normalizes a native event object or just adds the event specific methods on a custom event.\n\t */\n\tfunction fix(originalEvent, data) {\n\t\tvar name, event = data || {}, undef;\n\n\t\t// Dummy function that gets replaced on the delegation state functions\n\t\tfunction returnFalse() {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Dummy function that gets replaced on the delegation state functions\n\t\tfunction returnTrue() {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Copy all properties from the original event\n\t\tfor (name in originalEvent) {\n\t\t\t// layerX/layerY is deprecated in Chrome and produces a warning\n\t\t\tif (!deprecated[name]) {\n\t\t\t\tevent[name] = originalEvent[name];\n\t\t\t}\n\t\t}\n\n\t\t// Normalize target IE uses srcElement\n\t\tif (!event.target) {\n\t\t\tevent.target = event.srcElement || document;\n\t\t}\n\n\t\t// Experimental shadow dom support\n\t\tif (Env.experimentalShadowDom) {\n\t\t\tevent.target = getTargetFromShadowDom(originalEvent, event.target);\n\t\t}\n\n\t\t// Calculate pageX/Y if missing and clientX/Y available\n\t\tif (originalEvent && mouseEventRe.test(originalEvent.type) && originalEvent.pageX === undef && originalEvent.clientX !== undef) {\n\t\t\tvar eventDoc = event.target.ownerDocument || document;\n\t\t\tvar doc = eventDoc.documentElement;\n\t\t\tvar body = eventDoc.body;\n\n\t\t\tevent.pageX = originalEvent.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) -\n\t\t\t\t(doc && doc.clientLeft || body && body.clientLeft || 0);\n\n\t\t\tevent.pageY = originalEvent.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) -\n\t\t\t\t(doc && doc.clientTop || body && body.clientTop || 0);\n\t\t}\n\n\t\t// Add preventDefault method\n\t\tevent.preventDefault = function() {\n\t\t\tevent.isDefaultPrevented = returnTrue;\n\n\t\t\t// Execute preventDefault on the original event object\n\t\t\tif (originalEvent) {\n\t\t\t\tif (originalEvent.preventDefault) {\n\t\t\t\t\toriginalEvent.preventDefault();\n\t\t\t\t} else {\n\t\t\t\t\toriginalEvent.returnValue = false; // IE\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Add stopPropagation\n\t\tevent.stopPropagation = function() {\n\t\t\tevent.isPropagationStopped = returnTrue;\n\n\t\t\t// Execute stopPropagation on the original event object\n\t\t\tif (originalEvent) {\n\t\t\t\tif (originalEvent.stopPropagation) {\n\t\t\t\t\toriginalEvent.stopPropagation();\n\t\t\t\t} else {\n\t\t\t\t\toriginalEvent.cancelBubble = true; // IE\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Add stopImmediatePropagation\n\t\tevent.stopImmediatePropagation = function() {\n\t\t\tevent.isImmediatePropagationStopped = returnTrue;\n\t\t\tevent.stopPropagation();\n\t\t};\n\n\t\t// Add event delegation states\n\t\tif (!event.isDefaultPrevented) {\n\t\t\tevent.isDefaultPrevented = returnFalse;\n\t\t\tevent.isPropagationStopped = returnFalse;\n\t\t\tevent.isImmediatePropagationStopped = returnFalse;\n\t\t}\n\n\t\t// Add missing metaKey for IE 8\n\t\tif (typeof event.metaKey == 'undefined') {\n\t\t\tevent.metaKey = false;\n\t\t}\n\n\t\treturn event;\n\t}\n\n\t/**\n\t * Bind a DOMContentLoaded event across browsers and executes the callback once the page DOM is initialized.\n\t * It will also set/check the domLoaded state of the event_utils instance so ready isn't called multiple times.\n\t */\n\tfunction bindOnReady(win, callback, eventUtils) {\n\t\tvar doc = win.document, event = {type: 'ready'};\n\n\t\tif (eventUtils.domLoaded) {\n\t\t\tcallback(event);\n\t\t\treturn;\n\t\t}\n\n\t\t// Gets called when the DOM is ready\n\t\tfunction readyHandler() {\n\t\t\tif (!eventUtils.domLoaded) {\n\t\t\t\teventUtils.domLoaded = true;\n\t\t\t\tcallback(event);\n\t\t\t}\n\t\t}\n\n\t\tfunction waitForDomLoaded() {\n\t\t\t// Check complete or interactive state if there is a body\n\t\t\t// element on some iframes IE 8 will produce a null body\n\t\t\tif (doc.readyState === \"complete\" || (doc.readyState === \"interactive\" && doc.body)) {\n\t\t\t\tremoveEvent(doc, \"readystatechange\", waitForDomLoaded);\n\t\t\t\treadyHandler();\n\t\t\t}\n\t\t}\n\n\t\tfunction tryScroll() {\n\t\t\ttry {\n\t\t\t\t// If IE is used, use the trick by Diego Perini licensed under MIT by request to the author.\n\t\t\t\t// http://javascript.nwbox.com/IEContentLoaded/\n\t\t\t\tdoc.documentElement.doScroll(\"left\");\n\t\t\t} catch (ex) {\n\t\t\t\tDelay.setTimeout(tryScroll);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treadyHandler();\n\t\t}\n\n\t\t// Use W3C method\n\t\tif (doc.addEventListener) {\n\t\t\tif (doc.readyState === \"complete\") {\n\t\t\t\treadyHandler();\n\t\t\t} else {\n\t\t\t\taddEvent(win, 'DOMContentLoaded', readyHandler);\n\t\t\t}\n\t\t} else {\n\t\t\t// Use IE method\n\t\t\taddEvent(doc, \"readystatechange\", waitForDomLoaded);\n\n\t\t\t// Wait until we can scroll, when we can the DOM is initialized\n\t\t\tif (doc.documentElement.doScroll && win.self === win.top) {\n\t\t\t\ttryScroll();\n\t\t\t}\n\t\t}\n\n\t\t// Fallback if any of the above methods should fail for some odd reason\n\t\taddEvent(win, 'load', readyHandler);\n\t}\n\n\t/**\n\t * This class enables you to bind/unbind native events to elements and normalize it's behavior across browsers.\n\t */\n\tfunction EventUtils() {\n\t\tvar self = this, events = {}, count, expando, hasFocusIn, hasMouseEnterLeave, mouseEnterLeave;\n\n\t\texpando = eventExpandoPrefix + (+new Date()).toString(32);\n\t\thasMouseEnterLeave = \"onmouseenter\" in document.documentElement;\n\t\thasFocusIn = \"onfocusin\" in document.documentElement;\n\t\tmouseEnterLeave = {mouseenter: 'mouseover', mouseleave: 'mouseout'};\n\t\tcount = 1;\n\n\t\t// State if the DOMContentLoaded was executed or not\n\t\tself.domLoaded = false;\n\t\tself.events = events;\n\n\t\t/**\n\t\t * Executes all event handler callbacks for a specific event.\n\t\t *\n\t\t * @private\n\t\t * @param {Event} evt Event object.\n\t\t * @param {String} id Expando id value to look for.\n\t\t */\n\t\tfunction executeHandlers(evt, id) {\n\t\t\tvar callbackList, i, l, callback, container = events[id];\n\n\t\t\tcallbackList = container && container[evt.type];\n\t\t\tif (callbackList) {\n\t\t\t\tfor (i = 0, l = callbackList.length; i < l; i++) {\n\t\t\t\t\tcallback = callbackList[i];\n\n\t\t\t\t\t// Check if callback exists might be removed if a unbind is called inside the callback\n\t\t\t\t\tif (callback && callback.func.call(callback.scope, evt) === false) {\n\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\t// Should we stop propagation to immediate listeners\n\t\t\t\t\tif (evt.isImmediatePropagationStopped()) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Binds a callback to an event on the specified target.\n\t\t *\n\t\t * @method bind\n\t\t * @param {Object} target Target node/window or custom object.\n\t\t * @param {String} names Name of the event to bind.\n\t\t * @param {function} callback Callback function to execute when the event occurs.\n\t\t * @param {Object} scope Scope to call the callback function on, defaults to target.\n\t\t * @return {function} Callback function that got bound.\n\t\t */\n\t\tself.bind = function(target, names, callback, scope) {\n\t\t\tvar id, callbackList, i, name, fakeName, nativeHandler, capture, win = window;\n\n\t\t\t// Native event handler function patches the event and executes the callbacks for the expando\n\t\t\tfunction defaultNativeHandler(evt) {\n\t\t\t\texecuteHandlers(fix(evt || win.event), id);\n\t\t\t}\n\n\t\t\t// Don't bind to text nodes or comments\n\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Create or get events id for the target\n\t\t\tif (!target[expando]) {\n\t\t\t\tid = count++;\n\t\t\t\ttarget[expando] = id;\n\t\t\t\tevents[id] = {};\n\t\t\t} else {\n\t\t\t\tid = target[expando];\n\t\t\t}\n\n\t\t\t// Setup the specified scope or use the target as a default\n\t\t\tscope = scope || target;\n\n\t\t\t// Split names and bind each event, enables you to bind multiple events with one call\n\t\t\tnames = names.split(' ');\n\t\t\ti = names.length;\n\t\t\twhile (i--) {\n\t\t\t\tname = names[i];\n\t\t\t\tnativeHandler = defaultNativeHandler;\n\t\t\t\tfakeName = capture = false;\n\n\t\t\t\t// Use ready instead of DOMContentLoaded\n\t\t\t\tif (name === \"DOMContentLoaded\") {\n\t\t\t\t\tname = \"ready\";\n\t\t\t\t}\n\n\t\t\t\t// DOM is already ready\n\t\t\t\tif (self.domLoaded && name === \"ready\" && target.readyState == 'complete') {\n\t\t\t\t\tcallback.call(scope, fix({type: name}));\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Handle mouseenter/mouseleaver\n\t\t\t\tif (!hasMouseEnterLeave) {\n\t\t\t\t\tfakeName = mouseEnterLeave[name];\n\n\t\t\t\t\tif (fakeName) {\n\t\t\t\t\t\tnativeHandler = function(evt) {\n\t\t\t\t\t\t\tvar current, related;\n\n\t\t\t\t\t\t\tcurrent = evt.currentTarget;\n\t\t\t\t\t\t\trelated = evt.relatedTarget;\n\n\t\t\t\t\t\t\t// Check if related is inside the current target if it's not then the event should\n\t\t\t\t\t\t\t// be ignored since it's a mouseover/mouseout inside the element\n\t\t\t\t\t\t\tif (related && current.contains) {\n\t\t\t\t\t\t\t\t// Use contains for performance\n\t\t\t\t\t\t\t\trelated = current.contains(related);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\twhile (related && related !== current) {\n\t\t\t\t\t\t\t\t\trelated = related.parentNode;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Fire fake event\n\t\t\t\t\t\t\tif (!related) {\n\t\t\t\t\t\t\t\tevt = fix(evt || win.event);\n\t\t\t\t\t\t\t\tevt.type = evt.type === 'mouseout' ? 'mouseleave' : 'mouseenter';\n\t\t\t\t\t\t\t\tevt.target = current;\n\t\t\t\t\t\t\t\texecuteHandlers(evt, id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Fake bubbling of focusin/focusout\n\t\t\t\tif (!hasFocusIn && (name === \"focusin\" || name === \"focusout\")) {\n\t\t\t\t\tcapture = true;\n\t\t\t\t\tfakeName = name === \"focusin\" ? \"focus\" : \"blur\";\n\t\t\t\t\tnativeHandler = function(evt) {\n\t\t\t\t\t\tevt = fix(evt || win.event);\n\t\t\t\t\t\tevt.type = evt.type === 'focus' ? 'focusin' : 'focusout';\n\t\t\t\t\t\texecuteHandlers(evt, id);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// Setup callback list and bind native event\n\t\t\t\tcallbackList = events[id][name];\n\t\t\t\tif (!callbackList) {\n\t\t\t\t\tevents[id][name] = callbackList = [{func: callback, scope: scope}];\n\t\t\t\t\tcallbackList.fakeName = fakeName;\n\t\t\t\t\tcallbackList.capture = capture;\n\t\t\t\t\t//callbackList.callback = callback;\n\n\t\t\t\t\t// Add the nativeHandler to the callback list so that we can later unbind it\n\t\t\t\t\tcallbackList.nativeHandler = nativeHandler;\n\n\t\t\t\t\t// Check if the target has native events support\n\n\t\t\t\t\tif (name === \"ready\") {\n\t\t\t\t\t\tbindOnReady(target, nativeHandler, self);\n\t\t\t\t\t} else {\n\t\t\t\t\t\taddEvent(target, fakeName || name, nativeHandler, capture);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (name === \"ready\" && self.domLoaded) {\n\t\t\t\t\t\tcallback({type: name});\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// If it already has an native handler then just push the callback\n\t\t\t\t\t\tcallbackList.push({func: callback, scope: scope});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttarget = callbackList = 0; // Clean memory for IE\n\n\t\t\treturn callback;\n\t\t};\n\n\t\t/**\n\t\t * Unbinds the specified event by name, name and callback or all events on the target.\n\t\t *\n\t\t * @method unbind\n\t\t * @param {Object} target Target node/window or custom object.\n\t\t * @param {String} names Optional event name to unbind.\n\t\t * @param {function} callback Optional callback function to unbind.\n\t\t * @return {EventUtils} Event utils instance.\n\t\t */\n\t\tself.unbind = function(target, names, callback) {\n\t\t\tvar id, callbackList, i, ci, name, eventMap;\n\n\t\t\t// Don't bind to text nodes or comments\n\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\t// Unbind event or events if the target has the expando\n\t\t\tid = target[expando];\n\t\t\tif (id) {\n\t\t\t\teventMap = events[id];\n\n\t\t\t\t// Specific callback\n\t\t\t\tif (names) {\n\t\t\t\t\tnames = names.split(' ');\n\t\t\t\t\ti = names.length;\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tname = names[i];\n\t\t\t\t\t\tcallbackList = eventMap[name];\n\n\t\t\t\t\t\t// Unbind the event if it exists in the map\n\t\t\t\t\t\tif (callbackList) {\n\t\t\t\t\t\t\t// Remove specified callback\n\t\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\t\tci = callbackList.length;\n\t\t\t\t\t\t\t\twhile (ci--) {\n\t\t\t\t\t\t\t\t\tif (callbackList[ci].func === callback) {\n\t\t\t\t\t\t\t\t\t\tvar nativeHandler = callbackList.nativeHandler;\n\t\t\t\t\t\t\t\t\t\tvar fakeName = callbackList.fakeName, capture = callbackList.capture;\n\n\t\t\t\t\t\t\t\t\t\t// Clone callbackList since unbind inside a callback would otherwise break the handlers loop\n\t\t\t\t\t\t\t\t\t\tcallbackList = callbackList.slice(0, ci).concat(callbackList.slice(ci + 1));\n\t\t\t\t\t\t\t\t\t\tcallbackList.nativeHandler = nativeHandler;\n\t\t\t\t\t\t\t\t\t\tcallbackList.fakeName = fakeName;\n\t\t\t\t\t\t\t\t\t\tcallbackList.capture = capture;\n\n\t\t\t\t\t\t\t\t\t\teventMap[name] = callbackList;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Remove all callbacks if there isn't a specified callback or there is no callbacks left\n\t\t\t\t\t\t\tif (!callback || callbackList.length === 0) {\n\t\t\t\t\t\t\t\tdelete eventMap[name];\n\t\t\t\t\t\t\t\tremoveEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// All events for a specific element\n\t\t\t\t\tfor (name in eventMap) {\n\t\t\t\t\t\tcallbackList = eventMap[name];\n\t\t\t\t\t\tremoveEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\n\t\t\t\t\t}\n\n\t\t\t\t\teventMap = {};\n\t\t\t\t}\n\n\t\t\t\t// Check if object is empty, if it isn't then we won't remove the expando map\n\t\t\t\tfor (name in eventMap) {\n\t\t\t\t\treturn self;\n\t\t\t\t}\n\n\t\t\t\t// Delete event object\n\t\t\t\tdelete events[id];\n\n\t\t\t\t// Remove expando from target\n\t\t\t\ttry {\n\t\t\t\t\t// IE will fail here since it can't delete properties from window\n\t\t\t\t\tdelete target[expando];\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// IE will set it to null\n\t\t\t\t\ttarget[expando] = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self;\n\t\t};\n\n\t\t/**\n\t\t * Fires the specified event on the specified target.\n\t\t *\n\t\t * @method fire\n\t\t * @param {Object} target Target node/window or custom object.\n\t\t * @param {String} name Event name to fire.\n\t\t * @param {Object} args Optional arguments to send to the observers.\n\t\t * @return {EventUtils} Event utils instance.\n\t\t */\n\t\tself.fire = function(target, name, args) {\n\t\t\tvar id;\n\n\t\t\t// Don't bind to text nodes or comments\n\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\t// Build event object by patching the args\n\t\t\targs = fix(null, args);\n\t\t\targs.type = name;\n\t\t\targs.target = target;\n\n\t\t\tdo {\n\t\t\t\t// Found an expando that means there is listeners to execute\n\t\t\t\tid = target[expando];\n\t\t\t\tif (id) {\n\t\t\t\t\texecuteHandlers(args, id);\n\t\t\t\t}\n\n\t\t\t\t// Walk up the DOM\n\t\t\t\ttarget = target.parentNode || target.ownerDocument || target.defaultView || target.parentWindow;\n\t\t\t} while (target && !args.isPropagationStopped());\n\n\t\t\treturn self;\n\t\t};\n\n\t\t/**\n\t\t * Removes all bound event listeners for the specified target. This will also remove any bound\n\t\t * listeners to child nodes within that target.\n\t\t *\n\t\t * @method clean\n\t\t * @param {Object} target Target node/window object.\n\t\t * @return {EventUtils} Event utils instance.\n\t\t */\n\t\tself.clean = function(target) {\n\t\t\tvar i, children, unbind = self.unbind;\n\n\t\t\t// Don't bind to text nodes or comments\n\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\t// Unbind any element on the specified target\n\t\t\tif (target[expando]) {\n\t\t\t\tunbind(target);\n\t\t\t}\n\n\t\t\t// Target doesn't have getElementsByTagName it's probably a window object then use it's document to find the children\n\t\t\tif (!target.getElementsByTagName) {\n\t\t\t\ttarget = target.document;\n\t\t\t}\n\n\t\t\t// Remove events from each child element\n\t\t\tif (target && target.getElementsByTagName) {\n\t\t\t\tunbind(target);\n\n\t\t\t\tchildren = target.getElementsByTagName('*');\n\t\t\t\ti = children.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\ttarget = children[i];\n\n\t\t\t\t\tif (target[expando]) {\n\t\t\t\t\t\tunbind(target);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self;\n\t\t};\n\n\t\t/**\n\t\t * Destroys the event object. Call this on IE to remove memory leaks.\n\t\t */\n\t\tself.destroy = function() {\n\t\t\tevents = {};\n\t\t};\n\n\t\t// Legacy function for canceling events\n\t\tself.cancel = function(e) {\n\t\t\tif (e) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t}\n\n\tEventUtils.Event = new EventUtils();\n\tEventUtils.Event.bind(window, 'ready', function() {});\n\n\treturn EventUtils;\n});\n\n// Included from: js/tinymce/classes/dom/Sizzle.js\n\n/**\n * Sizzle.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n *\n * @ignore-file\n */\n\n/*jshint bitwise:false, expr:true, noempty:false, sub:true, eqnull:true, latedef:false, maxlen:255 */\n/*eslint-disable */\n\n/**\n * Sizzle CSS Selector Engine v@VERSION\n * http://sizzlejs.com/\n *\n * Copyright 2008, 2014 jQuery Foundation, Inc. and other contributors\n * Released under the MIT license\n * http://jquery.org/license\n *\n * Date: @DATE\n */\ndefine(\"tinymce/dom/Sizzle\", [], function() {\nvar i,\n\tsupport,\n\tExpr,\n\tgetText,\n\tisXML,\n\ttokenize,\n\tcompile,\n\tselect,\n\toutermostContext,\n\tsortInput,\n\thasDuplicate,\n\n\t// Local document vars\n\tsetDocument,\n\tdocument,\n\tdocElem,\n\tdocumentIsHTML,\n\trbuggyQSA,\n\trbuggyMatches,\n\tmatches,\n\tcontains,\n\n\t// Instance-specific data\n\texpando = \"sizzle\" + -(new Date()),\n\tpreferredDoc = window.document,\n\tdirruns = 0,\n\tdone = 0,\n\tclassCache = createCache(),\n\ttokenCache = createCache(),\n\tcompilerCache = createCache(),\n\tsortOrder = function( a, b ) {\n\t\tif ( a === b ) {\n\t\t\thasDuplicate = true;\n\t\t}\n\t\treturn 0;\n\t},\n\n\t// General-purpose constants\n\tstrundefined = typeof undefined,\n\tMAX_NEGATIVE = 1 << 31,\n\n\t// Instance methods\n\thasOwn = ({}).hasOwnProperty,\n\tarr = [],\n\tpop = arr.pop,\n\tpush_native = arr.push,\n\tpush = arr.push,\n\tslice = arr.slice,\n\t// Use a stripped-down indexOf if we can't use a native one\n\tindexOf = arr.indexOf || function( elem ) {\n\t\tvar i = 0,\n\t\t\tlen = this.length;\n\t\tfor ( ; i < len; i++ ) {\n\t\t\tif ( this[i] === elem ) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t},\n\n\tbooleans = \"checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped\",\n\n\t// Regular expressions\n\n\t// http://www.w3.org/TR/css3-selectors/#whitespace\n\twhitespace = \"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\",\n\n\t// http://www.w3.org/TR/CSS21/syndata.html#value-def-identifier\n\tidentifier = \"(?:\\\\\\\\.|[\\\\w-]|[^\\\\x00-\\\\xa0])+\",\n\n\t// Attribute selectors: http://www.w3.org/TR/selectors/#attribute-selectors\n\tattributes = \"\\\\[\" + whitespace + \"*(\" + identifier + \")(?:\" + whitespace +\n\t\t// Operator (capture 2)\n\t\t\"*([*^$|!~]?=)\" + whitespace +\n\t\t// \"Attribute values must be CSS identifiers [capture 5] or strings [capture 3 or capture 4]\"\n\t\t\"*(?:'((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\"|(\" + identifier + \"))|)\" + whitespace +\n\t\t\"*\\\\]\",\n\n\tpseudos = \":(\" + identifier + \")(?:\\\\((\" +\n\t\t// To reduce the number of selectors needing tokenize in the preFilter, prefer arguments:\n\t\t// 1. quoted (capture 3; capture 4 or capture 5)\n\t\t\"('((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\")|\" +\n\t\t// 2. simple (capture 6)\n\t\t\"((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|\" + attributes + \")*)|\" +\n\t\t// 3. anything else (capture 2)\n\t\t\".*\" +\n\t\t\")\\\\)|)\",\n\n\t// Leading and non-escaped trailing whitespace, capturing some non-whitespace characters preceding the latter\n\trtrim = new RegExp( \"^\" + whitespace + \"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)\" + whitespace + \"+$\", \"g\" ),\n\n\trcomma = new RegExp( \"^\" + whitespace + \"*,\" + whitespace + \"*\" ),\n\trcombinators = new RegExp( \"^\" + whitespace + \"*([>+~]|\" + whitespace + \")\" + whitespace + \"*\" ),\n\n\trattributeQuotes = new RegExp( \"=\" + whitespace + \"*([^\\\\]'\\\"]*?)\" + whitespace + \"*\\\\]\", \"g\" ),\n\n\trpseudo = new RegExp( pseudos ),\n\tridentifier = new RegExp( \"^\" + identifier + \"$\" ),\n\n\tmatchExpr = {\n\t\t\"ID\": new RegExp( \"^#(\" + identifier + \")\" ),\n\t\t\"CLASS\": new RegExp( \"^\\\\.(\" + identifier + \")\" ),\n\t\t\"TAG\": new RegExp( \"^(\" + identifier + \"|[*])\" ),\n\t\t\"ATTR\": new RegExp( \"^\" + attributes ),\n\t\t\"PSEUDO\": new RegExp( \"^\" + pseudos ),\n\t\t\"CHILD\": new RegExp( \"^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(\" + whitespace +\n\t\t\t\"*(even|odd|(([+-]|)(\\\\d*)n|)\" + whitespace + \"*(?:([+-]|)\" + whitespace +\n\t\t\t\"*(\\\\d+)|))\" + whitespace + \"*\\\\)|)\", \"i\" ),\n\t\t\"bool\": new RegExp( \"^(?:\" + booleans + \")$\", \"i\" ),\n\t\t// For use in libraries implementing .is()\n\t\t// We use this for POS matching in `select`\n\t\t\"needsContext\": new RegExp( \"^\" + whitespace + \"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(\" +\n\t\t\twhitespace + \"*((?:-\\\\d)?\\\\d*)\" + whitespace + \"*\\\\)|)(?=[^-]|$)\", \"i\" )\n\t},\n\n\trinputs = /^(?:input|select|textarea|button)$/i,\n\trheader = /^h\\d$/i,\n\n\trnative = /^[^{]+\\{\\s*\\[native \\w/,\n\n\t// Easily-parseable/retrievable ID or TAG or CLASS selectors\n\trquickExpr = /^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,\n\n\trsibling = /[+~]/,\n\trescape = /'|\\\\/g,\n\n\t// CSS escapes http://www.w3.org/TR/CSS21/syndata.html#escaped-characters\n\trunescape = new RegExp( \"\\\\\\\\([\\\\da-f]{1,6}\" + whitespace + \"?|(\" + whitespace + \")|.)\", \"ig\" ),\n\tfunescape = function( _, escaped, escapedWhitespace ) {\n\t\tvar high = \"0x\" + escaped - 0x10000;\n\t\t// NaN means non-codepoint\n\t\t// Support: Firefox<24\n\t\t// Workaround erroneous numeric interpretation of +\"0x\"\n\t\treturn high !== high || escapedWhitespace ?\n\t\t\tescaped :\n\t\t\thigh < 0 ?\n\t\t\t\t// BMP codepoint\n\t\t\t\tString.fromCharCode( high + 0x10000 ) :\n\t\t\t\t// Supplemental Plane codepoint (surrogate pair)\n\t\t\t\tString.fromCharCode( high >> 10 | 0xD800, high & 0x3FF | 0xDC00 );\n\t};\n\n// Optimize for push.apply( _, NodeList )\ntry {\n\tpush.apply(\n\t\t(arr = slice.call( preferredDoc.childNodes )),\n\t\tpreferredDoc.childNodes\n\t);\n\t// Support: Android<4.0\n\t// Detect silently failing push.apply\n\tarr[ preferredDoc.childNodes.length ].nodeType;\n} catch ( e ) {\n\tpush = { apply: arr.length ?\n\n\t\t// Leverage slice if possible\n\t\tfunction( target, els ) {\n\t\t\tpush_native.apply( target, slice.call(els) );\n\t\t} :\n\n\t\t// Support: IE<9\n\t\t// Otherwise append directly\n\t\tfunction( target, els ) {\n\t\t\tvar j = target.length,\n\t\t\t\ti = 0;\n\t\t\t// Can't trust NodeList.length\n\t\t\twhile ( (target[j++] = els[i++]) ) {}\n\t\t\ttarget.length = j - 1;\n\t\t}\n\t};\n}\n\nfunction Sizzle( selector, context, results, seed ) {\n\tvar match, elem, m, nodeType,\n\t\t// QSA vars\n\t\ti, groups, old, nid, newContext, newSelector;\n\n\tif ( ( context ? context.ownerDocument || context : preferredDoc ) !== document ) {\n\t\tsetDocument( context );\n\t}\n\n\tcontext = context || document;\n\tresults = results || [];\n\n\tif ( !selector || typeof selector !== \"string\" ) {\n\t\treturn results;\n\t}\n\n\tif ( (nodeType = context.nodeType) !== 1 && nodeType !== 9 ) {\n\t\treturn [];\n\t}\n\n\tif ( documentIsHTML && !seed ) {\n\n\t\t// Shortcuts\n\t\tif ( (match = rquickExpr.exec( selector )) ) {\n\t\t\t// Speed-up: Sizzle(\"#ID\")\n\t\t\tif ( (m = match[1]) ) {\n\t\t\t\tif ( nodeType === 9 ) {\n\t\t\t\t\telem = context.getElementById( m );\n\t\t\t\t\t// Check parentNode to catch when Blackberry 4.6 returns\n\t\t\t\t\t// nodes that are no longer in the document (jQuery #6963)\n\t\t\t\t\tif ( elem && elem.parentNode ) {\n\t\t\t\t\t\t// Handle the case where IE, Opera, and Webkit return items\n\t\t\t\t\t\t// by name instead of ID\n\t\t\t\t\t\tif ( elem.id === m ) {\n\t\t\t\t\t\t\tresults.push( elem );\n\t\t\t\t\t\t\treturn results;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn results;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Context is not a document\n\t\t\t\t\tif ( context.ownerDocument && (elem = context.ownerDocument.getElementById( m )) &&\n\t\t\t\t\t\tcontains( context, elem ) && elem.id === m ) {\n\t\t\t\t\t\tresults.push( elem );\n\t\t\t\t\t\treturn results;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t// Speed-up: Sizzle(\"TAG\")\n\t\t\t} else if ( match[2] ) {\n\t\t\t\tpush.apply( results, context.getElementsByTagName( selector ) );\n\t\t\t\treturn results;\n\n\t\t\t// Speed-up: Sizzle(\".CLASS\")\n\t\t\t} else if ( (m = match[3]) && support.getElementsByClassName ) {\n\t\t\t\tpush.apply( results, context.getElementsByClassName( m ) );\n\t\t\t\treturn results;\n\t\t\t}\n\t\t}\n\n\t\t// QSA path\n\t\tif ( support.qsa && (!rbuggyQSA || !rbuggyQSA.test( selector )) ) {\n\t\t\tnid = old = expando;\n\t\t\tnewContext = context;\n\t\t\tnewSelector = nodeType === 9 && selector;\n\n\t\t\t// qSA works strangely on Element-rooted queries\n\t\t\t// We can work around this by specifying an extra ID on the root\n\t\t\t// and working up from there (Thanks to Andrew Dupont for the technique)\n\t\t\t// IE 8 doesn't work on object elements\n\t\t\tif ( nodeType === 1 && context.nodeName.toLowerCase() !== \"object\" ) {\n\t\t\t\tgroups = tokenize( selector );\n\n\t\t\t\tif ( (old = context.getAttribute(\"id\")) ) {\n\t\t\t\t\tnid = old.replace( rescape, \"\\\\$&\" );\n\t\t\t\t} else {\n\t\t\t\t\tcontext.setAttribute( \"id\", nid );\n\t\t\t\t}\n\t\t\t\tnid = \"[id='\" + nid + \"'] \";\n\n\t\t\t\ti = groups.length;\n\t\t\t\twhile ( i-- ) {\n\t\t\t\t\tgroups[i] = nid + toSelector( groups[i] );\n\t\t\t\t}\n\t\t\t\tnewContext = rsibling.test( selector ) && testContext( context.parentNode ) || context;\n\t\t\t\tnewSelector = groups.join(\",\");\n\t\t\t}\n\n\t\t\tif ( newSelector ) {\n\t\t\t\ttry {\n\t\t\t\t\tpush.apply( results,\n\t\t\t\t\t\tnewContext.querySelectorAll( newSelector )\n\t\t\t\t\t);\n\t\t\t\t\treturn results;\n\t\t\t\t} catch(qsaError) {\n\t\t\t\t} finally {\n\t\t\t\t\tif ( !old ) {\n\t\t\t\t\t\tcontext.removeAttribute(\"id\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// All others\n\treturn select( selector.replace( rtrim, \"$1\" ), context, results, seed );\n}\n\n/**\n * Create key-value caches of limited size\n * @returns {Function(string, Object)} Returns the Object data after storing it on itself with\n *\tproperty name the (space-suffixed) string and (if the cache is larger than Expr.cacheLength)\n *\tdeleting the oldest entry\n */\nfunction createCache() {\n\tvar keys = [];\n\n\tfunction cache( key, value ) {\n\t\t// Use (key + \" \") to avoid collision with native prototype properties (see Issue #157)\n\t\tif ( keys.push( key + \" \" ) > Expr.cacheLength ) {\n\t\t\t// Only keep the most recent entries\n\t\t\tdelete cache[ keys.shift() ];\n\t\t}\n\t\treturn (cache[ key + \" \" ] = value);\n\t}\n\treturn cache;\n}\n\n/**\n * Mark a function for special use by Sizzle\n * @param {Function} fn The function to mark\n */\nfunction markFunction( fn ) {\n\tfn[ expando ] = true;\n\treturn fn;\n}\n\n/**\n * Support testing using an element\n * @param {Function} fn Passed the created div and expects a boolean result\n */\nfunction assert( fn ) {\n\tvar div = document.createElement(\"div\");\n\n\ttry {\n\t\treturn !!fn( div );\n\t} catch (e) {\n\t\treturn false;\n\t} finally {\n\t\t// Remove from its parent by default\n\t\tif ( div.parentNode ) {\n\t\t\tdiv.parentNode.removeChild( div );\n\t\t}\n\t\t// release memory in IE\n\t\tdiv = null;\n\t}\n}\n\n/**\n * Adds the same handler for all of the specified attrs\n * @param {String} attrs Pipe-separated list of attributes\n * @param {Function} handler The method that will be applied\n */\nfunction addHandle( attrs, handler ) {\n\tvar arr = attrs.split(\"|\"),\n\t\ti = attrs.length;\n\n\twhile ( i-- ) {\n\t\tExpr.attrHandle[ arr[i] ] = handler;\n\t}\n}\n\n/**\n * Checks document order of two siblings\n * @param {Element} a\n * @param {Element} b\n * @returns {Number} Returns less than 0 if a precedes b, greater than 0 if a follows b\n */\nfunction siblingCheck( a, b ) {\n\tvar cur = b && a,\n\t\tdiff = cur && a.nodeType === 1 && b.nodeType === 1 &&\n\t\t\t( ~b.sourceIndex || MAX_NEGATIVE ) -\n\t\t\t( ~a.sourceIndex || MAX_NEGATIVE );\n\n\t// Use IE sourceIndex if available on both nodes\n\tif ( diff ) {\n\t\treturn diff;\n\t}\n\n\t// Check if b follows a\n\tif ( cur ) {\n\t\twhile ( (cur = cur.nextSibling) ) {\n\t\t\tif ( cur === b ) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn a ? 1 : -1;\n}\n\n/**\n * Returns a function to use in pseudos for input types\n * @param {String} type\n */\nfunction createInputPseudo( type ) {\n\treturn function( elem ) {\n\t\tvar name = elem.nodeName.toLowerCase();\n\t\treturn name === \"input\" && elem.type === type;\n\t};\n}\n\n/**\n * Returns a function to use in pseudos for buttons\n * @param {String} type\n */\nfunction createButtonPseudo( type ) {\n\treturn function( elem ) {\n\t\tvar name = elem.nodeName.toLowerCase();\n\t\treturn (name === \"input\" || name === \"button\") && elem.type === type;\n\t};\n}\n\n/**\n * Returns a function to use in pseudos for positionals\n * @param {Function} fn\n */\nfunction createPositionalPseudo( fn ) {\n\treturn markFunction(function( argument ) {\n\t\targument = +argument;\n\t\treturn markFunction(function( seed, matches ) {\n\t\t\tvar j,\n\t\t\t\tmatchIndexes = fn( [], seed.length, argument ),\n\t\t\t\ti = matchIndexes.length;\n\n\t\t\t// Match elements found at the specified indexes\n\t\t\twhile ( i-- ) {\n\t\t\t\tif ( seed[ (j = matchIndexes[i]) ] ) {\n\t\t\t\t\tseed[j] = !(matches[j] = seed[j]);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n}\n\n/**\n * Checks a node for validity as a Sizzle context\n * @param {Element|Object=} context\n * @returns {Element|Object|Boolean} The input node if acceptable, otherwise a falsy value\n */\nfunction testContext( context ) {\n\treturn context && typeof context.getElementsByTagName !== strundefined && context;\n}\n\n// Expose support vars for convenience\nsupport = Sizzle.support = {};\n\n/**\n * Detects XML nodes\n * @param {Element|Object} elem An element or a document\n * @returns {Boolean} True iff elem is a non-HTML XML node\n */\nisXML = Sizzle.isXML = function( elem ) {\n\t// documentElement is verified for cases where it doesn't yet exist\n\t// (such as loading iframes in IE - #4833)\n\tvar documentElement = elem && (elem.ownerDocument || elem).documentElement;\n\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\n};\n\n/**\n * Sets document-related variables once based on the current document\n * @param {Element|Object} [doc] An element or document object to use to set the document\n * @returns {Object} Returns the current document\n */\nsetDocument = Sizzle.setDocument = function( node ) {\n\tvar hasCompare,\n\t\tdoc = node ? node.ownerDocument || node : preferredDoc,\n\t\tparent = doc.defaultView;\n\n\tfunction getTop(win) {\n\t\t// Edge throws a lovely Object expected if you try to get top on a detached reference see #2642\n\t\ttry {\n\t\t\treturn win.top;\n\t\t} catch (ex) {\n\t\t\t// Ignore\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t// If no document and documentElement is available, return\n\tif ( doc === document || doc.nodeType !== 9 || !doc.documentElement ) {\n\t\treturn document;\n\t}\n\n\t// Set our document\n\tdocument = doc;\n\tdocElem = doc.documentElement;\n\n\t// Support tests\n\tdocumentIsHTML = !isXML( doc );\n\n\t// Support: IE>8\n\t// If iframe document is assigned to \"document\" variable and if iframe has been reloaded,\n\t// IE will throw \"permission denied\" error when accessing \"document\" variable, see jQuery #13936\n\t// IE6-8 do not support the defaultView property so parent will be undefined\n\tif ( parent && parent !== getTop(parent) ) {\n\t\t// IE11 does not have attachEvent, so all must suffer\n\t\tif ( parent.addEventListener ) {\n\t\t\tparent.addEventListener( \"unload\", function() {\n\t\t\t\tsetDocument();\n\t\t\t}, false );\n\t\t} else if ( parent.attachEvent ) {\n\t\t\tparent.attachEvent( \"onunload\", function() {\n\t\t\t\tsetDocument();\n\t\t\t});\n\t\t}\n\t}\n\n\t/* Attributes\n\t---------------------------------------------------------------------- */\n\n\t// Support: IE<8\n\t// Verify that getAttribute really returns attributes and not properties (excepting IE8 booleans)\n\tsupport.attributes = assert(function( div ) {\n\t\tdiv.className = \"i\";\n\t\treturn !div.getAttribute(\"className\");\n\t});\n\n\t/* getElement(s)By*\n\t---------------------------------------------------------------------- */\n\n\t// Check if getElementsByTagName(\"*\") returns only elements\n\tsupport.getElementsByTagName = assert(function( div ) {\n\t\tdiv.appendChild( doc.createComment(\"\") );\n\t\treturn !div.getElementsByTagName(\"*\").length;\n\t});\n\n\t// Support: IE<9\n\tsupport.getElementsByClassName = rnative.test( doc.getElementsByClassName );\n\n\t// Support: IE<10\n\t// Check if getElementById returns elements by name\n\t// The broken getElementById methods don't pick up programatically-set names,\n\t// so use a roundabout getElementsByName test\n\tsupport.getById = assert(function( div ) {\n\t\tdocElem.appendChild( div ).id = expando;\n\t\treturn !doc.getElementsByName || !doc.getElementsByName( expando ).length;\n\t});\n\n\t// ID find and filter\n\tif ( support.getById ) {\n\t\tExpr.find[\"ID\"] = function( id, context ) {\n\t\t\tif ( typeof context.getElementById !== strundefined && documentIsHTML ) {\n\t\t\t\tvar m = context.getElementById( id );\n\t\t\t\t// Check parentNode to catch when Blackberry 4.6 returns\n\t\t\t\t// nodes that are no longer in the document #6963\n\t\t\t\treturn m && m.parentNode ? [ m ] : [];\n\t\t\t}\n\t\t};\n\t\tExpr.filter[\"ID\"] = function( id ) {\n\t\t\tvar attrId = id.replace( runescape, funescape );\n\t\t\treturn function( elem ) {\n\t\t\t\treturn elem.getAttribute(\"id\") === attrId;\n\t\t\t};\n\t\t};\n\t} else {\n\t\t// Support: IE6/7\n\t\t// getElementById is not reliable as a find shortcut\n\t\tdelete Expr.find[\"ID\"];\n\n\t\tExpr.filter[\"ID\"] =  function( id ) {\n\t\t\tvar attrId = id.replace( runescape, funescape );\n\t\t\treturn function( elem ) {\n\t\t\t\tvar node = typeof elem.getAttributeNode !== strundefined && elem.getAttributeNode(\"id\");\n\t\t\t\treturn node && node.value === attrId;\n\t\t\t};\n\t\t};\n\t}\n\n\t// Tag\n\tExpr.find[\"TAG\"] = support.getElementsByTagName ?\n\t\tfunction( tag, context ) {\n\t\t\tif ( typeof context.getElementsByTagName !== strundefined ) {\n\t\t\t\treturn context.getElementsByTagName( tag );\n\t\t\t}\n\t\t} :\n\t\tfunction( tag, context ) {\n\t\t\tvar elem,\n\t\t\t\ttmp = [],\n\t\t\t\ti = 0,\n\t\t\t\tresults = context.getElementsByTagName( tag );\n\n\t\t\t// Filter out possible comments\n\t\t\tif ( tag === \"*\" ) {\n\t\t\t\twhile ( (elem = results[i++]) ) {\n\t\t\t\t\tif ( elem.nodeType === 1 ) {\n\t\t\t\t\t\ttmp.push( elem );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn tmp;\n\t\t\t}\n\t\t\treturn results;\n\t\t};\n\n\t// Class\n\tExpr.find[\"CLASS\"] = support.getElementsByClassName && function( className, context ) {\n\t\tif ( documentIsHTML ) {\n\t\t\treturn context.getElementsByClassName( className );\n\t\t}\n\t};\n\n\t/* QSA/matchesSelector\n\t---------------------------------------------------------------------- */\n\n\t// QSA and matchesSelector support\n\n\t// matchesSelector(:active) reports false when true (IE9/Opera 11.5)\n\trbuggyMatches = [];\n\n\t// qSa(:focus) reports false when true (Chrome 21)\n\t// We allow this because of a bug in IE8/9 that throws an error\n\t// whenever `document.activeElement` is accessed on an iframe\n\t// So, we allow :focus to pass through QSA all the time to avoid the IE error\n\t// See http://bugs.jquery.com/ticket/13378\n\trbuggyQSA = [];\n\n\tif ( (support.qsa = rnative.test( doc.querySelectorAll )) ) {\n\t\t// Build QSA regex\n\t\t// Regex strategy adopted from Diego Perini\n\t\tassert(function( div ) {\n\t\t\t// Select is set to empty string on purpose\n\t\t\t// This is to test IE's treatment of not explicitly\n\t\t\t// setting a boolean content attribute,\n\t\t\t// since its presence should be enough\n\t\t\t// http://bugs.jquery.com/ticket/12359\n\t\t\tdiv.innerHTML = \"<select msallowcapture=''><option selected=''></option></select>\";\n\n\t\t\t// Support: IE8, Opera 11-12.16\n\t\t\t// Nothing should be selected when empty strings follow ^= or $= or *=\n\t\t\t// The test attribute must be unknown in Opera but \"safe\" for WinRT\n\t\t\t// http://msdn.microsoft.com/en-us/library/ie/hh465388.aspx#attribute_section\n\t\t\tif ( div.querySelectorAll(\"[msallowcapture^='']\").length ) {\n\t\t\t\trbuggyQSA.push( \"[*^$]=\" + whitespace + \"*(?:''|\\\"\\\")\" );\n\t\t\t}\n\n\t\t\t// Support: IE8\n\t\t\t// Boolean attributes and \"value\" are not treated correctly\n\t\t\tif ( !div.querySelectorAll(\"[selected]\").length ) {\n\t\t\t\trbuggyQSA.push( \"\\\\[\" + whitespace + \"*(?:value|\" + booleans + \")\" );\n\t\t\t}\n\n\t\t\t// Webkit/Opera - :checked should return selected option elements\n\t\t\t// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked\n\t\t\t// IE8 throws error here and will not see later tests\n\t\t\tif ( !div.querySelectorAll(\":checked\").length ) {\n\t\t\t\trbuggyQSA.push(\":checked\");\n\t\t\t}\n\t\t});\n\n\t\tassert(function( div ) {\n\t\t\t// Support: Windows 8 Native Apps\n\t\t\t// The type and name attributes are restricted during .innerHTML assignment\n\t\t\tvar input = doc.createElement(\"input\");\n\t\t\tinput.setAttribute( \"type\", \"hidden\" );\n\t\t\tdiv.appendChild( input ).setAttribute( \"name\", \"D\" );\n\n\t\t\t// Support: IE8\n\t\t\t// Enforce case-sensitivity of name attribute\n\t\t\tif ( div.querySelectorAll(\"[name=d]\").length ) {\n\t\t\t\trbuggyQSA.push( \"name\" + whitespace + \"*[*^$|!~]?=\" );\n\t\t\t}\n\n\t\t\t// FF 3.5 - :enabled/:disabled and hidden elements (hidden elements are still enabled)\n\t\t\t// IE8 throws error here and will not see later tests\n\t\t\tif ( !div.querySelectorAll(\":enabled\").length ) {\n\t\t\t\trbuggyQSA.push( \":enabled\", \":disabled\" );\n\t\t\t}\n\n\t\t\t// Opera 10-11 does not throw on post-comma invalid pseudos\n\t\t\tdiv.querySelectorAll(\"*,:x\");\n\t\t\trbuggyQSA.push(\",.*:\");\n\t\t});\n\t}\n\n\tif ( (support.matchesSelector = rnative.test( (matches = docElem.matches ||\n\t\tdocElem.webkitMatchesSelector ||\n\t\tdocElem.mozMatchesSelector ||\n\t\tdocElem.oMatchesSelector ||\n\t\tdocElem.msMatchesSelector) )) ) {\n\n\t\tassert(function( div ) {\n\t\t\t// Check to see if it's possible to do matchesSelector\n\t\t\t// on a disconnected node (IE 9)\n\t\t\tsupport.disconnectedMatch = matches.call( div, \"div\" );\n\n\t\t\t// This should fail with an exception\n\t\t\t// Gecko does not error, returns false instead\n\t\t\tmatches.call( div, \"[s!='']:x\" );\n\t\t\trbuggyMatches.push( \"!=\", pseudos );\n\t\t});\n\t}\n\n\trbuggyQSA = rbuggyQSA.length && new RegExp( rbuggyQSA.join(\"|\") );\n\trbuggyMatches = rbuggyMatches.length && new RegExp( rbuggyMatches.join(\"|\") );\n\n\t/* Contains\n\t---------------------------------------------------------------------- */\n\thasCompare = rnative.test( docElem.compareDocumentPosition );\n\n\t// Element contains another\n\t// Purposefully does not implement inclusive descendent\n\t// As in, an element does not contain itself\n\tcontains = hasCompare || rnative.test( docElem.contains ) ?\n\t\tfunction( a, b ) {\n\t\t\tvar adown = a.nodeType === 9 ? a.documentElement : a,\n\t\t\t\tbup = b && b.parentNode;\n\t\t\treturn a === bup || !!( bup && bup.nodeType === 1 && (\n\t\t\t\tadown.contains ?\n\t\t\t\t\tadown.contains( bup ) :\n\t\t\t\t\ta.compareDocumentPosition && a.compareDocumentPosition( bup ) & 16\n\t\t\t));\n\t\t} :\n\t\tfunction( a, b ) {\n\t\t\tif ( b ) {\n\t\t\t\twhile ( (b = b.parentNode) ) {\n\t\t\t\t\tif ( b === a ) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\n\t/* Sorting\n\t---------------------------------------------------------------------- */\n\n\t// Document order sorting\n\tsortOrder = hasCompare ?\n\tfunction( a, b ) {\n\n\t\t// Flag for duplicate removal\n\t\tif ( a === b ) {\n\t\t\thasDuplicate = true;\n\t\t\treturn 0;\n\t\t}\n\n\t\t// Sort on method existence if only one input has compareDocumentPosition\n\t\tvar compare = !a.compareDocumentPosition - !b.compareDocumentPosition;\n\t\tif ( compare ) {\n\t\t\treturn compare;\n\t\t}\n\n\t\t// Calculate position if both inputs belong to the same document\n\t\tcompare = ( a.ownerDocument || a ) === ( b.ownerDocument || b ) ?\n\t\t\ta.compareDocumentPosition( b ) :\n\n\t\t\t// Otherwise we know they are disconnected\n\t\t\t1;\n\n\t\t// Disconnected nodes\n\t\tif ( compare & 1 ||\n\t\t\t(!support.sortDetached && b.compareDocumentPosition( a ) === compare) ) {\n\n\t\t\t// Choose the first element that is related to our preferred document\n\t\t\tif ( a === doc || a.ownerDocument === preferredDoc && contains(preferredDoc, a) ) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif ( b === doc || b.ownerDocument === preferredDoc && contains(preferredDoc, b) ) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\t// Maintain original order\n\t\t\treturn sortInput ?\n\t\t\t\t( indexOf.call( sortInput, a ) - indexOf.call( sortInput, b ) ) :\n\t\t\t\t0;\n\t\t}\n\n\t\treturn compare & 4 ? -1 : 1;\n\t} :\n\tfunction( a, b ) {\n\t\t// Exit early if the nodes are identical\n\t\tif ( a === b ) {\n\t\t\thasDuplicate = true;\n\t\t\treturn 0;\n\t\t}\n\n\t\tvar cur,\n\t\t\ti = 0,\n\t\t\taup = a.parentNode,\n\t\t\tbup = b.parentNode,\n\t\t\tap = [ a ],\n\t\t\tbp = [ b ];\n\n\t\t// Parentless nodes are either documents or disconnected\n\t\tif ( !aup || !bup ) {\n\t\t\treturn a === doc ? -1 :\n\t\t\t\tb === doc ? 1 :\n\t\t\t\taup ? -1 :\n\t\t\t\tbup ? 1 :\n\t\t\t\tsortInput ?\n\t\t\t\t( indexOf.call( sortInput, a ) - indexOf.call( sortInput, b ) ) :\n\t\t\t\t0;\n\n\t\t// If the nodes are siblings, we can do a quick check\n\t\t} else if ( aup === bup ) {\n\t\t\treturn siblingCheck( a, b );\n\t\t}\n\n\t\t// Otherwise we need full lists of their ancestors for comparison\n\t\tcur = a;\n\t\twhile ( (cur = cur.parentNode) ) {\n\t\t\tap.unshift( cur );\n\t\t}\n\t\tcur = b;\n\t\twhile ( (cur = cur.parentNode) ) {\n\t\t\tbp.unshift( cur );\n\t\t}\n\n\t\t// Walk down the tree looking for a discrepancy\n\t\twhile ( ap[i] === bp[i] ) {\n\t\t\ti++;\n\t\t}\n\n\t\treturn i ?\n\t\t\t// Do a sibling check if the nodes have a common ancestor\n\t\t\tsiblingCheck( ap[i], bp[i] ) :\n\n\t\t\t// Otherwise nodes in our document sort first\n\t\t\tap[i] === preferredDoc ? -1 :\n\t\t\tbp[i] === preferredDoc ? 1 :\n\t\t\t0;\n\t};\n\n\treturn doc;\n};\n\nSizzle.matches = function( expr, elements ) {\n\treturn Sizzle( expr, null, null, elements );\n};\n\nSizzle.matchesSelector = function( elem, expr ) {\n\t// Set document vars if needed\n\tif ( ( elem.ownerDocument || elem ) !== document ) {\n\t\tsetDocument( elem );\n\t}\n\n\t// Make sure that attribute selectors are quoted\n\texpr = expr.replace( rattributeQuotes, \"='$1']\" );\n\n\tif ( support.matchesSelector && documentIsHTML &&\n\t\t( !rbuggyMatches || !rbuggyMatches.test( expr ) ) &&\n\t\t( !rbuggyQSA     || !rbuggyQSA.test( expr ) ) ) {\n\n\t\ttry {\n\t\t\tvar ret = matches.call( elem, expr );\n\n\t\t\t// IE 9's matchesSelector returns false on disconnected nodes\n\t\t\tif ( ret || support.disconnectedMatch ||\n\t\t\t\t\t// As well, disconnected nodes are said to be in a document\n\t\t\t\t\t// fragment in IE 9\n\t\t\t\t\telem.document && elem.document.nodeType !== 11 ) {\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t} catch(e) {}\n\t}\n\n\treturn Sizzle( expr, document, null, [ elem ] ).length > 0;\n};\n\nSizzle.contains = function( context, elem ) {\n\t// Set document vars if needed\n\tif ( ( context.ownerDocument || context ) !== document ) {\n\t\tsetDocument( context );\n\t}\n\treturn contains( context, elem );\n};\n\nSizzle.attr = function( elem, name ) {\n\t// Set document vars if needed\n\tif ( ( elem.ownerDocument || elem ) !== document ) {\n\t\tsetDocument( elem );\n\t}\n\n\tvar fn = Expr.attrHandle[ name.toLowerCase() ],\n\t\t// Don't get fooled by Object.prototype properties (jQuery #13807)\n\t\tval = fn && hasOwn.call( Expr.attrHandle, name.toLowerCase() ) ?\n\t\t\tfn( elem, name, !documentIsHTML ) :\n\t\t\tundefined;\n\n\treturn val !== undefined ?\n\t\tval :\n\t\tsupport.attributes || !documentIsHTML ?\n\t\t\telem.getAttribute( name ) :\n\t\t\t(val = elem.getAttributeNode(name)) && val.specified ?\n\t\t\t\tval.value :\n\t\t\t\tnull;\n};\n\nSizzle.error = function( msg ) {\n\tthrow new Error( \"Syntax error, unrecognized expression: \" + msg );\n};\n\n/**\n * Document sorting and removing duplicates\n * @param {ArrayLike} results\n */\nSizzle.uniqueSort = function( results ) {\n\tvar elem,\n\t\tduplicates = [],\n\t\tj = 0,\n\t\ti = 0;\n\n\t// Unless we *know* we can detect duplicates, assume their presence\n\thasDuplicate = !support.detectDuplicates;\n\tsortInput = !support.sortStable && results.slice( 0 );\n\tresults.sort( sortOrder );\n\n\tif ( hasDuplicate ) {\n\t\twhile ( (elem = results[i++]) ) {\n\t\t\tif ( elem === results[ i ] ) {\n\t\t\t\tj = duplicates.push( i );\n\t\t\t}\n\t\t}\n\t\twhile ( j-- ) {\n\t\t\tresults.splice( duplicates[ j ], 1 );\n\t\t}\n\t}\n\n\t// Clear input after sorting to release objects\n\t// See https://github.com/jquery/sizzle/pull/225\n\tsortInput = null;\n\n\treturn results;\n};\n\n/**\n * Utility function for retrieving the text value of an array of DOM nodes\n * @param {Array|Element} elem\n */\ngetText = Sizzle.getText = function( elem ) {\n\tvar node,\n\t\tret = \"\",\n\t\ti = 0,\n\t\tnodeType = elem.nodeType;\n\n\tif ( !nodeType ) {\n\t\t// If no nodeType, this is expected to be an array\n\t\twhile ( (node = elem[i++]) ) {\n\t\t\t// Do not traverse comment nodes\n\t\t\tret += getText( node );\n\t\t}\n\t} else if ( nodeType === 1 || nodeType === 9 || nodeType === 11 ) {\n\t\t// Use textContent for elements\n\t\t// innerText usage removed for consistency of new lines (jQuery #11153)\n\t\tif ( typeof elem.textContent === \"string\" ) {\n\t\t\treturn elem.textContent;\n\t\t} else {\n\t\t\t// Traverse its children\n\t\t\tfor ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {\n\t\t\t\tret += getText( elem );\n\t\t\t}\n\t\t}\n\t} else if ( nodeType === 3 || nodeType === 4 ) {\n\t\treturn elem.nodeValue;\n\t}\n\t// Do not include comment or processing instruction nodes\n\n\treturn ret;\n};\n\nExpr = Sizzle.selectors = {\n\n\t// Can be adjusted by the user\n\tcacheLength: 50,\n\n\tcreatePseudo: markFunction,\n\n\tmatch: matchExpr,\n\n\tattrHandle: {},\n\n\tfind: {},\n\n\trelative: {\n\t\t\">\": { dir: \"parentNode\", first: true },\n\t\t\" \": { dir: \"parentNode\" },\n\t\t\"+\": { dir: \"previousSibling\", first: true },\n\t\t\"~\": { dir: \"previousSibling\" }\n\t},\n\n\tpreFilter: {\n\t\t\"ATTR\": function( match ) {\n\t\t\tmatch[1] = match[1].replace( runescape, funescape );\n\n\t\t\t// Move the given value to match[3] whether quoted or unquoted\n\t\t\tmatch[3] = ( match[3] || match[4] || match[5] || \"\" ).replace( runescape, funescape );\n\n\t\t\tif ( match[2] === \"~=\" ) {\n\t\t\t\tmatch[3] = \" \" + match[3] + \" \";\n\t\t\t}\n\n\t\t\treturn match.slice( 0, 4 );\n\t\t},\n\n\t\t\"CHILD\": function( match ) {\n\t\t\t/* matches from matchExpr[\"CHILD\"]\n\t\t\t\t1 type (only|nth|...)\n\t\t\t\t2 what (child|of-type)\n\t\t\t\t3 argument (even|odd|\\d*|\\d*n([+-]\\d+)?|...)\n\t\t\t\t4 xn-component of xn+y argument ([+-]?\\d*n|)\n\t\t\t\t5 sign of xn-component\n\t\t\t\t6 x of xn-component\n\t\t\t\t7 sign of y-component\n\t\t\t\t8 y of y-component\n\t\t\t*/\n\t\t\tmatch[1] = match[1].toLowerCase();\n\n\t\t\tif ( match[1].slice( 0, 3 ) === \"nth\" ) {\n\t\t\t\t// nth-* requires argument\n\t\t\t\tif ( !match[3] ) {\n\t\t\t\t\tSizzle.error( match[0] );\n\t\t\t\t}\n\n\t\t\t\t// numeric x and y parameters for Expr.filter.CHILD\n\t\t\t\t// remember that false/true cast respectively to 0/1\n\t\t\t\tmatch[4] = +( match[4] ? match[5] + (match[6] || 1) : 2 * ( match[3] === \"even\" || match[3] === \"odd\" ) );\n\t\t\t\tmatch[5] = +( ( match[7] + match[8] ) || match[3] === \"odd\" );\n\n\t\t\t// other types prohibit arguments\n\t\t\t} else if ( match[3] ) {\n\t\t\t\tSizzle.error( match[0] );\n\t\t\t}\n\n\t\t\treturn match;\n\t\t},\n\n\t\t\"PSEUDO\": function( match ) {\n\t\t\tvar excess,\n\t\t\t\tunquoted = !match[6] && match[2];\n\n\t\t\tif ( matchExpr[\"CHILD\"].test( match[0] ) ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Accept quoted arguments as-is\n\t\t\tif ( match[3] ) {\n\t\t\t\tmatch[2] = match[4] || match[5] || \"\";\n\n\t\t\t// Strip excess characters from unquoted arguments\n\t\t\t} else if ( unquoted && rpseudo.test( unquoted ) &&\n\t\t\t\t// Get excess from tokenize (recursively)\n\t\t\t\t(excess = tokenize( unquoted, true )) &&\n\t\t\t\t// advance to the next closing parenthesis\n\t\t\t\t(excess = unquoted.indexOf( \")\", unquoted.length - excess ) - unquoted.length) ) {\n\n\t\t\t\t// excess is a negative index\n\t\t\t\tmatch[0] = match[0].slice( 0, excess );\n\t\t\t\tmatch[2] = unquoted.slice( 0, excess );\n\t\t\t}\n\n\t\t\t// Return only captures needed by the pseudo filter method (type and argument)\n\t\t\treturn match.slice( 0, 3 );\n\t\t}\n\t},\n\n\tfilter: {\n\n\t\t\"TAG\": function( nodeNameSelector ) {\n\t\t\tvar nodeName = nodeNameSelector.replace( runescape, funescape ).toLowerCase();\n\t\t\treturn nodeNameSelector === \"*\" ?\n\t\t\t\tfunction() { return true; } :\n\t\t\t\tfunction( elem ) {\n\t\t\t\t\treturn elem.nodeName && elem.nodeName.toLowerCase() === nodeName;\n\t\t\t\t};\n\t\t},\n\n\t\t\"CLASS\": function( className ) {\n\t\t\tvar pattern = classCache[ className + \" \" ];\n\n\t\t\treturn pattern ||\n\t\t\t\t(pattern = new RegExp( \"(^|\" + whitespace + \")\" + className + \"(\" + whitespace + \"|$)\" )) &&\n\t\t\t\tclassCache( className, function( elem ) {\n\t\t\t\t\treturn pattern.test( typeof elem.className === \"string\" && elem.className || typeof elem.getAttribute !== strundefined && elem.getAttribute(\"class\") || \"\" );\n\t\t\t\t});\n\t\t},\n\n\t\t\"ATTR\": function( name, operator, check ) {\n\t\t\treturn function( elem ) {\n\t\t\t\tvar result = Sizzle.attr( elem, name );\n\n\t\t\t\tif ( result == null ) {\n\t\t\t\t\treturn operator === \"!=\";\n\t\t\t\t}\n\t\t\t\tif ( !operator ) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tresult += \"\";\n\n\t\t\t\treturn operator === \"=\" ? result === check :\n\t\t\t\t\toperator === \"!=\" ? result !== check :\n\t\t\t\t\toperator === \"^=\" ? check && result.indexOf( check ) === 0 :\n\t\t\t\t\toperator === \"*=\" ? check && result.indexOf( check ) > -1 :\n\t\t\t\t\toperator === \"$=\" ? check && result.slice( -check.length ) === check :\n\t\t\t\t\toperator === \"~=\" ? ( \" \" + result + \" \" ).indexOf( check ) > -1 :\n\t\t\t\t\toperator === \"|=\" ? result === check || result.slice( 0, check.length + 1 ) === check + \"-\" :\n\t\t\t\t\tfalse;\n\t\t\t};\n\t\t},\n\n\t\t\"CHILD\": function( type, what, argument, first, last ) {\n\t\t\tvar simple = type.slice( 0, 3 ) !== \"nth\",\n\t\t\t\tforward = type.slice( -4 ) !== \"last\",\n\t\t\t\tofType = what === \"of-type\";\n\n\t\t\treturn first === 1 && last === 0 ?\n\n\t\t\t\t// Shortcut for :nth-*(n)\n\t\t\t\tfunction( elem ) {\n\t\t\t\t\treturn !!elem.parentNode;\n\t\t\t\t} :\n\n\t\t\t\tfunction( elem, context, xml ) {\n\t\t\t\t\tvar cache, outerCache, node, diff, nodeIndex, start,\n\t\t\t\t\t\tdir = simple !== forward ? \"nextSibling\" : \"previousSibling\",\n\t\t\t\t\t\tparent = elem.parentNode,\n\t\t\t\t\t\tname = ofType && elem.nodeName.toLowerCase(),\n\t\t\t\t\t\tuseCache = !xml && !ofType;\n\n\t\t\t\t\tif ( parent ) {\n\n\t\t\t\t\t\t// :(first|last|only)-(child|of-type)\n\t\t\t\t\t\tif ( simple ) {\n\t\t\t\t\t\t\twhile ( dir ) {\n\t\t\t\t\t\t\t\tnode = elem;\n\t\t\t\t\t\t\t\twhile ( (node = node[ dir ]) ) {\n\t\t\t\t\t\t\t\t\tif ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) {\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Reverse direction for :only-* (if we haven't yet done so)\n\t\t\t\t\t\t\t\tstart = dir = type === \"only\" && !start && \"nextSibling\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstart = [ forward ? parent.firstChild : parent.lastChild ];\n\n\t\t\t\t\t\t// non-xml :nth-child(...) stores cache data on `parent`\n\t\t\t\t\t\tif ( forward && useCache ) {\n\t\t\t\t\t\t\t// Seek `elem` from a previously-cached index\n\t\t\t\t\t\t\touterCache = parent[ expando ] || (parent[ expando ] = {});\n\t\t\t\t\t\t\tcache = outerCache[ type ] || [];\n\t\t\t\t\t\t\tnodeIndex = cache[0] === dirruns && cache[1];\n\t\t\t\t\t\t\tdiff = cache[0] === dirruns && cache[2];\n\t\t\t\t\t\t\tnode = nodeIndex && parent.childNodes[ nodeIndex ];\n\n\t\t\t\t\t\t\twhile ( (node = ++nodeIndex && node && node[ dir ] ||\n\n\t\t\t\t\t\t\t\t// Fallback to seeking `elem` from the start\n\t\t\t\t\t\t\t\t(diff = nodeIndex = 0) || start.pop()) ) {\n\n\t\t\t\t\t\t\t\t// When found, cache indexes on `parent` and break\n\t\t\t\t\t\t\t\tif ( node.nodeType === 1 && ++diff && node === elem ) {\n\t\t\t\t\t\t\t\t\touterCache[ type ] = [ dirruns, nodeIndex, diff ];\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Use previously-cached element index if available\n\t\t\t\t\t\t} else if ( useCache && (cache = (elem[ expando ] || (elem[ expando ] = {}))[ type ]) && cache[0] === dirruns ) {\n\t\t\t\t\t\t\tdiff = cache[1];\n\n\t\t\t\t\t\t// xml :nth-child(...) or :nth-last-child(...) or :nth(-last)?-of-type(...)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Use the same loop as above to seek `elem` from the start\n\t\t\t\t\t\t\twhile ( (node = ++nodeIndex && node && node[ dir ] ||\n\t\t\t\t\t\t\t\t(diff = nodeIndex = 0) || start.pop()) ) {\n\n\t\t\t\t\t\t\t\tif ( ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) && ++diff ) {\n\t\t\t\t\t\t\t\t\t// Cache the index of each encountered element\n\t\t\t\t\t\t\t\t\tif ( useCache ) {\n\t\t\t\t\t\t\t\t\t\t(node[ expando ] || (node[ expando ] = {}))[ type ] = [ dirruns, diff ];\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif ( node === elem ) {\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Incorporate the offset, then check against cycle size\n\t\t\t\t\t\tdiff -= last;\n\t\t\t\t\t\treturn diff === first || ( diff % first === 0 && diff / first >= 0 );\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t},\n\n\t\t\"PSEUDO\": function( pseudo, argument ) {\n\t\t\t// pseudo-class names are case-insensitive\n\t\t\t// http://www.w3.org/TR/selectors/#pseudo-classes\n\t\t\t// Prioritize by case sensitivity in case custom pseudos are added with uppercase letters\n\t\t\t// Remember that setFilters inherits from pseudos\n\t\t\tvar args,\n\t\t\t\tfn = Expr.pseudos[ pseudo ] || Expr.setFilters[ pseudo.toLowerCase() ] ||\n\t\t\t\t\tSizzle.error( \"unsupported pseudo: \" + pseudo );\n\n\t\t\t// The user may use createPseudo to indicate that\n\t\t\t// arguments are needed to create the filter function\n\t\t\t// just as Sizzle does\n\t\t\tif ( fn[ expando ] ) {\n\t\t\t\treturn fn( argument );\n\t\t\t}\n\n\t\t\t// But maintain support for old signatures\n\t\t\tif ( fn.length > 1 ) {\n\t\t\t\targs = [ pseudo, pseudo, \"\", argument ];\n\t\t\t\treturn Expr.setFilters.hasOwnProperty( pseudo.toLowerCase() ) ?\n\t\t\t\t\tmarkFunction(function( seed, matches ) {\n\t\t\t\t\t\tvar idx,\n\t\t\t\t\t\t\tmatched = fn( seed, argument ),\n\t\t\t\t\t\t\ti = matched.length;\n\t\t\t\t\t\twhile ( i-- ) {\n\t\t\t\t\t\t\tidx = indexOf.call( seed, matched[i] );\n\t\t\t\t\t\t\tseed[ idx ] = !( matches[ idx ] = matched[i] );\n\t\t\t\t\t\t}\n\t\t\t\t\t}) :\n\t\t\t\t\tfunction( elem ) {\n\t\t\t\t\t\treturn fn( elem, 0, args );\n\t\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn fn;\n\t\t}\n\t},\n\n\tpseudos: {\n\t\t// Potentially complex pseudos\n\t\t\"not\": markFunction(function( selector ) {\n\t\t\t// Trim the selector passed to compile\n\t\t\t// to avoid treating leading and trailing\n\t\t\t// spaces as combinators\n\t\t\tvar input = [],\n\t\t\t\tresults = [],\n\t\t\t\tmatcher = compile( selector.replace( rtrim, \"$1\" ) );\n\n\t\t\treturn matcher[ expando ] ?\n\t\t\t\tmarkFunction(function( seed, matches, context, xml ) {\n\t\t\t\t\tvar elem,\n\t\t\t\t\t\tunmatched = matcher( seed, null, xml, [] ),\n\t\t\t\t\t\ti = seed.length;\n\n\t\t\t\t\t// Match elements unmatched by `matcher`\n\t\t\t\t\twhile ( i-- ) {\n\t\t\t\t\t\tif ( (elem = unmatched[i]) ) {\n\t\t\t\t\t\t\tseed[i] = !(matches[i] = elem);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}) :\n\t\t\t\tfunction( elem, context, xml ) {\n\t\t\t\t\tinput[0] = elem;\n\t\t\t\t\tmatcher( input, null, xml, results );\n\t\t\t\t\treturn !results.pop();\n\t\t\t\t};\n\t\t}),\n\n\t\t\"has\": markFunction(function( selector ) {\n\t\t\treturn function( elem ) {\n\t\t\t\treturn Sizzle( selector, elem ).length > 0;\n\t\t\t};\n\t\t}),\n\n\t\t\"contains\": markFunction(function( text ) {\n\t\t\ttext = text.replace( runescape, funescape );\n\t\t\treturn function( elem ) {\n\t\t\t\treturn ( elem.textContent || elem.innerText || getText( elem ) ).indexOf( text ) > -1;\n\t\t\t};\n\t\t}),\n\n\t\t// \"Whether an element is represented by a :lang() selector\n\t\t// is based solely on the element's language value\n\t\t// being equal to the identifier C,\n\t\t// or beginning with the identifier C immediately followed by \"-\".\n\t\t// The matching of C against the element's language value is performed case-insensitively.\n\t\t// The identifier C does not have to be a valid language name.\"\n\t\t// http://www.w3.org/TR/selectors/#lang-pseudo\n\t\t\"lang\": markFunction( function( lang ) {\n\t\t\t// lang value must be a valid identifier\n\t\t\tif ( !ridentifier.test(lang || \"\") ) {\n\t\t\t\tSizzle.error( \"unsupported lang: \" + lang );\n\t\t\t}\n\t\t\tlang = lang.replace( runescape, funescape ).toLowerCase();\n\t\t\treturn function( elem ) {\n\t\t\t\tvar elemLang;\n\t\t\t\tdo {\n\t\t\t\t\tif ( (elemLang = documentIsHTML ?\n\t\t\t\t\t\telem.lang :\n\t\t\t\t\t\telem.getAttribute(\"xml:lang\") || elem.getAttribute(\"lang\")) ) {\n\n\t\t\t\t\t\telemLang = elemLang.toLowerCase();\n\t\t\t\t\t\treturn elemLang === lang || elemLang.indexOf( lang + \"-\" ) === 0;\n\t\t\t\t\t}\n\t\t\t\t} while ( (elem = elem.parentNode) && elem.nodeType === 1 );\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}),\n\n\t\t// Miscellaneous\n\t\t\"target\": function( elem ) {\n\t\t\tvar hash = window.location && window.location.hash;\n\t\t\treturn hash && hash.slice( 1 ) === elem.id;\n\t\t},\n\n\t\t\"root\": function( elem ) {\n\t\t\treturn elem === docElem;\n\t\t},\n\n\t\t\"focus\": function( elem ) {\n\t\t\treturn elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);\n\t\t},\n\n\t\t// Boolean properties\n\t\t\"enabled\": function( elem ) {\n\t\t\treturn elem.disabled === false;\n\t\t},\n\n\t\t\"disabled\": function( elem ) {\n\t\t\treturn elem.disabled === true;\n\t\t},\n\n\t\t\"checked\": function( elem ) {\n\t\t\t// In CSS3, :checked should return both checked and selected elements\n\t\t\t// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked\n\t\t\tvar nodeName = elem.nodeName.toLowerCase();\n\t\t\treturn (nodeName === \"input\" && !!elem.checked) || (nodeName === \"option\" && !!elem.selected);\n\t\t},\n\n\t\t\"selected\": function( elem ) {\n\t\t\t// Accessing this property makes selected-by-default\n\t\t\t// options in Safari work properly\n\t\t\tif ( elem.parentNode ) {\n\t\t\t\telem.parentNode.selectedIndex;\n\t\t\t}\n\n\t\t\treturn elem.selected === true;\n\t\t},\n\n\t\t// Contents\n\t\t\"empty\": function( elem ) {\n\t\t\t// http://www.w3.org/TR/selectors/#empty-pseudo\n\t\t\t// :empty is negated by element (1) or content nodes (text: 3; cdata: 4; entity ref: 5),\n\t\t\t//   but not by others (comment: 8; processing instruction: 7; etc.)\n\t\t\t// nodeType < 6 works because attributes (2) do not appear as children\n\t\t\tfor ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {\n\t\t\t\tif ( elem.nodeType < 6 ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\n\t\t\"parent\": function( elem ) {\n\t\t\treturn !Expr.pseudos[\"empty\"]( elem );\n\t\t},\n\n\t\t// Element/input types\n\t\t\"header\": function( elem ) {\n\t\t\treturn rheader.test( elem.nodeName );\n\t\t},\n\n\t\t\"input\": function( elem ) {\n\t\t\treturn rinputs.test( elem.nodeName );\n\t\t},\n\n\t\t\"button\": function( elem ) {\n\t\t\tvar name = elem.nodeName.toLowerCase();\n\t\t\treturn name === \"input\" && elem.type === \"button\" || name === \"button\";\n\t\t},\n\n\t\t\"text\": function( elem ) {\n\t\t\tvar attr;\n\t\t\treturn elem.nodeName.toLowerCase() === \"input\" &&\n\t\t\t\telem.type === \"text\" &&\n\n\t\t\t\t// Support: IE<8\n\t\t\t\t// New HTML5 attribute values (e.g., \"search\") appear with elem.type === \"text\"\n\t\t\t\t( (attr = elem.getAttribute(\"type\")) == null || attr.toLowerCase() === \"text\" );\n\t\t},\n\n\t\t// Position-in-collection\n\t\t\"first\": createPositionalPseudo(function() {\n\t\t\treturn [ 0 ];\n\t\t}),\n\n\t\t\"last\": createPositionalPseudo(function( matchIndexes, length ) {\n\t\t\treturn [ length - 1 ];\n\t\t}),\n\n\t\t\"eq\": createPositionalPseudo(function( matchIndexes, length, argument ) {\n\t\t\treturn [ argument < 0 ? argument + length : argument ];\n\t\t}),\n\n\t\t\"even\": createPositionalPseudo(function( matchIndexes, length ) {\n\t\t\tvar i = 0;\n\t\t\tfor ( ; i < length; i += 2 ) {\n\t\t\t\tmatchIndexes.push( i );\n\t\t\t}\n\t\t\treturn matchIndexes;\n\t\t}),\n\n\t\t\"odd\": createPositionalPseudo(function( matchIndexes, length ) {\n\t\t\tvar i = 1;\n\t\t\tfor ( ; i < length; i += 2 ) {\n\t\t\t\tmatchIndexes.push( i );\n\t\t\t}\n\t\t\treturn matchIndexes;\n\t\t}),\n\n\t\t\"lt\": createPositionalPseudo(function( matchIndexes, length, argument ) {\n\t\t\tvar i = argument < 0 ? argument + length : argument;\n\t\t\tfor ( ; --i >= 0; ) {\n\t\t\t\tmatchIndexes.push( i );\n\t\t\t}\n\t\t\treturn matchIndexes;\n\t\t}),\n\n\t\t\"gt\": createPositionalPseudo(function( matchIndexes, length, argument ) {\n\t\t\tvar i = argument < 0 ? argument + length : argument;\n\t\t\tfor ( ; ++i < length; ) {\n\t\t\t\tmatchIndexes.push( i );\n\t\t\t}\n\t\t\treturn matchIndexes;\n\t\t})\n\t}\n};\n\nExpr.pseudos[\"nth\"] = Expr.pseudos[\"eq\"];\n\n// Add button/input type pseudos\nfor ( i in { radio: true, checkbox: true, file: true, password: true, image: true } ) {\n\tExpr.pseudos[ i ] = createInputPseudo( i );\n}\nfor ( i in { submit: true, reset: true } ) {\n\tExpr.pseudos[ i ] = createButtonPseudo( i );\n}\n\n// Easy API for creating new setFilters\nfunction setFilters() {}\nsetFilters.prototype = Expr.filters = Expr.pseudos;\nExpr.setFilters = new setFilters();\n\ntokenize = Sizzle.tokenize = function( selector, parseOnly ) {\n\tvar matched, match, tokens, type,\n\t\tsoFar, groups, preFilters,\n\t\tcached = tokenCache[ selector + \" \" ];\n\n\tif ( cached ) {\n\t\treturn parseOnly ? 0 : cached.slice( 0 );\n\t}\n\n\tsoFar = selector;\n\tgroups = [];\n\tpreFilters = Expr.preFilter;\n\n\twhile ( soFar ) {\n\n\t\t// Comma and first run\n\t\tif ( !matched || (match = rcomma.exec( soFar )) ) {\n\t\t\tif ( match ) {\n\t\t\t\t// Don't consume trailing commas as valid\n\t\t\t\tsoFar = soFar.slice( match[0].length ) || soFar;\n\t\t\t}\n\t\t\tgroups.push( (tokens = []) );\n\t\t}\n\n\t\tmatched = false;\n\n\t\t// Combinators\n\t\tif ( (match = rcombinators.exec( soFar )) ) {\n\t\t\tmatched = match.shift();\n\t\t\ttokens.push({\n\t\t\t\tvalue: matched,\n\t\t\t\t// Cast descendant combinators to space\n\t\t\t\ttype: match[0].replace( rtrim, \" \" )\n\t\t\t});\n\t\t\tsoFar = soFar.slice( matched.length );\n\t\t}\n\n\t\t// Filters\n\t\tfor ( type in Expr.filter ) {\n\t\t\tif ( (match = matchExpr[ type ].exec( soFar )) && (!preFilters[ type ] ||\n\t\t\t\t(match = preFilters[ type ]( match ))) ) {\n\t\t\t\tmatched = match.shift();\n\t\t\t\ttokens.push({\n\t\t\t\t\tvalue: matched,\n\t\t\t\t\ttype: type,\n\t\t\t\t\tmatches: match\n\t\t\t\t});\n\t\t\t\tsoFar = soFar.slice( matched.length );\n\t\t\t}\n\t\t}\n\n\t\tif ( !matched ) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t// Return the length of the invalid excess\n\t// if we're just parsing\n\t// Otherwise, throw an error or return tokens\n\treturn parseOnly ?\n\t\tsoFar.length :\n\t\tsoFar ?\n\t\t\tSizzle.error( selector ) :\n\t\t\t// Cache the tokens\n\t\t\ttokenCache( selector, groups ).slice( 0 );\n};\n\nfunction toSelector( tokens ) {\n\tvar i = 0,\n\t\tlen = tokens.length,\n\t\tselector = \"\";\n\tfor ( ; i < len; i++ ) {\n\t\tselector += tokens[i].value;\n\t}\n\treturn selector;\n}\n\nfunction addCombinator( matcher, combinator, base ) {\n\tvar dir = combinator.dir,\n\t\tcheckNonElements = base && dir === \"parentNode\",\n\t\tdoneName = done++;\n\n\treturn combinator.first ?\n\t\t// Check against closest ancestor/preceding element\n\t\tfunction( elem, context, xml ) {\n\t\t\twhile ( (elem = elem[ dir ]) ) {\n\t\t\t\tif ( elem.nodeType === 1 || checkNonElements ) {\n\t\t\t\t\treturn matcher( elem, context, xml );\n\t\t\t\t}\n\t\t\t}\n\t\t} :\n\n\t\t// Check against all ancestor/preceding elements\n\t\tfunction( elem, context, xml ) {\n\t\t\tvar oldCache, outerCache,\n\t\t\t\tnewCache = [ dirruns, doneName ];\n\n\t\t\t// We can't set arbitrary data on XML nodes, so they don't benefit from dir caching\n\t\t\tif ( xml ) {\n\t\t\t\twhile ( (elem = elem[ dir ]) ) {\n\t\t\t\t\tif ( elem.nodeType === 1 || checkNonElements ) {\n\t\t\t\t\t\tif ( matcher( elem, context, xml ) ) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twhile ( (elem = elem[ dir ]) ) {\n\t\t\t\t\tif ( elem.nodeType === 1 || checkNonElements ) {\n\t\t\t\t\t\touterCache = elem[ expando ] || (elem[ expando ] = {});\n\t\t\t\t\t\tif ( (oldCache = outerCache[ dir ]) &&\n\t\t\t\t\t\t\toldCache[ 0 ] === dirruns && oldCache[ 1 ] === doneName ) {\n\n\t\t\t\t\t\t\t// Assign to newCache so results back-propagate to previous elements\n\t\t\t\t\t\t\treturn (newCache[ 2 ] = oldCache[ 2 ]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Reuse newcache so results back-propagate to previous elements\n\t\t\t\t\t\t\touterCache[ dir ] = newCache;\n\n\t\t\t\t\t\t\t// A match means we're done; a fail means we have to keep checking\n\t\t\t\t\t\t\tif ( (newCache[ 2 ] = matcher( elem, context, xml )) ) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n}\n\nfunction elementMatcher( matchers ) {\n\treturn matchers.length > 1 ?\n\t\tfunction( elem, context, xml ) {\n\t\t\tvar i = matchers.length;\n\t\t\twhile ( i-- ) {\n\t\t\t\tif ( !matchers[i]( elem, context, xml ) ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t} :\n\t\tmatchers[0];\n}\n\nfunction multipleContexts( selector, contexts, results ) {\n\tvar i = 0,\n\t\tlen = contexts.length;\n\tfor ( ; i < len; i++ ) {\n\t\tSizzle( selector, contexts[i], results );\n\t}\n\treturn results;\n}\n\nfunction condense( unmatched, map, filter, context, xml ) {\n\tvar elem,\n\t\tnewUnmatched = [],\n\t\ti = 0,\n\t\tlen = unmatched.length,\n\t\tmapped = map != null;\n\n\tfor ( ; i < len; i++ ) {\n\t\tif ( (elem = unmatched[i]) ) {\n\t\t\tif ( !filter || filter( elem, context, xml ) ) {\n\t\t\t\tnewUnmatched.push( elem );\n\t\t\t\tif ( mapped ) {\n\t\t\t\t\tmap.push( i );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn newUnmatched;\n}\n\nfunction setMatcher( preFilter, selector, matcher, postFilter, postFinder, postSelector ) {\n\tif ( postFilter && !postFilter[ expando ] ) {\n\t\tpostFilter = setMatcher( postFilter );\n\t}\n\tif ( postFinder && !postFinder[ expando ] ) {\n\t\tpostFinder = setMatcher( postFinder, postSelector );\n\t}\n\treturn markFunction(function( seed, results, context, xml ) {\n\t\tvar temp, i, elem,\n\t\t\tpreMap = [],\n\t\t\tpostMap = [],\n\t\t\tpreexisting = results.length,\n\n\t\t\t// Get initial elements from seed or context\n\t\t\telems = seed || multipleContexts( selector || \"*\", context.nodeType ? [ context ] : context, [] ),\n\n\t\t\t// Prefilter to get matcher input, preserving a map for seed-results synchronization\n\t\t\tmatcherIn = preFilter && ( seed || !selector ) ?\n\t\t\t\tcondense( elems, preMap, preFilter, context, xml ) :\n\t\t\t\telems,\n\n\t\t\tmatcherOut = matcher ?\n\t\t\t\t// If we have a postFinder, or filtered seed, or non-seed postFilter or preexisting results,\n\t\t\t\tpostFinder || ( seed ? preFilter : preexisting || postFilter ) ?\n\n\t\t\t\t\t// ...intermediate processing is necessary\n\t\t\t\t\t[] :\n\n\t\t\t\t\t// ...otherwise use results directly\n\t\t\t\t\tresults :\n\t\t\t\tmatcherIn;\n\n\t\t// Find primary matches\n\t\tif ( matcher ) {\n\t\t\tmatcher( matcherIn, matcherOut, context, xml );\n\t\t}\n\n\t\t// Apply postFilter\n\t\tif ( postFilter ) {\n\t\t\ttemp = condense( matcherOut, postMap );\n\t\t\tpostFilter( temp, [], context, xml );\n\n\t\t\t// Un-match failing elements by moving them back to matcherIn\n\t\t\ti = temp.length;\n\t\t\twhile ( i-- ) {\n\t\t\t\tif ( (elem = temp[i]) ) {\n\t\t\t\t\tmatcherOut[ postMap[i] ] = !(matcherIn[ postMap[i] ] = elem);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( seed ) {\n\t\t\tif ( postFinder || preFilter ) {\n\t\t\t\tif ( postFinder ) {\n\t\t\t\t\t// Get the final matcherOut by condensing this intermediate into postFinder contexts\n\t\t\t\t\ttemp = [];\n\t\t\t\t\ti = matcherOut.length;\n\t\t\t\t\twhile ( i-- ) {\n\t\t\t\t\t\tif ( (elem = matcherOut[i]) ) {\n\t\t\t\t\t\t\t// Restore matcherIn since elem is not yet a final match\n\t\t\t\t\t\t\ttemp.push( (matcherIn[i] = elem) );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tpostFinder( null, (matcherOut = []), temp, xml );\n\t\t\t\t}\n\n\t\t\t\t// Move matched elements from seed to results to keep them synchronized\n\t\t\t\ti = matcherOut.length;\n\t\t\t\twhile ( i-- ) {\n\t\t\t\t\tif ( (elem = matcherOut[i]) &&\n\t\t\t\t\t\t(temp = postFinder ? indexOf.call( seed, elem ) : preMap[i]) > -1 ) {\n\n\t\t\t\t\t\tseed[temp] = !(results[temp] = elem);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t// Add elements to results, through postFinder if defined\n\t\t} else {\n\t\t\tmatcherOut = condense(\n\t\t\t\tmatcherOut === results ?\n\t\t\t\t\tmatcherOut.splice( preexisting, matcherOut.length ) :\n\t\t\t\t\tmatcherOut\n\t\t\t);\n\t\t\tif ( postFinder ) {\n\t\t\t\tpostFinder( null, results, matcherOut, xml );\n\t\t\t} else {\n\t\t\t\tpush.apply( results, matcherOut );\n\t\t\t}\n\t\t}\n\t});\n}\n\nfunction matcherFromTokens( tokens ) {\n\tvar checkContext, matcher, j,\n\t\tlen = tokens.length,\n\t\tleadingRelative = Expr.relative[ tokens[0].type ],\n\t\timplicitRelative = leadingRelative || Expr.relative[\" \"],\n\t\ti = leadingRelative ? 1 : 0,\n\n\t\t// The foundational matcher ensures that elements are reachable from top-level context(s)\n\t\tmatchContext = addCombinator( function( elem ) {\n\t\t\treturn elem === checkContext;\n\t\t}, implicitRelative, true ),\n\t\tmatchAnyContext = addCombinator( function( elem ) {\n\t\t\treturn indexOf.call( checkContext, elem ) > -1;\n\t\t}, implicitRelative, true ),\n\t\tmatchers = [ function( elem, context, xml ) {\n\t\t\treturn ( !leadingRelative && ( xml || context !== outermostContext ) ) || (\n\t\t\t\t(checkContext = context).nodeType ?\n\t\t\t\t\tmatchContext( elem, context, xml ) :\n\t\t\t\t\tmatchAnyContext( elem, context, xml ) );\n\t\t} ];\n\n\tfor ( ; i < len; i++ ) {\n\t\tif ( (matcher = Expr.relative[ tokens[i].type ]) ) {\n\t\t\tmatchers = [ addCombinator(elementMatcher( matchers ), matcher) ];\n\t\t} else {\n\t\t\tmatcher = Expr.filter[ tokens[i].type ].apply( null, tokens[i].matches );\n\n\t\t\t// Return special upon seeing a positional matcher\n\t\t\tif ( matcher[ expando ] ) {\n\t\t\t\t// Find the next relative operator (if any) for proper handling\n\t\t\t\tj = ++i;\n\t\t\t\tfor ( ; j < len; j++ ) {\n\t\t\t\t\tif ( Expr.relative[ tokens[j].type ] ) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn setMatcher(\n\t\t\t\t\ti > 1 && elementMatcher( matchers ),\n\t\t\t\t\ti > 1 && toSelector(\n\t\t\t\t\t\t// If the preceding token was a descendant combinator, insert an implicit any-element `*`\n\t\t\t\t\t\ttokens.slice( 0, i - 1 ).concat({ value: tokens[ i - 2 ].type === \" \" ? \"*\" : \"\" })\n\t\t\t\t\t).replace( rtrim, \"$1\" ),\n\t\t\t\t\tmatcher,\n\t\t\t\t\ti < j && matcherFromTokens( tokens.slice( i, j ) ),\n\t\t\t\t\tj < len && matcherFromTokens( (tokens = tokens.slice( j )) ),\n\t\t\t\t\tj < len && toSelector( tokens )\n\t\t\t\t);\n\t\t\t}\n\t\t\tmatchers.push( matcher );\n\t\t}\n\t}\n\n\treturn elementMatcher( matchers );\n}\n\nfunction matcherFromGroupMatchers( elementMatchers, setMatchers ) {\n\tvar bySet = setMatchers.length > 0,\n\t\tbyElement = elementMatchers.length > 0,\n\t\tsuperMatcher = function( seed, context, xml, results, outermost ) {\n\t\t\tvar elem, j, matcher,\n\t\t\t\tmatchedCount = 0,\n\t\t\t\ti = \"0\",\n\t\t\t\tunmatched = seed && [],\n\t\t\t\tsetMatched = [],\n\t\t\t\tcontextBackup = outermostContext,\n\t\t\t\t// We must always have either seed elements or outermost context\n\t\t\t\telems = seed || byElement && Expr.find[\"TAG\"]( \"*\", outermost ),\n\t\t\t\t// Use integer dirruns iff this is the outermost matcher\n\t\t\t\tdirrunsUnique = (dirruns += contextBackup == null ? 1 : Math.random() || 0.1),\n\t\t\t\tlen = elems.length;\n\n\t\t\tif ( outermost ) {\n\t\t\t\toutermostContext = context !== document && context;\n\t\t\t}\n\n\t\t\t// Add elements passing elementMatchers directly to results\n\t\t\t// Keep `i` a string if there are no elements so `matchedCount` will be \"00\" below\n\t\t\t// Support: IE<9, Safari\n\t\t\t// Tolerate NodeList properties (IE: \"length\"; Safari: <number>) matching elements by id\n\t\t\tfor ( ; i !== len && (elem = elems[i]) != null; i++ ) {\n\t\t\t\tif ( byElement && elem ) {\n\t\t\t\t\tj = 0;\n\t\t\t\t\twhile ( (matcher = elementMatchers[j++]) ) {\n\t\t\t\t\t\tif ( matcher( elem, context, xml ) ) {\n\t\t\t\t\t\t\tresults.push( elem );\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif ( outermost ) {\n\t\t\t\t\t\tdirruns = dirrunsUnique;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Track unmatched elements for set filters\n\t\t\t\tif ( bySet ) {\n\t\t\t\t\t// They will have gone through all possible matchers\n\t\t\t\t\tif ( (elem = !matcher && elem) ) {\n\t\t\t\t\t\tmatchedCount--;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Lengthen the array for every element, matched or not\n\t\t\t\t\tif ( seed ) {\n\t\t\t\t\t\tunmatched.push( elem );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Apply set filters to unmatched elements\n\t\t\tmatchedCount += i;\n\t\t\tif ( bySet && i !== matchedCount ) {\n\t\t\t\tj = 0;\n\t\t\t\twhile ( (matcher = setMatchers[j++]) ) {\n\t\t\t\t\tmatcher( unmatched, setMatched, context, xml );\n\t\t\t\t}\n\n\t\t\t\tif ( seed ) {\n\t\t\t\t\t// Reintegrate element matches to eliminate the need for sorting\n\t\t\t\t\tif ( matchedCount > 0 ) {\n\t\t\t\t\t\twhile ( i-- ) {\n\t\t\t\t\t\t\tif ( !(unmatched[i] || setMatched[i]) ) {\n\t\t\t\t\t\t\t\tsetMatched[i] = pop.call( results );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Discard index placeholder values to get only actual matches\n\t\t\t\t\tsetMatched = condense( setMatched );\n\t\t\t\t}\n\n\t\t\t\t// Add matches to results\n\t\t\t\tpush.apply( results, setMatched );\n\n\t\t\t\t// Seedless set matches succeeding multiple successful matchers stipulate sorting\n\t\t\t\tif ( outermost && !seed && setMatched.length > 0 &&\n\t\t\t\t\t( matchedCount + setMatchers.length ) > 1 ) {\n\n\t\t\t\t\tSizzle.uniqueSort( results );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Override manipulation of globals by nested matchers\n\t\t\tif ( outermost ) {\n\t\t\t\tdirruns = dirrunsUnique;\n\t\t\t\toutermostContext = contextBackup;\n\t\t\t}\n\n\t\t\treturn unmatched;\n\t\t};\n\n\treturn bySet ?\n\t\tmarkFunction( superMatcher ) :\n\t\tsuperMatcher;\n}\n\ncompile = Sizzle.compile = function( selector, match /* Internal Use Only */ ) {\n\tvar i,\n\t\tsetMatchers = [],\n\t\telementMatchers = [],\n\t\tcached = compilerCache[ selector + \" \" ];\n\n\tif ( !cached ) {\n\t\t// Generate a function of recursive functions that can be used to check each element\n\t\tif ( !match ) {\n\t\t\tmatch = tokenize( selector );\n\t\t}\n\t\ti = match.length;\n\t\twhile ( i-- ) {\n\t\t\tcached = matcherFromTokens( match[i] );\n\t\t\tif ( cached[ expando ] ) {\n\t\t\t\tsetMatchers.push( cached );\n\t\t\t} else {\n\t\t\t\telementMatchers.push( cached );\n\t\t\t}\n\t\t}\n\n\t\t// Cache the compiled function\n\t\tcached = compilerCache( selector, matcherFromGroupMatchers( elementMatchers, setMatchers ) );\n\n\t\t// Save selector and tokenization\n\t\tcached.selector = selector;\n\t}\n\treturn cached;\n};\n\n/**\n * A low-level selection function that works with Sizzle's compiled\n *  selector functions\n * @param {String|Function} selector A selector or a pre-compiled\n *  selector function built with Sizzle.compile\n * @param {Element} context\n * @param {Array} [results]\n * @param {Array} [seed] A set of elements to match against\n */\nselect = Sizzle.select = function( selector, context, results, seed ) {\n\tvar i, tokens, token, type, find,\n\t\tcompiled = typeof selector === \"function\" && selector,\n\t\tmatch = !seed && tokenize( (selector = compiled.selector || selector) );\n\n\tresults = results || [];\n\n\t// Try to minimize operations if there is no seed and only one group\n\tif ( match.length === 1 ) {\n\n\t\t// Take a shortcut and set the context if the root selector is an ID\n\t\ttokens = match[0] = match[0].slice( 0 );\n\t\tif ( tokens.length > 2 && (token = tokens[0]).type === \"ID\" &&\n\t\t\t\tsupport.getById && context.nodeType === 9 && documentIsHTML &&\n\t\t\t\tExpr.relative[ tokens[1].type ] ) {\n\n\t\t\tcontext = ( Expr.find[\"ID\"]( token.matches[0].replace(runescape, funescape), context ) || [] )[0];\n\t\t\tif ( !context ) {\n\t\t\t\treturn results;\n\n\t\t\t// Precompiled matchers will still verify ancestry, so step up a level\n\t\t\t} else if ( compiled ) {\n\t\t\t\tcontext = context.parentNode;\n\t\t\t}\n\n\t\t\tselector = selector.slice( tokens.shift().value.length );\n\t\t}\n\n\t\t// Fetch a seed set for right-to-left matching\n\t\ti = matchExpr[\"needsContext\"].test( selector ) ? 0 : tokens.length;\n\t\twhile ( i-- ) {\n\t\t\ttoken = tokens[i];\n\n\t\t\t// Abort if we hit a combinator\n\t\t\tif ( Expr.relative[ (type = token.type) ] ) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif ( (find = Expr.find[ type ]) ) {\n\t\t\t\t// Search, expanding context for leading sibling combinators\n\t\t\t\tif ( (seed = find(\n\t\t\t\t\ttoken.matches[0].replace( runescape, funescape ),\n\t\t\t\t\trsibling.test( tokens[0].type ) && testContext( context.parentNode ) || context\n\t\t\t\t)) ) {\n\n\t\t\t\t\t// If seed is empty or no tokens remain, we can return early\n\t\t\t\t\ttokens.splice( i, 1 );\n\t\t\t\t\tselector = seed.length && toSelector( tokens );\n\t\t\t\t\tif ( !selector ) {\n\t\t\t\t\t\tpush.apply( results, seed );\n\t\t\t\t\t\treturn results;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Compile and execute a filtering function if one is not provided\n\t// Provide `match` to avoid retokenization if we modified the selector above\n\t( compiled || compile( selector, match ) )(\n\t\tseed,\n\t\tcontext,\n\t\t!documentIsHTML,\n\t\tresults,\n\t\trsibling.test( selector ) && testContext( context.parentNode ) || context\n\t);\n\treturn results;\n};\n\n// One-time assignments\n\n// Sort stability\nsupport.sortStable = expando.split(\"\").sort( sortOrder ).join(\"\") === expando;\n\n// Support: Chrome 14-35+\n// Always assume duplicates if they aren't passed to the comparison function\nsupport.detectDuplicates = !!hasDuplicate;\n\n// Initialize against the default document\nsetDocument();\n\n// Support: Webkit<537.32 - Safari 6.0.3/Chrome 25 (fixed in Chrome 27)\n// Detached nodes confoundingly follow *each other*\nsupport.sortDetached = assert(function( div1 ) {\n\t// Should return 1, but returns 4 (following)\n\treturn div1.compareDocumentPosition( document.createElement(\"div\") ) & 1;\n});\n\n// Support: IE<8\n// Prevent attribute/property \"interpolation\"\n// http://msdn.microsoft.com/en-us/library/ms536429%28VS.85%29.aspx\nif ( !assert(function( div ) {\n\tdiv.innerHTML = \"<a href='#'></a>\";\n\treturn div.firstChild.getAttribute(\"href\") === \"#\" ;\n}) ) {\n\taddHandle( \"type|href|height|width\", function( elem, name, isXML ) {\n\t\tif ( !isXML ) {\n\t\t\treturn elem.getAttribute( name, name.toLowerCase() === \"type\" ? 1 : 2 );\n\t\t}\n\t});\n}\n\n// Support: IE<9\n// Use defaultValue in place of getAttribute(\"value\")\nif ( !support.attributes || !assert(function( div ) {\n\tdiv.innerHTML = \"<input/>\";\n\tdiv.firstChild.setAttribute( \"value\", \"\" );\n\treturn div.firstChild.getAttribute( \"value\" ) === \"\";\n}) ) {\n\taddHandle( \"value\", function( elem, name, isXML ) {\n\t\tif ( !isXML && elem.nodeName.toLowerCase() === \"input\" ) {\n\t\t\treturn elem.defaultValue;\n\t\t}\n\t});\n}\n\n// Support: IE<9\n// Use getAttributeNode to fetch booleans when getAttribute lies\nif ( !assert(function( div ) {\n\treturn div.getAttribute(\"disabled\") == null;\n}) ) {\n\taddHandle( booleans, function( elem, name, isXML ) {\n\t\tvar val;\n\t\tif ( !isXML ) {\n\t\t\treturn elem[ name ] === true ? name.toLowerCase() :\n\t\t\t\t\t(val = elem.getAttributeNode( name )) && val.specified ?\n\t\t\t\t\tval.value :\n\t\t\t\tnull;\n\t\t}\n\t});\n}\n\n// EXPOSE\nreturn Sizzle;\n});\n\n/*eslint-enable */\n\n// Included from: js/tinymce/classes/util/Arr.js\n\n/**\n * Arr.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Array utility class.\n *\n * @private\n * @class tinymce.util.Arr\n */\ndefine(\"tinymce/util/Arr\", [], function() {\n\tvar isArray = Array.isArray || function(obj) {\n\t\treturn Object.prototype.toString.call(obj) === \"[object Array]\";\n\t};\n\n\tfunction toArray(obj) {\n\t\tvar array = obj, i, l;\n\n\t\tif (!isArray(obj)) {\n\t\t\tarray = [];\n\t\t\tfor (i = 0, l = obj.length; i < l; i++) {\n\t\t\t\tarray[i] = obj[i];\n\t\t\t}\n\t\t}\n\n\t\treturn array;\n\t}\n\n\tfunction each(o, cb, s) {\n\t\tvar n, l;\n\n\t\tif (!o) {\n\t\t\treturn 0;\n\t\t}\n\n\t\ts = s || o;\n\n\t\tif (o.length !== undefined) {\n\t\t\t// Indexed arrays, needed for Safari\n\t\t\tfor (n = 0, l = o.length; n < l; n++) {\n\t\t\t\tif (cb.call(s, o[n], n, o) === false) {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Hashtables\n\t\t\tfor (n in o) {\n\t\t\t\tif (o.hasOwnProperty(n)) {\n\t\t\t\t\tif (cb.call(s, o[n], n, o) === false) {\n\t\t\t\t\t\treturn 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn 1;\n\t}\n\n\tfunction map(array, callback) {\n\t\tvar out = [];\n\n\t\teach(array, function(item, index) {\n\t\t\tout.push(callback(item, index, array));\n\t\t});\n\n\t\treturn out;\n\t}\n\n\tfunction filter(a, f) {\n\t\tvar o = [];\n\n\t\teach(a, function(v, index) {\n\t\t\tif (!f || f(v, index, a)) {\n\t\t\t\to.push(v);\n\t\t\t}\n\t\t});\n\n\t\treturn o;\n\t}\n\n\tfunction indexOf(a, v) {\n\t\tvar i, l;\n\n\t\tif (a) {\n\t\t\tfor (i = 0, l = a.length; i < l; i++) {\n\t\t\t\tif (a[i] === v) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn -1;\n\t}\n\n\tfunction reduce(collection, iteratee, accumulator, thisArg) {\n\t\tvar i = 0;\n\n\t\tif (arguments.length < 3) {\n\t\t\taccumulator = collection[0];\n\t\t}\n\n\t\tfor (; i < collection.length; i++) {\n\t\t\taccumulator = iteratee.call(thisArg, accumulator, collection[i], i);\n\t\t}\n\n\t\treturn accumulator;\n\t}\n\n\tfunction findIndex(array, predicate, thisArg) {\n\t\tvar i, l;\n\n\t\tfor (i = 0, l = array.length; i < l; i++) {\n\t\t\tif (predicate.call(thisArg, array[i], i, array)) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\treturn -1;\n\t}\n\n\tfunction find(array, predicate, thisArg) {\n\t\tvar idx = findIndex(array, predicate, thisArg);\n\n\t\tif (idx !== -1) {\n\t\t\treturn array[idx];\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tfunction last(collection) {\n\t\treturn collection[collection.length - 1];\n\t}\n\n\treturn {\n\t\tisArray: isArray,\n\t\ttoArray: toArray,\n\t\teach: each,\n\t\tmap: map,\n\t\tfilter: filter,\n\t\tindexOf: indexOf,\n\t\treduce: reduce,\n\t\tfindIndex: findIndex,\n\t\tfind: find,\n\t\tlast: last\n\t};\n});\n\n// Included from: js/tinymce/classes/util/Tools.js\n\n/**\n * Tools.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains various utlity functions. These are also exposed\n * directly on the tinymce namespace.\n *\n * @class tinymce.util.Tools\n */\ndefine(\"tinymce/util/Tools\", [\n\t\"tinymce/Env\",\n\t\"tinymce/util/Arr\"\n], function(Env, Arr) {\n\t/**\n\t * Removes whitespace from the beginning and end of a string.\n\t *\n\t * @method trim\n\t * @param {String} s String to remove whitespace from.\n\t * @return {String} New string with removed whitespace.\n\t */\n\tvar whiteSpaceRegExp = /^\\s*|\\s*$/g;\n\n\tfunction trim(str) {\n\t\treturn (str === null || str === undefined) ? '' : (\"\" + str).replace(whiteSpaceRegExp, '');\n\t}\n\n\t/**\n\t * Checks if a object is of a specific type for example an array.\n\t *\n\t * @method is\n\t * @param {Object} obj Object to check type of.\n\t * @param {string} type Optional type to check for.\n\t * @return {Boolean} true/false if the object is of the specified type.\n\t */\n\tfunction is(obj, type) {\n\t\tif (!type) {\n\t\t\treturn obj !== undefined;\n\t\t}\n\n\t\tif (type == 'array' && Arr.isArray(obj)) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn typeof obj == type;\n\t}\n\n\t/**\n\t * Makes a name/object map out of an array with names.\n\t *\n\t * @method makeMap\n\t * @param {Array/String} items Items to make map out of.\n\t * @param {String} delim Optional delimiter to split string by.\n\t * @param {Object} map Optional map to add items to.\n\t * @return {Object} Name/value map of items.\n\t */\n\tfunction makeMap(items, delim, map) {\n\t\tvar i;\n\n\t\titems = items || [];\n\t\tdelim = delim || ',';\n\n\t\tif (typeof items == \"string\") {\n\t\t\titems = items.split(delim);\n\t\t}\n\n\t\tmap = map || {};\n\n\t\ti = items.length;\n\t\twhile (i--) {\n\t\t\tmap[items[i]] = {};\n\t\t}\n\n\t\treturn map;\n\t}\n\n\t/**\n\t * JavaScript does not protect hasOwnProperty method, so it is possible to overwrite it. This is\n\t * object independent version.\n\t *\n\t * @param {Object} obj\n\t * @param {String} prop\n\t * @returns {Boolean}\n\t */\n\tfunction hasOwnProperty(obj, prop) {\n\t\treturn Object.prototype.hasOwnProperty.call(obj, prop);\n\t}\n\n\t/**\n\t * Creates a class, subclass or static singleton.\n\t * More details on this method can be found in the Wiki.\n\t *\n\t * @method create\n\t * @param {String} s Class name, inheritance and prefix.\n\t * @param {Object} p Collection of methods to add to the class.\n\t * @param {Object} root Optional root object defaults to the global window object.\n\t * @example\n\t * // Creates a basic class\n\t * tinymce.create('tinymce.somepackage.SomeClass', {\n\t *     SomeClass: function() {\n\t *         // Class constructor\n\t *     },\n\t *\n\t *     method: function() {\n\t *         // Some method\n\t *     }\n\t * });\n\t *\n\t * // Creates a basic subclass class\n\t * tinymce.create('tinymce.somepackage.SomeSubClass:tinymce.somepackage.SomeClass', {\n\t *     SomeSubClass: function() {\n\t *         // Class constructor\n\t *         this.parent(); // Call parent constructor\n\t *     },\n\t *\n\t *     method: function() {\n\t *         // Some method\n\t *         this.parent(); // Call parent method\n\t *     },\n\t *\n\t *     'static': {\n\t *         staticMethod: function() {\n\t *             // Static method\n\t *         }\n\t *     }\n\t * });\n\t *\n\t * // Creates a singleton/static class\n\t * tinymce.create('static tinymce.somepackage.SomeSingletonClass', {\n\t *     method: function() {\n\t *         // Some method\n\t *     }\n\t * });\n\t */\n\tfunction create(s, p, root) {\n\t\tvar self = this, sp, ns, cn, scn, c, de = 0;\n\n\t\t// Parse : <prefix> <class>:<super class>\n\t\ts = /^((static) )?([\\w.]+)(:([\\w.]+))?/.exec(s);\n\t\tcn = s[3].match(/(^|\\.)(\\w+)$/i)[2]; // Class name\n\n\t\t// Create namespace for new class\n\t\tns = self.createNS(s[3].replace(/\\.\\w+$/, ''), root);\n\n\t\t// Class already exists\n\t\tif (ns[cn]) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Make pure static class\n\t\tif (s[2] == 'static') {\n\t\t\tns[cn] = p;\n\n\t\t\tif (this.onCreate) {\n\t\t\t\tthis.onCreate(s[2], s[3], ns[cn]);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Create default constructor\n\t\tif (!p[cn]) {\n\t\t\tp[cn] = function() {};\n\t\t\tde = 1;\n\t\t}\n\n\t\t// Add constructor and methods\n\t\tns[cn] = p[cn];\n\t\tself.extend(ns[cn].prototype, p);\n\n\t\t// Extend\n\t\tif (s[5]) {\n\t\t\tsp = self.resolve(s[5]).prototype;\n\t\t\tscn = s[5].match(/\\.(\\w+)$/i)[1]; // Class name\n\n\t\t\t// Extend constructor\n\t\t\tc = ns[cn];\n\t\t\tif (de) {\n\t\t\t\t// Add passthrough constructor\n\t\t\t\tns[cn] = function() {\n\t\t\t\t\treturn sp[scn].apply(this, arguments);\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\t// Add inherit constructor\n\t\t\t\tns[cn] = function() {\n\t\t\t\t\tthis.parent = sp[scn];\n\t\t\t\t\treturn c.apply(this, arguments);\n\t\t\t\t};\n\t\t\t}\n\t\t\tns[cn].prototype[cn] = ns[cn];\n\n\t\t\t// Add super methods\n\t\t\tself.each(sp, function(f, n) {\n\t\t\t\tns[cn].prototype[n] = sp[n];\n\t\t\t});\n\n\t\t\t// Add overridden methods\n\t\t\tself.each(p, function(f, n) {\n\t\t\t\t// Extend methods if needed\n\t\t\t\tif (sp[n]) {\n\t\t\t\t\tns[cn].prototype[n] = function() {\n\t\t\t\t\t\tthis.parent = sp[n];\n\t\t\t\t\t\treturn f.apply(this, arguments);\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tif (n != cn) {\n\t\t\t\t\t\tns[cn].prototype[n] = f;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Add static methods\n\t\t/*jshint sub:true*/\n\t\t/*eslint dot-notation:0*/\n\t\tself.each(p['static'], function(f, n) {\n\t\t\tns[cn][n] = f;\n\t\t});\n\t}\n\n\tfunction extend(obj, ext) {\n\t\tvar i, l, name, args = arguments, value;\n\n\t\tfor (i = 1, l = args.length; i < l; i++) {\n\t\t\text = args[i];\n\t\t\tfor (name in ext) {\n\t\t\t\tif (ext.hasOwnProperty(name)) {\n\t\t\t\t\tvalue = ext[name];\n\n\t\t\t\t\tif (value !== undefined) {\n\t\t\t\t\t\tobj[name] = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\t/**\n\t * Executed the specified function for each item in a object tree.\n\t *\n\t * @method walk\n\t * @param {Object} o Object tree to walk though.\n\t * @param {function} f Function to call for each item.\n\t * @param {String} n Optional name of collection inside the objects to walk for example childNodes.\n\t * @param {String} s Optional scope to execute the function in.\n\t */\n\tfunction walk(o, f, n, s) {\n\t\ts = s || this;\n\n\t\tif (o) {\n\t\t\tif (n) {\n\t\t\t\to = o[n];\n\t\t\t}\n\n\t\t\tArr.each(o, function(o, i) {\n\t\t\t\tif (f.call(s, o, i, n) === false) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\twalk(o, f, n, s);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Creates a namespace on a specific object.\n\t *\n\t * @method createNS\n\t * @param {String} n Namespace to create for example a.b.c.d.\n\t * @param {Object} o Optional object to add namespace to, defaults to window.\n\t * @return {Object} New namespace object the last item in path.\n\t * @example\n\t * // Create some namespace\n\t * tinymce.createNS('tinymce.somepackage.subpackage');\n\t *\n\t * // Add a singleton\n\t * var tinymce.somepackage.subpackage.SomeSingleton = {\n\t *     method: function() {\n\t *         // Some method\n\t *     }\n\t * };\n\t */\n\tfunction createNS(n, o) {\n\t\tvar i, v;\n\n\t\to = o || window;\n\n\t\tn = n.split('.');\n\t\tfor (i = 0; i < n.length; i++) {\n\t\t\tv = n[i];\n\n\t\t\tif (!o[v]) {\n\t\t\t\to[v] = {};\n\t\t\t}\n\n\t\t\to = o[v];\n\t\t}\n\n\t\treturn o;\n\t}\n\n\t/**\n\t * Resolves a string and returns the object from a specific structure.\n\t *\n\t * @method resolve\n\t * @param {String} n Path to resolve for example a.b.c.d.\n\t * @param {Object} o Optional object to search though, defaults to window.\n\t * @return {Object} Last object in path or null if it couldn't be resolved.\n\t * @example\n\t * // Resolve a path into an object reference\n\t * var obj = tinymce.resolve('a.b.c.d');\n\t */\n\tfunction resolve(n, o) {\n\t\tvar i, l;\n\n\t\to = o || window;\n\n\t\tn = n.split('.');\n\t\tfor (i = 0, l = n.length; i < l; i++) {\n\t\t\to = o[n[i]];\n\n\t\t\tif (!o) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn o;\n\t}\n\n\t/**\n\t * Splits a string but removes the whitespace before and after each value.\n\t *\n\t * @method explode\n\t * @param {string} s String to split.\n\t * @param {string} d Delimiter to split by.\n\t * @example\n\t * // Split a string into an array with a,b,c\n\t * var arr = tinymce.explode('a, b,   c');\n\t */\n\tfunction explode(s, d) {\n\t\tif (!s || is(s, 'array')) {\n\t\t\treturn s;\n\t\t}\n\n\t\treturn Arr.map(s.split(d || ','), trim);\n\t}\n\n\tfunction _addCacheSuffix(url) {\n\t\tvar cacheSuffix = Env.cacheSuffix;\n\n\t\tif (cacheSuffix) {\n\t\t\turl += (url.indexOf('?') === -1 ? '?' : '&') + cacheSuffix;\n\t\t}\n\n\t\treturn url;\n\t}\n\n\treturn {\n\t\ttrim: trim,\n\n\t\t/**\n\t\t * Returns true/false if the object is an array or not.\n\t\t *\n\t\t * @method isArray\n\t\t * @param {Object} obj Object to check.\n\t\t * @return {boolean} true/false state if the object is an array or not.\n\t\t */\n\t\tisArray: Arr.isArray,\n\n\t\tis: is,\n\n\t\t/**\n\t\t * Converts the specified object into a real JavaScript array.\n\t\t *\n\t\t * @method toArray\n\t\t * @param {Object} obj Object to convert into array.\n\t\t * @return {Array} Array object based in input.\n\t\t */\n\t\ttoArray: Arr.toArray,\n\t\tmakeMap: makeMap,\n\n\t\t/**\n\t\t * Performs an iteration of all items in a collection such as an object or array. This method will execure the\n\t\t * callback function for each item in the collection, if the callback returns false the iteration will terminate.\n\t\t * The callback has the following format: cb(value, key_or_index).\n\t\t *\n\t\t * @method each\n\t\t * @param {Object} o Collection to iterate.\n\t\t * @param {function} cb Callback function to execute for each item.\n\t\t * @param {Object} s Optional scope to execute the callback in.\n\t\t * @example\n\t\t * // Iterate an array\n\t\t * tinymce.each([1,2,3], function(v, i) {\n\t\t *     console.debug(\"Value: \" + v + \", Index: \" + i);\n\t\t * });\n\t\t *\n\t\t * // Iterate an object\n\t\t * tinymce.each({a: 1, b: 2, c: 3], function(v, k) {\n\t\t *     console.debug(\"Value: \" + v + \", Key: \" + k);\n\t\t * });\n\t\t */\n\t\teach: Arr.each,\n\n\t\t/**\n\t\t * Creates a new array by the return value of each iteration function call. This enables you to convert\n\t\t * one array list into another.\n\t\t *\n\t\t * @method map\n\t\t * @param {Array} array Array of items to iterate.\n\t\t * @param {function} callback Function to call for each item. It's return value will be the new value.\n\t\t * @return {Array} Array with new values based on function return values.\n\t\t */\n\t\tmap: Arr.map,\n\n\t\t/**\n\t\t * Filters out items from the input array by calling the specified function for each item.\n\t\t * If the function returns false the item will be excluded if it returns true it will be included.\n\t\t *\n\t\t * @method grep\n\t\t * @param {Array} a Array of items to loop though.\n\t\t * @param {function} f Function to call for each item. Include/exclude depends on it's return value.\n\t\t * @return {Array} New array with values imported and filtered based in input.\n\t\t * @example\n\t\t * // Filter out some items, this will return an array with 4 and 5\n\t\t * var items = tinymce.grep([1,2,3,4,5], function(v) {return v > 3;});\n\t\t */\n\t\tgrep: Arr.filter,\n\n\t\t/**\n\t\t * Returns an index of the item or -1 if item is not present in the array.\n\t\t *\n\t\t * @method inArray\n\t\t * @param {any} item Item to search for.\n\t\t * @param {Array} arr Array to search in.\n\t\t * @return {Number} index of the item or -1 if item was not found.\n\t\t */\n\t\tinArray: Arr.indexOf,\n\n\t\thasOwn: hasOwnProperty,\n\n\t\textend: extend,\n\t\tcreate: create,\n\t\twalk: walk,\n\t\tcreateNS: createNS,\n\t\tresolve: resolve,\n\t\texplode: explode,\n\t\t_addCacheSuffix: _addCacheSuffix\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/DomQuery.js\n\n/**\n * DomQuery.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class mimics most of the jQuery API:\n *\n * This is whats currently implemented:\n * - Utility functions\n * - DOM traversial\n * - DOM manipulation\n * - Event binding\n *\n * This is not currently implemented:\n * - Dimension\n * - Ajax\n * - Animation\n * - Advanced chaining\n *\n * @example\n * var $ = tinymce.dom.DomQuery;\n * $('p').attr('attr', 'value').addClass('class');\n *\n * @class tinymce.dom.DomQuery\n */\ndefine(\"tinymce/dom/DomQuery\", [\n\t\"tinymce/dom/EventUtils\",\n\t\"tinymce/dom/Sizzle\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/Env\"\n], function(EventUtils, Sizzle, Tools, Env) {\n\tvar doc = document, push = Array.prototype.push, slice = Array.prototype.slice;\n\tvar rquickExpr = /^(?:[^#<]*(<[\\w\\W]+>)[^>]*$|#([\\w\\-]*)$)/;\n\tvar Event = EventUtils.Event, undef;\n\tvar skipUniques = Tools.makeMap('children,contents,next,prev');\n\n\tfunction isDefined(obj) {\n\t\treturn typeof obj !== 'undefined';\n\t}\n\n\tfunction isString(obj) {\n\t\treturn typeof obj === 'string';\n\t}\n\n\tfunction isWindow(obj) {\n\t\treturn obj && obj == obj.window;\n\t}\n\n\tfunction createFragment(html, fragDoc) {\n\t\tvar frag, node, container;\n\n\t\tfragDoc = fragDoc || doc;\n\t\tcontainer = fragDoc.createElement('div');\n\t\tfrag = fragDoc.createDocumentFragment();\n\t\tcontainer.innerHTML = html;\n\n\t\twhile ((node = container.firstChild)) {\n\t\t\tfrag.appendChild(node);\n\t\t}\n\n\t\treturn frag;\n\t}\n\n\tfunction domManipulate(targetNodes, sourceItem, callback, reverse) {\n\t\tvar i;\n\n\t\tif (isString(sourceItem)) {\n\t\t\tsourceItem = createFragment(sourceItem, getElementDocument(targetNodes[0]));\n\t\t} else if (sourceItem.length && !sourceItem.nodeType) {\n\t\t\tsourceItem = DomQuery.makeArray(sourceItem);\n\n\t\t\tif (reverse) {\n\t\t\t\tfor (i = sourceItem.length - 1; i >= 0; i--) {\n\t\t\t\t\tdomManipulate(targetNodes, sourceItem[i], callback, reverse);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (i = 0; i < sourceItem.length; i++) {\n\t\t\t\t\tdomManipulate(targetNodes, sourceItem[i], callback, reverse);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn targetNodes;\n\t\t}\n\n\t\tif (sourceItem.nodeType) {\n\t\t\ti = targetNodes.length;\n\t\t\twhile (i--) {\n\t\t\t\tcallback.call(targetNodes[i], sourceItem);\n\t\t\t}\n\t\t}\n\n\t\treturn targetNodes;\n\t}\n\n\tfunction hasClass(node, className) {\n\t\treturn node && className && (' ' + node.className + ' ').indexOf(' ' + className + ' ') !== -1;\n\t}\n\n\tfunction wrap(elements, wrapper, all) {\n\t\tvar lastParent, newWrapper;\n\n\t\twrapper = DomQuery(wrapper)[0];\n\n\t\telements.each(function() {\n\t\t\tvar self = this;\n\n\t\t\tif (!all || lastParent != self.parentNode) {\n\t\t\t\tlastParent = self.parentNode;\n\t\t\t\tnewWrapper = wrapper.cloneNode(false);\n\t\t\t\tself.parentNode.insertBefore(newWrapper, self);\n\t\t\t\tnewWrapper.appendChild(self);\n\t\t\t} else {\n\t\t\t\tnewWrapper.appendChild(self);\n\t\t\t}\n\t\t});\n\n\t\treturn elements;\n\t}\n\n\tvar numericCssMap = Tools.makeMap('fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom', ' ');\n\tvar booleanMap = Tools.makeMap('checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected', ' ');\n\tvar propFix = {\n\t\t'for': 'htmlFor',\n\t\t'class': 'className',\n\t\t'readonly': 'readOnly'\n\t};\n\tvar cssFix = {\n\t\t'float': 'cssFloat'\n\t};\n\n\tvar attrHooks = {}, cssHooks = {};\n\n\tfunction DomQuery(selector, context) {\n\t\t/*eslint new-cap:0 */\n\t\treturn new DomQuery.fn.init(selector, context);\n\t}\n\n\tfunction inArray(item, array) {\n\t\tvar i;\n\n\t\tif (array.indexOf) {\n\t\t\treturn array.indexOf(item);\n\t\t}\n\n\t\ti = array.length;\n\t\twhile (i--) {\n\t\t\tif (array[i] === item) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\treturn -1;\n\t}\n\n\tvar whiteSpaceRegExp = /^\\s*|\\s*$/g;\n\n\tfunction trim(str) {\n\t\treturn (str === null || str === undef) ? '' : (\"\" + str).replace(whiteSpaceRegExp, '');\n\t}\n\n\tfunction each(obj, callback) {\n\t\tvar length, key, i, undef, value;\n\n\t\tif (obj) {\n\t\t\tlength = obj.length;\n\n\t\t\tif (length === undef) {\n\t\t\t\t// Loop object items\n\t\t\t\tfor (key in obj) {\n\t\t\t\t\tif (obj.hasOwnProperty(key)) {\n\t\t\t\t\t\tvalue = obj[key];\n\t\t\t\t\t\tif (callback.call(value, key, value) === false) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Loop array items\n\t\t\t\tfor (i = 0; i < length; i++) {\n\t\t\t\t\tvalue = obj[i];\n\t\t\t\t\tif (callback.call(value, i, value) === false) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\tfunction grep(array, callback) {\n\t\tvar out = [];\n\n\t\teach(array, function(i, item) {\n\t\t\tif (callback(item, i)) {\n\t\t\t\tout.push(item);\n\t\t\t}\n\t\t});\n\n\t\treturn out;\n\t}\n\n\tfunction getElementDocument(element) {\n\t\tif (!element) {\n\t\t\treturn doc;\n\t\t}\n\n\t\tif (element.nodeType == 9) {\n\t\t\treturn element;\n\t\t}\n\n\t\treturn element.ownerDocument;\n\t}\n\n\tDomQuery.fn = DomQuery.prototype = {\n\t\tconstructor: DomQuery,\n\n\t\t/**\n\t\t * Selector for the current set.\n\t\t *\n\t\t * @property selector\n\t\t * @type String\n\t\t */\n\t\tselector: \"\",\n\n\t\t/**\n\t\t * Context used to create the set.\n\t\t *\n\t\t * @property context\n\t\t * @type Element\n\t\t */\n\t\tcontext: null,\n\n\t\t/**\n\t\t * Number of items in the current set.\n\t\t *\n\t\t * @property length\n\t\t * @type Number\n\t\t */\n\t\tlength: 0,\n\n\t\t/**\n\t\t * Constructs a new DomQuery instance with the specified selector or context.\n\t\t *\n\t\t * @constructor\n\t\t * @method init\n\t\t * @param {String/Array/DomQuery} selector Optional CSS selector/Array or array like object or HTML string.\n\t\t * @param {Document/Element} context Optional context to search in.\n\t\t */\n\t\tinit: function(selector, context) {\n\t\t\tvar self = this, match, node;\n\n\t\t\tif (!selector) {\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\tif (selector.nodeType) {\n\t\t\t\tself.context = self[0] = selector;\n\t\t\t\tself.length = 1;\n\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\tif (context && context.nodeType) {\n\t\t\t\tself.context = context;\n\t\t\t} else {\n\t\t\t\tif (context) {\n\t\t\t\t\treturn DomQuery(selector).attr(context);\n\t\t\t\t}\n\n\t\t\t\tself.context = context = document;\n\t\t\t}\n\n\t\t\tif (isString(selector)) {\n\t\t\t\tself.selector = selector;\n\n\t\t\t\tif (selector.charAt(0) === \"<\" && selector.charAt(selector.length - 1) === \">\" && selector.length >= 3) {\n\t\t\t\t\tmatch = [null, selector, null];\n\t\t\t\t} else {\n\t\t\t\t\tmatch = rquickExpr.exec(selector);\n\t\t\t\t}\n\n\t\t\t\tif (match) {\n\t\t\t\t\tif (match[1]) {\n\t\t\t\t\t\tnode = createFragment(selector, getElementDocument(context)).firstChild;\n\n\t\t\t\t\t\twhile (node) {\n\t\t\t\t\t\t\tpush.call(self, node);\n\t\t\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnode = getElementDocument(context).getElementById(match[2]);\n\n\t\t\t\t\t\tif (!node) {\n\t\t\t\t\t\t\treturn self;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (node.id !== match[2]) {\n\t\t\t\t\t\t\treturn self.find(selector);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tself.length = 1;\n\t\t\t\t\t\tself[0] = node;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn DomQuery(context).find(selector);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.add(selector, false);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Converts the current set to an array.\n\t\t *\n\t\t * @method toArray\n\t\t * @return {Array} Array of all nodes in set.\n\t\t */\n\t\ttoArray: function() {\n\t\t\treturn Tools.toArray(this);\n\t\t},\n\n\t\t/**\n\t\t * Adds new nodes to the set.\n\t\t *\n\t\t * @method add\n\t\t * @param {Array/tinymce.dom.DomQuery} items Array of all nodes to add to set.\n\t\t * @param {Boolean} sort Optional sort flag that enables sorting of elements.\n\t\t * @return {tinymce.dom.DomQuery} New instance with nodes added.\n\t\t */\n\t\tadd: function(items, sort) {\n\t\t\tvar self = this, nodes, i;\n\n\t\t\tif (isString(items)) {\n\t\t\t\treturn self.add(DomQuery(items));\n\t\t\t}\n\n\t\t\tif (sort !== false) {\n\t\t\t\tnodes = DomQuery.unique(self.toArray().concat(DomQuery.makeArray(items)));\n\t\t\t\tself.length = nodes.length;\n\t\t\t\tfor (i = 0; i < nodes.length; i++) {\n\t\t\t\t\tself[i] = nodes[i];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tpush.apply(self, DomQuery.makeArray(items));\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Sets/gets attributes on the elements in the current set.\n\t\t *\n\t\t * @method attr\n\t\t * @param {String/Object} name Name of attribute to get or an object with attributes to set.\n\t\t * @param {String} value Optional value to set.\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the specified attribute when only the name is specified.\n\t\t */\n\t\tattr: function(name, value) {\n\t\t\tvar self = this, hook;\n\n\t\t\tif (typeof name === \"object\") {\n\t\t\t\teach(name, function(name, value) {\n\t\t\t\t\tself.attr(name, value);\n\t\t\t\t});\n\t\t\t} else if (isDefined(value)) {\n\t\t\t\tthis.each(function() {\n\t\t\t\t\tvar hook;\n\n\t\t\t\t\tif (this.nodeType === 1) {\n\t\t\t\t\t\thook = attrHooks[name];\n\t\t\t\t\t\tif (hook && hook.set) {\n\t\t\t\t\t\t\thook.set(this, value);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\t\tthis.removeAttribute(name, 2);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.setAttribute(name, value, 2);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (self[0] && self[0].nodeType === 1) {\n\t\t\t\t\thook = attrHooks[name];\n\t\t\t\t\tif (hook && hook.get) {\n\t\t\t\t\t\treturn hook.get(self[0], name);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (booleanMap[name]) {\n\t\t\t\t\t\treturn self.prop(name) ? name : undef;\n\t\t\t\t\t}\n\n\t\t\t\t\tvalue = self[0].getAttribute(name, 2);\n\n\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\tvalue = undef;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Removes attributse on the elements in the current set.\n\t\t *\n\t\t * @method removeAttr\n\t\t * @param {String/Object} name Name of attribute to remove.\n\t\t * @return {tinymce.dom.DomQuery/String} Current set.\n\t\t */\n\t\tremoveAttr: function(name) {\n\t\t\treturn this.attr(name, null);\n\t\t},\n\n\t\t/**\n\t\t * Sets/gets properties on the elements in the current set.\n\t\t *\n\t\t * @method attr\n\t\t * @param {String/Object} name Name of property to get or an object with properties to set.\n\t\t * @param {String} value Optional value to set.\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the specified property when only the name is specified.\n\t\t */\n\t\tprop: function(name, value) {\n\t\t\tvar self = this;\n\n\t\t\tname = propFix[name] || name;\n\n\t\t\tif (typeof name === \"object\") {\n\t\t\t\teach(name, function(name, value) {\n\t\t\t\t\tself.prop(name, value);\n\t\t\t\t});\n\t\t\t} else if (isDefined(value)) {\n\t\t\t\tthis.each(function() {\n\t\t\t\t\tif (this.nodeType == 1) {\n\t\t\t\t\t\tthis[name] = value;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (self[0] && self[0].nodeType && name in self[0]) {\n\t\t\t\t\treturn self[0][name];\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Sets/gets styles on the elements in the current set.\n\t\t *\n\t\t * @method css\n\t\t * @param {String/Object} name Name of style to get or an object with styles to set.\n\t\t * @param {String} value Optional value to set.\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the specified style when only the name is specified.\n\t\t */\n\t\tcss: function(name, value) {\n\t\t\tvar self = this, elm, hook;\n\n\t\t\tfunction camel(name) {\n\t\t\t\treturn name.replace(/-(\\D)/g, function(a, b) {\n\t\t\t\t\treturn b.toUpperCase();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction dashed(name) {\n\t\t\t\treturn name.replace(/[A-Z]/g, function(a) {\n\t\t\t\t\treturn '-' + a;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (typeof name === \"object\") {\n\t\t\t\teach(name, function(name, value) {\n\t\t\t\t\tself.css(name, value);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (isDefined(value)) {\n\t\t\t\t\tname = camel(name);\n\n\t\t\t\t\t// Default px suffix on these\n\t\t\t\t\tif (typeof value === 'number' && !numericCssMap[name]) {\n\t\t\t\t\t\tvalue += 'px';\n\t\t\t\t\t}\n\n\t\t\t\t\tself.each(function() {\n\t\t\t\t\t\tvar style = this.style;\n\n\t\t\t\t\t\thook = cssHooks[name];\n\t\t\t\t\t\tif (hook && hook.set) {\n\t\t\t\t\t\t\thook.set(this, value);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.style[cssFix[name] || name] = value;\n\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\t// Ignore\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (value === null || value === '') {\n\t\t\t\t\t\t\tif (style.removeProperty) {\n\t\t\t\t\t\t\t\tstyle.removeProperty(dashed(name));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tstyle.removeAttribute(name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\telm = self[0];\n\n\t\t\t\t\thook = cssHooks[name];\n\t\t\t\t\tif (hook && hook.get) {\n\t\t\t\t\t\treturn hook.get(elm);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (elm.ownerDocument.defaultView) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\treturn elm.ownerDocument.defaultView.getComputedStyle(elm, null).getPropertyValue(dashed(name));\n\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\treturn undef;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (elm.currentStyle) {\n\t\t\t\t\t\treturn elm.currentStyle[camel(name)];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Removes all nodes in set from the document.\n\t\t *\n\t\t * @method remove\n\t\t * @return {tinymce.dom.DomQuery} Current set with the removed nodes.\n\t\t */\n\t\tremove: function() {\n\t\t\tvar self = this, node, i = this.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = self[i];\n\t\t\t\tEvent.clean(node);\n\n\t\t\t\tif (node.parentNode) {\n\t\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Empties all elements in set.\n\t\t *\n\t\t * @method empty\n\t\t * @return {tinymce.dom.DomQuery} Current set with the empty nodes.\n\t\t */\n\t\tempty: function() {\n\t\t\tvar self = this, node, i = this.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = self[i];\n\t\t\t\twhile (node.firstChild) {\n\t\t\t\t\tnode.removeChild(node.firstChild);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Sets or gets the HTML of the current set or first set node.\n\t\t *\n\t\t * @method html\n\t\t * @param {String} value Optional innerHTML value to set on each element.\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the innerHTML of the first element.\n\t\t */\n\t\thtml: function(value) {\n\t\t\tvar self = this, i;\n\n\t\t\tif (isDefined(value)) {\n\t\t\t\ti = self.length;\n\n\t\t\t\ttry {\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tself[i].innerHTML = value;\n\t\t\t\t\t}\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Workaround for \"Unknown runtime error\" when DIV is added to P on IE\n\t\t\t\t\tDomQuery(self[i]).empty().append(value);\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\treturn self[0] ? self[0].innerHTML : '';\n\t\t},\n\n\t\t/**\n\t\t * Sets or gets the text of the current set or first set node.\n\t\t *\n\t\t * @method text\n\t\t * @param {String} value Optional innerText value to set on each element.\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the innerText of the first element.\n\t\t */\n\t\ttext: function(value) {\n\t\t\tvar self = this, i;\n\n\t\t\tif (isDefined(value)) {\n\t\t\t\ti = self.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tif (\"innerText\" in self[i]) {\n\t\t\t\t\t\tself[i].innerText = value;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself[0].textContent = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\treturn self[0] ? (self[0].innerText || self[0].textContent) : '';\n\t\t},\n\n\t\t/**\n\t\t * Appends the specified node/html or node set to the current set nodes.\n\t\t *\n\t\t * @method append\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to append to each element in set.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\tappend: function() {\n\t\t\treturn domManipulate(this, arguments, function(node) {\n\t\t\t\t// Either element or Shadow Root\n\t\t\t\tif (this.nodeType === 1 || (this.host && this.host.nodeType === 1)) {\n\t\t\t\t\tthis.appendChild(node);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Prepends the specified node/html or node set to the current set nodes.\n\t\t *\n\t\t * @method prepend\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to prepend to each element in set.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\tprepend: function() {\n\t\t\treturn domManipulate(this, arguments, function(node) {\n\t\t\t\t// Either element or Shadow Root\n\t\t\t\tif (this.nodeType === 1 || (this.host && this.host.nodeType === 1)) {\n\t\t\t\t\tthis.insertBefore(node, this.firstChild);\n\t\t\t\t}\n\t\t\t}, true);\n\t\t},\n\n\t\t/**\n\t\t * Adds the specified elements before current set nodes.\n\t\t *\n\t\t * @method before\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to add before to each element in set.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\tbefore: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self[0] && self[0].parentNode) {\n\t\t\t\treturn domManipulate(self, arguments, function(node) {\n\t\t\t\t\tthis.parentNode.insertBefore(node, this);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Adds the specified elements after current set nodes.\n\t\t *\n\t\t * @method after\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to add after to each element in set.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\tafter: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self[0] && self[0].parentNode) {\n\t\t\t\treturn domManipulate(self, arguments, function(node) {\n\t\t\t\t\tthis.parentNode.insertBefore(node, this.nextSibling);\n\t\t\t\t}, true);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Appends the specified set nodes to the specified selector/instance.\n\t\t *\n\t\t * @method appendTo\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} val Item to append the current set to.\n\t\t * @return {tinymce.dom.DomQuery} Current set with the appended nodes.\n\t\t */\n\t\tappendTo: function(val) {\n\t\t\tDomQuery(val).append(this);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Prepends the specified set nodes to the specified selector/instance.\n\t\t *\n\t\t * @method prependTo\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} val Item to prepend the current set to.\n\t\t * @return {tinymce.dom.DomQuery} Current set with the prepended nodes.\n\t\t */\n\t\tprependTo: function(val) {\n\t\t\tDomQuery(val).prepend(this);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Replaces the nodes in set with the specified content.\n\t\t *\n\t\t * @method replaceWith\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to replace nodes with.\n\t\t * @return {tinymce.dom.DomQuery} Set with replaced nodes.\n\t\t */\n\t\treplaceWith: function(content) {\n\t\t\treturn this.before(content).remove();\n\t\t},\n\n\t\t/**\n\t\t * Wraps all elements in set with the specified wrapper.\n\t\t *\n\t\t * @method wrap\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to wrap nodes with.\n\t\t * @return {tinymce.dom.DomQuery} Set with wrapped nodes.\n\t\t */\n\t\twrap: function(content) {\n\t\t\treturn wrap(this, content);\n\t\t},\n\n\t\t/**\n\t\t * Wraps all nodes in set with the specified wrapper. If the nodes are siblings all of them\n\t\t * will be wrapped in the same wrapper.\n\t\t *\n\t\t * @method wrapAll\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to wrap nodes with.\n\t\t * @return {tinymce.dom.DomQuery} Set with wrapped nodes.\n\t\t */\n\t\twrapAll: function(content) {\n\t\t\treturn wrap(this, content, true);\n\t\t},\n\n\t\t/**\n\t\t * Wraps all elements inner contents in set with the specified wrapper.\n\t\t *\n\t\t * @method wrapInner\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to wrap nodes with.\n\t\t * @return {tinymce.dom.DomQuery} Set with wrapped nodes.\n\t\t */\n\t\twrapInner: function(content) {\n\t\t\tthis.each(function() {\n\t\t\t\tDomQuery(this).contents().wrapAll(content);\n\t\t\t});\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Unwraps all elements by removing the parent element of each item in set.\n\t\t *\n\t\t * @method unwrap\n\t\t * @return {tinymce.dom.DomQuery} Set with unwrapped nodes.\n\t\t */\n\t\tunwrap: function() {\n\t\t\treturn this.parent().each(function() {\n\t\t\t\tDomQuery(this).replaceWith(this.childNodes);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Clones all nodes in set.\n\t\t *\n\t\t * @method clone\n\t\t * @return {tinymce.dom.DomQuery} Set with cloned nodes.\n\t\t */\n\t\tclone: function() {\n\t\t\tvar result = [];\n\n\t\t\tthis.each(function() {\n\t\t\t\tresult.push(this.cloneNode(true));\n\t\t\t});\n\n\t\t\treturn DomQuery(result);\n\t\t},\n\n\t\t/**\n\t\t * Adds the specified class name to the current set elements.\n\t\t *\n\t\t * @method addClass\n\t\t * @param {String} className Class name to add.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\taddClass: function(className) {\n\t\t\treturn this.toggleClass(className, true);\n\t\t},\n\n\t\t/**\n\t\t * Removes the specified class name to the current set elements.\n\t\t *\n\t\t * @method removeClass\n\t\t * @param {String} className Class name to remove.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\tremoveClass: function(className) {\n\t\t\treturn this.toggleClass(className, false);\n\t\t},\n\n\t\t/**\n\t\t * Toggles the specified class name on the current set elements.\n\t\t *\n\t\t * @method toggleClass\n\t\t * @param {String} className Class name to add/remove.\n\t\t * @param {Boolean} state Optional state to toggle on/off.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\ttoggleClass: function(className, state) {\n\t\t\tvar self = this;\n\n\t\t\t// Functions are not supported\n\t\t\tif (typeof className != 'string') {\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\tif (className.indexOf(' ') !== -1) {\n\t\t\t\teach(className.split(' '), function() {\n\t\t\t\t\tself.toggleClass(this, state);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tself.each(function(index, node) {\n\t\t\t\t\tvar existingClassName, classState;\n\n\t\t\t\t\tclassState = hasClass(node, className);\n\t\t\t\t\tif (classState !== state) {\n\t\t\t\t\t\texistingClassName = node.className;\n\n\t\t\t\t\t\tif (classState) {\n\t\t\t\t\t\t\tnode.className = trim((\" \" + existingClassName + \" \").replace(' ' + className + ' ', ' '));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.className += existingClassName ? ' ' + className : className;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the first item in set has the specified class.\n\t\t *\n\t\t * @method hasClass\n\t\t * @param {String} className Class name to check for.\n\t\t * @return {Boolean} True/false if the set has the specified class.\n\t\t */\n\t\thasClass: function(className) {\n\t\t\treturn hasClass(this[0], className);\n\t\t},\n\n\t\t/**\n\t\t * Executes the callback function for each item DomQuery collection. If you return false in the\n\t\t * callback it will break the loop.\n\t\t *\n\t\t * @method each\n\t\t * @param {function} callback Callback function to execute for each item.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\teach: function(callback) {\n\t\t\treturn each(this, callback);\n\t\t},\n\n\t\t/**\n\t\t * Binds an event with callback function to the elements in set.\n\t\t *\n\t\t * @method on\n\t\t * @param {String} name Name of the event to bind.\n\t\t * @param {function} callback Callback function to execute when the event occurs.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\ton: function(name, callback) {\n\t\t\treturn this.each(function() {\n\t\t\t\tEvent.bind(this, name, callback);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Unbinds an event with callback function to the elements in set.\n\t\t *\n\t\t * @method off\n\t\t * @param {String} name Optional name of the event to bind.\n\t\t * @param {function} callback Optional callback function to execute when the event occurs.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\toff: function(name, callback) {\n\t\t\treturn this.each(function() {\n\t\t\t\tEvent.unbind(this, name, callback);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Triggers the specified event by name or event object.\n\t\t *\n\t\t * @method trigger\n\t\t * @param {String/Object} name Name of the event to trigger or event object.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\ttrigger: function(name) {\n\t\t\treturn this.each(function() {\n\t\t\t\tif (typeof name == 'object') {\n\t\t\t\t\tEvent.fire(this, name.type, name);\n\t\t\t\t} else {\n\t\t\t\t\tEvent.fire(this, name);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Shows all elements in set.\n\t\t *\n\t\t * @method show\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\tshow: function() {\n\t\t\treturn this.css('display', '');\n\t\t},\n\n\t\t/**\n\t\t * Hides all elements in set.\n\t\t *\n\t\t * @method hide\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\thide: function() {\n\t\t\treturn this.css('display', 'none');\n\t\t},\n\n\t\t/**\n\t\t * Slices the current set.\n\t\t *\n\t\t * @method slice\n\t\t * @param {Number} start Start index to slice at.\n\t\t * @param {Number} end Optional end index to end slice at.\n\t\t * @return {tinymce.dom.DomQuery} Sliced set.\n\t\t */\n\t\tslice: function() {\n\t\t\treturn new DomQuery(slice.apply(this, arguments));\n\t\t},\n\n\t\t/**\n\t\t * Makes the set equal to the specified index.\n\t\t *\n\t\t * @method eq\n\t\t * @param {Number} index Index to set it equal to.\n\t\t * @return {tinymce.dom.DomQuery} Single item set.\n\t\t */\n\t\teq: function(index) {\n\t\t\treturn index === -1 ? this.slice(index) : this.slice(index, +index + 1);\n\t\t},\n\n\t\t/**\n\t\t * Makes the set equal to first element in set.\n\t\t *\n\t\t * @method first\n\t\t * @return {tinymce.dom.DomQuery} Single item set.\n\t\t */\n\t\tfirst: function() {\n\t\t\treturn this.eq(0);\n\t\t},\n\n\t\t/**\n\t\t * Makes the set equal to last element in set.\n\t\t *\n\t\t * @method last\n\t\t * @return {tinymce.dom.DomQuery} Single item set.\n\t\t */\n\t\tlast: function() {\n\t\t\treturn this.eq(-1);\n\t\t},\n\n\t\t/**\n\t\t * Finds elements by the specified selector for each element in set.\n\t\t *\n\t\t * @method find\n\t\t * @param {String} selector Selector to find elements by.\n\t\t * @return {tinymce.dom.DomQuery} Set with matches elements.\n\t\t */\n\t\tfind: function(selector) {\n\t\t\tvar i, l, ret = [];\n\n\t\t\tfor (i = 0, l = this.length; i < l; i++) {\n\t\t\t\tDomQuery.find(selector, this[i], ret);\n\t\t\t}\n\n\t\t\treturn DomQuery(ret);\n\t\t},\n\n\t\t/**\n\t\t * Filters the current set with the specified selector.\n\t\t *\n\t\t * @method filter\n\t\t * @param {String/function} selector Selector to filter elements by.\n\t\t * @return {tinymce.dom.DomQuery} Set with filtered elements.\n\t\t */\n\t\tfilter: function(selector) {\n\t\t\tif (typeof selector == 'function') {\n\t\t\t\treturn DomQuery(grep(this.toArray(), function(item, i) {\n\t\t\t\t\treturn selector(i, item);\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\treturn DomQuery(DomQuery.filter(selector, this.toArray()));\n\t\t},\n\n\t\t/**\n\t\t * Gets the current node or any parent matching the specified selector.\n\t\t *\n\t\t * @method closest\n\t\t * @param {String/Element/tinymce.dom.DomQuery} selector Selector or element to find.\n\t\t * @return {tinymce.dom.DomQuery} Set with closest elements.\n\t\t */\n\t\tclosest: function(selector) {\n\t\t\tvar result = [];\n\n\t\t\tif (selector instanceof DomQuery) {\n\t\t\t\tselector = selector[0];\n\t\t\t}\n\n\t\t\tthis.each(function(i, node) {\n\t\t\t\twhile (node) {\n\t\t\t\t\tif (typeof selector == 'string' && DomQuery(node).is(selector)) {\n\t\t\t\t\t\tresult.push(node);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else if (node == selector) {\n\t\t\t\t\t\tresult.push(node);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn DomQuery(result);\n\t\t},\n\n\t\t/**\n\t\t * Returns the offset of the first element in set or sets the top/left css properties of all elements in set.\n\t\t *\n\t\t * @method offset\n\t\t * @param {Object} offset Optional offset object to set on each item.\n\t\t * @return {Object/tinymce.dom.DomQuery} Returns the first element offset or the current set if you specified an offset.\n\t\t */\n\t\toffset: function(offset) {\n\t\t\tvar elm, doc, docElm;\n\t\t\tvar x = 0, y = 0, pos;\n\n\t\t\tif (!offset) {\n\t\t\t\telm = this[0];\n\n\t\t\t\tif (elm) {\n\t\t\t\t\tdoc = elm.ownerDocument;\n\t\t\t\t\tdocElm = doc.documentElement;\n\n\t\t\t\t\tif (elm.getBoundingClientRect) {\n\t\t\t\t\t\tpos = elm.getBoundingClientRect();\n\t\t\t\t\t\tx = pos.left + (docElm.scrollLeft || doc.body.scrollLeft) - docElm.clientLeft;\n\t\t\t\t\t\ty = pos.top + (docElm.scrollTop || doc.body.scrollTop) - docElm.clientTop;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tleft: x,\n\t\t\t\t\ttop: y\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn this.css(offset);\n\t\t},\n\n\t\tpush: push,\n\t\tsort: [].sort,\n\t\tsplice: [].splice\n\t};\n\n\t// Static members\n\tTools.extend(DomQuery, {\n\t\t/**\n\t\t * Extends the specified object with one or more objects.\n\t\t *\n\t\t * @static\n\t\t * @method extend\n\t\t * @param {Object} target Target object to extend with new items.\n\t\t * @param {Object..} object Object to extend the target with.\n\t\t * @return {Object} Extended input object.\n\t\t */\n\t\textend: Tools.extend,\n\n\t\t/**\n\t\t * Creates an array out of an array like object.\n\t\t *\n\t\t * @static\n\t\t * @method makeArray\n\t\t * @param {Object} object Object to convert to array.\n\t\t * @return {Array} Array produced from object.\n\t\t */\n\t\tmakeArray: function(object) {\n\t\t\tif (isWindow(object) || object.nodeType) {\n\t\t\t\treturn [object];\n\t\t\t}\n\n\t\t\treturn Tools.toArray(object);\n\t\t},\n\n\t\t/**\n\t\t * Returns the index of the specified item inside the array.\n\t\t *\n\t\t * @static\n\t\t * @method inArray\n\t\t * @param {Object} item Item to look for.\n\t\t * @param {Array} array Array to look for item in.\n\t\t * @return {Number} Index of the item or -1.\n\t\t */\n\t\tinArray: inArray,\n\n\t\t/**\n\t\t * Returns true/false if the specified object is an array or not.\n\t\t *\n\t\t * @static\n\t\t * @method isArray\n\t\t * @param {Object} array Object to check if it's an array or not.\n\t\t * @return {Boolean} True/false if the object is an array.\n\t\t */\n\t\tisArray: Tools.isArray,\n\n\t\t/**\n\t\t * Executes the callback function for each item in array/object. If you return false in the\n\t\t * callback it will break the loop.\n\t\t *\n\t\t * @static\n\t\t * @method each\n\t\t * @param {Object} obj Object to iterate.\n\t\t * @param {function} callback Callback function to execute for each item.\n\t\t */\n\t\teach: each,\n\n\t\t/**\n\t\t * Removes whitespace from the beginning and end of a string.\n\t\t *\n\t\t * @static\n\t\t * @method trim\n\t\t * @param {String} str String to remove whitespace from.\n\t\t * @return {String} New string with removed whitespace.\n\t\t */\n\t\ttrim: trim,\n\n\t\t/**\n\t\t * Filters out items from the input array by calling the specified function for each item.\n\t\t * If the function returns false the item will be excluded if it returns true it will be included.\n\t\t *\n\t\t * @static\n\t\t * @method grep\n\t\t * @param {Array} array Array of items to loop though.\n\t\t * @param {function} callback Function to call for each item. Include/exclude depends on it's return value.\n\t\t * @return {Array} New array with values imported and filtered based in input.\n\t\t * @example\n\t\t * // Filter out some items, this will return an array with 4 and 5\n\t\t * var items = DomQuery.grep([1, 2, 3, 4, 5], function(v) {return v > 3;});\n\t\t */\n\t\tgrep: grep,\n\n\t\t// Sizzle\n\t\tfind: Sizzle,\n\t\texpr: Sizzle.selectors,\n\t\tunique: Sizzle.uniqueSort,\n\t\ttext: Sizzle.getText,\n\t\tcontains: Sizzle.contains,\n\t\tfilter: function(expr, elems, not) {\n\t\t\tvar i = elems.length;\n\n\t\t\tif (not) {\n\t\t\t\texpr = \":not(\" + expr + \")\";\n\t\t\t}\n\n\t\t\twhile (i--) {\n\t\t\t\tif (elems[i].nodeType != 1) {\n\t\t\t\t\telems.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (elems.length === 1) {\n\t\t\t\telems = DomQuery.find.matchesSelector(elems[0], expr) ? [elems[0]] : [];\n\t\t\t} else {\n\t\t\t\telems = DomQuery.find.matches(expr, elems);\n\t\t\t}\n\n\t\t\treturn elems;\n\t\t}\n\t});\n\n\tfunction dir(el, prop, until) {\n\t\tvar matched = [], cur = el[prop];\n\n\t\tif (typeof until != 'string' && until instanceof DomQuery) {\n\t\t\tuntil = until[0];\n\t\t}\n\n\t\twhile (cur && cur.nodeType !== 9) {\n\t\t\tif (until !== undefined) {\n\t\t\t\tif (cur === until) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (typeof until == 'string' && DomQuery(cur).is(until)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (cur.nodeType === 1) {\n\t\t\t\tmatched.push(cur);\n\t\t\t}\n\n\t\t\tcur = cur[prop];\n\t\t}\n\n\t\treturn matched;\n\t}\n\n\tfunction sibling(node, siblingName, nodeType, until) {\n\t\tvar result = [];\n\n\t\tif (until instanceof DomQuery) {\n\t\t\tuntil = until[0];\n\t\t}\n\n\t\tfor (; node; node = node[siblingName]) {\n\t\t\tif (nodeType && node.nodeType !== nodeType) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (until !== undefined) {\n\t\t\t\tif (node === until) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (typeof until == 'string' && DomQuery(node).is(until)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.push(node);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfunction firstSibling(node, siblingName, nodeType) {\n\t\tfor (node = node[siblingName]; node; node = node[siblingName]) {\n\t\t\tif (node.nodeType == nodeType) {\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\teach({\n\t\t/**\n\t\t * Returns a new collection with the parent of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method parent\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match parents against.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching parents.\n\t\t */\n\t\tparent: function(node) {\n\t\t\tvar parent = node.parentNode;\n\n\t\t\treturn parent && parent.nodeType !== 11 ? parent : null;\n\t\t},\n\n\t\t/**\n\t\t * Returns a new collection with the all the parents of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method parents\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match parents against.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching parents.\n\t\t */\n\t\tparents: function(node) {\n\t\t\treturn dir(node, \"parentNode\");\n\t\t},\n\n\t\t/**\n\t\t * Returns a new collection with next sibling of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method next\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match the next element against.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\n\t\t */\n\t\tnext: function(node) {\n\t\t\treturn firstSibling(node, 'nextSibling', 1);\n\t\t},\n\n\t\t/**\n\t\t * Returns a new collection with previous sibling of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method prev\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match the previous element against.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\n\t\t */\n\t\tprev: function(node) {\n\t\t\treturn firstSibling(node, 'previousSibling', 1);\n\t\t},\n\n\t\t/**\n\t\t * Returns all child elements matching the optional selector.\n\t\t *\n\t\t * @method children\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match the elements against.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\n\t\t */\n\t\tchildren: function(node) {\n\t\t\treturn sibling(node.firstChild, 'nextSibling', 1);\n\t\t},\n\n\t\t/**\n\t\t * Returns all child nodes matching the optional selector.\n\t\t *\n\t\t * @method contents\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to get the contents of.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\n\t\t */\n\t\tcontents: function(node) {\n\t\t\treturn Tools.toArray((node.nodeName === \"iframe\" ? node.contentDocument || node.contentWindow.document : node).childNodes);\n\t\t}\n\t}, function(name, fn) {\n\t\tDomQuery.fn[name] = function(selector) {\n\t\t\tvar self = this, result = [];\n\n\t\t\tself.each(function() {\n\t\t\t\tvar nodes = fn.call(result, this, selector, result);\n\n\t\t\t\tif (nodes) {\n\t\t\t\t\tif (DomQuery.isArray(nodes)) {\n\t\t\t\t\t\tresult.push.apply(result, nodes);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.push(nodes);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// If traversing on multiple elements we might get the same elements twice\n\t\t\tif (this.length > 1) {\n\t\t\t\tif (!skipUniques[name]) {\n\t\t\t\t\tresult = DomQuery.unique(result);\n\t\t\t\t}\n\n\t\t\t\tif (name.indexOf('parents') === 0) {\n\t\t\t\t\tresult = result.reverse();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult = DomQuery(result);\n\n\t\t\tif (selector) {\n\t\t\t\treturn result.filter(selector);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t};\n\t});\n\n\teach({\n\t\t/**\n\t\t * Returns a new collection with the all the parents until the matching selector/element\n\t\t * of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method parentsUntil\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to find parent of.\n\t\t * @param {String/Element/tinymce.dom.DomQuery} until Until the matching selector or element.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching parents.\n\t\t */\n\t\tparentsUntil: function(node, until) {\n\t\t\treturn dir(node, \"parentNode\", until);\n\t\t},\n\n\t\t/**\n\t\t * Returns a new collection with all next siblings of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method nextUntil\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to find next siblings on.\n\t\t * @param {String/Element/tinymce.dom.DomQuery} until Until the matching selector or element.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\n\t\t */\n\t\tnextUntil: function(node, until) {\n\t\t\treturn sibling(node, 'nextSibling', 1, until).slice(1);\n\t\t},\n\n\t\t/**\n\t\t * Returns a new collection with all previous siblings of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method prevUntil\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to find previous siblings on.\n\t\t * @param {String/Element/tinymce.dom.DomQuery} until Until the matching selector or element.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\n\t\t */\n\t\tprevUntil: function(node, until) {\n\t\t\treturn sibling(node, 'previousSibling', 1, until).slice(1);\n\t\t}\n\t}, function(name, fn) {\n\t\tDomQuery.fn[name] = function(selector, filter) {\n\t\t\tvar self = this, result = [];\n\n\t\t\tself.each(function() {\n\t\t\t\tvar nodes = fn.call(result, this, selector, result);\n\n\t\t\t\tif (nodes) {\n\t\t\t\t\tif (DomQuery.isArray(nodes)) {\n\t\t\t\t\t\tresult.push.apply(result, nodes);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.push(nodes);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// If traversing on multiple elements we might get the same elements twice\n\t\t\tif (this.length > 1) {\n\t\t\t\tresult = DomQuery.unique(result);\n\n\t\t\t\tif (name.indexOf('parents') === 0 || name === 'prevUntil') {\n\t\t\t\t\tresult = result.reverse();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult = DomQuery(result);\n\n\t\t\tif (filter) {\n\t\t\t\treturn result.filter(filter);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t};\n\t});\n\n\t/**\n\t * Returns true/false if the current set items matches the selector.\n\t *\n\t * @method is\n\t * @param {String} selector Selector to match the elements against.\n\t * @return {Boolean} True/false if the current set matches the selector.\n\t */\n\tDomQuery.fn.is = function(selector) {\n\t\treturn !!selector && this.filter(selector).length > 0;\n\t};\n\n\tDomQuery.fn.init.prototype = DomQuery.fn;\n\n\tDomQuery.overrideDefaults = function(callback) {\n\t\tvar defaults;\n\n\t\tfunction sub(selector, context) {\n\t\t\tdefaults = defaults || callback();\n\n\t\t\tif (arguments.length === 0) {\n\t\t\t\tselector = defaults.element;\n\t\t\t}\n\n\t\t\tif (!context) {\n\t\t\t\tcontext = defaults.context;\n\t\t\t}\n\n\t\t\treturn new sub.fn.init(selector, context);\n\t\t}\n\n\t\tDomQuery.extend(sub, this);\n\n\t\treturn sub;\n\t};\n\n\tfunction appendHooks(targetHooks, prop, hooks) {\n\t\teach(hooks, function(name, func) {\n\t\t\ttargetHooks[name] = targetHooks[name] || {};\n\t\t\ttargetHooks[name][prop] = func;\n\t\t});\n\t}\n\n\tif (Env.ie && Env.ie < 8) {\n\t\tappendHooks(attrHooks, 'get', {\n\t\t\tmaxlength: function(elm) {\n\t\t\t\tvar value = elm.maxLength;\n\n\t\t\t\tif (value === 0x7fffffff) {\n\t\t\t\t\treturn undef;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t},\n\n\t\t\tsize: function(elm) {\n\t\t\t\tvar value = elm.size;\n\n\t\t\t\tif (value === 20) {\n\t\t\t\t\treturn undef;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t},\n\n\t\t\t'class': function(elm) {\n\t\t\t\treturn elm.className;\n\t\t\t},\n\n\t\t\tstyle: function(elm) {\n\t\t\t\tvar value = elm.style.cssText;\n\n\t\t\t\tif (value.length === 0) {\n\t\t\t\t\treturn undef;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\t\t});\n\n\t\tappendHooks(attrHooks, 'set', {\n\t\t\t'class': function(elm, value) {\n\t\t\t\telm.className = value;\n\t\t\t},\n\n\t\t\tstyle: function(elm, value) {\n\t\t\t\telm.style.cssText = value;\n\t\t\t}\n\t\t});\n\t}\n\n\tif (Env.ie && Env.ie < 9) {\n\t\t/*jshint sub:true */\n\t\t/*eslint dot-notation: 0*/\n\t\tcssFix['float'] = 'styleFloat';\n\n\t\tappendHooks(cssHooks, 'set', {\n\t\t\topacity: function(elm, value) {\n\t\t\t\tvar style = elm.style;\n\n\t\t\t\tif (value === null || value === '') {\n\t\t\t\t\tstyle.removeAttribute('filter');\n\t\t\t\t} else {\n\t\t\t\t\tstyle.zoom = 1;\n\t\t\t\t\tstyle.filter = 'alpha(opacity=' + (value * 100) + ')';\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tDomQuery.attrHooks = attrHooks;\n\tDomQuery.cssHooks = cssHooks;\n\n\treturn DomQuery;\n});\n\n// Included from: js/tinymce/classes/html/Styles.js\n\n/**\n * Styles.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is used to parse CSS styles it also compresses styles to reduce the output size.\n *\n * @example\n * var Styles = new tinymce.html.Styles({\n *    url_converter: function(url) {\n *       return url;\n *    }\n * });\n *\n * styles = Styles.parse('border: 1px solid red');\n * styles.color = 'red';\n *\n * console.log(new tinymce.html.StyleSerializer().serialize(styles));\n *\n * @class tinymce.html.Styles\n * @version 3.4\n */\ndefine(\"tinymce/html/Styles\", [], function() {\n\treturn function(settings, schema) {\n\t\t/*jshint maxlen:255 */\n\t\t/*eslint max-len:0 */\n\t\tvar rgbRegExp = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*\\)/gi,\n\t\t\turlOrStrRegExp = /(?:url(?:(?:\\(\\s*\\\"([^\\\"]+)\\\"\\s*\\))|(?:\\(\\s*\\'([^\\']+)\\'\\s*\\))|(?:\\(\\s*([^)\\s]+)\\s*\\))))|(?:\\'([^\\']+)\\')|(?:\\\"([^\\\"]+)\\\")/gi,\n\t\t\tstyleRegExp = /\\s*([^:]+):\\s*([^;]+);?/g,\n\t\t\ttrimRightRegExp = /\\s+$/,\n\t\t\ti, encodingLookup = {}, encodingItems, validStyles, invalidStyles, invisibleChar = '\\uFEFF';\n\n\t\tsettings = settings || {};\n\n\t\tif (schema) {\n\t\t\tvalidStyles = schema.getValidStyles();\n\t\t\tinvalidStyles = schema.getInvalidStyles();\n\t\t}\n\n\t\tencodingItems = ('\\\\\" \\\\\\' \\\\; \\\\: ; : ' + invisibleChar).split(' ');\n\t\tfor (i = 0; i < encodingItems.length; i++) {\n\t\t\tencodingLookup[encodingItems[i]] = invisibleChar + i;\n\t\t\tencodingLookup[invisibleChar + i] = encodingItems[i];\n\t\t}\n\n\t\tfunction toHex(match, r, g, b) {\n\t\t\tfunction hex(val) {\n\t\t\t\tval = parseInt(val, 10).toString(16);\n\n\t\t\t\treturn val.length > 1 ? val : '0' + val; // 0 -> 00\n\t\t\t}\n\n\t\t\treturn '#' + hex(r) + hex(g) + hex(b);\n\t\t}\n\n\t\treturn {\n\t\t\t/**\n\t\t\t * Parses the specified RGB color value and returns a hex version of that color.\n\t\t\t *\n\t\t\t * @method toHex\n\t\t\t * @param {String} color RGB string value like rgb(1,2,3)\n\t\t\t * @return {String} Hex version of that RGB value like #FF00FF.\n\t\t\t */\n\t\t\ttoHex: function(color) {\n\t\t\t\treturn color.replace(rgbRegExp, toHex);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Parses the specified style value into an object collection. This parser will also\n\t\t\t * merge and remove any redundant items that browsers might have added. It will also convert non hex\n\t\t\t * colors to hex values. Urls inside the styles will also be converted to absolute/relative based on settings.\n\t\t\t *\n\t\t\t * @method parse\n\t\t\t * @param {String} css Style value to parse for example: border:1px solid red;.\n\t\t\t * @return {Object} Object representation of that style like {border: '1px solid red'}\n\t\t\t */\n\t\t\tparse: function(css) {\n\t\t\t\tvar styles = {}, matches, name, value, isEncoded, urlConverter = settings.url_converter;\n\t\t\t\tvar urlConverterScope = settings.url_converter_scope || this;\n\n\t\t\t\tfunction compress(prefix, suffix, noJoin) {\n\t\t\t\t\tvar top, right, bottom, left;\n\n\t\t\t\t\ttop = styles[prefix + '-top' + suffix];\n\t\t\t\t\tif (!top) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tright = styles[prefix + '-right' + suffix];\n\t\t\t\t\tif (!right) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tbottom = styles[prefix + '-bottom' + suffix];\n\t\t\t\t\tif (!bottom) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tleft = styles[prefix + '-left' + suffix];\n\t\t\t\t\tif (!left) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar box = [top, right, bottom, left];\n\t\t\t\t\ti = box.length - 1;\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (box[i] !== box[i + 1]) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (i > -1 && noJoin) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tstyles[prefix + suffix] = i == -1 ? box[0] : box.join(' ');\n\t\t\t\t\tdelete styles[prefix + '-top' + suffix];\n\t\t\t\t\tdelete styles[prefix + '-right' + suffix];\n\t\t\t\t\tdelete styles[prefix + '-bottom' + suffix];\n\t\t\t\t\tdelete styles[prefix + '-left' + suffix];\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * Checks if the specific style can be compressed in other words if all border-width are equal.\n\t\t\t\t */\n\t\t\t\tfunction canCompress(key) {\n\t\t\t\t\tvar value = styles[key], i;\n\n\t\t\t\t\tif (!value) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvalue = value.split(' ');\n\t\t\t\t\ti = value.length;\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (value[i] !== value[0]) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstyles[key] = value[0];\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * Compresses multiple styles into one style.\n\t\t\t\t */\n\t\t\t\tfunction compress2(target, a, b, c) {\n\t\t\t\t\tif (!canCompress(a)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!canCompress(b)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!canCompress(c)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Compress\n\t\t\t\t\tstyles[target] = styles[a] + ' ' + styles[b] + ' ' + styles[c];\n\t\t\t\t\tdelete styles[a];\n\t\t\t\t\tdelete styles[b];\n\t\t\t\t\tdelete styles[c];\n\t\t\t\t}\n\n\t\t\t\t// Encodes the specified string by replacing all \\\" \\' ; : with _<num>\n\t\t\t\tfunction encode(str) {\n\t\t\t\t\tisEncoded = true;\n\n\t\t\t\t\treturn encodingLookup[str];\n\t\t\t\t}\n\n\t\t\t\t// Decodes the specified string by replacing all _<num> with it's original value \\\" \\' etc\n\t\t\t\t// It will also decode the \\\" \\' if keep_slashes is set to fale or omitted\n\t\t\t\tfunction decode(str, keep_slashes) {\n\t\t\t\t\tif (isEncoded) {\n\t\t\t\t\t\tstr = str.replace(/\\uFEFF[0-9]/g, function(str) {\n\t\t\t\t\t\t\treturn encodingLookup[str];\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!keep_slashes) {\n\t\t\t\t\t\tstr = str.replace(/\\\\([\\'\\\";:])/g, \"$1\");\n\t\t\t\t\t}\n\n\t\t\t\t\treturn str;\n\t\t\t\t}\n\n\t\t\t\tfunction decodeSingleHexSequence(escSeq) {\n\t\t\t\t\treturn String.fromCharCode(parseInt(escSeq.slice(1), 16));\n\t\t\t\t}\n\n\t\t\t\tfunction decodeHexSequences(value) {\n\t\t\t\t\treturn value.replace(/\\\\[0-9a-f]+/gi, decodeSingleHexSequence);\n\t\t\t\t}\n\n\t\t\t\tfunction processUrl(match, url, url2, url3, str, str2) {\n\t\t\t\t\tstr = str || str2;\n\n\t\t\t\t\tif (str) {\n\t\t\t\t\t\tstr = decode(str);\n\n\t\t\t\t\t\t// Force strings into single quote format\n\t\t\t\t\t\treturn \"'\" + str.replace(/\\'/g, \"\\\\'\") + \"'\";\n\t\t\t\t\t}\n\n\t\t\t\t\turl = decode(url || url2 || url3);\n\n\t\t\t\t\tif (!settings.allow_script_urls) {\n\t\t\t\t\t\tvar scriptUrl = url.replace(/[\\s\\r\\n]+/g, '');\n\n\t\t\t\t\t\tif (/(java|vb)script:/i.test(scriptUrl)) {\n\t\t\t\t\t\t\treturn \"\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!settings.allow_svg_data_urls && /^data:image\\/svg/i.test(scriptUrl)) {\n\t\t\t\t\t\t\treturn \"\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Convert the URL to relative/absolute depending on config\n\t\t\t\t\tif (urlConverter) {\n\t\t\t\t\t\turl = urlConverter.call(urlConverterScope, url, 'style');\n\t\t\t\t\t}\n\n\t\t\t\t\t// Output new URL format\n\t\t\t\t\treturn \"url('\" + url.replace(/\\'/g, \"\\\\'\") + \"')\";\n\t\t\t\t}\n\n\t\t\t\tif (css) {\n\t\t\t\t\tcss = css.replace(/[\\u0000-\\u001F]/g, '');\n\n\t\t\t\t\t// Encode \\\" \\' % and ; and : inside strings so they don't interfere with the style parsing\n\t\t\t\t\tcss = css.replace(/\\\\[\\\"\\';:\\uFEFF]/g, encode).replace(/\\\"[^\\\"]+\\\"|\\'[^\\']+\\'/g, function(str) {\n\t\t\t\t\t\treturn str.replace(/[;:]/g, encode);\n\t\t\t\t\t});\n\n\t\t\t\t\t// Parse styles\n\t\t\t\t\twhile ((matches = styleRegExp.exec(css))) {\n\t\t\t\t\t\tstyleRegExp.lastIndex = matches.index + matches[0].length;\n\t\t\t\t\t\tname = matches[1].replace(trimRightRegExp, '').toLowerCase();\n\t\t\t\t\t\tvalue = matches[2].replace(trimRightRegExp, '');\n\n\t\t\t\t\t\tif (name && value) {\n\t\t\t\t\t\t\t// Decode escaped sequences like \\65 -> e\n\t\t\t\t\t\t\tname = decodeHexSequences(name);\n\t\t\t\t\t\t\tvalue = decodeHexSequences(value);\n\n\t\t\t\t\t\t\t// Skip properties with double quotes and sequences like \\\" \\' in their names\n\t\t\t\t\t\t\t// See 'mXSS Attacks: Attacking well-secured Web-Applications by using innerHTML Mutations'\n\t\t\t\t\t\t\t// https://cure53.de/fp170.pdf\n\t\t\t\t\t\t\tif (name.indexOf(invisibleChar) !== -1 || name.indexOf('\"') !== -1) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Don't allow behavior name or expression/comments within the values\n\t\t\t\t\t\t\tif (!settings.allow_script_urls && (name == \"behavior\" || /expression\\s*\\(|\\/\\*|\\*\\//.test(value))) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Opera will produce 700 instead of bold in their style values\n\t\t\t\t\t\t\tif (name === 'font-weight' && value === '700') {\n\t\t\t\t\t\t\t\tvalue = 'bold';\n\t\t\t\t\t\t\t} else if (name === 'color' || name === 'background-color') { // Lowercase colors like RED\n\t\t\t\t\t\t\t\tvalue = value.toLowerCase();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Convert RGB colors to HEX\n\t\t\t\t\t\t\tvalue = value.replace(rgbRegExp, toHex);\n\n\t\t\t\t\t\t\t// Convert URLs and force them into url('value') format\n\t\t\t\t\t\t\tvalue = value.replace(urlOrStrRegExp, processUrl);\n\t\t\t\t\t\t\tstyles[name] = isEncoded ? decode(value, true) : value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Compress the styles to reduce it's size for example IE will expand styles\n\t\t\t\t\tcompress(\"border\", \"\", true);\n\t\t\t\t\tcompress(\"border\", \"-width\");\n\t\t\t\t\tcompress(\"border\", \"-color\");\n\t\t\t\t\tcompress(\"border\", \"-style\");\n\t\t\t\t\tcompress(\"padding\", \"\");\n\t\t\t\t\tcompress(\"margin\", \"\");\n\t\t\t\t\tcompress2('border', 'border-width', 'border-style', 'border-color');\n\n\t\t\t\t\t// Remove pointless border, IE produces these\n\t\t\t\t\tif (styles.border === 'medium none') {\n\t\t\t\t\t\tdelete styles.border;\n\t\t\t\t\t}\n\n\t\t\t\t\t// IE 11 will produce a border-image: none when getting the style attribute from <p style=\"border: 1px solid red\"></p>\n\t\t\t\t\t// So let us assume it shouldn't be there\n\t\t\t\t\tif (styles['border-image'] === 'none') {\n\t\t\t\t\t\tdelete styles['border-image'];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn styles;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Serializes the specified style object into a string.\n\t\t\t *\n\t\t\t * @method serialize\n\t\t\t * @param {Object} styles Object to serialize as string for example: {border: '1px solid red'}\n\t\t\t * @param {String} elementName Optional element name, if specified only the styles that matches the schema will be serialized.\n\t\t\t * @return {String} String representation of the style object for example: border: 1px solid red.\n\t\t\t */\n\t\t\tserialize: function(styles, elementName) {\n\t\t\t\tvar css = '', name, value;\n\n\t\t\t\tfunction serializeStyles(name) {\n\t\t\t\t\tvar styleList, i, l, value;\n\n\t\t\t\t\tstyleList = validStyles[name];\n\t\t\t\t\tif (styleList) {\n\t\t\t\t\t\tfor (i = 0, l = styleList.length; i < l; i++) {\n\t\t\t\t\t\t\tname = styleList[i];\n\t\t\t\t\t\t\tvalue = styles[name];\n\n\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\tcss += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction isValid(name, elementName) {\n\t\t\t\t\tvar styleMap;\n\n\t\t\t\t\tstyleMap = invalidStyles['*'];\n\t\t\t\t\tif (styleMap && styleMap[name]) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tstyleMap = invalidStyles[elementName];\n\t\t\t\t\tif (styleMap && styleMap[name]) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// Serialize styles according to schema\n\t\t\t\tif (elementName && validStyles) {\n\t\t\t\t\t// Serialize global styles and element specific styles\n\t\t\t\t\tserializeStyles('*');\n\t\t\t\t\tserializeStyles(elementName);\n\t\t\t\t} else {\n\t\t\t\t\t// Output the styles in the order they are inside the object\n\t\t\t\t\tfor (name in styles) {\n\t\t\t\t\t\tvalue = styles[name];\n\n\t\t\t\t\t\tif (value && (!invalidStyles || isValid(name, elementName))) {\n\t\t\t\t\t\t\tcss += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn css;\n\t\t\t}\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/TreeWalker.js\n\n/**\n * TreeWalker.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * TreeWalker class enables you to walk the DOM in a linear manner.\n *\n * @class tinymce.dom.TreeWalker\n * @example\n * var walker = new tinymce.dom.TreeWalker(startNode);\n *\n * do {\n *     console.log(walker.current());\n * } while (walker.next());\n */\ndefine(\"tinymce/dom/TreeWalker\", [], function() {\n\t/**\n\t * Constructs a new TreeWalker instance.\n\t *\n\t * @constructor\n\t * @method TreeWalker\n\t * @param {Node} startNode Node to start walking from.\n\t * @param {node} rootNode Optional root node to never walk out of.\n\t */\n\treturn function(startNode, rootNode) {\n\t\tvar node = startNode;\n\n\t\tfunction findSibling(node, startName, siblingName, shallow) {\n\t\t\tvar sibling, parent;\n\n\t\t\tif (node) {\n\t\t\t\t// Walk into nodes if it has a start\n\t\t\t\tif (!shallow && node[startName]) {\n\t\t\t\t\treturn node[startName];\n\t\t\t\t}\n\n\t\t\t\t// Return the sibling if it has one\n\t\t\t\tif (node != rootNode) {\n\t\t\t\t\tsibling = node[siblingName];\n\t\t\t\t\tif (sibling) {\n\t\t\t\t\t\treturn sibling;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Walk up the parents to look for siblings\n\t\t\t\t\tfor (parent = node.parentNode; parent && parent != rootNode; parent = parent.parentNode) {\n\t\t\t\t\t\tsibling = parent[siblingName];\n\t\t\t\t\t\tif (sibling) {\n\t\t\t\t\t\t\treturn sibling;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction findPreviousNode(node, startName, siblingName, shallow) {\n\t\t\tvar sibling, parent, child;\n\n\t\t\tif (node) {\n\t\t\t\tsibling = node[siblingName];\n\t\t\t\tif (rootNode && sibling === rootNode) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (sibling) {\n\t\t\t\t\tif (!shallow) {\n\t\t\t\t\t\t// Walk up the parents to look for siblings\n\t\t\t\t\t\tfor (child = sibling[startName]; child; child = child[startName]) {\n\t\t\t\t\t\t\tif (!child[startName]) {\n\t\t\t\t\t\t\t\treturn child;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn sibling;\n\t\t\t\t}\n\n\t\t\t\tparent = node.parentNode;\n\t\t\t\tif (parent && parent !== rootNode) {\n\t\t\t\t\treturn parent;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Returns the current node.\n\t\t *\n\t\t * @method current\n\t\t * @return {Node} Current node where the walker is.\n\t\t */\n\t\tthis.current = function() {\n\t\t\treturn node;\n\t\t};\n\n\t\t/**\n\t\t * Walks to the next node in tree.\n\t\t *\n\t\t * @method next\n\t\t * @return {Node} Current node where the walker is after moving to the next node.\n\t\t */\n\t\tthis.next = function(shallow) {\n\t\t\tnode = findSibling(node, 'firstChild', 'nextSibling', shallow);\n\t\t\treturn node;\n\t\t};\n\n\t\t/**\n\t\t * Walks to the previous node in tree.\n\t\t *\n\t\t * @method prev\n\t\t * @return {Node} Current node where the walker is after moving to the previous node.\n\t\t */\n\t\tthis.prev = function(shallow) {\n\t\t\tnode = findSibling(node, 'lastChild', 'previousSibling', shallow);\n\t\t\treturn node;\n\t\t};\n\n\t\tthis.prev2 = function(shallow) {\n\t\t\tnode = findPreviousNode(node, 'lastChild', 'previousSibling', shallow);\n\t\t\treturn node;\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/Range.js\n\n/**\n * Range.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Old IE Range.\n *\n * @private\n * @class tinymce.dom.Range\n */\ndefine(\"tinymce/dom/Range\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\t// Range constructor\n\tfunction Range(dom) {\n\t\tvar self = this,\n\t\t\tdoc = dom.doc,\n\t\t\tEXTRACT = 0,\n\t\t\tCLONE = 1,\n\t\t\tDELETE = 2,\n\t\t\tTRUE = true,\n\t\t\tFALSE = false,\n\t\t\tSTART_OFFSET = 'startOffset',\n\t\t\tSTART_CONTAINER = 'startContainer',\n\t\t\tEND_CONTAINER = 'endContainer',\n\t\t\tEND_OFFSET = 'endOffset',\n\t\t\textend = Tools.extend,\n\t\t\tnodeIndex = dom.nodeIndex;\n\n\t\tfunction createDocumentFragment() {\n\t\t\treturn doc.createDocumentFragment();\n\t\t}\n\n\t\tfunction setStart(n, o) {\n\t\t\t_setEndPoint(TRUE, n, o);\n\t\t}\n\n\t\tfunction setEnd(n, o) {\n\t\t\t_setEndPoint(FALSE, n, o);\n\t\t}\n\n\t\tfunction setStartBefore(n) {\n\t\t\tsetStart(n.parentNode, nodeIndex(n));\n\t\t}\n\n\t\tfunction setStartAfter(n) {\n\t\t\tsetStart(n.parentNode, nodeIndex(n) + 1);\n\t\t}\n\n\t\tfunction setEndBefore(n) {\n\t\t\tsetEnd(n.parentNode, nodeIndex(n));\n\t\t}\n\n\t\tfunction setEndAfter(n) {\n\t\t\tsetEnd(n.parentNode, nodeIndex(n) + 1);\n\t\t}\n\n\t\tfunction collapse(ts) {\n\t\t\tif (ts) {\n\t\t\t\tself[END_CONTAINER] = self[START_CONTAINER];\n\t\t\t\tself[END_OFFSET] = self[START_OFFSET];\n\t\t\t} else {\n\t\t\t\tself[START_CONTAINER] = self[END_CONTAINER];\n\t\t\t\tself[START_OFFSET] = self[END_OFFSET];\n\t\t\t}\n\n\t\t\tself.collapsed = TRUE;\n\t\t}\n\n\t\tfunction selectNode(n) {\n\t\t\tsetStartBefore(n);\n\t\t\tsetEndAfter(n);\n\t\t}\n\n\t\tfunction selectNodeContents(n) {\n\t\t\tsetStart(n, 0);\n\t\t\tsetEnd(n, n.nodeType === 1 ? n.childNodes.length : n.nodeValue.length);\n\t\t}\n\n\t\tfunction compareBoundaryPoints(h, r) {\n\t\t\tvar sc = self[START_CONTAINER], so = self[START_OFFSET], ec = self[END_CONTAINER], eo = self[END_OFFSET],\n\t\t\trsc = r.startContainer, rso = r.startOffset, rec = r.endContainer, reo = r.endOffset;\n\n\t\t\t// Check START_TO_START\n\t\t\tif (h === 0) {\n\t\t\t\treturn _compareBoundaryPoints(sc, so, rsc, rso);\n\t\t\t}\n\n\t\t\t// Check START_TO_END\n\t\t\tif (h === 1) {\n\t\t\t\treturn _compareBoundaryPoints(ec, eo, rsc, rso);\n\t\t\t}\n\n\t\t\t// Check END_TO_END\n\t\t\tif (h === 2) {\n\t\t\t\treturn _compareBoundaryPoints(ec, eo, rec, reo);\n\t\t\t}\n\n\t\t\t// Check END_TO_START\n\t\t\tif (h === 3) {\n\t\t\t\treturn _compareBoundaryPoints(sc, so, rec, reo);\n\t\t\t}\n\t\t}\n\n\t\tfunction deleteContents() {\n\t\t\t_traverse(DELETE);\n\t\t}\n\n\t\tfunction extractContents() {\n\t\t\treturn _traverse(EXTRACT);\n\t\t}\n\n\t\tfunction cloneContents() {\n\t\t\treturn _traverse(CLONE);\n\t\t}\n\n\t\tfunction insertNode(n) {\n\t\t\tvar startContainer = this[START_CONTAINER],\n\t\t\t\tstartOffset = this[START_OFFSET], nn, o;\n\n\t\t\t// Node is TEXT_NODE or CDATA\n\t\t\tif ((startContainer.nodeType === 3 || startContainer.nodeType === 4) && startContainer.nodeValue) {\n\t\t\t\tif (!startOffset) {\n\t\t\t\t\t// At the start of text\n\t\t\t\t\tstartContainer.parentNode.insertBefore(n, startContainer);\n\t\t\t\t} else if (startOffset >= startContainer.nodeValue.length) {\n\t\t\t\t\t// At the end of text\n\t\t\t\t\tdom.insertAfter(n, startContainer);\n\t\t\t\t} else {\n\t\t\t\t\t// Middle, need to split\n\t\t\t\t\tnn = startContainer.splitText(startOffset);\n\t\t\t\t\tstartContainer.parentNode.insertBefore(n, nn);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Insert element node\n\t\t\t\tif (startContainer.childNodes.length > 0) {\n\t\t\t\t\to = startContainer.childNodes[startOffset];\n\t\t\t\t}\n\n\t\t\t\tif (o) {\n\t\t\t\t\tstartContainer.insertBefore(n, o);\n\t\t\t\t} else {\n\t\t\t\t\tif (startContainer.nodeType == 3) {\n\t\t\t\t\t\tdom.insertAfter(n, startContainer);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstartContainer.appendChild(n);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction surroundContents(n) {\n\t\t\tvar f = self.extractContents();\n\n\t\t\tself.insertNode(n);\n\t\t\tn.appendChild(f);\n\t\t\tself.selectNode(n);\n\t\t}\n\n\t\tfunction cloneRange() {\n\t\t\treturn extend(new Range(dom), {\n\t\t\t\tstartContainer: self[START_CONTAINER],\n\t\t\t\tstartOffset: self[START_OFFSET],\n\t\t\t\tendContainer: self[END_CONTAINER],\n\t\t\t\tendOffset: self[END_OFFSET],\n\t\t\t\tcollapsed: self.collapsed,\n\t\t\t\tcommonAncestorContainer: self.commonAncestorContainer\n\t\t\t});\n\t\t}\n\n\t\t// Private methods\n\n\t\tfunction _getSelectedNode(container, offset) {\n\t\t\tvar child;\n\n\t\t\t// TEXT_NODE\n\t\t\tif (container.nodeType == 3) {\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\tif (offset < 0) {\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\tchild = container.firstChild;\n\t\t\twhile (child && offset > 0) {\n\t\t\t\t--offset;\n\t\t\t\tchild = child.nextSibling;\n\t\t\t}\n\n\t\t\tif (child) {\n\t\t\t\treturn child;\n\t\t\t}\n\n\t\t\treturn container;\n\t\t}\n\n\t\tfunction _isCollapsed() {\n\t\t\treturn (self[START_CONTAINER] == self[END_CONTAINER] && self[START_OFFSET] == self[END_OFFSET]);\n\t\t}\n\n\t\tfunction _compareBoundaryPoints(containerA, offsetA, containerB, offsetB) {\n\t\t\tvar c, offsetC, n, cmnRoot, childA, childB;\n\n\t\t\t// In the first case the boundary-points have the same container. A is before B\n\t\t\t// if its offset is less than the offset of B, A is equal to B if its offset is\n\t\t\t// equal to the offset of B, and A is after B if its offset is greater than the\n\t\t\t// offset of B.\n\t\t\tif (containerA == containerB) {\n\t\t\t\tif (offsetA == offsetB) {\n\t\t\t\t\treturn 0; // equal\n\t\t\t\t}\n\n\t\t\t\tif (offsetA < offsetB) {\n\t\t\t\t\treturn -1; // before\n\t\t\t\t}\n\n\t\t\t\treturn 1; // after\n\t\t\t}\n\n\t\t\t// In the second case a child node C of the container of A is an ancestor\n\t\t\t// container of B. In this case, A is before B if the offset of A is less than or\n\t\t\t// equal to the index of the child node C and A is after B otherwise.\n\t\t\tc = containerB;\n\t\t\twhile (c && c.parentNode != containerA) {\n\t\t\t\tc = c.parentNode;\n\t\t\t}\n\n\t\t\tif (c) {\n\t\t\t\toffsetC = 0;\n\t\t\t\tn = containerA.firstChild;\n\n\t\t\t\twhile (n != c && offsetC < offsetA) {\n\t\t\t\t\toffsetC++;\n\t\t\t\t\tn = n.nextSibling;\n\t\t\t\t}\n\n\t\t\t\tif (offsetA <= offsetC) {\n\t\t\t\t\treturn -1; // before\n\t\t\t\t}\n\n\t\t\t\treturn 1; // after\n\t\t\t}\n\n\t\t\t// In the third case a child node C of the container of B is an ancestor container\n\t\t\t// of A. In this case, A is before B if the index of the child node C is less than\n\t\t\t// the offset of B and A is after B otherwise.\n\t\t\tc = containerA;\n\t\t\twhile (c && c.parentNode != containerB) {\n\t\t\t\tc = c.parentNode;\n\t\t\t}\n\n\t\t\tif (c) {\n\t\t\t\toffsetC = 0;\n\t\t\t\tn = containerB.firstChild;\n\n\t\t\t\twhile (n != c && offsetC < offsetB) {\n\t\t\t\t\toffsetC++;\n\t\t\t\t\tn = n.nextSibling;\n\t\t\t\t}\n\n\t\t\t\tif (offsetC < offsetB) {\n\t\t\t\t\treturn -1; // before\n\t\t\t\t}\n\n\t\t\t\treturn 1; // after\n\t\t\t}\n\n\t\t\t// In the fourth case, none of three other cases hold: the containers of A and B\n\t\t\t// are siblings or descendants of sibling nodes. In this case, A is before B if\n\t\t\t// the container of A is before the container of B in a pre-order traversal of the\n\t\t\t// Ranges' context tree and A is after B otherwise.\n\t\t\tcmnRoot = dom.findCommonAncestor(containerA, containerB);\n\t\t\tchildA = containerA;\n\n\t\t\twhile (childA && childA.parentNode != cmnRoot) {\n\t\t\t\tchildA = childA.parentNode;\n\t\t\t}\n\n\t\t\tif (!childA) {\n\t\t\t\tchildA = cmnRoot;\n\t\t\t}\n\n\t\t\tchildB = containerB;\n\t\t\twhile (childB && childB.parentNode != cmnRoot) {\n\t\t\t\tchildB = childB.parentNode;\n\t\t\t}\n\n\t\t\tif (!childB) {\n\t\t\t\tchildB = cmnRoot;\n\t\t\t}\n\n\t\t\tif (childA == childB) {\n\t\t\t\treturn 0; // equal\n\t\t\t}\n\n\t\t\tn = cmnRoot.firstChild;\n\t\t\twhile (n) {\n\t\t\t\tif (n == childA) {\n\t\t\t\t\treturn -1; // before\n\t\t\t\t}\n\n\t\t\t\tif (n == childB) {\n\t\t\t\t\treturn 1; // after\n\t\t\t\t}\n\n\t\t\t\tn = n.nextSibling;\n\t\t\t}\n\t\t}\n\n\t\tfunction _setEndPoint(st, n, o) {\n\t\t\tvar ec, sc;\n\n\t\t\tif (st) {\n\t\t\t\tself[START_CONTAINER] = n;\n\t\t\t\tself[START_OFFSET] = o;\n\t\t\t} else {\n\t\t\t\tself[END_CONTAINER] = n;\n\t\t\t\tself[END_OFFSET] = o;\n\t\t\t}\n\n\t\t\t// If one boundary-point of a Range is set to have a root container\n\t\t\t// other than the current one for the Range, the Range is collapsed to\n\t\t\t// the new position. This enforces the restriction that both boundary-\n\t\t\t// points of a Range must have the same root container.\n\t\t\tec = self[END_CONTAINER];\n\t\t\twhile (ec.parentNode) {\n\t\t\t\tec = ec.parentNode;\n\t\t\t}\n\n\t\t\tsc = self[START_CONTAINER];\n\t\t\twhile (sc.parentNode) {\n\t\t\t\tsc = sc.parentNode;\n\t\t\t}\n\n\t\t\tif (sc == ec) {\n\t\t\t\t// The start position of a Range is guaranteed to never be after the\n\t\t\t\t// end position. To enforce this restriction, if the start is set to\n\t\t\t\t// be at a position after the end, the Range is collapsed to that\n\t\t\t\t// position.\n\t\t\t\tif (_compareBoundaryPoints(self[START_CONTAINER], self[START_OFFSET], self[END_CONTAINER], self[END_OFFSET]) > 0) {\n\t\t\t\t\tself.collapse(st);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tself.collapse(st);\n\t\t\t}\n\n\t\t\tself.collapsed = _isCollapsed();\n\t\t\tself.commonAncestorContainer = dom.findCommonAncestor(self[START_CONTAINER], self[END_CONTAINER]);\n\t\t}\n\n\t\tfunction _traverse(how) {\n\t\t\tvar c, endContainerDepth = 0, startContainerDepth = 0, p, depthDiff, startNode, endNode, sp, ep;\n\n\t\t\tif (self[START_CONTAINER] == self[END_CONTAINER]) {\n\t\t\t\treturn _traverseSameContainer(how);\n\t\t\t}\n\n\t\t\tfor (c = self[END_CONTAINER], p = c.parentNode; p; c = p, p = p.parentNode) {\n\t\t\t\tif (p == self[START_CONTAINER]) {\n\t\t\t\t\treturn _traverseCommonStartContainer(c, how);\n\t\t\t\t}\n\n\t\t\t\t++endContainerDepth;\n\t\t\t}\n\n\t\t\tfor (c = self[START_CONTAINER], p = c.parentNode; p; c = p, p = p.parentNode) {\n\t\t\t\tif (p == self[END_CONTAINER]) {\n\t\t\t\t\treturn _traverseCommonEndContainer(c, how);\n\t\t\t\t}\n\n\t\t\t\t++startContainerDepth;\n\t\t\t}\n\n\t\t\tdepthDiff = startContainerDepth - endContainerDepth;\n\n\t\t\tstartNode = self[START_CONTAINER];\n\t\t\twhile (depthDiff > 0) {\n\t\t\t\tstartNode = startNode.parentNode;\n\t\t\t\tdepthDiff--;\n\t\t\t}\n\n\t\t\tendNode = self[END_CONTAINER];\n\t\t\twhile (depthDiff < 0) {\n\t\t\t\tendNode = endNode.parentNode;\n\t\t\t\tdepthDiff++;\n\t\t\t}\n\n\t\t\t// ascend the ancestor hierarchy until we have a common parent.\n\t\t\tfor (sp = startNode.parentNode, ep = endNode.parentNode; sp != ep; sp = sp.parentNode, ep = ep.parentNode) {\n\t\t\t\tstartNode = sp;\n\t\t\t\tendNode = ep;\n\t\t\t}\n\n\t\t\treturn _traverseCommonAncestors(startNode, endNode, how);\n\t\t}\n\n\t\tfunction _traverseSameContainer(how) {\n\t\t\tvar frag, s, sub, n, cnt, sibling, xferNode, start, len;\n\n\t\t\tif (how != DELETE) {\n\t\t\t\tfrag = createDocumentFragment();\n\t\t\t}\n\n\t\t\t// If selection is empty, just return the fragment\n\t\t\tif (self[START_OFFSET] == self[END_OFFSET]) {\n\t\t\t\treturn frag;\n\t\t\t}\n\n\t\t\t// Text node needs special case handling\n\t\t\tif (self[START_CONTAINER].nodeType == 3) { // TEXT_NODE\n\t\t\t\t// get the substring\n\t\t\t\ts = self[START_CONTAINER].nodeValue;\n\t\t\t\tsub = s.substring(self[START_OFFSET], self[END_OFFSET]);\n\n\t\t\t\t// set the original text node to its new value\n\t\t\t\tif (how != CLONE) {\n\t\t\t\t\tn = self[START_CONTAINER];\n\t\t\t\t\tstart = self[START_OFFSET];\n\t\t\t\t\tlen = self[END_OFFSET] - self[START_OFFSET];\n\n\t\t\t\t\tif (start === 0 && len >= n.nodeValue.length - 1) {\n\t\t\t\t\t\tn.parentNode.removeChild(n);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tn.deleteData(start, len);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Nothing is partially selected, so collapse to start point\n\t\t\t\t\tself.collapse(TRUE);\n\t\t\t\t}\n\n\t\t\t\tif (how == DELETE) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (sub.length > 0) {\n\t\t\t\t\tfrag.appendChild(doc.createTextNode(sub));\n\t\t\t\t}\n\n\t\t\t\treturn frag;\n\t\t\t}\n\n\t\t\t// Copy nodes between the start/end offsets.\n\t\t\tn = _getSelectedNode(self[START_CONTAINER], self[START_OFFSET]);\n\t\t\tcnt = self[END_OFFSET] - self[START_OFFSET];\n\n\t\t\twhile (n && cnt > 0) {\n\t\t\t\tsibling = n.nextSibling;\n\t\t\t\txferNode = _traverseFullySelected(n, how);\n\n\t\t\t\tif (frag) {\n\t\t\t\t\tfrag.appendChild(xferNode);\n\t\t\t\t}\n\n\t\t\t\t--cnt;\n\t\t\t\tn = sibling;\n\t\t\t}\n\n\t\t\t// Nothing is partially selected, so collapse to start point\n\t\t\tif (how != CLONE) {\n\t\t\t\tself.collapse(TRUE);\n\t\t\t}\n\n\t\t\treturn frag;\n\t\t}\n\n\t\tfunction _traverseCommonStartContainer(endAncestor, how) {\n\t\t\tvar frag, n, endIdx, cnt, sibling, xferNode;\n\n\t\t\tif (how != DELETE) {\n\t\t\t\tfrag = createDocumentFragment();\n\t\t\t}\n\n\t\t\tn = _traverseRightBoundary(endAncestor, how);\n\n\t\t\tif (frag) {\n\t\t\t\tfrag.appendChild(n);\n\t\t\t}\n\n\t\t\tendIdx = nodeIndex(endAncestor);\n\t\t\tcnt = endIdx - self[START_OFFSET];\n\n\t\t\tif (cnt <= 0) {\n\t\t\t\t// Collapse to just before the endAncestor, which\n\t\t\t\t// is partially selected.\n\t\t\t\tif (how != CLONE) {\n\t\t\t\t\tself.setEndBefore(endAncestor);\n\t\t\t\t\tself.collapse(FALSE);\n\t\t\t\t}\n\n\t\t\t\treturn frag;\n\t\t\t}\n\n\t\t\tn = endAncestor.previousSibling;\n\t\t\twhile (cnt > 0) {\n\t\t\t\tsibling = n.previousSibling;\n\t\t\t\txferNode = _traverseFullySelected(n, how);\n\n\t\t\t\tif (frag) {\n\t\t\t\t\tfrag.insertBefore(xferNode, frag.firstChild);\n\t\t\t\t}\n\n\t\t\t\t--cnt;\n\t\t\t\tn = sibling;\n\t\t\t}\n\n\t\t\t// Collapse to just before the endAncestor, which\n\t\t\t// is partially selected.\n\t\t\tif (how != CLONE) {\n\t\t\t\tself.setEndBefore(endAncestor);\n\t\t\t\tself.collapse(FALSE);\n\t\t\t}\n\n\t\t\treturn frag;\n\t\t}\n\n\t\tfunction _traverseCommonEndContainer(startAncestor, how) {\n\t\t\tvar frag, startIdx, n, cnt, sibling, xferNode;\n\n\t\t\tif (how != DELETE) {\n\t\t\t\tfrag = createDocumentFragment();\n\t\t\t}\n\n\t\t\tn = _traverseLeftBoundary(startAncestor, how);\n\t\t\tif (frag) {\n\t\t\t\tfrag.appendChild(n);\n\t\t\t}\n\n\t\t\tstartIdx = nodeIndex(startAncestor);\n\t\t\t++startIdx; // Because we already traversed it\n\n\t\t\tcnt = self[END_OFFSET] - startIdx;\n\t\t\tn = startAncestor.nextSibling;\n\t\t\twhile (n && cnt > 0) {\n\t\t\t\tsibling = n.nextSibling;\n\t\t\t\txferNode = _traverseFullySelected(n, how);\n\n\t\t\t\tif (frag) {\n\t\t\t\t\tfrag.appendChild(xferNode);\n\t\t\t\t}\n\n\t\t\t\t--cnt;\n\t\t\t\tn = sibling;\n\t\t\t}\n\n\t\t\tif (how != CLONE) {\n\t\t\t\tself.setStartAfter(startAncestor);\n\t\t\t\tself.collapse(TRUE);\n\t\t\t}\n\n\t\t\treturn frag;\n\t\t}\n\n\t\tfunction _traverseCommonAncestors(startAncestor, endAncestor, how) {\n\t\t\tvar n, frag, startOffset, endOffset, cnt, sibling, nextSibling;\n\n\t\t\tif (how != DELETE) {\n\t\t\t\tfrag = createDocumentFragment();\n\t\t\t}\n\n\t\t\tn = _traverseLeftBoundary(startAncestor, how);\n\t\t\tif (frag) {\n\t\t\t\tfrag.appendChild(n);\n\t\t\t}\n\n\t\t\tstartOffset = nodeIndex(startAncestor);\n\t\t\tendOffset = nodeIndex(endAncestor);\n\t\t\t++startOffset;\n\n\t\t\tcnt = endOffset - startOffset;\n\t\t\tsibling = startAncestor.nextSibling;\n\n\t\t\twhile (cnt > 0) {\n\t\t\t\tnextSibling = sibling.nextSibling;\n\t\t\t\tn = _traverseFullySelected(sibling, how);\n\n\t\t\t\tif (frag) {\n\t\t\t\t\tfrag.appendChild(n);\n\t\t\t\t}\n\n\t\t\t\tsibling = nextSibling;\n\t\t\t\t--cnt;\n\t\t\t}\n\n\t\t\tn = _traverseRightBoundary(endAncestor, how);\n\n\t\t\tif (frag) {\n\t\t\t\tfrag.appendChild(n);\n\t\t\t}\n\n\t\t\tif (how != CLONE) {\n\t\t\t\tself.setStartAfter(startAncestor);\n\t\t\t\tself.collapse(TRUE);\n\t\t\t}\n\n\t\t\treturn frag;\n\t\t}\n\n\t\tfunction _traverseRightBoundary(root, how) {\n\t\t\tvar next = _getSelectedNode(self[END_CONTAINER], self[END_OFFSET] - 1), parent, clonedParent;\n\t\t\tvar prevSibling, clonedChild, clonedGrandParent, isFullySelected = next != self[END_CONTAINER];\n\n\t\t\tif (next == root) {\n\t\t\t\treturn _traverseNode(next, isFullySelected, FALSE, how);\n\t\t\t}\n\n\t\t\tparent = next.parentNode;\n\t\t\tclonedParent = _traverseNode(parent, FALSE, FALSE, how);\n\n\t\t\twhile (parent) {\n\t\t\t\twhile (next) {\n\t\t\t\t\tprevSibling = next.previousSibling;\n\t\t\t\t\tclonedChild = _traverseNode(next, isFullySelected, FALSE, how);\n\n\t\t\t\t\tif (how != DELETE) {\n\t\t\t\t\t\tclonedParent.insertBefore(clonedChild, clonedParent.firstChild);\n\t\t\t\t\t}\n\n\t\t\t\t\tisFullySelected = TRUE;\n\t\t\t\t\tnext = prevSibling;\n\t\t\t\t}\n\n\t\t\t\tif (parent == root) {\n\t\t\t\t\treturn clonedParent;\n\t\t\t\t}\n\n\t\t\t\tnext = parent.previousSibling;\n\t\t\t\tparent = parent.parentNode;\n\n\t\t\t\tclonedGrandParent = _traverseNode(parent, FALSE, FALSE, how);\n\n\t\t\t\tif (how != DELETE) {\n\t\t\t\t\tclonedGrandParent.appendChild(clonedParent);\n\t\t\t\t}\n\n\t\t\t\tclonedParent = clonedGrandParent;\n\t\t\t}\n\t\t}\n\n\t\tfunction _traverseLeftBoundary(root, how) {\n\t\t\tvar next = _getSelectedNode(self[START_CONTAINER], self[START_OFFSET]), isFullySelected = next != self[START_CONTAINER];\n\t\t\tvar parent, clonedParent, nextSibling, clonedChild, clonedGrandParent;\n\n\t\t\tif (next == root) {\n\t\t\t\treturn _traverseNode(next, isFullySelected, TRUE, how);\n\t\t\t}\n\n\t\t\tparent = next.parentNode;\n\t\t\tclonedParent = _traverseNode(parent, FALSE, TRUE, how);\n\n\t\t\twhile (parent) {\n\t\t\t\twhile (next) {\n\t\t\t\t\tnextSibling = next.nextSibling;\n\t\t\t\t\tclonedChild = _traverseNode(next, isFullySelected, TRUE, how);\n\n\t\t\t\t\tif (how != DELETE) {\n\t\t\t\t\t\tclonedParent.appendChild(clonedChild);\n\t\t\t\t\t}\n\n\t\t\t\t\tisFullySelected = TRUE;\n\t\t\t\t\tnext = nextSibling;\n\t\t\t\t}\n\n\t\t\t\tif (parent == root) {\n\t\t\t\t\treturn clonedParent;\n\t\t\t\t}\n\n\t\t\t\tnext = parent.nextSibling;\n\t\t\t\tparent = parent.parentNode;\n\n\t\t\t\tclonedGrandParent = _traverseNode(parent, FALSE, TRUE, how);\n\n\t\t\t\tif (how != DELETE) {\n\t\t\t\t\tclonedGrandParent.appendChild(clonedParent);\n\t\t\t\t}\n\n\t\t\t\tclonedParent = clonedGrandParent;\n\t\t\t}\n\t\t}\n\n\t\tfunction _traverseNode(n, isFullySelected, isLeft, how) {\n\t\t\tvar txtValue, newNodeValue, oldNodeValue, offset, newNode;\n\n\t\t\tif (isFullySelected) {\n\t\t\t\treturn _traverseFullySelected(n, how);\n\t\t\t}\n\n\t\t\t// TEXT_NODE\n\t\t\tif (n.nodeType == 3) {\n\t\t\t\ttxtValue = n.nodeValue;\n\n\t\t\t\tif (isLeft) {\n\t\t\t\t\toffset = self[START_OFFSET];\n\t\t\t\t\tnewNodeValue = txtValue.substring(offset);\n\t\t\t\t\toldNodeValue = txtValue.substring(0, offset);\n\t\t\t\t} else {\n\t\t\t\t\toffset = self[END_OFFSET];\n\t\t\t\t\tnewNodeValue = txtValue.substring(0, offset);\n\t\t\t\t\toldNodeValue = txtValue.substring(offset);\n\t\t\t\t}\n\n\t\t\t\tif (how != CLONE) {\n\t\t\t\t\tn.nodeValue = oldNodeValue;\n\t\t\t\t}\n\n\t\t\t\tif (how == DELETE) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tnewNode = dom.clone(n, FALSE);\n\t\t\t\tnewNode.nodeValue = newNodeValue;\n\n\t\t\t\treturn newNode;\n\t\t\t}\n\n\t\t\tif (how == DELETE) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn dom.clone(n, FALSE);\n\t\t}\n\n\t\tfunction _traverseFullySelected(n, how) {\n\t\t\tif (how != DELETE) {\n\t\t\t\treturn how == CLONE ? dom.clone(n, TRUE) : n;\n\t\t\t}\n\n\t\t\tn.parentNode.removeChild(n);\n\t\t}\n\n\t\tfunction toStringIE() {\n\t\t\treturn dom.create('body', null, cloneContents()).outerText;\n\t\t}\n\n\t\textend(self, {\n\t\t\t// Initial states\n\t\t\tstartContainer: doc,\n\t\t\tstartOffset: 0,\n\t\t\tendContainer: doc,\n\t\t\tendOffset: 0,\n\t\t\tcollapsed: TRUE,\n\t\t\tcommonAncestorContainer: doc,\n\n\t\t\t// Range constants\n\t\t\tSTART_TO_START: 0,\n\t\t\tSTART_TO_END: 1,\n\t\t\tEND_TO_END: 2,\n\t\t\tEND_TO_START: 3,\n\n\t\t\t// Public methods\n\t\t\tsetStart: setStart,\n\t\t\tsetEnd: setEnd,\n\t\t\tsetStartBefore: setStartBefore,\n\t\t\tsetStartAfter: setStartAfter,\n\t\t\tsetEndBefore: setEndBefore,\n\t\t\tsetEndAfter: setEndAfter,\n\t\t\tcollapse: collapse,\n\t\t\tselectNode: selectNode,\n\t\t\tselectNodeContents: selectNodeContents,\n\t\t\tcompareBoundaryPoints: compareBoundaryPoints,\n\t\t\tdeleteContents: deleteContents,\n\t\t\textractContents: extractContents,\n\t\t\tcloneContents: cloneContents,\n\t\t\tinsertNode: insertNode,\n\t\t\tsurroundContents: surroundContents,\n\t\t\tcloneRange: cloneRange,\n\t\t\ttoStringIE: toStringIE\n\t\t});\n\n\t\treturn self;\n\t}\n\n\t// Older IE versions doesn't let you override toString by it's constructor so we have to stick it in the prototype\n\tRange.prototype.toString = function() {\n\t\treturn this.toStringIE();\n\t};\n\n\treturn Range;\n});\n\n// Included from: js/tinymce/classes/html/Entities.js\n\n/**\n * Entities.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*jshint bitwise:false */\n/*eslint no-bitwise:0 */\n\n/**\n * Entity encoder class.\n *\n * @class tinymce.html.Entities\n * @static\n * @version 3.4\n */\ndefine(\"tinymce/html/Entities\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\tvar makeMap = Tools.makeMap;\n\n\tvar namedEntities, baseEntities, reverseEntities,\n\t\tattrsCharsRegExp = /[&<>\\\"\\u0060\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g,\n\t\ttextCharsRegExp = /[<>&\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g,\n\t\trawCharsRegExp = /[<>&\\\"\\']/g,\n\t\tentityRegExp = /&#([a-z0-9]+);?|&([a-z0-9]+);/gi,\n\t\tasciiMap = {\n\t\t\t128: \"\\u20AC\", 130: \"\\u201A\", 131: \"\\u0192\", 132: \"\\u201E\", 133: \"\\u2026\", 134: \"\\u2020\",\n\t\t\t135: \"\\u2021\", 136: \"\\u02C6\", 137: \"\\u2030\", 138: \"\\u0160\", 139: \"\\u2039\", 140: \"\\u0152\",\n\t\t\t142: \"\\u017D\", 145: \"\\u2018\", 146: \"\\u2019\", 147: \"\\u201C\", 148: \"\\u201D\", 149: \"\\u2022\",\n\t\t\t150: \"\\u2013\", 151: \"\\u2014\", 152: \"\\u02DC\", 153: \"\\u2122\", 154: \"\\u0161\", 155: \"\\u203A\",\n\t\t\t156: \"\\u0153\", 158: \"\\u017E\", 159: \"\\u0178\"\n\t\t};\n\n\t// Raw entities\n\tbaseEntities = {\n\t\t'\\\"': '&quot;', // Needs to be escaped since the YUI compressor would otherwise break the code\n\t\t\"'\": '&#39;',\n\t\t'<': '&lt;',\n\t\t'>': '&gt;',\n\t\t'&': '&amp;',\n\t\t'\\u0060': '&#96;'\n\t};\n\n\t// Reverse lookup table for raw entities\n\treverseEntities = {\n\t\t'&lt;': '<',\n\t\t'&gt;': '>',\n\t\t'&amp;': '&',\n\t\t'&quot;': '\"',\n\t\t'&apos;': \"'\"\n\t};\n\n\t// Decodes text by using the browser\n\tfunction nativeDecode(text) {\n\t\tvar elm;\n\n\t\telm = document.createElement(\"div\");\n\t\telm.innerHTML = text;\n\n\t\treturn elm.textContent || elm.innerText || text;\n\t}\n\n\t// Build a two way lookup table for the entities\n\tfunction buildEntitiesLookup(items, radix) {\n\t\tvar i, chr, entity, lookup = {};\n\n\t\tif (items) {\n\t\t\titems = items.split(',');\n\t\t\tradix = radix || 10;\n\n\t\t\t// Build entities lookup table\n\t\t\tfor (i = 0; i < items.length; i += 2) {\n\t\t\t\tchr = String.fromCharCode(parseInt(items[i], radix));\n\n\t\t\t\t// Only add non base entities\n\t\t\t\tif (!baseEntities[chr]) {\n\t\t\t\t\tentity = '&' + items[i + 1] + ';';\n\t\t\t\t\tlookup[chr] = entity;\n\t\t\t\t\tlookup[entity] = chr;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn lookup;\n\t\t}\n\t}\n\n\t// Unpack entities lookup where the numbers are in radix 32 to reduce the size\n\tnamedEntities = buildEntitiesLookup(\n\t\t'50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' +\n\t\t'5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' +\n\t\t'5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' +\n\t\t'5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' +\n\t\t'68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' +\n\t\t'6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' +\n\t\t'6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' +\n\t\t'75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' +\n\t\t'7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' +\n\t\t'7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' +\n\t\t'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' +\n\t\t'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' +\n\t\t't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' +\n\t\t'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' +\n\t\t'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' +\n\t\t'81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' +\n\t\t'8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' +\n\t\t'8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' +\n\t\t'8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' +\n\t\t'8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' +\n\t\t'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' +\n\t\t'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' +\n\t\t'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' +\n\t\t'80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' +\n\t\t'811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);\n\n\tvar Entities = {\n\t\t/**\n\t\t * Encodes the specified string using raw entities. This means only the required XML base entities will be encoded.\n\t\t *\n\t\t * @method encodeRaw\n\t\t * @param {String} text Text to encode.\n\t\t * @param {Boolean} attr Optional flag to specify if the text is attribute contents.\n\t\t * @return {String} Entity encoded text.\n\t\t */\n\t\tencodeRaw: function(text, attr) {\n\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\n\t\t\t\treturn baseEntities[chr] || chr;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Encoded the specified text with both the attributes and text entities. This function will produce larger text contents\n\t\t * since it doesn't know if the context is within a attribute or text node. This was added for compatibility\n\t\t * and is exposed as the DOMUtils.encode function.\n\t\t *\n\t\t * @method encodeAllRaw\n\t\t * @param {String} text Text to encode.\n\t\t * @return {String} Entity encoded text.\n\t\t */\n\t\tencodeAllRaw: function(text) {\n\t\t\treturn ('' + text).replace(rawCharsRegExp, function(chr) {\n\t\t\t\treturn baseEntities[chr] || chr;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Encodes the specified string using numeric entities. The core entities will be\n\t\t * encoded as named ones but all non lower ascii characters will be encoded into numeric entities.\n\t\t *\n\t\t * @method encodeNumeric\n\t\t * @param {String} text Text to encode.\n\t\t * @param {Boolean} attr Optional flag to specify if the text is attribute contents.\n\t\t * @return {String} Entity encoded text.\n\t\t */\n\t\tencodeNumeric: function(text, attr) {\n\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\n\t\t\t\t// Multi byte sequence convert it to a single entity\n\t\t\t\tif (chr.length > 1) {\n\t\t\t\t\treturn '&#' + (((chr.charCodeAt(0) - 0xD800) * 0x400) + (chr.charCodeAt(1) - 0xDC00) + 0x10000) + ';';\n\t\t\t\t}\n\n\t\t\t\treturn baseEntities[chr] || '&#' + chr.charCodeAt(0) + ';';\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Encodes the specified string using named entities. The core entities will be encoded\n\t\t * as named ones but all non lower ascii characters will be encoded into named entities.\n\t\t *\n\t\t * @method encodeNamed\n\t\t * @param {String} text Text to encode.\n\t\t * @param {Boolean} attr Optional flag to specify if the text is attribute contents.\n\t\t * @param {Object} entities Optional parameter with entities to use.\n\t\t * @return {String} Entity encoded text.\n\t\t */\n\t\tencodeNamed: function(text, attr, entities) {\n\t\t\tentities = entities || namedEntities;\n\n\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\n\t\t\t\treturn baseEntities[chr] || entities[chr] || chr;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns an encode function based on the name(s) and it's optional entities.\n\t\t *\n\t\t * @method getEncodeFunc\n\t\t * @param {String} name Comma separated list of encoders for example named,numeric.\n\t\t * @param {String} entities Optional parameter with entities to use instead of the built in set.\n\t\t * @return {function} Encode function to be used.\n\t\t */\n\t\tgetEncodeFunc: function(name, entities) {\n\t\t\tentities = buildEntitiesLookup(entities) || namedEntities;\n\n\t\t\tfunction encodeNamedAndNumeric(text, attr) {\n\t\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\n\t\t\t\t\treturn baseEntities[chr] || entities[chr] || '&#' + chr.charCodeAt(0) + ';' || chr;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction encodeCustomNamed(text, attr) {\n\t\t\t\treturn Entities.encodeNamed(text, attr, entities);\n\t\t\t}\n\n\t\t\t// Replace + with , to be compatible with previous TinyMCE versions\n\t\t\tname = makeMap(name.replace(/\\+/g, ','));\n\n\t\t\t// Named and numeric encoder\n\t\t\tif (name.named && name.numeric) {\n\t\t\t\treturn encodeNamedAndNumeric;\n\t\t\t}\n\n\t\t\t// Named encoder\n\t\t\tif (name.named) {\n\t\t\t\t// Custom names\n\t\t\t\tif (entities) {\n\t\t\t\t\treturn encodeCustomNamed;\n\t\t\t\t}\n\n\t\t\t\treturn Entities.encodeNamed;\n\t\t\t}\n\n\t\t\t// Numeric\n\t\t\tif (name.numeric) {\n\t\t\t\treturn Entities.encodeNumeric;\n\t\t\t}\n\n\t\t\t// Raw encoder\n\t\t\treturn Entities.encodeRaw;\n\t\t},\n\n\t\t/**\n\t\t * Decodes the specified string, this will replace entities with raw UTF characters.\n\t\t *\n\t\t * @method decode\n\t\t * @param {String} text Text to entity decode.\n\t\t * @return {String} Entity decoded string.\n\t\t */\n\t\tdecode: function(text) {\n\t\t\treturn text.replace(entityRegExp, function(all, numeric) {\n\t\t\t\tif (numeric) {\n\t\t\t\t\tif (numeric.charAt(0).toLowerCase() === 'x') {\n\t\t\t\t\t\tnumeric = parseInt(numeric.substr(1), 16);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnumeric = parseInt(numeric, 10);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Support upper UTF\n\t\t\t\t\tif (numeric > 0xFFFF) {\n\t\t\t\t\t\tnumeric -= 0x10000;\n\n\t\t\t\t\t\treturn String.fromCharCode(0xD800 + (numeric >> 10), 0xDC00 + (numeric & 0x3FF));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn asciiMap[numeric] || String.fromCharCode(numeric);\n\t\t\t\t}\n\n\t\t\t\treturn reverseEntities[all] || namedEntities[all] || nativeDecode(all);\n\t\t\t});\n\t\t}\n\t};\n\n\treturn Entities;\n});\n\n// Included from: js/tinymce/classes/dom/StyleSheetLoader.js\n\n/**\n * StyleSheetLoader.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles loading of external stylesheets and fires events when these are loaded.\n *\n * @class tinymce.dom.StyleSheetLoader\n * @private\n */\ndefine(\"tinymce/dom/StyleSheetLoader\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Delay\"\n], function(Tools, Delay) {\n\t\"use strict\";\n\n\treturn function(document, settings) {\n\t\tvar idCount = 0, loadedStates = {}, maxLoadTime;\n\n\t\tsettings = settings || {};\n\t\tmaxLoadTime = settings.maxLoadTime || 5000;\n\n\t\tfunction appendToHead(node) {\n\t\t\tdocument.getElementsByTagName('head')[0].appendChild(node);\n\t\t}\n\n\t\t/**\n\t\t * Loads the specified css style sheet file and call the loadedCallback once it's finished loading.\n\t\t *\n\t\t * @method load\n\t\t * @param {String} url Url to be loaded.\n\t\t * @param {Function} loadedCallback Callback to be executed when loaded.\n\t\t * @param {Function} errorCallback Callback to be executed when failed loading.\n\t\t */\n\t\tfunction load(url, loadedCallback, errorCallback) {\n\t\t\tvar link, style, startTime, state;\n\n\t\t\tfunction passed() {\n\t\t\t\tvar callbacks = state.passed, i = callbacks.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tcallbacks[i]();\n\t\t\t\t}\n\n\t\t\t\tstate.status = 2;\n\t\t\t\tstate.passed = [];\n\t\t\t\tstate.failed = [];\n\t\t\t}\n\n\t\t\tfunction failed() {\n\t\t\t\tvar callbacks = state.failed, i = callbacks.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tcallbacks[i]();\n\t\t\t\t}\n\n\t\t\t\tstate.status = 3;\n\t\t\t\tstate.passed = [];\n\t\t\t\tstate.failed = [];\n\t\t\t}\n\n\t\t\t// Sniffs for older WebKit versions that have the link.onload but a broken one\n\t\t\tfunction isOldWebKit() {\n\t\t\t\tvar webKitChunks = navigator.userAgent.match(/WebKit\\/(\\d*)/);\n\t\t\t\treturn !!(webKitChunks && webKitChunks[1] < 536);\n\t\t\t}\n\n\t\t\t// Calls the waitCallback until the test returns true or the timeout occurs\n\t\t\tfunction wait(testCallback, waitCallback) {\n\t\t\t\tif (!testCallback()) {\n\t\t\t\t\t// Wait for timeout\n\t\t\t\t\tif ((new Date().getTime()) - startTime < maxLoadTime) {\n\t\t\t\t\t\tDelay.setTimeout(waitCallback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfailed();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Workaround for WebKit that doesn't properly support the onload event for link elements\n\t\t\t// Or WebKit that fires the onload event before the StyleSheet is added to the document\n\t\t\tfunction waitForWebKitLinkLoaded() {\n\t\t\t\twait(function() {\n\t\t\t\t\tvar styleSheets = document.styleSheets, styleSheet, i = styleSheets.length, owner;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tstyleSheet = styleSheets[i];\n\t\t\t\t\t\towner = styleSheet.ownerNode ? styleSheet.ownerNode : styleSheet.owningElement;\n\t\t\t\t\t\tif (owner && owner.id === link.id) {\n\t\t\t\t\t\t\tpassed();\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, waitForWebKitLinkLoaded);\n\t\t\t}\n\n\t\t\t// Workaround for older Geckos that doesn't have any onload event for StyleSheets\n\t\t\tfunction waitForGeckoLinkLoaded() {\n\t\t\t\twait(function() {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Accessing the cssRules will throw an exception until the CSS file is loaded\n\t\t\t\t\t\tvar cssRules = style.sheet.cssRules;\n\t\t\t\t\t\tpassed();\n\t\t\t\t\t\treturn !!cssRules;\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// Ignore\n\t\t\t\t\t}\n\t\t\t\t}, waitForGeckoLinkLoaded);\n\t\t\t}\n\n\t\t\turl = Tools._addCacheSuffix(url);\n\n\t\t\tif (!loadedStates[url]) {\n\t\t\t\tstate = {\n\t\t\t\t\tpassed: [],\n\t\t\t\t\tfailed: []\n\t\t\t\t};\n\n\t\t\t\tloadedStates[url] = state;\n\t\t\t} else {\n\t\t\t\tstate = loadedStates[url];\n\t\t\t}\n\n\t\t\tif (loadedCallback) {\n\t\t\t\tstate.passed.push(loadedCallback);\n\t\t\t}\n\n\t\t\tif (errorCallback) {\n\t\t\t\tstate.failed.push(errorCallback);\n\t\t\t}\n\n\t\t\t// Is loading wait for it to pass\n\t\t\tif (state.status == 1) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Has finished loading and was success\n\t\t\tif (state.status == 2) {\n\t\t\t\tpassed();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Has finished loading and was a failure\n\t\t\tif (state.status == 3) {\n\t\t\t\tfailed();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Start loading\n\t\t\tstate.status = 1;\n\t\t\tlink = document.createElement('link');\n\t\t\tlink.rel = 'stylesheet';\n\t\t\tlink.type = 'text/css';\n\t\t\tlink.id = 'u' + (idCount++);\n\t\t\tlink.async = false;\n\t\t\tlink.defer = false;\n\t\t\tstartTime = new Date().getTime();\n\n\t\t\t// Feature detect onload on link element and sniff older webkits since it has an broken onload event\n\t\t\tif (\"onload\" in link && !isOldWebKit()) {\n\t\t\t\tlink.onload = waitForWebKitLinkLoaded;\n\t\t\t\tlink.onerror = failed;\n\t\t\t} else {\n\t\t\t\t// Sniff for old Firefox that doesn't support the onload event on link elements\n\t\t\t\t// TODO: Remove this in the future when everyone uses modern browsers\n\t\t\t\tif (navigator.userAgent.indexOf(\"Firefox\") > 0) {\n\t\t\t\t\tstyle = document.createElement('style');\n\t\t\t\t\tstyle.textContent = '@import \"' + url + '\"';\n\t\t\t\t\twaitForGeckoLinkLoaded();\n\t\t\t\t\tappendToHead(style);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Use the id owner on older webkits\n\t\t\t\twaitForWebKitLinkLoaded();\n\t\t\t}\n\n\t\t\tappendToHead(link);\n\t\t\tlink.href = url;\n\t\t}\n\n\t\tthis.load = load;\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/DOMUtils.js\n\n/**\n * DOMUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility class for various DOM manipulation and retrieval functions.\n *\n * @class tinymce.dom.DOMUtils\n * @example\n * // Add a class to an element by id in the page\n * tinymce.DOM.addClass('someid', 'someclass');\n *\n * // Add a class to an element by id inside the editor\n * tinymce.activeEditor.dom.addClass('someid', 'someclass');\n */\ndefine(\"tinymce/dom/DOMUtils\", [\n\t\"tinymce/dom/Sizzle\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/html/Styles\",\n\t\"tinymce/dom/EventUtils\",\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/Range\",\n\t\"tinymce/html/Entities\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/dom/StyleSheetLoader\"\n], function(Sizzle, $, Styles, EventUtils, TreeWalker, Range, Entities, Env, Tools, StyleSheetLoader) {\n\t// Shorten names\n\tvar each = Tools.each, is = Tools.is, grep = Tools.grep, trim = Tools.trim;\n\tvar isIE = Env.ie;\n\tvar simpleSelectorRe = /^([a-z0-9],?)+$/i;\n\tvar whiteSpaceRegExp = /^[ \\t\\r\\n]*$/;\n\n\tfunction setupAttrHooks(domUtils, settings) {\n\t\tvar attrHooks = {}, keepValues = settings.keep_values, keepUrlHook;\n\n\t\tkeepUrlHook = {\n\t\t\tset: function($elm, value, name) {\n\t\t\t\tif (settings.url_converter) {\n\t\t\t\t\tvalue = settings.url_converter.call(settings.url_converter_scope || domUtils, value, name, $elm[0]);\n\t\t\t\t}\n\n\t\t\t\t$elm.attr('data-mce-' + name, value).attr(name, value);\n\t\t\t},\n\n\t\t\tget: function($elm, name) {\n\t\t\t\treturn $elm.attr('data-mce-' + name) || $elm.attr(name);\n\t\t\t}\n\t\t};\n\n\t\tattrHooks = {\n\t\t\tstyle: {\n\t\t\t\tset: function($elm, value) {\n\t\t\t\t\tif (value !== null && typeof value === 'object') {\n\t\t\t\t\t\t$elm.css(value);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (keepValues) {\n\t\t\t\t\t\t$elm.attr('data-mce-style', value);\n\t\t\t\t\t}\n\n\t\t\t\t\t$elm.attr('style', value);\n\t\t\t\t},\n\n\t\t\t\tget: function($elm) {\n\t\t\t\t\tvar value = $elm.attr('data-mce-style') || $elm.attr('style');\n\n\t\t\t\t\tvalue = domUtils.serializeStyle(domUtils.parseStyle(value), $elm[0].nodeName);\n\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (keepValues) {\n\t\t\tattrHooks.href = attrHooks.src = keepUrlHook;\n\t\t}\n\n\t\treturn attrHooks;\n\t}\n\n\tfunction updateInternalStyleAttr(domUtils, $elm) {\n\t\tvar value = $elm.attr('style');\n\n\t\tvalue = domUtils.serializeStyle(domUtils.parseStyle(value), $elm[0].nodeName);\n\n\t\tif (!value) {\n\t\t\tvalue = null;\n\t\t}\n\n\t\t$elm.attr('data-mce-style', value);\n\t}\n\n\tfunction nodeIndex(node, normalized) {\n\t\tvar idx = 0, lastNodeType, nodeType;\n\n\t\tif (node) {\n\t\t\tfor (lastNodeType = node.nodeType, node = node.previousSibling; node; node = node.previousSibling) {\n\t\t\t\tnodeType = node.nodeType;\n\n\t\t\t\t// Normalize text nodes\n\t\t\t\tif (normalized && nodeType == 3) {\n\t\t\t\t\tif (nodeType == lastNodeType || !node.nodeValue.length) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tidx++;\n\t\t\t\tlastNodeType = nodeType;\n\t\t\t}\n\t\t}\n\n\t\treturn idx;\n\t}\n\n\t/**\n\t * Constructs a new DOMUtils instance. Consult the Wiki for more details on settings etc for this class.\n\t *\n\t * @constructor\n\t * @method DOMUtils\n\t * @param {Document} doc Document reference to bind the utility class to.\n\t * @param {settings} settings Optional settings collection.\n\t */\n\tfunction DOMUtils(doc, settings) {\n\t\tvar self = this, blockElementsMap;\n\n\t\tself.doc = doc;\n\t\tself.win = window;\n\t\tself.files = {};\n\t\tself.counter = 0;\n\t\tself.stdMode = !isIE || doc.documentMode >= 8;\n\t\tself.boxModel = !isIE || doc.compatMode == \"CSS1Compat\" || self.stdMode;\n\t\tself.styleSheetLoader = new StyleSheetLoader(doc);\n\t\tself.boundEvents = [];\n\t\tself.settings = settings = settings || {};\n\t\tself.schema = settings.schema;\n\t\tself.styles = new Styles({\n\t\t\turl_converter: settings.url_converter,\n\t\t\turl_converter_scope: settings.url_converter_scope\n\t\t}, settings.schema);\n\n\t\tself.fixDoc(doc);\n\t\tself.events = settings.ownEvents ? new EventUtils(settings.proxy) : EventUtils.Event;\n\t\tself.attrHooks = setupAttrHooks(self, settings);\n\t\tblockElementsMap = settings.schema ? settings.schema.getBlockElements() : {};\n\t\tself.$ = $.overrideDefaults(function() {\n\t\t\treturn {\n\t\t\t\tcontext: doc,\n\t\t\t\telement: self.getRoot()\n\t\t\t};\n\t\t});\n\n\t\t/**\n\t\t * Returns true/false if the specified element is a block element or not.\n\t\t *\n\t\t * @method isBlock\n\t\t * @param {Node/String} node Element/Node to check.\n\t\t * @return {Boolean} True/False state if the node is a block element or not.\n\t\t */\n\t\tself.isBlock = function(node) {\n\t\t\t// Fix for #5446\n\t\t\tif (!node) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// This function is called in module pattern style since it might be executed with the wrong this scope\n\t\t\tvar type = node.nodeType;\n\n\t\t\t// If it's a node then check the type and use the nodeName\n\t\t\tif (type) {\n\t\t\t\treturn !!(type === 1 && blockElementsMap[node.nodeName]);\n\t\t\t}\n\n\t\t\treturn !!blockElementsMap[node];\n\t\t};\n\t}\n\n\tDOMUtils.prototype = {\n\t\t$$: function(elm) {\n\t\t\tif (typeof elm == 'string') {\n\t\t\t\telm = this.get(elm);\n\t\t\t}\n\n\t\t\treturn this.$(elm);\n\t\t},\n\n\t\troot: null,\n\n\t\tfixDoc: function(doc) {\n\t\t\tvar settings = this.settings, name;\n\n\t\t\tif (isIE && settings.schema) {\n\t\t\t\t// Add missing HTML 4/5 elements to IE\n\t\t\t\t('abbr article aside audio canvas ' +\n\t\t\t\t'details figcaption figure footer ' +\n\t\t\t\t'header hgroup mark menu meter nav ' +\n\t\t\t\t'output progress section summary ' +\n\t\t\t\t'time video').replace(/\\w+/g, function(name) {\n\t\t\t\t\tdoc.createElement(name);\n\t\t\t\t});\n\n\t\t\t\t// Create all custom elements\n\t\t\t\tfor (name in settings.schema.getCustomElements()) {\n\t\t\t\t\tdoc.createElement(name);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tclone: function(node, deep) {\n\t\t\tvar self = this, clone, doc;\n\n\t\t\t// TODO: Add feature detection here in the future\n\t\t\tif (!isIE || node.nodeType !== 1 || deep) {\n\t\t\t\treturn node.cloneNode(deep);\n\t\t\t}\n\n\t\t\tdoc = self.doc;\n\n\t\t\t// Make a HTML5 safe shallow copy\n\t\t\tif (!deep) {\n\t\t\t\tclone = doc.createElement(node.nodeName);\n\n\t\t\t\t// Copy attribs\n\t\t\t\teach(self.getAttribs(node), function(attr) {\n\t\t\t\t\tself.setAttrib(clone, attr.nodeName, self.getAttrib(node, attr.nodeName));\n\t\t\t\t});\n\n\t\t\t\treturn clone;\n\t\t\t}\n\n\t\t\treturn clone.firstChild;\n\t\t},\n\n\t\t/**\n\t\t * Returns the root node of the document. This is normally the body but might be a DIV. Parents like getParent will not\n\t\t * go above the point of this root node.\n\t\t *\n\t\t * @method getRoot\n\t\t * @return {Element} Root element for the utility class.\n\t\t */\n\t\tgetRoot: function() {\n\t\t\tvar self = this;\n\n\t\t\treturn self.settings.root_element || self.doc.body;\n\t\t},\n\n\t\t/**\n\t\t * Returns the viewport of the window.\n\t\t *\n\t\t * @method getViewPort\n\t\t * @param {Window} win Optional window to get viewport of.\n\t\t * @return {Object} Viewport object with fields x, y, w and h.\n\t\t */\n\t\tgetViewPort: function(win) {\n\t\t\tvar doc, rootElm;\n\n\t\t\twin = !win ? this.win : win;\n\t\t\tdoc = win.document;\n\t\t\trootElm = this.boxModel ? doc.documentElement : doc.body;\n\n\t\t\t// Returns viewport size excluding scrollbars\n\t\t\treturn {\n\t\t\t\tx: win.pageXOffset || rootElm.scrollLeft,\n\t\t\t\ty: win.pageYOffset || rootElm.scrollTop,\n\t\t\t\tw: win.innerWidth || rootElm.clientWidth,\n\t\t\t\th: win.innerHeight || rootElm.clientHeight\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Returns the rectangle for a specific element.\n\t\t *\n\t\t * @method getRect\n\t\t * @param {Element/String} elm Element object or element ID to get rectangle from.\n\t\t * @return {object} Rectangle for specified element object with x, y, w, h fields.\n\t\t */\n\t\tgetRect: function(elm) {\n\t\t\tvar self = this, pos, size;\n\n\t\t\telm = self.get(elm);\n\t\t\tpos = self.getPos(elm);\n\t\t\tsize = self.getSize(elm);\n\n\t\t\treturn {\n\t\t\t\tx: pos.x, y: pos.y,\n\t\t\t\tw: size.w, h: size.h\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Returns the size dimensions of the specified element.\n\t\t *\n\t\t * @method getSize\n\t\t * @param {Element/String} elm Element object or element ID to get rectangle from.\n\t\t * @return {object} Rectangle for specified element object with w, h fields.\n\t\t */\n\t\tgetSize: function(elm) {\n\t\t\tvar self = this, w, h;\n\n\t\t\telm = self.get(elm);\n\t\t\tw = self.getStyle(elm, 'width');\n\t\t\th = self.getStyle(elm, 'height');\n\n\t\t\t// Non pixel value, then force offset/clientWidth\n\t\t\tif (w.indexOf('px') === -1) {\n\t\t\t\tw = 0;\n\t\t\t}\n\n\t\t\t// Non pixel value, then force offset/clientWidth\n\t\t\tif (h.indexOf('px') === -1) {\n\t\t\t\th = 0;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tw: parseInt(w, 10) || elm.offsetWidth || elm.clientWidth,\n\t\t\t\th: parseInt(h, 10) || elm.offsetHeight || elm.clientHeight\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Returns a node by the specified selector function. This function will\n\t\t * loop through all parent nodes and call the specified function for each node.\n\t\t * If the function then returns true indicating that it has found what it was looking for, the loop execution will then end\n\t\t * and the node it found will be returned.\n\t\t *\n\t\t * @method getParent\n\t\t * @param {Node/String} node DOM node to search parents on or ID string.\n\t\t * @param {function} selector Selection function or CSS selector to execute on each node.\n\t\t * @param {Node} root Optional root element, never go beyond this point.\n\t\t * @return {Node} DOM Node or null if it wasn't found.\n\t\t */\n\t\tgetParent: function(node, selector, root) {\n\t\t\treturn this.getParents(node, selector, root, false);\n\t\t},\n\n\t\t/**\n\t\t * Returns a node list of all parents matching the specified selector function or pattern.\n\t\t * If the function then returns true indicating that it has found what it was looking for and that node will be collected.\n\t\t *\n\t\t * @method getParents\n\t\t * @param {Node/String} node DOM node to search parents on or ID string.\n\t\t * @param {function} selector Selection function to execute on each node or CSS pattern.\n\t\t * @param {Node} root Optional root element, never go beyond this point.\n\t\t * @return {Array} Array of nodes or null if it wasn't found.\n\t\t */\n\t\tgetParents: function(node, selector, root, collect) {\n\t\t\tvar self = this, selectorVal, result = [];\n\n\t\t\tnode = self.get(node);\n\t\t\tcollect = collect === undefined;\n\n\t\t\t// Default root on inline mode\n\t\t\troot = root || (self.getRoot().nodeName != 'BODY' ? self.getRoot().parentNode : null);\n\n\t\t\t// Wrap node name as func\n\t\t\tif (is(selector, 'string')) {\n\t\t\t\tselectorVal = selector;\n\n\t\t\t\tif (selector === '*') {\n\t\t\t\t\tselector = function(node) {\n\t\t\t\t\t\treturn node.nodeType == 1;\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tselector = function(node) {\n\t\t\t\t\t\treturn self.is(node, selectorVal);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile (node) {\n\t\t\t\tif (node == root || !node.nodeType || node.nodeType === 9) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!selector || selector(node)) {\n\t\t\t\t\tif (collect) {\n\t\t\t\t\t\tresult.push(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\treturn collect ? result : null;\n\t\t},\n\n\t\t/**\n\t\t * Returns the specified element by ID or the input element if it isn't a string.\n\t\t *\n\t\t * @method get\n\t\t * @param {String/Element} n Element id to look for or element to just pass though.\n\t\t * @return {Element} Element matching the specified id or null if it wasn't found.\n\t\t */\n\t\tget: function(elm) {\n\t\t\tvar name;\n\n\t\t\tif (elm && this.doc && typeof elm == 'string') {\n\t\t\t\tname = elm;\n\t\t\t\telm = this.doc.getElementById(elm);\n\n\t\t\t\t// IE and Opera returns meta elements when they match the specified input ID, but getElementsByName seems to do the trick\n\t\t\t\tif (elm && elm.id !== name) {\n\t\t\t\t\treturn this.doc.getElementsByName(name)[1];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn elm;\n\t\t},\n\n\t\t/**\n\t\t * Returns the next node that matches selector or function\n\t\t *\n\t\t * @method getNext\n\t\t * @param {Node} node Node to find siblings from.\n\t\t * @param {String/function} selector Selector CSS expression or function.\n\t\t * @return {Node} Next node item matching the selector or null if it wasn't found.\n\t\t */\n\t\tgetNext: function(node, selector) {\n\t\t\treturn this._findSib(node, selector, 'nextSibling');\n\t\t},\n\n\t\t/**\n\t\t * Returns the previous node that matches selector or function\n\t\t *\n\t\t * @method getPrev\n\t\t * @param {Node} node Node to find siblings from.\n\t\t * @param {String/function} selector Selector CSS expression or function.\n\t\t * @return {Node} Previous node item matching the selector or null if it wasn't found.\n\t\t */\n\t\tgetPrev: function(node, selector) {\n\t\t\treturn this._findSib(node, selector, 'previousSibling');\n\t\t},\n\n\t\t// #ifndef jquery\n\n\t\t/**\n\t\t * Selects specific elements by a CSS level 3 pattern. For example \"div#a1 p.test\".\n\t\t * This function is optimized for the most common patterns needed in TinyMCE but it also performs well enough\n\t\t * on more complex patterns.\n\t\t *\n\t\t * @method select\n\t\t * @param {String} selector CSS level 3 pattern to select/find elements by.\n\t\t * @param {Object} scope Optional root element/scope element to search in.\n\t\t * @return {Array} Array with all matched elements.\n\t\t * @example\n\t\t * // Adds a class to all paragraphs in the currently active editor\n\t\t * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'someclass');\n\t\t *\n\t\t * // Adds a class to all spans that have the test class in the currently active editor\n\t\t * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('span.test'), 'someclass')\n\t\t */\n\t\tselect: function(selector, scope) {\n\t\t\tvar self = this;\n\n\t\t\t/*eslint new-cap:0 */\n\t\t\treturn Sizzle(selector, self.get(scope) || self.settings.root_element || self.doc, []);\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the specified element matches the specified css pattern.\n\t\t *\n\t\t * @method is\n\t\t * @param {Node/NodeList} elm DOM node to match or an array of nodes to match.\n\t\t * @param {String} selector CSS pattern to match the element against.\n\t\t */\n\t\tis: function(elm, selector) {\n\t\t\tvar i;\n\n\t\t\t// If it isn't an array then try to do some simple selectors instead of Sizzle for to boost performance\n\t\t\tif (elm.length === undefined) {\n\t\t\t\t// Simple all selector\n\t\t\t\tif (selector === '*') {\n\t\t\t\t\treturn elm.nodeType == 1;\n\t\t\t\t}\n\n\t\t\t\t// Simple selector just elements\n\t\t\t\tif (simpleSelectorRe.test(selector)) {\n\t\t\t\t\tselector = selector.toLowerCase().split(/,/);\n\t\t\t\t\telm = elm.nodeName.toLowerCase();\n\n\t\t\t\t\tfor (i = selector.length - 1; i >= 0; i--) {\n\t\t\t\t\t\tif (selector[i] == elm) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Is non element\n\t\t\tif (elm.nodeType && elm.nodeType != 1) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar elms = elm.nodeType ? [elm] : elm;\n\n\t\t\t/*eslint new-cap:0 */\n\t\t\treturn Sizzle(selector, elms[0].ownerDocument || elms[0], null, elms).length > 0;\n\t\t},\n\n\t\t// #endif\n\n\t\t/**\n\t\t * Adds the specified element to another element or elements.\n\t\t *\n\t\t * @method add\n\t\t * @param {String/Element/Array} parentElm Element id string, DOM node element or array of ids or elements to add to.\n\t\t * @param {String/Element} name Name of new element to add or existing element to add.\n\t\t * @param {Object} attrs Optional object collection with arguments to add to the new element(s).\n\t\t * @param {String} html Optional inner HTML contents to add for each element.\n\t\t * @param {Boolean} create Optional flag if the element should be created or added.\n\t\t * @return {Element/Array} Element that got created, or an array of created elements if multiple input elements\n\t\t * were passed in.\n\t\t * @example\n\t\t * // Adds a new paragraph to the end of the active editor\n\t\t * tinymce.activeEditor.dom.add(tinymce.activeEditor.getBody(), 'p', {title: 'my title'}, 'Some content');\n\t\t */\n\t\tadd: function(parentElm, name, attrs, html, create) {\n\t\t\tvar self = this;\n\n\t\t\treturn this.run(parentElm, function(parentElm) {\n\t\t\t\tvar newElm;\n\n\t\t\t\tnewElm = is(name, 'string') ? self.doc.createElement(name) : name;\n\t\t\t\tself.setAttribs(newElm, attrs);\n\n\t\t\t\tif (html) {\n\t\t\t\t\tif (html.nodeType) {\n\t\t\t\t\t\tnewElm.appendChild(html);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.setHTML(newElm, html);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn !create ? parentElm.appendChild(newElm) : newElm;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Creates a new element.\n\t\t *\n\t\t * @method create\n\t\t * @param {String} name Name of new element.\n\t\t * @param {Object} attrs Optional object name/value collection with element attributes.\n\t\t * @param {String} html Optional HTML string to set as inner HTML of the element.\n\t\t * @return {Element} HTML DOM node element that got created.\n\t\t * @example\n\t\t * // Adds an element where the caret/selection is in the active editor\n\t\t * var el = tinymce.activeEditor.dom.create('div', {id: 'test', 'class': 'myclass'}, 'some content');\n\t\t * tinymce.activeEditor.selection.setNode(el);\n\t\t */\n\t\tcreate: function(name, attrs, html) {\n\t\t\treturn this.add(this.doc.createElement(name), name, attrs, html, 1);\n\t\t},\n\n\t\t/**\n\t\t * Creates HTML string for element. The element will be closed unless an empty inner HTML string is passed in.\n\t\t *\n\t\t * @method createHTML\n\t\t * @param {String} name Name of new element.\n\t\t * @param {Object} attrs Optional object name/value collection with element attributes.\n\t\t * @param {String} html Optional HTML string to set as inner HTML of the element.\n\t\t * @return {String} String with new HTML element, for example: <a href=\"#\">test</a>.\n\t\t * @example\n\t\t * // Creates a html chunk and inserts it at the current selection/caret location\n\t\t * tinymce.activeEditor.selection.setContent(tinymce.activeEditor.dom.createHTML('a', {href: 'test.html'}, 'some line'));\n\t\t */\n\t\tcreateHTML: function(name, attrs, html) {\n\t\t\tvar outHtml = '', key;\n\n\t\t\toutHtml += '<' + name;\n\n\t\t\tfor (key in attrs) {\n\t\t\t\tif (attrs.hasOwnProperty(key) && attrs[key] !== null && typeof attrs[key] != 'undefined') {\n\t\t\t\t\toutHtml += ' ' + key + '=\"' + this.encode(attrs[key]) + '\"';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// A call to tinymce.is doesn't work for some odd reason on IE9 possible bug inside their JS runtime\n\t\t\tif (typeof html != \"undefined\") {\n\t\t\t\treturn outHtml + '>' + html + '</' + name + '>';\n\t\t\t}\n\n\t\t\treturn outHtml + ' />';\n\t\t},\n\n\t\t/**\n\t\t * Creates a document fragment out of the specified HTML string.\n\t\t *\n\t\t * @method createFragment\n\t\t * @param {String} html Html string to create fragment from.\n\t\t * @return {DocumentFragment} Document fragment node.\n\t\t */\n\t\tcreateFragment: function(html) {\n\t\t\tvar frag, node, doc = this.doc, container;\n\n\t\t\tcontainer = doc.createElement(\"div\");\n\t\t\tfrag = doc.createDocumentFragment();\n\n\t\t\tif (html) {\n\t\t\t\tcontainer.innerHTML = html;\n\t\t\t}\n\n\t\t\twhile ((node = container.firstChild)) {\n\t\t\t\tfrag.appendChild(node);\n\t\t\t}\n\n\t\t\treturn frag;\n\t\t},\n\n\t\t/**\n\t\t * Removes/deletes the specified element(s) from the DOM.\n\t\t *\n\t\t * @method remove\n\t\t * @param {String/Element/Array} node ID of element or DOM element object or array containing multiple elements/ids.\n\t\t * @param {Boolean} keepChildren Optional state to keep children or not. If set to true all children will be\n\t\t * placed at the location of the removed element.\n\t\t * @return {Element/Array} HTML DOM element that got removed, or an array of removed elements if multiple input elements\n\t\t * were passed in.\n\t\t * @example\n\t\t * // Removes all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.remove(tinymce.activeEditor.dom.select('p'));\n\t\t *\n\t\t * // Removes an element by id in the document\n\t\t * tinymce.DOM.remove('mydiv');\n\t\t */\n\t\tremove: function(node, keepChildren) {\n\t\t\tnode = this.$$(node);\n\n\t\t\tif (keepChildren) {\n\t\t\t\tnode.each(function() {\n\t\t\t\t\tvar child;\n\n\t\t\t\t\twhile ((child = this.firstChild)) {\n\t\t\t\t\t\tif (child.nodeType == 3 && child.data.length === 0) {\n\t\t\t\t\t\t\tthis.removeChild(child);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.parentNode.insertBefore(child, this);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).remove();\n\t\t\t} else {\n\t\t\t\tnode.remove();\n\t\t\t}\n\n\t\t\treturn node.length > 1 ? node.toArray() : node[0];\n\t\t},\n\n\t\t/**\n\t\t * Sets the CSS style value on a HTML element. The name can be a camelcase string\n\t\t * or the CSS style name like background-color.\n\t\t *\n\t\t * @method setStyle\n\t\t * @param {String/Element/Array} elm HTML element/Array of elements to set CSS style value on.\n\t\t * @param {String} name Name of the style value to set.\n\t\t * @param {String} value Value to set on the style.\n\t\t * @example\n\t\t * // Sets a style value on all paragraphs in the currently active editor\n\t\t * tinymce.activeEditor.dom.setStyle(tinymce.activeEditor.dom.select('p'), 'background-color', 'red');\n\t\t *\n\t\t * // Sets a style value to an element by id in the current document\n\t\t * tinymce.DOM.setStyle('mydiv', 'background-color', 'red');\n\t\t */\n\t\tsetStyle: function(elm, name, value) {\n\t\t\telm = this.$$(elm).css(name, value);\n\n\t\t\tif (this.settings.update_styles) {\n\t\t\t\tupdateInternalStyleAttr(this, elm);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the current style or runtime/computed value of an element.\n\t\t *\n\t\t * @method getStyle\n\t\t * @param {String/Element} elm HTML element or element id string to get style from.\n\t\t * @param {String} name Style name to return.\n\t\t * @param {Boolean} computed Computed style.\n\t\t * @return {String} Current style or computed style value of an element.\n\t\t */\n\t\tgetStyle: function(elm, name, computed) {\n\t\t\telm = this.$$(elm);\n\n\t\t\tif (computed) {\n\t\t\t\treturn elm.css(name);\n\t\t\t}\n\n\t\t\t// Camelcase it, if needed\n\t\t\tname = name.replace(/-(\\D)/g, function(a, b) {\n\t\t\t\treturn b.toUpperCase();\n\t\t\t});\n\n\t\t\tif (name == 'float') {\n\t\t\t\tname = Env.ie && Env.ie < 12 ? 'styleFloat' : 'cssFloat';\n\t\t\t}\n\n\t\t\treturn elm[0] && elm[0].style ? elm[0].style[name] : undefined;\n\t\t},\n\n\t\t/**\n\t\t * Sets multiple styles on the specified element(s).\n\t\t *\n\t\t * @method setStyles\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set styles on.\n\t\t * @param {Object} styles Name/Value collection of style items to add to the element(s).\n\t\t * @example\n\t\t * // Sets styles on all paragraphs in the currently active editor\n\t\t * tinymce.activeEditor.dom.setStyles(tinymce.activeEditor.dom.select('p'), {'background-color': 'red', 'color': 'green'});\n\t\t *\n\t\t * // Sets styles to an element by id in the current document\n\t\t * tinymce.DOM.setStyles('mydiv', {'background-color': 'red', 'color': 'green'});\n\t\t */\n\t\tsetStyles: function(elm, styles) {\n\t\t\telm = this.$$(elm).css(styles);\n\n\t\t\tif (this.settings.update_styles) {\n\t\t\t\tupdateInternalStyleAttr(this, elm);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Removes all attributes from an element or elements.\n\t\t *\n\t\t * @method removeAllAttribs\n\t\t * @param {Element/String/Array} e DOM element, element id string or array of elements/ids to remove attributes from.\n\t\t */\n\t\tremoveAllAttribs: function(e) {\n\t\t\treturn this.run(e, function(e) {\n\t\t\t\tvar i, attrs = e.attributes;\n\t\t\t\tfor (i = attrs.length - 1; i >= 0; i--) {\n\t\t\t\t\te.removeAttributeNode(attrs.item(i));\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Sets the specified attribute of an element or elements.\n\t\t *\n\t\t * @method setAttrib\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set attribute on.\n\t\t * @param {String} name Name of attribute to set.\n\t\t * @param {String} value Value to set on the attribute - if this value is falsy like null, 0 or '' it will remove\n\t\t * the attribute instead.\n\t\t * @example\n\t\t * // Sets class attribute on all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.setAttrib(tinymce.activeEditor.dom.select('p'), 'class', 'myclass');\n\t\t *\n\t\t * // Sets class attribute on a specific element in the current page\n\t\t * tinymce.dom.setAttrib('mydiv', 'class', 'myclass');\n\t\t */\n\t\tsetAttrib: function(elm, name, value) {\n\t\t\tvar self = this, originalValue, hook, settings = self.settings;\n\n\t\t\tif (value === '') {\n\t\t\t\tvalue = null;\n\t\t\t}\n\n\t\t\telm = self.$$(elm);\n\t\t\toriginalValue = elm.attr(name);\n\n\t\t\tif (!elm.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thook = self.attrHooks[name];\n\t\t\tif (hook && hook.set) {\n\t\t\t\thook.set(elm, value, name);\n\t\t\t} else {\n\t\t\t\telm.attr(name, value);\n\t\t\t}\n\n\t\t\tif (originalValue != value && settings.onSetAttrib) {\n\t\t\t\tsettings.onSetAttrib({\n\t\t\t\t\tattrElm: elm,\n\t\t\t\t\tattrName: name,\n\t\t\t\t\tattrValue: value\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Sets two or more specified attributes of an element or elements.\n\t\t *\n\t\t * @method setAttribs\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set attributes on.\n\t\t * @param {Object} attrs Name/Value collection of attribute items to add to the element(s).\n\t\t * @example\n\t\t * // Sets class and title attributes on all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.setAttribs(tinymce.activeEditor.dom.select('p'), {'class': 'myclass', title: 'some title'});\n\t\t *\n\t\t * // Sets class and title attributes on a specific element in the current page\n\t\t * tinymce.DOM.setAttribs('mydiv', {'class': 'myclass', title: 'some title'});\n\t\t */\n\t\tsetAttribs: function(elm, attrs) {\n\t\t\tvar self = this;\n\n\t\t\tself.$$(elm).each(function(i, node) {\n\t\t\t\teach(attrs, function(value, name) {\n\t\t\t\t\tself.setAttrib(node, name, value);\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns the specified attribute by name.\n\t\t *\n\t\t * @method getAttrib\n\t\t * @param {String/Element} elm Element string id or DOM element to get attribute from.\n\t\t * @param {String} name Name of attribute to get.\n\t\t * @param {String} defaultVal Optional default value to return if the attribute didn't exist.\n\t\t * @return {String} Attribute value string, default value or null if the attribute wasn't found.\n\t\t */\n\t\tgetAttrib: function(elm, name, defaultVal) {\n\t\t\tvar self = this, hook, value;\n\n\t\t\telm = self.$$(elm);\n\n\t\t\tif (elm.length) {\n\t\t\t\thook = self.attrHooks[name];\n\n\t\t\t\tif (hook && hook.get) {\n\t\t\t\t\tvalue = hook.get(elm, name);\n\t\t\t\t} else {\n\t\t\t\t\tvalue = elm.attr(name);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (typeof value == 'undefined') {\n\t\t\t\tvalue = defaultVal || '';\n\t\t\t}\n\n\t\t\treturn value;\n\t\t},\n\n\t\t/**\n\t\t * Returns the absolute x, y position of a node. The position will be returned in an object with x, y fields.\n\t\t *\n\t\t * @method getPos\n\t\t * @param {Element/String} elm HTML element or element id to get x, y position from.\n\t\t * @param {Element} rootElm Optional root element to stop calculations at.\n\t\t * @return {object} Absolute position of the specified element object with x, y fields.\n\t\t */\n\t\tgetPos: function(elm, rootElm) {\n\t\t\tvar self = this, x = 0, y = 0, offsetParent, doc = self.doc, body = doc.body, pos;\n\n\t\t\telm = self.get(elm);\n\t\t\trootElm = rootElm || body;\n\n\t\t\tif (elm) {\n\t\t\t\t// Use getBoundingClientRect if it exists since it's faster than looping offset nodes\n\t\t\t\t// Fallback to offsetParent calculations if the body isn't static better since it stops at the body root\n\t\t\t\tif (rootElm === body && elm.getBoundingClientRect && $(body).css('position') === 'static') {\n\t\t\t\t\tpos = elm.getBoundingClientRect();\n\t\t\t\t\trootElm = self.boxModel ? doc.documentElement : body;\n\n\t\t\t\t\t// Add scroll offsets from documentElement or body since IE with the wrong box model will use d.body and so do WebKit\n\t\t\t\t\t// Also remove the body/documentelement clientTop/clientLeft on IE 6, 7 since they offset the position\n\t\t\t\t\tx = pos.left + (doc.documentElement.scrollLeft || body.scrollLeft) - rootElm.clientLeft;\n\t\t\t\t\ty = pos.top + (doc.documentElement.scrollTop || body.scrollTop) - rootElm.clientTop;\n\n\t\t\t\t\treturn {x: x, y: y};\n\t\t\t\t}\n\n\t\t\t\toffsetParent = elm;\n\t\t\t\twhile (offsetParent && offsetParent != rootElm && offsetParent.nodeType) {\n\t\t\t\t\tx += offsetParent.offsetLeft || 0;\n\t\t\t\t\ty += offsetParent.offsetTop || 0;\n\t\t\t\t\toffsetParent = offsetParent.offsetParent;\n\t\t\t\t}\n\n\t\t\t\toffsetParent = elm.parentNode;\n\t\t\t\twhile (offsetParent && offsetParent != rootElm && offsetParent.nodeType) {\n\t\t\t\t\tx -= offsetParent.scrollLeft || 0;\n\t\t\t\t\ty -= offsetParent.scrollTop || 0;\n\t\t\t\t\toffsetParent = offsetParent.parentNode;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {x: x, y: y};\n\t\t},\n\n\t\t/**\n\t\t * Parses the specified style value into an object collection. This parser will also\n\t\t * merge and remove any redundant items that browsers might have added. It will also convert non-hex\n\t\t * colors to hex values. Urls inside the styles will also be converted to absolute/relative based on settings.\n\t\t *\n\t\t * @method parseStyle\n\t\t * @param {String} cssText Style value to parse, for example: border:1px solid red;.\n\t\t * @return {Object} Object representation of that style, for example: {border: '1px solid red'}\n\t\t */\n\t\tparseStyle: function(cssText) {\n\t\t\treturn this.styles.parse(cssText);\n\t\t},\n\n\t\t/**\n\t\t * Serializes the specified style object into a string.\n\t\t *\n\t\t * @method serializeStyle\n\t\t * @param {Object} styles Object to serialize as string, for example: {border: '1px solid red'}\n\t\t * @param {String} name Optional element name.\n\t\t * @return {String} String representation of the style object, for example: border: 1px solid red.\n\t\t */\n\t\tserializeStyle: function(styles, name) {\n\t\t\treturn this.styles.serialize(styles, name);\n\t\t},\n\n\t\t/**\n\t\t * Adds a style element at the top of the document with the specified cssText content.\n\t\t *\n\t\t * @method addStyle\n\t\t * @param {String} cssText CSS Text style to add to top of head of document.\n\t\t */\n\t\taddStyle: function(cssText) {\n\t\t\tvar self = this, doc = self.doc, head, styleElm;\n\n\t\t\t// Prevent inline from loading the same styles twice\n\t\t\tif (self !== DOMUtils.DOM && doc === document) {\n\t\t\t\tvar addedStyles = DOMUtils.DOM.addedStyles;\n\n\t\t\t\taddedStyles = addedStyles || [];\n\t\t\t\tif (addedStyles[cssText]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\taddedStyles[cssText] = true;\n\t\t\t\tDOMUtils.DOM.addedStyles = addedStyles;\n\t\t\t}\n\n\t\t\t// Create style element if needed\n\t\t\tstyleElm = doc.getElementById('mceDefaultStyles');\n\t\t\tif (!styleElm) {\n\t\t\t\tstyleElm = doc.createElement('style');\n\t\t\t\tstyleElm.id = 'mceDefaultStyles';\n\t\t\t\tstyleElm.type = 'text/css';\n\n\t\t\t\thead = doc.getElementsByTagName('head')[0];\n\t\t\t\tif (head.firstChild) {\n\t\t\t\t\thead.insertBefore(styleElm, head.firstChild);\n\t\t\t\t} else {\n\t\t\t\t\thead.appendChild(styleElm);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Append style data to old or new style element\n\t\t\tif (styleElm.styleSheet) {\n\t\t\t\tstyleElm.styleSheet.cssText += cssText;\n\t\t\t} else {\n\t\t\t\tstyleElm.appendChild(doc.createTextNode(cssText));\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Imports/loads the specified CSS file into the document bound to the class.\n\t\t *\n\t\t * @method loadCSS\n\t\t * @param {String} url URL to CSS file to load.\n\t\t * @example\n\t\t * // Loads a CSS file dynamically into the current document\n\t\t * tinymce.DOM.loadCSS('somepath/some.css');\n\t\t *\n\t\t * // Loads a CSS file into the currently active editor instance\n\t\t * tinymce.activeEditor.dom.loadCSS('somepath/some.css');\n\t\t *\n\t\t * // Loads a CSS file into an editor instance by id\n\t\t * tinymce.get('someid').dom.loadCSS('somepath/some.css');\n\t\t *\n\t\t * // Loads multiple CSS files into the current document\n\t\t * tinymce.DOM.loadCSS('somepath/some.css,somepath/someother.css');\n\t\t */\n\t\tloadCSS: function(url) {\n\t\t\tvar self = this, doc = self.doc, head;\n\n\t\t\t// Prevent inline from loading the same CSS file twice\n\t\t\tif (self !== DOMUtils.DOM && doc === document) {\n\t\t\t\tDOMUtils.DOM.loadCSS(url);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!url) {\n\t\t\t\turl = '';\n\t\t\t}\n\n\t\t\thead = doc.getElementsByTagName('head')[0];\n\n\t\t\teach(url.split(','), function(url) {\n\t\t\t\tvar link;\n\n\t\t\t\turl = Tools._addCacheSuffix(url);\n\n\t\t\t\tif (self.files[url]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tself.files[url] = true;\n\t\t\t\tlink = self.create('link', {rel: 'stylesheet', href: url});\n\n\t\t\t\t// IE 8 has a bug where dynamically loading stylesheets would produce a 1 item remaining bug\n\t\t\t\t// This fix seems to resolve that issue by recalcing the document once a stylesheet finishes loading\n\t\t\t\t// It's ugly but it seems to work fine.\n\t\t\t\tif (isIE && doc.documentMode && doc.recalc) {\n\t\t\t\t\tlink.onload = function() {\n\t\t\t\t\t\tif (doc.recalc) {\n\t\t\t\t\t\t\tdoc.recalc();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlink.onload = null;\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\thead.appendChild(link);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Adds a class to the specified element or elements.\n\t\t *\n\t\t * @method addClass\n\t\t * @param {String/Element/Array} elm Element ID string or DOM element or array with elements or IDs.\n\t\t * @param {String} cls Class name to add to each element.\n\t\t * @return {String/Array} String with new class value or array with new class values for all elements.\n\t\t * @example\n\t\t * // Adds a class to all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'myclass');\n\t\t *\n\t\t * // Adds a class to a specific element in the current page\n\t\t * tinymce.DOM.addClass('mydiv', 'myclass');\n\t\t */\n\t\taddClass: function(elm, cls) {\n\t\t\tthis.$$(elm).addClass(cls);\n\t\t},\n\n\t\t/**\n\t\t * Removes a class from the specified element or elements.\n\t\t *\n\t\t * @method removeClass\n\t\t * @param {String/Element/Array} elm Element ID string or DOM element or array with elements or IDs.\n\t\t * @param {String} cls Class name to remove from each element.\n\t\t * @return {String/Array} String of remaining class name(s), or an array of strings if multiple input elements\n\t\t * were passed in.\n\t\t * @example\n\t\t * // Removes a class from all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.removeClass(tinymce.activeEditor.dom.select('p'), 'myclass');\n\t\t *\n\t\t * // Removes a class from a specific element in the current page\n\t\t * tinymce.DOM.removeClass('mydiv', 'myclass');\n\t\t */\n\t\tremoveClass: function(elm, cls) {\n\t\t\tthis.toggleClass(elm, cls, false);\n\t\t},\n\n\t\t/**\n\t\t * Returns true if the specified element has the specified class.\n\t\t *\n\t\t * @method hasClass\n\t\t * @param {String/Element} elm HTML element or element id string to check CSS class on.\n\t\t * @param {String} cls CSS class to check for.\n\t\t * @return {Boolean} true/false if the specified element has the specified class.\n\t\t */\n\t\thasClass: function(elm, cls) {\n\t\t\treturn this.$$(elm).hasClass(cls);\n\t\t},\n\n\t\t/**\n\t\t * Toggles the specified class on/off.\n\t\t *\n\t\t * @method toggleClass\n\t\t * @param {Element} elm Element to toggle class on.\n\t\t * @param {[type]} cls Class to toggle on/off.\n\t\t * @param {[type]} state Optional state to set.\n\t\t */\n\t\ttoggleClass: function(elm, cls, state) {\n\t\t\tthis.$$(elm).toggleClass(cls, state).each(function() {\n\t\t\t\tif (this.className === '') {\n\t\t\t\t\t$(this).attr('class', null);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Shows the specified element(s) by ID by setting the \"display\" style.\n\t\t *\n\t\t * @method show\n\t\t * @param {String/Element/Array} elm ID of DOM element or DOM element or array with elements or IDs to show.\n\t\t */\n\t\tshow: function(elm) {\n\t\t\tthis.$$(elm).show();\n\t\t},\n\n\t\t/**\n\t\t * Hides the specified element(s) by ID by setting the \"display\" style.\n\t\t *\n\t\t * @method hide\n\t\t * @param {String/Element/Array} elm ID of DOM element or DOM element or array with elements or IDs to hide.\n\t\t * @example\n\t\t * // Hides an element by id in the document\n\t\t * tinymce.DOM.hide('myid');\n\t\t */\n\t\thide: function(elm) {\n\t\t\tthis.$$(elm).hide();\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the element is hidden or not by checking the \"display\" style.\n\t\t *\n\t\t * @method isHidden\n\t\t * @param {String/Element} elm Id or element to check display state on.\n\t\t * @return {Boolean} true/false if the element is hidden or not.\n\t\t */\n\t\tisHidden: function(elm) {\n\t\t\treturn this.$$(elm).css('display') == 'none';\n\t\t},\n\n\t\t/**\n\t\t * Returns a unique id. This can be useful when generating elements on the fly.\n\t\t * This method will not check if the element already exists.\n\t\t *\n\t\t * @method uniqueId\n\t\t * @param {String} prefix Optional prefix to add in front of all ids - defaults to \"mce_\".\n\t\t * @return {String} Unique id.\n\t\t */\n\t\tuniqueId: function(prefix) {\n\t\t\treturn (!prefix ? 'mce_' : prefix) + (this.counter++);\n\t\t},\n\n\t\t/**\n\t\t * Sets the specified HTML content inside the element or elements. The HTML will first be processed. This means\n\t\t * URLs will get converted, hex color values fixed etc. Check processHTML for details.\n\t\t *\n\t\t * @method setHTML\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set HTML inside of.\n\t\t * @param {String} html HTML content to set as inner HTML of the element.\n\t\t * @example\n\t\t * // Sets the inner HTML of all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.setHTML(tinymce.activeEditor.dom.select('p'), 'some inner html');\n\t\t *\n\t\t * // Sets the inner HTML of an element by id in the document\n\t\t * tinymce.DOM.setHTML('mydiv', 'some inner html');\n\t\t */\n\t\tsetHTML: function(elm, html) {\n\t\t\telm = this.$$(elm);\n\n\t\t\tif (isIE) {\n\t\t\t\telm.each(function(i, target) {\n\t\t\t\t\tif (target.canHaveHTML === false) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove all child nodes, IE keeps empty text nodes in DOM\n\t\t\t\t\twhile (target.firstChild) {\n\t\t\t\t\t\ttarget.removeChild(target.firstChild);\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// IE will remove comments from the beginning\n\t\t\t\t\t\t// unless you padd the contents with something\n\t\t\t\t\t\ttarget.innerHTML = '<br>' + html;\n\t\t\t\t\t\ttarget.removeChild(target.firstChild);\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// IE sometimes produces an unknown runtime error on innerHTML if it's a div inside a p\n\t\t\t\t\t\t$('<div></div>').html('<br>' + html).contents().slice(1).appendTo(target);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\telm.html(html);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the outer HTML of an element.\n\t\t *\n\t\t * @method getOuterHTML\n\t\t * @param {String/Element} elm Element ID or element object to get outer HTML from.\n\t\t * @return {String} Outer HTML string.\n\t\t * @example\n\t\t * tinymce.DOM.getOuterHTML(editorElement);\n\t\t * tinymce.activeEditor.getOuterHTML(tinymce.activeEditor.getBody());\n\t\t */\n\t\tgetOuterHTML: function(elm) {\n\t\t\telm = this.get(elm);\n\n\t\t\t// Older FF doesn't have outerHTML 3.6 is still used by some orgaizations\n\t\t\treturn elm.nodeType == 1 && \"outerHTML\" in elm ? elm.outerHTML : $('<div></div>').append($(elm).clone()).html();\n\t\t},\n\n\t\t/**\n\t\t * Sets the specified outer HTML on an element or elements.\n\t\t *\n\t\t * @method setOuterHTML\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set outer HTML on.\n\t\t * @param {Object} html HTML code to set as outer value for the element.\n\t\t * @example\n\t\t * // Sets the outer HTML of all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.setOuterHTML(tinymce.activeEditor.dom.select('p'), '<div>some html</div>');\n\t\t *\n\t\t * // Sets the outer HTML of an element by id in the document\n\t\t * tinymce.DOM.setOuterHTML('mydiv', '<div>some html</div>');\n\t\t */\n\t\tsetOuterHTML: function(elm, html) {\n\t\t\tvar self = this;\n\n\t\t\tself.$$(elm).each(function() {\n\t\t\t\ttry {\n\t\t\t\t\t// Older FF doesn't have outerHTML 3.6 is still used by some organizations\n\t\t\t\t\tif (\"outerHTML\" in this) {\n\t\t\t\t\t\tthis.outerHTML = html;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Ignore\n\t\t\t\t}\n\n\t\t\t\t// OuterHTML for IE it sometimes produces an \"unknown runtime error\"\n\t\t\t\tself.remove($(this).html(html), true);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Entity decodes a string. This method decodes any HTML entities, such as &aring;.\n\t\t *\n\t\t * @method decode\n\t\t * @param {String} s String to decode entities on.\n\t\t * @return {String} Entity decoded string.\n\t\t */\n\t\tdecode: Entities.decode,\n\n\t\t/**\n\t\t * Entity encodes a string. This method encodes the most common entities, such as <>\"&.\n\t\t *\n\t\t * @method encode\n\t\t * @param {String} text String to encode with entities.\n\t\t * @return {String} Entity encoded string.\n\t\t */\n\t\tencode: Entities.encodeAllRaw,\n\n\t\t/**\n\t\t * Inserts an element after the reference element.\n\t\t *\n\t\t * @method insertAfter\n\t\t * @param {Element} node Element to insert after the reference.\n\t\t * @param {Element/String/Array} referenceNode Reference element, element id or array of elements to insert after.\n\t\t * @return {Element/Array} Element that got added or an array with elements.\n\t\t */\n\t\tinsertAfter: function(node, referenceNode) {\n\t\t\treferenceNode = this.get(referenceNode);\n\n\t\t\treturn this.run(node, function(node) {\n\t\t\t\tvar parent, nextSibling;\n\n\t\t\t\tparent = referenceNode.parentNode;\n\t\t\t\tnextSibling = referenceNode.nextSibling;\n\n\t\t\t\tif (nextSibling) {\n\t\t\t\t\tparent.insertBefore(node, nextSibling);\n\t\t\t\t} else {\n\t\t\t\t\tparent.appendChild(node);\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Replaces the specified element or elements with the new element specified. The new element will\n\t\t * be cloned if multiple input elements are passed in.\n\t\t *\n\t\t * @method replace\n\t\t * @param {Element} newElm New element to replace old ones with.\n\t\t * @param {Element/String/Array} oldElm Element DOM node, element id or array of elements or ids to replace.\n\t\t * @param {Boolean} keepChildren Optional keep children state, if set to true child nodes from the old object will be added\n\t\t * to new ones.\n\t\t */\n\t\treplace: function(newElm, oldElm, keepChildren) {\n\t\t\tvar self = this;\n\n\t\t\treturn self.run(oldElm, function(oldElm) {\n\t\t\t\tif (is(oldElm, 'array')) {\n\t\t\t\t\tnewElm = newElm.cloneNode(true);\n\t\t\t\t}\n\n\t\t\t\tif (keepChildren) {\n\t\t\t\t\teach(grep(oldElm.childNodes), function(node) {\n\t\t\t\t\t\tnewElm.appendChild(node);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn oldElm.parentNode.replaceChild(newElm, oldElm);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Renames the specified element and keeps its attributes and children.\n\t\t *\n\t\t * @method rename\n\t\t * @param {Element} elm Element to rename.\n\t\t * @param {String} name Name of the new element.\n\t\t * @return {Element} New element or the old element if it needed renaming.\n\t\t */\n\t\trename: function(elm, name) {\n\t\t\tvar self = this, newElm;\n\n\t\t\tif (elm.nodeName != name.toUpperCase()) {\n\t\t\t\t// Rename block element\n\t\t\t\tnewElm = self.create(name);\n\n\t\t\t\t// Copy attribs to new block\n\t\t\t\teach(self.getAttribs(elm), function(attrNode) {\n\t\t\t\t\tself.setAttrib(newElm, attrNode.nodeName, self.getAttrib(elm, attrNode.nodeName));\n\t\t\t\t});\n\n\t\t\t\t// Replace block\n\t\t\t\tself.replace(newElm, elm, 1);\n\t\t\t}\n\n\t\t\treturn newElm || elm;\n\t\t},\n\n\t\t/**\n\t\t * Find the common ancestor of two elements. This is a shorter method than using the DOM Range logic.\n\t\t *\n\t\t * @method findCommonAncestor\n\t\t * @param {Element} a Element to find common ancestor of.\n\t\t * @param {Element} b Element to find common ancestor of.\n\t\t * @return {Element} Common ancestor element of the two input elements.\n\t\t */\n\t\tfindCommonAncestor: function(a, b) {\n\t\t\tvar ps = a, pe;\n\n\t\t\twhile (ps) {\n\t\t\t\tpe = b;\n\n\t\t\t\twhile (pe && ps != pe) {\n\t\t\t\t\tpe = pe.parentNode;\n\t\t\t\t}\n\n\t\t\t\tif (ps == pe) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tps = ps.parentNode;\n\t\t\t}\n\n\t\t\tif (!ps && a.ownerDocument) {\n\t\t\t\treturn a.ownerDocument.documentElement;\n\t\t\t}\n\n\t\t\treturn ps;\n\t\t},\n\n\t\t/**\n\t\t * Parses the specified RGB color value and returns a hex version of that color.\n\t\t *\n\t\t * @method toHex\n\t\t * @param {String} rgbVal RGB string value like rgb(1,2,3)\n\t\t * @return {String} Hex version of that RGB value like #FF00FF.\n\t\t */\n\t\ttoHex: function(rgbVal) {\n\t\t\treturn this.styles.toHex(Tools.trim(rgbVal));\n\t\t},\n\n\t\t/**\n\t\t * Executes the specified function on the element by id or dom element node or array of elements/id.\n\t\t *\n\t\t * @method run\n\t\t * @param {String/Element/Array} elm ID or DOM element object or array with ids or elements.\n\t\t * @param {function} func Function to execute for each item.\n\t\t * @param {Object} scope Optional scope to execute the function in.\n\t\t * @return {Object/Array} Single object, or an array of objects if multiple input elements were passed in.\n\t\t */\n\t\trun: function(elm, func, scope) {\n\t\t\tvar self = this, result;\n\n\t\t\tif (typeof elm === 'string') {\n\t\t\t\telm = self.get(elm);\n\t\t\t}\n\n\t\t\tif (!elm) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tscope = scope || this;\n\t\t\tif (!elm.nodeType && (elm.length || elm.length === 0)) {\n\t\t\t\tresult = [];\n\n\t\t\t\teach(elm, function(elm, i) {\n\t\t\t\t\tif (elm) {\n\t\t\t\t\t\tif (typeof elm == 'string') {\n\t\t\t\t\t\t\telm = self.get(elm);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult.push(func.call(scope, elm, i));\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\treturn func.call(scope, elm);\n\t\t},\n\n\t\t/**\n\t\t * Returns a NodeList with attributes for the element.\n\t\t *\n\t\t * @method getAttribs\n\t\t * @param {HTMLElement/string} elm Element node or string id to get attributes from.\n\t\t * @return {NodeList} NodeList with attributes.\n\t\t */\n\t\tgetAttribs: function(elm) {\n\t\t\tvar attrs;\n\n\t\t\telm = this.get(elm);\n\n\t\t\tif (!elm) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tif (isIE) {\n\t\t\t\tattrs = [];\n\n\t\t\t\t// Object will throw exception in IE\n\t\t\t\tif (elm.nodeName == 'OBJECT') {\n\t\t\t\t\treturn elm.attributes;\n\t\t\t\t}\n\n\t\t\t\t// IE doesn't keep the selected attribute if you clone option elements\n\t\t\t\tif (elm.nodeName === 'OPTION' && this.getAttrib(elm, 'selected')) {\n\t\t\t\t\tattrs.push({specified: 1, nodeName: 'selected'});\n\t\t\t\t}\n\n\t\t\t\t// It's crazy that this is faster in IE but it's because it returns all attributes all the time\n\t\t\t\tvar attrRegExp = /<\\/?[\\w:\\-]+ ?|=[\\\"][^\\\"]+\\\"|=\\'[^\\']+\\'|=[\\w\\-]+|>/gi;\n\t\t\t\telm.cloneNode(false).outerHTML.replace(attrRegExp, '').replace(/[\\w:\\-]+/gi, function(a) {\n\t\t\t\t\tattrs.push({specified: 1, nodeName: a});\n\t\t\t\t});\n\n\t\t\t\treturn attrs;\n\t\t\t}\n\n\t\t\treturn elm.attributes;\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the specified node is to be considered empty or not.\n\t\t *\n\t\t * @example\n\t\t * tinymce.DOM.isEmpty(node, {img: true});\n\t\t * @method isEmpty\n\t\t * @param {Object} elements Optional name/value object with elements that are automatically treated as non-empty elements.\n\t\t * @return {Boolean} true/false if the node is empty or not.\n\t\t */\n\t\tisEmpty: function(node, elements) {\n\t\t\tvar self = this, i, attributes, type, whitespace, walker, name, brCount = 0;\n\n\t\t\tnode = node.firstChild;\n\t\t\tif (node) {\n\t\t\t\twalker = new TreeWalker(node, node.parentNode);\n\t\t\t\telements = elements || (self.schema ? self.schema.getNonEmptyElements() : null);\n\t\t\t\twhitespace = self.schema ? self.schema.getWhiteSpaceElements() : {};\n\n\t\t\t\tdo {\n\t\t\t\t\ttype = node.nodeType;\n\n\t\t\t\t\tif (type === 1) {\n\t\t\t\t\t\t// Ignore bogus elements\n\t\t\t\t\t\tvar bogusVal = node.getAttribute('data-mce-bogus');\n\t\t\t\t\t\tif (bogusVal) {\n\t\t\t\t\t\t\tnode = walker.next(bogusVal === 'all');\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Keep empty elements like <img />\n\t\t\t\t\t\tname = node.nodeName.toLowerCase();\n\t\t\t\t\t\tif (elements && elements[name]) {\n\t\t\t\t\t\t\t// Ignore single BR elements in blocks like <p><br /></p> or <p><span><br /></span></p>\n\t\t\t\t\t\t\tif (name === 'br') {\n\t\t\t\t\t\t\t\tbrCount++;\n\t\t\t\t\t\t\t\tnode = walker.next();\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Keep elements with data-bookmark attributes or name attribute like <a name=\"1\"></a>\n\t\t\t\t\t\tattributes = self.getAttribs(node);\n\t\t\t\t\t\ti = attributes.length;\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tname = attributes[i].nodeName;\n\t\t\t\t\t\t\tif (name === \"name\" || name === 'data-mce-bookmark') {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Keep comment nodes\n\t\t\t\t\tif (type == 8) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Keep non whitespace text nodes\n\t\t\t\t\tif (type === 3 && !whiteSpaceRegExp.test(node.nodeValue)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Keep whitespace preserve elements\n\t\t\t\t\tif (type === 3 && node.parentNode && whitespace[node.parentNode.nodeName] && whiteSpaceRegExp.test(node.nodeValue)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = walker.next();\n\t\t\t\t} while (node);\n\t\t\t}\n\n\t\t\treturn brCount <= 1;\n\t\t},\n\n\t\t/**\n\t\t * Creates a new DOM Range object. This will use the native DOM Range API if it's\n\t\t * available. If it's not, it will fall back to the custom TinyMCE implementation.\n\t\t *\n\t\t * @method createRng\n\t\t * @return {DOMRange} DOM Range object.\n\t\t * @example\n\t\t * var rng = tinymce.DOM.createRng();\n\t\t * alert(rng.startContainer + \",\" + rng.startOffset);\n\t\t */\n\t\tcreateRng: function() {\n\t\t\tvar doc = this.doc;\n\n\t\t\treturn doc.createRange ? doc.createRange() : new Range(this);\n\t\t},\n\n\t\t/**\n\t\t * Returns the index of the specified node within its parent.\n\t\t *\n\t\t * @method nodeIndex\n\t\t * @param {Node} node Node to look for.\n\t\t * @param {boolean} normalized Optional true/false state if the index is what it would be after a normalization.\n\t\t * @return {Number} Index of the specified node.\n\t\t */\n\t\tnodeIndex: nodeIndex,\n\n\t\t/**\n\t\t * Splits an element into two new elements and places the specified split\n\t\t * element or elements between the new ones. For example splitting the paragraph at the bold element in\n\t\t * this example <p>abc<b>abc</b>123</p> would produce <p>abc</p><b>abc</b><p>123</p>.\n\t\t *\n\t\t * @method split\n\t\t * @param {Element} parentElm Parent element to split.\n\t\t * @param {Element} splitElm Element to split at.\n\t\t * @param {Element} replacementElm Optional replacement element to replace the split element with.\n\t\t * @return {Element} Returns the split element or the replacement element if that is specified.\n\t\t */\n\t\tsplit: function(parentElm, splitElm, replacementElm) {\n\t\t\tvar self = this, r = self.createRng(), bef, aft, pa;\n\n\t\t\t// W3C valid browsers tend to leave empty nodes to the left/right side of the contents - this makes sense\n\t\t\t// but we don't want that in our code since it serves no purpose for the end user\n\t\t\t// For example splitting this html at the bold element:\n\t\t\t//   <p>text 1<span><b>CHOP</b></span>text 2</p>\n\t\t\t// would produce:\n\t\t\t//   <p>text 1<span></span></p><b>CHOP</b><p><span></span>text 2</p>\n\t\t\t// this function will then trim off empty edges and produce:\n\t\t\t//   <p>text 1</p><b>CHOP</b><p>text 2</p>\n\t\t\tfunction trimNode(node) {\n\t\t\t\tvar i, children = node.childNodes, type = node.nodeType;\n\n\t\t\t\tfunction surroundedBySpans(node) {\n\t\t\t\t\tvar previousIsSpan = node.previousSibling && node.previousSibling.nodeName == 'SPAN';\n\t\t\t\t\tvar nextIsSpan = node.nextSibling && node.nextSibling.nodeName == 'SPAN';\n\t\t\t\t\treturn previousIsSpan && nextIsSpan;\n\t\t\t\t}\n\n\t\t\t\tif (type == 1 && node.getAttribute('data-mce-type') == 'bookmark') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfor (i = children.length - 1; i >= 0; i--) {\n\t\t\t\t\ttrimNode(children[i]);\n\t\t\t\t}\n\n\t\t\t\tif (type != 9) {\n\t\t\t\t\t// Keep non whitespace text nodes\n\t\t\t\t\tif (type == 3 && node.nodeValue.length > 0) {\n\t\t\t\t\t\t// If parent element isn't a block or there isn't any useful contents for example \"<p>   </p>\"\n\t\t\t\t\t\t// Also keep text nodes with only spaces if surrounded by spans.\n\t\t\t\t\t\t// eg. \"<p><span>a</span> <span>b</span></p>\" should keep space between a and b\n\t\t\t\t\t\tvar trimmedLength = trim(node.nodeValue).length;\n\t\t\t\t\t\tif (!self.isBlock(node.parentNode) || trimmedLength > 0 || trimmedLength === 0 && surroundedBySpans(node)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (type == 1) {\n\t\t\t\t\t\t// If the only child is a bookmark then move it up\n\t\t\t\t\t\tchildren = node.childNodes;\n\n\t\t\t\t\t\t// TODO fix this complex if\n\t\t\t\t\t\tif (children.length == 1 && children[0] && children[0].nodeType == 1 &&\n\t\t\t\t\t\t\tchildren[0].getAttribute('data-mce-type') == 'bookmark') {\n\t\t\t\t\t\t\tnode.parentNode.insertBefore(children[0], node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Keep non empty elements or img, hr etc\n\t\t\t\t\t\tif (children.length || /^(br|hr|input|img)$/i.test(node.nodeName)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tself.remove(node);\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tif (parentElm && splitElm) {\n\t\t\t\t// Get before chunk\n\t\t\t\tr.setStart(parentElm.parentNode, self.nodeIndex(parentElm));\n\t\t\t\tr.setEnd(splitElm.parentNode, self.nodeIndex(splitElm));\n\t\t\t\tbef = r.extractContents();\n\n\t\t\t\t// Get after chunk\n\t\t\t\tr = self.createRng();\n\t\t\t\tr.setStart(splitElm.parentNode, self.nodeIndex(splitElm) + 1);\n\t\t\t\tr.setEnd(parentElm.parentNode, self.nodeIndex(parentElm) + 1);\n\t\t\t\taft = r.extractContents();\n\n\t\t\t\t// Insert before chunk\n\t\t\t\tpa = parentElm.parentNode;\n\t\t\t\tpa.insertBefore(trimNode(bef), parentElm);\n\n\t\t\t\t// Insert middle chunk\n\t\t\t\tif (replacementElm) {\n\t\t\t\t\tpa.insertBefore(replacementElm, parentElm);\n\t\t\t\t\t//pa.replaceChild(replacementElm, splitElm);\n\t\t\t\t} else {\n\t\t\t\t\tpa.insertBefore(splitElm, parentElm);\n\t\t\t\t}\n\n\t\t\t\t// Insert after chunk\n\t\t\t\tpa.insertBefore(trimNode(aft), parentElm);\n\t\t\t\tself.remove(parentElm);\n\n\t\t\t\treturn replacementElm || splitElm;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Adds an event handler to the specified object.\n\t\t *\n\t\t * @method bind\n\t\t * @param {Element/Document/Window/Array} target Target element to bind events to.\n\t\t * handler to or an array of elements/ids/documents.\n\t\t * @param {String} name Name of event handler to add, for example: click.\n\t\t * @param {function} func Function to execute when the event occurs.\n\t\t * @param {Object} scope Optional scope to execute the function in.\n\t\t * @return {function} Function callback handler the same as the one passed in.\n\t\t */\n\t\tbind: function(target, name, func, scope) {\n\t\t\tvar self = this;\n\n\t\t\tif (Tools.isArray(target)) {\n\t\t\t\tvar i = target.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\ttarget[i] = self.bind(target[i], name, func, scope);\n\t\t\t\t}\n\n\t\t\t\treturn target;\n\t\t\t}\n\n\t\t\t// Collect all window/document events bound by editor instance\n\t\t\tif (self.settings.collect && (target === self.doc || target === self.win)) {\n\t\t\t\tself.boundEvents.push([target, name, func, scope]);\n\t\t\t}\n\n\t\t\treturn self.events.bind(target, name, func, scope || self);\n\t\t},\n\n\t\t/**\n\t\t * Removes the specified event handler by name and function from an element or collection of elements.\n\t\t *\n\t\t * @method unbind\n\t\t * @param {Element/Document/Window/Array} target Target element to unbind events on.\n\t\t * @param {String} name Event handler name, for example: \"click\"\n\t\t * @param {function} func Function to remove.\n\t\t * @return {bool/Array} Bool state of true if the handler was removed, or an array of states if multiple input elements\n\t\t * were passed in.\n\t\t */\n\t\tunbind: function(target, name, func) {\n\t\t\tvar self = this, i;\n\n\t\t\tif (Tools.isArray(target)) {\n\t\t\t\ti = target.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\ttarget[i] = self.unbind(target[i], name, func);\n\t\t\t\t}\n\n\t\t\t\treturn target;\n\t\t\t}\n\n\t\t\t// Remove any bound events matching the input\n\t\t\tif (self.boundEvents && (target === self.doc || target === self.win)) {\n\t\t\t\ti = self.boundEvents.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tvar item = self.boundEvents[i];\n\n\t\t\t\t\tif (target == item[0] && (!name || name == item[1]) && (!func || func == item[2])) {\n\t\t\t\t\t\tthis.events.unbind(item[0], item[1], item[2]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this.events.unbind(target, name, func);\n\t\t},\n\n\t\t/**\n\t\t * Fires the specified event name with object on target.\n\t\t *\n\t\t * @method fire\n\t\t * @param {Node/Document/Window} target Target element or object to fire event on.\n\t\t * @param {String} name Name of the event to fire.\n\t\t * @param {Object} evt Event object to send.\n\t\t * @return {Event} Event object.\n\t\t */\n\t\tfire: function(target, name, evt) {\n\t\t\treturn this.events.fire(target, name, evt);\n\t\t},\n\n\t\t// Returns the content editable state of a node\n\t\tgetContentEditable: function(node) {\n\t\t\tvar contentEditable;\n\n\t\t\t// Check type\n\t\t\tif (!node || node.nodeType != 1) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Check for fake content editable\n\t\t\tcontentEditable = node.getAttribute(\"data-mce-contenteditable\");\n\t\t\tif (contentEditable && contentEditable !== \"inherit\") {\n\t\t\t\treturn contentEditable;\n\t\t\t}\n\n\t\t\t// Check for real content editable\n\t\t\treturn node.contentEditable !== \"inherit\" ? node.contentEditable : null;\n\t\t},\n\n\t\tgetContentEditableParent: function(node) {\n\t\t\tvar root = this.getRoot(), state = null;\n\n\t\t\tfor (; node && node !== root; node = node.parentNode) {\n\t\t\t\tstate = this.getContentEditable(node);\n\n\t\t\t\tif (state !== null) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn state;\n\t\t},\n\n\t\t/**\n\t\t * Destroys all internal references to the DOM to solve IE leak issues.\n\t\t *\n\t\t * @method destroy\n\t\t */\n\t\tdestroy: function() {\n\t\t\tvar self = this;\n\n\t\t\t// Unbind all events bound to window/document by editor instance\n\t\t\tif (self.boundEvents) {\n\t\t\t\tvar i = self.boundEvents.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tvar item = self.boundEvents[i];\n\t\t\t\t\tthis.events.unbind(item[0], item[1], item[2]);\n\t\t\t\t}\n\n\t\t\t\tself.boundEvents = null;\n\t\t\t}\n\n\t\t\t// Restore sizzle document to window.document\n\t\t\t// Since the current document might be removed producing \"Permission denied\" on IE see #6325\n\t\t\tif (Sizzle.setDocument) {\n\t\t\t\tSizzle.setDocument();\n\t\t\t}\n\n\t\t\tself.win = self.doc = self.root = self.events = self.frag = null;\n\t\t},\n\n\t\tisChildOf: function(node, parent) {\n\t\t\twhile (node) {\n\t\t\t\tif (parent === node) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t// #ifdef debug\n\n\t\tdumpRng: function(r) {\n\t\t\treturn (\n\t\t\t\t'startContainer: ' + r.startContainer.nodeName +\n\t\t\t\t', startOffset: ' + r.startOffset +\n\t\t\t\t', endContainer: ' + r.endContainer.nodeName +\n\t\t\t\t', endOffset: ' + r.endOffset\n\t\t\t);\n\t\t},\n\n\t\t// #endif\n\n\t\t_findSib: function(node, selector, name) {\n\t\t\tvar self = this, func = selector;\n\n\t\t\tif (node) {\n\t\t\t\t// If expression make a function of it using is\n\t\t\t\tif (typeof func == 'string') {\n\t\t\t\t\tfunc = function(node) {\n\t\t\t\t\t\treturn self.is(node, selector);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// Loop all siblings\n\t\t\t\tfor (node = node[name]; node; node = node[name]) {\n\t\t\t\t\tif (func(node)) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\t};\n\n\t/**\n\t * Instance of DOMUtils for the current document.\n\t *\n\t * @static\n\t * @property DOM\n\t * @type tinymce.dom.DOMUtils\n\t * @example\n\t * // Example of how to add a class to some element by id\n\t * tinymce.DOM.addClass('someid', 'someclass');\n\t */\n\tDOMUtils.DOM = new DOMUtils(document);\n\tDOMUtils.nodeIndex = nodeIndex;\n\n\treturn DOMUtils;\n});\n\n// Included from: js/tinymce/classes/dom/ScriptLoader.js\n\n/**\n * ScriptLoader.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*globals console*/\n\n/**\n * This class handles asynchronous/synchronous loading of JavaScript files it will execute callbacks\n * when various items gets loaded. This class is useful to load external JavaScript files.\n *\n * @class tinymce.dom.ScriptLoader\n * @example\n * // Load a script from a specific URL using the global script loader\n * tinymce.ScriptLoader.load('somescript.js');\n *\n * // Load a script using a unique instance of the script loader\n * var scriptLoader = new tinymce.dom.ScriptLoader();\n *\n * scriptLoader.load('somescript.js');\n *\n * // Load multiple scripts\n * var scriptLoader = new tinymce.dom.ScriptLoader();\n *\n * scriptLoader.add('somescript1.js');\n * scriptLoader.add('somescript2.js');\n * scriptLoader.add('somescript3.js');\n *\n * scriptLoader.loadQueue(function() {\n *    alert('All scripts are now loaded.');\n * });\n */\ndefine(\"tinymce/dom/ScriptLoader\", [\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/util/Tools\"\n], function(DOMUtils, Tools) {\n\tvar DOM = DOMUtils.DOM;\n\tvar each = Tools.each, grep = Tools.grep;\n\n\tvar isFunction = function (f) {\n\t\treturn typeof f === 'function';\n\t};\n\n\tfunction ScriptLoader() {\n\t\tvar QUEUED = 0,\n\t\t\tLOADING = 1,\n\t\t\tLOADED = 2,\n\t\t\tFAILED = 3,\n\t\t\tstates = {},\n\t\t\tqueue = [],\n\t\t\tscriptLoadedCallbacks = {},\n\t\t\tqueueLoadedCallbacks = [],\n\t\t\tloading = 0,\n\t\t\tundef;\n\n\t\t/**\n\t\t * Loads a specific script directly without adding it to the load queue.\n\t\t *\n\t\t * @method load\n\t\t * @param {String} url Absolute URL to script to add.\n\t\t * @param {function} callback Optional success callback function when the script loaded successfully.\n\t\t * @param {function} callback Optional failure callback function when the script failed to load.\n\t\t */\n\t\tfunction loadScript(url, success, failure) {\n\t\t\tvar dom = DOM, elm, id;\n\n\t\t\t// Execute callback when script is loaded\n\t\t\tfunction done() {\n\t\t\t\tdom.remove(id);\n\n\t\t\t\tif (elm) {\n\t\t\t\t\telm.onreadystatechange = elm.onload = elm = null;\n\t\t\t\t}\n\n\t\t\t\tsuccess();\n\t\t\t}\n\n\t\t\tfunction error() {\n\t\t\t\t/*eslint no-console:0 */\n\n\t\t\t\t// We can't mark it as done if there is a load error since\n\t\t\t\t// A) We don't want to produce 404 errors on the server and\n\t\t\t\t// B) the onerror event won't fire on all browsers.\n\t\t\t\t// done();\n\n\t\t\t\tif (isFunction(failure)) {\n\t\t\t\t\tfailure();\n\t\t\t\t} else {\n\t\t\t\t\t// Report the error so it's easier for people to spot loading errors\n\t\t\t\t\tif (typeof console !== \"undefined\" && console.log) {\n\t\t\t\t\t\tconsole.log(\"Failed to load script: \" + url);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tid = dom.uniqueId();\n\n\t\t\t// Create new script element\n\t\t\telm = document.createElement('script');\n\t\t\telm.id = id;\n\t\t\telm.type = 'text/javascript';\n\t\t\telm.src = Tools._addCacheSuffix(url);\n\n\t\t\t// Seems that onreadystatechange works better on IE 10 onload seems to fire incorrectly\n\t\t\tif (\"onreadystatechange\" in elm) {\n\t\t\t\telm.onreadystatechange = function() {\n\t\t\t\t\tif (/loaded|complete/.test(elm.readyState)) {\n\t\t\t\t\t\tdone();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\telm.onload = done;\n\t\t\t}\n\n\t\t\t// Add onerror event will get fired on some browsers but not all of them\n\t\t\telm.onerror = error;\n\n\t\t\t// Add script to document\n\t\t\t(document.getElementsByTagName('head')[0] || document.body).appendChild(elm);\n\t\t}\n\n\t\t/**\n\t\t * Returns true/false if a script has been loaded or not.\n\t\t *\n\t\t * @method isDone\n\t\t * @param {String} url URL to check for.\n\t\t * @return {Boolean} true/false if the URL is loaded.\n\t\t */\n\t\tthis.isDone = function(url) {\n\t\t\treturn states[url] == LOADED;\n\t\t};\n\n\t\t/**\n\t\t * Marks a specific script to be loaded. This can be useful if a script got loaded outside\n\t\t * the script loader or to skip it from loading some script.\n\t\t *\n\t\t * @method markDone\n\t\t * @param {string} url Absolute URL to the script to mark as loaded.\n\t\t */\n\t\tthis.markDone = function(url) {\n\t\t\tstates[url] = LOADED;\n\t\t};\n\n\t\t/**\n\t\t * Adds a specific script to the load queue of the script loader.\n\t\t *\n\t\t * @method add\n\t\t * @param {String} url Absolute URL to script to add.\n\t\t * @param {function} success Optional success callback function to execute when the script loades successfully.\n\t\t * @param {Object} scope Optional scope to execute callback in.\n\t\t * @param {function} failure Optional failure callback function to execute when the script failed to load.\n\t\t */\n\t\tthis.add = this.load = function(url, success, scope, failure) {\n\t\t\tvar state = states[url];\n\n\t\t\t// Add url to load queue\n\t\t\tif (state == undef) {\n\t\t\t\tqueue.push(url);\n\t\t\t\tstates[url] = QUEUED;\n\t\t\t}\n\n\t\t\tif (success) {\n\t\t\t\t// Store away callback for later execution\n\t\t\t\tif (!scriptLoadedCallbacks[url]) {\n\t\t\t\t\tscriptLoadedCallbacks[url] = [];\n\t\t\t\t}\n\n\t\t\t\tscriptLoadedCallbacks[url].push({\n\t\t\t\t\tsuccess: success,\n\t\t\t\t\tfailure: failure,\n\t\t\t\t\tscope: scope || this\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tthis.remove = function(url) {\n\t\t\tdelete states[url];\n\t\t\tdelete scriptLoadedCallbacks[url];\n\t\t};\n\n\t\t/**\n\t\t * Starts the loading of the queue.\n\t\t *\n\t\t * @method loadQueue\n\t\t * @param {function} success Optional callback to execute when all queued items are loaded.\n\t\t * @param {function} failure Optional callback to execute when queued items failed to load.\n\t\t * @param {Object} scope Optional scope to execute the callback in.\n\t\t */\n\t\tthis.loadQueue = function(success, scope, failure) {\n\t\t\tthis.loadScripts(queue, success, scope, failure);\n\t\t};\n\n\t\t/**\n\t\t * Loads the specified queue of files and executes the callback ones they are loaded.\n\t\t * This method is generally not used outside this class but it might be useful in some scenarios.\n\t\t *\n\t\t * @method loadScripts\n\t\t * @param {Array} scripts Array of queue items to load.\n\t\t * @param {function} callback Optional callback to execute when scripts is loaded successfully.\n\t\t * @param {Object} scope Optional scope to execute callback in.\n\t\t * @param {function} callback Optional callback to execute if scripts failed to load.\n\t\t */\n\t\tthis.loadScripts = function(scripts, success, scope, failure) {\n\t\t\tvar loadScripts, failures = [];\n\n\t\t\tfunction execCallbacks(name, url) {\n\t\t\t\t// Execute URL callback functions\n\t\t\t\teach(scriptLoadedCallbacks[url], function(callback) {\n\t\t\t\t\tif (isFunction(callback[name])) {\n\t\t\t\t\t\tcallback[name].call(callback.scope);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tscriptLoadedCallbacks[url] = undef;\n\t\t\t}\n\n\t\t\tqueueLoadedCallbacks.push({\n\t\t\t\tsuccess: success,\n\t\t\t\tfailure: failure,\n\t\t\t\tscope: scope || this\n\t\t\t});\n\n\t\t\tloadScripts = function() {\n\t\t\t\tvar loadingScripts = grep(scripts);\n\n\t\t\t\t// Current scripts has been handled\n\t\t\t\tscripts.length = 0;\n\n\t\t\t\t// Load scripts that needs to be loaded\n\t\t\t\teach(loadingScripts, function(url) {\n\t\t\t\t\t// Script is already loaded then execute script callbacks directly\n\t\t\t\t\tif (states[url] === LOADED) {\n\t\t\t\t\t\texecCallbacks('success', url);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (states[url] === FAILED) {\n\t\t\t\t\t\texecCallbacks('failure', url);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Is script not loading then start loading it\n\t\t\t\t\tif (states[url] !== LOADING) {\n\t\t\t\t\t\tstates[url] = LOADING;\n\t\t\t\t\t\tloading++;\n\n\t\t\t\t\t\tloadScript(url, function() {\n\t\t\t\t\t\t\tstates[url] = LOADED;\n\t\t\t\t\t\t\tloading--;\n\n\t\t\t\t\t\t\texecCallbacks('success', url);\n\n\t\t\t\t\t\t\t// Load more scripts if they where added by the recently loaded script\n\t\t\t\t\t\t\tloadScripts();\n\t\t\t\t\t\t}, function () {\n\t\t\t\t\t\t\tstates[url] = FAILED;\n\t\t\t\t\t\t\tloading--;\n\n\t\t\t\t\t\t\tfailures.push(url);\n\t\t\t\t\t\t\texecCallbacks('failure', url);\n\n\t\t\t\t\t\t\t// Load more scripts if they where added by the recently loaded script\n\t\t\t\t\t\t\tloadScripts();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// No scripts are currently loading then execute all pending queue loaded callbacks\n\t\t\t\tif (!loading) {\n\t\t\t\t\teach(queueLoadedCallbacks, function(callback) {\n\t\t\t\t\t\tif (failures.length === 0) {\n\t\t\t\t\t\t\tif (isFunction(callback.success)) {\n\t\t\t\t\t\t\t\tcallback.success.call(callback.scope);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (isFunction(callback.failure)) {\n\t\t\t\t\t\t\t\tcallback.failure.call(callback.scope, failures);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tqueueLoadedCallbacks.length = 0;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tloadScripts();\n\t\t};\n\t}\n\n\tScriptLoader.ScriptLoader = new ScriptLoader();\n\n\treturn ScriptLoader;\n});\n\n// Included from: js/tinymce/classes/AddOnManager.js\n\n/**\n * AddOnManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles the loading of themes/plugins or other add-ons and their language packs.\n *\n * @class tinymce.AddOnManager\n */\ndefine(\"tinymce/AddOnManager\", [\n\t\"tinymce/dom/ScriptLoader\",\n\t\"tinymce/util/Tools\"\n], function(ScriptLoader, Tools) {\n\tvar each = Tools.each;\n\n\tfunction AddOnManager() {\n\t\tvar self = this;\n\n\t\tself.items = [];\n\t\tself.urls = {};\n\t\tself.lookup = {};\n\t}\n\n\tAddOnManager.prototype = {\n\t\t/**\n\t\t * Returns the specified add on by the short name.\n\t\t *\n\t\t * @method get\n\t\t * @param {String} name Add-on to look for.\n\t\t * @return {tinymce.Theme/tinymce.Plugin} Theme or plugin add-on instance or undefined.\n\t\t */\n\t\tget: function(name) {\n\t\t\tif (this.lookup[name]) {\n\t\t\t\treturn this.lookup[name].instance;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t},\n\n\t\tdependencies: function(name) {\n\t\t\tvar result;\n\n\t\t\tif (this.lookup[name]) {\n\t\t\t\tresult = this.lookup[name].dependencies;\n\t\t\t}\n\n\t\t\treturn result || [];\n\t\t},\n\n\t\t/**\n\t\t * Loads a language pack for the specified add-on.\n\t\t *\n\t\t * @method requireLangPack\n\t\t * @param {String} name Short name of the add-on.\n\t\t * @param {String} languages Optional comma or space separated list of languages to check if it matches the name.\n\t\t */\n\t\trequireLangPack: function(name, languages) {\n\t\t\tvar language = AddOnManager.language;\n\n\t\t\tif (language && AddOnManager.languageLoad !== false) {\n\t\t\t\tif (languages) {\n\t\t\t\t\tlanguages = ',' + languages + ',';\n\n\t\t\t\t\t// Load short form sv.js or long form sv_SE.js\n\t\t\t\t\tif (languages.indexOf(',' + language.substr(0, 2) + ',') != -1) {\n\t\t\t\t\t\tlanguage = language.substr(0, 2);\n\t\t\t\t\t} else if (languages.indexOf(',' + language + ',') == -1) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tScriptLoader.ScriptLoader.add(this.urls[name] + '/langs/' + language + '.js');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Adds a instance of the add-on by it's short name.\n\t\t *\n\t\t * @method add\n\t\t * @param {String} id Short name/id for the add-on.\n\t\t * @param {tinymce.Theme/tinymce.Plugin} addOn Theme or plugin to add.\n\t\t * @return {tinymce.Theme/tinymce.Plugin} The same theme or plugin instance that got passed in.\n\t\t * @example\n\t\t * // Create a simple plugin\n\t\t * tinymce.create('tinymce.plugins.TestPlugin', {\n\t\t *   TestPlugin: function(ed, url) {\n\t\t *   ed.on('click', function(e) {\n\t\t *      ed.windowManager.alert('Hello World!');\n\t\t *   });\n\t\t *   }\n\t\t * });\n\t\t *\n\t\t * // Register plugin using the add method\n\t\t * tinymce.PluginManager.add('test', tinymce.plugins.TestPlugin);\n\t\t *\n\t\t * // Initialize TinyMCE\n\t\t * tinymce.init({\n\t\t *  ...\n\t\t *  plugins: '-test' // Init the plugin but don't try to load it\n\t\t * });\n\t\t */\n\t\tadd: function(id, addOn, dependencies) {\n\t\t\tthis.items.push(addOn);\n\t\t\tthis.lookup[id] = {instance: addOn, dependencies: dependencies};\n\n\t\t\treturn addOn;\n\t\t},\n\n\t\tremove: function(name) {\n\t\t\tdelete this.urls[name];\n\t\t\tdelete this.lookup[name];\n\t\t},\n\n\t\tcreateUrl: function(baseUrl, dep) {\n\t\t\tif (typeof dep === \"object\") {\n\t\t\t\treturn dep;\n\t\t\t}\n\n\t\t\treturn {prefix: baseUrl.prefix, resource: dep, suffix: baseUrl.suffix};\n\t\t},\n\n\t\t/**\n\t\t * Add a set of components that will make up the add-on. Using the url of the add-on name as the base url.\n\t\t * This should be used in development mode.  A new compressor/javascript munger process will ensure that the\n\t\t * components are put together into the plugin.js file and compressed correctly.\n\t\t *\n\t\t * @method addComponents\n\t\t * @param {String} pluginName name of the plugin to load scripts from (will be used to get the base url for the plugins).\n\t\t * @param {Array} scripts Array containing the names of the scripts to load.\n\t\t */\n\t\taddComponents: function(pluginName, scripts) {\n\t\t\tvar pluginUrl = this.urls[pluginName];\n\n\t\t\teach(scripts, function(script) {\n\t\t\t\tScriptLoader.ScriptLoader.add(pluginUrl + \"/\" + script);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Loads an add-on from a specific url.\n\t\t *\n\t\t * @method load\n\t\t * @param {String} name Short name of the add-on that gets loaded.\n\t\t * @param {String} addOnUrl URL to the add-on that will get loaded.\n\t\t * @param {function} success Optional success callback to execute when an add-on is loaded.\n\t\t * @param {Object} scope Optional scope to execute the callback in.\n\t\t * @param {function} failure Optional failure callback to execute when an add-on failed to load.\n\t\t * @example\n\t\t * // Loads a plugin from an external URL\n\t\t * tinymce.PluginManager.load('myplugin', '/some/dir/someplugin/plugin.js');\n\t\t *\n\t\t * // Initialize TinyMCE\n\t\t * tinymce.init({\n\t\t *  ...\n\t\t *  plugins: '-myplugin' // Don't try to load it again\n\t\t * });\n\t\t */\n\t\tload: function(name, addOnUrl, success, scope, failure) {\n\t\t\tvar self = this, url = addOnUrl;\n\n\t\t\tfunction loadDependencies() {\n\t\t\t\tvar dependencies = self.dependencies(name);\n\n\t\t\t\teach(dependencies, function(dep) {\n\t\t\t\t\tvar newUrl = self.createUrl(addOnUrl, dep);\n\n\t\t\t\t\tself.load(newUrl.resource, newUrl, undefined, undefined);\n\t\t\t\t});\n\n\t\t\t\tif (success) {\n\t\t\t\t\tif (scope) {\n\t\t\t\t\t\tsuccess.call(scope);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsuccess.call(ScriptLoader);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (self.urls[name]) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (typeof addOnUrl === \"object\") {\n\t\t\t\turl = addOnUrl.prefix + addOnUrl.resource + addOnUrl.suffix;\n\t\t\t}\n\n\t\t\tif (url.indexOf('/') !== 0 && url.indexOf('://') == -1) {\n\t\t\t\turl = AddOnManager.baseURL + '/' + url;\n\t\t\t}\n\n\t\t\tself.urls[name] = url.substring(0, url.lastIndexOf('/'));\n\n\t\t\tif (self.lookup[name]) {\n\t\t\t\tloadDependencies();\n\t\t\t} else {\n\t\t\t\tScriptLoader.ScriptLoader.add(url, loadDependencies, scope, failure);\n\t\t\t}\n\t\t}\n\t};\n\n\tAddOnManager.PluginManager = new AddOnManager();\n\tAddOnManager.ThemeManager = new AddOnManager();\n\n\treturn AddOnManager;\n});\n\n/**\n * TinyMCE theme class.\n *\n * @class tinymce.Theme\n */\n\n/**\n * This method is responsible for rendering/generating the overall user interface with toolbars, buttons, iframe containers etc.\n *\n * @method renderUI\n * @param {Object} obj Object parameter containing the targetNode DOM node that will be replaced visually with an editor instance.\n * @return {Object} an object with items like iframeContainer, editorContainer, sizeContainer, deltaWidth, deltaHeight.\n */\n\n/**\n * Plugin base class, this is a pseudo class that describes how a plugin is to be created for TinyMCE. The methods below are all optional.\n *\n * @class tinymce.Plugin\n * @example\n * tinymce.PluginManager.add('example', function(editor, url) {\n *     // Add a button that opens a window\n *     editor.addButton('example', {\n *         text: 'My button',\n *         icon: false,\n *         onclick: function() {\n *             // Open window\n *             editor.windowManager.open({\n *                 title: 'Example plugin',\n *                 body: [\n *                     {type: 'textbox', name: 'title', label: 'Title'}\n *                 ],\n *                 onsubmit: function(e) {\n *                     // Insert content when the window form is submitted\n *                     editor.insertContent('Title: ' + e.data.title);\n *                 }\n *             });\n *         }\n *     });\n *\n *     // Adds a menu item to the tools menu\n *     editor.addMenuItem('example', {\n *         text: 'Example plugin',\n *         context: 'tools',\n *         onclick: function() {\n *             // Open window with a specific url\n *             editor.windowManager.open({\n *                 title: 'TinyMCE site',\n *                 url: 'http://www.tinymce.com',\n *                 width: 800,\n *                 height: 600,\n *                 buttons: [{\n *                     text: 'Close',\n *                     onclick: 'close'\n *                 }]\n *             });\n *         }\n *     });\n * });\n */\n\n// Included from: js/tinymce/classes/dom/NodeType.js\n\n/**\n * NodeType.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Contains various node validation functions.\n *\n * @private\n * @class tinymce.dom.NodeType\n */\ndefine(\"tinymce/dom/NodeType\", [], function() {\n\tfunction isNodeType(type) {\n\t\treturn function(node) {\n\t\t\treturn !!node && node.nodeType == type;\n\t\t};\n\t}\n\n\tvar isElement = isNodeType(1);\n\n\tfunction matchNodeNames(names) {\n\t\tnames = names.toLowerCase().split(' ');\n\n\t\treturn function(node) {\n\t\t\tvar i, name;\n\n\t\t\tif (node && node.nodeType) {\n\t\t\t\tname = node.nodeName.toLowerCase();\n\n\t\t\t\tfor (i = 0; i < names.length; i++) {\n\t\t\t\t\tif (name === names[i]) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t}\n\n\tfunction matchStyleValues(name, values) {\n\t\tvalues = values.toLowerCase().split(' ');\n\n\t\treturn function(node) {\n\t\t\tvar i, cssValue;\n\n\t\t\tif (isElement(node)) {\n\t\t\t\tfor (i = 0; i < values.length; i++) {\n\t\t\t\t\tcssValue = getComputedStyle(node, null).getPropertyValue(name);\n\t\t\t\t\tif (cssValue === values[i]) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t}\n\n\tfunction hasPropValue(propName, propValue) {\n\t\treturn function(node) {\n\t\t\treturn isElement(node) && node[propName] === propValue;\n\t\t};\n\t}\n\n\tfunction hasAttributeValue(attrName, attrValue) {\n\t\treturn function(node) {\n\t\t\treturn isElement(node) && node.getAttribute(attrName) === attrValue;\n\t\t};\n\t}\n\n\tfunction isBogus(node) {\n\t\treturn isElement(node) && node.hasAttribute('data-mce-bogus');\n\t}\n\n\tfunction hasContentEditableState(value) {\n\t\treturn function(node) {\n\t\t\tif (isElement(node)) {\n\t\t\t\tif (node.contentEditable === value) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (node.getAttribute('data-mce-contenteditable') === value) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t}\n\n\treturn {\n\t\tisText: isNodeType(3),\n\t\tisElement: isElement,\n\t\tisComment: isNodeType(8),\n\t\tisBr: matchNodeNames('br'),\n\t\tisContentEditableTrue: hasContentEditableState('true'),\n\t\tisContentEditableFalse: hasContentEditableState('false'),\n\t\tmatchNodeNames: matchNodeNames,\n\t\thasPropValue: hasPropValue,\n\t\thasAttributeValue: hasAttributeValue,\n\t\tmatchStyleValues: matchStyleValues,\n\t\tisBogus: isBogus\n\t};\n});\n\n// Included from: js/tinymce/classes/text/Zwsp.js\n\n/**\n * Zwsp.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility functions for working with zero width space\n * characters used as character containers etc.\n *\n * @private\n * @class tinymce.text.Zwsp\n * @example\n * var isZwsp = Zwsp.isZwsp('\\uFEFF');\n * var abc = Zwsp.trim('a\\uFEFFc');\n */\ndefine(\"tinymce/text/Zwsp\", [], function() {\n\tvar ZWSP = '\\uFEFF';\n\n\tfunction isZwsp(chr) {\n\t\treturn chr == ZWSP;\n\t}\n\n\tfunction trim(str) {\n\t\treturn str.replace(new RegExp(ZWSP, 'g'), '');\n\t}\n\n\treturn {\n\t\tisZwsp: isZwsp,\n\t\tZWSP: ZWSP,\n\t\ttrim: trim\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/CaretContainer.js\n\n/**\n * CaretContainer.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module handles caret containers. A caret container is a node that\n * holds the caret for positional purposes.\n *\n * @private\n * @class tinymce.caret.CaretContainer\n */\ndefine(\"tinymce/caret/CaretContainer\", [\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/text/Zwsp\"\n], function(NodeType, Zwsp) {\n\tvar isElement = NodeType.isElement,\n\t\tisText = NodeType.isText;\n\n\tfunction isCaretContainerBlock(node) {\n\t\tif (isText(node)) {\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn isElement(node) && node.hasAttribute('data-mce-caret');\n\t}\n\n\tfunction isCaretContainerInline(node) {\n\t\treturn isText(node) && Zwsp.isZwsp(node.data);\n\t}\n\n\tfunction isCaretContainer(node) {\n\t\treturn isCaretContainerBlock(node) || isCaretContainerInline(node);\n\t}\n\n\tfunction removeNode(node) {\n\t\tvar parentNode = node.parentNode;\n\t\tif (parentNode) {\n\t\t\tparentNode.removeChild(node);\n\t\t}\n\t}\n\n\tfunction getNodeValue(node) {\n\t\ttry {\n\t\t\treturn node.nodeValue;\n\t\t} catch (ex) {\n\t\t\t// IE sometimes produces \"Invalid argument\" on nodes\n\t\t\treturn \"\";\n\t\t}\n\t}\n\n\tfunction setNodeValue(node, text) {\n\t\tif (text.length === 0) {\n\t\t\tremoveNode(node);\n\t\t} else {\n\t\t\tnode.nodeValue = text;\n\t\t}\n\t}\n\n\tfunction insertInline(node, before) {\n\t\tvar doc, sibling, textNode, parentNode;\n\n\t\tdoc = node.ownerDocument;\n\t\ttextNode = doc.createTextNode(Zwsp.ZWSP);\n\t\tparentNode = node.parentNode;\n\n\t\tif (!before) {\n\t\t\tsibling = node.nextSibling;\n\t\t\tif (isText(sibling)) {\n\t\t\t\tif (isCaretContainer(sibling)) {\n\t\t\t\t\treturn sibling;\n\t\t\t\t}\n\n\t\t\t\tif (startsWithCaretContainer(sibling)) {\n\t\t\t\t\tsibling.splitText(1);\n\t\t\t\t\treturn sibling;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (node.nextSibling) {\n\t\t\t\tparentNode.insertBefore(textNode, node.nextSibling);\n\t\t\t} else {\n\t\t\t\tparentNode.appendChild(textNode);\n\t\t\t}\n\t\t} else {\n\t\t\tsibling = node.previousSibling;\n\t\t\tif (isText(sibling)) {\n\t\t\t\tif (isCaretContainer(sibling)) {\n\t\t\t\t\treturn sibling;\n\t\t\t\t}\n\n\t\t\t\tif (endsWithCaretContainer(sibling)) {\n\t\t\t\t\treturn sibling.splitText(sibling.data.length - 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tparentNode.insertBefore(textNode, node);\n\t\t}\n\n\t\treturn textNode;\n\t}\n\n\tfunction createBogusBr() {\n\t\tvar br = document.createElement('br');\n\t\tbr.setAttribute('data-mce-bogus', '1');\n\t\treturn br;\n\t}\n\n\tfunction insertBlock(blockName, node, before) {\n\t\tvar doc, blockNode, parentNode;\n\n\t\tdoc = node.ownerDocument;\n\t\tblockNode = doc.createElement(blockName);\n\t\tblockNode.setAttribute('data-mce-caret', before ? 'before' : 'after');\n\t\tblockNode.setAttribute('data-mce-bogus', 'all');\n\t\tblockNode.appendChild(createBogusBr());\n\t\tparentNode = node.parentNode;\n\n\t\tif (!before) {\n\t\t\tif (node.nextSibling) {\n\t\t\t\tparentNode.insertBefore(blockNode, node.nextSibling);\n\t\t\t} else {\n\t\t\t\tparentNode.appendChild(blockNode);\n\t\t\t}\n\t\t} else {\n\t\t\tparentNode.insertBefore(blockNode, node);\n\t\t}\n\n\t\treturn blockNode;\n\t}\n\n\tfunction hasContent(node) {\n\t\treturn node.firstChild !== node.lastChild || !NodeType.isBr(node.firstChild);\n\t}\n\n\tfunction remove(caretContainerNode) {\n\t\tif (isElement(caretContainerNode) && isCaretContainer(caretContainerNode)) {\n\t\t\tif (hasContent(caretContainerNode)) {\n\t\t\t\tcaretContainerNode.removeAttribute('data-mce-caret');\n\t\t\t} else {\n\t\t\t\tremoveNode(caretContainerNode);\n\t\t\t}\n\t\t}\n\n\t\tif (isText(caretContainerNode)) {\n\t\t\tvar text = Zwsp.trim(getNodeValue(caretContainerNode));\n\t\t\tsetNodeValue(caretContainerNode, text);\n\t\t}\n\t}\n\n\tfunction startsWithCaretContainer(node) {\n\t\treturn isText(node) && node.data[0] == Zwsp.ZWSP;\n\t}\n\n\tfunction endsWithCaretContainer(node) {\n\t\treturn isText(node) && node.data[node.data.length - 1] == Zwsp.ZWSP;\n\t}\n\n\tfunction trimBogusBr(elm) {\n\t\tvar brs = elm.getElementsByTagName('br');\n\t\tvar lastBr = brs[brs.length - 1];\n\t\tif (NodeType.isBogus(lastBr)) {\n\t\t\tlastBr.parentNode.removeChild(lastBr);\n\t\t}\n\t}\n\n\tfunction showCaretContainerBlock(caretContainer) {\n\t\tif (caretContainer && caretContainer.hasAttribute('data-mce-caret')) {\n\t\t\ttrimBogusBr(caretContainer);\n\t\t\tcaretContainer.removeAttribute('data-mce-caret');\n\t\t\tcaretContainer.removeAttribute('data-mce-bogus');\n\t\t\tcaretContainer.removeAttribute('style');\n\t\t\tcaretContainer.removeAttribute('_moz_abspos');\n\t\t\treturn caretContainer;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\treturn {\n\t\tisCaretContainer: isCaretContainer,\n\t\tisCaretContainerBlock: isCaretContainerBlock,\n\t\tisCaretContainerInline: isCaretContainerInline,\n\t\tshowCaretContainerBlock: showCaretContainerBlock,\n\t\tinsertInline: insertInline,\n\t\tinsertBlock: insertBlock,\n\t\thasContent: hasContent,\n\t\tremove: remove,\n\t\tstartsWithCaretContainer: startsWithCaretContainer,\n\t\tendsWithCaretContainer: endsWithCaretContainer\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/RangeUtils.js\n\n/**\n * RangeUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains a few utility methods for ranges.\n *\n * @class tinymce.dom.RangeUtils\n */\ndefine(\"tinymce/dom/RangeUtils\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/Range\",\n\t\"tinymce/caret/CaretContainer\"\n], function(Tools, TreeWalker, NodeType, Range, CaretContainer) {\n\tvar each = Tools.each,\n\t\tisContentEditableTrue = NodeType.isContentEditableTrue,\n\t\tisContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tisCaretContainer = CaretContainer.isCaretContainer;\n\n\tfunction hasCeProperty(node) {\n\t\treturn isContentEditableTrue(node) || isContentEditableFalse(node);\n\t}\n\n\tfunction getEndChild(container, index) {\n\t\tvar childNodes = container.childNodes;\n\n\t\tindex--;\n\n\t\tif (index > childNodes.length - 1) {\n\t\t\tindex = childNodes.length - 1;\n\t\t} else if (index < 0) {\n\t\t\tindex = 0;\n\t\t}\n\n\t\treturn childNodes[index] || container;\n\t}\n\n\tfunction findParent(node, rootNode, predicate) {\n\t\twhile (node && node !== rootNode) {\n\t\t\tif (predicate(node)) {\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction hasParent(node, rootNode, predicate) {\n\t\treturn findParent(node, rootNode, predicate) !== null;\n\t}\n\n\tfunction isFormatterCaret(node) {\n\t\treturn node.id === '_mce_caret';\n\t}\n\n\tfunction isCeFalseCaretContainer(node, rootNode) {\n\t\treturn isCaretContainer(node) && hasParent(node, rootNode, isFormatterCaret) === false;\n\t}\n\n\tfunction RangeUtils(dom) {\n\t\t/**\n\t\t * Walks the specified range like object and executes the callback for each sibling collection it finds.\n\t\t *\n\t\t * @private\n\t\t * @method walk\n\t\t * @param {Object} rng Range like object.\n\t\t * @param {function} callback Callback function to execute for each sibling collection.\n\t\t */\n\t\tthis.walk = function(rng, callback) {\n\t\t\tvar startContainer = rng.startContainer,\n\t\t\t\tstartOffset = rng.startOffset,\n\t\t\t\tendContainer = rng.endContainer,\n\t\t\t\tendOffset = rng.endOffset,\n\t\t\t\tancestor, startPoint,\n\t\t\t\tendPoint, node, parent, siblings, nodes;\n\n\t\t\t// Handle table cell selection the table plugin enables\n\t\t\t// you to fake select table cells and perform formatting actions on them\n\t\t\tnodes = dom.select('td[data-mce-selected],th[data-mce-selected]');\n\t\t\tif (nodes.length > 0) {\n\t\t\t\teach(nodes, function(node) {\n\t\t\t\t\tcallback([node]);\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Excludes start/end text node if they are out side the range\n\t\t\t *\n\t\t\t * @private\n\t\t\t * @param {Array} nodes Nodes to exclude items from.\n\t\t\t * @return {Array} Array with nodes excluding the start/end container if needed.\n\t\t\t */\n\t\t\tfunction exclude(nodes) {\n\t\t\t\tvar node;\n\n\t\t\t\t// First node is excluded\n\t\t\t\tnode = nodes[0];\n\t\t\t\tif (node.nodeType === 3 && node === startContainer && startOffset >= node.nodeValue.length) {\n\t\t\t\t\tnodes.splice(0, 1);\n\t\t\t\t}\n\n\t\t\t\t// Last node is excluded\n\t\t\t\tnode = nodes[nodes.length - 1];\n\t\t\t\tif (endOffset === 0 && nodes.length > 0 && node === endContainer && node.nodeType === 3) {\n\t\t\t\t\tnodes.splice(nodes.length - 1, 1);\n\t\t\t\t}\n\n\t\t\t\treturn nodes;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Collects siblings\n\t\t\t *\n\t\t\t * @private\n\t\t\t * @param {Node} node Node to collect siblings from.\n\t\t\t * @param {String} name Name of the sibling to check for.\n\t\t\t * @param {Node} end_node\n\t\t\t * @return {Array} Array of collected siblings.\n\t\t\t */\n\t\t\tfunction collectSiblings(node, name, end_node) {\n\t\t\t\tvar siblings = [];\n\n\t\t\t\tfor (; node && node != end_node; node = node[name]) {\n\t\t\t\t\tsiblings.push(node);\n\t\t\t\t}\n\n\t\t\t\treturn siblings;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Find an end point this is the node just before the common ancestor root.\n\t\t\t *\n\t\t\t * @private\n\t\t\t * @param {Node} node Node to start at.\n\t\t\t * @param {Node} root Root/ancestor element to stop just before.\n\t\t\t * @return {Node} Node just before the root element.\n\t\t\t */\n\t\t\tfunction findEndPoint(node, root) {\n\t\t\t\tdo {\n\t\t\t\t\tif (node.parentNode == root) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t} while (node);\n\t\t\t}\n\n\t\t\tfunction walkBoundary(start_node, end_node, next) {\n\t\t\t\tvar siblingName = next ? 'nextSibling' : 'previousSibling';\n\n\t\t\t\tfor (node = start_node, parent = node.parentNode; node && node != end_node; node = parent) {\n\t\t\t\t\tparent = node.parentNode;\n\t\t\t\t\tsiblings = collectSiblings(node == start_node ? node : node[siblingName], siblingName);\n\n\t\t\t\t\tif (siblings.length) {\n\t\t\t\t\t\tif (!next) {\n\t\t\t\t\t\t\tsiblings.reverse();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcallback(exclude(siblings));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If index based start position then resolve it\n\t\t\tif (startContainer.nodeType == 1 && startContainer.hasChildNodes()) {\n\t\t\t\tstartContainer = startContainer.childNodes[startOffset];\n\t\t\t}\n\n\t\t\t// If index based end position then resolve it\n\t\t\tif (endContainer.nodeType == 1 && endContainer.hasChildNodes()) {\n\t\t\t\tendContainer = getEndChild(endContainer, endOffset);\n\t\t\t}\n\n\t\t\t// Same container\n\t\t\tif (startContainer == endContainer) {\n\t\t\t\treturn callback(exclude([startContainer]));\n\t\t\t}\n\n\t\t\t// Find common ancestor and end points\n\t\t\tancestor = dom.findCommonAncestor(startContainer, endContainer);\n\n\t\t\t// Process left side\n\t\t\tfor (node = startContainer; node; node = node.parentNode) {\n\t\t\t\tif (node === endContainer) {\n\t\t\t\t\treturn walkBoundary(startContainer, ancestor, true);\n\t\t\t\t}\n\n\t\t\t\tif (node === ancestor) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Process right side\n\t\t\tfor (node = endContainer; node; node = node.parentNode) {\n\t\t\t\tif (node === startContainer) {\n\t\t\t\t\treturn walkBoundary(endContainer, ancestor);\n\t\t\t\t}\n\n\t\t\t\tif (node === ancestor) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Find start/end point\n\t\t\tstartPoint = findEndPoint(startContainer, ancestor) || startContainer;\n\t\t\tendPoint = findEndPoint(endContainer, ancestor) || endContainer;\n\n\t\t\t// Walk left leaf\n\t\t\twalkBoundary(startContainer, startPoint, true);\n\n\t\t\t// Walk the middle from start to end point\n\t\t\tsiblings = collectSiblings(\n\t\t\t\tstartPoint == startContainer ? startPoint : startPoint.nextSibling,\n\t\t\t\t'nextSibling',\n\t\t\t\tendPoint == endContainer ? endPoint.nextSibling : endPoint\n\t\t\t);\n\n\t\t\tif (siblings.length) {\n\t\t\t\tcallback(exclude(siblings));\n\t\t\t}\n\n\t\t\t// Walk right leaf\n\t\t\twalkBoundary(endContainer, endPoint);\n\t\t};\n\n\t\t/**\n\t\t * Splits the specified range at it's start/end points.\n\t\t *\n\t\t * @private\n\t\t * @param {Range/RangeObject} rng Range to split.\n\t\t * @return {Object} Range position object.\n\t\t */\n\t\tthis.split = function(rng) {\n\t\t\tvar startContainer = rng.startContainer,\n\t\t\t\tstartOffset = rng.startOffset,\n\t\t\t\tendContainer = rng.endContainer,\n\t\t\t\tendOffset = rng.endOffset;\n\n\t\t\tfunction splitText(node, offset) {\n\t\t\t\treturn node.splitText(offset);\n\t\t\t}\n\n\t\t\t// Handle single text node\n\t\t\tif (startContainer == endContainer && startContainer.nodeType == 3) {\n\t\t\t\tif (startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n\t\t\t\t\tendContainer = splitText(startContainer, startOffset);\n\t\t\t\t\tstartContainer = endContainer.previousSibling;\n\n\t\t\t\t\tif (endOffset > startOffset) {\n\t\t\t\t\t\tendOffset = endOffset - startOffset;\n\t\t\t\t\t\tstartContainer = endContainer = splitText(endContainer, endOffset).previousSibling;\n\t\t\t\t\t\tendOffset = endContainer.nodeValue.length;\n\t\t\t\t\t\tstartOffset = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tendOffset = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Split startContainer text node if needed\n\t\t\t\tif (startContainer.nodeType == 3 && startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n\t\t\t\t\tstartContainer = splitText(startContainer, startOffset);\n\t\t\t\t\tstartOffset = 0;\n\t\t\t\t}\n\n\t\t\t\t// Split endContainer text node if needed\n\t\t\t\tif (endContainer.nodeType == 3 && endOffset > 0 && endOffset < endContainer.nodeValue.length) {\n\t\t\t\t\tendContainer = splitText(endContainer, endOffset).previousSibling;\n\t\t\t\t\tendOffset = endContainer.nodeValue.length;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tstartContainer: startContainer,\n\t\t\t\tstartOffset: startOffset,\n\t\t\t\tendContainer: endContainer,\n\t\t\t\tendOffset: endOffset\n\t\t\t};\n\t\t};\n\n\t\t/**\n\t\t * Normalizes the specified range by finding the closest best suitable caret location.\n\t\t *\n\t\t * @private\n\t\t * @param {Range} rng Range to normalize.\n\t\t * @return {Boolean} True/false if the specified range was normalized or not.\n\t\t */\n\t\tthis.normalize = function(rng) {\n\t\t\tvar normalized, collapsed;\n\n\t\t\tfunction normalizeEndPoint(start) {\n\t\t\t\tvar container, offset, walker, body = dom.getRoot(), node, nonEmptyElementsMap;\n\t\t\t\tvar directionLeft, isAfterNode;\n\n\t\t\t\tfunction isTableCell(node) {\n\t\t\t\t\treturn node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\n\t\t\t\t}\n\n\t\t\t\tfunction hasBrBeforeAfter(node, left) {\n\t\t\t\t\tvar walker = new TreeWalker(node, dom.getParent(node.parentNode, dom.isBlock) || body);\n\n\t\t\t\t\twhile ((node = walker[left ? 'prev' : 'next']())) {\n\t\t\t\t\t\tif (node.nodeName === \"BR\") {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction hasContentEditableFalseParent(node) {\n\t\t\t\t\twhile (node && node != body) {\n\t\t\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tfunction isPrevNode(node, name) {\n\t\t\t\t\treturn node.previousSibling && node.previousSibling.nodeName == name;\n\t\t\t\t}\n\n\t\t\t\t// Walks the dom left/right to find a suitable text node to move the endpoint into\n\t\t\t\t// It will only walk within the current parent block or body and will stop if it hits a block or a BR/IMG\n\t\t\t\tfunction findTextNodeRelative(left, startNode) {\n\t\t\t\t\tvar walker, lastInlineElement, parentBlockContainer;\n\n\t\t\t\t\tstartNode = startNode || container;\n\t\t\t\t\tparentBlockContainer = dom.getParent(startNode.parentNode, dom.isBlock) || body;\n\n\t\t\t\t\t// Lean left before the BR element if it's the only BR within a block element. Gecko bug: #6680\n\t\t\t\t\t// This: <p><br>|</p> becomes <p>|<br></p>\n\t\t\t\t\tif (left && startNode.nodeName == 'BR' && isAfterNode && dom.isEmpty(parentBlockContainer)) {\n\t\t\t\t\t\tcontainer = startNode.parentNode;\n\t\t\t\t\t\toffset = dom.nodeIndex(startNode);\n\t\t\t\t\t\tnormalized = true;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Walk left until we hit a text node we can move to or a block/br/img\n\t\t\t\t\twalker = new TreeWalker(startNode, parentBlockContainer);\n\t\t\t\t\twhile ((node = walker[left ? 'prev' : 'next']())) {\n\t\t\t\t\t\t// Break if we hit a non content editable node\n\t\t\t\t\t\tif (dom.getContentEditableParent(node) === \"false\" || isCeFalseCaretContainer(node, dom.getRoot())) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Found text node that has a length\n\t\t\t\t\t\tif (node.nodeType === 3 && node.nodeValue.length > 0) {\n\t\t\t\t\t\t\tcontainer = node;\n\t\t\t\t\t\t\toffset = left ? node.nodeValue.length : 0;\n\t\t\t\t\t\t\tnormalized = true;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Break if we find a block or a BR/IMG/INPUT etc\n\t\t\t\t\t\tif (dom.isBlock(node) || nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlastInlineElement = node;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Only fetch the last inline element when in caret mode for now\n\t\t\t\t\tif (collapsed && lastInlineElement) {\n\t\t\t\t\t\tcontainer = lastInlineElement;\n\t\t\t\t\t\tnormalized = true;\n\t\t\t\t\t\toffset = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcontainer = rng[(start ? 'start' : 'end') + 'Container'];\n\t\t\t\toffset = rng[(start ? 'start' : 'end') + 'Offset'];\n\t\t\t\tisAfterNode = container.nodeType == 1 && offset === container.childNodes.length;\n\t\t\t\tnonEmptyElementsMap = dom.schema.getNonEmptyElements();\n\t\t\t\tdirectionLeft = start;\n\n\t\t\t\tif (isCaretContainer(container)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (container.nodeType == 1 && offset > container.childNodes.length - 1) {\n\t\t\t\t\tdirectionLeft = false;\n\t\t\t\t}\n\n\t\t\t\t// If the container is a document move it to the body element\n\t\t\t\tif (container.nodeType === 9) {\n\t\t\t\t\tcontainer = dom.getRoot();\n\t\t\t\t\toffset = 0;\n\t\t\t\t}\n\n\t\t\t\t// If the container is body try move it into the closest text node or position\n\t\t\t\tif (container === body) {\n\t\t\t\t\t// If start is before/after a image, table etc\n\t\t\t\t\tif (directionLeft) {\n\t\t\t\t\t\tnode = container.childNodes[offset > 0 ? offset - 1 : 0];\n\t\t\t\t\t\tif (node) {\n\t\t\t\t\t\t\tif (isCaretContainer(node)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (nonEmptyElementsMap[node.nodeName] || node.nodeName == \"TABLE\") {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Resolve the index\n\t\t\t\t\tif (container.hasChildNodes()) {\n\t\t\t\t\t\toffset = Math.min(!directionLeft && offset > 0 ? offset - 1 : offset, container.childNodes.length - 1);\n\t\t\t\t\t\tcontainer = container.childNodes[offset];\n\t\t\t\t\t\toffset = 0;\n\n\t\t\t\t\t\t// Don't normalize non collapsed selections like <p>[a</p><table></table>]\n\t\t\t\t\t\tif (!collapsed && container === body.lastChild && container.nodeName === 'TABLE') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (hasContentEditableFalseParent(container) || isCaretContainer(container)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Don't walk into elements that doesn't have any child nodes like a IMG\n\t\t\t\t\t\tif (container.hasChildNodes() && !/TABLE/.test(container.nodeName)) {\n\t\t\t\t\t\t\t// Walk the DOM to find a text node to place the caret at or a BR\n\t\t\t\t\t\t\tnode = container;\n\t\t\t\t\t\t\twalker = new TreeWalker(container, body);\n\n\t\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\t\tif (isContentEditableFalse(node) || isCaretContainer(node)) {\n\t\t\t\t\t\t\t\t\tnormalized = false;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Found a text node use that position\n\t\t\t\t\t\t\t\tif (node.nodeType === 3 && node.nodeValue.length > 0) {\n\t\t\t\t\t\t\t\t\toffset = directionLeft ? 0 : node.nodeValue.length;\n\t\t\t\t\t\t\t\t\tcontainer = node;\n\t\t\t\t\t\t\t\t\tnormalized = true;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Found a BR/IMG element that we can place the caret before\n\t\t\t\t\t\t\t\tif (nonEmptyElementsMap[node.nodeName.toLowerCase()] && !isTableCell(node)) {\n\t\t\t\t\t\t\t\t\toffset = dom.nodeIndex(node);\n\t\t\t\t\t\t\t\t\tcontainer = node.parentNode;\n\n\t\t\t\t\t\t\t\t\t// Put caret after image when moving the end point\n\t\t\t\t\t\t\t\t\tif (node.nodeName == \"IMG\" && !directionLeft) {\n\t\t\t\t\t\t\t\t\t\toffset++;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tnormalized = true;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} while ((node = (directionLeft ? walker.next() : walker.prev())));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Lean the caret to the left if possible\n\t\t\t\tif (collapsed) {\n\t\t\t\t\t// So this: <b>x</b><i>|x</i>\n\t\t\t\t\t// Becomes: <b>x|</b><i>x</i>\n\t\t\t\t\t// Seems that only gecko has issues with this\n\t\t\t\t\tif (container.nodeType === 3 && offset === 0) {\n\t\t\t\t\t\tfindTextNodeRelative(true);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Lean left into empty inline elements when the caret is before a BR\n\t\t\t\t\t// So this: <i><b></b><i>|<br></i>\n\t\t\t\t\t// Becomes: <i><b>|</b><i><br></i>\n\t\t\t\t\t// Seems that only gecko has issues with this.\n\t\t\t\t\t// Special edge case for <p><a>x</a>|<br></p> since we don't want <p><a>x|</a><br></p>\n\t\t\t\t\tif (container.nodeType === 1) {\n\t\t\t\t\t\tnode = container.childNodes[offset];\n\n\t\t\t\t\t\t// Offset is after the containers last child\n\t\t\t\t\t\t// then use the previous child for normalization\n\t\t\t\t\t\tif (!node) {\n\t\t\t\t\t\t\tnode = container.childNodes[offset - 1];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (node && node.nodeName === 'BR' && !isPrevNode(node, 'A') &&\n\t\t\t\t\t\t\t!hasBrBeforeAfter(node) && !hasBrBeforeAfter(node, true)) {\n\t\t\t\t\t\t\tfindTextNodeRelative(true, node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Lean the start of the selection right if possible\n\t\t\t\t// So this: x[<b>x]</b>\n\t\t\t\t// Becomes: x<b>[x]</b>\n\t\t\t\tif (directionLeft && !collapsed && container.nodeType === 3 && offset === container.nodeValue.length) {\n\t\t\t\t\tfindTextNodeRelative(false);\n\t\t\t\t}\n\n\t\t\t\t// Set endpoint if it was normalized\n\t\t\t\tif (normalized) {\n\t\t\t\t\trng['set' + (start ? 'Start' : 'End')](container, offset);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcollapsed = rng.collapsed;\n\n\t\t\tnormalizeEndPoint(true);\n\n\t\t\tif (!collapsed) {\n\t\t\t\tnormalizeEndPoint();\n\t\t\t}\n\n\t\t\t// If it was collapsed then make sure it still is\n\t\t\tif (normalized && collapsed) {\n\t\t\t\trng.collapse(true);\n\t\t\t}\n\n\t\t\treturn normalized;\n\t\t};\n\t}\n\n\t/**\n\t * Compares two ranges and checks if they are equal.\n\t *\n\t * @static\n\t * @method compareRanges\n\t * @param {DOMRange} rng1 First range to compare.\n\t * @param {DOMRange} rng2 First range to compare.\n\t * @return {Boolean} true/false if the ranges are equal.\n\t */\n\tRangeUtils.compareRanges = function(rng1, rng2) {\n\t\tif (rng1 && rng2) {\n\t\t\t// Compare native IE ranges\n\t\t\tif (rng1.item || rng1.duplicate) {\n\t\t\t\t// Both are control ranges and the selected element matches\n\t\t\t\tif (rng1.item && rng2.item && rng1.item(0) === rng2.item(0)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// Both are text ranges and the range matches\n\t\t\t\tif (rng1.isEqual && rng2.isEqual && rng2.isEqual(rng1)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Compare w3c ranges\n\t\t\t\treturn rng1.startContainer == rng2.startContainer && rng1.startOffset == rng2.startOffset;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\t/**\n\t * Finds the closest selection rect tries to get the range from that.\n\t */\n\tfunction findClosestIeRange(clientX, clientY, doc) {\n\t\tvar element, rng, rects;\n\n\t\telement = doc.elementFromPoint(clientX, clientY);\n\t\trng = doc.body.createTextRange();\n\n\t\tif (!element || element.tagName == 'HTML') {\n\t\t\telement = doc.body;\n\t\t}\n\n\t\trng.moveToElementText(element);\n\t\trects = Tools.toArray(rng.getClientRects());\n\n\t\trects = rects.sort(function(a, b) {\n\t\t\ta = Math.abs(Math.max(a.top - clientY, a.bottom - clientY));\n\t\t\tb = Math.abs(Math.max(b.top - clientY, b.bottom - clientY));\n\n\t\t\treturn a - b;\n\t\t});\n\n\t\tif (rects.length > 0) {\n\t\t\tclientY = (rects[0].bottom + rects[0].top) / 2;\n\n\t\t\ttry {\n\t\t\t\trng.moveToPoint(clientX, clientY);\n\t\t\t\trng.collapse(true);\n\n\t\t\t\treturn rng;\n\t\t\t} catch (ex) {\n\t\t\t\t// At least we tried\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction moveOutOfContentEditableFalse(rng, rootNode) {\n\t\tvar parentElement = rng && rng.parentElement ? rng.parentElement() : null;\n\t\treturn isContentEditableFalse(findParent(parentElement, rootNode, hasCeProperty)) ? null : rng;\n\t}\n\n\t/**\n\t * Gets the caret range for the given x/y location.\n\t *\n\t * @static\n\t * @method getCaretRangeFromPoint\n\t * @param {Number} clientX X coordinate for range\n\t * @param {Number} clientY Y coordinate for range\n\t * @param {Document} doc Document that x/y are relative to\n\t * @returns {Range} caret range\n\t */\n\tRangeUtils.getCaretRangeFromPoint = function(clientX, clientY, doc) {\n\t\tvar rng, point;\n\n\t\tif (doc.caretPositionFromPoint) {\n\t\t\tpoint = doc.caretPositionFromPoint(clientX, clientY);\n\t\t\trng = doc.createRange();\n\t\t\trng.setStart(point.offsetNode, point.offset);\n\t\t\trng.collapse(true);\n\t\t} else if (doc.caretRangeFromPoint) {\n\t\t\trng = doc.caretRangeFromPoint(clientX, clientY);\n\t\t} else if (doc.body.createTextRange) {\n\t\t\trng = doc.body.createTextRange();\n\n\t\t\ttry {\n\t\t\t\trng.moveToPoint(clientX, clientY);\n\t\t\t\trng.collapse(true);\n\t\t\t} catch (ex) {\n\t\t\t\trng = findClosestIeRange(clientX, clientY, doc);\n\t\t\t}\n\n\t\t\treturn moveOutOfContentEditableFalse(rng, doc.body);\n\t\t}\n\n\t\treturn rng;\n\t};\n\n\tRangeUtils.getSelectedNode = function(range) {\n\t\tvar startContainer = range.startContainer,\n\t\t\tstartOffset = range.startOffset;\n\n\t\tif (startContainer.hasChildNodes() && range.endOffset == startOffset + 1) {\n\t\t\treturn startContainer.childNodes[startOffset];\n\t\t}\n\n\t\treturn null;\n\t};\n\n\tRangeUtils.getNode = function(container, offset) {\n\t\tif (container.nodeType == 1 && container.hasChildNodes()) {\n\t\t\tif (offset >= container.childNodes.length) {\n\t\t\t\toffset = container.childNodes.length - 1;\n\t\t\t}\n\n\t\t\tcontainer = container.childNodes[offset];\n\t\t}\n\n\t\treturn container;\n\t};\n\n\treturn RangeUtils;\n});\n\n// Included from: js/tinymce/classes/NodeChange.js\n\n/**\n * NodeChange.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles the nodechange event dispatching both manual and through selection change events.\n *\n * @class tinymce.NodeChange\n * @private\n */\ndefine(\"tinymce/NodeChange\", [\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Delay\"\n], function(RangeUtils, Env, Delay) {\n\treturn function(editor) {\n\t\tvar lastRng, lastPath = [];\n\n\t\t/**\n\t\t * Returns true/false if the current element path has been changed or not.\n\t\t *\n\t\t * @private\n\t\t * @return {Boolean} True if the element path is the same false if it's not.\n\t\t */\n\t\tfunction isSameElementPath(startElm) {\n\t\t\tvar i, currentPath;\n\n\t\t\tcurrentPath = editor.$(startElm).parentsUntil(editor.getBody()).add(startElm);\n\t\t\tif (currentPath.length === lastPath.length) {\n\t\t\t\tfor (i = currentPath.length; i >= 0; i--) {\n\t\t\t\t\tif (currentPath[i] !== lastPath[i]) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (i === -1) {\n\t\t\t\t\tlastPath = currentPath;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlastPath = currentPath;\n\n\t\t\treturn false;\n\t\t}\n\n\t\t// Gecko doesn't support the \"selectionchange\" event\n\t\tif (!('onselectionchange' in editor.getDoc())) {\n\t\t\teditor.on('NodeChange Click MouseUp KeyUp Focus', function(e) {\n\t\t\t\tvar nativeRng, fakeRng;\n\n\t\t\t\t// Since DOM Ranges mutate on modification\n\t\t\t\t// of the DOM we need to clone it's contents\n\t\t\t\tnativeRng = editor.selection.getRng();\n\t\t\t\tfakeRng = {\n\t\t\t\t\tstartContainer: nativeRng.startContainer,\n\t\t\t\t\tstartOffset: nativeRng.startOffset,\n\t\t\t\t\tendContainer: nativeRng.endContainer,\n\t\t\t\t\tendOffset: nativeRng.endOffset\n\t\t\t\t};\n\n\t\t\t\t// Always treat nodechange as a selectionchange since applying\n\t\t\t\t// formatting to the current range wouldn't update the range but it's parent\n\t\t\t\tif (e.type == 'nodechange' || !RangeUtils.compareRanges(fakeRng, lastRng)) {\n\t\t\t\t\teditor.fire('SelectionChange');\n\t\t\t\t}\n\n\t\t\t\tlastRng = fakeRng;\n\t\t\t});\n\t\t}\n\n\t\t// IE has a bug where it fires a selectionchange on right click that has a range at the start of the body\n\t\t// When the contextmenu event fires the selection is located at the right location\n\t\teditor.on('contextmenu', function() {\n\t\t\teditor.fire('SelectionChange');\n\t\t});\n\n\t\t// Selection change is delayed ~200ms on IE when you click inside the current range\n\t\teditor.on('SelectionChange', function() {\n\t\t\tvar startElm = editor.selection.getStart(true);\n\n\t\t\t// IE 8 will fire a selectionchange event with an incorrect selection\n\t\t\t// when focusing out of table cells. Click inside cell -> toolbar = Invalid SelectionChange event\n\t\t\tif (!Env.range && editor.selection.isCollapsed()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!isSameElementPath(startElm) && editor.dom.isChildOf(startElm, editor.getBody())) {\n\t\t\t\teditor.nodeChanged({selectionChange: true});\n\t\t\t}\n\t\t});\n\n\t\t// Fire an extra nodeChange on mouseup for compatibility reasons\n\t\teditor.on('MouseUp', function(e) {\n\t\t\tif (!e.isDefaultPrevented()) {\n\t\t\t\t// Delay nodeChanged call for WebKit edge case issue where the range\n\t\t\t\t// isn't updated until after you click outside a selected image\n\t\t\t\tif (editor.selection.getNode().nodeName == 'IMG') {\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t/**\n\t\t * Dispatches out a onNodeChange event to all observers. This method should be called when you\n\t\t * need to update the UI states or element path etc.\n\t\t *\n\t\t * @method nodeChanged\n\t\t * @param {Object} args Optional args to pass to NodeChange event handlers.\n\t\t */\n\t\tthis.nodeChanged = function(args) {\n\t\t\tvar selection = editor.selection, node, parents, root;\n\n\t\t\t// Fix for bug #1896577 it seems that this can not be fired while the editor is loading\n\t\t\tif (editor.initialized && selection && !editor.settings.disable_nodechange && !editor.readonly) {\n\t\t\t\t// Get start node\n\t\t\t\troot = editor.getBody();\n\t\t\t\tnode = selection.getStart() || root;\n\n\t\t\t\t// Make sure the node is within the editor root or is the editor root\n\t\t\t\tif (node.ownerDocument != editor.getDoc() || !editor.dom.isChildOf(node, root)) {\n\t\t\t\t\tnode = root;\n\t\t\t\t}\n\n\t\t\t\t// Edge case for <p>|<img></p>\n\t\t\t\tif (node.nodeName == 'IMG' && selection.isCollapsed()) {\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\n\t\t\t\t// Get parents and add them to object\n\t\t\t\tparents = [];\n\t\t\t\teditor.dom.getParent(node, function(node) {\n\t\t\t\t\tif (node === root) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tparents.push(node);\n\t\t\t\t});\n\n\t\t\t\targs = args || {};\n\t\t\t\targs.element = node;\n\t\t\t\targs.parents = parents;\n\n\t\t\t\teditor.fire('NodeChange', args);\n\t\t\t}\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/html/Node.js\n\n/**\n * Node.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is a minimalistic implementation of a DOM like node used by the DomParser class.\n *\n * @example\n * var node = new tinymce.html.Node('strong', 1);\n * someRoot.append(node);\n *\n * @class tinymce.html.Node\n * @version 3.4\n */\ndefine(\"tinymce/html/Node\", [], function() {\n\tvar whiteSpaceRegExp = /^[ \\t\\r\\n]*$/, typeLookup = {\n\t\t'#text': 3,\n\t\t'#comment': 8,\n\t\t'#cdata': 4,\n\t\t'#pi': 7,\n\t\t'#doctype': 10,\n\t\t'#document-fragment': 11\n\t};\n\n\t// Walks the tree left/right\n\tfunction walk(node, root_node, prev) {\n\t\tvar sibling, parent, startName = prev ? 'lastChild' : 'firstChild', siblingName = prev ? 'prev' : 'next';\n\n\t\t// Walk into nodes if it has a start\n\t\tif (node[startName]) {\n\t\t\treturn node[startName];\n\t\t}\n\n\t\t// Return the sibling if it has one\n\t\tif (node !== root_node) {\n\t\t\tsibling = node[siblingName];\n\n\t\t\tif (sibling) {\n\t\t\t\treturn sibling;\n\t\t\t}\n\n\t\t\t// Walk up the parents to look for siblings\n\t\t\tfor (parent = node.parent; parent && parent !== root_node; parent = parent.parent) {\n\t\t\t\tsibling = parent[siblingName];\n\n\t\t\t\tif (sibling) {\n\t\t\t\t\treturn sibling;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Constructs a new Node instance.\n\t *\n\t * @constructor\n\t * @method Node\n\t * @param {String} name Name of the node type.\n\t * @param {Number} type Numeric type representing the node.\n\t */\n\tfunction Node(name, type) {\n\t\tthis.name = name;\n\t\tthis.type = type;\n\n\t\tif (type === 1) {\n\t\t\tthis.attributes = [];\n\t\t\tthis.attributes.map = {};\n\t\t}\n\t}\n\n\tNode.prototype = {\n\t\t/**\n\t\t * Replaces the current node with the specified one.\n\t\t *\n\t\t * @example\n\t\t * someNode.replace(someNewNode);\n\t\t *\n\t\t * @method replace\n\t\t * @param {tinymce.html.Node} node Node to replace the current node with.\n\t\t * @return {tinymce.html.Node} The old node that got replaced.\n\t\t */\n\t\treplace: function(node) {\n\t\t\tvar self = this;\n\n\t\t\tif (node.parent) {\n\t\t\t\tnode.remove();\n\t\t\t}\n\n\t\t\tself.insert(node, self);\n\t\t\tself.remove();\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Gets/sets or removes an attribute by name.\n\t\t *\n\t\t * @example\n\t\t * someNode.attr(\"name\", \"value\"); // Sets an attribute\n\t\t * console.log(someNode.attr(\"name\")); // Gets an attribute\n\t\t * someNode.attr(\"name\", null); // Removes an attribute\n\t\t *\n\t\t * @method attr\n\t\t * @param {String} name Attribute name to set or get.\n\t\t * @param {String} value Optional value to set.\n\t\t * @return {String/tinymce.html.Node} String or undefined on a get operation or the current node on a set operation.\n\t\t */\n\t\tattr: function(name, value) {\n\t\t\tvar self = this, attrs, i, undef;\n\n\t\t\tif (typeof name !== \"string\") {\n\t\t\t\tfor (i in name) {\n\t\t\t\t\tself.attr(i, name[i]);\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\tif ((attrs = self.attributes)) {\n\t\t\t\tif (value !== undef) {\n\t\t\t\t\t// Remove attribute\n\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\tif (name in attrs.map) {\n\t\t\t\t\t\t\tdelete attrs.map[name];\n\n\t\t\t\t\t\t\ti = attrs.length;\n\t\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\t\tif (attrs[i].name === name) {\n\t\t\t\t\t\t\t\t\tattrs = attrs.splice(i, 1);\n\t\t\t\t\t\t\t\t\treturn self;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn self;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Set attribute\n\t\t\t\t\tif (name in attrs.map) {\n\t\t\t\t\t\t// Set attribute\n\t\t\t\t\t\ti = attrs.length;\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tif (attrs[i].name === name) {\n\t\t\t\t\t\t\t\tattrs[i].value = value;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tattrs.push({name: name, value: value});\n\t\t\t\t\t}\n\n\t\t\t\t\tattrs.map[name] = value;\n\n\t\t\t\t\treturn self;\n\t\t\t\t}\n\n\t\t\t\treturn attrs.map[name];\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Does a shallow clones the node into a new node. It will also exclude id attributes since\n\t\t * there should only be one id per document.\n\t\t *\n\t\t * @example\n\t\t * var clonedNode = node.clone();\n\t\t *\n\t\t * @method clone\n\t\t * @return {tinymce.html.Node} New copy of the original node.\n\t\t */\n\t\tclone: function() {\n\t\t\tvar self = this, clone = new Node(self.name, self.type), i, l, selfAttrs, selfAttr, cloneAttrs;\n\n\t\t\t// Clone element attributes\n\t\t\tif ((selfAttrs = self.attributes)) {\n\t\t\t\tcloneAttrs = [];\n\t\t\t\tcloneAttrs.map = {};\n\n\t\t\t\tfor (i = 0, l = selfAttrs.length; i < l; i++) {\n\t\t\t\t\tselfAttr = selfAttrs[i];\n\n\t\t\t\t\t// Clone everything except id\n\t\t\t\t\tif (selfAttr.name !== 'id') {\n\t\t\t\t\t\tcloneAttrs[cloneAttrs.length] = {name: selfAttr.name, value: selfAttr.value};\n\t\t\t\t\t\tcloneAttrs.map[selfAttr.name] = selfAttr.value;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tclone.attributes = cloneAttrs;\n\t\t\t}\n\n\t\t\tclone.value = self.value;\n\t\t\tclone.shortEnded = self.shortEnded;\n\n\t\t\treturn clone;\n\t\t},\n\n\t\t/**\n\t\t * Wraps the node in in another node.\n\t\t *\n\t\t * @example\n\t\t * node.wrap(wrapperNode);\n\t\t *\n\t\t * @method wrap\n\t\t */\n\t\twrap: function(wrapper) {\n\t\t\tvar self = this;\n\n\t\t\tself.parent.insert(wrapper, self);\n\t\t\twrapper.append(self);\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Unwraps the node in other words it removes the node but keeps the children.\n\t\t *\n\t\t * @example\n\t\t * node.unwrap();\n\t\t *\n\t\t * @method unwrap\n\t\t */\n\t\tunwrap: function() {\n\t\t\tvar self = this, node, next;\n\n\t\t\tfor (node = self.firstChild; node;) {\n\t\t\t\tnext = node.next;\n\t\t\t\tself.insert(node, self, true);\n\t\t\t\tnode = next;\n\t\t\t}\n\n\t\t\tself.remove();\n\t\t},\n\n\t\t/**\n\t\t * Removes the node from it's parent.\n\t\t *\n\t\t * @example\n\t\t * node.remove();\n\t\t *\n\t\t * @method remove\n\t\t * @return {tinymce.html.Node} Current node that got removed.\n\t\t */\n\t\tremove: function() {\n\t\t\tvar self = this, parent = self.parent, next = self.next, prev = self.prev;\n\n\t\t\tif (parent) {\n\t\t\t\tif (parent.firstChild === self) {\n\t\t\t\t\tparent.firstChild = next;\n\n\t\t\t\t\tif (next) {\n\t\t\t\t\t\tnext.prev = null;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tprev.next = next;\n\t\t\t\t}\n\n\t\t\t\tif (parent.lastChild === self) {\n\t\t\t\t\tparent.lastChild = prev;\n\n\t\t\t\t\tif (prev) {\n\t\t\t\t\t\tprev.next = null;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tnext.prev = prev;\n\t\t\t\t}\n\n\t\t\t\tself.parent = self.next = self.prev = null;\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Appends a new node as a child of the current node.\n\t\t *\n\t\t * @example\n\t\t * node.append(someNode);\n\t\t *\n\t\t * @method append\n\t\t * @param {tinymce.html.Node} node Node to append as a child of the current one.\n\t\t * @return {tinymce.html.Node} The node that got appended.\n\t\t */\n\t\tappend: function(node) {\n\t\t\tvar self = this, last;\n\n\t\t\tif (node.parent) {\n\t\t\t\tnode.remove();\n\t\t\t}\n\n\t\t\tlast = self.lastChild;\n\t\t\tif (last) {\n\t\t\t\tlast.next = node;\n\t\t\t\tnode.prev = last;\n\t\t\t\tself.lastChild = node;\n\t\t\t} else {\n\t\t\t\tself.lastChild = self.firstChild = node;\n\t\t\t}\n\n\t\t\tnode.parent = self;\n\n\t\t\treturn node;\n\t\t},\n\n\t\t/**\n\t\t * Inserts a node at a specific position as a child of the current node.\n\t\t *\n\t\t * @example\n\t\t * parentNode.insert(newChildNode, oldChildNode);\n\t\t *\n\t\t * @method insert\n\t\t * @param {tinymce.html.Node} node Node to insert as a child of the current node.\n\t\t * @param {tinymce.html.Node} ref_node Reference node to set node before/after.\n\t\t * @param {Boolean} before Optional state to insert the node before the reference node.\n\t\t * @return {tinymce.html.Node} The node that got inserted.\n\t\t */\n\t\tinsert: function(node, ref_node, before) {\n\t\t\tvar parent;\n\n\t\t\tif (node.parent) {\n\t\t\t\tnode.remove();\n\t\t\t}\n\n\t\t\tparent = ref_node.parent || this;\n\n\t\t\tif (before) {\n\t\t\t\tif (ref_node === parent.firstChild) {\n\t\t\t\t\tparent.firstChild = node;\n\t\t\t\t} else {\n\t\t\t\t\tref_node.prev.next = node;\n\t\t\t\t}\n\n\t\t\t\tnode.prev = ref_node.prev;\n\t\t\t\tnode.next = ref_node;\n\t\t\t\tref_node.prev = node;\n\t\t\t} else {\n\t\t\t\tif (ref_node === parent.lastChild) {\n\t\t\t\t\tparent.lastChild = node;\n\t\t\t\t} else {\n\t\t\t\t\tref_node.next.prev = node;\n\t\t\t\t}\n\n\t\t\t\tnode.next = ref_node.next;\n\t\t\t\tnode.prev = ref_node;\n\t\t\t\tref_node.next = node;\n\t\t\t}\n\n\t\t\tnode.parent = parent;\n\n\t\t\treturn node;\n\t\t},\n\n\t\t/**\n\t\t * Get all children by name.\n\t\t *\n\t\t * @method getAll\n\t\t * @param {String} name Name of the child nodes to collect.\n\t\t * @return {Array} Array with child nodes matchin the specified name.\n\t\t */\n\t\tgetAll: function(name) {\n\t\t\tvar self = this, node, collection = [];\n\n\t\t\tfor (node = self.firstChild; node; node = walk(node, self)) {\n\t\t\t\tif (node.name === name) {\n\t\t\t\t\tcollection.push(node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn collection;\n\t\t},\n\n\t\t/**\n\t\t * Removes all children of the current node.\n\t\t *\n\t\t * @method empty\n\t\t * @return {tinymce.html.Node} The current node that got cleared.\n\t\t */\n\t\tempty: function() {\n\t\t\tvar self = this, nodes, i, node;\n\n\t\t\t// Remove all children\n\t\t\tif (self.firstChild) {\n\t\t\t\tnodes = [];\n\n\t\t\t\t// Collect the children\n\t\t\t\tfor (node = self.firstChild; node; node = walk(node, self)) {\n\t\t\t\t\tnodes.push(node);\n\t\t\t\t}\n\n\t\t\t\t// Remove the children\n\t\t\t\ti = nodes.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tnode.parent = node.firstChild = node.lastChild = node.next = node.prev = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.firstChild = self.lastChild = null;\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the node is to be considered empty or not.\n\t\t *\n\t\t * @example\n\t\t * node.isEmpty({img: true});\n\t\t * @method isEmpty\n\t\t * @param {Object} elements Name/value object with elements that are automatically treated as non empty elements.\n\t\t * @param {Object} whitespace Name/value object with elements that are automatically treated whitespace preservables.\n\t\t * @return {Boolean} true/false if the node is empty or not.\n\t\t */\n\t\tisEmpty: function(elements, whitespace) {\n\t\t\tvar self = this, node = self.firstChild, i, name;\n\n\t\t\twhitespace = whitespace || {};\n\n\t\t\tif (node) {\n\t\t\t\tdo {\n\t\t\t\t\tif (node.type === 1) {\n\t\t\t\t\t\t// Ignore bogus elements\n\t\t\t\t\t\tif (node.attributes.map['data-mce-bogus']) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Keep empty elements like <img />\n\t\t\t\t\t\tif (elements[node.name]) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Keep bookmark nodes and name attribute like <a name=\"1\"></a>\n\t\t\t\t\t\ti = node.attributes.length;\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tname = node.attributes[i].name;\n\t\t\t\t\t\t\tif (name === \"name\" || name.indexOf('data-mce-bookmark') === 0) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Keep comments\n\t\t\t\t\tif (node.type === 8) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Keep non whitespace text nodes\n\t\t\t\t\tif (node.type === 3 && !whiteSpaceRegExp.test(node.value)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Keep whitespace preserve elements\n\t\t\t\t\tif (node.type === 3 && node.parent && whitespace[node.parent.name] && whiteSpaceRegExp.test(node.value)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} while ((node = walk(node, self)));\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\t/**\n\t\t * Walks to the next or previous node and returns that node or null if it wasn't found.\n\t\t *\n\t\t * @method walk\n\t\t * @param {Boolean} prev Optional previous node state defaults to false.\n\t\t * @return {tinymce.html.Node} Node that is next to or previous of the current node.\n\t\t */\n\t\twalk: function(prev) {\n\t\t\treturn walk(this, null, prev);\n\t\t}\n\t};\n\n\t/**\n\t * Creates a node of a specific type.\n\t *\n\t * @static\n\t * @method create\n\t * @param {String} name Name of the node type to create for example \"b\" or \"#text\".\n\t * @param {Object} attrs Name/value collection of attributes that will be applied to elements.\n\t */\n\tNode.create = function(name, attrs) {\n\t\tvar node, attrName;\n\n\t\t// Create node\n\t\tnode = new Node(name, typeLookup[name] || 1);\n\n\t\t// Add attributes if needed\n\t\tif (attrs) {\n\t\t\tfor (attrName in attrs) {\n\t\t\t\tnode.attr(attrName, attrs[attrName]);\n\t\t\t}\n\t\t}\n\n\t\treturn node;\n\t};\n\n\treturn Node;\n});\n\n// Included from: js/tinymce/classes/html/Schema.js\n\n/**\n * Schema.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Schema validator class.\n *\n * @class tinymce.html.Schema\n * @example\n *  if (tinymce.activeEditor.schema.isValidChild('p', 'span'))\n *    alert('span is valid child of p.');\n *\n *  if (tinymce.activeEditor.schema.getElementRule('p'))\n *    alert('P is a valid element.');\n *\n * @class tinymce.html.Schema\n * @version 3.4\n */\ndefine(\"tinymce/html/Schema\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\tvar mapCache = {}, dummyObj = {};\n\tvar makeMap = Tools.makeMap, each = Tools.each, extend = Tools.extend, explode = Tools.explode, inArray = Tools.inArray;\n\n\tfunction split(items, delim) {\n\t\titems = Tools.trim(items);\n\t\treturn items ? items.split(delim || ' ') : [];\n\t}\n\n\t/**\n\t * Builds a schema lookup table\n\t *\n\t * @private\n\t * @param {String} type html4, html5 or html5-strict schema type.\n\t * @return {Object} Schema lookup table.\n\t */\n\tfunction compileSchema(type) {\n\t\tvar schema = {}, globalAttributes, blockContent;\n\t\tvar phrasingContent, flowContent, html4BlockContent, html4PhrasingContent;\n\n\t\tfunction add(name, attributes, children) {\n\t\t\tvar ni, attributesOrder, element;\n\n\t\t\tfunction arrayToMap(array, obj) {\n\t\t\t\tvar map = {}, i, l;\n\n\t\t\t\tfor (i = 0, l = array.length; i < l; i++) {\n\t\t\t\t\tmap[array[i]] = obj || {};\n\t\t\t\t}\n\n\t\t\t\treturn map;\n\t\t\t}\n\n\t\t\tchildren = children || [];\n\t\t\tattributes = attributes || \"\";\n\n\t\t\tif (typeof children === \"string\") {\n\t\t\t\tchildren = split(children);\n\t\t\t}\n\n\t\t\tname = split(name);\n\t\t\tni = name.length;\n\t\t\twhile (ni--) {\n\t\t\t\tattributesOrder = split([globalAttributes, attributes].join(' '));\n\n\t\t\t\telement = {\n\t\t\t\t\tattributes: arrayToMap(attributesOrder),\n\t\t\t\t\tattributesOrder: attributesOrder,\n\t\t\t\t\tchildren: arrayToMap(children, dummyObj)\n\t\t\t\t};\n\n\t\t\t\tschema[name[ni]] = element;\n\t\t\t}\n\t\t}\n\n\t\tfunction addAttrs(name, attributes) {\n\t\t\tvar ni, schemaItem, i, l;\n\n\t\t\tname = split(name);\n\t\t\tni = name.length;\n\t\t\tattributes = split(attributes);\n\t\t\twhile (ni--) {\n\t\t\t\tschemaItem = schema[name[ni]];\n\t\t\t\tfor (i = 0, l = attributes.length; i < l; i++) {\n\t\t\t\t\tschemaItem.attributes[attributes[i]] = {};\n\t\t\t\t\tschemaItem.attributesOrder.push(attributes[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Use cached schema\n\t\tif (mapCache[type]) {\n\t\t\treturn mapCache[type];\n\t\t}\n\n\t\t// Attributes present on all elements\n\t\tglobalAttributes = \"id accesskey class dir lang style tabindex title\";\n\n\t\t// Event attributes can be opt-in/opt-out\n\t\t/*eventAttributes = split(\"onabort onblur oncancel oncanplay oncanplaythrough onchange onclick onclose oncontextmenu oncuechange \" +\n\t\t \"ondblclick ondrag ondragend ondragenter ondragleave ondragover ondragstart ondrop ondurationchange onemptied onended \" +\n\t\t \"onerror onfocus oninput oninvalid onkeydown onkeypress onkeyup onload onloadeddata onloadedmetadata onloadstart \" +\n\t\t \"onmousedown onmousemove onmouseout onmouseover onmouseup onmousewheel onpause onplay onplaying onprogress onratechange \" +\n\t\t \"onreset onscroll onseeked onseeking onseeking onselect onshow onstalled onsubmit onsuspend ontimeupdate onvolumechange \" +\n\t\t \"onwaiting\"\n\t\t );*/\n\n\t\t// Block content elements\n\t\tblockContent =\n\t\t\t\"address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul\";\n\n\t\t// Phrasing content elements from the HTML5 spec (inline)\n\t\tphrasingContent =\n\t\t\t\"a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd \" +\n\t\t\t\"label map noscript object q s samp script select small span strong sub sup \" +\n\t\t\t\"textarea u var #text #comment\"\n\t\t;\n\n\t\t// Add HTML5 items to globalAttributes, blockContent, phrasingContent\n\t\tif (type != \"html4\") {\n\t\t\tglobalAttributes += \" contenteditable contextmenu draggable dropzone \" +\n\t\t\t\t\"hidden spellcheck translate\";\n\t\t\tblockContent += \" article aside details dialog figure header footer hgroup section nav\";\n\t\t\tphrasingContent += \" audio canvas command datalist mark meter output picture \" +\n\t\t\t\t\"progress time wbr video ruby bdi keygen\";\n\t\t}\n\n\t\t// Add HTML4 elements unless it's html5-strict\n\t\tif (type != \"html5-strict\") {\n\t\t\tglobalAttributes += \" xml:lang\";\n\n\t\t\thtml4PhrasingContent = \"acronym applet basefont big font strike tt\";\n\t\t\tphrasingContent = [phrasingContent, html4PhrasingContent].join(' ');\n\n\t\t\teach(split(html4PhrasingContent), function(name) {\n\t\t\t\tadd(name, \"\", phrasingContent);\n\t\t\t});\n\n\t\t\thtml4BlockContent = \"center dir isindex noframes\";\n\t\t\tblockContent = [blockContent, html4BlockContent].join(' ');\n\n\t\t\t// Flow content elements from the HTML5 spec (block+inline)\n\t\t\tflowContent = [blockContent, phrasingContent].join(' ');\n\n\t\t\teach(split(html4BlockContent), function(name) {\n\t\t\t\tadd(name, \"\", flowContent);\n\t\t\t});\n\t\t}\n\n\t\t// Flow content elements from the HTML5 spec (block+inline)\n\t\tflowContent = flowContent || [blockContent, phrasingContent].join(\" \");\n\n\t\t// HTML4 base schema TODO: Move HTML5 specific attributes to HTML5 specific if statement\n\t\t// Schema items <element name>, <specific attributes>, <children ..>\n\t\tadd(\"html\", \"manifest\", \"head body\");\n\t\tadd(\"head\", \"\", \"base command link meta noscript script style title\");\n\t\tadd(\"title hr noscript br\");\n\t\tadd(\"base\", \"href target\");\n\t\tadd(\"link\", \"href rel media hreflang type sizes hreflang\");\n\t\tadd(\"meta\", \"name http-equiv content charset\");\n\t\tadd(\"style\", \"media type scoped\");\n\t\tadd(\"script\", \"src async defer type charset\");\n\t\tadd(\"body\", \"onafterprint onbeforeprint onbeforeunload onblur onerror onfocus \" +\n\t\t\"onhashchange onload onmessage onoffline ononline onpagehide onpageshow \" +\n\t\t\"onpopstate onresize onscroll onstorage onunload\", flowContent);\n\t\tadd(\"address dt dd div caption\", \"\", flowContent);\n\t\tadd(\"h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn\", \"\", phrasingContent);\n\t\tadd(\"blockquote\", \"cite\", flowContent);\n\t\tadd(\"ol\", \"reversed start type\", \"li\");\n\t\tadd(\"ul\", \"\", \"li\");\n\t\tadd(\"li\", \"value\", flowContent);\n\t\tadd(\"dl\", \"\", \"dt dd\");\n\t\tadd(\"a\", \"href target rel media hreflang type\", phrasingContent);\n\t\tadd(\"q\", \"cite\", phrasingContent);\n\t\tadd(\"ins del\", \"cite datetime\", flowContent);\n\t\tadd(\"img\", \"src sizes srcset alt usemap ismap width height\");\n\t\tadd(\"iframe\", \"src name width height\", flowContent);\n\t\tadd(\"embed\", \"src type width height\");\n\t\tadd(\"object\", \"data type typemustmatch name usemap form width height\", [flowContent, \"param\"].join(' '));\n\t\tadd(\"param\", \"name value\");\n\t\tadd(\"map\", \"name\", [flowContent, \"area\"].join(' '));\n\t\tadd(\"area\", \"alt coords shape href target rel media hreflang type\");\n\t\tadd(\"table\", \"border\", \"caption colgroup thead tfoot tbody tr\" + (type == \"html4\" ? \" col\" : \"\"));\n\t\tadd(\"colgroup\", \"span\", \"col\");\n\t\tadd(\"col\", \"span\");\n\t\tadd(\"tbody thead tfoot\", \"\", \"tr\");\n\t\tadd(\"tr\", \"\", \"td th\");\n\t\tadd(\"td\", \"colspan rowspan headers\", flowContent);\n\t\tadd(\"th\", \"colspan rowspan headers scope abbr\", flowContent);\n\t\tadd(\"form\", \"accept-charset action autocomplete enctype method name novalidate target\", flowContent);\n\t\tadd(\"fieldset\", \"disabled form name\", [flowContent, \"legend\"].join(' '));\n\t\tadd(\"label\", \"form for\", phrasingContent);\n\t\tadd(\"input\", \"accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate \" +\n\t\t\t\t\"formtarget height list max maxlength min multiple name pattern readonly required size src step type value width\"\n\t\t);\n\t\tadd(\"button\", \"disabled form formaction formenctype formmethod formnovalidate formtarget name type value\",\n\t\t\ttype == \"html4\" ? flowContent : phrasingContent);\n\t\tadd(\"select\", \"disabled form multiple name required size\", \"option optgroup\");\n\t\tadd(\"optgroup\", \"disabled label\", \"option\");\n\t\tadd(\"option\", \"disabled label selected value\");\n\t\tadd(\"textarea\", \"cols dirname disabled form maxlength name readonly required rows wrap\");\n\t\tadd(\"menu\", \"type label\", [flowContent, \"li\"].join(' '));\n\t\tadd(\"noscript\", \"\", flowContent);\n\n\t\t// Extend with HTML5 elements\n\t\tif (type != \"html4\") {\n\t\t\tadd(\"wbr\");\n\t\t\tadd(\"ruby\", \"\", [phrasingContent, \"rt rp\"].join(' '));\n\t\t\tadd(\"figcaption\", \"\", flowContent);\n\t\t\tadd(\"mark rt rp summary bdi\", \"\", phrasingContent);\n\t\t\tadd(\"canvas\", \"width height\", flowContent);\n\t\t\tadd(\"video\", \"src crossorigin poster preload autoplay mediagroup loop \" +\n\t\t\t\t\"muted controls width height buffered\", [flowContent, \"track source\"].join(' '));\n\t\t\tadd(\"audio\", \"src crossorigin preload autoplay mediagroup loop muted controls \" +\n\t\t\t\t\"buffered volume\", [flowContent, \"track source\"].join(' '));\n\t\t\tadd(\"picture\", \"\", \"img source\");\n\t\t\tadd(\"source\", \"src srcset type media sizes\");\n\t\t\tadd(\"track\", \"kind src srclang label default\");\n\t\t\tadd(\"datalist\", \"\", [phrasingContent, \"option\"].join(' '));\n\t\t\tadd(\"article section nav aside header footer\", \"\", flowContent);\n\t\t\tadd(\"hgroup\", \"\", \"h1 h2 h3 h4 h5 h6\");\n\t\t\tadd(\"figure\", \"\", [flowContent, \"figcaption\"].join(' '));\n\t\t\tadd(\"time\", \"datetime\", phrasingContent);\n\t\t\tadd(\"dialog\", \"open\", flowContent);\n\t\t\tadd(\"command\", \"type label icon disabled checked radiogroup command\");\n\t\t\tadd(\"output\", \"for form name\", phrasingContent);\n\t\t\tadd(\"progress\", \"value max\", phrasingContent);\n\t\t\tadd(\"meter\", \"value min max low high optimum\", phrasingContent);\n\t\t\tadd(\"details\", \"open\", [flowContent, \"summary\"].join(' '));\n\t\t\tadd(\"keygen\", \"autofocus challenge disabled form keytype name\");\n\t\t}\n\n\t\t// Extend with HTML4 attributes unless it's html5-strict\n\t\tif (type != \"html5-strict\") {\n\t\t\taddAttrs(\"script\", \"language xml:space\");\n\t\t\taddAttrs(\"style\", \"xml:space\");\n\t\t\taddAttrs(\"object\", \"declare classid code codebase codetype archive standby align border hspace vspace\");\n\t\t\taddAttrs(\"embed\", \"align name hspace vspace\");\n\t\t\taddAttrs(\"param\", \"valuetype type\");\n\t\t\taddAttrs(\"a\", \"charset name rev shape coords\");\n\t\t\taddAttrs(\"br\", \"clear\");\n\t\t\taddAttrs(\"applet\", \"codebase archive code object alt name width height align hspace vspace\");\n\t\t\taddAttrs(\"img\", \"name longdesc align border hspace vspace\");\n\t\t\taddAttrs(\"iframe\", \"longdesc frameborder marginwidth marginheight scrolling align\");\n\t\t\taddAttrs(\"font basefont\", \"size color face\");\n\t\t\taddAttrs(\"input\", \"usemap align\");\n\t\t\taddAttrs(\"select\", \"onchange\");\n\t\t\taddAttrs(\"textarea\");\n\t\t\taddAttrs(\"h1 h2 h3 h4 h5 h6 div p legend caption\", \"align\");\n\t\t\taddAttrs(\"ul\", \"type compact\");\n\t\t\taddAttrs(\"li\", \"type\");\n\t\t\taddAttrs(\"ol dl menu dir\", \"compact\");\n\t\t\taddAttrs(\"pre\", \"width xml:space\");\n\t\t\taddAttrs(\"hr\", \"align noshade size width\");\n\t\t\taddAttrs(\"isindex\", \"prompt\");\n\t\t\taddAttrs(\"table\", \"summary width frame rules cellspacing cellpadding align bgcolor\");\n\t\t\taddAttrs(\"col\", \"width align char charoff valign\");\n\t\t\taddAttrs(\"colgroup\", \"width align char charoff valign\");\n\t\t\taddAttrs(\"thead\", \"align char charoff valign\");\n\t\t\taddAttrs(\"tr\", \"align char charoff valign bgcolor\");\n\t\t\taddAttrs(\"th\", \"axis align char charoff valign nowrap bgcolor width height\");\n\t\t\taddAttrs(\"form\", \"accept\");\n\t\t\taddAttrs(\"td\", \"abbr axis scope align char charoff valign nowrap bgcolor width height\");\n\t\t\taddAttrs(\"tfoot\", \"align char charoff valign\");\n\t\t\taddAttrs(\"tbody\", \"align char charoff valign\");\n\t\t\taddAttrs(\"area\", \"nohref\");\n\t\t\taddAttrs(\"body\", \"background bgcolor text link vlink alink\");\n\t\t}\n\n\t\t// Extend with HTML5 attributes unless it's html4\n\t\tif (type != \"html4\") {\n\t\t\taddAttrs(\"input button select textarea\", \"autofocus\");\n\t\t\taddAttrs(\"input textarea\", \"placeholder\");\n\t\t\taddAttrs(\"a\", \"download\");\n\t\t\taddAttrs(\"link script img\", \"crossorigin\");\n\t\t\taddAttrs(\"iframe\", \"sandbox seamless allowfullscreen\"); // Excluded: srcdoc\n\t\t}\n\n\t\t// Special: iframe, ruby, video, audio, label\n\n\t\t// Delete children of the same name from it's parent\n\t\t// For example: form can't have a child of the name form\n\t\teach(split('a form meter progress dfn'), function(name) {\n\t\t\tif (schema[name]) {\n\t\t\t\tdelete schema[name].children[name];\n\t\t\t}\n\t\t});\n\n\t\t// Delete header, footer, sectioning and heading content descendants\n\t\t/*each('dt th address', function(name) {\n\t\t delete schema[name].children[name];\n\t\t });*/\n\n\t\t// Caption can't have tables\n\t\tdelete schema.caption.children.table;\n\n\t\t// Delete scripts by default due to possible XSS\n\t\tdelete schema.script;\n\n\t\t// TODO: LI:s can only have value if parent is OL\n\n\t\t// TODO: Handle transparent elements\n\t\t// a ins del canvas map\n\n\t\tmapCache[type] = schema;\n\n\t\treturn schema;\n\t}\n\n\tfunction compileElementMap(value, mode) {\n\t\tvar styles;\n\n\t\tif (value) {\n\t\t\tstyles = {};\n\n\t\t\tif (typeof value == 'string') {\n\t\t\t\tvalue = {\n\t\t\t\t\t'*': value\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Convert styles into a rule list\n\t\t\teach(value, function(value, key) {\n\t\t\t\tstyles[key] = styles[key.toUpperCase()] = mode == 'map' ? makeMap(value, /[, ]/) : explode(value, /[, ]/);\n\t\t\t});\n\t\t}\n\n\t\treturn styles;\n\t}\n\n\t/**\n\t * Constructs a new Schema instance.\n\t *\n\t * @constructor\n\t * @method Schema\n\t * @param {Object} settings Name/value settings object.\n\t */\n\treturn function(settings) {\n\t\tvar self = this, elements = {}, children = {}, patternElements = [], validStyles, invalidStyles, schemaItems;\n\t\tvar whiteSpaceElementsMap, selfClosingElementsMap, shortEndedElementsMap, boolAttrMap, validClasses;\n\t\tvar blockElementsMap, nonEmptyElementsMap, moveCaretBeforeOnEnterElementsMap, textBlockElementsMap, textInlineElementsMap;\n\t\tvar customElementsMap = {}, specialElements = {};\n\n\t\t// Creates an lookup table map object for the specified option or the default value\n\t\tfunction createLookupTable(option, default_value, extendWith) {\n\t\t\tvar value = settings[option];\n\n\t\t\tif (!value) {\n\t\t\t\t// Get cached default map or make it if needed\n\t\t\t\tvalue = mapCache[option];\n\n\t\t\t\tif (!value) {\n\t\t\t\t\tvalue = makeMap(default_value, ' ', makeMap(default_value.toUpperCase(), ' '));\n\t\t\t\t\tvalue = extend(value, extendWith);\n\n\t\t\t\t\tmapCache[option] = value;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Create custom map\n\t\t\t\tvalue = makeMap(value, /[, ]/, makeMap(value.toUpperCase(), /[, ]/));\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t\tsettings = settings || {};\n\t\tschemaItems = compileSchema(settings.schema);\n\n\t\t// Allow all elements and attributes if verify_html is set to false\n\t\tif (settings.verify_html === false) {\n\t\t\tsettings.valid_elements = '*[*]';\n\t\t}\n\n\t\tvalidStyles = compileElementMap(settings.valid_styles);\n\t\tinvalidStyles = compileElementMap(settings.invalid_styles, 'map');\n\t\tvalidClasses = compileElementMap(settings.valid_classes, 'map');\n\n\t\t// Setup map objects\n\t\twhiteSpaceElementsMap = createLookupTable(\n\t\t\t'whitespace_elements',\n\t\t\t'pre script noscript style textarea video audio iframe object code'\n\t\t);\n\t\tselfClosingElementsMap = createLookupTable('self_closing_elements', 'colgroup dd dt li option p td tfoot th thead tr');\n\t\tshortEndedElementsMap = createLookupTable('short_ended_elements', 'area base basefont br col frame hr img input isindex link ' +\n\t\t'meta param embed source wbr track');\n\t\tboolAttrMap = createLookupTable('boolean_attributes', 'checked compact declare defer disabled ismap multiple nohref noresize ' +\n\t\t'noshade nowrap readonly selected autoplay loop controls');\n\t\tnonEmptyElementsMap = createLookupTable('non_empty_elements', 'td th iframe video audio object ' +\n\t\t'script pre code', shortEndedElementsMap);\n\t\tmoveCaretBeforeOnEnterElementsMap = createLookupTable('move_caret_before_on_enter_elements', 'table', nonEmptyElementsMap);\n\t\ttextBlockElementsMap = createLookupTable('text_block_elements', 'h1 h2 h3 h4 h5 h6 p div address pre form ' +\n\t\t'blockquote center dir fieldset header footer article section hgroup aside nav figure');\n\t\tblockElementsMap = createLookupTable('block_elements', 'hr table tbody thead tfoot ' +\n\t\t'th tr td li ol ul caption dl dt dd noscript menu isindex option ' +\n\t\t'datalist select optgroup figcaption', textBlockElementsMap);\n\t\ttextInlineElementsMap = createLookupTable('text_inline_elements', 'span strong b em i font strike u var cite ' +\n\t\t'dfn code mark q sup sub samp');\n\n\t\teach((settings.special || 'script noscript style textarea').split(' '), function(name) {\n\t\t\tspecialElements[name] = new RegExp('<\\/' + name + '[^>]*>', 'gi');\n\t\t});\n\n\t\t// Converts a wildcard expression string to a regexp for example *a will become /.*a/.\n\t\tfunction patternToRegExp(str) {\n\t\t\treturn new RegExp('^' + str.replace(/([?+*])/g, '.$1') + '$');\n\t\t}\n\n\t\t// Parses the specified valid_elements string and adds to the current rules\n\t\t// This function is a bit hard to read since it's heavily optimized for speed\n\t\tfunction addValidElements(validElements) {\n\t\t\tvar ei, el, ai, al, matches, element, attr, attrData, elementName, attrName, attrType, attributes, attributesOrder,\n\t\t\t\tprefix, outputName, globalAttributes, globalAttributesOrder, key, value,\n\t\t\t\telementRuleRegExp = /^([#+\\-])?([^\\[!\\/]+)(?:\\/([^\\[!]+))?(?:(!?)\\[([^\\]]+)\\])?$/,\n\t\t\t\tattrRuleRegExp = /^([!\\-])?(\\w+::\\w+|[^=:<]+)?(?:([=:<])(.*))?$/,\n\t\t\t\thasPatternsRegExp = /[*?+]/;\n\n\t\t\tif (validElements) {\n\t\t\t\t// Split valid elements into an array with rules\n\t\t\t\tvalidElements = split(validElements, ',');\n\n\t\t\t\tif (elements['@']) {\n\t\t\t\t\tglobalAttributes = elements['@'].attributes;\n\t\t\t\t\tglobalAttributesOrder = elements['@'].attributesOrder;\n\t\t\t\t}\n\n\t\t\t\t// Loop all rules\n\t\t\t\tfor (ei = 0, el = validElements.length; ei < el; ei++) {\n\t\t\t\t\t// Parse element rule\n\t\t\t\t\tmatches = elementRuleRegExp.exec(validElements[ei]);\n\t\t\t\t\tif (matches) {\n\t\t\t\t\t\t// Setup local names for matches\n\t\t\t\t\t\tprefix = matches[1];\n\t\t\t\t\t\telementName = matches[2];\n\t\t\t\t\t\toutputName = matches[3];\n\t\t\t\t\t\tattrData = matches[5];\n\n\t\t\t\t\t\t// Create new attributes and attributesOrder\n\t\t\t\t\t\tattributes = {};\n\t\t\t\t\t\tattributesOrder = [];\n\n\t\t\t\t\t\t// Create the new element\n\t\t\t\t\t\telement = {\n\t\t\t\t\t\t\tattributes: attributes,\n\t\t\t\t\t\t\tattributesOrder: attributesOrder\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Padd empty elements prefix\n\t\t\t\t\t\tif (prefix === '#') {\n\t\t\t\t\t\t\telement.paddEmpty = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Remove empty elements prefix\n\t\t\t\t\t\tif (prefix === '-') {\n\t\t\t\t\t\t\telement.removeEmpty = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (matches[4] === '!') {\n\t\t\t\t\t\t\telement.removeEmptyAttrs = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Copy attributes from global rule into current rule\n\t\t\t\t\t\tif (globalAttributes) {\n\t\t\t\t\t\t\tfor (key in globalAttributes) {\n\t\t\t\t\t\t\t\tattributes[key] = globalAttributes[key];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tattributesOrder.push.apply(attributesOrder, globalAttributesOrder);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Attributes defined\n\t\t\t\t\t\tif (attrData) {\n\t\t\t\t\t\t\tattrData = split(attrData, '|');\n\t\t\t\t\t\t\tfor (ai = 0, al = attrData.length; ai < al; ai++) {\n\t\t\t\t\t\t\t\tmatches = attrRuleRegExp.exec(attrData[ai]);\n\t\t\t\t\t\t\t\tif (matches) {\n\t\t\t\t\t\t\t\t\tattr = {};\n\t\t\t\t\t\t\t\t\tattrType = matches[1];\n\t\t\t\t\t\t\t\t\tattrName = matches[2].replace(/::/g, ':');\n\t\t\t\t\t\t\t\t\tprefix = matches[3];\n\t\t\t\t\t\t\t\t\tvalue = matches[4];\n\n\t\t\t\t\t\t\t\t\t// Required\n\t\t\t\t\t\t\t\t\tif (attrType === '!') {\n\t\t\t\t\t\t\t\t\t\telement.attributesRequired = element.attributesRequired || [];\n\t\t\t\t\t\t\t\t\t\telement.attributesRequired.push(attrName);\n\t\t\t\t\t\t\t\t\t\tattr.required = true;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// Denied from global\n\t\t\t\t\t\t\t\t\tif (attrType === '-') {\n\t\t\t\t\t\t\t\t\t\tdelete attributes[attrName];\n\t\t\t\t\t\t\t\t\t\tattributesOrder.splice(inArray(attributesOrder, attrName), 1);\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// Default value\n\t\t\t\t\t\t\t\t\tif (prefix) {\n\t\t\t\t\t\t\t\t\t\t// Default value\n\t\t\t\t\t\t\t\t\t\tif (prefix === '=') {\n\t\t\t\t\t\t\t\t\t\t\telement.attributesDefault = element.attributesDefault || [];\n\t\t\t\t\t\t\t\t\t\t\telement.attributesDefault.push({name: attrName, value: value});\n\t\t\t\t\t\t\t\t\t\t\tattr.defaultValue = value;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t// Forced value\n\t\t\t\t\t\t\t\t\t\tif (prefix === ':') {\n\t\t\t\t\t\t\t\t\t\t\telement.attributesForced = element.attributesForced || [];\n\t\t\t\t\t\t\t\t\t\t\telement.attributesForced.push({name: attrName, value: value});\n\t\t\t\t\t\t\t\t\t\t\tattr.forcedValue = value;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t// Required values\n\t\t\t\t\t\t\t\t\t\tif (prefix === '<') {\n\t\t\t\t\t\t\t\t\t\t\tattr.validValues = makeMap(value, '?');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// Check for attribute patterns\n\t\t\t\t\t\t\t\t\tif (hasPatternsRegExp.test(attrName)) {\n\t\t\t\t\t\t\t\t\t\telement.attributePatterns = element.attributePatterns || [];\n\t\t\t\t\t\t\t\t\t\tattr.pattern = patternToRegExp(attrName);\n\t\t\t\t\t\t\t\t\t\telement.attributePatterns.push(attr);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t// Add attribute to order list if it doesn't already exist\n\t\t\t\t\t\t\t\t\t\tif (!attributes[attrName]) {\n\t\t\t\t\t\t\t\t\t\t\tattributesOrder.push(attrName);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tattributes[attrName] = attr;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Global rule, store away these for later usage\n\t\t\t\t\t\tif (!globalAttributes && elementName == '@') {\n\t\t\t\t\t\t\tglobalAttributes = attributes;\n\t\t\t\t\t\t\tglobalAttributesOrder = attributesOrder;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Handle substitute elements such as b/strong\n\t\t\t\t\t\tif (outputName) {\n\t\t\t\t\t\t\telement.outputName = elementName;\n\t\t\t\t\t\t\telements[outputName] = element;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Add pattern or exact element\n\t\t\t\t\t\tif (hasPatternsRegExp.test(elementName)) {\n\t\t\t\t\t\t\telement.pattern = patternToRegExp(elementName);\n\t\t\t\t\t\t\tpatternElements.push(element);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telements[elementName] = element;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction setValidElements(validElements) {\n\t\t\telements = {};\n\t\t\tpatternElements = [];\n\n\t\t\taddValidElements(validElements);\n\n\t\t\teach(schemaItems, function(element, name) {\n\t\t\t\tchildren[name] = element.children;\n\t\t\t});\n\t\t}\n\n\t\t// Adds custom non HTML elements to the schema\n\t\tfunction addCustomElements(customElements) {\n\t\t\tvar customElementRegExp = /^(~)?(.+)$/;\n\n\t\t\tif (customElements) {\n\t\t\t\t// Flush cached items since we are altering the default maps\n\t\t\t\tmapCache.text_block_elements = mapCache.block_elements = null;\n\n\t\t\t\teach(split(customElements, ','), function(rule) {\n\t\t\t\t\tvar matches = customElementRegExp.exec(rule),\n\t\t\t\t\t\tinline = matches[1] === '~',\n\t\t\t\t\t\tcloneName = inline ? 'span' : 'div',\n\t\t\t\t\t\tname = matches[2];\n\n\t\t\t\t\tchildren[name] = children[cloneName];\n\t\t\t\t\tcustomElementsMap[name] = cloneName;\n\n\t\t\t\t\t// If it's not marked as inline then add it to valid block elements\n\t\t\t\t\tif (!inline) {\n\t\t\t\t\t\tblockElementsMap[name.toUpperCase()] = {};\n\t\t\t\t\t\tblockElementsMap[name] = {};\n\t\t\t\t\t}\n\n\t\t\t\t\t// Add elements clone if needed\n\t\t\t\t\tif (!elements[name]) {\n\t\t\t\t\t\tvar customRule = elements[cloneName];\n\n\t\t\t\t\t\tcustomRule = extend({}, customRule);\n\t\t\t\t\t\tdelete customRule.removeEmptyAttrs;\n\t\t\t\t\t\tdelete customRule.removeEmpty;\n\n\t\t\t\t\t\telements[name] = customRule;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Add custom elements at span/div positions\n\t\t\t\t\teach(children, function(element, elmName) {\n\t\t\t\t\t\tif (element[cloneName]) {\n\t\t\t\t\t\t\tchildren[elmName] = element = extend({}, children[elmName]);\n\t\t\t\t\t\t\telement[name] = element[cloneName];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Adds valid children to the schema object\n\t\tfunction addValidChildren(validChildren) {\n\t\t\tvar childRuleRegExp = /^([+\\-]?)(\\w+)\\[([^\\]]+)\\]$/;\n\n\t\t\t// Invalidate the schema cache if the schema is mutated\n\t\t\tmapCache[settings.schema] = null;\n\n\t\t\tif (validChildren) {\n\t\t\t\teach(split(validChildren, ','), function(rule) {\n\t\t\t\t\tvar matches = childRuleRegExp.exec(rule), parent, prefix;\n\n\t\t\t\t\tif (matches) {\n\t\t\t\t\t\tprefix = matches[1];\n\n\t\t\t\t\t\t// Add/remove items from default\n\t\t\t\t\t\tif (prefix) {\n\t\t\t\t\t\t\tparent = children[matches[2]];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tparent = children[matches[2]] = {'#comment': {}};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tparent = children[matches[2]];\n\n\t\t\t\t\t\teach(split(matches[3], '|'), function(child) {\n\t\t\t\t\t\t\tif (prefix === '-') {\n\t\t\t\t\t\t\t\tdelete parent[child];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tparent[child] = {};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction getElementRule(name) {\n\t\t\tvar element = elements[name], i;\n\n\t\t\t// Exact match found\n\t\t\tif (element) {\n\t\t\t\treturn element;\n\t\t\t}\n\n\t\t\t// No exact match then try the patterns\n\t\t\ti = patternElements.length;\n\t\t\twhile (i--) {\n\t\t\t\telement = patternElements[i];\n\n\t\t\t\tif (element.pattern.test(name)) {\n\t\t\t\t\treturn element;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!settings.valid_elements) {\n\t\t\t// No valid elements defined then clone the elements from the schema spec\n\t\t\teach(schemaItems, function(element, name) {\n\t\t\t\telements[name] = {\n\t\t\t\t\tattributes: element.attributes,\n\t\t\t\t\tattributesOrder: element.attributesOrder\n\t\t\t\t};\n\n\t\t\t\tchildren[name] = element.children;\n\t\t\t});\n\n\t\t\t// Switch these on HTML4\n\t\t\tif (settings.schema != \"html5\") {\n\t\t\t\teach(split('strong/b em/i'), function(item) {\n\t\t\t\t\titem = split(item, '/');\n\t\t\t\t\telements[item[1]].outputName = item[0];\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Add default alt attribute for images, removed since alt=\"\" is treated as presentational.\n\t\t\t// elements.img.attributesDefault = [{name: 'alt', value: ''}];\n\n\t\t\t// Remove these if they are empty by default\n\t\t\teach(split('ol ul sub sup blockquote span font a table tbody tr strong em b i'), function(name) {\n\t\t\t\tif (elements[name]) {\n\t\t\t\t\telements[name].removeEmpty = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Padd these by default\n\t\t\teach(split('p h1 h2 h3 h4 h5 h6 th td pre div address caption'), function(name) {\n\t\t\t\telements[name].paddEmpty = true;\n\t\t\t});\n\n\t\t\t// Remove these if they have no attributes\n\t\t\teach(split('span'), function(name) {\n\t\t\t\telements[name].removeEmptyAttrs = true;\n\t\t\t});\n\n\t\t\t// Remove these by default\n\t\t\t// TODO: Reenable in 4.1\n\t\t\t/*each(split('script style'), function(name) {\n\t\t\t delete elements[name];\n\t\t\t });*/\n\t\t} else {\n\t\t\tsetValidElements(settings.valid_elements);\n\t\t}\n\n\t\taddCustomElements(settings.custom_elements);\n\t\taddValidChildren(settings.valid_children);\n\t\taddValidElements(settings.extended_valid_elements);\n\n\t\t// Todo: Remove this when we fix list handling to be valid\n\t\taddValidChildren('+ol[ul|ol],+ul[ul|ol]');\n\n\n\t\t// Some elements are not valid by themselves - require parents\n\t\teach({\n\t\t\tdd: 'dl',\n\t\t\tdt: 'dl',\n\t\t\tli: 'ul ol',\n\t\t\ttd: 'tr',\n\t\t\tth: 'tr',\n\t\t\ttr: 'tbody thead tfoot',\n\t\t\ttbody: 'table',\n\t\t\tthead: 'table',\n\t\t\ttfoot: 'table',\n\t\t\tlegend: 'fieldset',\n\t\t\tarea: 'map',\n\t\t\tparam: 'video audio object'\n\t\t}, function(parents, item) {\n\t\t\tif (elements[item]) {\n\t\t\t\telements[item].parentsRequired = split(parents);\n\t\t\t}\n\t\t});\n\n\n\t\t// Delete invalid elements\n\t\tif (settings.invalid_elements) {\n\t\t\teach(explode(settings.invalid_elements), function(item) {\n\t\t\t\tif (elements[item]) {\n\t\t\t\t\tdelete elements[item];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// If the user didn't allow span only allow internal spans\n\t\tif (!getElementRule('span')) {\n\t\t\taddValidElements('span[!data-mce-type|*]');\n\t\t}\n\n\t\t/**\n\t\t * Name/value map object with valid parents and children to those parents.\n\t\t *\n\t\t * @example\n\t\t * children = {\n\t\t *    div:{p:{}, h1:{}}\n\t\t * };\n\t\t * @field children\n\t\t * @type Object\n\t\t */\n\t\tself.children = children;\n\n\t\t/**\n\t\t * Name/value map object with valid styles for each element.\n\t\t *\n\t\t * @method getValidStyles\n\t\t * @type Object\n\t\t */\n\t\tself.getValidStyles = function() {\n\t\t\treturn validStyles;\n\t\t};\n\n\t\t/**\n\t\t * Name/value map object with valid styles for each element.\n\t\t *\n\t\t * @method getInvalidStyles\n\t\t * @type Object\n\t\t */\n\t\tself.getInvalidStyles = function() {\n\t\t\treturn invalidStyles;\n\t\t};\n\n\t\t/**\n\t\t * Name/value map object with valid classes for each element.\n\t\t *\n\t\t * @method getValidClasses\n\t\t * @type Object\n\t\t */\n\t\tself.getValidClasses = function() {\n\t\t\treturn validClasses;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with boolean attributes.\n\t\t *\n\t\t * @method getBoolAttrs\n\t\t * @return {Object} Name/value lookup map for boolean attributes.\n\t\t */\n\t\tself.getBoolAttrs = function() {\n\t\t\treturn boolAttrMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with block elements.\n\t\t *\n\t\t * @method getBlockElements\n\t\t * @return {Object} Name/value lookup map for block elements.\n\t\t */\n\t\tself.getBlockElements = function() {\n\t\t\treturn blockElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with text block elements. Such as: p,h1-h6,div,address\n\t\t *\n\t\t * @method getTextBlockElements\n\t\t * @return {Object} Name/value lookup map for block elements.\n\t\t */\n\t\tself.getTextBlockElements = function() {\n\t\t\treturn textBlockElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map of inline text format nodes for example strong/span or ins.\n\t\t *\n\t\t * @method getTextInlineElements\n\t\t * @return {Object} Name/value lookup map for text format elements.\n\t\t */\n\t\tself.getTextInlineElements = function() {\n\t\t\treturn textInlineElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with short ended elements such as BR or IMG.\n\t\t *\n\t\t * @method getShortEndedElements\n\t\t * @return {Object} Name/value lookup map for short ended elements.\n\t\t */\n\t\tself.getShortEndedElements = function() {\n\t\t\treturn shortEndedElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with self closing tags such as <li>.\n\t\t *\n\t\t * @method getSelfClosingElements\n\t\t * @return {Object} Name/value lookup map for self closing tags elements.\n\t\t */\n\t\tself.getSelfClosingElements = function() {\n\t\t\treturn selfClosingElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with elements that should be treated as contents regardless if it has text\n\t\t * content in them or not such as TD, VIDEO or IMG.\n\t\t *\n\t\t * @method getNonEmptyElements\n\t\t * @return {Object} Name/value lookup map for non empty elements.\n\t\t */\n\t\tself.getNonEmptyElements = function() {\n\t\t\treturn nonEmptyElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with elements that the caret should be moved in front of after enter is\n\t\t * pressed\n\t\t *\n\t\t * @method getMoveCaretBeforeOnEnterElements\n\t\t * @return {Object} Name/value lookup map for elements to place the caret in front of.\n\t\t */\n\t\tself.getMoveCaretBeforeOnEnterElements = function() {\n\t\t\treturn moveCaretBeforeOnEnterElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with elements where white space is to be preserved like PRE or SCRIPT.\n\t\t *\n\t\t * @method getWhiteSpaceElements\n\t\t * @return {Object} Name/value lookup map for white space elements.\n\t\t */\n\t\tself.getWhiteSpaceElements = function() {\n\t\t\treturn whiteSpaceElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with special elements. These are elements that needs to be parsed\n\t\t * in a special way such as script, style, textarea etc. The map object values\n\t\t * are regexps used to find the end of the element.\n\t\t *\n\t\t * @method getSpecialElements\n\t\t * @return {Object} Name/value lookup map for special elements.\n\t\t */\n\t\tself.getSpecialElements = function() {\n\t\t\treturn specialElements;\n\t\t};\n\n\t\t/**\n\t\t * Returns true/false if the specified element and it's child is valid or not\n\t\t * according to the schema.\n\t\t *\n\t\t * @method isValidChild\n\t\t * @param {String} name Element name to check for.\n\t\t * @param {String} child Element child to verify.\n\t\t * @return {Boolean} True/false if the element is a valid child of the specified parent.\n\t\t */\n\t\tself.isValidChild = function(name, child) {\n\t\t\tvar parent = children[name];\n\n\t\t\treturn !!(parent && parent[child]);\n\t\t};\n\n\t\t/**\n\t\t * Returns true/false if the specified element name and optional attribute is\n\t\t * valid according to the schema.\n\t\t *\n\t\t * @method isValid\n\t\t * @param {String} name Name of element to check.\n\t\t * @param {String} attr Optional attribute name to check for.\n\t\t * @return {Boolean} True/false if the element and attribute is valid.\n\t\t */\n\t\tself.isValid = function(name, attr) {\n\t\t\tvar attrPatterns, i, rule = getElementRule(name);\n\n\t\t\t// Check if it's a valid element\n\t\t\tif (rule) {\n\t\t\t\tif (attr) {\n\t\t\t\t\t// Check if attribute name exists\n\t\t\t\t\tif (rule.attributes[attr]) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Check if attribute matches a regexp pattern\n\t\t\t\t\tattrPatterns = rule.attributePatterns;\n\t\t\t\t\tif (attrPatterns) {\n\t\t\t\t\t\ti = attrPatterns.length;\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tif (attrPatterns[i].pattern.test(name)) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// No match\n\t\t\treturn false;\n\t\t};\n\n\t\t/**\n\t\t * Returns true/false if the specified element is valid or not\n\t\t * according to the schema.\n\t\t *\n\t\t * @method getElementRule\n\t\t * @param {String} name Element name to check for.\n\t\t * @return {Object} Element object or undefined if the element isn't valid.\n\t\t */\n\t\tself.getElementRule = getElementRule;\n\n\t\t/**\n\t\t * Returns an map object of all custom elements.\n\t\t *\n\t\t * @method getCustomElements\n\t\t * @return {Object} Name/value map object of all custom elements.\n\t\t */\n\t\tself.getCustomElements = function() {\n\t\t\treturn customElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Parses a valid elements string and adds it to the schema. The valid elements\n\t\t * format is for example \"element[attr=default|otherattr]\".\n\t\t * Existing rules will be replaced with the ones specified, so this extends the schema.\n\t\t *\n\t\t * @method addValidElements\n\t\t * @param {String} valid_elements String in the valid elements format to be parsed.\n\t\t */\n\t\tself.addValidElements = addValidElements;\n\n\t\t/**\n\t\t * Parses a valid elements string and sets it to the schema. The valid elements\n\t\t * format is for example \"element[attr=default|otherattr]\".\n\t\t * Existing rules will be replaced with the ones specified, so this extends the schema.\n\t\t *\n\t\t * @method setValidElements\n\t\t * @param {String} valid_elements String in the valid elements format to be parsed.\n\t\t */\n\t\tself.setValidElements = setValidElements;\n\n\t\t/**\n\t\t * Adds custom non HTML elements to the schema.\n\t\t *\n\t\t * @method addCustomElements\n\t\t * @param {String} custom_elements Comma separated list of custom elements to add.\n\t\t */\n\t\tself.addCustomElements = addCustomElements;\n\n\t\t/**\n\t\t * Parses a valid children string and adds them to the schema structure. The valid children\n\t\t * format is for example: \"element[child1|child2]\".\n\t\t *\n\t\t * @method addValidChildren\n\t\t * @param {String} valid_children Valid children elements string to parse\n\t\t */\n\t\tself.addValidChildren = addValidChildren;\n\n\t\tself.elements = elements;\n\t};\n});\n\n// Included from: js/tinymce/classes/html/SaxParser.js\n\n/**\n * SaxParser.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*eslint max-depth:[2, 9] */\n\n/**\n * This class parses HTML code using pure JavaScript and executes various events for each item it finds. It will\n * always execute the events in the right order for tag soup code like <b><p></b></p>. It will also remove elements\n * and attributes that doesn't fit the schema if the validate setting is enabled.\n *\n * @example\n * var parser = new tinymce.html.SaxParser({\n *     validate: true,\n *\n *     comment: function(text) {\n *         console.log('Comment:', text);\n *     },\n *\n *     cdata: function(text) {\n *         console.log('CDATA:', text);\n *     },\n *\n *     text: function(text, raw) {\n *         console.log('Text:', text, 'Raw:', raw);\n *     },\n *\n *     start: function(name, attrs, empty) {\n *         console.log('Start:', name, attrs, empty);\n *     },\n *\n *     end: function(name) {\n *         console.log('End:', name);\n *     },\n *\n *     pi: function(name, text) {\n *         console.log('PI:', name, text);\n *     },\n *\n *     doctype: function(text) {\n *         console.log('DocType:', text);\n *     }\n * }, schema);\n * @class tinymce.html.SaxParser\n * @version 3.4\n */\ndefine(\"tinymce/html/SaxParser\", [\n\t\"tinymce/html/Schema\",\n\t\"tinymce/html/Entities\",\n\t\"tinymce/util/Tools\"\n], function(Schema, Entities, Tools) {\n\tvar each = Tools.each;\n\n\t/**\n\t * Returns the index of the end tag for a specific start tag. This can be\n\t * used to skip all children of a parent element from being processed.\n\t *\n\t * @private\n\t * @method findEndTag\n\t * @param {tinymce.html.Schema} schema Schema instance to use to match short ended elements.\n\t * @param {String} html HTML string to find the end tag in.\n\t * @param {Number} startIndex Indext to start searching at should be after the start tag.\n\t * @return {Number} Index of the end tag.\n\t */\n\tfunction findEndTag(schema, html, startIndex) {\n\t\tvar count = 1, index, matches, tokenRegExp, shortEndedElements;\n\n\t\tshortEndedElements = schema.getShortEndedElements();\n\t\ttokenRegExp = /<([!?\\/])?([A-Za-z0-9\\-_\\:\\.]+)((?:\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\/|\\s+)>/g;\n\t\ttokenRegExp.lastIndex = index = startIndex;\n\n\t\twhile ((matches = tokenRegExp.exec(html))) {\n\t\t\tindex = tokenRegExp.lastIndex;\n\n\t\t\tif (matches[1] === '/') { // End element\n\t\t\t\tcount--;\n\t\t\t} else if (!matches[1]) { // Start element\n\t\t\t\tif (matches[2] in shortEndedElements) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tcount++;\n\t\t\t}\n\n\t\t\tif (count === 0) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn index;\n\t}\n\n\t/**\n\t * Constructs a new SaxParser instance.\n\t *\n\t * @constructor\n\t * @method SaxParser\n\t * @param {Object} settings Name/value collection of settings. comment, cdata, text, start and end are callbacks.\n\t * @param {tinymce.html.Schema} schema HTML Schema class to use when parsing.\n\t */\n\tfunction SaxParser(settings, schema) {\n\t\tvar self = this;\n\n\t\tfunction noop() {}\n\n\t\tsettings = settings || {};\n\t\tself.schema = schema = schema || new Schema();\n\n\t\tif (settings.fix_self_closing !== false) {\n\t\t\tsettings.fix_self_closing = true;\n\t\t}\n\n\t\t// Add handler functions from settings and setup default handlers\n\t\teach('comment cdata text start end pi doctype'.split(' '), function(name) {\n\t\t\tif (name) {\n\t\t\t\tself[name] = settings[name] || noop;\n\t\t\t}\n\t\t});\n\n\t\t/**\n\t\t * Parses the specified HTML string and executes the callbacks for each item it finds.\n\t\t *\n\t\t * @example\n\t\t * new SaxParser({...}).parse('<b>text</b>');\n\t\t * @method parse\n\t\t * @param {String} html Html string to sax parse.\n\t\t */\n\t\tself.parse = function(html) {\n\t\t\tvar self = this, matches, index = 0, value, endRegExp, stack = [], attrList, i, text, name;\n\t\t\tvar isInternalElement, removeInternalElements, shortEndedElements, fillAttrsMap, isShortEnded;\n\t\t\tvar validate, elementRule, isValidElement, attr, attribsValue, validAttributesMap, validAttributePatterns;\n\t\t\tvar attributesRequired, attributesDefault, attributesForced;\n\t\t\tvar anyAttributesRequired, selfClosing, tokenRegExp, attrRegExp, specialElements, attrValue, idCount = 0;\n\t\t\tvar decode = Entities.decode, fixSelfClosing, filteredUrlAttrs = Tools.makeMap('src,href,data,background,formaction,poster');\n\t\t\tvar scriptUriRegExp = /((java|vb)script|mhtml):/i, dataUriRegExp = /^data:/i;\n\n\t\t\tfunction processEndTag(name) {\n\t\t\t\tvar pos, i;\n\n\t\t\t\t// Find position of parent of the same type\n\t\t\t\tpos = stack.length;\n\t\t\t\twhile (pos--) {\n\t\t\t\t\tif (stack[pos].name === name) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Found parent\n\t\t\t\tif (pos >= 0) {\n\t\t\t\t\t// Close all the open elements\n\t\t\t\t\tfor (i = stack.length - 1; i >= pos; i--) {\n\t\t\t\t\t\tname = stack[i];\n\n\t\t\t\t\t\tif (name.valid) {\n\t\t\t\t\t\t\tself.end(name.name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove the open elements from the stack\n\t\t\t\t\tstack.length = pos;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction parseAttribute(match, name, value, val2, val3) {\n\t\t\t\tvar attrRule, i, trimRegExp = /[\\s\\u0000-\\u001F]+/g;\n\n\t\t\t\tname = name.toLowerCase();\n\t\t\t\tvalue = name in fillAttrsMap ? name : decode(value || val2 || val3 || ''); // Handle boolean attribute than value attribute\n\n\t\t\t\t// Validate name and value pass through all data- attributes\n\t\t\t\tif (validate && !isInternalElement && name.indexOf('data-') !== 0) {\n\t\t\t\t\tattrRule = validAttributesMap[name];\n\n\t\t\t\t\t// Find rule by pattern matching\n\t\t\t\t\tif (!attrRule && validAttributePatterns) {\n\t\t\t\t\t\ti = validAttributePatterns.length;\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tattrRule = validAttributePatterns[i];\n\t\t\t\t\t\t\tif (attrRule.pattern.test(name)) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// No rule matched\n\t\t\t\t\t\tif (i === -1) {\n\t\t\t\t\t\t\tattrRule = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// No attribute rule found\n\t\t\t\t\tif (!attrRule) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Validate value\n\t\t\t\t\tif (attrRule.validValues && !(value in attrRule.validValues)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Block any javascript: urls or non image data uris\n\t\t\t\tif (filteredUrlAttrs[name] && !settings.allow_script_urls) {\n\t\t\t\t\tvar uri = value.replace(trimRegExp, '');\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Might throw malformed URI sequence\n\t\t\t\t\t\turi = decodeURIComponent(uri);\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// Fallback to non UTF-8 decoder\n\t\t\t\t\t\turi = unescape(uri);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (scriptUriRegExp.test(uri)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!settings.allow_html_data_urls && dataUriRegExp.test(uri) && !/^data:image\\//i.test(uri)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Add attribute to list and map\n\t\t\t\tattrList.map[name] = value;\n\t\t\t\tattrList.push({\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Precompile RegExps and map objects\n\t\t\ttokenRegExp = new RegExp('<(?:' +\n\t\t\t\t'(?:!--([\\\\w\\\\W]*?)-->)|' + // Comment\n\t\t\t\t'(?:!\\\\[CDATA\\\\[([\\\\w\\\\W]*?)\\\\]\\\\]>)|' + // CDATA\n\t\t\t\t'(?:!DOCTYPE([\\\\w\\\\W]*?)>)|' + // DOCTYPE\n\t\t\t\t'(?:\\\\?([^\\\\s\\\\/<>]+) ?([\\\\w\\\\W]*?)[?/]>)|' + // PI\n\t\t\t\t'(?:\\\\/([^>]+)>)|' + // End element\n\t\t\t\t'(?:([A-Za-z0-9\\\\-_\\\\:\\\\.]+)((?:\\\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\\\/|\\\\s+)>)' + // Start element\n\t\t\t')', 'g');\n\n\t\t\tattrRegExp = /([\\w:\\-]+)(?:\\s*=\\s*(?:(?:\\\"((?:[^\\\"])*)\\\")|(?:\\'((?:[^\\'])*)\\')|([^>\\s]+)))?/g;\n\n\t\t\t// Setup lookup tables for empty elements and boolean attributes\n\t\t\tshortEndedElements = schema.getShortEndedElements();\n\t\t\tselfClosing = settings.self_closing_elements || schema.getSelfClosingElements();\n\t\t\tfillAttrsMap = schema.getBoolAttrs();\n\t\t\tvalidate = settings.validate;\n\t\t\tremoveInternalElements = settings.remove_internals;\n\t\t\tfixSelfClosing = settings.fix_self_closing;\n\t\t\tspecialElements = schema.getSpecialElements();\n\n\t\t\twhile ((matches = tokenRegExp.exec(html))) {\n\t\t\t\t// Text\n\t\t\t\tif (index < matches.index) {\n\t\t\t\t\tself.text(decode(html.substr(index, matches.index - index)));\n\t\t\t\t}\n\n\t\t\t\tif ((value = matches[6])) { // End element\n\t\t\t\t\tvalue = value.toLowerCase();\n\n\t\t\t\t\t// IE will add a \":\" in front of elements it doesn't understand like custom elements or HTML5 elements\n\t\t\t\t\tif (value.charAt(0) === ':') {\n\t\t\t\t\t\tvalue = value.substr(1);\n\t\t\t\t\t}\n\n\t\t\t\t\tprocessEndTag(value);\n\t\t\t\t} else if ((value = matches[7])) { // Start element\n\t\t\t\t\tvalue = value.toLowerCase();\n\n\t\t\t\t\t// IE will add a \":\" in front of elements it doesn't understand like custom elements or HTML5 elements\n\t\t\t\t\tif (value.charAt(0) === ':') {\n\t\t\t\t\t\tvalue = value.substr(1);\n\t\t\t\t\t}\n\n\t\t\t\t\tisShortEnded = value in shortEndedElements;\n\n\t\t\t\t\t// Is self closing tag for example an <li> after an open <li>\n\t\t\t\t\tif (fixSelfClosing && selfClosing[value] && stack.length > 0 && stack[stack.length - 1].name === value) {\n\t\t\t\t\t\tprocessEndTag(value);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Validate element\n\t\t\t\t\tif (!validate || (elementRule = schema.getElementRule(value))) {\n\t\t\t\t\t\tisValidElement = true;\n\n\t\t\t\t\t\t// Grab attributes map and patters when validation is enabled\n\t\t\t\t\t\tif (validate) {\n\t\t\t\t\t\t\tvalidAttributesMap = elementRule.attributes;\n\t\t\t\t\t\t\tvalidAttributePatterns = elementRule.attributePatterns;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Parse attributes\n\t\t\t\t\t\tif ((attribsValue = matches[8])) {\n\t\t\t\t\t\t\tisInternalElement = attribsValue.indexOf('data-mce-type') !== -1; // Check if the element is an internal element\n\n\t\t\t\t\t\t\t// If the element has internal attributes then remove it if we are told to do so\n\t\t\t\t\t\t\tif (isInternalElement && removeInternalElements) {\n\t\t\t\t\t\t\t\tisValidElement = false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tattrList = [];\n\t\t\t\t\t\t\tattrList.map = {};\n\n\t\t\t\t\t\t\tattribsValue.replace(attrRegExp, parseAttribute);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tattrList = [];\n\t\t\t\t\t\t\tattrList.map = {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Process attributes if validation is enabled\n\t\t\t\t\t\tif (validate && !isInternalElement) {\n\t\t\t\t\t\t\tattributesRequired = elementRule.attributesRequired;\n\t\t\t\t\t\t\tattributesDefault = elementRule.attributesDefault;\n\t\t\t\t\t\t\tattributesForced = elementRule.attributesForced;\n\t\t\t\t\t\t\tanyAttributesRequired = elementRule.removeEmptyAttrs;\n\n\t\t\t\t\t\t\t// Check if any attribute exists\n\t\t\t\t\t\t\tif (anyAttributesRequired && !attrList.length) {\n\t\t\t\t\t\t\t\tisValidElement = false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Handle forced attributes\n\t\t\t\t\t\t\tif (attributesForced) {\n\t\t\t\t\t\t\t\ti = attributesForced.length;\n\t\t\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\t\t\tattr = attributesForced[i];\n\t\t\t\t\t\t\t\t\tname = attr.name;\n\t\t\t\t\t\t\t\t\tattrValue = attr.value;\n\n\t\t\t\t\t\t\t\t\tif (attrValue === '{$uid}') {\n\t\t\t\t\t\t\t\t\t\tattrValue = 'mce_' + idCount++;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tattrList.map[name] = attrValue;\n\t\t\t\t\t\t\t\t\tattrList.push({name: name, value: attrValue});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Handle default attributes\n\t\t\t\t\t\t\tif (attributesDefault) {\n\t\t\t\t\t\t\t\ti = attributesDefault.length;\n\t\t\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\t\t\tattr = attributesDefault[i];\n\t\t\t\t\t\t\t\t\tname = attr.name;\n\n\t\t\t\t\t\t\t\t\tif (!(name in attrList.map)) {\n\t\t\t\t\t\t\t\t\t\tattrValue = attr.value;\n\n\t\t\t\t\t\t\t\t\t\tif (attrValue === '{$uid}') {\n\t\t\t\t\t\t\t\t\t\t\tattrValue = 'mce_' + idCount++;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tattrList.map[name] = attrValue;\n\t\t\t\t\t\t\t\t\t\tattrList.push({name: name, value: attrValue});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Handle required attributes\n\t\t\t\t\t\t\tif (attributesRequired) {\n\t\t\t\t\t\t\t\ti = attributesRequired.length;\n\t\t\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\t\t\tif (attributesRequired[i] in attrList.map) {\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// None of the required attributes where found\n\t\t\t\t\t\t\t\tif (i === -1) {\n\t\t\t\t\t\t\t\t\tisValidElement = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Invalidate element if it's marked as bogus\n\t\t\t\t\t\t\tif ((attr = attrList.map['data-mce-bogus'])) {\n\t\t\t\t\t\t\t\tif (attr === 'all') {\n\t\t\t\t\t\t\t\t\tindex = findEndTag(schema, html, tokenRegExp.lastIndex);\n\t\t\t\t\t\t\t\t\ttokenRegExp.lastIndex = index;\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tisValidElement = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (isValidElement) {\n\t\t\t\t\t\t\tself.start(value, attrList, isShortEnded);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tisValidElement = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Treat script, noscript and style a bit different since they may include code that looks like elements\n\t\t\t\t\tif ((endRegExp = specialElements[value])) {\n\t\t\t\t\t\tendRegExp.lastIndex = index = matches.index + matches[0].length;\n\n\t\t\t\t\t\tif ((matches = endRegExp.exec(html))) {\n\t\t\t\t\t\t\tif (isValidElement) {\n\t\t\t\t\t\t\t\ttext = html.substr(index, matches.index - index);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tindex = matches.index + matches[0].length;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttext = html.substr(index);\n\t\t\t\t\t\t\tindex = html.length;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (isValidElement) {\n\t\t\t\t\t\t\tif (text.length > 0) {\n\t\t\t\t\t\t\t\tself.text(text, true);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tself.end(value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttokenRegExp.lastIndex = index;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Push value on to stack\n\t\t\t\t\tif (!isShortEnded) {\n\t\t\t\t\t\tif (!attribsValue || attribsValue.indexOf('/') != attribsValue.length - 1) {\n\t\t\t\t\t\t\tstack.push({name: value, valid: isValidElement});\n\t\t\t\t\t\t} else if (isValidElement) {\n\t\t\t\t\t\t\tself.end(value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if ((value = matches[1])) { // Comment\n\t\t\t\t\t// Padd comment value to avoid browsers from parsing invalid comments as HTML\n\t\t\t\t\tif (value.charAt(0) === '>') {\n\t\t\t\t\t\tvalue = ' ' + value;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!settings.allow_conditional_comments && value.substr(0, 3).toLowerCase() === '[if') {\n\t\t\t\t\t\tvalue = ' ' + value;\n\t\t\t\t\t}\n\n\t\t\t\t\tself.comment(value);\n\t\t\t\t} else if ((value = matches[2])) { // CDATA\n\t\t\t\t\tself.cdata(value);\n\t\t\t\t} else if ((value = matches[3])) { // DOCTYPE\n\t\t\t\t\tself.doctype(value);\n\t\t\t\t} else if ((value = matches[4])) { // PI\n\t\t\t\t\tself.pi(value, matches[5]);\n\t\t\t\t}\n\n\t\t\t\tindex = matches.index + matches[0].length;\n\t\t\t}\n\n\t\t\t// Text\n\t\t\tif (index < html.length) {\n\t\t\t\tself.text(decode(html.substr(index)));\n\t\t\t}\n\n\t\t\t// Close any open elements\n\t\t\tfor (i = stack.length - 1; i >= 0; i--) {\n\t\t\t\tvalue = stack[i];\n\n\t\t\t\tif (value.valid) {\n\t\t\t\t\tself.end(value.name);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tSaxParser.findEndTag = findEndTag;\n\n\treturn SaxParser;\n});\n\n// Included from: js/tinymce/classes/html/DomParser.js\n\n/**\n * DomParser.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class parses HTML code into a DOM like structure of nodes it will remove redundant whitespace and make\n * sure that the node tree is valid according to the specified schema.\n * So for example: <p>a<p>b</p>c</p> will become <p>a</p><p>b</p><p>c</p>\n *\n * @example\n * var parser = new tinymce.html.DomParser({validate: true}, schema);\n * var rootNode = parser.parse('<h1>content</h1>');\n *\n * @class tinymce.html.DomParser\n * @version 3.4\n */\ndefine(\"tinymce/html/DomParser\", [\n\t\"tinymce/html/Node\",\n\t\"tinymce/html/Schema\",\n\t\"tinymce/html/SaxParser\",\n\t\"tinymce/util/Tools\"\n], function(Node, Schema, SaxParser, Tools) {\n\tvar makeMap = Tools.makeMap, each = Tools.each, explode = Tools.explode, extend = Tools.extend;\n\n\tvar paddEmptyNode = function (settings, node) {\n\t\tif (settings.padd_empty_with_br) {\n\t\t\tnode.empty().append(new Node('br', '1')).shortEnded = true;\n\t\t} else {\n\t\t\tnode.empty().append(new Node('#text', '3')).value = '\\u00a0';\n\t\t}\n\t};\n\n\tvar hasOnlyChild = function (node, name) {\n\t\treturn node && node.firstChild === node.lastChild && node.firstChild.name === name;\n\t};\n\n\t/**\n\t * Constructs a new DomParser instance.\n\t *\n\t * @constructor\n\t * @method DomParser\n\t * @param {Object} settings Name/value collection of settings. comment, cdata, text, start and end are callbacks.\n\t * @param {tinymce.html.Schema} schema HTML Schema class to use when parsing.\n\t */\n\treturn function(settings, schema) {\n\t\tvar self = this, nodeFilters = {}, attributeFilters = [], matchedNodes = {}, matchedAttributes = {};\n\n\t\tsettings = settings || {};\n\t\tsettings.validate = \"validate\" in settings ? settings.validate : true;\n\t\tsettings.root_name = settings.root_name || 'body';\n\t\tself.schema = schema = schema || new Schema();\n\n\t\tfunction fixInvalidChildren(nodes) {\n\t\t\tvar ni, node, parent, parents, newParent, currentNode, tempNode, childNode, i;\n\t\t\tvar nonEmptyElements, whitespaceElements, nonSplitableElements, textBlockElements, specialElements, sibling, nextNode;\n\n\t\t\tnonSplitableElements = makeMap('tr,td,th,tbody,thead,tfoot,table');\n\t\t\tnonEmptyElements = schema.getNonEmptyElements();\n\t\t\twhitespaceElements = schema.getWhiteSpaceElements();\n\t\t\ttextBlockElements = schema.getTextBlockElements();\n\t\t\tspecialElements = schema.getSpecialElements();\n\n\t\t\tfor (ni = 0; ni < nodes.length; ni++) {\n\t\t\t\tnode = nodes[ni];\n\n\t\t\t\t// Already removed or fixed\n\t\t\t\tif (!node.parent || node.fixed) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// If the invalid element is a text block and the text block is within a parent LI element\n\t\t\t\t// Then unwrap the first text block and convert other sibling text blocks to LI elements similar to Word/Open Office\n\t\t\t\tif (textBlockElements[node.name] && node.parent.name == 'li') {\n\t\t\t\t\t// Move sibling text blocks after LI element\n\t\t\t\t\tsibling = node.next;\n\t\t\t\t\twhile (sibling) {\n\t\t\t\t\t\tif (textBlockElements[sibling.name]) {\n\t\t\t\t\t\t\tsibling.name = 'li';\n\t\t\t\t\t\t\tsibling.fixed = true;\n\t\t\t\t\t\t\tnode.parent.insert(sibling, node.parent);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsibling = sibling.next;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Unwrap current text block\n\t\t\t\t\tnode.unwrap(node);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Get list of all parent nodes until we find a valid parent to stick the child into\n\t\t\t\tparents = [node];\n\t\t\t\tfor (parent = node.parent; parent && !schema.isValidChild(parent.name, node.name) &&\n\t\t\t\t\t!nonSplitableElements[parent.name]; parent = parent.parent) {\n\t\t\t\t\tparents.push(parent);\n\t\t\t\t}\n\n\t\t\t\t// Found a suitable parent\n\t\t\t\tif (parent && parents.length > 1) {\n\t\t\t\t\t// Reverse the array since it makes looping easier\n\t\t\t\t\tparents.reverse();\n\n\t\t\t\t\t// Clone the related parent and insert that after the moved node\n\t\t\t\t\tnewParent = currentNode = self.filterNode(parents[0].clone());\n\n\t\t\t\t\t// Start cloning and moving children on the left side of the target node\n\t\t\t\t\tfor (i = 0; i < parents.length - 1; i++) {\n\t\t\t\t\t\tif (schema.isValidChild(currentNode.name, parents[i].name)) {\n\t\t\t\t\t\t\ttempNode = self.filterNode(parents[i].clone());\n\t\t\t\t\t\t\tcurrentNode.append(tempNode);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttempNode = currentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (childNode = parents[i].firstChild; childNode && childNode != parents[i + 1];) {\n\t\t\t\t\t\t\tnextNode = childNode.next;\n\t\t\t\t\t\t\ttempNode.append(childNode);\n\t\t\t\t\t\t\tchildNode = nextNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcurrentNode = tempNode;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!newParent.isEmpty(nonEmptyElements, whitespaceElements)) {\n\t\t\t\t\t\tparent.insert(newParent, parents[0], true);\n\t\t\t\t\t\tparent.insert(node, newParent);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tparent.insert(node, parents[0], true);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Check if the element is empty by looking through it's contents and special treatment for <p><br /></p>\n\t\t\t\t\tparent = parents[0];\n\t\t\t\t\tif (parent.isEmpty(nonEmptyElements, whitespaceElements) || hasOnlyChild(parent, 'br')) {\n\t\t\t\t\t\tparent.empty().remove();\n\t\t\t\t\t}\n\t\t\t\t} else if (node.parent) {\n\t\t\t\t\t// If it's an LI try to find a UL/OL for it or wrap it\n\t\t\t\t\tif (node.name === 'li') {\n\t\t\t\t\t\tsibling = node.prev;\n\t\t\t\t\t\tif (sibling && (sibling.name === 'ul' || sibling.name === 'ul')) {\n\t\t\t\t\t\t\tsibling.append(node);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsibling = node.next;\n\t\t\t\t\t\tif (sibling && (sibling.name === 'ul' || sibling.name === 'ul')) {\n\t\t\t\t\t\t\tsibling.insert(node, sibling.firstChild, true);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode.wrap(self.filterNode(new Node('ul', 1)));\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Try wrapping the element in a DIV\n\t\t\t\t\tif (schema.isValidChild(node.parent.name, 'div') && schema.isValidChild('div', node.name)) {\n\t\t\t\t\t\tnode.wrap(self.filterNode(new Node('div', 1)));\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// We failed wrapping it, then remove or unwrap it\n\t\t\t\t\t\tif (specialElements[node.name]) {\n\t\t\t\t\t\t\tnode.empty().remove();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.unwrap();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Runs the specified node though the element and attributes filters.\n\t\t *\n\t\t * @method filterNode\n\t\t * @param {tinymce.html.Node} Node the node to run filters on.\n\t\t * @return {tinymce.html.Node} The passed in node.\n\t\t */\n\t\tself.filterNode = function(node) {\n\t\t\tvar i, name, list;\n\n\t\t\t// Run element filters\n\t\t\tif (name in nodeFilters) {\n\t\t\t\tlist = matchedNodes[name];\n\n\t\t\t\tif (list) {\n\t\t\t\t\tlist.push(node);\n\t\t\t\t} else {\n\t\t\t\t\tmatchedNodes[name] = [node];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Run attribute filters\n\t\t\ti = attributeFilters.length;\n\t\t\twhile (i--) {\n\t\t\t\tname = attributeFilters[i].name;\n\n\t\t\t\tif (name in node.attributes.map) {\n\t\t\t\t\tlist = matchedAttributes[name];\n\n\t\t\t\t\tif (list) {\n\t\t\t\t\t\tlist.push(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmatchedAttributes[name] = [node];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn node;\n\t\t};\n\n\t\t/**\n\t\t * Adds a node filter function to the parser, the parser will collect the specified nodes by name\n\t\t * and then execute the callback ones it has finished parsing the document.\n\t\t *\n\t\t * @example\n\t\t * parser.addNodeFilter('p,h1', function(nodes, name) {\n\t\t *\t\tfor (var i = 0; i < nodes.length; i++) {\n\t\t *\t\t\tconsole.log(nodes[i].name);\n\t\t *\t\t}\n\t\t * });\n\t\t * @method addNodeFilter\n\t\t * @method {String} name Comma separated list of nodes to collect.\n\t\t * @param {function} callback Callback function to execute once it has collected nodes.\n\t\t */\n\t\tself.addNodeFilter = function(name, callback) {\n\t\t\teach(explode(name), function(name) {\n\t\t\t\tvar list = nodeFilters[name];\n\n\t\t\t\tif (!list) {\n\t\t\t\t\tnodeFilters[name] = list = [];\n\t\t\t\t}\n\n\t\t\t\tlist.push(callback);\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Adds a attribute filter function to the parser, the parser will collect nodes that has the specified attributes\n\t\t * and then execute the callback ones it has finished parsing the document.\n\t\t *\n\t\t * @example\n\t\t * parser.addAttributeFilter('src,href', function(nodes, name) {\n\t\t *\t\tfor (var i = 0; i < nodes.length; i++) {\n\t\t *\t\t\tconsole.log(nodes[i].name);\n\t\t *\t\t}\n\t\t * });\n\t\t * @method addAttributeFilter\n\t\t * @method {String} name Comma separated list of nodes to collect.\n\t\t * @param {function} callback Callback function to execute once it has collected nodes.\n\t\t */\n\t\tself.addAttributeFilter = function(name, callback) {\n\t\t\teach(explode(name), function(name) {\n\t\t\t\tvar i;\n\n\t\t\t\tfor (i = 0; i < attributeFilters.length; i++) {\n\t\t\t\t\tif (attributeFilters[i].name === name) {\n\t\t\t\t\t\tattributeFilters[i].callbacks.push(callback);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tattributeFilters.push({name: name, callbacks: [callback]});\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Parses the specified HTML string into a DOM like node tree and returns the result.\n\t\t *\n\t\t * @example\n\t\t * var rootNode = new DomParser({...}).parse('<b>text</b>');\n\t\t * @method parse\n\t\t * @param {String} html Html string to sax parse.\n\t\t * @param {Object} args Optional args object that gets passed to all filter functions.\n\t\t * @return {tinymce.html.Node} Root node containing the tree.\n\t\t */\n\t\tself.parse = function(html, args) {\n\t\t\tvar parser, rootNode, node, nodes, i, l, fi, fl, list, name, validate;\n\t\t\tvar blockElements, startWhiteSpaceRegExp, invalidChildren = [], isInWhiteSpacePreservedElement;\n\t\t\tvar endWhiteSpaceRegExp, allWhiteSpaceRegExp, isAllWhiteSpaceRegExp, whiteSpaceElements;\n\t\t\tvar children, nonEmptyElements, rootBlockName;\n\n\t\t\targs = args || {};\n\t\t\tmatchedNodes = {};\n\t\t\tmatchedAttributes = {};\n\t\t\tblockElements = extend(makeMap('script,style,head,html,body,title,meta,param'), schema.getBlockElements());\n\t\t\tnonEmptyElements = schema.getNonEmptyElements();\n\t\t\tchildren = schema.children;\n\t\t\tvalidate = settings.validate;\n\t\t\trootBlockName = \"forced_root_block\" in args ? args.forced_root_block : settings.forced_root_block;\n\n\t\t\twhiteSpaceElements = schema.getWhiteSpaceElements();\n\t\t\tstartWhiteSpaceRegExp = /^[ \\t\\r\\n]+/;\n\t\t\tendWhiteSpaceRegExp = /[ \\t\\r\\n]+$/;\n\t\t\tallWhiteSpaceRegExp = /[ \\t\\r\\n]+/g;\n\t\t\tisAllWhiteSpaceRegExp = /^[ \\t\\r\\n]+$/;\n\n\t\t\tfunction addRootBlocks() {\n\t\t\t\tvar node = rootNode.firstChild, next, rootBlockNode;\n\n\t\t\t\t// Removes whitespace at beginning and end of block so:\n\t\t\t\t// <p> x </p> -> <p>x</p>\n\t\t\t\tfunction trim(rootBlockNode) {\n\t\t\t\t\tif (rootBlockNode) {\n\t\t\t\t\t\tnode = rootBlockNode.firstChild;\n\t\t\t\t\t\tif (node && node.type == 3) {\n\t\t\t\t\t\t\tnode.value = node.value.replace(startWhiteSpaceRegExp, '');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = rootBlockNode.lastChild;\n\t\t\t\t\t\tif (node && node.type == 3) {\n\t\t\t\t\t\t\tnode.value = node.value.replace(endWhiteSpaceRegExp, '');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Check if rootBlock is valid within rootNode for example if P is valid in H1 if H1 is the contentEditabe root\n\t\t\t\tif (!schema.isValidChild(rootNode.name, rootBlockName.toLowerCase())) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twhile (node) {\n\t\t\t\t\tnext = node.next;\n\n\t\t\t\t\tif (node.type == 3 || (node.type == 1 && node.name !== 'p' &&\n\t\t\t\t\t\t!blockElements[node.name] && !node.attr('data-mce-type'))) {\n\t\t\t\t\t\tif (!rootBlockNode) {\n\t\t\t\t\t\t\t// Create a new root block element\n\t\t\t\t\t\t\trootBlockNode = createNode(rootBlockName, 1);\n\t\t\t\t\t\t\trootBlockNode.attr(settings.forced_root_block_attrs);\n\t\t\t\t\t\t\trootNode.insert(rootBlockNode, node);\n\t\t\t\t\t\t\trootBlockNode.append(node);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trootBlockNode.append(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttrim(rootBlockNode);\n\t\t\t\t\t\trootBlockNode = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = next;\n\t\t\t\t}\n\n\t\t\t\ttrim(rootBlockNode);\n\t\t\t}\n\n\t\t\tfunction createNode(name, type) {\n\t\t\t\tvar node = new Node(name, type), list;\n\n\t\t\t\tif (name in nodeFilters) {\n\t\t\t\t\tlist = matchedNodes[name];\n\n\t\t\t\t\tif (list) {\n\t\t\t\t\t\tlist.push(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmatchedNodes[name] = [node];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tfunction removeWhitespaceBefore(node) {\n\t\t\t\tvar textNode, textNodeNext, textVal, sibling, blockElements = schema.getBlockElements();\n\n\t\t\t\tfor (textNode = node.prev; textNode && textNode.type === 3;) {\n\t\t\t\t\ttextVal = textNode.value.replace(endWhiteSpaceRegExp, '');\n\n\t\t\t\t\t// Found a text node with non whitespace then trim that and break\n\t\t\t\t\tif (textVal.length > 0) {\n\t\t\t\t\t\ttextNode.value = textVal;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\ttextNodeNext = textNode.next;\n\n\t\t\t\t\t// Fix for bug #7543 where bogus nodes would produce empty\n\t\t\t\t\t// text nodes and these would be removed if a nested list was before it\n\t\t\t\t\tif (textNodeNext) {\n\t\t\t\t\t\tif (textNodeNext.type == 3 && textNodeNext.value.length) {\n\t\t\t\t\t\t\ttextNode = textNode.prev;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!blockElements[textNodeNext.name] && textNodeNext.name != 'script' && textNodeNext.name != 'style') {\n\t\t\t\t\t\t\ttextNode = textNode.prev;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tsibling = textNode.prev;\n\t\t\t\t\ttextNode.remove();\n\t\t\t\t\ttextNode = sibling;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction cloneAndExcludeBlocks(input) {\n\t\t\t\tvar name, output = {};\n\n\t\t\t\tfor (name in input) {\n\t\t\t\t\tif (name !== 'li' && name != 'p') {\n\t\t\t\t\t\toutput[name] = input[name];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn output;\n\t\t\t}\n\n\t\t\tparser = new SaxParser({\n\t\t\t\tvalidate: validate,\n\t\t\t\tallow_script_urls: settings.allow_script_urls,\n\t\t\t\tallow_conditional_comments: settings.allow_conditional_comments,\n\n\t\t\t\t// Exclude P and LI from DOM parsing since it's treated better by the DOM parser\n\t\t\t\tself_closing_elements: cloneAndExcludeBlocks(schema.getSelfClosingElements()),\n\n\t\t\t\tcdata: function(text) {\n\t\t\t\t\tnode.append(createNode('#cdata', 4)).value = text;\n\t\t\t\t},\n\n\t\t\t\ttext: function(text, raw) {\n\t\t\t\t\tvar textNode;\n\n\t\t\t\t\t// Trim all redundant whitespace on non white space elements\n\t\t\t\t\tif (!isInWhiteSpacePreservedElement) {\n\t\t\t\t\t\ttext = text.replace(allWhiteSpaceRegExp, ' ');\n\n\t\t\t\t\t\tif (node.lastChild && blockElements[node.lastChild.name]) {\n\t\t\t\t\t\t\ttext = text.replace(startWhiteSpaceRegExp, '');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Do we need to create the node\n\t\t\t\t\tif (text.length !== 0) {\n\t\t\t\t\t\ttextNode = createNode('#text', 3);\n\t\t\t\t\t\ttextNode.raw = !!raw;\n\t\t\t\t\t\tnode.append(textNode).value = text;\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tcomment: function(text) {\n\t\t\t\t\tnode.append(createNode('#comment', 8)).value = text;\n\t\t\t\t},\n\n\t\t\t\tpi: function(name, text) {\n\t\t\t\t\tnode.append(createNode(name, 7)).value = text;\n\t\t\t\t\tremoveWhitespaceBefore(node);\n\t\t\t\t},\n\n\t\t\t\tdoctype: function(text) {\n\t\t\t\t\tvar newNode;\n\n\t\t\t\t\tnewNode = node.append(createNode('#doctype', 10));\n\t\t\t\t\tnewNode.value = text;\n\t\t\t\t\tremoveWhitespaceBefore(node);\n\t\t\t\t},\n\n\t\t\t\tstart: function(name, attrs, empty) {\n\t\t\t\t\tvar newNode, attrFiltersLen, elementRule, attrName, parent;\n\n\t\t\t\t\telementRule = validate ? schema.getElementRule(name) : {};\n\t\t\t\t\tif (elementRule) {\n\t\t\t\t\t\tnewNode = createNode(elementRule.outputName || name, 1);\n\t\t\t\t\t\tnewNode.attributes = attrs;\n\t\t\t\t\t\tnewNode.shortEnded = empty;\n\n\t\t\t\t\t\tnode.append(newNode);\n\n\t\t\t\t\t\t// Check if node is valid child of the parent node is the child is\n\t\t\t\t\t\t// unknown we don't collect it since it's probably a custom element\n\t\t\t\t\t\tparent = children[node.name];\n\t\t\t\t\t\tif (parent && children[newNode.name] && !parent[newNode.name]) {\n\t\t\t\t\t\t\tinvalidChildren.push(newNode);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tattrFiltersLen = attributeFilters.length;\n\t\t\t\t\t\twhile (attrFiltersLen--) {\n\t\t\t\t\t\t\tattrName = attributeFilters[attrFiltersLen].name;\n\n\t\t\t\t\t\t\tif (attrName in attrs.map) {\n\t\t\t\t\t\t\t\tlist = matchedAttributes[attrName];\n\n\t\t\t\t\t\t\t\tif (list) {\n\t\t\t\t\t\t\t\t\tlist.push(newNode);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tmatchedAttributes[attrName] = [newNode];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Trim whitespace before block\n\t\t\t\t\t\tif (blockElements[name]) {\n\t\t\t\t\t\t\tremoveWhitespaceBefore(newNode);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Change current node if the element wasn't empty i.e not <br /> or <img />\n\t\t\t\t\t\tif (!empty) {\n\t\t\t\t\t\t\tnode = newNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Check if we are inside a whitespace preserved element\n\t\t\t\t\t\tif (!isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\n\t\t\t\t\t\t\tisInWhiteSpacePreservedElement = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tend: function(name) {\n\t\t\t\t\tvar textNode, elementRule, text, sibling, tempNode;\n\n\t\t\t\t\telementRule = validate ? schema.getElementRule(name) : {};\n\t\t\t\t\tif (elementRule) {\n\t\t\t\t\t\tif (blockElements[name]) {\n\t\t\t\t\t\t\tif (!isInWhiteSpacePreservedElement) {\n\t\t\t\t\t\t\t\t// Trim whitespace of the first node in a block\n\t\t\t\t\t\t\t\ttextNode = node.firstChild;\n\t\t\t\t\t\t\t\tif (textNode && textNode.type === 3) {\n\t\t\t\t\t\t\t\t\ttext = textNode.value.replace(startWhiteSpaceRegExp, '');\n\n\t\t\t\t\t\t\t\t\t// Any characters left after trim or should we remove it\n\t\t\t\t\t\t\t\t\tif (text.length > 0) {\n\t\t\t\t\t\t\t\t\t\ttextNode.value = text;\n\t\t\t\t\t\t\t\t\t\ttextNode = textNode.next;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tsibling = textNode.next;\n\t\t\t\t\t\t\t\t\t\ttextNode.remove();\n\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\n\n\t\t\t\t\t\t\t\t\t\t// Remove any pure whitespace siblings\n\t\t\t\t\t\t\t\t\t\twhile (textNode && textNode.type === 3) {\n\t\t\t\t\t\t\t\t\t\t\ttext = textNode.value;\n\t\t\t\t\t\t\t\t\t\t\tsibling = textNode.next;\n\n\t\t\t\t\t\t\t\t\t\t\tif (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\n\t\t\t\t\t\t\t\t\t\t\t\ttextNode.remove();\n\t\t\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Trim whitespace of the last node in a block\n\t\t\t\t\t\t\t\ttextNode = node.lastChild;\n\t\t\t\t\t\t\t\tif (textNode && textNode.type === 3) {\n\t\t\t\t\t\t\t\t\ttext = textNode.value.replace(endWhiteSpaceRegExp, '');\n\n\t\t\t\t\t\t\t\t\t// Any characters left after trim or should we remove it\n\t\t\t\t\t\t\t\t\tif (text.length > 0) {\n\t\t\t\t\t\t\t\t\t\ttextNode.value = text;\n\t\t\t\t\t\t\t\t\t\ttextNode = textNode.prev;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tsibling = textNode.prev;\n\t\t\t\t\t\t\t\t\t\ttextNode.remove();\n\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\n\n\t\t\t\t\t\t\t\t\t\t// Remove any pure whitespace siblings\n\t\t\t\t\t\t\t\t\t\twhile (textNode && textNode.type === 3) {\n\t\t\t\t\t\t\t\t\t\t\ttext = textNode.value;\n\t\t\t\t\t\t\t\t\t\t\tsibling = textNode.prev;\n\n\t\t\t\t\t\t\t\t\t\t\tif (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\n\t\t\t\t\t\t\t\t\t\t\t\ttextNode.remove();\n\t\t\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Trim start white space\n\t\t\t\t\t\t\t// Removed due to: #5424\n\t\t\t\t\t\t\t/*textNode = node.prev;\n\t\t\t\t\t\t\tif (textNode && textNode.type === 3) {\n\t\t\t\t\t\t\t\ttext = textNode.value.replace(startWhiteSpaceRegExp, '');\n\n\t\t\t\t\t\t\t\tif (text.length > 0)\n\t\t\t\t\t\t\t\t\ttextNode.value = text;\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\ttextNode.remove();\n\t\t\t\t\t\t\t}*/\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Check if we exited a whitespace preserved element\n\t\t\t\t\t\tif (isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\n\t\t\t\t\t\t\tisInWhiteSpacePreservedElement = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Handle empty nodes\n\t\t\t\t\t\tif (elementRule.removeEmpty || elementRule.paddEmpty) {\n\t\t\t\t\t\t\tif (node.isEmpty(nonEmptyElements, whiteSpaceElements)) {\n\t\t\t\t\t\t\t\tif (elementRule.paddEmpty) {\n\t\t\t\t\t\t\t\t\tpaddEmptyNode(settings, node);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// Leave nodes that have a name like <a name=\"name\">\n\t\t\t\t\t\t\t\t\tif (!node.attributes.map.name && !node.attributes.map.id) {\n\t\t\t\t\t\t\t\t\t\ttempNode = node.parent;\n\n\t\t\t\t\t\t\t\t\t\tif (blockElements[node.name]) {\n\t\t\t\t\t\t\t\t\t\t\tnode.empty().remove();\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tnode.unwrap();\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tnode = tempNode;\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parent;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, schema);\n\n\t\t\trootNode = node = new Node(args.context || settings.root_name, 11);\n\n\t\t\tparser.parse(html);\n\n\t\t\t// Fix invalid children or report invalid children in a contextual parsing\n\t\t\tif (validate && invalidChildren.length) {\n\t\t\t\tif (!args.context) {\n\t\t\t\t\tfixInvalidChildren(invalidChildren);\n\t\t\t\t} else {\n\t\t\t\t\targs.invalid = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Wrap nodes in the root into block elements if the root is body\n\t\t\tif (rootBlockName && (rootNode.name == 'body' || args.isRootContent)) {\n\t\t\t\taddRootBlocks();\n\t\t\t}\n\n\t\t\t// Run filters only when the contents is valid\n\t\t\tif (!args.invalid) {\n\t\t\t\t// Run node filters\n\t\t\t\tfor (name in matchedNodes) {\n\t\t\t\t\tlist = nodeFilters[name];\n\t\t\t\t\tnodes = matchedNodes[name];\n\n\t\t\t\t\t// Remove already removed children\n\t\t\t\t\tfi = nodes.length;\n\t\t\t\t\twhile (fi--) {\n\t\t\t\t\t\tif (!nodes[fi].parent) {\n\t\t\t\t\t\t\tnodes.splice(fi, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (i = 0, l = list.length; i < l; i++) {\n\t\t\t\t\t\tlist[i](nodes, name, args);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Run attribute filters\n\t\t\t\tfor (i = 0, l = attributeFilters.length; i < l; i++) {\n\t\t\t\t\tlist = attributeFilters[i];\n\n\t\t\t\t\tif (list.name in matchedAttributes) {\n\t\t\t\t\t\tnodes = matchedAttributes[list.name];\n\n\t\t\t\t\t\t// Remove already removed children\n\t\t\t\t\t\tfi = nodes.length;\n\t\t\t\t\t\twhile (fi--) {\n\t\t\t\t\t\t\tif (!nodes[fi].parent) {\n\t\t\t\t\t\t\t\tnodes.splice(fi, 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (fi = 0, fl = list.callbacks.length; fi < fl; fi++) {\n\t\t\t\t\t\t\tlist.callbacks[fi](nodes, list.name, args);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn rootNode;\n\t\t};\n\n\t\t// Remove <br> at end of block elements Gecko and WebKit injects BR elements to\n\t\t// make it possible to place the caret inside empty blocks. This logic tries to remove\n\t\t// these elements and keep br elements that where intended to be there intact\n\t\tif (settings.remove_trailing_brs) {\n\t\t\tself.addNodeFilter('br', function(nodes) {\n\t\t\t\tvar i, l = nodes.length, node, blockElements = extend({}, schema.getBlockElements());\n\t\t\t\tvar nonEmptyElements = schema.getNonEmptyElements(), parent, lastParent, prev, prevName;\n\t\t\t\tvar whiteSpaceElements = schema.getNonEmptyElements();\n\t\t\t\tvar elementRule, textNode;\n\n\t\t\t\t// Remove brs from body element as well\n\t\t\t\tblockElements.body = 1;\n\n\t\t\t\t// Must loop forwards since it will otherwise remove all brs in <p>a<br><br><br></p>\n\t\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tparent = node.parent;\n\n\t\t\t\t\tif (blockElements[node.parent.name] && node === parent.lastChild) {\n\t\t\t\t\t\t// Loop all nodes to the left of the current node and check for other BR elements\n\t\t\t\t\t\t// excluding bookmarks since they are invisible\n\t\t\t\t\t\tprev = node.prev;\n\t\t\t\t\t\twhile (prev) {\n\t\t\t\t\t\t\tprevName = prev.name;\n\n\t\t\t\t\t\t\t// Ignore bookmarks\n\t\t\t\t\t\t\tif (prevName !== \"span\" || prev.attr('data-mce-type') !== 'bookmark') {\n\t\t\t\t\t\t\t\t// Found a non BR element\n\t\t\t\t\t\t\t\tif (prevName !== \"br\") {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Found another br it's a <br><br> structure then don't remove anything\n\t\t\t\t\t\t\t\tif (prevName === 'br') {\n\t\t\t\t\t\t\t\t\tnode = null;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tprev = prev.prev;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (node) {\n\t\t\t\t\t\t\tnode.remove();\n\n\t\t\t\t\t\t\t// Is the parent to be considered empty after we removed the BR\n\t\t\t\t\t\t\tif (parent.isEmpty(nonEmptyElements, whiteSpaceElements)) {\n\t\t\t\t\t\t\t\telementRule = schema.getElementRule(parent.name);\n\n\t\t\t\t\t\t\t\t// Remove or padd the element depending on schema rule\n\t\t\t\t\t\t\t\tif (elementRule) {\n\t\t\t\t\t\t\t\t\tif (elementRule.removeEmpty) {\n\t\t\t\t\t\t\t\t\t\tparent.remove();\n\t\t\t\t\t\t\t\t\t} else if (elementRule.paddEmpty) {\n\t\t\t\t\t\t\t\t\t\tpaddEmptyNode(settings, parent);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Replaces BR elements inside inline elements like <p><b><i><br></i></b></p>\n\t\t\t\t\t\t// so they become <p><b><i>&nbsp;</i></b></p>\n\t\t\t\t\t\tlastParent = node;\n\t\t\t\t\t\twhile (parent && parent.firstChild === lastParent && parent.lastChild === lastParent) {\n\t\t\t\t\t\t\tlastParent = parent;\n\n\t\t\t\t\t\t\tif (blockElements[parent.name]) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tparent = parent.parent;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (lastParent === parent && settings.padd_empty_with_br !== true) {\n\t\t\t\t\t\t\ttextNode = new Node('#text', 3);\n\t\t\t\t\t\t\ttextNode.value = '\\u00a0';\n\t\t\t\t\t\t\tnode.replace(textNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (!settings.allow_unsafe_link_target) {\n\t\t\tself.addAttributeFilter('href', function(nodes) {\n\t\t\t\tvar i = nodes.length, node, rel;\n\t\t\t\tvar rules = 'noopener noreferrer';\n\n\t\t\t\tfunction addTargetRules(rel) {\n\t\t\t\t\trel = removeTargetRules(rel);\n\t\t\t\t\treturn rel ? [rel, rules].join(' ') : rules;\n\t\t\t\t}\n\n\t\t\t\tfunction removeTargetRules(rel) {\n\t\t\t\t\tvar regExp = new RegExp('(' + rules.replace(' ', '|') + ')', 'g');\n\t\t\t\t\tif (rel) {\n\t\t\t\t\t\trel = Tools.trim(rel.replace(regExp, ''));\n\t\t\t\t\t}\n\t\t\t\t\treturn rel ? rel : null;\n\t\t\t\t}\n\n\t\t\t\tfunction toggleTargetRules(rel, isUnsafe) {\n\t\t\t\t\treturn isUnsafe ? addTargetRules(rel) : removeTargetRules(rel);\n\t\t\t\t}\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\trel = node.attr('rel');\n\t\t\t\t\tif (node.name === 'a') {\n\t\t\t\t\t\tnode.attr('rel', toggleTargetRules(rel, node.attr('target') == '_blank'));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Force anchor names closed, unless the setting \"allow_html_in_named_anchor\" is explicitly included.\n\t\tif (!settings.allow_html_in_named_anchor) {\n\t\t\tself.addAttributeFilter('id,name', function(nodes) {\n\t\t\t\tvar i = nodes.length, sibling, prevSibling, parent, node;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tif (node.name === 'a' && node.firstChild && !node.attr('href')) {\n\t\t\t\t\t\tparent = node.parent;\n\n\t\t\t\t\t\t// Move children after current node\n\t\t\t\t\t\tsibling = node.lastChild;\n\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\tprevSibling = sibling.prev;\n\t\t\t\t\t\t\tparent.insert(sibling, node);\n\t\t\t\t\t\t\tsibling = prevSibling;\n\t\t\t\t\t\t} while (sibling);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (settings.fix_list_elements) {\n\t\t\tself.addNodeFilter('ul,ol', function(nodes) {\n\t\t\t\tvar i = nodes.length, node, parentNode;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tparentNode = node.parent;\n\n\t\t\t\t\tif (parentNode.name === 'ul' || parentNode.name === 'ol') {\n\t\t\t\t\t\tif (node.prev && node.prev.name === 'li') {\n\t\t\t\t\t\t\tnode.prev.append(node);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar li = new Node('li', 1);\n\t\t\t\t\t\t\tli.attr('style', 'list-style-type: none');\n\t\t\t\t\t\t\tnode.wrap(li);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (settings.validate && schema.getValidClasses()) {\n\t\t\tself.addAttributeFilter('class', function(nodes) {\n\t\t\t\tvar i = nodes.length, node, classList, ci, className, classValue;\n\t\t\t\tvar validClasses = schema.getValidClasses(), validClassesMap, valid;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tclassList = node.attr('class').split(' ');\n\t\t\t\t\tclassValue = '';\n\n\t\t\t\t\tfor (ci = 0; ci < classList.length; ci++) {\n\t\t\t\t\t\tclassName = classList[ci];\n\t\t\t\t\t\tvalid = false;\n\n\t\t\t\t\t\tvalidClassesMap = validClasses['*'];\n\t\t\t\t\t\tif (validClassesMap && validClassesMap[className]) {\n\t\t\t\t\t\t\tvalid = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvalidClassesMap = validClasses[node.name];\n\t\t\t\t\t\tif (!valid && validClassesMap && validClassesMap[className]) {\n\t\t\t\t\t\t\tvalid = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (valid) {\n\t\t\t\t\t\t\tif (classValue) {\n\t\t\t\t\t\t\t\tclassValue += ' ';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tclassValue += className;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!classValue.length) {\n\t\t\t\t\t\tclassValue = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode.attr('class', classValue);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/html/Writer.js\n\n/**\n * Writer.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is used to write HTML tags out it can be used with the Serializer or the SaxParser.\n *\n * @class tinymce.html.Writer\n * @example\n * var writer = new tinymce.html.Writer({indent: true});\n * var parser = new tinymce.html.SaxParser(writer).parse('<p><br></p>');\n * console.log(writer.getContent());\n *\n * @class tinymce.html.Writer\n * @version 3.4\n */\ndefine(\"tinymce/html/Writer\", [\n\t\"tinymce/html/Entities\",\n\t\"tinymce/util/Tools\"\n], function(Entities, Tools) {\n\tvar makeMap = Tools.makeMap;\n\n\t/**\n\t * Constructs a new Writer instance.\n\t *\n\t * @constructor\n\t * @method Writer\n\t * @param {Object} settings Name/value settings object.\n\t */\n\treturn function(settings) {\n\t\tvar html = [], indent, indentBefore, indentAfter, encode, htmlOutput;\n\n\t\tsettings = settings || {};\n\t\tindent = settings.indent;\n\t\tindentBefore = makeMap(settings.indent_before || '');\n\t\tindentAfter = makeMap(settings.indent_after || '');\n\t\tencode = Entities.getEncodeFunc(settings.entity_encoding || 'raw', settings.entities);\n\t\thtmlOutput = settings.element_format == \"html\";\n\n\t\treturn {\n\t\t\t/**\n\t\t\t * Writes the a start element such as <p id=\"a\">.\n\t\t\t *\n\t\t\t * @method start\n\t\t\t * @param {String} name Name of the element.\n\t\t\t * @param {Array} attrs Optional attribute array or undefined if it hasn't any.\n\t\t\t * @param {Boolean} empty Optional empty state if the tag should end like <br />.\n\t\t\t */\n\t\t\tstart: function(name, attrs, empty) {\n\t\t\t\tvar i, l, attr, value;\n\n\t\t\t\tif (indent && indentBefore[name] && html.length > 0) {\n\t\t\t\t\tvalue = html[html.length - 1];\n\n\t\t\t\t\tif (value.length > 0 && value !== '\\n') {\n\t\t\t\t\t\thtml.push('\\n');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\thtml.push('<', name);\n\n\t\t\t\tif (attrs) {\n\t\t\t\t\tfor (i = 0, l = attrs.length; i < l; i++) {\n\t\t\t\t\t\tattr = attrs[i];\n\t\t\t\t\t\thtml.push(' ', attr.name, '=\"', encode(attr.value, true), '\"');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!empty || htmlOutput) {\n\t\t\t\t\thtml[html.length] = '>';\n\t\t\t\t} else {\n\t\t\t\t\thtml[html.length] = ' />';\n\t\t\t\t}\n\n\t\t\t\tif (empty && indent && indentAfter[name] && html.length > 0) {\n\t\t\t\t\tvalue = html[html.length - 1];\n\n\t\t\t\t\tif (value.length > 0 && value !== '\\n') {\n\t\t\t\t\t\thtml.push('\\n');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Writes the a end element such as </p>.\n\t\t\t *\n\t\t\t * @method end\n\t\t\t * @param {String} name Name of the element.\n\t\t\t */\n\t\t\tend: function(name) {\n\t\t\t\tvar value;\n\n\t\t\t\t/*if (indent && indentBefore[name] && html.length > 0) {\n\t\t\t\t\tvalue = html[html.length - 1];\n\n\t\t\t\t\tif (value.length > 0 && value !== '\\n')\n\t\t\t\t\t\thtml.push('\\n');\n\t\t\t\t}*/\n\n\t\t\t\thtml.push('</', name, '>');\n\n\t\t\t\tif (indent && indentAfter[name] && html.length > 0) {\n\t\t\t\t\tvalue = html[html.length - 1];\n\n\t\t\t\t\tif (value.length > 0 && value !== '\\n') {\n\t\t\t\t\t\thtml.push('\\n');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Writes a text node.\n\t\t\t *\n\t\t\t * @method text\n\t\t\t * @param {String} text String to write out.\n\t\t\t * @param {Boolean} raw Optional raw state if true the contents wont get encoded.\n\t\t\t */\n\t\t\ttext: function(text, raw) {\n\t\t\t\tif (text.length > 0) {\n\t\t\t\t\thtml[html.length] = raw ? text : encode(text);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Writes a cdata node such as <![CDATA[data]]>.\n\t\t\t *\n\t\t\t * @method cdata\n\t\t\t * @param {String} text String to write out inside the cdata.\n\t\t\t */\n\t\t\tcdata: function(text) {\n\t\t\t\thtml.push('<![CDATA[', text, ']]>');\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Writes a comment node such as <!-- Comment -->.\n\t\t\t *\n\t\t\t * @method cdata\n\t\t\t * @param {String} text String to write out inside the comment.\n\t\t\t */\n\t\t\tcomment: function(text) {\n\t\t\t\thtml.push('<!--', text, '-->');\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Writes a PI node such as <?xml attr=\"value\" ?>.\n\t\t\t *\n\t\t\t * @method pi\n\t\t\t * @param {String} name Name of the pi.\n\t\t\t * @param {String} text String to write out inside the pi.\n\t\t\t */\n\t\t\tpi: function(name, text) {\n\t\t\t\tif (text) {\n\t\t\t\t\thtml.push('<?', name, ' ', encode(text), '?>');\n\t\t\t\t} else {\n\t\t\t\t\thtml.push('<?', name, '?>');\n\t\t\t\t}\n\n\t\t\t\tif (indent) {\n\t\t\t\t\thtml.push('\\n');\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Writes a doctype node such as <!DOCTYPE data>.\n\t\t\t *\n\t\t\t * @method doctype\n\t\t\t * @param {String} text String to write out inside the doctype.\n\t\t\t */\n\t\t\tdoctype: function(text) {\n\t\t\t\thtml.push('<!DOCTYPE', text, '>', indent ? '\\n' : '');\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Resets the internal buffer if one wants to reuse the writer.\n\t\t\t *\n\t\t\t * @method reset\n\t\t\t */\n\t\t\treset: function() {\n\t\t\t\thtml.length = 0;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Returns the contents that got serialized.\n\t\t\t *\n\t\t\t * @method getContent\n\t\t\t * @return {String} HTML contents that got written down.\n\t\t\t */\n\t\t\tgetContent: function() {\n\t\t\t\treturn html.join('').replace(/\\n$/, '');\n\t\t\t}\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/html/Serializer.js\n\n/**\n * Serializer.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is used to serialize down the DOM tree into a string using a Writer instance.\n *\n *\n * @example\n * new tinymce.html.Serializer().serialize(new tinymce.html.DomParser().parse('<p>text</p>'));\n * @class tinymce.html.Serializer\n * @version 3.4\n */\ndefine(\"tinymce/html/Serializer\", [\n\t\"tinymce/html/Writer\",\n\t\"tinymce/html/Schema\"\n], function(Writer, Schema) {\n\t/**\n\t * Constructs a new Serializer instance.\n\t *\n\t * @constructor\n\t * @method Serializer\n\t * @param {Object} settings Name/value settings object.\n\t * @param {tinymce.html.Schema} schema Schema instance to use.\n\t */\n\treturn function(settings, schema) {\n\t\tvar self = this, writer = new Writer(settings);\n\n\t\tsettings = settings || {};\n\t\tsettings.validate = \"validate\" in settings ? settings.validate : true;\n\n\t\tself.schema = schema = schema || new Schema();\n\t\tself.writer = writer;\n\n\t\t/**\n\t\t * Serializes the specified node into a string.\n\t\t *\n\t\t * @example\n\t\t * new tinymce.html.Serializer().serialize(new tinymce.html.DomParser().parse('<p>text</p>'));\n\t\t * @method serialize\n\t\t * @param {tinymce.html.Node} node Node instance to serialize.\n\t\t * @return {String} String with HTML based on DOM tree.\n\t\t */\n\t\tself.serialize = function(node) {\n\t\t\tvar handlers, validate;\n\n\t\t\tvalidate = settings.validate;\n\n\t\t\thandlers = {\n\t\t\t\t// #text\n\t\t\t\t3: function(node) {\n\t\t\t\t\twriter.text(node.value, node.raw);\n\t\t\t\t},\n\n\t\t\t\t// #comment\n\t\t\t\t8: function(node) {\n\t\t\t\t\twriter.comment(node.value);\n\t\t\t\t},\n\n\t\t\t\t// Processing instruction\n\t\t\t\t7: function(node) {\n\t\t\t\t\twriter.pi(node.name, node.value);\n\t\t\t\t},\n\n\t\t\t\t// Doctype\n\t\t\t\t10: function(node) {\n\t\t\t\t\twriter.doctype(node.value);\n\t\t\t\t},\n\n\t\t\t\t// CDATA\n\t\t\t\t4: function(node) {\n\t\t\t\t\twriter.cdata(node.value);\n\t\t\t\t},\n\n\t\t\t\t// Document fragment\n\t\t\t\t11: function(node) {\n\t\t\t\t\tif ((node = node.firstChild)) {\n\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\twalk(node);\n\t\t\t\t\t\t} while ((node = node.next));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\twriter.reset();\n\n\t\t\tfunction walk(node) {\n\t\t\t\tvar handler = handlers[node.type], name, isEmpty, attrs, attrName, attrValue, sortedAttrs, i, l, elementRule;\n\n\t\t\t\tif (!handler) {\n\t\t\t\t\tname = node.name;\n\t\t\t\t\tisEmpty = node.shortEnded;\n\t\t\t\t\tattrs = node.attributes;\n\n\t\t\t\t\t// Sort attributes\n\t\t\t\t\tif (validate && attrs && attrs.length > 1) {\n\t\t\t\t\t\tsortedAttrs = [];\n\t\t\t\t\t\tsortedAttrs.map = {};\n\n\t\t\t\t\t\telementRule = schema.getElementRule(node.name);\n\t\t\t\t\t\tif (elementRule) {\n\t\t\t\t\t\t\tfor (i = 0, l = elementRule.attributesOrder.length; i < l; i++) {\n\t\t\t\t\t\t\t\tattrName = elementRule.attributesOrder[i];\n\n\t\t\t\t\t\t\t\tif (attrName in attrs.map) {\n\t\t\t\t\t\t\t\t\tattrValue = attrs.map[attrName];\n\t\t\t\t\t\t\t\t\tsortedAttrs.map[attrName] = attrValue;\n\t\t\t\t\t\t\t\t\tsortedAttrs.push({name: attrName, value: attrValue});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfor (i = 0, l = attrs.length; i < l; i++) {\n\t\t\t\t\t\t\t\tattrName = attrs[i].name;\n\n\t\t\t\t\t\t\t\tif (!(attrName in sortedAttrs.map)) {\n\t\t\t\t\t\t\t\t\tattrValue = attrs.map[attrName];\n\t\t\t\t\t\t\t\t\tsortedAttrs.map[attrName] = attrValue;\n\t\t\t\t\t\t\t\t\tsortedAttrs.push({name: attrName, value: attrValue});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tattrs = sortedAttrs;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\twriter.start(node.name, attrs, isEmpty);\n\n\t\t\t\t\tif (!isEmpty) {\n\t\t\t\t\t\tif ((node = node.firstChild)) {\n\t\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\t\twalk(node);\n\t\t\t\t\t\t\t} while ((node = node.next));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\twriter.end(name);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\thandler(node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Serialize element and treat all non elements as fragments\n\t\t\tif (node.type == 1 && !settings.inner) {\n\t\t\t\twalk(node);\n\t\t\t} else {\n\t\t\t\thandlers[11](node);\n\t\t\t}\n\n\t\t\treturn writer.getContent();\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/Serializer.js\n\n/**\n * Serializer.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is used to serialize DOM trees into a string. Consult the TinyMCE Wiki API for\n * more details and examples on how to use this class.\n *\n * @class tinymce.dom.Serializer\n */\ndefine(\"tinymce/dom/Serializer\", [\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/html/DomParser\",\n\t\"tinymce/html/SaxParser\",\n\t\"tinymce/html/Entities\",\n\t\"tinymce/html/Serializer\",\n\t\"tinymce/html/Node\",\n\t\"tinymce/html/Schema\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/text/Zwsp\"\n], function(DOMUtils, DomParser, SaxParser, Entities, Serializer, Node, Schema, Env, Tools, Zwsp) {\n\tvar each = Tools.each, trim = Tools.trim;\n\tvar DOM = DOMUtils.DOM;\n\n\t/**\n\t * IE 11 has a fantastic bug where it will produce two trailing BR elements to iframe bodies when\n\t * the iframe is hidden by display: none on a parent container. The DOM is actually out of sync\n\t * with innerHTML in this case. It's like IE adds shadow DOM BR elements that appears on innerHTML\n\t * but not as the lastChild of the body. So this fix simply removes the last two\n\t * BR elements at the end of the document.\n\t *\n\t * Example of what happens: <body>text</body> becomes <body>text<br><br></body>\n\t */\n\tfunction trimTrailingBr(rootNode) {\n\t\tvar brNode1, brNode2;\n\n\t\tfunction isBr(node) {\n\t\t\treturn node && node.name === 'br';\n\t\t}\n\n\t\tbrNode1 = rootNode.lastChild;\n\t\tif (isBr(brNode1)) {\n\t\t\tbrNode2 = brNode1.prev;\n\n\t\t\tif (isBr(brNode2)) {\n\t\t\t\tbrNode1.remove();\n\t\t\t\tbrNode2.remove();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Constructs a new DOM serializer class.\n\t *\n\t * @constructor\n\t * @method Serializer\n\t * @param {Object} settings Serializer settings object.\n\t * @param {tinymce.Editor} editor Optional editor to bind events to and get schema/dom from.\n\t */\n\treturn function(settings, editor) {\n\t\tvar dom, schema, htmlParser, tempAttrs = [\"data-mce-selected\"];\n\n\t\tif (editor) {\n\t\t\tdom = editor.dom;\n\t\t\tschema = editor.schema;\n\t\t}\n\n\t\tfunction trimHtml(html) {\n\t\t\tvar trimContentRegExp = new RegExp([\n\t\t\t\t'<span[^>]+data-mce-bogus[^>]+>[\\u200B\\uFEFF]+<\\\\/span>', // Trim bogus spans like caret containers\n\t\t\t\t'\\\\s?(' + tempAttrs.join('|') + ')=\"[^\"]+\"' // Trim temporaty data-mce prefixed attributes like data-mce-selected\n\t\t\t].join('|'), 'gi');\n\n\t\t\thtml = Zwsp.trim(html.replace(trimContentRegExp, ''));\n\n\t\t\treturn html;\n\t\t}\n\n\t\tfunction trimContent(html) {\n\t\t\tvar content = html;\n\t\t\tvar bogusAllRegExp = /<(\\w+) [^>]*data-mce-bogus=\"all\"[^>]*>/g;\n\t\t\tvar endTagIndex, index, matchLength, matches, shortEndedElements, schema = editor.schema;\n\n\t\t\tcontent = trimHtml(content);\n\t\t\tshortEndedElements = schema.getShortEndedElements();\n\n\t\t\t// Remove all bogus elements marked with \"all\"\n\t\t\twhile ((matches = bogusAllRegExp.exec(content))) {\n\t\t\t\tindex = bogusAllRegExp.lastIndex;\n\t\t\t\tmatchLength = matches[0].length;\n\n\t\t\t\tif (shortEndedElements[matches[1]]) {\n\t\t\t\t\tendTagIndex = index;\n\t\t\t\t} else {\n\t\t\t\t\tendTagIndex = SaxParser.findEndTag(schema, content, index);\n\t\t\t\t}\n\n\t\t\t\tcontent = content.substring(0, index - matchLength) + content.substring(endTagIndex);\n\t\t\t\tbogusAllRegExp.lastIndex = index - matchLength;\n\t\t\t}\n\n\t\t\treturn content;\n\t\t}\n\n\t\t/**\n\t\t * Returns a trimmed version of the editor contents to be used for the undo level. This\n\t\t * will remove any data-mce-bogus=\"all\" marked elements since these are used for UI it will also\n\t\t * remove the data-mce-selected attributes used for selection of objects and caret containers.\n\t\t * It will keep all data-mce-bogus=\"1\" elements since these can be used to place the caret etc and will\n\t\t * be removed by the serialization logic when you save.\n\t\t *\n\t\t * @private\n\t\t * @return {String} HTML contents of the editor excluding some internal bogus elements.\n\t\t */\n\t\tfunction getTrimmedContent() {\n\t\t\treturn trimContent(editor.getBody().innerHTML);\n\t\t}\n\n\t\tfunction addTempAttr(name) {\n\t\t\tif (Tools.inArray(tempAttrs, name) === -1) {\n\t\t\t\thtmlParser.addAttributeFilter(name, function(nodes, name) {\n\t\t\t\t\tvar i = nodes.length;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnodes[i].attr(name, null);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\ttempAttrs.push(name);\n\t\t\t}\n\t\t}\n\n\t\t// Default DOM and Schema if they are undefined\n\t\tdom = dom || DOM;\n\t\tschema = schema || new Schema(settings);\n\t\tsettings.entity_encoding = settings.entity_encoding || 'named';\n\t\tsettings.remove_trailing_brs = \"remove_trailing_brs\" in settings ? settings.remove_trailing_brs : true;\n\n\t\thtmlParser = new DomParser(settings, schema);\n\n\t\t// Convert tabindex back to elements when serializing contents\n\t\thtmlParser.addAttributeFilter('data-mce-tabindex', function(nodes, name) {\n\t\t\tvar i = nodes.length, node;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\t\t\t\tnode.attr('tabindex', node.attributes.map['data-mce-tabindex']);\n\t\t\t\tnode.attr(name, null);\n\t\t\t}\n\t\t});\n\n\t\t// Convert move data-mce-src, data-mce-href and data-mce-style into nodes or process them if needed\n\t\thtmlParser.addAttributeFilter('src,href,style', function(nodes, name) {\n\t\t\tvar i = nodes.length, node, value, internalName = 'data-mce-' + name;\n\t\t\tvar urlConverter = settings.url_converter, urlConverterScope = settings.url_converter_scope, undef;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\n\t\t\t\tvalue = node.attributes.map[internalName];\n\t\t\t\tif (value !== undef) {\n\t\t\t\t\t// Set external name to internal value and remove internal\n\t\t\t\t\tnode.attr(name, value.length > 0 ? value : null);\n\t\t\t\t\tnode.attr(internalName, null);\n\t\t\t\t} else {\n\t\t\t\t\t// No internal attribute found then convert the value we have in the DOM\n\t\t\t\t\tvalue = node.attributes.map[name];\n\n\t\t\t\t\tif (name === \"style\") {\n\t\t\t\t\t\tvalue = dom.serializeStyle(dom.parseStyle(value), node.name);\n\t\t\t\t\t} else if (urlConverter) {\n\t\t\t\t\t\tvalue = urlConverter.call(urlConverterScope, value, name, node.name);\n\t\t\t\t\t}\n\n\t\t\t\t\tnode.attr(name, value.length > 0 ? value : null);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Remove internal classes mceItem<..> or mceSelected\n\t\thtmlParser.addAttributeFilter('class', function(nodes) {\n\t\t\tvar i = nodes.length, node, value;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\t\t\t\tvalue = node.attr('class');\n\n\t\t\t\tif (value) {\n\t\t\t\t\tvalue = node.attr('class').replace(/(?:^|\\s)mce-item-\\w+(?!\\S)/g, '');\n\t\t\t\t\tnode.attr('class', value.length > 0 ? value : null);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Remove bookmark elements\n\t\thtmlParser.addAttributeFilter('data-mce-type', function(nodes, name, args) {\n\t\t\tvar i = nodes.length, node;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\n\t\t\t\tif (node.attributes.map['data-mce-type'] === 'bookmark' && !args.cleanup) {\n\t\t\t\t\tnode.remove();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\thtmlParser.addNodeFilter('noscript', function(nodes) {\n\t\t\tvar i = nodes.length, node;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i].firstChild;\n\n\t\t\t\tif (node) {\n\t\t\t\t\tnode.value = Entities.decode(node.value);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Force script into CDATA sections and remove the mce- prefix also add comments around styles\n\t\thtmlParser.addNodeFilter('script,style', function(nodes, name) {\n\t\t\tvar i = nodes.length, node, value, type;\n\n\t\t\tfunction trim(value) {\n\t\t\t\t/*jshint maxlen:255 */\n\t\t\t\t/*eslint max-len:0 */\n\t\t\t\treturn value.replace(/(<!--\\[CDATA\\[|\\]\\]-->)/g, '\\n')\n\t\t\t\t\t\t.replace(/^[\\r\\n]*|[\\r\\n]*$/g, '')\n\t\t\t\t\t\t.replace(/^\\s*((<!--)?(\\s*\\/\\/)?\\s*<!\\[CDATA\\[|(<!--\\s*)?\\/\\*\\s*<!\\[CDATA\\[\\s*\\*\\/|(\\/\\/)?\\s*<!--|\\/\\*\\s*<!--\\s*\\*\\/)\\s*[\\r\\n]*/gi, '')\n\t\t\t\t\t\t.replace(/\\s*(\\/\\*\\s*\\]\\]>\\s*\\*\\/(-->)?|\\s*\\/\\/\\s*\\]\\]>(-->)?|\\/\\/\\s*(-->)?|\\]\\]>|\\/\\*\\s*-->\\s*\\*\\/|\\s*-->\\s*)\\s*$/g, '');\n\t\t\t}\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\t\t\t\tvalue = node.firstChild ? node.firstChild.value : '';\n\n\t\t\t\tif (name === \"script\") {\n\t\t\t\t\t// Remove mce- prefix from script elements and remove default type since the user specified\n\t\t\t\t\t// a script element without type attribute\n\t\t\t\t\ttype = node.attr('type');\n\t\t\t\t\tif (type) {\n\t\t\t\t\t\tnode.attr('type', type == 'mce-no/type' ? null : type.replace(/^mce\\-/, ''));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (value.length > 0) {\n\t\t\t\t\t\tnode.firstChild.value = '// <![CDATA[\\n' + trim(value) + '\\n// ]]>';\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (value.length > 0) {\n\t\t\t\t\t\tnode.firstChild.value = '<!--\\n' + trim(value) + '\\n-->';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Convert comments to cdata and handle protected comments\n\t\thtmlParser.addNodeFilter('#comment', function(nodes) {\n\t\t\tvar i = nodes.length, node;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\n\t\t\t\tif (node.value.indexOf('[CDATA[') === 0) {\n\t\t\t\t\tnode.name = '#cdata';\n\t\t\t\t\tnode.type = 4;\n\t\t\t\t\tnode.value = node.value.replace(/^\\[CDATA\\[|\\]\\]$/g, '');\n\t\t\t\t} else if (node.value.indexOf('mce:protected ') === 0) {\n\t\t\t\t\tnode.name = \"#text\";\n\t\t\t\t\tnode.type = 3;\n\t\t\t\t\tnode.raw = true;\n\t\t\t\t\tnode.value = unescape(node.value).substr(14);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\thtmlParser.addNodeFilter('xml:namespace,input', function(nodes, name) {\n\t\t\tvar i = nodes.length, node;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\t\t\t\tif (node.type === 7) {\n\t\t\t\t\tnode.remove();\n\t\t\t\t} else if (node.type === 1) {\n\t\t\t\t\tif (name === \"input\" && !(\"type\" in node.attributes.map)) {\n\t\t\t\t\t\tnode.attr('type', 'text');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Remove internal data attributes\n\t\thtmlParser.addAttributeFilter(\n\t\t\t'data-mce-src,data-mce-href,data-mce-style,' +\n\t\t\t'data-mce-selected,data-mce-expando,' +\n\t\t\t'data-mce-type,data-mce-resize',\n\n\t\t\tfunction(nodes, name) {\n\t\t\t\tvar i = nodes.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnodes[i].attr(name, null);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\t// Return public methods\n\t\treturn {\n\t\t\t/**\n\t\t\t * Schema instance that was used to when the Serializer was constructed.\n\t\t\t *\n\t\t\t * @field {tinymce.html.Schema} schema\n\t\t\t */\n\t\t\tschema: schema,\n\n\t\t\t/**\n\t\t\t * Adds a node filter function to the parser used by the serializer, the parser will collect the specified nodes by name\n\t\t\t * and then execute the callback ones it has finished parsing the document.\n\t\t\t *\n\t\t\t * @example\n\t\t\t * parser.addNodeFilter('p,h1', function(nodes, name) {\n\t\t\t *\t\tfor (var i = 0; i < nodes.length; i++) {\n\t\t\t *\t\t\tconsole.log(nodes[i].name);\n\t\t\t *\t\t}\n\t\t\t * });\n\t\t\t * @method addNodeFilter\n\t\t\t * @method {String} name Comma separated list of nodes to collect.\n\t\t\t * @param {function} callback Callback function to execute once it has collected nodes.\n\t\t\t */\n\t\t\taddNodeFilter: htmlParser.addNodeFilter,\n\n\t\t\t/**\n\t\t\t * Adds a attribute filter function to the parser used by the serializer, the parser will\n\t\t\t * collect nodes that has the specified attributes\n\t\t\t * and then execute the callback ones it has finished parsing the document.\n\t\t\t *\n\t\t\t * @example\n\t\t\t * parser.addAttributeFilter('src,href', function(nodes, name) {\n\t\t\t *\t\tfor (var i = 0; i < nodes.length; i++) {\n\t\t\t *\t\t\tconsole.log(nodes[i].name);\n\t\t\t *\t\t}\n\t\t\t * });\n\t\t\t * @method addAttributeFilter\n\t\t\t * @method {String} name Comma separated list of nodes to collect.\n\t\t\t * @param {function} callback Callback function to execute once it has collected nodes.\n\t\t\t */\n\t\t\taddAttributeFilter: htmlParser.addAttributeFilter,\n\n\t\t\t/**\n\t\t\t * Serializes the specified browser DOM node into a HTML string.\n\t\t\t *\n\t\t\t * @method serialize\n\t\t\t * @param {DOMNode} node DOM node to serialize.\n\t\t\t * @param {Object} args Arguments option that gets passed to event handlers.\n\t\t\t */\n\t\t\tserialize: function(node, args) {\n\t\t\t\tvar self = this, impl, doc, oldDoc, htmlSerializer, content, rootNode;\n\n\t\t\t\t// Explorer won't clone contents of script and style and the\n\t\t\t\t// selected index of select elements are cleared on a clone operation.\n\t\t\t\tif (Env.ie && dom.select('script,style,select,map').length > 0) {\n\t\t\t\t\tcontent = node.innerHTML;\n\t\t\t\t\tnode = node.cloneNode(false);\n\t\t\t\t\tdom.setHTML(node, content);\n\t\t\t\t} else {\n\t\t\t\t\tnode = node.cloneNode(true);\n\t\t\t\t}\n\n\t\t\t\t// Nodes needs to be attached to something in WebKit/Opera\n\t\t\t\t// This fix will make DOM ranges and make Sizzle happy!\n\t\t\t\timpl = document.implementation;\n\t\t\t\tif (impl.createHTMLDocument) {\n\t\t\t\t\t// Create an empty HTML document\n\t\t\t\t\tdoc = impl.createHTMLDocument(\"\");\n\n\t\t\t\t\t// Add the element or it's children if it's a body element to the new document\n\t\t\t\t\teach(node.nodeName == 'BODY' ? node.childNodes : [node], function(node) {\n\t\t\t\t\t\tdoc.body.appendChild(doc.importNode(node, true));\n\t\t\t\t\t});\n\n\t\t\t\t\t// Grab first child or body element for serialization\n\t\t\t\t\tif (node.nodeName != 'BODY') {\n\t\t\t\t\t\tnode = doc.body.firstChild;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnode = doc.body;\n\t\t\t\t\t}\n\n\t\t\t\t\t// set the new document in DOMUtils so createElement etc works\n\t\t\t\t\toldDoc = dom.doc;\n\t\t\t\t\tdom.doc = doc;\n\t\t\t\t}\n\n\t\t\t\targs = args || {};\n\t\t\t\targs.format = args.format || 'html';\n\n\t\t\t\t// Don't wrap content if we want selected html\n\t\t\t\tif (args.selection) {\n\t\t\t\t\targs.forced_root_block = '';\n\t\t\t\t}\n\n\t\t\t\t// Pre process\n\t\t\t\tif (!args.no_events) {\n\t\t\t\t\targs.node = node;\n\t\t\t\t\tself.onPreProcess(args);\n\t\t\t\t}\n\n\t\t\t\t// Parse HTML\n\t\t\t\trootNode = htmlParser.parse(trim(args.getInner ? node.innerHTML : dom.getOuterHTML(node)), args);\n\t\t\t\ttrimTrailingBr(rootNode);\n\n\t\t\t\t// Serialize HTML\n\t\t\t\thtmlSerializer = new Serializer(settings, schema);\n\t\t\t\targs.content = htmlSerializer.serialize(rootNode);\n\n\t\t\t\t// Replace all BOM characters for now until we can find a better solution\n\t\t\t\tif (!args.cleanup) {\n\t\t\t\t\targs.content = Zwsp.trim(args.content);\n\t\t\t\t\targs.content = args.content.replace(/\\uFEFF/g, '');\n\t\t\t\t}\n\n\t\t\t\t// Post process\n\t\t\t\tif (!args.no_events) {\n\t\t\t\t\tself.onPostProcess(args);\n\t\t\t\t}\n\n\t\t\t\t// Restore the old document if it was changed\n\t\t\t\tif (oldDoc) {\n\t\t\t\t\tdom.doc = oldDoc;\n\t\t\t\t}\n\n\t\t\t\targs.node = null;\n\n\t\t\t\treturn args.content;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds valid elements rules to the serializers schema instance this enables you to specify things\n\t\t\t * like what elements should be outputted and what attributes specific elements might have.\n\t\t\t * Consult the Wiki for more details on this format.\n\t\t\t *\n\t\t\t * @method addRules\n\t\t\t * @param {String} rules Valid elements rules string to add to schema.\n\t\t\t */\n\t\t\taddRules: function(rules) {\n\t\t\t\tschema.addValidElements(rules);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Sets the valid elements rules to the serializers schema instance this enables you to specify things\n\t\t\t * like what elements should be outputted and what attributes specific elements might have.\n\t\t\t * Consult the Wiki for more details on this format.\n\t\t\t *\n\t\t\t * @method setRules\n\t\t\t * @param {String} rules Valid elements rules string.\n\t\t\t */\n\t\t\tsetRules: function(rules) {\n\t\t\t\tschema.setValidElements(rules);\n\t\t\t},\n\n\t\t\tonPreProcess: function(args) {\n\t\t\t\tif (editor) {\n\t\t\t\t\teditor.fire('PreProcess', args);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tonPostProcess: function(args) {\n\t\t\t\tif (editor) {\n\t\t\t\t\teditor.fire('PostProcess', args);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds a temporary internal attribute these attributes will get removed on undo and\n\t\t\t * when getting contents out of the editor.\n\t\t\t *\n\t\t\t * @method addTempAttr\n\t\t\t * @param {String} name string\n\t\t\t */\n\t\t\taddTempAttr: addTempAttr,\n\n\t\t\t// Internal\n\t\t\ttrimHtml: trimHtml,\n\t\t\tgetTrimmedContent: getTrimmedContent,\n\t\t\ttrimContent: trimContent\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/TridentSelection.js\n\n/**\n * TridentSelection.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Selection class for old explorer versions. This one fakes the\n * native selection object available on modern browsers.\n *\n * @private\n * @class tinymce.dom.TridentSelection\n */\ndefine(\"tinymce/dom/TridentSelection\", [], function() {\n\tfunction Selection(selection) {\n\t\tvar self = this, dom = selection.dom, FALSE = false;\n\n\t\tfunction getPosition(rng, start) {\n\t\t\tvar checkRng, startIndex = 0, endIndex, inside,\n\t\t\t\tchildren, child, offset, index, position = -1, parent;\n\n\t\t\t// Setup test range, collapse it and get the parent\n\t\t\tcheckRng = rng.duplicate();\n\t\t\tcheckRng.collapse(start);\n\t\t\tparent = checkRng.parentElement();\n\n\t\t\t// Check if the selection is within the right document\n\t\t\tif (parent.ownerDocument !== selection.dom.doc) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// IE will report non editable elements as it's parent so look for an editable one\n\t\t\twhile (parent.contentEditable === \"false\") {\n\t\t\t\tparent = parent.parentNode;\n\t\t\t}\n\n\t\t\t// If parent doesn't have any children then return that we are inside the element\n\t\t\tif (!parent.hasChildNodes()) {\n\t\t\t\treturn {node: parent, inside: 1};\n\t\t\t}\n\n\t\t\t// Setup node list and endIndex\n\t\t\tchildren = parent.children;\n\t\t\tendIndex = children.length - 1;\n\n\t\t\t// Perform a binary search for the position\n\t\t\twhile (startIndex <= endIndex) {\n\t\t\t\tindex = Math.floor((startIndex + endIndex) / 2);\n\n\t\t\t\t// Move selection to node and compare the ranges\n\t\t\t\tchild = children[index];\n\t\t\t\tcheckRng.moveToElementText(child);\n\t\t\t\tposition = checkRng.compareEndPoints(start ? 'StartToStart' : 'EndToEnd', rng);\n\n\t\t\t\t// Before/after or an exact match\n\t\t\t\tif (position > 0) {\n\t\t\t\t\tendIndex = index - 1;\n\t\t\t\t} else if (position < 0) {\n\t\t\t\t\tstartIndex = index + 1;\n\t\t\t\t} else {\n\t\t\t\t\treturn {node: child};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Check if child position is before or we didn't find a position\n\t\t\tif (position < 0) {\n\t\t\t\t// No element child was found use the parent element and the offset inside that\n\t\t\t\tif (!child) {\n\t\t\t\t\tcheckRng.moveToElementText(parent);\n\t\t\t\t\tcheckRng.collapse(true);\n\t\t\t\t\tchild = parent;\n\t\t\t\t\tinside = true;\n\t\t\t\t} else {\n\t\t\t\t\tcheckRng.collapse(false);\n\t\t\t\t}\n\n\t\t\t\t// Walk character by character in text node until we hit the selected range endpoint,\n\t\t\t\t// hit the end of document or parent isn't the right one\n\t\t\t\t// We need to walk char by char since rng.text or rng.htmlText will trim line endings\n\t\t\t\toffset = 0;\n\t\t\t\twhile (checkRng.compareEndPoints(start ? 'StartToStart' : 'StartToEnd', rng) !== 0) {\n\t\t\t\t\tif (checkRng.move('character', 1) === 0 || parent != checkRng.parentElement()) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\toffset++;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Child position is after the selection endpoint\n\t\t\t\tcheckRng.collapse(true);\n\n\t\t\t\t// Walk character by character in text node until we hit the selected range endpoint, hit\n\t\t\t\t// the end of document or parent isn't the right one\n\t\t\t\toffset = 0;\n\t\t\t\twhile (checkRng.compareEndPoints(start ? 'StartToStart' : 'StartToEnd', rng) !== 0) {\n\t\t\t\t\tif (checkRng.move('character', -1) === 0 || parent != checkRng.parentElement()) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\toffset++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {node: child, position: position, offset: offset, inside: inside};\n\t\t}\n\n\t\t// Returns a W3C DOM compatible range object by using the IE Range API\n\t\tfunction getRange() {\n\t\t\tvar ieRange = selection.getRng(), domRange = dom.createRng(), element, collapsed, tmpRange, element2, bookmark;\n\n\t\t\t// If selection is outside the current document just return an empty range\n\t\t\telement = ieRange.item ? ieRange.item(0) : ieRange.parentElement();\n\t\t\tif (element.ownerDocument != dom.doc) {\n\t\t\t\treturn domRange;\n\t\t\t}\n\n\t\t\tcollapsed = selection.isCollapsed();\n\n\t\t\t// Handle control selection\n\t\t\tif (ieRange.item) {\n\t\t\t\tdomRange.setStart(element.parentNode, dom.nodeIndex(element));\n\t\t\t\tdomRange.setEnd(domRange.startContainer, domRange.startOffset + 1);\n\n\t\t\t\treturn domRange;\n\t\t\t}\n\n\t\t\tfunction findEndPoint(start) {\n\t\t\t\tvar endPoint = getPosition(ieRange, start), container, offset, textNodeOffset = 0, sibling, undef, nodeValue;\n\n\t\t\t\tcontainer = endPoint.node;\n\t\t\t\toffset = endPoint.offset;\n\n\t\t\t\tif (endPoint.inside && !container.hasChildNodes()) {\n\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](container, 0);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (offset === undef) {\n\t\t\t\t\tdomRange[start ? 'setStartBefore' : 'setEndAfter'](container);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (endPoint.position < 0) {\n\t\t\t\t\tsibling = endPoint.inside ? container.firstChild : container.nextSibling;\n\n\t\t\t\t\tif (!sibling) {\n\t\t\t\t\t\tdomRange[start ? 'setStartAfter' : 'setEndAfter'](container);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!offset) {\n\t\t\t\t\t\tif (sibling.nodeType == 3) {\n\t\t\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](sibling, 0);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdomRange[start ? 'setStartBefore' : 'setEndBefore'](sibling);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Find the text node and offset\n\t\t\t\t\twhile (sibling) {\n\t\t\t\t\t\tif (sibling.nodeType == 3) {\n\t\t\t\t\t\t\tnodeValue = sibling.nodeValue;\n\t\t\t\t\t\t\ttextNodeOffset += nodeValue.length;\n\n\t\t\t\t\t\t\t// We are at or passed the position we where looking for\n\t\t\t\t\t\t\tif (textNodeOffset >= offset) {\n\t\t\t\t\t\t\t\tcontainer = sibling;\n\t\t\t\t\t\t\t\ttextNodeOffset -= offset;\n\t\t\t\t\t\t\t\ttextNodeOffset = nodeValue.length - textNodeOffset;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsibling = sibling.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Find the text node and offset\n\t\t\t\t\tsibling = container.previousSibling;\n\n\t\t\t\t\tif (!sibling) {\n\t\t\t\t\t\treturn domRange[start ? 'setStartBefore' : 'setEndBefore'](container);\n\t\t\t\t\t}\n\n\t\t\t\t\t// If there isn't any text to loop then use the first position\n\t\t\t\t\tif (!offset) {\n\t\t\t\t\t\tif (container.nodeType == 3) {\n\t\t\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](sibling, container.nodeValue.length);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdomRange[start ? 'setStartAfter' : 'setEndAfter'](sibling);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (sibling) {\n\t\t\t\t\t\tif (sibling.nodeType == 3) {\n\t\t\t\t\t\t\ttextNodeOffset += sibling.nodeValue.length;\n\n\t\t\t\t\t\t\t// We are at or passed the position we where looking for\n\t\t\t\t\t\t\tif (textNodeOffset >= offset) {\n\t\t\t\t\t\t\t\tcontainer = sibling;\n\t\t\t\t\t\t\t\ttextNodeOffset -= offset;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsibling = sibling.previousSibling;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](container, textNodeOffset);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\t// Find start point\n\t\t\t\tfindEndPoint(true);\n\n\t\t\t\t// Find end point if needed\n\t\t\t\tif (!collapsed) {\n\t\t\t\t\tfindEndPoint();\n\t\t\t\t}\n\t\t\t} catch (ex) {\n\t\t\t\t// IE has a nasty bug where text nodes might throw \"invalid argument\" when you\n\t\t\t\t// access the nodeValue or other properties of text nodes. This seems to happen when\n\t\t\t\t// text nodes are split into two nodes by a delete/backspace call.\n\t\t\t\t// So let us detect and try to fix it.\n\t\t\t\tif (ex.number == -2147024809) {\n\t\t\t\t\t// Get the current selection\n\t\t\t\t\tbookmark = self.getBookmark(2);\n\n\t\t\t\t\t// Get start element\n\t\t\t\t\ttmpRange = ieRange.duplicate();\n\t\t\t\t\ttmpRange.collapse(true);\n\t\t\t\t\telement = tmpRange.parentElement();\n\n\t\t\t\t\t// Get end element\n\t\t\t\t\tif (!collapsed) {\n\t\t\t\t\t\ttmpRange = ieRange.duplicate();\n\t\t\t\t\t\ttmpRange.collapse(false);\n\t\t\t\t\t\telement2 = tmpRange.parentElement();\n\t\t\t\t\t\telement2.innerHTML = element2.innerHTML;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove the broken elements\n\t\t\t\t\telement.innerHTML = element.innerHTML;\n\n\t\t\t\t\t// Restore the selection\n\t\t\t\t\tself.moveToBookmark(bookmark);\n\n\t\t\t\t\t// Since the range has moved we need to re-get it\n\t\t\t\t\tieRange = selection.getRng();\n\n\t\t\t\t\t// Find start point\n\t\t\t\t\tfindEndPoint(true);\n\n\t\t\t\t\t// Find end point if needed\n\t\t\t\t\tif (!collapsed) {\n\t\t\t\t\t\tfindEndPoint();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthrow ex; // Throw other errors\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn domRange;\n\t\t}\n\n\t\tthis.getBookmark = function(type) {\n\t\t\tvar rng = selection.getRng(), bookmark = {};\n\n\t\t\tfunction getIndexes(node) {\n\t\t\t\tvar parent, root, children, i, indexes = [];\n\n\t\t\t\tparent = node.parentNode;\n\t\t\t\troot = dom.getRoot().parentNode;\n\n\t\t\t\twhile (parent != root && parent.nodeType !== 9) {\n\t\t\t\t\tchildren = parent.children;\n\n\t\t\t\t\ti = children.length;\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (node === children[i]) {\n\t\t\t\t\t\t\tindexes.push(i);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = parent;\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn indexes;\n\t\t\t}\n\n\t\t\tfunction getBookmarkEndPoint(start) {\n\t\t\t\tvar position;\n\n\t\t\t\tposition = getPosition(rng, start);\n\t\t\t\tif (position) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tposition: position.position,\n\t\t\t\t\t\toffset: position.offset,\n\t\t\t\t\t\tindexes: getIndexes(position.node),\n\t\t\t\t\t\tinside: position.inside\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Non ubstructive bookmark\n\t\t\tif (type === 2) {\n\t\t\t\t// Handle text selection\n\t\t\t\tif (!rng.item) {\n\t\t\t\t\tbookmark.start = getBookmarkEndPoint(true);\n\n\t\t\t\t\tif (!selection.isCollapsed()) {\n\t\t\t\t\t\tbookmark.end = getBookmarkEndPoint();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tbookmark.start = {ctrl: true, indexes: getIndexes(rng.item(0))};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn bookmark;\n\t\t};\n\n\t\tthis.moveToBookmark = function(bookmark) {\n\t\t\tvar rng, body = dom.doc.body;\n\n\t\t\tfunction resolveIndexes(indexes) {\n\t\t\t\tvar node, i, idx, children;\n\n\t\t\t\tnode = dom.getRoot();\n\t\t\t\tfor (i = indexes.length - 1; i >= 0; i--) {\n\t\t\t\t\tchildren = node.children;\n\t\t\t\t\tidx = indexes[i];\n\n\t\t\t\t\tif (idx <= children.length - 1) {\n\t\t\t\t\t\tnode = children[idx];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tfunction setBookmarkEndPoint(start) {\n\t\t\t\tvar endPoint = bookmark[start ? 'start' : 'end'], moveLeft, moveRng, undef, offset;\n\n\t\t\t\tif (endPoint) {\n\t\t\t\t\tmoveLeft = endPoint.position > 0;\n\n\t\t\t\t\tmoveRng = body.createTextRange();\n\t\t\t\t\tmoveRng.moveToElementText(resolveIndexes(endPoint.indexes));\n\n\t\t\t\t\toffset = endPoint.offset;\n\t\t\t\t\tif (offset !== undef) {\n\t\t\t\t\t\tmoveRng.collapse(endPoint.inside || moveLeft);\n\t\t\t\t\t\tmoveRng.moveStart('character', moveLeft ? -offset : offset);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmoveRng.collapse(start);\n\t\t\t\t\t}\n\n\t\t\t\t\trng.setEndPoint(start ? 'StartToStart' : 'EndToStart', moveRng);\n\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\trng.collapse(true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (bookmark.start) {\n\t\t\t\tif (bookmark.start.ctrl) {\n\t\t\t\t\trng = body.createControlRange();\n\t\t\t\t\trng.addElement(resolveIndexes(bookmark.start.indexes));\n\t\t\t\t\trng.select();\n\t\t\t\t} else {\n\t\t\t\t\trng = body.createTextRange();\n\t\t\t\t\tsetBookmarkEndPoint(true);\n\t\t\t\t\tsetBookmarkEndPoint();\n\t\t\t\t\trng.select();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.addRange = function(rng) {\n\t\t\tvar ieRng, ctrlRng, startContainer, startOffset, endContainer, endOffset, sibling,\n\t\t\t\tdoc = selection.dom.doc, body = doc.body, nativeRng, ctrlElm;\n\n\t\t\tfunction setEndPoint(start) {\n\t\t\t\tvar container, offset, marker, tmpRng, nodes;\n\n\t\t\t\tmarker = dom.create('a');\n\t\t\t\tcontainer = start ? startContainer : endContainer;\n\t\t\t\toffset = start ? startOffset : endOffset;\n\t\t\t\ttmpRng = ieRng.duplicate();\n\n\t\t\t\tif (container == doc || container == doc.documentElement) {\n\t\t\t\t\tcontainer = body;\n\t\t\t\t\toffset = 0;\n\t\t\t\t}\n\n\t\t\t\tif (container.nodeType == 3) {\n\t\t\t\t\tcontainer.parentNode.insertBefore(marker, container);\n\t\t\t\t\ttmpRng.moveToElementText(marker);\n\t\t\t\t\ttmpRng.moveStart('character', offset);\n\t\t\t\t\tdom.remove(marker);\n\t\t\t\t\tieRng.setEndPoint(start ? 'StartToStart' : 'EndToEnd', tmpRng);\n\t\t\t\t} else {\n\t\t\t\t\tnodes = container.childNodes;\n\n\t\t\t\t\tif (nodes.length) {\n\t\t\t\t\t\tif (offset >= nodes.length) {\n\t\t\t\t\t\t\tdom.insertAfter(marker, nodes[nodes.length - 1]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcontainer.insertBefore(marker, nodes[offset]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttmpRng.moveToElementText(marker);\n\t\t\t\t\t} else if (container.canHaveHTML) {\n\t\t\t\t\t\t// Empty node selection for example <div>|</div>\n\t\t\t\t\t\t// Setting innerHTML with a span marker then remove that marker seems to keep empty block elements open\n\t\t\t\t\t\tcontainer.innerHTML = '<span>&#xFEFF;</span>';\n\t\t\t\t\t\tmarker = container.firstChild;\n\t\t\t\t\t\ttmpRng.moveToElementText(marker);\n\t\t\t\t\t\ttmpRng.collapse(FALSE); // Collapse false works better than true for some odd reason\n\t\t\t\t\t}\n\n\t\t\t\t\tieRng.setEndPoint(start ? 'StartToStart' : 'EndToEnd', tmpRng);\n\t\t\t\t\tdom.remove(marker);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Setup some shorter versions\n\t\t\tstartContainer = rng.startContainer;\n\t\t\tstartOffset = rng.startOffset;\n\t\t\tendContainer = rng.endContainer;\n\t\t\tendOffset = rng.endOffset;\n\t\t\tieRng = body.createTextRange();\n\n\t\t\t// If single element selection then try making a control selection out of it\n\t\t\tif (startContainer == endContainer && startContainer.nodeType == 1) {\n\t\t\t\t// Trick to place the caret inside an empty block element like <p></p>\n\t\t\t\tif (startOffset == endOffset && !startContainer.hasChildNodes()) {\n\t\t\t\t\tif (startContainer.canHaveHTML) {\n\t\t\t\t\t\t// Check if previous sibling is an empty block if it is then we need to render it\n\t\t\t\t\t\t// IE would otherwise move the caret into the sibling instead of the empty startContainer see: #5236\n\t\t\t\t\t\t// Example this: <p></p><p>|</p> would become this: <p>|</p><p></p>\n\t\t\t\t\t\tsibling = startContainer.previousSibling;\n\t\t\t\t\t\tif (sibling && !sibling.hasChildNodes() && dom.isBlock(sibling)) {\n\t\t\t\t\t\t\tsibling.innerHTML = '&#xFEFF;';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsibling = null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstartContainer.innerHTML = '<span>&#xFEFF;</span><span>&#xFEFF;</span>';\n\t\t\t\t\t\tieRng.moveToElementText(startContainer.lastChild);\n\t\t\t\t\t\tieRng.select();\n\t\t\t\t\t\tdom.doc.selection.clear();\n\t\t\t\t\t\tstartContainer.innerHTML = '';\n\n\t\t\t\t\t\tif (sibling) {\n\t\t\t\t\t\t\tsibling.innerHTML = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tstartOffset = dom.nodeIndex(startContainer);\n\t\t\t\t\tstartContainer = startContainer.parentNode;\n\t\t\t\t}\n\n\t\t\t\tif (startOffset == endOffset - 1) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tctrlElm = startContainer.childNodes[startOffset];\n\t\t\t\t\t\tctrlRng = body.createControlRange();\n\t\t\t\t\t\tctrlRng.addElement(ctrlElm);\n\t\t\t\t\t\tctrlRng.select();\n\n\t\t\t\t\t\t// Check if the range produced is on the correct element and is a control range\n\t\t\t\t\t\t// On IE 8 it will select the parent contentEditable container if you select an inner element see: #5398\n\t\t\t\t\t\tnativeRng = selection.getRng();\n\t\t\t\t\t\tif (nativeRng.item && ctrlElm === nativeRng.item(0)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// Ignore\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Set start/end point of selection\n\t\t\tsetEndPoint(true);\n\t\t\tsetEndPoint();\n\n\t\t\t// Select the new range and scroll it into view\n\t\t\tieRng.select();\n\t\t};\n\n\t\t// Expose range method\n\t\tthis.getRangeAt = getRange;\n\t}\n\n\treturn Selection;\n});\n\n// Included from: js/tinymce/classes/util/VK.js\n\n/**\n * VK.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This file exposes a set of the common KeyCodes for use. Please grow it as needed.\n */\ndefine(\"tinymce/util/VK\", [\n\t\"tinymce/Env\"\n], function(Env) {\n\treturn {\n\t\tBACKSPACE: 8,\n\t\tDELETE: 46,\n\t\tDOWN: 40,\n\t\tENTER: 13,\n\t\tLEFT: 37,\n\t\tRIGHT: 39,\n\t\tSPACEBAR: 32,\n\t\tTAB: 9,\n\t\tUP: 38,\n\n\t\tmodifierPressed: function(e) {\n\t\t\treturn e.shiftKey || e.ctrlKey || e.altKey || this.metaKeyPressed(e);\n\t\t},\n\n\t\tmetaKeyPressed: function(e) {\n\t\t\t// Check if ctrl or meta key is pressed. Edge case for AltGr on Windows where it produces ctrlKey+altKey states\n\t\t\treturn (Env.mac ? e.metaKey : e.ctrlKey && !e.altKey);\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/ControlSelection.js\n\n/**\n * ControlSelection.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles control selection of elements. Controls are elements\n * that can be resized and needs to be selected as a whole. It adds custom resize handles\n * to all browser engines that support properly disabling the built in resize logic.\n *\n * @class tinymce.dom.ControlSelection\n */\ndefine(\"tinymce/dom/ControlSelection\", [\n\t\"tinymce/util/VK\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/Env\",\n\t\"tinymce/dom/NodeType\"\n], function(VK, Tools, Delay, Env, NodeType) {\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse;\n\tvar isContentEditableTrue = NodeType.isContentEditableTrue;\n\n\tfunction getContentEditableRoot(root, node) {\n\t\twhile (node && node != root) {\n\t\t\tif (isContentEditableTrue(node) || isContentEditableFalse(node)) {\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\treturn function(selection, editor) {\n\t\tvar dom = editor.dom, each = Tools.each;\n\t\tvar selectedElm, selectedElmGhost, resizeHelper, resizeHandles, selectedHandle, lastMouseDownEvent;\n\t\tvar startX, startY, selectedElmX, selectedElmY, startW, startH, ratio, resizeStarted;\n\t\tvar width, height, editableDoc = editor.getDoc(), rootDocument = document, isIE = Env.ie && Env.ie < 11;\n\t\tvar abs = Math.abs, round = Math.round, rootElement = editor.getBody(), startScrollWidth, startScrollHeight;\n\n\t\t// Details about each resize handle how to scale etc\n\t\tresizeHandles = {\n\t\t\t// Name: x multiplier, y multiplier, delta size x, delta size y\n\t\t\t/*n: [0.5, 0, 0, -1],\n\t\t\te: [1, 0.5, 1, 0],\n\t\t\ts: [0.5, 1, 0, 1],\n\t\t\tw: [0, 0.5, -1, 0],*/\n\t\t\tnw: [0, 0, -1, -1],\n\t\t\tne: [1, 0, 1, -1],\n\t\t\tse: [1, 1, 1, 1],\n\t\t\tsw: [0, 1, -1, 1]\n\t\t};\n\n\t\t// Add CSS for resize handles, cloned element and selected\n\t\tvar rootClass = '.mce-content-body';\n\t\teditor.contentStyles.push(\n\t\t\trootClass + ' div.mce-resizehandle {' +\n\t\t\t\t'position: absolute;' +\n\t\t\t\t'border: 1px solid black;' +\n\t\t\t\t'box-sizing: box-sizing;' +\n\t\t\t\t'background: #FFF;' +\n\t\t\t\t'width: 7px;' +\n\t\t\t\t'height: 7px;' +\n\t\t\t\t'z-index: 10000' +\n\t\t\t'}' +\n\t\t\trootClass + ' .mce-resizehandle:hover {' +\n\t\t\t\t'background: #000' +\n\t\t\t'}' +\n\t\t\trootClass + ' img[data-mce-selected],' + rootClass + ' hr[data-mce-selected] {' +\n\t\t\t\t'outline: 1px solid black;' +\n\t\t\t\t'resize: none' + // Have been talks about implementing this in browsers\n\t\t\t'}' +\n\t\t\trootClass + ' .mce-clonedresizable {' +\n\t\t\t\t'position: absolute;' +\n\t\t\t\t(Env.gecko ? '' : 'outline: 1px dashed black;') + // Gecko produces trails while resizing\n\t\t\t\t'opacity: .5;' +\n\t\t\t\t'filter: alpha(opacity=50);' +\n\t\t\t\t'z-index: 10000' +\n\t\t\t'}' +\n\t\t\trootClass + ' .mce-resize-helper {' +\n\t\t\t\t'background: #555;' +\n\t\t\t\t'background: rgba(0,0,0,0.75);' +\n\t\t\t\t'border-radius: 3px;' +\n\t\t\t\t'border: 1px;' +\n\t\t\t\t'color: white;' +\n\t\t\t\t'display: none;' +\n\t\t\t\t'font-family: sans-serif;' +\n\t\t\t\t'font-size: 12px;' +\n\t\t\t\t'white-space: nowrap;' +\n\t\t\t\t'line-height: 14px;' +\n\t\t\t\t'margin: 5px 10px;' +\n\t\t\t\t'padding: 5px;' +\n\t\t\t\t'position: absolute;' +\n\t\t\t\t'z-index: 10001' +\n\t\t\t'}'\n\t\t);\n\n\t\tfunction isResizable(elm) {\n\t\t\tvar selector = editor.settings.object_resizing;\n\n\t\t\tif (selector === false || Env.iOS) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (typeof selector != 'string') {\n\t\t\t\tselector = 'table,img,div';\n\t\t\t}\n\n\t\t\tif (elm.getAttribute('data-mce-resize') === 'false') {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (elm == editor.getBody()) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn editor.dom.is(elm, selector);\n\t\t}\n\n\t\tfunction resizeGhostElement(e) {\n\t\t\tvar deltaX, deltaY, proportional;\n\t\t\tvar resizeHelperX, resizeHelperY;\n\n\t\t\t// Calc new width/height\n\t\t\tdeltaX = e.screenX - startX;\n\t\t\tdeltaY = e.screenY - startY;\n\n\t\t\t// Calc new size\n\t\t\twidth = deltaX * selectedHandle[2] + startW;\n\t\t\theight = deltaY * selectedHandle[3] + startH;\n\n\t\t\t// Never scale down lower than 5 pixels\n\t\t\twidth = width < 5 ? 5 : width;\n\t\t\theight = height < 5 ? 5 : height;\n\n\t\t\tif (selectedElm.nodeName == \"IMG\" && editor.settings.resize_img_proportional !== false) {\n\t\t\t\tproportional = !VK.modifierPressed(e);\n\t\t\t} else {\n\t\t\t\tproportional = VK.modifierPressed(e) || (selectedElm.nodeName == \"IMG\" && selectedHandle[2] * selectedHandle[3] !== 0);\n\t\t\t}\n\n\t\t\t// Constrain proportions\n\t\t\tif (proportional) {\n\t\t\t\tif (abs(deltaX) > abs(deltaY)) {\n\t\t\t\t\theight = round(width * ratio);\n\t\t\t\t\twidth = round(height / ratio);\n\t\t\t\t} else {\n\t\t\t\t\twidth = round(height / ratio);\n\t\t\t\t\theight = round(width * ratio);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Update ghost size\n\t\t\tdom.setStyles(selectedElmGhost, {\n\t\t\t\twidth: width,\n\t\t\t\theight: height\n\t\t\t});\n\n\t\t\t// Update resize helper position\n\t\t\tresizeHelperX = selectedHandle.startPos.x + deltaX;\n\t\t\tresizeHelperY = selectedHandle.startPos.y + deltaY;\n\t\t\tresizeHelperX = resizeHelperX > 0 ? resizeHelperX : 0;\n\t\t\tresizeHelperY = resizeHelperY > 0 ? resizeHelperY : 0;\n\n\t\t\tdom.setStyles(resizeHelper, {\n\t\t\t\tleft: resizeHelperX,\n\t\t\t\ttop: resizeHelperY,\n\t\t\t\tdisplay: 'block'\n\t\t\t});\n\n\t\t\tresizeHelper.innerHTML = width + ' &times; ' + height;\n\n\t\t\t// Update ghost X position if needed\n\t\t\tif (selectedHandle[2] < 0 && selectedElmGhost.clientWidth <= width) {\n\t\t\t\tdom.setStyle(selectedElmGhost, 'left', selectedElmX + (startW - width));\n\t\t\t}\n\n\t\t\t// Update ghost Y position if needed\n\t\t\tif (selectedHandle[3] < 0 && selectedElmGhost.clientHeight <= height) {\n\t\t\t\tdom.setStyle(selectedElmGhost, 'top', selectedElmY + (startH - height));\n\t\t\t}\n\n\t\t\t// Calculate how must overflow we got\n\t\t\tdeltaX = rootElement.scrollWidth - startScrollWidth;\n\t\t\tdeltaY = rootElement.scrollHeight - startScrollHeight;\n\n\t\t\t// Re-position the resize helper based on the overflow\n\t\t\tif (deltaX + deltaY !== 0) {\n\t\t\t\tdom.setStyles(resizeHelper, {\n\t\t\t\t\tleft: resizeHelperX - deltaX,\n\t\t\t\t\ttop: resizeHelperY - deltaY\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!resizeStarted) {\n\t\t\t\teditor.fire('ObjectResizeStart', {target: selectedElm, width: startW, height: startH});\n\t\t\t\tresizeStarted = true;\n\t\t\t}\n\t\t}\n\n\t\tfunction endGhostResize() {\n\t\t\tresizeStarted = false;\n\n\t\t\tfunction setSizeProp(name, value) {\n\t\t\t\tif (value) {\n\t\t\t\t\t// Resize by using style or attribute\n\t\t\t\t\tif (selectedElm.style[name] || !editor.schema.isValid(selectedElm.nodeName.toLowerCase(), name)) {\n\t\t\t\t\t\tdom.setStyle(selectedElm, name, value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdom.setAttrib(selectedElm, name, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Set width/height properties\n\t\t\tsetSizeProp('width', width);\n\t\t\tsetSizeProp('height', height);\n\n\t\t\tdom.unbind(editableDoc, 'mousemove', resizeGhostElement);\n\t\t\tdom.unbind(editableDoc, 'mouseup', endGhostResize);\n\n\t\t\tif (rootDocument != editableDoc) {\n\t\t\t\tdom.unbind(rootDocument, 'mousemove', resizeGhostElement);\n\t\t\t\tdom.unbind(rootDocument, 'mouseup', endGhostResize);\n\t\t\t}\n\n\t\t\t// Remove ghost/helper and update resize handle positions\n\t\t\tdom.remove(selectedElmGhost);\n\t\t\tdom.remove(resizeHelper);\n\n\t\t\tif (!isIE || selectedElm.nodeName == \"TABLE\") {\n\t\t\t\tshowResizeRect(selectedElm);\n\t\t\t}\n\n\t\t\teditor.fire('ObjectResized', {target: selectedElm, width: width, height: height});\n\t\t\tdom.setAttrib(selectedElm, 'style', dom.getAttrib(selectedElm, 'style'));\n\t\t\teditor.nodeChanged();\n\t\t}\n\n\t\tfunction showResizeRect(targetElm, mouseDownHandleName, mouseDownEvent) {\n\t\t\tvar position, targetWidth, targetHeight, e, rect;\n\n\t\t\thideResizeRect();\n\t\t\tunbindResizeHandleEvents();\n\n\t\t\t// Get position and size of target\n\t\t\tposition = dom.getPos(targetElm, rootElement);\n\t\t\tselectedElmX = position.x;\n\t\t\tselectedElmY = position.y;\n\t\t\trect = targetElm.getBoundingClientRect(); // Fix for Gecko offsetHeight for table with caption\n\t\t\ttargetWidth = rect.width || (rect.right - rect.left);\n\t\t\ttargetHeight = rect.height || (rect.bottom - rect.top);\n\n\t\t\t// Reset width/height if user selects a new image/table\n\t\t\tif (selectedElm != targetElm) {\n\t\t\t\tdetachResizeStartListener();\n\t\t\t\tselectedElm = targetElm;\n\t\t\t\twidth = height = 0;\n\t\t\t}\n\n\t\t\t// Makes it possible to disable resizing\n\t\t\te = editor.fire('ObjectSelected', {target: targetElm});\n\n\t\t\tif (isResizable(targetElm) && !e.isDefaultPrevented()) {\n\t\t\t\teach(resizeHandles, function(handle, name) {\n\t\t\t\t\tvar handleElm;\n\n\t\t\t\t\tfunction startDrag(e) {\n\t\t\t\t\t\tstartX = e.screenX;\n\t\t\t\t\t\tstartY = e.screenY;\n\t\t\t\t\t\tstartW = selectedElm.clientWidth;\n\t\t\t\t\t\tstartH = selectedElm.clientHeight;\n\t\t\t\t\t\tratio = startH / startW;\n\t\t\t\t\t\tselectedHandle = handle;\n\n\t\t\t\t\t\thandle.startPos = {\n\t\t\t\t\t\t\tx: targetWidth * handle[0] + selectedElmX,\n\t\t\t\t\t\t\ty: targetHeight * handle[1] + selectedElmY\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tstartScrollWidth = rootElement.scrollWidth;\n\t\t\t\t\t\tstartScrollHeight = rootElement.scrollHeight;\n\n\t\t\t\t\t\tselectedElmGhost = selectedElm.cloneNode(true);\n\t\t\t\t\t\tdom.addClass(selectedElmGhost, 'mce-clonedresizable');\n\t\t\t\t\t\tdom.setAttrib(selectedElmGhost, 'data-mce-bogus', 'all');\n\t\t\t\t\t\tselectedElmGhost.contentEditable = false; // Hides IE move layer cursor\n\t\t\t\t\t\tselectedElmGhost.unSelectabe = true;\n\t\t\t\t\t\tdom.setStyles(selectedElmGhost, {\n\t\t\t\t\t\t\tleft: selectedElmX,\n\t\t\t\t\t\t\ttop: selectedElmY,\n\t\t\t\t\t\t\tmargin: 0\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tselectedElmGhost.removeAttribute('data-mce-selected');\n\t\t\t\t\t\trootElement.appendChild(selectedElmGhost);\n\n\t\t\t\t\t\tdom.bind(editableDoc, 'mousemove', resizeGhostElement);\n\t\t\t\t\t\tdom.bind(editableDoc, 'mouseup', endGhostResize);\n\n\t\t\t\t\t\tif (rootDocument != editableDoc) {\n\t\t\t\t\t\t\tdom.bind(rootDocument, 'mousemove', resizeGhostElement);\n\t\t\t\t\t\t\tdom.bind(rootDocument, 'mouseup', endGhostResize);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresizeHelper = dom.add(rootElement, 'div', {\n\t\t\t\t\t\t\t'class': 'mce-resize-helper',\n\t\t\t\t\t\t\t'data-mce-bogus': 'all'\n\t\t\t\t\t\t}, startW + ' &times; ' + startH);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (mouseDownHandleName) {\n\t\t\t\t\t\t// Drag started by IE native resizestart\n\t\t\t\t\t\tif (name == mouseDownHandleName) {\n\t\t\t\t\t\t\tstartDrag(mouseDownEvent);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Get existing or render resize handle\n\t\t\t\t\thandleElm = dom.get('mceResizeHandle' + name);\n\t\t\t\t\tif (handleElm) {\n\t\t\t\t\t\tdom.remove(handleElm);\n\t\t\t\t\t}\n\n\t\t\t\t\thandleElm = dom.add(rootElement, 'div', {\n\t\t\t\t\t\tid: 'mceResizeHandle' + name,\n\t\t\t\t\t\t'data-mce-bogus': 'all',\n\t\t\t\t\t\t'class': 'mce-resizehandle',\n\t\t\t\t\t\tunselectable: true,\n\t\t\t\t\t\tstyle: 'cursor:' + name + '-resize; margin:0; padding:0'\n\t\t\t\t\t});\n\n\t\t\t\t\t// Hides IE move layer cursor\n\t\t\t\t\t// If we set it on Chrome we get this wounderful bug: #6725\n\t\t\t\t\tif (Env.ie) {\n\t\t\t\t\t\thandleElm.contentEditable = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tdom.bind(handleElm, 'mousedown', function(e) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tstartDrag(e);\n\t\t\t\t\t});\n\n\t\t\t\t\thandle.elm = handleElm;\n\n\t\t\t\t\t// Position element\n\t\t\t\t\tdom.setStyles(handleElm, {\n\t\t\t\t\t\tleft: (targetWidth * handle[0] + selectedElmX) - (handleElm.offsetWidth / 2),\n\t\t\t\t\t\ttop: (targetHeight * handle[1] + selectedElmY) - (handleElm.offsetHeight / 2)\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\thideResizeRect();\n\t\t\t}\n\n\t\t\tselectedElm.setAttribute('data-mce-selected', '1');\n\t\t}\n\n\t\tfunction hideResizeRect() {\n\t\t\tvar name, handleElm;\n\n\t\t\tunbindResizeHandleEvents();\n\n\t\t\tif (selectedElm) {\n\t\t\t\tselectedElm.removeAttribute('data-mce-selected');\n\t\t\t}\n\n\t\t\tfor (name in resizeHandles) {\n\t\t\t\thandleElm = dom.get('mceResizeHandle' + name);\n\t\t\t\tif (handleElm) {\n\t\t\t\t\tdom.unbind(handleElm);\n\t\t\t\t\tdom.remove(handleElm);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction updateResizeRect(e) {\n\t\t\tvar startElm, controlElm;\n\n\t\t\tfunction isChildOrEqual(node, parent) {\n\t\t\t\tif (node) {\n\t\t\t\t\tdo {\n\t\t\t\t\t\tif (node === parent) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} while ((node = node.parentNode));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Ignore all events while resizing or if the editor instance was removed\n\t\t\tif (resizeStarted || editor.removed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Remove data-mce-selected from all elements since they might have been copied using Ctrl+c/v\n\t\t\teach(dom.select('img[data-mce-selected],hr[data-mce-selected]'), function(img) {\n\t\t\t\timg.removeAttribute('data-mce-selected');\n\t\t\t});\n\n\t\t\tcontrolElm = e.type == 'mousedown' ? e.target : selection.getNode();\n\t\t\tcontrolElm = dom.$(controlElm).closest(isIE ? 'table' : 'table,img,hr')[0];\n\n\t\t\tif (isChildOrEqual(controlElm, rootElement)) {\n\t\t\t\tdisableGeckoResize();\n\t\t\t\tstartElm = selection.getStart(true);\n\n\t\t\t\tif (isChildOrEqual(startElm, controlElm) && isChildOrEqual(selection.getEnd(true), controlElm)) {\n\t\t\t\t\tif (!isIE || (controlElm != startElm && startElm.nodeName !== 'IMG')) {\n\t\t\t\t\t\tshowResizeRect(controlElm);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\thideResizeRect();\n\t\t}\n\n\t\tfunction attachEvent(elm, name, func) {\n\t\t\tif (elm && elm.attachEvent) {\n\t\t\t\telm.attachEvent('on' + name, func);\n\t\t\t}\n\t\t}\n\n\t\tfunction detachEvent(elm, name, func) {\n\t\t\tif (elm && elm.detachEvent) {\n\t\t\t\telm.detachEvent('on' + name, func);\n\t\t\t}\n\t\t}\n\n\t\tfunction resizeNativeStart(e) {\n\t\t\tvar target = e.srcElement, pos, name, corner, cornerX, cornerY, relativeX, relativeY;\n\n\t\t\tpos = target.getBoundingClientRect();\n\t\t\trelativeX = lastMouseDownEvent.clientX - pos.left;\n\t\t\trelativeY = lastMouseDownEvent.clientY - pos.top;\n\n\t\t\t// Figure out what corner we are draging on\n\t\t\tfor (name in resizeHandles) {\n\t\t\t\tcorner = resizeHandles[name];\n\n\t\t\t\tcornerX = target.offsetWidth * corner[0];\n\t\t\t\tcornerY = target.offsetHeight * corner[1];\n\n\t\t\t\tif (abs(cornerX - relativeX) < 8 && abs(cornerY - relativeY) < 8) {\n\t\t\t\t\tselectedHandle = corner;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Remove native selection and let the magic begin\n\t\t\tresizeStarted = true;\n\t\t\teditor.fire('ObjectResizeStart', {\n\t\t\t\ttarget: selectedElm,\n\t\t\t\twidth: selectedElm.clientWidth,\n\t\t\t\theight: selectedElm.clientHeight\n\t\t\t});\n\t\t\teditor.getDoc().selection.empty();\n\t\t\tshowResizeRect(target, name, lastMouseDownEvent);\n\t\t}\n\n\t\tfunction preventDefault(e) {\n\t\t\tif (e.preventDefault) {\n\t\t\t\te.preventDefault();\n\t\t\t} else {\n\t\t\t\te.returnValue = false; // IE\n\t\t\t}\n\t\t}\n\n\t\tfunction isWithinContentEditableFalse(elm) {\n\t\t\treturn isContentEditableFalse(getContentEditableRoot(editor.getBody(), elm));\n\t\t}\n\n\t\tfunction nativeControlSelect(e) {\n\t\t\tvar target = e.srcElement;\n\n\t\t\tif (isWithinContentEditableFalse(target)) {\n\t\t\t\tpreventDefault(e);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (target != selectedElm) {\n\t\t\t\teditor.fire('ObjectSelected', {target: target});\n\t\t\t\tdetachResizeStartListener();\n\n\t\t\t\tif (target.id.indexOf('mceResizeHandle') === 0) {\n\t\t\t\t\te.returnValue = false;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (target.nodeName == 'IMG' || target.nodeName == 'TABLE') {\n\t\t\t\t\thideResizeRect();\n\t\t\t\t\tselectedElm = target;\n\t\t\t\t\tattachEvent(target, 'resizestart', resizeNativeStart);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction detachResizeStartListener() {\n\t\t\tdetachEvent(selectedElm, 'resizestart', resizeNativeStart);\n\t\t}\n\n\t\tfunction unbindResizeHandleEvents() {\n\t\t\tfor (var name in resizeHandles) {\n\t\t\t\tvar handle = resizeHandles[name];\n\n\t\t\t\tif (handle.elm) {\n\t\t\t\t\tdom.unbind(handle.elm);\n\t\t\t\t\tdelete handle.elm;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction disableGeckoResize() {\n\t\t\ttry {\n\t\t\t\t// Disable object resizing on Gecko\n\t\t\t\teditor.getDoc().execCommand('enableObjectResizing', false, false);\n\t\t\t} catch (ex) {\n\t\t\t\t// Ignore\n\t\t\t}\n\t\t}\n\n\t\tfunction controlSelect(elm) {\n\t\t\tvar ctrlRng;\n\n\t\t\tif (!isIE) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tctrlRng = editableDoc.body.createControlRange();\n\n\t\t\ttry {\n\t\t\t\tctrlRng.addElement(elm);\n\t\t\t\tctrlRng.select();\n\t\t\t\treturn true;\n\t\t\t} catch (ex) {\n\t\t\t\t// Ignore since the element can't be control selected for example a P tag\n\t\t\t}\n\t\t}\n\n\t\teditor.on('init', function() {\n\t\t\tif (isIE) {\n\t\t\t\t// Hide the resize rect on resize and reselect the image\n\t\t\t\teditor.on('ObjectResized', function(e) {\n\t\t\t\t\tif (e.target.nodeName != 'TABLE') {\n\t\t\t\t\t\thideResizeRect();\n\t\t\t\t\t\tcontrolSelect(e.target);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tattachEvent(rootElement, 'controlselect', nativeControlSelect);\n\n\t\t\t\teditor.on('mousedown', function(e) {\n\t\t\t\t\tlastMouseDownEvent = e;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tdisableGeckoResize();\n\n\t\t\t\t// Sniff sniff, hard to feature detect this stuff\n\t\t\t\tif (Env.ie >= 11) {\n\t\t\t\t\t// Needs to be mousedown for drag/drop to work on IE 11\n\t\t\t\t\t// Needs to be click on Edge to properly select images\n\t\t\t\t\teditor.on('mousedown click', function(e) {\n\t\t\t\t\t\tvar target = e.target, nodeName = target.nodeName;\n\n\t\t\t\t\t\tif (!resizeStarted && /^(TABLE|IMG|HR)$/.test(nodeName) && !isWithinContentEditableFalse(target)) {\n\t\t\t\t\t\t\teditor.selection.select(target, nodeName == 'TABLE');\n\n\t\t\t\t\t\t\t// Only fire once since nodeChange is expensive\n\t\t\t\t\t\t\tif (e.type == 'mousedown') {\n\t\t\t\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\teditor.dom.bind(rootElement, 'mscontrolselect', function(e) {\n\t\t\t\t\t\tfunction delayedSelect(node) {\n\t\t\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\t\t\teditor.selection.select(node);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (isWithinContentEditableFalse(e.target)) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tdelayedSelect(e.target);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (/^(TABLE|IMG|HR)$/.test(e.target.nodeName)) {\n\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t// This moves the selection from being a control selection to a text like selection like in WebKit #6753\n\t\t\t\t\t\t\t// TODO: Fix this the day IE works like other browsers without this nasty native ugly control selections.\n\t\t\t\t\t\t\tif (e.target.tagName == 'IMG') {\n\t\t\t\t\t\t\t\tdelayedSelect(e.target);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar throttledUpdateResizeRect = Delay.throttle(function(e) {\n\t\t\t\tif (!editor.composing) {\n\t\t\t\t\tupdateResizeRect(e);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('nodechange ResizeEditor ResizeWindow drop', throttledUpdateResizeRect);\n\n\t\t\t// Update resize rect while typing in a table\n\t\t\teditor.on('keyup compositionend', function(e) {\n\t\t\t\t// Don't update the resize rect while composing since it blows away the IME see: #2710\n\t\t\t\tif (selectedElm && selectedElm.nodeName == \"TABLE\") {\n\t\t\t\t\tthrottledUpdateResizeRect(e);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('hide blur', hideResizeRect);\n\n\t\t\t// Hide rect on focusout since it would float on top of windows otherwise\n\t\t\t//editor.on('focusout', hideResizeRect);\n\t\t});\n\n\t\teditor.on('remove', unbindResizeHandleEvents);\n\n\t\tfunction destroy() {\n\t\t\tselectedElm = selectedElmGhost = null;\n\n\t\t\tif (isIE) {\n\t\t\t\tdetachResizeStartListener();\n\t\t\t\tdetachEvent(rootElement, 'controlselect', nativeControlSelect);\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tisResizable: isResizable,\n\t\t\tshowResizeRect: showResizeRect,\n\t\t\thideResizeRect: hideResizeRect,\n\t\t\tupdateResizeRect: updateResizeRect,\n\t\t\tcontrolSelect: controlSelect,\n\t\t\tdestroy: destroy\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/util/Fun.js\n\n/**\n * Fun.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Functional utility class.\n *\n * @private\n * @class tinymce.util.Fun\n */\ndefine(\"tinymce/util/Fun\", [], function() {\n\tvar slice = [].slice;\n\n\tfunction constant(value) {\n\t\treturn function() {\n\t\t\treturn value;\n\t\t};\n\t}\n\n\tfunction negate(predicate) {\n\t\treturn function(x) {\n\t\t\treturn !predicate(x);\n\t\t};\n\t}\n\n\tfunction compose(f, g) {\n\t\treturn function(x) {\n\t\t\treturn f(g(x));\n\t\t};\n\t}\n\n\tfunction or() {\n\t\tvar args = slice.call(arguments);\n\n\t\treturn function(x) {\n\t\t\tfor (var i = 0; i < args.length; i++) {\n\t\t\t\tif (args[i](x)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t}\n\n\tfunction and() {\n\t\tvar args = slice.call(arguments);\n\n\t\treturn function(x) {\n\t\t\tfor (var i = 0; i < args.length; i++) {\n\t\t\t\tif (!args[i](x)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t};\n\t}\n\n\tfunction curry(fn) {\n\t\tvar args = slice.call(arguments);\n\n\t\tif (args.length - 1 >= fn.length) {\n\t\t\treturn fn.apply(this, args.slice(1));\n\t\t}\n\n\t\treturn function() {\n\t\t\tvar tempArgs = args.concat([].slice.call(arguments));\n\t\t\treturn curry.apply(this, tempArgs);\n\t\t};\n\t}\n\n\tfunction noop() {\n\t}\n\n\treturn {\n\t\tconstant: constant,\n\t\tnegate: negate,\n\t\tand: and,\n\t\tor: or,\n\t\tcurry: curry,\n\t\tcompose: compose,\n\t\tnoop: noop\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/CaretCandidate.js\n\n/**\n * CaretCandidate.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module contains logic for handling caret candidates. A caret candidate is\n * for example text nodes, images, input elements, cE=false elements etc.\n *\n * @private\n * @class tinymce.caret.CaretCandidate\n */\ndefine(\"tinymce/caret/CaretCandidate\", [\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/caret/CaretContainer\"\n], function(NodeType, Arr, CaretContainer) {\n\tvar isContentEditableTrue = NodeType.isContentEditableTrue,\n\t\tisContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tisBr = NodeType.isBr,\n\t\tisText = NodeType.isText,\n\t\tisInvalidTextElement = NodeType.matchNodeNames('script style textarea'),\n\t\tisAtomicInline = NodeType.matchNodeNames('img input textarea hr iframe video audio object'),\n\t\tisTable = NodeType.matchNodeNames('table'),\n\t\tisCaretContainer = CaretContainer.isCaretContainer;\n\n\tfunction isCaretCandidate(node) {\n\t\tif (isCaretContainer(node)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (isText(node)) {\n\t\t\tif (isInvalidTextElement(node.parentNode)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn isAtomicInline(node) || isBr(node) || isTable(node) || isContentEditableFalse(node);\n\t}\n\n\tfunction isInEditable(node, rootNode) {\n\t\tfor (node = node.parentNode; node && node != rootNode; node = node.parentNode) {\n\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (isContentEditableTrue(node)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfunction isAtomicContentEditableFalse(node) {\n\t\tif (!isContentEditableFalse(node)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn Arr.reduce(node.getElementsByTagName('*'), function(result, elm) {\n\t\t\treturn result || isContentEditableTrue(elm);\n\t\t}, false) !== true;\n\t}\n\n\tfunction isAtomic(node) {\n\t\treturn isAtomicInline(node) || isAtomicContentEditableFalse(node);\n\t}\n\n\tfunction isEditableCaretCandidate(node, rootNode) {\n\t\treturn isCaretCandidate(node) && isInEditable(node, rootNode);\n\t}\n\n\treturn {\n\t\tisCaretCandidate: isCaretCandidate,\n\t\tisInEditable: isInEditable,\n\t\tisAtomic: isAtomic,\n\t\tisEditableCaretCandidate: isEditableCaretCandidate\n\t};\n});\n\n// Included from: js/tinymce/classes/geom/ClientRect.js\n\n/**\n * ClientRect.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility functions for working with client rects.\n *\n * @private\n * @class tinymce.geom.ClientRect\n */\ndefine(\"tinymce/geom/ClientRect\", [], function() {\n\tvar round = Math.round;\n\n\tfunction clone(rect) {\n\t\tif (!rect) {\n\t\t\treturn {left: 0, top: 0, bottom: 0, right: 0, width: 0, height: 0};\n\t\t}\n\n\t\treturn {\n\t\t\tleft: round(rect.left),\n\t\t\ttop: round(rect.top),\n\t\t\tbottom: round(rect.bottom),\n\t\t\tright: round(rect.right),\n\t\t\twidth: round(rect.width),\n\t\t\theight: round(rect.height)\n\t\t};\n\t}\n\n\tfunction collapse(clientRect, toStart) {\n\t\tclientRect = clone(clientRect);\n\n\t\tif (toStart) {\n\t\t\tclientRect.right = clientRect.left;\n\t\t} else {\n\t\t\tclientRect.left = clientRect.left + clientRect.width;\n\t\t\tclientRect.right = clientRect.left;\n\t\t}\n\n\t\tclientRect.width = 0;\n\n\t\treturn clientRect;\n\t}\n\n\tfunction isEqual(rect1, rect2) {\n\t\treturn (\n\t\t\trect1.left === rect2.left &&\n\t\t\trect1.top === rect2.top &&\n\t\t\trect1.bottom === rect2.bottom &&\n\t\t\trect1.right === rect2.right\n\t\t);\n\t}\n\n\tfunction isValidOverflow(overflowY, clientRect1, clientRect2) {\n\t\treturn overflowY >= 0 && overflowY <= Math.min(clientRect1.height, clientRect2.height) / 2;\n\n\t}\n\n\tfunction isAbove(clientRect1, clientRect2) {\n\t\tif (clientRect1.bottom < clientRect2.top) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (clientRect1.top > clientRect2.bottom) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn isValidOverflow(clientRect2.top - clientRect1.bottom, clientRect1, clientRect2);\n\t}\n\n\tfunction isBelow(clientRect1, clientRect2) {\n\t\tif (clientRect1.top > clientRect2.bottom) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (clientRect1.bottom < clientRect2.top) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn isValidOverflow(clientRect2.bottom - clientRect1.top, clientRect1, clientRect2);\n\t}\n\n\tfunction isLeft(clientRect1, clientRect2) {\n\t\treturn clientRect1.left < clientRect2.left;\n\t}\n\n\tfunction isRight(clientRect1, clientRect2) {\n\t\treturn clientRect1.right > clientRect2.right;\n\t}\n\n\tfunction compare(clientRect1, clientRect2) {\n\t\tif (isAbove(clientRect1, clientRect2)) {\n\t\t\treturn -1;\n\t\t}\n\n\t\tif (isBelow(clientRect1, clientRect2)) {\n\t\t\treturn 1;\n\t\t}\n\n\t\tif (isLeft(clientRect1, clientRect2)) {\n\t\t\treturn -1;\n\t\t}\n\n\t\tif (isRight(clientRect1, clientRect2)) {\n\t\t\treturn 1;\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\tfunction containsXY(clientRect, clientX, clientY) {\n\t\treturn (\n\t\t\tclientX >= clientRect.left &&\n\t\t\tclientX <= clientRect.right &&\n\t\t\tclientY >= clientRect.top &&\n\t\t\tclientY <= clientRect.bottom\n\t\t);\n\t}\n\n\treturn {\n\t\tclone: clone,\n\t\tcollapse: collapse,\n\t\tisEqual: isEqual,\n\t\tisAbove: isAbove,\n\t\tisBelow: isBelow,\n\t\tisLeft: isLeft,\n\t\tisRight: isRight,\n\t\tcompare: compare,\n\t\tcontainsXY: containsXY\n\t};\n});\n\n// Included from: js/tinymce/classes/text/ExtendingChar.js\n\n/**\n * ExtendingChar.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains logic for detecting extending characters.\n *\n * @private\n * @class tinymce.text.ExtendingChar\n * @example\n * var isExtending = ExtendingChar.isExtendingChar('a');\n */\ndefine(\"tinymce/text/ExtendingChar\", [], function() {\n\t// Generated from: http://www.unicode.org/Public/UNIDATA/DerivedCoreProperties.txt\n\t// Only includes the characters in that fit into UCS-2 16 bit\n\tvar extendingChars = new RegExp(\n\t\t\"[\\u0300-\\u036F\\u0483-\\u0487\\u0488-\\u0489\\u0591-\\u05BD\\u05BF\\u05C1-\\u05C2\\u05C4-\\u05C5\\u05C7\\u0610-\\u061A\" +\n\t\t\"\\u064B-\\u065F\\u0670\\u06D6-\\u06DC\\u06DF-\\u06E4\\u06E7-\\u06E8\\u06EA-\\u06ED\\u0711\\u0730-\\u074A\\u07A6-\\u07B0\" +\n\t\t\"\\u07EB-\\u07F3\\u0816-\\u0819\\u081B-\\u0823\\u0825-\\u0827\\u0829-\\u082D\\u0859-\\u085B\\u08E3-\\u0902\\u093A\\u093C\" +\n\t\t\"\\u0941-\\u0948\\u094D\\u0951-\\u0957\\u0962-\\u0963\\u0981\\u09BC\\u09BE\\u09C1-\\u09C4\\u09CD\\u09D7\\u09E2-\\u09E3\" +\n\t\t\"\\u0A01-\\u0A02\\u0A3C\\u0A41-\\u0A42\\u0A47-\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A70-\\u0A71\\u0A75\\u0A81-\\u0A82\\u0ABC\" +\n\t\t\"\\u0AC1-\\u0AC5\\u0AC7-\\u0AC8\\u0ACD\\u0AE2-\\u0AE3\\u0B01\\u0B3C\\u0B3E\\u0B3F\\u0B41-\\u0B44\\u0B4D\\u0B56\\u0B57\" +\n\t\t\"\\u0B62-\\u0B63\\u0B82\\u0BBE\\u0BC0\\u0BCD\\u0BD7\\u0C00\\u0C3E-\\u0C40\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55-\\u0C56\" +\n\t\t\"\\u0C62-\\u0C63\\u0C81\\u0CBC\\u0CBF\\u0CC2\\u0CC6\\u0CCC-\\u0CCD\\u0CD5-\\u0CD6\\u0CE2-\\u0CE3\\u0D01\\u0D3E\\u0D41-\\u0D44\" +\n\t\t\"\\u0D4D\\u0D57\\u0D62-\\u0D63\\u0DCA\\u0DCF\\u0DD2-\\u0DD4\\u0DD6\\u0DDF\\u0E31\\u0E34-\\u0E3A\\u0E47-\\u0E4E\\u0EB1\\u0EB4-\\u0EB9\" +\n\t\t\"\\u0EBB-\\u0EBC\\u0EC8-\\u0ECD\\u0F18-\\u0F19\\u0F35\\u0F37\\u0F39\\u0F71-\\u0F7E\\u0F80-\\u0F84\\u0F86-\\u0F87\\u0F8D-\\u0F97\" +\n\t\t\"\\u0F99-\\u0FBC\\u0FC6\\u102D-\\u1030\\u1032-\\u1037\\u1039-\\u103A\\u103D-\\u103E\\u1058-\\u1059\\u105E-\\u1060\\u1071-\\u1074\" +\n\t\t\"\\u1082\\u1085-\\u1086\\u108D\\u109D\\u135D-\\u135F\\u1712-\\u1714\\u1732-\\u1734\\u1752-\\u1753\\u1772-\\u1773\\u17B4-\\u17B5\" +\n\t\t\"\\u17B7-\\u17BD\\u17C6\\u17C9-\\u17D3\\u17DD\\u180B-\\u180D\\u18A9\\u1920-\\u1922\\u1927-\\u1928\\u1932\\u1939-\\u193B\\u1A17-\\u1A18\" +\n\t\t\"\\u1A1B\\u1A56\\u1A58-\\u1A5E\\u1A60\\u1A62\\u1A65-\\u1A6C\\u1A73-\\u1A7C\\u1A7F\\u1AB0-\\u1ABD\\u1ABE\\u1B00-\\u1B03\\u1B34\" +\n\t\t\"\\u1B36-\\u1B3A\\u1B3C\\u1B42\\u1B6B-\\u1B73\\u1B80-\\u1B81\\u1BA2-\\u1BA5\\u1BA8-\\u1BA9\\u1BAB-\\u1BAD\\u1BE6\\u1BE8-\\u1BE9\" +\n\t\t\"\\u1BED\\u1BEF-\\u1BF1\\u1C2C-\\u1C33\\u1C36-\\u1C37\\u1CD0-\\u1CD2\\u1CD4-\\u1CE0\\u1CE2-\\u1CE8\\u1CED\\u1CF4\\u1CF8-\\u1CF9\" +\n\t\t\"\\u1DC0-\\u1DF5\\u1DFC-\\u1DFF\\u200C-\\u200D\\u20D0-\\u20DC\\u20DD-\\u20E0\\u20E1\\u20E2-\\u20E4\\u20E5-\\u20F0\\u2CEF-\\u2CF1\" +\n\t\t\"\\u2D7F\\u2DE0-\\u2DFF\\u302A-\\u302D\\u302E-\\u302F\\u3099-\\u309A\\uA66F\\uA670-\\uA672\\uA674-\\uA67D\\uA69E-\\uA69F\\uA6F0-\\uA6F1\" +\n\t\t\"\\uA802\\uA806\\uA80B\\uA825-\\uA826\\uA8C4\\uA8E0-\\uA8F1\\uA926-\\uA92D\\uA947-\\uA951\\uA980-\\uA982\\uA9B3\\uA9B6-\\uA9B9\\uA9BC\" +\n\t\t\"\\uA9E5\\uAA29-\\uAA2E\\uAA31-\\uAA32\\uAA35-\\uAA36\\uAA43\\uAA4C\\uAA7C\\uAAB0\\uAAB2-\\uAAB4\\uAAB7-\\uAAB8\\uAABE-\\uAABF\\uAAC1\" +\n\t\t\"\\uAAEC-\\uAAED\\uAAF6\\uABE5\\uABE8\\uABED\\uFB1E\\uFE00-\\uFE0F\\uFE20-\\uFE2F\\uFF9E-\\uFF9F]\"\n\t);\n\n\tfunction isExtendingChar(ch) {\n\t\treturn typeof ch == \"string\" && ch.charCodeAt(0) >= 768 && extendingChars.test(ch);\n\t}\n\n\treturn {\n\t\tisExtendingChar: isExtendingChar\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/CaretPosition.js\n\n/**\n * CaretPosition.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module contains logic for creating caret positions within a document a caretposition\n * is similar to a DOMRange object but it doesn't have two endpoints and is also more lightweight\n * since it's now updated live when the DOM changes.\n *\n * @private\n * @class tinymce.caret.CaretPosition\n * @example\n * var caretPos1 = new CaretPosition(container, offset);\n * var caretPos2 = CaretPosition.fromRangeStart(someRange);\n */\ndefine(\"tinymce/caret/CaretPosition\", [\n\t\"tinymce/util/Fun\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/caret/CaretCandidate\",\n\t\"tinymce/geom/ClientRect\",\n\t\"tinymce/text/ExtendingChar\"\n], function(Fun, NodeType, DOMUtils, RangeUtils, CaretCandidate, ClientRect, ExtendingChar) {\n\tvar isElement = NodeType.isElement,\n\t\tisCaretCandidate = CaretCandidate.isCaretCandidate,\n\t\tisBlock = NodeType.matchStyleValues('display', 'block table'),\n\t\tisFloated = NodeType.matchStyleValues('float', 'left right'),\n\t\tisValidElementCaretCandidate = Fun.and(isElement, isCaretCandidate, Fun.negate(isFloated)),\n\t\tisNotPre = Fun.negate(NodeType.matchStyleValues('white-space', 'pre pre-line pre-wrap')),\n\t\tisText = NodeType.isText,\n\t\tisBr = NodeType.isBr,\n\t\tnodeIndex = DOMUtils.nodeIndex,\n\t\tresolveIndex = RangeUtils.getNode;\n\n\tfunction createRange(doc) {\n\t\treturn \"createRange\" in doc ? doc.createRange() : DOMUtils.DOM.createRng();\n\t}\n\n\tfunction isWhiteSpace(chr) {\n\t\treturn chr && /[\\r\\n\\t ]/.test(chr);\n\t}\n\n\tfunction isHiddenWhiteSpaceRange(range) {\n\t\tvar container = range.startContainer,\n\t\t\toffset = range.startOffset,\n\t\t\ttext;\n\n\t\tif (isWhiteSpace(range.toString()) && isNotPre(container.parentNode)) {\n\t\t\ttext = container.data;\n\n\t\t\tif (isWhiteSpace(text[offset - 1]) || isWhiteSpace(text[offset + 1])) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tfunction getCaretPositionClientRects(caretPosition) {\n\t\tvar clientRects = [], beforeNode, node;\n\n\t\t// Hack for older WebKit versions that doesn't\n\t\t// support getBoundingClientRect on BR elements\n\t\tfunction getBrClientRect(brNode) {\n\t\t\tvar doc = brNode.ownerDocument,\n\t\t\t\trng = createRange(doc),\n\t\t\t\tnbsp = doc.createTextNode('\\u00a0'),\n\t\t\t\tparentNode = brNode.parentNode,\n\t\t\t\tclientRect;\n\n\t\t\tparentNode.insertBefore(nbsp, brNode);\n\t\t\trng.setStart(nbsp, 0);\n\t\t\trng.setEnd(nbsp, 1);\n\t\t\tclientRect = ClientRect.clone(rng.getBoundingClientRect());\n\t\t\tparentNode.removeChild(nbsp);\n\n\t\t\treturn clientRect;\n\t\t}\n\n\t\tfunction getBoundingClientRect(item) {\n\t\t\tvar clientRect, clientRects;\n\n\t\t\tclientRects = item.getClientRects();\n\t\t\tif (clientRects.length > 0) {\n\t\t\t\tclientRect = ClientRect.clone(clientRects[0]);\n\t\t\t} else {\n\t\t\t\tclientRect = ClientRect.clone(item.getBoundingClientRect());\n\t\t\t}\n\n\t\t\tif (isBr(item) && clientRect.left === 0) {\n\t\t\t\treturn getBrClientRect(item);\n\t\t\t}\n\n\t\t\treturn clientRect;\n\t\t}\n\n\t\tfunction collapseAndInflateWidth(clientRect, toStart) {\n\t\t\tclientRect = ClientRect.collapse(clientRect, toStart);\n\t\t\tclientRect.width = 1;\n\t\t\tclientRect.right = clientRect.left + 1;\n\n\t\t\treturn clientRect;\n\t\t}\n\n\t\tfunction addUniqueAndValidRect(clientRect) {\n\t\t\tif (clientRect.height === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (clientRects.length > 0) {\n\t\t\t\tif (ClientRect.isEqual(clientRect, clientRects[clientRects.length - 1])) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tclientRects.push(clientRect);\n\t\t}\n\n\t\tfunction addCharacterOffset(container, offset) {\n\t\t\tvar range = createRange(container.ownerDocument);\n\n\t\t\tif (offset < container.data.length) {\n\t\t\t\tif (ExtendingChar.isExtendingChar(container.data[offset])) {\n\t\t\t\t\treturn clientRects;\n\t\t\t\t}\n\n\t\t\t\t// WebKit returns two client rects for a position after an extending\n\t\t\t\t// character a\\uxxx|b so expand on \"b\" and collapse to start of \"b\" box\n\t\t\t\tif (ExtendingChar.isExtendingChar(container.data[offset - 1])) {\n\t\t\t\t\trange.setStart(container, offset);\n\t\t\t\t\trange.setEnd(container, offset + 1);\n\n\t\t\t\t\tif (!isHiddenWhiteSpaceRange(range)) {\n\t\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\n\t\t\t\t\t\treturn clientRects;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (offset > 0) {\n\t\t\t\trange.setStart(container, offset - 1);\n\t\t\t\trange.setEnd(container, offset);\n\n\t\t\t\tif (!isHiddenWhiteSpaceRange(range)) {\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (offset < container.data.length) {\n\t\t\t\trange.setStart(container, offset);\n\t\t\t\trange.setEnd(container, offset + 1);\n\n\t\t\t\tif (!isHiddenWhiteSpaceRange(range)) {\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), true));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (isText(caretPosition.container())) {\n\t\t\taddCharacterOffset(caretPosition.container(), caretPosition.offset());\n\t\t\treturn clientRects;\n\t\t}\n\n\t\tif (isElement(caretPosition.container())) {\n\t\t\tif (caretPosition.isAtEnd()) {\n\t\t\t\tnode = resolveIndex(caretPosition.container(), caretPosition.offset());\n\t\t\t\tif (isText(node)) {\n\t\t\t\t\taddCharacterOffset(node, node.data.length);\n\t\t\t\t}\n\n\t\t\t\tif (isValidElementCaretCandidate(node) && !isBr(node)) {\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tnode = resolveIndex(caretPosition.container(), caretPosition.offset());\n\t\t\t\tif (isText(node)) {\n\t\t\t\t\taddCharacterOffset(node, 0);\n\t\t\t\t}\n\n\t\t\t\tif (isValidElementCaretCandidate(node) && caretPosition.isAtEnd()) {\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\n\t\t\t\t\treturn clientRects;\n\t\t\t\t}\n\n\t\t\t\tbeforeNode = resolveIndex(caretPosition.container(), caretPosition.offset() - 1);\n\t\t\t\tif (isValidElementCaretCandidate(beforeNode) && !isBr(beforeNode)) {\n\t\t\t\t\tif (isBlock(beforeNode) || isBlock(node) || !isValidElementCaretCandidate(node)) {\n\t\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(beforeNode), false));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (isValidElementCaretCandidate(node)) {\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), true));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn clientRects;\n\t}\n\n\t/**\n\t * Represents a location within the document by a container and an offset.\n\t *\n\t * @constructor\n\t * @param {Node} container Container node.\n\t * @param {Number} offset Offset within that container node.\n\t * @param {Array} clientRects Optional client rects array for the position.\n\t */\n\tfunction CaretPosition(container, offset, clientRects) {\n\t\tfunction isAtStart() {\n\t\t\tif (isText(container)) {\n\t\t\t\treturn offset === 0;\n\t\t\t}\n\n\t\t\treturn offset === 0;\n\t\t}\n\n\t\tfunction isAtEnd() {\n\t\t\tif (isText(container)) {\n\t\t\t\treturn offset >= container.data.length;\n\t\t\t}\n\n\t\t\treturn offset >= container.childNodes.length;\n\t\t}\n\n\t\tfunction toRange() {\n\t\t\tvar range;\n\n\t\t\trange = createRange(container.ownerDocument);\n\t\t\trange.setStart(container, offset);\n\t\t\trange.setEnd(container, offset);\n\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction getClientRects() {\n\t\t\tif (!clientRects) {\n\t\t\t\tclientRects = getCaretPositionClientRects(new CaretPosition(container, offset));\n\t\t\t}\n\n\t\t\treturn clientRects;\n\t\t}\n\n\t\tfunction isVisible() {\n\t\t\treturn getClientRects().length > 0;\n\t\t}\n\n\t\tfunction isEqual(caretPosition) {\n\t\t\treturn caretPosition && container === caretPosition.container() && offset === caretPosition.offset();\n\t\t}\n\n\t\tfunction getNode(before) {\n\t\t\treturn resolveIndex(container, before ? offset - 1 : offset);\n\t\t}\n\n\t\treturn {\n\t\t\t/**\n\t\t\t * Returns the container node.\n\t\t\t *\n\t\t\t * @method container\n\t\t\t * @return {Node} Container node.\n\t\t\t */\n\t\t\tcontainer: Fun.constant(container),\n\n\t\t\t/**\n\t\t\t * Returns the offset within the container node.\n\t\t\t *\n\t\t\t * @method offset\n\t\t\t * @return {Number} Offset within the container node.\n\t\t\t */\n\t\t\toffset: Fun.constant(offset),\n\n\t\t\t/**\n\t\t\t * Returns a range out of a the caret position.\n\t\t\t *\n\t\t\t * @method toRange\n\t\t\t * @return {DOMRange} range for the caret position.\n\t\t\t */\n\t\t\ttoRange: toRange,\n\n\t\t\t/**\n\t\t\t * Returns the client rects for the caret position. Might be multiple rects between\n\t\t\t * block elements.\n\t\t\t *\n\t\t\t * @method getClientRects\n\t\t\t * @return {Array} Array of client rects.\n\t\t\t */\n\t\t\tgetClientRects: getClientRects,\n\n\t\t\t/**\n\t\t\t * Returns true if the caret location is visible/displayed on screen.\n\t\t\t *\n\t\t\t * @method isVisible\n\t\t\t * @return {Boolean} true/false if the position is visible or not.\n\t\t\t */\n\t\t\tisVisible: isVisible,\n\n\t\t\t/**\n\t\t\t * Returns true if the caret location is at the beginning of text node or container.\n\t\t\t *\n\t\t\t * @method isVisible\n\t\t\t * @return {Boolean} true/false if the position is at the beginning.\n\t\t\t */\n\t\t\tisAtStart: isAtStart,\n\n\t\t\t/**\n\t\t\t * Returns true if the caret location is at the end of text node or container.\n\t\t\t *\n\t\t\t * @method isVisible\n\t\t\t * @return {Boolean} true/false if the position is at the end.\n\t\t\t */\n\t\t\tisAtEnd: isAtEnd,\n\n\t\t\t/**\n\t\t\t * Compares the caret position to another caret position. This will only compare the\n\t\t\t * container and offset not it's visual position.\n\t\t\t *\n\t\t\t * @method isEqual\n\t\t\t * @param {tinymce.caret.CaretPosition} caretPosition Caret position to compare with.\n\t\t\t * @return {Boolean} true if the caret positions are equal.\n\t\t\t */\n\t\t\tisEqual: isEqual,\n\n\t\t\t/**\n\t\t\t * Returns the closest resolved node from a node index. That means if you have an offset after the\n\t\t\t * last node in a container it will return that last node.\n\t\t\t *\n\t\t\t * @method getNode\n\t\t\t * @return {Node} Node that is closest to the index.\n\t\t\t */\n\t\t\tgetNode: getNode\n\t\t};\n\t}\n\n\t/**\n\t * Creates a caret position from the start of a range.\n\t *\n\t * @method fromRangeStart\n\t * @param {DOMRange} range DOM Range to create caret position from.\n\t * @return {tinymce.caret.CaretPosition} Caret position from the start of DOM range.\n\t */\n\tCaretPosition.fromRangeStart = function(range) {\n\t\treturn new CaretPosition(range.startContainer, range.startOffset);\n\t};\n\n\t/**\n\t * Creates a caret position from the end of a range.\n\t *\n\t * @method fromRangeEnd\n\t * @param {DOMRange} range DOM Range to create caret position from.\n\t * @return {tinymce.caret.CaretPosition} Caret position from the end of DOM range.\n\t */\n\tCaretPosition.fromRangeEnd = function(range) {\n\t\treturn new CaretPosition(range.endContainer, range.endOffset);\n\t};\n\n\t/**\n\t * Creates a caret position from a node and places the offset after it.\n\t *\n\t * @method after\n\t * @param {Node} node Node to get caret position from.\n\t * @return {tinymce.caret.CaretPosition} Caret position from the node.\n\t */\n\tCaretPosition.after = function(node) {\n\t\treturn new CaretPosition(node.parentNode, nodeIndex(node) + 1);\n\t};\n\n\t/**\n\t * Creates a caret position from a node and places the offset before it.\n\t *\n\t * @method before\n\t * @param {Node} node Node to get caret position from.\n\t * @return {tinymce.caret.CaretPosition} Caret position from the node.\n\t */\n\tCaretPosition.before = function(node) {\n\t\treturn new CaretPosition(node.parentNode, nodeIndex(node));\n\t};\n\n\treturn CaretPosition;\n});\n\n// Included from: js/tinymce/classes/caret/CaretBookmark.js\n\n/**\n * CaretBookmark.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module creates or resolves xpath like string representation of a CaretPositions.\n *\n * The format is a / separated list of chunks with:\n * <element|text()>[index|after|before]\n *\n * For example:\n *  p[0]/b[0]/text()[0],1 = <p><b>a|c</b></p>\n *  p[0]/img[0],before = <p>|<img></p>\n *  p[0]/img[0],after = <p><img>|</p>\n *\n * @private\n * @static\n * @class tinymce.caret.CaretBookmark\n * @example\n * var bookmark = CaretBookmark.create(rootElm, CaretPosition.before(rootElm.firstChild));\n * var caretPosition = CaretBookmark.resolve(bookmark);\n */\ndefine('tinymce/caret/CaretBookmark', [\n\t'tinymce/dom/NodeType',\n\t'tinymce/dom/DOMUtils',\n\t'tinymce/util/Fun',\n\t'tinymce/util/Arr',\n\t'tinymce/caret/CaretPosition'\n], function(NodeType, DomUtils, Fun, Arr, CaretPosition) {\n\tvar isText = NodeType.isText,\n\t\tisBogus = NodeType.isBogus,\n\t\tnodeIndex = DomUtils.nodeIndex;\n\n\tfunction normalizedParent(node) {\n\t\tvar parentNode = node.parentNode;\n\n\t\tif (isBogus(parentNode)) {\n\t\t\treturn normalizedParent(parentNode);\n\t\t}\n\n\t\treturn parentNode;\n\t}\n\n\tfunction getChildNodes(node) {\n\t\tif (!node) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn Arr.reduce(node.childNodes, function(result, node) {\n\t\t\tif (isBogus(node) && node.nodeName != 'BR') {\n\t\t\t\tresult = result.concat(getChildNodes(node));\n\t\t\t} else {\n\t\t\t\tresult.push(node);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}, []);\n\t}\n\n\tfunction normalizedTextOffset(textNode, offset) {\n\t\twhile ((textNode = textNode.previousSibling)) {\n\t\t\tif (!isText(textNode)) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\toffset += textNode.data.length;\n\t\t}\n\n\t\treturn offset;\n\t}\n\n\tfunction equal(targetValue) {\n\t\treturn function(value) {\n\t\t\treturn targetValue === value;\n\t\t};\n\t}\n\n\tfunction normalizedNodeIndex(node) {\n\t\tvar nodes, index, numTextFragments;\n\n\t\tnodes = getChildNodes(normalizedParent(node));\n\t\tindex = Arr.findIndex(nodes, equal(node), node);\n\t\tnodes = nodes.slice(0, index + 1);\n\t\tnumTextFragments = Arr.reduce(nodes, function(result, node, i) {\n\t\t\tif (isText(node) && isText(nodes[i - 1])) {\n\t\t\t\tresult++;\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}, 0);\n\n\t\tnodes = Arr.filter(nodes, NodeType.matchNodeNames(node.nodeName));\n\t\tindex = Arr.findIndex(nodes, equal(node), node);\n\n\t\treturn index - numTextFragments;\n\t}\n\n\tfunction createPathItem(node) {\n\t\tvar name;\n\n\t\tif (isText(node)) {\n\t\t\tname = 'text()';\n\t\t} else {\n\t\t\tname = node.nodeName.toLowerCase();\n\t\t}\n\n\t\treturn name + '[' + normalizedNodeIndex(node) + ']';\n\t}\n\n\tfunction parentsUntil(rootNode, node, predicate) {\n\t\tvar parents = [];\n\n\t\tfor (node = node.parentNode; node != rootNode; node = node.parentNode) {\n\t\t\tif (predicate && predicate(node)) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tparents.push(node);\n\t\t}\n\n\t\treturn parents;\n\t}\n\n\tfunction create(rootNode, caretPosition) {\n\t\tvar container, offset, path = [],\n\t\t\toutputOffset, childNodes, parents;\n\n\t\tcontainer = caretPosition.container();\n\t\toffset = caretPosition.offset();\n\n\t\tif (isText(container)) {\n\t\t\toutputOffset = normalizedTextOffset(container, offset);\n\t\t} else {\n\t\t\tchildNodes = container.childNodes;\n\t\t\tif (offset >= childNodes.length) {\n\t\t\t\toutputOffset = 'after';\n\t\t\t\toffset = childNodes.length - 1;\n\t\t\t} else {\n\t\t\t\toutputOffset = 'before';\n\t\t\t}\n\n\t\t\tcontainer = childNodes[offset];\n\t\t}\n\n\t\tpath.push(createPathItem(container));\n\t\tparents = parentsUntil(rootNode, container);\n\t\tparents = Arr.filter(parents, Fun.negate(NodeType.isBogus));\n\t\tpath = path.concat(Arr.map(parents, function(node) {\n\t\t\treturn createPathItem(node);\n\t\t}));\n\n\t\treturn path.reverse().join('/') + ',' + outputOffset;\n\t}\n\n\tfunction resolvePathItem(node, name, index) {\n\t\tvar nodes = getChildNodes(node);\n\n\t\tnodes = Arr.filter(nodes, function(node, index) {\n\t\t\treturn !isText(node) || !isText(nodes[index - 1]);\n\t\t});\n\n\t\tnodes = Arr.filter(nodes, NodeType.matchNodeNames(name));\n\t\treturn nodes[index];\n\t}\n\n\tfunction findTextPosition(container, offset) {\n\t\tvar node = container, targetOffset = 0, dataLen;\n\n\t\twhile (isText(node)) {\n\t\t\tdataLen = node.data.length;\n\n\t\t\tif (offset >= targetOffset && offset <= targetOffset + dataLen) {\n\t\t\t\tcontainer = node;\n\t\t\t\toffset = offset - targetOffset;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (!isText(node.nextSibling)) {\n\t\t\t\tcontainer = node;\n\t\t\t\toffset = dataLen;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\ttargetOffset += dataLen;\n\t\t\tnode = node.nextSibling;\n\t\t}\n\n\t\tif (offset > container.data.length) {\n\t\t\toffset = container.data.length;\n\t\t}\n\n\t\treturn new CaretPosition(container, offset);\n\t}\n\n\tfunction resolve(rootNode, path) {\n\t\tvar parts, container, offset;\n\n\t\tif (!path) {\n\t\t\treturn null;\n\t\t}\n\n\t\tparts = path.split(',');\n\t\tpath = parts[0].split('/');\n\t\toffset = parts.length > 1 ? parts[1] : 'before';\n\n\t\tcontainer = Arr.reduce(path, function(result, value) {\n\t\t\tvalue = /([\\w\\-\\(\\)]+)\\[([0-9]+)\\]/.exec(value);\n\t\t\tif (!value) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (value[1] === 'text()') {\n\t\t\t\tvalue[1] = '#text';\n\t\t\t}\n\n\t\t\treturn resolvePathItem(result, value[1], parseInt(value[2], 10));\n\t\t}, rootNode);\n\n\t\tif (!container) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (!isText(container)) {\n\t\t\tif (offset === 'after') {\n\t\t\t\toffset = nodeIndex(container) + 1;\n\t\t\t} else {\n\t\t\t\toffset = nodeIndex(container);\n\t\t\t}\n\n\t\t\treturn new CaretPosition(container.parentNode, offset);\n\t\t}\n\n\t\treturn findTextPosition(container, parseInt(offset, 10));\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Create a xpath bookmark location for the specified caret position.\n\t\t *\n\t\t * @method create\n\t\t * @param {Node} rootNode Root node to create bookmark within.\n\t\t * @param {tinymce.caret.CaretPosition} caretPosition Caret position within the root node.\n\t\t * @return {String} String xpath like location of caret position.\n\t\t */\n\t\tcreate: create,\n\n\t\t/**\n\t\t * Resolves a xpath like bookmark location to the a caret position.\n\t\t *\n\t\t * @method resolve\n\t\t * @param {Node} rootNode Root node to resolve xpath bookmark within.\n\t\t * @param {String} bookmark Bookmark string to resolve.\n\t\t * @return {tinymce.caret.CaretPosition} Caret position resolved from xpath like bookmark.\n\t\t */\n\t\tresolve: resolve\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/BookmarkManager.js\n\n/**\n * BookmarkManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles selection bookmarks.\n *\n * @class tinymce.dom.BookmarkManager\n */\ndefine(\"tinymce/dom/BookmarkManager\", [\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/caret/CaretContainer\",\n\t\"tinymce/caret/CaretBookmark\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/RangeUtils\"\n], function(Env, Tools, CaretContainer, CaretBookmark, CaretPosition, NodeType, RangeUtils) {\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse;\n\n\t/**\n\t * Constructs a new BookmarkManager instance for a specific selection instance.\n\t *\n\t * @constructor\n\t * @method BookmarkManager\n\t * @param {tinymce.dom.Selection} selection Selection instance to handle bookmarks for.\n\t */\n\tfunction BookmarkManager(selection) {\n\t\tvar dom = selection.dom;\n\n\t\t/**\n\t\t * Returns a bookmark location for the current selection. This bookmark object\n\t\t * can then be used to restore the selection after some content modification to the document.\n\t\t *\n\t\t * @method getBookmark\n\t\t * @param {Number} type Optional state if the bookmark should be simple or not. Default is complex.\n\t\t * @param {Boolean} normalized Optional state that enables you to get a position that it would be after normalization.\n\t\t * @return {Object} Bookmark object, use moveToBookmark with this object to restore the selection.\n\t\t * @example\n\t\t * // Stores a bookmark of the current selection\n\t\t * var bm = tinymce.activeEditor.selection.getBookmark();\n\t\t *\n\t\t * tinymce.activeEditor.setContent(tinymce.activeEditor.getContent() + 'Some new content');\n\t\t *\n\t\t * // Restore the selection bookmark\n\t\t * tinymce.activeEditor.selection.moveToBookmark(bm);\n\t\t */\n\t\tthis.getBookmark = function(type, normalized) {\n\t\t\tvar rng, rng2, id, collapsed, name, element, chr = '&#xFEFF;', styles;\n\n\t\t\tfunction findIndex(name, element) {\n\t\t\t\tvar count = 0;\n\n\t\t\t\tTools.each(dom.select(name), function(node) {\n\t\t\t\t\tif (node.getAttribute('data-mce-bogus') === 'all') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node == element) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tcount++;\n\t\t\t\t});\n\n\t\t\t\treturn count;\n\t\t\t}\n\n\t\t\tfunction normalizeTableCellSelection(rng) {\n\t\t\t\tfunction moveEndPoint(start) {\n\t\t\t\t\tvar container, offset, childNodes, prefix = start ? 'start' : 'end';\n\n\t\t\t\t\tcontainer = rng[prefix + 'Container'];\n\t\t\t\t\toffset = rng[prefix + 'Offset'];\n\n\t\t\t\t\tif (container.nodeType == 1 && container.nodeName == \"TR\") {\n\t\t\t\t\t\tchildNodes = container.childNodes;\n\t\t\t\t\t\tcontainer = childNodes[Math.min(start ? offset : offset - 1, childNodes.length - 1)];\n\t\t\t\t\t\tif (container) {\n\t\t\t\t\t\t\toffset = start ? 0 : container.childNodes.length;\n\t\t\t\t\t\t\trng['set' + (start ? 'Start' : 'End')](container, offset);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tmoveEndPoint(true);\n\t\t\t\tmoveEndPoint();\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\tfunction getLocation(rng) {\n\t\t\t\tvar root = dom.getRoot(), bookmark = {};\n\n\t\t\t\tfunction getPoint(rng, start) {\n\t\t\t\t\tvar container = rng[start ? 'startContainer' : 'endContainer'],\n\t\t\t\t\t\toffset = rng[start ? 'startOffset' : 'endOffset'], point = [], node, childNodes, after = 0;\n\n\t\t\t\t\tif (container.nodeType == 3) {\n\t\t\t\t\t\tif (normalized) {\n\t\t\t\t\t\t\tfor (node = container.previousSibling; node && node.nodeType == 3; node = node.previousSibling) {\n\t\t\t\t\t\t\t\toffset += node.nodeValue.length;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpoint.push(offset);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchildNodes = container.childNodes;\n\n\t\t\t\t\t\tif (offset >= childNodes.length && childNodes.length) {\n\t\t\t\t\t\t\tafter = 1;\n\t\t\t\t\t\t\toffset = Math.max(0, childNodes.length - 1);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpoint.push(dom.nodeIndex(childNodes[offset], normalized) + after);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (; container && container != root; container = container.parentNode) {\n\t\t\t\t\t\tpoint.push(dom.nodeIndex(container, normalized));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn point;\n\t\t\t\t}\n\n\t\t\t\tbookmark.start = getPoint(rng, true);\n\n\t\t\t\tif (!selection.isCollapsed()) {\n\t\t\t\t\tbookmark.end = getPoint(rng);\n\t\t\t\t}\n\n\t\t\t\treturn bookmark;\n\t\t\t}\n\n\t\t\tfunction findAdjacentContentEditableFalseElm(rng) {\n\t\t\t\tfunction findSibling(node, offset) {\n\t\t\t\t\tvar sibling;\n\n\t\t\t\t\tif (NodeType.isElement(node)) {\n\t\t\t\t\t\tnode = RangeUtils.getNode(node, offset);\n\t\t\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (CaretContainer.isCaretContainer(node)) {\n\t\t\t\t\t\tif (NodeType.isText(node) && CaretContainer.isCaretContainerBlock(node)) {\n\t\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsibling = node.previousSibling;\n\t\t\t\t\t\tif (isContentEditableFalse(sibling)) {\n\t\t\t\t\t\t\treturn sibling;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsibling = node.nextSibling;\n\t\t\t\t\t\tif (isContentEditableFalse(sibling)) {\n\t\t\t\t\t\t\treturn sibling;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn findSibling(rng.startContainer, rng.startOffset) || findSibling(rng.endContainer, rng.endOffset);\n\t\t\t}\n\n\t\t\tif (type == 2) {\n\t\t\t\telement = selection.getNode();\n\t\t\t\tname = element ? element.nodeName : null;\n\t\t\t\trng = selection.getRng();\n\n\t\t\t\tif (isContentEditableFalse(element) || name == 'IMG') {\n\t\t\t\t\treturn {name: name, index: findIndex(name, element)};\n\t\t\t\t}\n\n\t\t\t\tif (selection.tridentSel) {\n\t\t\t\t\treturn selection.tridentSel.getBookmark(type);\n\t\t\t\t}\n\n\t\t\t\telement = findAdjacentContentEditableFalseElm(rng);\n\t\t\t\tif (element) {\n\t\t\t\t\tname = element.tagName;\n\t\t\t\t\treturn {name: name, index: findIndex(name, element)};\n\t\t\t\t}\n\n\t\t\t\treturn getLocation(rng);\n\t\t\t}\n\n\t\t\tif (type == 3) {\n\t\t\t\trng = selection.getRng();\n\n\t\t\t\treturn {\n\t\t\t\t\tstart: CaretBookmark.create(dom.getRoot(), CaretPosition.fromRangeStart(rng)),\n\t\t\t\t\tend: CaretBookmark.create(dom.getRoot(), CaretPosition.fromRangeEnd(rng))\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Handle simple range\n\t\t\tif (type) {\n\t\t\t\treturn {rng: selection.getRng()};\n\t\t\t}\n\n\t\t\trng = selection.getRng();\n\t\t\tid = dom.uniqueId();\n\t\t\tcollapsed = selection.isCollapsed();\n\t\t\tstyles = 'overflow:hidden;line-height:0px';\n\n\t\t\t// Explorer method\n\t\t\tif (rng.duplicate || rng.item) {\n\t\t\t\t// Text selection\n\t\t\t\tif (!rng.item) {\n\t\t\t\t\trng2 = rng.duplicate();\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Insert start marker\n\t\t\t\t\t\trng.collapse();\n\t\t\t\t\t\trng.pasteHTML('<span data-mce-type=\"bookmark\" id=\"' + id + '_start\" style=\"' + styles + '\">' + chr + '</span>');\n\n\t\t\t\t\t\t// Insert end marker\n\t\t\t\t\t\tif (!collapsed) {\n\t\t\t\t\t\t\trng2.collapse(false);\n\n\t\t\t\t\t\t\t// Detect the empty space after block elements in IE and move the\n\t\t\t\t\t\t\t// end back one character <p></p>] becomes <p>]</p>\n\t\t\t\t\t\t\trng.moveToElementText(rng2.parentElement());\n\t\t\t\t\t\t\tif (rng.compareEndPoints('StartToEnd', rng2) === 0) {\n\t\t\t\t\t\t\t\trng2.move('character', -1);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\trng2.pasteHTML('<span data-mce-type=\"bookmark\" id=\"' + id + '_end\" style=\"' + styles + '\">' + chr + '</span>');\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// IE might throw unspecified error so lets ignore it\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Control selection\n\t\t\t\t\telement = rng.item(0);\n\t\t\t\t\tname = element.nodeName;\n\n\t\t\t\t\treturn {name: name, index: findIndex(name, element)};\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\telement = selection.getNode();\n\t\t\t\tname = element.nodeName;\n\t\t\t\tif (name == 'IMG') {\n\t\t\t\t\treturn {name: name, index: findIndex(name, element)};\n\t\t\t\t}\n\n\t\t\t\t// W3C method\n\t\t\t\trng2 = normalizeTableCellSelection(rng.cloneRange());\n\n\t\t\t\t// Insert end marker\n\t\t\t\tif (!collapsed) {\n\t\t\t\t\trng2.collapse(false);\n\t\t\t\t\trng2.insertNode(dom.create('span', {'data-mce-type': \"bookmark\", id: id + '_end', style: styles}, chr));\n\t\t\t\t}\n\n\t\t\t\trng = normalizeTableCellSelection(rng);\n\t\t\t\trng.collapse(true);\n\t\t\t\trng.insertNode(dom.create('span', {'data-mce-type': \"bookmark\", id: id + '_start', style: styles}, chr));\n\t\t\t}\n\n\t\t\tselection.moveToBookmark({id: id, keep: 1});\n\n\t\t\treturn {id: id};\n\t\t};\n\n\t\t/**\n\t\t * Restores the selection to the specified bookmark.\n\t\t *\n\t\t * @method moveToBookmark\n\t\t * @param {Object} bookmark Bookmark to restore selection from.\n\t\t * @return {Boolean} true/false if it was successful or not.\n\t\t * @example\n\t\t * // Stores a bookmark of the current selection\n\t\t * var bm = tinymce.activeEditor.selection.getBookmark();\n\t\t *\n\t\t * tinymce.activeEditor.setContent(tinymce.activeEditor.getContent() + 'Some new content');\n\t\t *\n\t\t * // Restore the selection bookmark\n\t\t * tinymce.activeEditor.selection.moveToBookmark(bm);\n\t\t */\n\t\tthis.moveToBookmark = function(bookmark) {\n\t\t\tvar rng, root, startContainer, endContainer, startOffset, endOffset;\n\n\t\t\tfunction setEndPoint(start) {\n\t\t\t\tvar point = bookmark[start ? 'start' : 'end'], i, node, offset, children;\n\n\t\t\t\tif (point) {\n\t\t\t\t\toffset = point[0];\n\n\t\t\t\t\t// Find container node\n\t\t\t\t\tfor (node = root, i = point.length - 1; i >= 1; i--) {\n\t\t\t\t\t\tchildren = node.childNodes;\n\n\t\t\t\t\t\tif (point[i] > children.length - 1) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = children[point[i]];\n\t\t\t\t\t}\n\n\t\t\t\t\t// Move text offset to best suitable location\n\t\t\t\t\tif (node.nodeType === 3) {\n\t\t\t\t\t\toffset = Math.min(point[0], node.nodeValue.length);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Move element offset to best suitable location\n\t\t\t\t\tif (node.nodeType === 1) {\n\t\t\t\t\t\toffset = Math.min(point[0], node.childNodes.length);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Set offset within container node\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\trng.setStart(node, offset);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng.setEnd(node, offset);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tfunction restoreEndPoint(suffix) {\n\t\t\t\tvar marker = dom.get(bookmark.id + '_' + suffix), node, idx, next, prev, keep = bookmark.keep;\n\n\t\t\t\tif (marker) {\n\t\t\t\t\tnode = marker.parentNode;\n\n\t\t\t\t\tif (suffix == 'start') {\n\t\t\t\t\t\tif (!keep) {\n\t\t\t\t\t\t\tidx = dom.nodeIndex(marker);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode = marker.firstChild;\n\t\t\t\t\t\t\tidx = 1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstartContainer = endContainer = node;\n\t\t\t\t\t\tstartOffset = endOffset = idx;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!keep) {\n\t\t\t\t\t\t\tidx = dom.nodeIndex(marker);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode = marker.firstChild;\n\t\t\t\t\t\t\tidx = 1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tendContainer = node;\n\t\t\t\t\t\tendOffset = idx;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!keep) {\n\t\t\t\t\t\tprev = marker.previousSibling;\n\t\t\t\t\t\tnext = marker.nextSibling;\n\n\t\t\t\t\t\t// Remove all marker text nodes\n\t\t\t\t\t\tTools.each(Tools.grep(marker.childNodes), function(node) {\n\t\t\t\t\t\t\tif (node.nodeType == 3) {\n\t\t\t\t\t\t\t\tnode.nodeValue = node.nodeValue.replace(/\\uFEFF/g, '');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove marker but keep children if for example contents where inserted into the marker\n\t\t\t\t\t\t// Also remove duplicated instances of the marker for example by a\n\t\t\t\t\t\t// split operation or by WebKit auto split on paste feature\n\t\t\t\t\t\twhile ((marker = dom.get(bookmark.id + '_' + suffix))) {\n\t\t\t\t\t\t\tdom.remove(marker, 1);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// If siblings are text nodes then merge them unless it's Opera since it some how removes the node\n\t\t\t\t\t\t// and we are sniffing since adding a lot of detection code for a browser with 3% of the market\n\t\t\t\t\t\t// isn't worth the effort. Sorry, Opera but it's just a fact\n\t\t\t\t\t\tif (prev && next && prev.nodeType == next.nodeType && prev.nodeType == 3 && !Env.opera) {\n\t\t\t\t\t\t\tidx = prev.nodeValue.length;\n\t\t\t\t\t\t\tprev.appendData(next.nodeValue);\n\t\t\t\t\t\t\tdom.remove(next);\n\n\t\t\t\t\t\t\tif (suffix == 'start') {\n\t\t\t\t\t\t\t\tstartContainer = endContainer = prev;\n\t\t\t\t\t\t\t\tstartOffset = endOffset = idx;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tendContainer = prev;\n\t\t\t\t\t\t\t\tendOffset = idx;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction addBogus(node) {\n\t\t\t\t// Adds a bogus BR element for empty block elements\n\t\t\t\tif (dom.isBlock(node) && !node.innerHTML && !Env.ie) {\n\t\t\t\t\tnode.innerHTML = '<br data-mce-bogus=\"1\" />';\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tfunction resolveCaretPositionBookmark() {\n\t\t\t\tvar rng, pos;\n\n\t\t\t\trng = dom.createRng();\n\t\t\t\tpos = CaretBookmark.resolve(dom.getRoot(), bookmark.start);\n\t\t\t\trng.setStart(pos.container(), pos.offset());\n\n\t\t\t\tpos = CaretBookmark.resolve(dom.getRoot(), bookmark.end);\n\t\t\t\trng.setEnd(pos.container(), pos.offset());\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\tif (bookmark) {\n\t\t\t\tif (Tools.isArray(bookmark.start)) {\n\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\troot = dom.getRoot();\n\n\t\t\t\t\tif (selection.tridentSel) {\n\t\t\t\t\t\treturn selection.tridentSel.moveToBookmark(bookmark);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (setEndPoint(true) && setEndPoint()) {\n\t\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof bookmark.start == 'string') {\n\t\t\t\t\tselection.setRng(resolveCaretPositionBookmark(bookmark));\n\t\t\t\t} else if (bookmark.id) {\n\t\t\t\t\t// Restore start/end points\n\t\t\t\t\trestoreEndPoint('start');\n\t\t\t\t\trestoreEndPoint('end');\n\n\t\t\t\t\tif (startContainer) {\n\t\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\t\trng.setStart(addBogus(startContainer), startOffset);\n\t\t\t\t\t\trng.setEnd(addBogus(endContainer), endOffset);\n\t\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t\t}\n\t\t\t\t} else if (bookmark.name) {\n\t\t\t\t\tselection.select(dom.select(bookmark.name)[bookmark.index]);\n\t\t\t\t} else if (bookmark.rng) {\n\t\t\t\t\tselection.setRng(bookmark.rng);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Returns true/false if the specified node is a bookmark node or not.\n\t *\n\t * @static\n\t * @method isBookmarkNode\n\t * @param {DOMNode} node DOM Node to check if it's a bookmark node or not.\n\t * @return {Boolean} true/false if the node is a bookmark node or not.\n\t */\n\tBookmarkManager.isBookmarkNode = function(node) {\n\t\treturn node && node.tagName === 'SPAN' && node.getAttribute('data-mce-type') === 'bookmark';\n\t};\n\n\treturn BookmarkManager;\n});\n\n// Included from: js/tinymce/classes/dom/Selection.js\n\n/**\n * Selection.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles text and control selection it's an crossbrowser utility class.\n * Consult the TinyMCE Wiki API for more details and examples on how to use this class.\n *\n * @class tinymce.dom.Selection\n * @example\n * // Getting the currently selected node for the active editor\n * alert(tinymce.activeEditor.selection.getNode().nodeName);\n */\ndefine(\"tinymce/dom/Selection\", [\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/TridentSelection\",\n\t\"tinymce/dom/ControlSelection\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/dom/BookmarkManager\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/caret/CaretPosition\"\n], function(TreeWalker, TridentSelection, ControlSelection, RangeUtils, BookmarkManager, NodeType, Env, Tools, CaretPosition) {\n\tvar each = Tools.each, trim = Tools.trim;\n\tvar isIE = Env.ie;\n\n\t/**\n\t * Constructs a new selection instance.\n\t *\n\t * @constructor\n\t * @method Selection\n\t * @param {tinymce.dom.DOMUtils} dom DOMUtils object reference.\n\t * @param {Window} win Window to bind the selection object to.\n\t * @param {tinymce.Editor} editor Editor instance of the selection.\n\t * @param {tinymce.dom.Serializer} serializer DOM serialization class to use for getContent.\n\t */\n\tfunction Selection(dom, win, serializer, editor) {\n\t\tvar self = this;\n\n\t\tself.dom = dom;\n\t\tself.win = win;\n\t\tself.serializer = serializer;\n\t\tself.editor = editor;\n\t\tself.bookmarkManager = new BookmarkManager(self);\n\t\tself.controlSelection = new ControlSelection(self, editor);\n\n\t\t// No W3C Range support\n\t\tif (!self.win.getSelection) {\n\t\t\tself.tridentSel = new TridentSelection(self);\n\t\t}\n\t}\n\n\tSelection.prototype = {\n\t\t/**\n\t\t * Move the selection cursor range to the specified node and offset.\n\t\t * If there is no node specified it will move it to the first suitable location within the body.\n\t\t *\n\t\t * @method setCursorLocation\n\t\t * @param {Node} node Optional node to put the cursor in.\n\t\t * @param {Number} offset Optional offset from the start of the node to put the cursor at.\n\t\t */\n\t\tsetCursorLocation: function(node, offset) {\n\t\t\tvar self = this, rng = self.dom.createRng();\n\n\t\t\tif (!node) {\n\t\t\t\tself._moveEndPoint(rng, self.editor.getBody(), true);\n\t\t\t\tself.setRng(rng);\n\t\t\t} else {\n\t\t\t\trng.setStart(node, offset);\n\t\t\t\trng.setEnd(node, offset);\n\t\t\t\tself.setRng(rng);\n\t\t\t\tself.collapse(false);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the selected contents using the DOM serializer passed in to this class.\n\t\t *\n\t\t * @method getContent\n\t\t * @param {Object} args Optional settings class with for example output format text or html.\n\t\t * @return {String} Selected contents in for example HTML format.\n\t\t * @example\n\t\t * // Alerts the currently selected contents\n\t\t * alert(tinymce.activeEditor.selection.getContent());\n\t\t *\n\t\t * // Alerts the currently selected contents as plain text\n\t\t * alert(tinymce.activeEditor.selection.getContent({format: 'text'}));\n\t\t */\n\t\tgetContent: function(args) {\n\t\t\tvar self = this, rng = self.getRng(), tmpElm = self.dom.create(\"body\");\n\t\t\tvar se = self.getSel(), whiteSpaceBefore, whiteSpaceAfter, fragment;\n\n\t\t\targs = args || {};\n\t\t\twhiteSpaceBefore = whiteSpaceAfter = '';\n\t\t\targs.get = true;\n\t\t\targs.format = args.format || 'html';\n\t\t\targs.selection = true;\n\t\t\tself.editor.fire('BeforeGetContent', args);\n\n\t\t\tif (args.format == 'text') {\n\t\t\t\treturn self.isCollapsed() ? '' : (rng.text || (se.toString ? se.toString() : ''));\n\t\t\t}\n\n\t\t\tif (rng.cloneContents) {\n\t\t\t\tfragment = rng.cloneContents();\n\n\t\t\t\tif (fragment) {\n\t\t\t\t\ttmpElm.appendChild(fragment);\n\t\t\t\t}\n\t\t\t} else if (rng.item !== undefined || rng.htmlText !== undefined) {\n\t\t\t\t// IE will produce invalid markup if elements are present that\n\t\t\t\t// it doesn't understand like custom elements or HTML5 elements.\n\t\t\t\t// Adding a BR in front of the contents and then remoiving it seems to fix it though.\n\t\t\t\ttmpElm.innerHTML = '<br>' + (rng.item ? rng.item(0).outerHTML : rng.htmlText);\n\t\t\t\ttmpElm.removeChild(tmpElm.firstChild);\n\t\t\t} else {\n\t\t\t\ttmpElm.innerHTML = rng.toString();\n\t\t\t}\n\n\t\t\t// Keep whitespace before and after\n\t\t\tif (/^\\s/.test(tmpElm.innerHTML)) {\n\t\t\t\twhiteSpaceBefore = ' ';\n\t\t\t}\n\n\t\t\tif (/\\s+$/.test(tmpElm.innerHTML)) {\n\t\t\t\twhiteSpaceAfter = ' ';\n\t\t\t}\n\n\t\t\targs.getInner = true;\n\n\t\t\targs.content = self.isCollapsed() ? '' : whiteSpaceBefore + self.serializer.serialize(tmpElm, args) + whiteSpaceAfter;\n\t\t\tself.editor.fire('GetContent', args);\n\n\t\t\treturn args.content;\n\t\t},\n\n\t\t/**\n\t\t * Sets the current selection to the specified content. If any contents is selected it will be replaced\n\t\t * with the contents passed in to this function. If there is no selection the contents will be inserted\n\t\t * where the caret is placed in the editor/page.\n\t\t *\n\t\t * @method setContent\n\t\t * @param {String} content HTML contents to set could also be other formats depending on settings.\n\t\t * @param {Object} args Optional settings object with for example data format.\n\t\t * @example\n\t\t * // Inserts some HTML contents at the current selection\n\t\t * tinymce.activeEditor.selection.setContent('<strong>Some contents</strong>');\n\t\t */\n\t\tsetContent: function(content, args) {\n\t\t\tvar self = this, rng = self.getRng(), caretNode, doc = self.win.document, frag, temp;\n\n\t\t\targs = args || {format: 'html'};\n\t\t\targs.set = true;\n\t\t\targs.selection = true;\n\t\t\targs.content = content;\n\n\t\t\t// Dispatch before set content event\n\t\t\tif (!args.no_events) {\n\t\t\t\tself.editor.fire('BeforeSetContent', args);\n\t\t\t}\n\n\t\t\tcontent = args.content;\n\n\t\t\tif (rng.insertNode) {\n\t\t\t\t// Make caret marker since insertNode places the caret in the beginning of text after insert\n\t\t\t\tcontent += '<span id=\"__caret\">_</span>';\n\n\t\t\t\t// Delete and insert new node\n\t\t\t\tif (rng.startContainer == doc && rng.endContainer == doc) {\n\t\t\t\t\t// WebKit will fail if the body is empty since the range is then invalid and it can't insert contents\n\t\t\t\t\tdoc.body.innerHTML = content;\n\t\t\t\t} else {\n\t\t\t\t\trng.deleteContents();\n\n\t\t\t\t\tif (doc.body.childNodes.length === 0) {\n\t\t\t\t\t\tdoc.body.innerHTML = content;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// createContextualFragment doesn't exists in IE 9 DOMRanges\n\t\t\t\t\t\tif (rng.createContextualFragment) {\n\t\t\t\t\t\t\trng.insertNode(rng.createContextualFragment(content));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Fake createContextualFragment call in IE 9\n\t\t\t\t\t\t\tfrag = doc.createDocumentFragment();\n\t\t\t\t\t\t\ttemp = doc.createElement('div');\n\n\t\t\t\t\t\t\tfrag.appendChild(temp);\n\t\t\t\t\t\t\ttemp.outerHTML = content;\n\n\t\t\t\t\t\t\trng.insertNode(frag);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Move to caret marker\n\t\t\t\tcaretNode = self.dom.get('__caret');\n\n\t\t\t\t// Make sure we wrap it compleatly, Opera fails with a simple select call\n\t\t\t\trng = doc.createRange();\n\t\t\t\trng.setStartBefore(caretNode);\n\t\t\t\trng.setEndBefore(caretNode);\n\t\t\t\tself.setRng(rng);\n\n\t\t\t\t// Remove the caret position\n\t\t\t\tself.dom.remove('__caret');\n\n\t\t\t\ttry {\n\t\t\t\t\tself.setRng(rng);\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Might fail on Opera for some odd reason\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (rng.item) {\n\t\t\t\t\t// Delete content and get caret text selection\n\t\t\t\t\tdoc.execCommand('Delete', false, null);\n\t\t\t\t\trng = self.getRng();\n\t\t\t\t}\n\n\t\t\t\t// Explorer removes spaces from the beginning of pasted contents\n\t\t\t\tif (/^\\s+/.test(content)) {\n\t\t\t\t\trng.pasteHTML('<span id=\"__mce_tmp\">_</span>' + content);\n\t\t\t\t\tself.dom.remove('__mce_tmp');\n\t\t\t\t} else {\n\t\t\t\t\trng.pasteHTML(content);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Dispatch set content event\n\t\t\tif (!args.no_events) {\n\t\t\t\tself.editor.fire('SetContent', args);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the start element of a selection range. If the start is in a text\n\t\t * node the parent element will be returned.\n\t\t *\n\t\t * @method getStart\n\t\t * @param {Boolean} real Optional state to get the real parent when the selection is collapsed not the closest element.\n\t\t * @return {Element} Start element of selection range.\n\t\t */\n\t\tgetStart: function(real) {\n\t\t\tvar self = this, rng = self.getRng(), startElement, parentElement, checkRng, node;\n\n\t\t\tif (rng.duplicate || rng.item) {\n\t\t\t\t// Control selection, return first item\n\t\t\t\tif (rng.item) {\n\t\t\t\t\treturn rng.item(0);\n\t\t\t\t}\n\n\t\t\t\t// Get start element\n\t\t\t\tcheckRng = rng.duplicate();\n\t\t\t\tcheckRng.collapse(1);\n\t\t\t\tstartElement = checkRng.parentElement();\n\t\t\t\tif (startElement.ownerDocument !== self.dom.doc) {\n\t\t\t\t\tstartElement = self.dom.getRoot();\n\t\t\t\t}\n\n\t\t\t\t// Check if range parent is inside the start element, then return the inner parent element\n\t\t\t\t// This will fix issues when a single element is selected, IE would otherwise return the wrong start element\n\t\t\t\tparentElement = node = rng.parentElement();\n\t\t\t\twhile ((node = node.parentNode)) {\n\t\t\t\t\tif (node == startElement) {\n\t\t\t\t\t\tstartElement = parentElement;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn startElement;\n\t\t\t}\n\n\t\t\tstartElement = rng.startContainer;\n\n\t\t\tif (startElement.nodeType == 1 && startElement.hasChildNodes()) {\n\t\t\t\tif (!real || !rng.collapsed) {\n\t\t\t\t\tstartElement = startElement.childNodes[Math.min(startElement.childNodes.length - 1, rng.startOffset)];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (startElement && startElement.nodeType == 3) {\n\t\t\t\treturn startElement.parentNode;\n\t\t\t}\n\n\t\t\treturn startElement;\n\t\t},\n\n\t\t/**\n\t\t * Returns the end element of a selection range. If the end is in a text\n\t\t * node the parent element will be returned.\n\t\t *\n\t\t * @method getEnd\n\t\t * @param {Boolean} real Optional state to get the real parent when the selection is collapsed not the closest element.\n\t\t * @return {Element} End element of selection range.\n\t\t */\n\t\tgetEnd: function(real) {\n\t\t\tvar self = this, rng = self.getRng(), endElement, endOffset;\n\n\t\t\tif (rng.duplicate || rng.item) {\n\t\t\t\tif (rng.item) {\n\t\t\t\t\treturn rng.item(0);\n\t\t\t\t}\n\n\t\t\t\trng = rng.duplicate();\n\t\t\t\trng.collapse(0);\n\t\t\t\tendElement = rng.parentElement();\n\t\t\t\tif (endElement.ownerDocument !== self.dom.doc) {\n\t\t\t\t\tendElement = self.dom.getRoot();\n\t\t\t\t}\n\n\t\t\t\tif (endElement && endElement.nodeName == 'BODY') {\n\t\t\t\t\treturn endElement.lastChild || endElement;\n\t\t\t\t}\n\n\t\t\t\treturn endElement;\n\t\t\t}\n\n\t\t\tendElement = rng.endContainer;\n\t\t\tendOffset = rng.endOffset;\n\n\t\t\tif (endElement.nodeType == 1 && endElement.hasChildNodes()) {\n\t\t\t\tif (!real || !rng.collapsed) {\n\t\t\t\t\tendElement = endElement.childNodes[endOffset > 0 ? endOffset - 1 : endOffset];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (endElement && endElement.nodeType == 3) {\n\t\t\t\treturn endElement.parentNode;\n\t\t\t}\n\n\t\t\treturn endElement;\n\t\t},\n\n\t\t/**\n\t\t * Returns a bookmark location for the current selection. This bookmark object\n\t\t * can then be used to restore the selection after some content modification to the document.\n\t\t *\n\t\t * @method getBookmark\n\t\t * @param {Number} type Optional state if the bookmark should be simple or not. Default is complex.\n\t\t * @param {Boolean} normalized Optional state that enables you to get a position that it would be after normalization.\n\t\t * @return {Object} Bookmark object, use moveToBookmark with this object to restore the selection.\n\t\t * @example\n\t\t * // Stores a bookmark of the current selection\n\t\t * var bm = tinymce.activeEditor.selection.getBookmark();\n\t\t *\n\t\t * tinymce.activeEditor.setContent(tinymce.activeEditor.getContent() + 'Some new content');\n\t\t *\n\t\t * // Restore the selection bookmark\n\t\t * tinymce.activeEditor.selection.moveToBookmark(bm);\n\t\t */\n\t\tgetBookmark: function(type, normalized) {\n\t\t\treturn this.bookmarkManager.getBookmark(type, normalized);\n\t\t},\n\n\t\t/**\n\t\t * Restores the selection to the specified bookmark.\n\t\t *\n\t\t * @method moveToBookmark\n\t\t * @param {Object} bookmark Bookmark to restore selection from.\n\t\t * @return {Boolean} true/false if it was successful or not.\n\t\t * @example\n\t\t * // Stores a bookmark of the current selection\n\t\t * var bm = tinymce.activeEditor.selection.getBookmark();\n\t\t *\n\t\t * tinymce.activeEditor.setContent(tinymce.activeEditor.getContent() + 'Some new content');\n\t\t *\n\t\t * // Restore the selection bookmark\n\t\t * tinymce.activeEditor.selection.moveToBookmark(bm);\n\t\t */\n\t\tmoveToBookmark: function(bookmark) {\n\t\t\treturn this.bookmarkManager.moveToBookmark(bookmark);\n\t\t},\n\n\t\t/**\n\t\t * Selects the specified element. This will place the start and end of the selection range around the element.\n\t\t *\n\t\t * @method select\n\t\t * @param {Element} node HTML DOM element to select.\n\t\t * @param {Boolean} content Optional bool state if the contents should be selected or not on non IE browser.\n\t\t * @return {Element} Selected element the same element as the one that got passed in.\n\t\t * @example\n\t\t * // Select the first paragraph in the active editor\n\t\t * tinymce.activeEditor.selection.select(tinymce.activeEditor.dom.select('p')[0]);\n\t\t */\n\t\tselect: function(node, content) {\n\t\t\tvar self = this, dom = self.dom, rng = dom.createRng(), idx;\n\n\t\t\t// Clear stored range set by FocusManager\n\t\t\tself.lastFocusBookmark = null;\n\n\t\t\tif (node) {\n\t\t\t\tif (!content && self.controlSelection.controlSelect(node)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tidx = dom.nodeIndex(node);\n\t\t\t\trng.setStart(node.parentNode, idx);\n\t\t\t\trng.setEnd(node.parentNode, idx + 1);\n\n\t\t\t\t// Find first/last text node or BR element\n\t\t\t\tif (content) {\n\t\t\t\t\tself._moveEndPoint(rng, node, true);\n\t\t\t\t\tself._moveEndPoint(rng, node);\n\t\t\t\t}\n\n\t\t\t\tself.setRng(rng);\n\t\t\t}\n\n\t\t\treturn node;\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the selection range is collapsed or not. Collapsed means if it's a caret or a larger selection.\n\t\t *\n\t\t * @method isCollapsed\n\t\t * @return {Boolean} true/false state if the selection range is collapsed or not.\n\t\t * Collapsed means if it's a caret or a larger selection.\n\t\t */\n\t\tisCollapsed: function() {\n\t\t\tvar self = this, rng = self.getRng(), sel = self.getSel();\n\n\t\t\tif (!rng || rng.item) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (rng.compareEndPoints) {\n\t\t\t\treturn rng.compareEndPoints('StartToEnd', rng) === 0;\n\t\t\t}\n\n\t\t\treturn !sel || rng.collapsed;\n\t\t},\n\n\t\t/**\n\t\t * Collapse the selection to start or end of range.\n\t\t *\n\t\t * @method collapse\n\t\t * @param {Boolean} toStart Optional boolean state if to collapse to end or not. Defaults to false.\n\t\t */\n\t\tcollapse: function(toStart) {\n\t\t\tvar self = this, rng = self.getRng(), node;\n\n\t\t\t// Control range on IE\n\t\t\tif (rng.item) {\n\t\t\t\tnode = rng.item(0);\n\t\t\t\trng = self.win.document.body.createTextRange();\n\t\t\t\trng.moveToElementText(node);\n\t\t\t}\n\n\t\t\trng.collapse(!!toStart);\n\t\t\tself.setRng(rng);\n\t\t},\n\n\t\t/**\n\t\t * Returns the browsers internal selection object.\n\t\t *\n\t\t * @method getSel\n\t\t * @return {Selection} Internal browser selection object.\n\t\t */\n\t\tgetSel: function() {\n\t\t\tvar win = this.win;\n\n\t\t\treturn win.getSelection ? win.getSelection() : win.document.selection;\n\t\t},\n\n\t\t/**\n\t\t * Returns the browsers internal range object.\n\t\t *\n\t\t * @method getRng\n\t\t * @param {Boolean} w3c Forces a compatible W3C range on IE.\n\t\t * @return {Range} Internal browser range object.\n\t\t * @see http://www.quirksmode.org/dom/range_intro.html\n\t\t * @see http://www.dotvoid.com/2001/03/using-the-range-object-in-mozilla/\n\t\t */\n\t\tgetRng: function(w3c) {\n\t\t\tvar self = this, selection, rng, elm, doc, ieRng, evt;\n\n\t\t\tfunction tryCompareBoundaryPoints(how, sourceRange, destinationRange) {\n\t\t\t\ttry {\n\t\t\t\t\treturn sourceRange.compareBoundaryPoints(how, destinationRange);\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Gecko throws wrong document exception if the range points\n\t\t\t\t\t// to nodes that where removed from the dom #6690\n\t\t\t\t\t// Browsers should mutate existing DOMRange instances so that they always point\n\t\t\t\t\t// to something in the document this is not the case in Gecko works fine in IE/WebKit/Blink\n\t\t\t\t\t// For performance reasons just return -1\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!self.win) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tdoc = self.win.document;\n\n\t\t\tif (typeof doc === 'undefined' || doc === null) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Use last rng passed from FocusManager if it's available this enables\n\t\t\t// calls to editor.selection.getStart() to work when caret focus is lost on IE\n\t\t\tif (!w3c && self.lastFocusBookmark) {\n\t\t\t\tvar bookmark = self.lastFocusBookmark;\n\n\t\t\t\t// Convert bookmark to range IE 11 fix\n\t\t\t\tif (bookmark.startContainer) {\n\t\t\t\t\trng = doc.createRange();\n\t\t\t\t\trng.setStart(bookmark.startContainer, bookmark.startOffset);\n\t\t\t\t\trng.setEnd(bookmark.endContainer, bookmark.endOffset);\n\t\t\t\t} else {\n\t\t\t\t\trng = bookmark;\n\t\t\t\t}\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\t// Found tridentSel object then we need to use that one\n\t\t\tif (w3c && self.tridentSel) {\n\t\t\t\treturn self.tridentSel.getRangeAt(0);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tif ((selection = self.getSel())) {\n\t\t\t\t\tif (selection.rangeCount > 0) {\n\t\t\t\t\t\trng = selection.getRangeAt(0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng = selection.createRange ? selection.createRange() : doc.createRange();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (ex) {\n\t\t\t\t// IE throws unspecified error here if TinyMCE is placed in a frame/iframe\n\t\t\t}\n\n\t\t\tevt = self.editor.fire('GetSelectionRange', {range: rng});\n\t\t\tif (evt.range !== rng) {\n\t\t\t\treturn evt.range;\n\t\t\t}\n\n\t\t\t// We have W3C ranges and it's IE then fake control selection since IE9 doesn't handle that correctly yet\n\t\t\t// IE 11 doesn't support the selection object so we check for that as well\n\t\t\tif (isIE && rng && rng.setStart && doc.selection) {\n\t\t\t\ttry {\n\t\t\t\t\t// IE will sometimes throw an exception here\n\t\t\t\t\tieRng = doc.selection.createRange();\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Ignore\n\t\t\t\t}\n\n\t\t\t\tif (ieRng && ieRng.item) {\n\t\t\t\t\telm = ieRng.item(0);\n\t\t\t\t\trng = doc.createRange();\n\t\t\t\t\trng.setStartBefore(elm);\n\t\t\t\t\trng.setEndAfter(elm);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// No range found then create an empty one\n\t\t\t// This can occur when the editor is placed in a hidden container element on Gecko\n\t\t\t// Or on IE when there was an exception\n\t\t\tif (!rng) {\n\t\t\t\trng = doc.createRange ? doc.createRange() : doc.body.createTextRange();\n\t\t\t}\n\n\t\t\t// If range is at start of document then move it to start of body\n\t\t\tif (rng.setStart && rng.startContainer.nodeType === 9 && rng.collapsed) {\n\t\t\t\telm = self.dom.getRoot();\n\t\t\t\trng.setStart(elm, 0);\n\t\t\t\trng.setEnd(elm, 0);\n\t\t\t}\n\n\t\t\tif (self.selectedRange && self.explicitRange) {\n\t\t\t\tif (tryCompareBoundaryPoints(rng.START_TO_START, rng, self.selectedRange) === 0 &&\n\t\t\t\t\ttryCompareBoundaryPoints(rng.END_TO_END, rng, self.selectedRange) === 0) {\n\t\t\t\t\t// Safari, Opera and Chrome only ever select text which causes the range to change.\n\t\t\t\t\t// This lets us use the originally set range if the selection hasn't been changed by the user.\n\t\t\t\t\trng = self.explicitRange;\n\t\t\t\t} else {\n\t\t\t\t\tself.selectedRange = null;\n\t\t\t\t\tself.explicitRange = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn rng;\n\t\t},\n\n\t\t/**\n\t\t * Changes the selection to the specified DOM range.\n\t\t *\n\t\t * @method setRng\n\t\t * @param {Range} rng Range to select.\n\t\t * @param {Boolean} forward Optional boolean if the selection is forwards or backwards.\n\t\t */\n\t\tsetRng: function(rng, forward) {\n\t\t\tvar self = this, sel, node, evt;\n\n\t\t\tif (!rng) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Is IE specific range\n\t\t\tif (rng.select) {\n\t\t\t\tself.explicitRange = null;\n\n\t\t\t\ttry {\n\t\t\t\t\trng.select();\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Needed for some odd IE bug #1843306\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!self.tridentSel) {\n\t\t\t\tsel = self.getSel();\n\n\t\t\t\tevt = self.editor.fire('SetSelectionRange', {range: rng});\n\t\t\t\trng = evt.range;\n\n\t\t\t\tif (sel) {\n\t\t\t\t\tself.explicitRange = rng;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tsel.removeAllRanges();\n\t\t\t\t\t\tsel.addRange(rng);\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// IE might throw errors here if the editor is within a hidden container and selection is changed\n\t\t\t\t\t}\n\n\t\t\t\t\t// Forward is set to false and we have an extend function\n\t\t\t\t\tif (forward === false && sel.extend) {\n\t\t\t\t\t\tsel.collapse(rng.endContainer, rng.endOffset);\n\t\t\t\t\t\tsel.extend(rng.startContainer, rng.startOffset);\n\t\t\t\t\t}\n\n\t\t\t\t\t// adding range isn't always successful so we need to check range count otherwise an exception can occur\n\t\t\t\t\tself.selectedRange = sel.rangeCount > 0 ? sel.getRangeAt(0) : null;\n\t\t\t\t}\n\n\t\t\t\t// WebKit egde case selecting images works better using setBaseAndExtent when the image is floated\n\t\t\t\tif (!rng.collapsed && rng.startContainer == rng.endContainer && sel.setBaseAndExtent && !Env.ie) {\n\t\t\t\t\tif (rng.endOffset - rng.startOffset < 2) {\n\t\t\t\t\t\tif (rng.startContainer.hasChildNodes()) {\n\t\t\t\t\t\t\tnode = rng.startContainer.childNodes[rng.startOffset];\n\t\t\t\t\t\t\tif (node && node.tagName == 'IMG') {\n\t\t\t\t\t\t\t\tsel.setBaseAndExtent(\n\t\t\t\t\t\t\t\t\trng.startContainer,\n\t\t\t\t\t\t\t\t\trng.startOffset,\n\t\t\t\t\t\t\t\t\trng.endContainer,\n\t\t\t\t\t\t\t\t\trng.endOffset\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t// Since the setBaseAndExtent is fixed in more recent Blink versions we\n\t\t\t\t\t\t\t\t// need to detect if it's doing the wrong thing and falling back to the\n\t\t\t\t\t\t\t\t// crazy incorrect behavior api call since that seems to be the only way\n\t\t\t\t\t\t\t\t// to get it to work on Safari WebKit as of 2017-02-23\n\t\t\t\t\t\t\t\tif (sel.anchorNode !== rng.startContainer || sel.focusNode !== rng.endContainer) {\n\t\t\t\t\t\t\t\t\tsel.setBaseAndExtent(node, 0, node, 1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tself.editor.fire('AfterSetSelectionRange', {range: rng});\n\t\t\t} else {\n\t\t\t\t// Is W3C Range fake range on IE\n\t\t\t\tif (rng.cloneRange) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tself.tridentSel.addRange(rng);\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t//IE9 throws an error here if called before selection is placed in the editor\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Sets the current selection to the specified DOM element.\n\t\t *\n\t\t * @method setNode\n\t\t * @param {Element} elm Element to set as the contents of the selection.\n\t\t * @return {Element} Returns the element that got passed in.\n\t\t * @example\n\t\t * // Inserts a DOM node at current selection/caret location\n\t\t * tinymce.activeEditor.selection.setNode(tinymce.activeEditor.dom.create('img', {src: 'some.gif', title: 'some title'}));\n\t\t */\n\t\tsetNode: function(elm) {\n\t\t\tvar self = this;\n\n\t\t\tself.setContent(self.dom.getOuterHTML(elm));\n\n\t\t\treturn elm;\n\t\t},\n\n\t\t/**\n\t\t * Returns the currently selected element or the common ancestor element for both start and end of the selection.\n\t\t *\n\t\t * @method getNode\n\t\t * @return {Element} Currently selected element or common ancestor element.\n\t\t * @example\n\t\t * // Alerts the currently selected elements node name\n\t\t * alert(tinymce.activeEditor.selection.getNode().nodeName);\n\t\t */\n\t\tgetNode: function() {\n\t\t\tvar self = this, rng = self.getRng(), elm;\n\t\t\tvar startContainer, endContainer, startOffset, endOffset, root = self.dom.getRoot();\n\n\t\t\tfunction skipEmptyTextNodes(node, forwards) {\n\t\t\t\tvar orig = node;\n\n\t\t\t\twhile (node && node.nodeType === 3 && node.length === 0) {\n\t\t\t\t\tnode = forwards ? node.nextSibling : node.previousSibling;\n\t\t\t\t}\n\n\t\t\t\treturn node || orig;\n\t\t\t}\n\n\t\t\t// Range maybe lost after the editor is made visible again\n\t\t\tif (!rng) {\n\t\t\t\treturn root;\n\t\t\t}\n\n\t\t\tstartContainer = rng.startContainer;\n\t\t\tendContainer = rng.endContainer;\n\t\t\tstartOffset = rng.startOffset;\n\t\t\tendOffset = rng.endOffset;\n\n\t\t\tif (rng.setStart) {\n\t\t\t\telm = rng.commonAncestorContainer;\n\n\t\t\t\t// Handle selection a image or other control like element such as anchors\n\t\t\t\tif (!rng.collapsed) {\n\t\t\t\t\tif (startContainer == endContainer) {\n\t\t\t\t\t\tif (endOffset - startOffset < 2) {\n\t\t\t\t\t\t\tif (startContainer.hasChildNodes()) {\n\t\t\t\t\t\t\t\telm = startContainer.childNodes[startOffset];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// If the anchor node is a element instead of a text node then return this element\n\t\t\t\t\t//if (tinymce.isWebKit && sel.anchorNode && sel.anchorNode.nodeType == 1)\n\t\t\t\t\t//\treturn sel.anchorNode.childNodes[sel.anchorOffset];\n\n\t\t\t\t\t// Handle cases where the selection is immediately wrapped around a node and return that node instead of it's parent.\n\t\t\t\t\t// This happens when you double click an underlined word in FireFox.\n\t\t\t\t\tif (startContainer.nodeType === 3 && endContainer.nodeType === 3) {\n\t\t\t\t\t\tif (startContainer.length === startOffset) {\n\t\t\t\t\t\t\tstartContainer = skipEmptyTextNodes(startContainer.nextSibling, true);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstartContainer = startContainer.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (endOffset === 0) {\n\t\t\t\t\t\t\tendContainer = skipEmptyTextNodes(endContainer.previousSibling, false);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tendContainer = endContainer.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (startContainer && startContainer === endContainer) {\n\t\t\t\t\t\t\treturn startContainer;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (elm && elm.nodeType == 3) {\n\t\t\t\t\treturn elm.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn elm;\n\t\t\t}\n\n\t\t\telm = rng.item ? rng.item(0) : rng.parentElement();\n\n\t\t\t// IE 7 might return elements outside the iframe\n\t\t\tif (elm.ownerDocument !== self.win.document) {\n\t\t\t\telm = root;\n\t\t\t}\n\n\t\t\treturn elm;\n\t\t},\n\n\t\tgetSelectedBlocks: function(startElm, endElm) {\n\t\t\tvar self = this, dom = self.dom, node, root, selectedBlocks = [];\n\n\t\t\troot = dom.getRoot();\n\t\t\tstartElm = dom.getParent(startElm || self.getStart(), dom.isBlock);\n\t\t\tendElm = dom.getParent(endElm || self.getEnd(), dom.isBlock);\n\n\t\t\tif (startElm && startElm != root) {\n\t\t\t\tselectedBlocks.push(startElm);\n\t\t\t}\n\n\t\t\tif (startElm && endElm && startElm != endElm) {\n\t\t\t\tnode = startElm;\n\n\t\t\t\tvar walker = new TreeWalker(startElm, root);\n\t\t\t\twhile ((node = walker.next()) && node != endElm) {\n\t\t\t\t\tif (dom.isBlock(node)) {\n\t\t\t\t\t\tselectedBlocks.push(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (endElm && startElm != endElm && endElm != root) {\n\t\t\t\tselectedBlocks.push(endElm);\n\t\t\t}\n\n\t\t\treturn selectedBlocks;\n\t\t},\n\n\t\tisForward: function() {\n\t\t\tvar dom = this.dom, sel = this.getSel(), anchorRange, focusRange;\n\n\t\t\t// No support for selection direction then always return true\n\t\t\tif (!sel || !sel.anchorNode || !sel.focusNode) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tanchorRange = dom.createRng();\n\t\t\tanchorRange.setStart(sel.anchorNode, sel.anchorOffset);\n\t\t\tanchorRange.collapse(true);\n\n\t\t\tfocusRange = dom.createRng();\n\t\t\tfocusRange.setStart(sel.focusNode, sel.focusOffset);\n\t\t\tfocusRange.collapse(true);\n\n\t\t\treturn anchorRange.compareBoundaryPoints(anchorRange.START_TO_START, focusRange) <= 0;\n\t\t},\n\n\t\tnormalize: function() {\n\t\t\tvar self = this, rng = self.getRng();\n\n\t\t\tif (Env.range && new RangeUtils(self.dom).normalize(rng)) {\n\t\t\t\tself.setRng(rng, self.isForward());\n\t\t\t}\n\n\t\t\treturn rng;\n\t\t},\n\n\t\t/**\n\t\t * Executes callback when the current selection starts/stops matching the specified selector. The current\n\t\t * state will be passed to the callback as it's first argument.\n\t\t *\n\t\t * @method selectorChanged\n\t\t * @param {String} selector CSS selector to check for.\n\t\t * @param {function} callback Callback with state and args when the selector is matches or not.\n\t\t */\n\t\tselectorChanged: function(selector, callback) {\n\t\t\tvar self = this, currentSelectors;\n\n\t\t\tif (!self.selectorChangedData) {\n\t\t\t\tself.selectorChangedData = {};\n\t\t\t\tcurrentSelectors = {};\n\n\t\t\t\tself.editor.on('NodeChange', function(e) {\n\t\t\t\t\tvar node = e.element, dom = self.dom, parents = dom.getParents(node, null, dom.getRoot()), matchedSelectors = {};\n\n\t\t\t\t\t// Check for new matching selectors\n\t\t\t\t\teach(self.selectorChangedData, function(callbacks, selector) {\n\t\t\t\t\t\teach(parents, function(node) {\n\t\t\t\t\t\t\tif (dom.is(node, selector)) {\n\t\t\t\t\t\t\t\tif (!currentSelectors[selector]) {\n\t\t\t\t\t\t\t\t\t// Execute callbacks\n\t\t\t\t\t\t\t\t\teach(callbacks, function(callback) {\n\t\t\t\t\t\t\t\t\t\tcallback(true, {node: node, selector: selector, parents: parents});\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tcurrentSelectors[selector] = callbacks;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tmatchedSelectors[selector] = callbacks;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\t// Check if current selectors still match\n\t\t\t\t\teach(currentSelectors, function(callbacks, selector) {\n\t\t\t\t\t\tif (!matchedSelectors[selector]) {\n\t\t\t\t\t\t\tdelete currentSelectors[selector];\n\n\t\t\t\t\t\t\teach(callbacks, function(callback) {\n\t\t\t\t\t\t\t\tcallback(false, {node: node, selector: selector, parents: parents});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Add selector listeners\n\t\t\tif (!self.selectorChangedData[selector]) {\n\t\t\t\tself.selectorChangedData[selector] = [];\n\t\t\t}\n\n\t\t\tself.selectorChangedData[selector].push(callback);\n\n\t\t\treturn self;\n\t\t},\n\n\t\tgetScrollContainer: function() {\n\t\t\tvar scrollContainer, node = this.dom.getRoot();\n\n\t\t\twhile (node && node.nodeName != 'BODY') {\n\t\t\t\tif (node.scrollHeight > node.clientHeight) {\n\t\t\t\t\tscrollContainer = node;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\treturn scrollContainer;\n\t\t},\n\n\t\tscrollIntoView: function(elm, alignToTop) {\n\t\t\tvar y, viewPort, self = this, dom = self.dom, root = dom.getRoot(), viewPortY, viewPortH, offsetY = 0;\n\n\t\t\tfunction getPos(elm) {\n\t\t\t\tvar x = 0, y = 0;\n\n\t\t\t\tvar offsetParent = elm;\n\t\t\t\twhile (offsetParent && offsetParent.nodeType) {\n\t\t\t\t\tx += offsetParent.offsetLeft || 0;\n\t\t\t\t\ty += offsetParent.offsetTop || 0;\n\t\t\t\t\toffsetParent = offsetParent.offsetParent;\n\t\t\t\t}\n\n\t\t\t\treturn {x: x, y: y};\n\t\t\t}\n\n\t\t\tif (!NodeType.isElement(elm)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (alignToTop === false) {\n\t\t\t\toffsetY = elm.offsetHeight;\n\t\t\t}\n\n\t\t\tif (root.nodeName != 'BODY') {\n\t\t\t\tvar scrollContainer = self.getScrollContainer();\n\t\t\t\tif (scrollContainer) {\n\t\t\t\t\ty = getPos(elm).y - getPos(scrollContainer).y + offsetY;\n\t\t\t\t\tviewPortH = scrollContainer.clientHeight;\n\t\t\t\t\tviewPortY = scrollContainer.scrollTop;\n\t\t\t\t\tif (y < viewPortY || y + 25 > viewPortY + viewPortH) {\n\t\t\t\t\t\tscrollContainer.scrollTop = y < viewPortY ? y : y - viewPortH + 25;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tviewPort = dom.getViewPort(self.editor.getWin());\n\t\t\ty = dom.getPos(elm).y + offsetY;\n\t\t\tviewPortY = viewPort.y;\n\t\t\tviewPortH = viewPort.h;\n\t\t\tif (y < viewPort.y || y + 25 > viewPortY + viewPortH) {\n\t\t\t\tself.editor.getWin().scrollTo(0, y < viewPortY ? y : y - viewPortH + 25);\n\t\t\t}\n\t\t},\n\n\t\tplaceCaretAt: function(clientX, clientY) {\n\t\t\tthis.setRng(RangeUtils.getCaretRangeFromPoint(clientX, clientY, this.editor.getDoc()));\n\t\t},\n\n\t\t_moveEndPoint: function(rng, node, start) {\n\t\t\tvar root = node, walker = new TreeWalker(node, root);\n\t\t\tvar nonEmptyElementsMap = this.dom.schema.getNonEmptyElements();\n\n\t\t\tdo {\n\t\t\t\t// Text node\n\t\t\t\tif (node.nodeType == 3 && trim(node.nodeValue).length !== 0) {\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\trng.setStart(node, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng.setEnd(node, node.nodeValue.length);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// BR/IMG/INPUT elements but not table cells\n\t\t\t\tif (nonEmptyElementsMap[node.nodeName] && !/^(TD|TH)$/.test(node.nodeName)) {\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\trng.setStartBefore(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (node.nodeName == 'BR') {\n\t\t\t\t\t\t\trng.setEndBefore(node);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setEndAfter(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Found empty text block old IE can place the selection inside those\n\t\t\t\tif (Env.ie && Env.ie < 11 && this.dom.isBlock(node) && this.dom.isEmpty(node)) {\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\trng.setStart(node, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng.setEnd(node, 0);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} while ((node = (start ? walker.next() : walker.prev())));\n\n\t\t\t// Failed to find any text node or other suitable location then move to the root of body\n\t\t\tif (root.nodeName == 'BODY') {\n\t\t\t\tif (start) {\n\t\t\t\t\trng.setStart(root, 0);\n\t\t\t\t} else {\n\t\t\t\t\trng.setEnd(root, root.childNodes.length);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tgetBoundingClientRect:  function() {\n\t\t\tvar rng = this.getRng();\n\t\t\treturn rng.collapsed ? CaretPosition.fromRangeStart(rng).getClientRects()[0] : rng.getBoundingClientRect();\n\t\t},\n\n\t\tdestroy: function() {\n\t\t\tthis.win = null;\n\t\t\tthis.controlSelection.destroy();\n\t\t}\n\t};\n\n\treturn Selection;\n});\n\n// Included from: js/tinymce/classes/dom/ElementUtils.js\n\n/**\n * ElementUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility class for various element specific functions.\n *\n * @private\n * @class tinymce.dom.ElementUtils\n */\ndefine(\"tinymce/dom/ElementUtils\", [\n\t\"tinymce/dom/BookmarkManager\",\n\t\"tinymce/util/Tools\"\n], function(BookmarkManager, Tools) {\n\tvar each = Tools.each;\n\n\tfunction ElementUtils(dom) {\n\t\t/**\n\t\t * Compares two nodes and checks if it's attributes and styles matches.\n\t\t * This doesn't compare classes as items since their order is significant.\n\t\t *\n\t\t * @method compare\n\t\t * @param {Node} node1 First node to compare with.\n\t\t * @param {Node} node2 Second node to compare with.\n\t\t * @return {boolean} True/false if the nodes are the same or not.\n\t\t */\n\t\tthis.compare = function(node1, node2) {\n\t\t\t// Not the same name\n\t\t\tif (node1.nodeName != node2.nodeName) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Returns all the nodes attributes excluding internal ones, styles and classes.\n\t\t\t *\n\t\t\t * @private\n\t\t\t * @param {Node} node Node to get attributes from.\n\t\t\t * @return {Object} Name/value object with attributes and attribute values.\n\t\t\t */\n\t\t\tfunction getAttribs(node) {\n\t\t\t\tvar attribs = {};\n\n\t\t\t\teach(dom.getAttribs(node), function(attr) {\n\t\t\t\t\tvar name = attr.nodeName.toLowerCase();\n\n\t\t\t\t\t// Don't compare internal attributes or style\n\t\t\t\t\tif (name.indexOf('_') !== 0 && name !== 'style' && name.indexOf('data-') !== 0) {\n\t\t\t\t\t\tattribs[name] = dom.getAttrib(node, name);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn attribs;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Compares two objects checks if it's key + value exists in the other one.\n\t\t\t *\n\t\t\t * @private\n\t\t\t * @param {Object} obj1 First object to compare.\n\t\t\t * @param {Object} obj2 Second object to compare.\n\t\t\t * @return {boolean} True/false if the objects matches or not.\n\t\t\t */\n\t\t\tfunction compareObjects(obj1, obj2) {\n\t\t\t\tvar value, name;\n\n\t\t\t\tfor (name in obj1) {\n\t\t\t\t\t// Obj1 has item obj2 doesn't have\n\t\t\t\t\tif (obj1.hasOwnProperty(name)) {\n\t\t\t\t\t\tvalue = obj2[name];\n\n\t\t\t\t\t\t// Obj2 doesn't have obj1 item\n\t\t\t\t\t\tif (typeof value == \"undefined\") {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Obj2 item has a different value\n\t\t\t\t\t\tif (obj1[name] != value) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Delete similar value\n\t\t\t\t\t\tdelete obj2[name];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Check if obj 2 has something obj 1 doesn't have\n\t\t\t\tfor (name in obj2) {\n\t\t\t\t\t// Obj2 has item obj1 doesn't have\n\t\t\t\t\tif (obj2.hasOwnProperty(name)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Attribs are not the same\n\t\t\tif (!compareObjects(getAttribs(node1), getAttribs(node2))) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Styles are not the same\n\t\t\tif (!compareObjects(dom.parseStyle(dom.getAttrib(node1, 'style')), dom.parseStyle(dom.getAttrib(node2, 'style')))) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn !BookmarkManager.isBookmarkNode(node1) && !BookmarkManager.isBookmarkNode(node2);\n\t\t};\n\t}\n\n\treturn ElementUtils;\n});\n\n// Included from: js/tinymce/classes/fmt/Preview.js\n\n/**\n * Preview.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Internal class for generating previews styles for formats.\n *\n * Example:\n *  Preview.getCssText(editor, 'bold');\n *\n * @private\n * @class tinymce.fmt.Preview\n */\ndefine(\"tinymce/fmt/Preview\", [\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/html/Schema\"\n], function(DOMUtils, Tools, Schema) {\n\tvar each = Tools.each;\n\tvar dom = DOMUtils.DOM;\n\n\tfunction parsedSelectorToHtml(ancestry, editor) {\n\t\tvar elm, item, fragment;\n\t\tvar schema = editor && editor.schema || new Schema({});\n\n\t\tfunction decorate(elm, item) {\n\t\t\tif (item.classes.length) {\n\t\t\t\tdom.addClass(elm, item.classes.join(' '));\n\t\t\t}\n\t\t\tdom.setAttribs(elm, item.attrs);\n\t\t}\n\n\t\tfunction createElement(sItem) {\n\t\t\tvar elm;\n\n\t\t\titem = typeof sItem === 'string' ? {\n\t\t\t\tname: sItem,\n\t\t\t\tclasses: [],\n\t\t\t\tattrs: {}\n\t\t\t} : sItem;\n\n\t\t\telm = dom.create(item.name);\n\t\t\tdecorate(elm, item);\n\t\t\treturn elm;\n\t\t}\n\n\t\tfunction getRequiredParent(elm, candidate) {\n\t\t\tvar name = typeof elm !== 'string' ? elm.nodeName.toLowerCase() : elm;\n\t\t\tvar elmRule = schema.getElementRule(name);\n\t\t\tvar parentsRequired = elmRule.parentsRequired;\n\n\t\t\tif (parentsRequired && parentsRequired.length) {\n\t\t\t\treturn candidate && Tools.inArray(parentsRequired, candidate) !== -1 ? candidate : parentsRequired[0];\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfunction wrapInHtml(elm, ancestry, siblings) {\n\t\t\tvar parent, parentCandidate, parentRequired;\n\t\t\tvar ancestor = ancestry.length && ancestry[0];\n\t\t\tvar ancestorName = ancestor && ancestor.name;\n\n\t\t\tparentRequired = getRequiredParent(elm, ancestorName);\n\n\t\t\tif (parentRequired) {\n\t\t\t\tif (ancestorName == parentRequired) {\n\t\t\t\t\tparentCandidate = ancestry[0];\n\t\t\t\t\tancestry = ancestry.slice(1);\n\t\t\t\t} else {\n\t\t\t\t\tparentCandidate = parentRequired;\n\t\t\t\t}\n\t\t\t} else if (ancestor) {\n\t\t\t\tparentCandidate = ancestry[0];\n\t\t\t\tancestry = ancestry.slice(1);\n\t\t\t} else if (!siblings) {\n\t\t\t\treturn elm;\n\t\t\t}\n\n\t\t\tif (parentCandidate) {\n\t\t\t\tparent = createElement(parentCandidate);\n\t\t\t\tparent.appendChild(elm);\n\t\t\t}\n\n\t\t\tif (siblings) {\n\t\t\t\tif (!parent) {\n\t\t\t\t\t// if no more ancestry, wrap in generic div\n\t\t\t\t\tparent = dom.create('div');\n\t\t\t\t\tparent.appendChild(elm);\n\t\t\t\t}\n\n\t\t\t\tTools.each(siblings, function(sibling) {\n\t\t\t\t\tvar siblingElm = createElement(sibling);\n\t\t\t\t\tparent.insertBefore(siblingElm, elm);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn wrapInHtml(parent, ancestry, parentCandidate && parentCandidate.siblings);\n\t\t}\n\n\t\tif (ancestry && ancestry.length) {\n\t\t\titem = ancestry[0];\n\t\t\telm = createElement(item);\n\t\t\tfragment = dom.create('div');\n\t\t\tfragment.appendChild(wrapInHtml(elm, ancestry.slice(1), item.siblings));\n\t\t\treturn fragment;\n\t\t} else {\n\t\t\treturn '';\n\t\t}\n\t}\n\n\n\tfunction selectorToHtml(selector, editor) {\n\t\treturn parsedSelectorToHtml(parseSelector(selector), editor);\n\t}\n\n\n\tfunction parseSelectorItem(item) {\n\t\tvar tagName;\n\t\tvar obj = {\n\t\t\tclasses: [],\n\t\t\tattrs: {}\n\t\t};\n\n\t\titem = obj.selector = Tools.trim(item);\n\n\t\tif (item !== '*') {\n\t\t\t// matching IDs, CLASSes, ATTRIBUTES and PSEUDOs\n\t\t\ttagName = item.replace(/(?:([#\\.]|::?)([\\w\\-]+)|(\\[)([^\\]]+)\\]?)/g, function($0, $1, $2, $3, $4) {\n\t\t\t\tswitch ($1) {\n\t\t\t\t\tcase '#':\n\t\t\t\t\t\tobj.attrs.id = $2;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase '.':\n\t\t\t\t\t\tobj.classes.push($2);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase ':':\n\t\t\t\t\t\tif (Tools.inArray('checked disabled enabled read-only required'.split(' '), $2) !== -1) {\n\t\t\t\t\t\t\tobj.attrs[$2] = $2;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// atribute matched\n\t\t\t\tif ($3 == '[') {\n\t\t\t\t\tvar m = $4.match(/([\\w\\-]+)(?:\\=\\\"([^\\\"]+))?/);\n\t\t\t\t\tif (m) {\n\t\t\t\t\t\tobj.attrs[m[1]] = m[2];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn '';\n\t\t\t});\n\t\t}\n\n\t\tobj.name = tagName || 'div';\n\t\treturn obj;\n\t}\n\n\n\tfunction parseSelector(selector) {\n\t\tif (!selector || typeof selector !== 'string') {\n\t\t\treturn [];\n\t\t}\n\n\t\t// take into account only first one\n\t\tselector = selector.split(/\\s*,\\s*/)[0];\n\n\t\t// tighten\n\t\tselector = selector.replace(/\\s*(~\\+|~|\\+|>)\\s*/g, '$1');\n\n\t\t// split either on > or on space, but not the one inside brackets\n\t\treturn Tools.map(selector.split(/(?:>|\\s+(?![^\\[\\]]+\\]))/), function(item) {\n\t\t\t// process each sibling selector separately\n\t\t\tvar siblings = Tools.map(item.split(/(?:~\\+|~|\\+)/), parseSelectorItem);\n\t\t\tvar obj = siblings.pop(); // the last one is our real target\n\n\t\t\tif (siblings.length) {\n\t\t\t\tobj.siblings = siblings;\n\t\t\t}\n\t\t\treturn obj;\n\t\t}).reverse();\n\t}\n\n\n\tfunction getCssText(editor, format) {\n\t\tvar name, previewFrag, previewElm, items;\n\t\tvar previewCss = '', parentFontSize, previewStyles;\n\n\t\tpreviewStyles = editor.settings.preview_styles;\n\n\t\t// No preview forced\n\t\tif (previewStyles === false) {\n\t\t\treturn '';\n\t\t}\n\n\t\t// Default preview\n\t\tif (typeof previewStyles !== 'string') {\n\t\t\tpreviewStyles = 'font-family font-size font-weight font-style text-decoration ' +\n\t\t\t\t'text-transform color background-color border border-radius outline text-shadow';\n\t\t}\n\n\t\t// Removes any variables since these can't be previewed\n\t\tfunction removeVars(val) {\n\t\t\treturn val.replace(/%(\\w+)/g, '');\n\t\t}\n\n\t\t// Create block/inline element to use for preview\n\t\tif (typeof format == \"string\") {\n\t\t\tformat = editor.formatter.get(format);\n\t\t\tif (!format) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tformat = format[0];\n\t\t}\n\n\t\t// Format specific preview override\n\t\t// TODO: This should probably be further reduced by the previewStyles option\n\t\tif ('preview' in format) {\n\t\t\tpreviewStyles = format.preview;\n\t\t\tif (previewStyles === false) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\n\t\tname = format.block || format.inline || 'span';\n\n\t\titems = parseSelector(format.selector);\n\t\tif (items.length) {\n\t\t\tif (!items[0].name) { // e.g. something like ul > .someClass was provided\n\t\t\t\titems[0].name = name;\n\t\t\t}\n\t\t\tname = format.selector;\n\t\t\tpreviewFrag = parsedSelectorToHtml(items, editor);\n\t\t} else {\n\t\t\tpreviewFrag = parsedSelectorToHtml([name], editor);\n\t\t}\n\n\t\tpreviewElm = dom.select(name, previewFrag)[0] || previewFrag.firstChild;\n\n\t\t// Add format styles to preview element\n\t\teach(format.styles, function(value, name) {\n\t\t\tvalue = removeVars(value);\n\n\t\t\tif (value) {\n\t\t\t\tdom.setStyle(previewElm, name, value);\n\t\t\t}\n\t\t});\n\n\t\t// Add attributes to preview element\n\t\teach(format.attributes, function(value, name) {\n\t\t\tvalue = removeVars(value);\n\n\t\t\tif (value) {\n\t\t\t\tdom.setAttrib(previewElm, name, value);\n\t\t\t}\n\t\t});\n\n\t\t// Add classes to preview element\n\t\teach(format.classes, function(value) {\n\t\t\tvalue = removeVars(value);\n\n\t\t\tif (!dom.hasClass(previewElm, value)) {\n\t\t\t\tdom.addClass(previewElm, value);\n\t\t\t}\n\t\t});\n\n\t\teditor.fire('PreviewFormats');\n\n\t\t// Add the previewElm outside the visual area\n\t\tdom.setStyles(previewFrag, {position: 'absolute', left: -0xFFFF});\n\t\teditor.getBody().appendChild(previewFrag);\n\n\t\t// Get parent container font size so we can compute px values out of em/% for older IE:s\n\t\tparentFontSize = dom.getStyle(editor.getBody(), 'fontSize', true);\n\t\tparentFontSize = /px$/.test(parentFontSize) ? parseInt(parentFontSize, 10) : 0;\n\n\t\teach(previewStyles.split(' '), function(name) {\n\t\t\tvar value = dom.getStyle(previewElm, name, true);\n\n\t\t\t// If background is transparent then check if the body has a background color we can use\n\t\t\tif (name == 'background-color' && /transparent|rgba\\s*\\([^)]+,\\s*0\\)/.test(value)) {\n\t\t\t\tvalue = dom.getStyle(editor.getBody(), name, true);\n\n\t\t\t\t// Ignore white since it's the default color, not the nicest fix\n\t\t\t\t// TODO: Fix this by detecting runtime style\n\t\t\t\tif (dom.toHex(value).toLowerCase() == '#ffffff') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (name == 'color') {\n\t\t\t\t// Ignore black since it's the default color, not the nicest fix\n\t\t\t\t// TODO: Fix this by detecting runtime style\n\t\t\t\tif (dom.toHex(value).toLowerCase() == '#000000') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Old IE won't calculate the font size so we need to do that manually\n\t\t\tif (name == 'font-size') {\n\t\t\t\tif (/em|%$/.test(value)) {\n\t\t\t\t\tif (parentFontSize === 0) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Convert font size from em/% to px\n\t\t\t\t\tvalue = parseFloat(value, 10) / (/%$/.test(value) ? 100 : 1);\n\t\t\t\t\tvalue = (value * parentFontSize) + 'px';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (name == \"border\" && value) {\n\t\t\t\tpreviewCss += 'padding:0 2px;';\n\t\t\t}\n\n\t\t\tpreviewCss += name + ':' + value + ';';\n\t\t});\n\n\t\teditor.fire('AfterPreviewFormats');\n\n\t\t//previewCss += 'line-height:normal';\n\n\t\tdom.remove(previewFrag);\n\n\t\treturn previewCss;\n\t}\n\n\treturn {\n\t\tgetCssText: getCssText,\n\t\tparseSelector: parseSelector,\n\t\tselectorToHtml: selectorToHtml\n\t};\n});\n\n// Included from: js/tinymce/classes/fmt/Hooks.js\n\n/**\n * Hooks.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Internal class for overriding formatting.\n *\n * @private\n * @class tinymce.fmt.Hooks\n */\ndefine(\"tinymce/fmt/Hooks\", [\n\t\"tinymce/util/Arr\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/DomQuery\"\n], function(Arr, NodeType, $) {\n\tvar postProcessHooks = {}, filter = Arr.filter, each = Arr.each;\n\n\tfunction addPostProcessHook(name, hook) {\n\t\tvar hooks = postProcessHooks[name];\n\n\t\tif (!hooks) {\n\t\t\tpostProcessHooks[name] = hooks = [];\n\t\t}\n\n\t\tpostProcessHooks[name].push(hook);\n\t}\n\n\tfunction postProcess(name, editor) {\n\t\teach(postProcessHooks[name], function(hook) {\n\t\t\thook(editor);\n\t\t});\n\t}\n\n\taddPostProcessHook(\"pre\", function(editor) {\n\t\tvar rng = editor.selection.getRng(), isPre, blocks;\n\n\t\tfunction hasPreSibling(pre) {\n\t\t\treturn isPre(pre.previousSibling) && Arr.indexOf(blocks, pre.previousSibling) != -1;\n\t\t}\n\n\t\tfunction joinPre(pre1, pre2) {\n\t\t\t$(pre2).remove();\n\t\t\t$(pre1).append('<br><br>').append(pre2.childNodes);\n\t\t}\n\n\t\tisPre = NodeType.matchNodeNames('pre');\n\n\t\tif (!rng.collapsed) {\n\t\t\tblocks = editor.selection.getSelectedBlocks();\n\n\t\t\teach(filter(filter(blocks, isPre), hasPreSibling), function(pre) {\n\t\t\t\tjoinPre(pre.previousSibling, pre);\n\t\t\t});\n\t\t}\n\t});\n\n\treturn {\n\t\tpostProcess: postProcess\n\t};\n});\n\n// Included from: js/tinymce/classes/Formatter.js\n\n/**\n * Formatter.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Text formatter engine class. This class is used to apply formats like bold, italic, font size\n * etc to the current selection or specific nodes. This engine was built to replace the browser's\n * default formatting logic for execCommand due to its inconsistent and buggy behavior.\n *\n * @class tinymce.Formatter\n * @example\n *  tinymce.activeEditor.formatter.register('mycustomformat', {\n *    inline: 'span',\n *    styles: {color: '#ff0000'}\n *  });\n *\n *  tinymce.activeEditor.formatter.apply('mycustomformat');\n */\ndefine(\"tinymce/Formatter\", [\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/dom/BookmarkManager\",\n\t\"tinymce/dom/ElementUtils\",\n\t\"tinymce/util/Fun\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/fmt/Preview\",\n\t\"tinymce/fmt/Hooks\"\n], function(TreeWalker, RangeUtils, BookmarkManager, ElementUtils, Fun, Tools, Preview, Hooks) {\n\t/**\n\t * Constructs a new formatter instance.\n\t *\n\t * @constructor Formatter\n\t * @param {tinymce.Editor} ed Editor instance to construct the formatter engine to.\n\t */\n\treturn function(ed) {\n\t\tvar formats = {},\n\t\t\tdom = ed.dom,\n\t\t\tselection = ed.selection,\n\t\t\trangeUtils = new RangeUtils(dom),\n\t\t\tisValid = ed.schema.isValidChild,\n\t\t\tisBlock = dom.isBlock,\n\t\t\tforcedRootBlock = ed.settings.forced_root_block,\n\t\t\tnodeIndex = dom.nodeIndex,\n\t\t\tINVISIBLE_CHAR = '\\uFEFF',\n\t\t\tMCE_ATTR_RE = /^(src|href|style)$/,\n\t\t\tFALSE = false,\n\t\t\tTRUE = true,\n\t\t\tformatChangeData,\n\t\t\tundef,\n\t\t\tgetContentEditable = dom.getContentEditable,\n\t\t\tdisableCaretContainer,\n\t\t\tmarkCaretContainersBogus,\n\t\t\tisBookmarkNode = BookmarkManager.isBookmarkNode;\n\n\t\tvar each = Tools.each,\n\t\t\tgrep = Tools.grep,\n\t\t\twalk = Tools.walk,\n\t\t\textend = Tools.extend;\n\n\t\tfunction isTextBlock(name) {\n\t\t\tif (name.nodeType) {\n\t\t\t\tname = name.nodeName;\n\t\t\t}\n\n\t\t\treturn !!ed.schema.getTextBlockElements()[name.toLowerCase()];\n\t\t}\n\n\t\tfunction isTableCell(node) {\n\t\t\treturn /^(TH|TD)$/.test(node.nodeName);\n\t\t}\n\n\t\tfunction isInlineBlock(node) {\n\t\t\treturn node && /^(IMG)$/.test(node.nodeName);\n\t\t}\n\n\t\tfunction getParents(node, selector) {\n\t\t\treturn dom.getParents(node, selector, dom.getRoot());\n\t\t}\n\n\t\tfunction isCaretNode(node) {\n\t\t\treturn node.nodeType === 1 && node.id === '_mce_caret';\n\t\t}\n\n\t\tfunction defaultFormats() {\n\t\t\tregister({\n\t\t\t\tvaligntop: [\n\t\t\t\t\t{selector: 'td,th', styles: {'verticalAlign': 'top'}}\n\t\t\t\t],\n\n\t\t\t\tvalignmiddle: [\n\t\t\t\t\t{selector: 'td,th', styles: {'verticalAlign': 'middle'}}\n\t\t\t\t],\n\n\t\t\t\tvalignbottom: [\n\t\t\t\t\t{selector: 'td,th', styles: {'verticalAlign': 'bottom'}}\n\t\t\t\t],\n\n\t\t\t\talignleft: [\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'figure.image',\n\t\t\t\t\t\tcollapsed: false,\n\t\t\t\t\t\tclasses: 'align-left',\n\t\t\t\t\t\tceFalseOverride: true,\n\t\t\t\t\t\tpreview: 'font-family font-size'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\ttextAlign: 'left'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinherit: false,\n\t\t\t\t\t\tpreview: false,\n\t\t\t\t\t\tdefaultBlock: 'div'\n\t\t\t\t\t},\n\t\t\t\t\t{selector: 'img,table', collapsed: false, styles: {'float': 'left'}, preview: 'font-family font-size'}\n\t\t\t\t],\n\n\t\t\t\taligncenter: [\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\ttextAlign: 'center'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinherit: false,\n\t\t\t\t\t\tpreview: false,\n\t\t\t\t\t\tdefaultBlock: 'div'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'figure.image',\n\t\t\t\t\t\tcollapsed: false,\n\t\t\t\t\t\tclasses: 'align-center',\n\t\t\t\t\t\tceFalseOverride: true,\n\t\t\t\t\t\tpreview: 'font-family font-size'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'img',\n\t\t\t\t\t\tcollapsed: false,\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\tdisplay: 'block',\n\t\t\t\t\t\t\tmarginLeft: 'auto',\n\t\t\t\t\t\t\tmarginRight: 'auto'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpreview: false\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'table',\n\t\t\t\t\t\tcollapsed: false,\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\tmarginLeft: 'auto',\n\t\t\t\t\t\t\tmarginRight: 'auto'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpreview: 'font-family font-size'\n\t\t\t\t\t}\n\t\t\t\t],\n\n\t\t\t\talignright: [\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'figure.image',\n\t\t\t\t\t\tcollapsed: false,\n\t\t\t\t\t\tclasses: 'align-right',\n\t\t\t\t\t\tceFalseOverride: true,\n\t\t\t\t\t\tpreview: 'font-family font-size'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\ttextAlign: 'right'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinherit: false,\n\t\t\t\t\t\tpreview: 'font-family font-size',\n\t\t\t\t\t\tdefaultBlock: 'div'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'img,table',\n\t\t\t\t\t\tcollapsed: false,\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\t'float': 'right'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpreview: 'font-family font-size'\n\t\t\t\t\t}\n\t\t\t\t],\n\n\t\t\t\talignjustify: [\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\ttextAlign: 'justify'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinherit: false,\n\t\t\t\t\t\tdefaultBlock: 'div',\n\t\t\t\t\t\tpreview: 'font-family font-size'\n\t\t\t\t\t}\n\t\t\t\t],\n\n\t\t\t\tbold: [\n\t\t\t\t\t{inline: 'strong', remove: 'all'},\n\t\t\t\t\t{inline: 'span', styles: {fontWeight: 'bold'}},\n\t\t\t\t\t{inline: 'b', remove: 'all'}\n\t\t\t\t],\n\n\t\t\t\titalic: [\n\t\t\t\t\t{inline: 'em', remove: 'all'},\n\t\t\t\t\t{inline: 'span', styles: {fontStyle: 'italic'}},\n\t\t\t\t\t{inline: 'i', remove: 'all'}\n\t\t\t\t],\n\n\t\t\t\tunderline: [\n\t\t\t\t\t{inline: 'span', styles: {textDecoration: 'underline'}, exact: true},\n\t\t\t\t\t{inline: 'u', remove: 'all'}\n\t\t\t\t],\n\n\t\t\t\tstrikethrough: [\n\t\t\t\t\t{inline: 'span', styles: {textDecoration: 'line-through'}, exact: true},\n\t\t\t\t\t{inline: 'strike', remove: 'all'}\n\t\t\t\t],\n\n\t\t\t\tforecolor: {inline: 'span', styles: {color: '%value'}, links: true, remove_similar: true},\n\t\t\t\thilitecolor: {inline: 'span', styles: {backgroundColor: '%value'}, links: true, remove_similar: true},\n\t\t\t\tfontname: {inline: 'span', styles: {fontFamily: '%value'}},\n\t\t\t\tfontsize: {inline: 'span', styles: {fontSize: '%value'}},\n\t\t\t\tfontsize_class: {inline: 'span', attributes: {'class': '%value'}},\n\t\t\t\tblockquote: {block: 'blockquote', wrapper: 1, remove: 'all'},\n\t\t\t\tsubscript: {inline: 'sub'},\n\t\t\t\tsuperscript: {inline: 'sup'},\n\t\t\t\tcode: {inline: 'code'},\n\n\t\t\t\tlink: {inline: 'a', selector: 'a', remove: 'all', split: true, deep: true,\n\t\t\t\t\tonmatch: function() {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\n\t\t\t\t\tonformat: function(elm, fmt, vars) {\n\t\t\t\t\t\teach(vars, function(value, key) {\n\t\t\t\t\t\t\tdom.setAttrib(elm, key, value);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tremoveformat: [\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins',\n\t\t\t\t\t\tremove: 'all',\n\t\t\t\t\t\tsplit: true,\n\t\t\t\t\t\texpand: false,\n\t\t\t\t\t\tblock_expand: true,\n\t\t\t\t\t\tdeep: true\n\t\t\t\t\t},\n\t\t\t\t\t{selector: 'span', attributes: ['style', 'class'], remove: 'empty', split: true, expand: false, deep: true},\n\t\t\t\t\t{selector: '*', attributes: ['style', 'class'], split: false, expand: false, deep: true}\n\t\t\t\t]\n\t\t\t});\n\n\t\t\t// Register default block formats\n\t\t\teach('p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp'.split(/\\s/), function(name) {\n\t\t\t\tregister(name, {block: name, remove: 'all'});\n\t\t\t});\n\n\t\t\t// Register user defined formats\n\t\t\tregister(ed.settings.formats);\n\t\t}\n\n\t\tfunction addKeyboardShortcuts() {\n\t\t\t// Add some inline shortcuts\n\t\t\ted.addShortcut('meta+b', 'bold_desc', 'Bold');\n\t\t\ted.addShortcut('meta+i', 'italic_desc', 'Italic');\n\t\t\ted.addShortcut('meta+u', 'underline_desc', 'Underline');\n\n\t\t\t// BlockFormat shortcuts keys\n\t\t\tfor (var i = 1; i <= 6; i++) {\n\t\t\t\ted.addShortcut('access+' + i, '', ['FormatBlock', false, 'h' + i]);\n\t\t\t}\n\n\t\t\ted.addShortcut('access+7', '', ['FormatBlock', false, 'p']);\n\t\t\ted.addShortcut('access+8', '', ['FormatBlock', false, 'div']);\n\t\t\ted.addShortcut('access+9', '', ['FormatBlock', false, 'address']);\n\t\t}\n\n\t\t// Public functions\n\n\t\t/**\n\t\t * Returns the format by name or all formats if no name is specified.\n\t\t *\n\t\t * @method get\n\t\t * @param {String} name Optional name to retrieve by.\n\t\t * @return {Array/Object} Array/Object with all registered formats or a specific format.\n\t\t */\n\t\tfunction get(name) {\n\t\t\treturn name ? formats[name] : formats;\n\t\t}\n\n\t\t/**\n\t\t * Registers a specific format by name.\n\t\t *\n\t\t * @method register\n\t\t * @param {Object/String} name Name of the format for example \"bold\".\n\t\t * @param {Object/Array} format Optional format object or array of format variants\n\t\t * can only be omitted if the first arg is an object.\n\t\t */\n\t\tfunction register(name, format) {\n\t\t\tif (name) {\n\t\t\t\tif (typeof name !== 'string') {\n\t\t\t\t\teach(name, function(format, name) {\n\t\t\t\t\t\tregister(name, format);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// Force format into array and add it to internal collection\n\t\t\t\t\tformat = format.length ? format : [format];\n\n\t\t\t\t\teach(format, function(format) {\n\t\t\t\t\t\t// Set deep to false by default on selector formats this to avoid removing\n\t\t\t\t\t\t// alignment on images inside paragraphs when alignment is changed on paragraphs\n\t\t\t\t\t\tif (format.deep === undef) {\n\t\t\t\t\t\t\tformat.deep = !format.selector;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Default to true\n\t\t\t\t\t\tif (format.split === undef) {\n\t\t\t\t\t\t\tformat.split = !format.selector || format.inline;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Default to true\n\t\t\t\t\t\tif (format.remove === undef && format.selector && !format.inline) {\n\t\t\t\t\t\t\tformat.remove = 'none';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Mark format as a mixed format inline + block level\n\t\t\t\t\t\tif (format.selector && format.inline) {\n\t\t\t\t\t\t\tformat.mixed = true;\n\t\t\t\t\t\t\tformat.block_expand = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Split classes if needed\n\t\t\t\t\t\tif (typeof format.classes === 'string') {\n\t\t\t\t\t\t\tformat.classes = format.classes.split(/\\s+/);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tformats[name] = format;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Unregister a specific format by name.\n\t\t *\n\t\t * @method unregister\n\t\t * @param {String} name Name of the format for example \"bold\".\n\t\t */\n\t\tfunction unregister(name) {\n\t\t\tif (name && formats[name]) {\n\t\t\t\tdelete formats[name];\n\t\t\t}\n\n\t\t\treturn formats;\n\t\t}\n\n\t\tfunction matchesUnInheritedFormatSelector(node, name) {\n\t\t\tvar formatList = get(name);\n\n\t\t\tif (formatList) {\n\t\t\t\tfor (var i = 0; i < formatList.length; i++) {\n\t\t\t\t\tif (formatList[i].inherit === false && dom.is(node, formatList[i].selector)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction getTextDecoration(node) {\n\t\t\tvar decoration;\n\n\t\t\ted.dom.getParent(node, function(n) {\n\t\t\t\tdecoration = ed.dom.getStyle(n, 'text-decoration');\n\t\t\t\treturn decoration && decoration !== 'none';\n\t\t\t});\n\n\t\t\treturn decoration;\n\t\t}\n\n\t\tfunction processUnderlineAndColor(node) {\n\t\t\tvar textDecoration;\n\t\t\tif (node.nodeType === 1 && node.parentNode && node.parentNode.nodeType === 1) {\n\t\t\t\ttextDecoration = getTextDecoration(node.parentNode);\n\t\t\t\tif (ed.dom.getStyle(node, 'color') && textDecoration) {\n\t\t\t\t\ted.dom.setStyle(node, 'text-decoration', textDecoration);\n\t\t\t\t} else if (ed.dom.getStyle(node, 'text-decoration') === textDecoration) {\n\t\t\t\t\ted.dom.setStyle(node, 'text-decoration', null);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Applies the specified format to the current selection or specified node.\n\t\t *\n\t\t * @method apply\n\t\t * @param {String} name Name of format to apply.\n\t\t * @param {Object} vars Optional list of variables to replace within format before applying it.\n\t\t * @param {Node} node Optional node to apply the format to defaults to current selection.\n\t\t */\n\t\tfunction apply(name, vars, node) {\n\t\t\tvar formatList = get(name), format = formatList[0], bookmark, rng, isCollapsed = !node && selection.isCollapsed();\n\n\t\t\tfunction setElementFormat(elm, fmt) {\n\t\t\t\tfmt = fmt || format;\n\n\t\t\t\tif (elm) {\n\t\t\t\t\tif (fmt.onformat) {\n\t\t\t\t\t\tfmt.onformat(elm, fmt, vars, node);\n\t\t\t\t\t}\n\n\t\t\t\t\teach(fmt.styles, function(value, name) {\n\t\t\t\t\t\tdom.setStyle(elm, name, replaceVars(value, vars));\n\t\t\t\t\t});\n\n\t\t\t\t\t// Needed for the WebKit span spam bug\n\t\t\t\t\t// TODO: Remove this once WebKit/Blink fixes this\n\t\t\t\t\tif (fmt.styles) {\n\t\t\t\t\t\tvar styleVal = dom.getAttrib(elm, 'style');\n\n\t\t\t\t\t\tif (styleVal) {\n\t\t\t\t\t\t\telm.setAttribute('data-mce-style', styleVal);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\teach(fmt.attributes, function(value, name) {\n\t\t\t\t\t\tdom.setAttrib(elm, name, replaceVars(value, vars));\n\t\t\t\t\t});\n\n\t\t\t\t\teach(fmt.classes, function(value) {\n\t\t\t\t\t\tvalue = replaceVars(value, vars);\n\n\t\t\t\t\t\tif (!dom.hasClass(elm, value)) {\n\t\t\t\t\t\t\tdom.addClass(elm, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction applyNodeStyle(formatList, node) {\n\t\t\t\tvar found = false;\n\n\t\t\t\tif (!format.selector) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Look for matching formats\n\t\t\t\teach(formatList, function(format) {\n\t\t\t\t\t// Check collapsed state if it exists\n\t\t\t\t\tif ('collapsed' in format && format.collapsed !== isCollapsed) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (dom.is(node, format.selector) && !isCaretNode(node)) {\n\t\t\t\t\t\tsetElementFormat(node, format);\n\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn found;\n\t\t\t}\n\n\t\t\t// This converts: <p>[a</p><p>]b</p> -> <p>[a]</p><p>b</p>\n\t\t\tfunction adjustSelectionToVisibleSelection() {\n\t\t\t\tfunction findSelectionEnd(start, end) {\n\t\t\t\t\tvar walker = new TreeWalker(end);\n\t\t\t\t\tfor (node = walker.prev2(); node; node = walker.prev2()) {\n\t\t\t\t\t\tif (node.nodeType == 3 && node.data.length > 0) {\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (node.childNodes.length > 1 || node == start || node.tagName == 'BR') {\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Adjust selection so that a end container with a end offset of zero is not included in the selection\n\t\t\t\t// as this isn't visible to the user.\n\t\t\t\tvar rng = ed.selection.getRng();\n\t\t\t\tvar start = rng.startContainer;\n\t\t\t\tvar end = rng.endContainer;\n\n\t\t\t\tif (start != end && rng.endOffset === 0) {\n\t\t\t\t\tvar newEnd = findSelectionEnd(start, end);\n\t\t\t\t\tvar endOffset = newEnd.nodeType == 3 ? newEnd.data.length : newEnd.childNodes.length;\n\n\t\t\t\t\trng.setEnd(newEnd, endOffset);\n\t\t\t\t}\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\tfunction applyRngStyle(rng, bookmark, node_specific) {\n\t\t\t\tvar newWrappers = [], wrapName, wrapElm, contentEditable = true;\n\n\t\t\t\t// Setup wrapper element\n\t\t\t\twrapName = format.inline || format.block;\n\t\t\t\twrapElm = dom.create(wrapName);\n\t\t\t\tsetElementFormat(wrapElm);\n\n\t\t\t\trangeUtils.walk(rng, function(nodes) {\n\t\t\t\t\tvar currentWrapElm;\n\n\t\t\t\t\t/**\n\t\t\t\t\t * Process a list of nodes wrap them.\n\t\t\t\t\t */\n\t\t\t\t\tfunction process(node) {\n\t\t\t\t\t\tvar nodeName, parentName, hasContentEditableState, lastContentEditable;\n\n\t\t\t\t\t\tlastContentEditable = contentEditable;\n\t\t\t\t\t\tnodeName = node.nodeName.toLowerCase();\n\t\t\t\t\t\tparentName = node.parentNode.nodeName.toLowerCase();\n\n\t\t\t\t\t\t// Node has a contentEditable value\n\t\t\t\t\t\tif (node.nodeType === 1 && getContentEditable(node)) {\n\t\t\t\t\t\t\tlastContentEditable = contentEditable;\n\t\t\t\t\t\t\tcontentEditable = getContentEditable(node) === \"true\";\n\t\t\t\t\t\t\thasContentEditableState = true; // We don't want to wrap the container only it's children\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Stop wrapping on br elements\n\t\t\t\t\t\tif (isEq(nodeName, 'br')) {\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\n\n\t\t\t\t\t\t\t// Remove any br elements when we wrap things\n\t\t\t\t\t\t\tif (format.block) {\n\t\t\t\t\t\t\t\tdom.remove(node);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// If node is wrapper type\n\t\t\t\t\t\tif (format.wrapper && matchNode(node, name, vars)) {\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Can we rename the block\n\t\t\t\t\t\t// TODO: Break this if up, too complex\n\t\t\t\t\t\tif (contentEditable && !hasContentEditableState && format.block &&\n\t\t\t\t\t\t\t!format.wrapper && isTextBlock(nodeName) && isValid(parentName, wrapName)) {\n\t\t\t\t\t\t\tnode = dom.rename(node, wrapName);\n\t\t\t\t\t\t\tsetElementFormat(node);\n\t\t\t\t\t\t\tnewWrappers.push(node);\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Handle selector patterns\n\t\t\t\t\t\tif (format.selector) {\n\t\t\t\t\t\t\tvar found = applyNodeStyle(formatList, node);\n\n\t\t\t\t\t\t\t// Continue processing if a selector match wasn't found and a inline element is defined\n\t\t\t\t\t\t\tif (!format.inline || found) {\n\t\t\t\t\t\t\t\tcurrentWrapElm = 0;\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Is it valid to wrap this item\n\t\t\t\t\t\t// TODO: Break this if up, too complex\n\t\t\t\t\t\tif (contentEditable && !hasContentEditableState && isValid(wrapName, nodeName) && isValid(parentName, wrapName) &&\n\t\t\t\t\t\t\t\t!(!node_specific && node.nodeType === 3 &&\n\t\t\t\t\t\t\t\tnode.nodeValue.length === 1 &&\n\t\t\t\t\t\t\t\tnode.nodeValue.charCodeAt(0) === 65279) &&\n\t\t\t\t\t\t\t\t!isCaretNode(node) &&\n\t\t\t\t\t\t\t\t(!format.inline || !isBlock(node))) {\n\t\t\t\t\t\t\t// Start wrapping\n\t\t\t\t\t\t\tif (!currentWrapElm) {\n\t\t\t\t\t\t\t\t// Wrap the node\n\t\t\t\t\t\t\t\tcurrentWrapElm = dom.clone(wrapElm, FALSE);\n\t\t\t\t\t\t\t\tnode.parentNode.insertBefore(currentWrapElm, node);\n\t\t\t\t\t\t\t\tnewWrappers.push(currentWrapElm);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcurrentWrapElm.appendChild(node);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Start a new wrapper for possible children\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\n\n\t\t\t\t\t\t\teach(grep(node.childNodes), process);\n\n\t\t\t\t\t\t\tif (hasContentEditableState) {\n\t\t\t\t\t\t\t\tcontentEditable = lastContentEditable; // Restore last contentEditable state from stack\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// End the last wrapper\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Process siblings from range\n\t\t\t\t\teach(nodes, process);\n\t\t\t\t});\n\n\t\t\t\t// Apply formats to links as well to get the color of the underline to change as well\n\t\t\t\tif (format.links === true) {\n\t\t\t\t\teach(newWrappers, function(node) {\n\t\t\t\t\t\tfunction process(node) {\n\t\t\t\t\t\t\tif (node.nodeName === 'A') {\n\t\t\t\t\t\t\t\tsetElementFormat(node, format);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\teach(grep(node.childNodes), process);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tprocess(node);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Cleanup\n\t\t\t\teach(newWrappers, function(node) {\n\t\t\t\t\tvar childCount;\n\n\t\t\t\t\tfunction getChildCount(node) {\n\t\t\t\t\t\tvar count = 0;\n\n\t\t\t\t\t\teach(node.childNodes, function(node) {\n\t\t\t\t\t\t\tif (!isWhiteSpaceNode(node) && !isBookmarkNode(node)) {\n\t\t\t\t\t\t\t\tcount++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn count;\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction getChildElementNode(root) {\n\t\t\t\t\t\tvar child = false;\n\t\t\t\t\t\teach(root.childNodes, function(node) {\n\t\t\t\t\t\t\tif (isElementNode(node)) {\n\t\t\t\t\t\t\t\tchild = node;\n\t\t\t\t\t\t\t\treturn false; // break loop\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn child;\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction matchNestedWrapper(node, filter) {\n\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\tif (getChildCount(node) !== 1) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tnode = getChildElementNode(node);\n\t\t\t\t\t\t\tif (!node) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t} else if (filter(node)) {\n\t\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} while (node);\n\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction mergeStyles(node) {\n\t\t\t\t\t\tvar child, clone;\n\n\t\t\t\t\t\tchild = getChildElementNode(node);\n\n\t\t\t\t\t\t// If child was found and of the same type as the current node\n\t\t\t\t\t\tif (child && !isBookmarkNode(child) && matchName(child, format)) {\n\t\t\t\t\t\t\tclone = dom.clone(child, FALSE);\n\t\t\t\t\t\t\tsetElementFormat(clone);\n\n\t\t\t\t\t\t\tdom.replace(clone, node, TRUE);\n\t\t\t\t\t\t\tdom.remove(child, 1);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn clone || node;\n\t\t\t\t\t}\n\n\t\t\t\t\tchildCount = getChildCount(node);\n\n\t\t\t\t\t// Remove empty nodes but only if there is multiple wrappers and they are not block\n\t\t\t\t\t// elements so never remove single <h1></h1> since that would remove the\n\t\t\t\t\t// current empty block element where the caret is at\n\t\t\t\t\tif ((newWrappers.length > 1 || !isBlock(node)) && childCount === 0) {\n\t\t\t\t\t\tdom.remove(node, 1);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (format.inline || format.wrapper) {\n\t\t\t\t\t\t// Merges the current node with it's children of similar type to reduce the number of elements\n\t\t\t\t\t\tif (!format.exact && childCount === 1) {\n\t\t\t\t\t\t\tnode = mergeStyles(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Remove/merge children\n\t\t\t\t\t\teach(formatList, function(format) {\n\t\t\t\t\t\t\t// Merge all children of similar type will move styles from child to parent\n\t\t\t\t\t\t\t// this: <span style=\"color:red\"><b><span style=\"color:red; font-size:10px\">text</span></b></span>\n\t\t\t\t\t\t\t// will become: <span style=\"color:red\"><b><span style=\"font-size:10px\">text</span></b></span>\n\t\t\t\t\t\t\teach(dom.select(format.inline, node), function(child) {\n\t\t\t\t\t\t\t\tif (isBookmarkNode(child)) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tremoveFormat(format, vars, child, format.exact ? child : null);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove format if direct parent already has the same format\n\t\t\t\t\t\tif (matchNode(node.parentNode, name, vars)) {\n\t\t\t\t\t\t\tif (removeFormat(format, vars, node)) {\n\t\t\t\t\t\t\t\tnode = 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Remove format if any ancestor already has the same format\n\t\t\t\t\t\tif (format.merge_with_parents) {\n\t\t\t\t\t\t\tdom.getParent(node.parentNode, function(parent) {\n\t\t\t\t\t\t\t\tif (matchNode(parent, name, vars)) {\n\t\t\t\t\t\t\t\t\tif (removeFormat(format, vars, node)) {\n\t\t\t\t\t\t\t\t\t\tnode = 0;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn TRUE;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// fontSize defines the line height for the whole branch of nested style wrappers,\n\t\t\t\t\t\t// therefore it should be set on the outermost wrapper\n\t\t\t\t\t\tif (!isBlock(node) && !getStyle(node, 'fontSize')) {\n\t\t\t\t\t\t\tvar styleNode = matchNestedWrapper(node, hasStyle('fontSize'));\n\t\t\t\t\t\t\tif (styleNode) {\n\t\t\t\t\t\t\t\tapply('fontsize', {value: getStyle(styleNode, 'fontSize')}, node);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Merge next and previous siblings if they are similar <b>text</b><b>text</b> becomes <b>texttext</b>\n\t\t\t\t\t\tif (node && format.merge_siblings !== false) {\n\t\t\t\t\t\t\tnode = mergeSiblings(getNonWhiteSpaceSibling(node), node);\n\t\t\t\t\t\t\tnode = mergeSiblings(node, getNonWhiteSpaceSibling(node, TRUE));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (getContentEditable(selection.getNode()) === \"false\") {\n\t\t\t\tnode = selection.getNode();\n\t\t\t\tfor (var i = 0, l = formatList.length; i < l; i++) {\n\t\t\t\t\tif (formatList[i].ceFalseOverride && dom.is(node, formatList[i].selector)) {\n\t\t\t\t\t\tsetElementFormat(node, formatList[i]);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (format) {\n\t\t\t\tif (node) {\n\t\t\t\t\tif (node.nodeType) {\n\t\t\t\t\t\tif (!applyNodeStyle(formatList, node)) {\n\t\t\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\t\t\trng.setStartBefore(node);\n\t\t\t\t\t\t\trng.setEndAfter(node);\n\t\t\t\t\t\t\tapplyRngStyle(expandRng(rng, formatList), null, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tapplyRngStyle(node, null, true);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (!isCollapsed || !format.inline || dom.select('td[data-mce-selected],th[data-mce-selected]').length) {\n\t\t\t\t\t\t// Obtain selection node before selection is unselected by applyRngStyle()\n\t\t\t\t\t\tvar curSelNode = ed.selection.getNode();\n\n\t\t\t\t\t\t// If the formats have a default block and we can't find a parent block then\n\t\t\t\t\t\t// start wrapping it with a DIV this is for forced_root_blocks: false\n\t\t\t\t\t\t// It's kind of a hack but people should be using the default block type P since all desktop editors work that way\n\t\t\t\t\t\tif (!forcedRootBlock && formatList[0].defaultBlock && !dom.getParent(curSelNode, dom.isBlock)) {\n\t\t\t\t\t\t\tapply(formatList[0].defaultBlock);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Apply formatting to selection\n\t\t\t\t\t\ted.selection.setRng(adjustSelectionToVisibleSelection());\n\t\t\t\t\t\tbookmark = selection.getBookmark();\n\t\t\t\t\t\tapplyRngStyle(expandRng(selection.getRng(TRUE), formatList), bookmark);\n\n\t\t\t\t\t\tif (format.styles) {\n\t\t\t\t\t\t\t// Colored nodes should be underlined so that the color of the underline matches the text color.\n\t\t\t\t\t\t\tif (format.styles.color || format.styles.textDecoration) {\n\t\t\t\t\t\t\t\twalk(curSelNode, processUnderlineAndColor, 'childNodes');\n\t\t\t\t\t\t\t\tprocessUnderlineAndColor(curSelNode);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// nodes with font-size should have their own background color as well to fit the line-height (see TINY-882)\n\t\t\t\t\t\t\tif (format.styles.backgroundColor) {\n\t\t\t\t\t\t\t\tprocessChildElements(curSelNode,\n\t\t\t\t\t\t\t\t\thasStyle('fontSize'),\n\t\t\t\t\t\t\t\t\tapplyStyle('backgroundColor', replaceVars(format.styles.backgroundColor, vars))\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tselection.moveToBookmark(bookmark);\n\t\t\t\t\t\tmoveStart(selection.getRng(TRUE));\n\t\t\t\t\t\ted.nodeChanged();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tperformCaretAction('apply', name, vars);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tHooks.postProcess(name, ed);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Removes the specified format from the current selection or specified node.\n\t\t *\n\t\t * @method remove\n\t\t * @param {String} name Name of format to remove.\n\t\t * @param {Object} vars Optional list of variables to replace within format before removing it.\n\t\t * @param {Node/Range} node Optional node or DOM range to remove the format from defaults to current selection.\n\t\t */\n\t\tfunction remove(name, vars, node, similar) {\n\t\t\tvar formatList = get(name), format = formatList[0], bookmark, rng, contentEditable = true;\n\n\t\t\t// Merges the styles for each node\n\t\t\tfunction process(node) {\n\t\t\t\tvar children, i, l, lastContentEditable, hasContentEditableState;\n\n\t\t\t\t// Node has a contentEditable value\n\t\t\t\tif (node.nodeType === 1 && getContentEditable(node)) {\n\t\t\t\t\tlastContentEditable = contentEditable;\n\t\t\t\t\tcontentEditable = getContentEditable(node) === \"true\";\n\t\t\t\t\thasContentEditableState = true; // We don't want to wrap the container only it's children\n\t\t\t\t}\n\n\t\t\t\t// Grab the children first since the nodelist might be changed\n\t\t\t\tchildren = grep(node.childNodes);\n\n\t\t\t\t// Process current node\n\t\t\t\tif (contentEditable && !hasContentEditableState) {\n\t\t\t\t\tfor (i = 0, l = formatList.length; i < l; i++) {\n\t\t\t\t\t\tif (removeFormat(formatList[i], vars, node, node)) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Process the children\n\t\t\t\tif (format.deep) {\n\t\t\t\t\tif (children.length) {\n\t\t\t\t\t\tfor (i = 0, l = children.length; i < l; i++) {\n\t\t\t\t\t\t\tprocess(children[i]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (hasContentEditableState) {\n\t\t\t\t\t\t\tcontentEditable = lastContentEditable; // Restore last contentEditable state from stack\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction findFormatRoot(container) {\n\t\t\t\tvar formatRoot;\n\n\t\t\t\t// Find format root\n\t\t\t\teach(getParents(container.parentNode).reverse(), function(parent) {\n\t\t\t\t\tvar format;\n\n\t\t\t\t\t// Find format root element\n\t\t\t\t\tif (!formatRoot && parent.id != '_start' && parent.id != '_end') {\n\t\t\t\t\t\t// Is the node matching the format we are looking for\n\t\t\t\t\t\tformat = matchNode(parent, name, vars, similar);\n\t\t\t\t\t\tif (format && format.split !== false) {\n\t\t\t\t\t\t\tformatRoot = parent;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn formatRoot;\n\t\t\t}\n\n\t\t\tfunction wrapAndSplit(formatRoot, container, target, split) {\n\t\t\t\tvar parent, clone, lastClone, firstClone, i, formatRootParent;\n\n\t\t\t\t// Format root found then clone formats and split it\n\t\t\t\tif (formatRoot) {\n\t\t\t\t\tformatRootParent = formatRoot.parentNode;\n\n\t\t\t\t\tfor (parent = container.parentNode; parent && parent != formatRootParent; parent = parent.parentNode) {\n\t\t\t\t\t\tclone = dom.clone(parent, FALSE);\n\n\t\t\t\t\t\tfor (i = 0; i < formatList.length; i++) {\n\t\t\t\t\t\t\tif (removeFormat(formatList[i], vars, clone, clone)) {\n\t\t\t\t\t\t\t\tclone = 0;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Build wrapper node\n\t\t\t\t\t\tif (clone) {\n\t\t\t\t\t\t\tif (lastClone) {\n\t\t\t\t\t\t\t\tclone.appendChild(lastClone);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!firstClone) {\n\t\t\t\t\t\t\t\tfirstClone = clone;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlastClone = clone;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Never split block elements if the format is mixed\n\t\t\t\t\tif (split && (!format.mixed || !isBlock(formatRoot))) {\n\t\t\t\t\t\tcontainer = dom.split(formatRoot, container);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Wrap container in cloned formats\n\t\t\t\t\tif (lastClone) {\n\t\t\t\t\t\ttarget.parentNode.insertBefore(lastClone, target);\n\t\t\t\t\t\tfirstClone.appendChild(target);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\tfunction splitToFormatRoot(container) {\n\t\t\t\treturn wrapAndSplit(findFormatRoot(container), container, container, true);\n\t\t\t}\n\n\t\t\tfunction unwrap(start) {\n\t\t\t\tvar node = dom.get(start ? '_start' : '_end'),\n\t\t\t\t\tout = node[start ? 'firstChild' : 'lastChild'];\n\n\t\t\t\t// If the end is placed within the start the result will be removed\n\t\t\t\t// So this checks if the out node is a bookmark node if it is it\n\t\t\t\t// checks for another more suitable node\n\t\t\t\tif (isBookmarkNode(out)) {\n\t\t\t\t\tout = out[start ? 'firstChild' : 'lastChild'];\n\t\t\t\t}\n\n\t\t\t\t// Since dom.remove removes empty text nodes then we need to try to find a better node\n\t\t\t\tif (out.nodeType == 3 && out.data.length === 0) {\n\t\t\t\t\tout = start ? node.previousSibling || node.nextSibling : node.nextSibling || node.previousSibling;\n\t\t\t\t}\n\n\t\t\t\tdom.remove(node, true);\n\n\t\t\t\treturn out;\n\t\t\t}\n\n\t\t\tfunction removeRngStyle(rng) {\n\t\t\t\tvar startContainer, endContainer;\n\t\t\t\tvar commonAncestorContainer = rng.commonAncestorContainer;\n\n\t\t\t\trng = expandRng(rng, formatList, TRUE);\n\n\t\t\t\tif (format.split) {\n\t\t\t\t\tstartContainer = getContainer(rng, TRUE);\n\t\t\t\t\tendContainer = getContainer(rng);\n\n\t\t\t\t\tif (startContainer != endContainer) {\n\t\t\t\t\t\t// WebKit will render the table incorrectly if we wrap a TH or TD in a SPAN\n\t\t\t\t\t\t// so let's see if we can use the first child instead\n\t\t\t\t\t\t// This will happen if you triple click a table cell and use remove formatting\n\t\t\t\t\t\tif (/^(TR|TH|TD)$/.test(startContainer.nodeName) && startContainer.firstChild) {\n\t\t\t\t\t\t\tif (startContainer.nodeName == \"TR\") {\n\t\t\t\t\t\t\t\tstartContainer = startContainer.firstChild.firstChild || startContainer;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tstartContainer = startContainer.firstChild || startContainer;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Try to adjust endContainer as well if cells on the same row were selected - bug #6410\n\t\t\t\t\t\tif (commonAncestorContainer &&\n\t\t\t\t\t\t\t/^T(HEAD|BODY|FOOT|R)$/.test(commonAncestorContainer.nodeName) &&\n\t\t\t\t\t\t\tisTableCell(endContainer) && endContainer.firstChild) {\n\t\t\t\t\t\t\tendContainer = endContainer.firstChild || endContainer;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (dom.isChildOf(startContainer, endContainer) && !isBlock(endContainer) &&\n\t\t\t\t\t\t\t!isTableCell(startContainer) && !isTableCell(endContainer)) {\n\t\t\t\t\t\t\tstartContainer = wrap(startContainer, 'span', {id: '_start', 'data-mce-type': 'bookmark'});\n\t\t\t\t\t\t\tsplitToFormatRoot(startContainer);\n\t\t\t\t\t\t\tstartContainer = unwrap(TRUE);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Wrap start/end nodes in span element since these might be cloned/moved\n\t\t\t\t\t\tstartContainer = wrap(startContainer, 'span', {id: '_start', 'data-mce-type': 'bookmark'});\n\t\t\t\t\t\tendContainer = wrap(endContainer, 'span', {id: '_end', 'data-mce-type': 'bookmark'});\n\n\t\t\t\t\t\t// Split start/end\n\t\t\t\t\t\tsplitToFormatRoot(startContainer);\n\t\t\t\t\t\tsplitToFormatRoot(endContainer);\n\n\t\t\t\t\t\t// Unwrap start/end to get real elements again\n\t\t\t\t\t\tstartContainer = unwrap(TRUE);\n\t\t\t\t\t\tendContainer = unwrap();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstartContainer = endContainer = splitToFormatRoot(startContainer);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Update range positions since they might have changed after the split operations\n\t\t\t\t\trng.startContainer = startContainer.parentNode ? startContainer.parentNode : startContainer;\n\t\t\t\t\trng.startOffset = nodeIndex(startContainer);\n\t\t\t\t\trng.endContainer = endContainer.parentNode ? endContainer.parentNode : endContainer;\n\t\t\t\t\trng.endOffset = nodeIndex(endContainer) + 1;\n\t\t\t\t}\n\n\t\t\t\t// Remove items between start/end\n\t\t\t\trangeUtils.walk(rng, function(nodes) {\n\t\t\t\t\teach(nodes, function(node) {\n\t\t\t\t\t\tprocess(node);\n\n\t\t\t\t\t\t// Remove parent span if it only contains text-decoration: underline, yet a parent node is also underlined.\n\t\t\t\t\t\tif (node.nodeType === 1 && ed.dom.getStyle(node, 'text-decoration') === 'underline' &&\n\t\t\t\t\t\t\tnode.parentNode && getTextDecoration(node.parentNode) === 'underline') {\n\t\t\t\t\t\t\tremoveFormat({\n\t\t\t\t\t\t\t\t'deep': false,\n\t\t\t\t\t\t\t\t'exact': true,\n\t\t\t\t\t\t\t\t'inline': 'span',\n\t\t\t\t\t\t\t\t'styles': {\n\t\t\t\t\t\t\t\t\t'textDecoration': 'underline'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, null, node);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Handle node\n\t\t\tif (node) {\n\t\t\t\tif (node.nodeType) {\n\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\trng.setStartBefore(node);\n\t\t\t\t\trng.setEndAfter(node);\n\t\t\t\t\tremoveRngStyle(rng);\n\t\t\t\t} else {\n\t\t\t\t\tremoveRngStyle(node);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (getContentEditable(selection.getNode()) === \"false\") {\n\t\t\t\tnode = selection.getNode();\n\t\t\t\tfor (var i = 0, l = formatList.length; i < l; i++) {\n\t\t\t\t\tif (formatList[i].ceFalseOverride) {\n\t\t\t\t\t\tif (removeFormat(formatList[i], vars, node, node)) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!selection.isCollapsed() || !format.inline || dom.select('td[data-mce-selected],th[data-mce-selected]').length) {\n\t\t\t\tbookmark = selection.getBookmark();\n\t\t\t\tremoveRngStyle(selection.getRng(TRUE));\n\t\t\t\tselection.moveToBookmark(bookmark);\n\n\t\t\t\t// Check if start element still has formatting then we are at: \"<b>text|</b>text\"\n\t\t\t\t// and need to move the start into the next text node\n\t\t\t\tif (format.inline && match(name, vars, selection.getStart())) {\n\t\t\t\t\tmoveStart(selection.getRng(true));\n\t\t\t\t}\n\n\t\t\t\ted.nodeChanged();\n\t\t\t} else {\n\t\t\t\tperformCaretAction('remove', name, vars, similar);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Toggles the specified format on/off.\n\t\t *\n\t\t * @method toggle\n\t\t * @param {String} name Name of format to apply/remove.\n\t\t * @param {Object} vars Optional list of variables to replace within format before applying/removing it.\n\t\t * @param {Node} node Optional node to apply the format to or remove from. Defaults to current selection.\n\t\t */\n\t\tfunction toggle(name, vars, node) {\n\t\t\tvar fmt = get(name);\n\n\t\t\tif (match(name, vars, node) && (!('toggle' in fmt[0]) || fmt[0].toggle)) {\n\t\t\t\tremove(name, vars, node);\n\t\t\t} else {\n\t\t\t\tapply(name, vars, node);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Return true/false if the specified node has the specified format.\n\t\t *\n\t\t * @method matchNode\n\t\t * @param {Node} node Node to check the format on.\n\t\t * @param {String} name Format name to check.\n\t\t * @param {Object} vars Optional list of variables to replace before checking it.\n\t\t * @param {Boolean} similar Match format that has similar properties.\n\t\t * @return {Object} Returns the format object it matches or undefined if it doesn't match.\n\t\t */\n\t\tfunction matchNode(node, name, vars, similar) {\n\t\t\tvar formatList = get(name), format, i, classes;\n\n\t\t\tfunction matchItems(node, format, item_name) {\n\t\t\t\tvar key, value, items = format[item_name], i;\n\n\t\t\t\t// Custom match\n\t\t\t\tif (format.onmatch) {\n\t\t\t\t\treturn format.onmatch(node, format, item_name);\n\t\t\t\t}\n\n\t\t\t\t// Check all items\n\t\t\t\tif (items) {\n\t\t\t\t\t// Non indexed object\n\t\t\t\t\tif (items.length === undef) {\n\t\t\t\t\t\tfor (key in items) {\n\t\t\t\t\t\t\tif (items.hasOwnProperty(key)) {\n\t\t\t\t\t\t\t\tif (item_name === 'attributes') {\n\t\t\t\t\t\t\t\t\tvalue = dom.getAttrib(node, key);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tvalue = getStyle(node, key);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (similar && !value && !format.exact) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif ((!similar || format.exact) && !isEq(value, normalizeStyleValue(replaceVars(items[key], vars), key))) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Only one match needed for indexed arrays\n\t\t\t\t\t\tfor (i = 0; i < items.length; i++) {\n\t\t\t\t\t\t\tif (item_name === 'attributes' ? dom.getAttrib(node, items[i]) : getStyle(node, items[i])) {\n\t\t\t\t\t\t\t\treturn format;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn format;\n\t\t\t}\n\n\t\t\tif (formatList && node) {\n\t\t\t\t// Check each format in list\n\t\t\t\tfor (i = 0; i < formatList.length; i++) {\n\t\t\t\t\tformat = formatList[i];\n\n\t\t\t\t\t// Name name, attributes, styles and classes\n\t\t\t\t\tif (matchName(node, format) && matchItems(node, format, 'attributes') && matchItems(node, format, 'styles')) {\n\t\t\t\t\t\t// Match classes\n\t\t\t\t\t\tif ((classes = format.classes)) {\n\t\t\t\t\t\t\tfor (i = 0; i < classes.length; i++) {\n\t\t\t\t\t\t\t\tif (!dom.hasClass(node, classes[i])) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn format;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Matches the current selection or specified node against the specified format name.\n\t\t *\n\t\t * @method match\n\t\t * @param {String} name Name of format to match.\n\t\t * @param {Object} vars Optional list of variables to replace before checking it.\n\t\t * @param {Node} node Optional node to check.\n\t\t * @return {boolean} true/false if the specified selection/node matches the format.\n\t\t */\n\t\tfunction match(name, vars, node) {\n\t\t\tvar startNode;\n\n\t\t\tfunction matchParents(node) {\n\t\t\t\tvar root = dom.getRoot();\n\n\t\t\t\tif (node === root) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Find first node with similar format settings\n\t\t\t\tnode = dom.getParent(node, function(node) {\n\t\t\t\t\tif (matchesUnInheritedFormatSelector(node, name)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node.parentNode === root || !!matchNode(node, name, vars, true);\n\t\t\t\t});\n\n\t\t\t\t// Do an exact check on the similar format element\n\t\t\t\treturn matchNode(node, name, vars);\n\t\t\t}\n\n\t\t\t// Check specified node\n\t\t\tif (node) {\n\t\t\t\treturn matchParents(node);\n\t\t\t}\n\n\t\t\t// Check selected node\n\t\t\tnode = selection.getNode();\n\t\t\tif (matchParents(node)) {\n\t\t\t\treturn TRUE;\n\t\t\t}\n\n\t\t\t// Check start node if it's different\n\t\t\tstartNode = selection.getStart();\n\t\t\tif (startNode != node) {\n\t\t\t\tif (matchParents(startNode)) {\n\t\t\t\t\treturn TRUE;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn FALSE;\n\t\t}\n\n\t\t/**\n\t\t * Matches the current selection against the array of formats and returns a new array with matching formats.\n\t\t *\n\t\t * @method matchAll\n\t\t * @param {Array} names Name of format to match.\n\t\t * @param {Object} vars Optional list of variables to replace before checking it.\n\t\t * @return {Array} Array with matched formats.\n\t\t */\n\t\tfunction matchAll(names, vars) {\n\t\t\tvar startElement, matchedFormatNames = [], checkedMap = {};\n\n\t\t\t// Check start of selection for formats\n\t\t\tstartElement = selection.getStart();\n\t\t\tdom.getParent(startElement, function(node) {\n\t\t\t\tvar i, name;\n\n\t\t\t\tfor (i = 0; i < names.length; i++) {\n\t\t\t\t\tname = names[i];\n\n\t\t\t\t\tif (!checkedMap[name] && matchNode(node, name, vars)) {\n\t\t\t\t\t\tcheckedMap[name] = true;\n\t\t\t\t\t\tmatchedFormatNames.push(name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, dom.getRoot());\n\n\t\t\treturn matchedFormatNames;\n\t\t}\n\n\t\t/**\n\t\t * Returns true/false if the specified format can be applied to the current selection or not. It\n\t\t * will currently only check the state for selector formats, it returns true on all other format types.\n\t\t *\n\t\t * @method canApply\n\t\t * @param {String} name Name of format to check.\n\t\t * @return {boolean} true/false if the specified format can be applied to the current selection/node.\n\t\t */\n\t\tfunction canApply(name) {\n\t\t\tvar formatList = get(name), startNode, parents, i, x, selector;\n\n\t\t\tif (formatList) {\n\t\t\t\tstartNode = selection.getStart();\n\t\t\t\tparents = getParents(startNode);\n\n\t\t\t\tfor (x = formatList.length - 1; x >= 0; x--) {\n\t\t\t\t\tselector = formatList[x].selector;\n\n\t\t\t\t\t// Format is not selector based then always return TRUE\n\t\t\t\t\t// Is it has a defaultBlock then it's likely it can be applied for example align on a non block element line\n\t\t\t\t\tif (!selector || formatList[x].defaultBlock) {\n\t\t\t\t\t\treturn TRUE;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (i = parents.length - 1; i >= 0; i--) {\n\t\t\t\t\t\tif (dom.is(parents[i], selector)) {\n\t\t\t\t\t\t\treturn TRUE;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn FALSE;\n\t\t}\n\n\t\t/**\n\t\t * Executes the specified callback when the current selection matches the formats or not.\n\t\t *\n\t\t * @method formatChanged\n\t\t * @param {String} formats Comma separated list of formats to check for.\n\t\t * @param {function} callback Callback with state and args when the format is changed/toggled on/off.\n\t\t * @param {Boolean} similar True/false state if the match should handle similar or exact formats.\n\t\t */\n\t\tfunction formatChanged(formats, callback, similar) {\n\t\t\tvar currentFormats;\n\n\t\t\t// Setup format node change logic\n\t\t\tif (!formatChangeData) {\n\t\t\t\tformatChangeData = {};\n\t\t\t\tcurrentFormats = {};\n\n\t\t\t\ted.on('NodeChange', function(e) {\n\t\t\t\t\tvar parents = getParents(e.element), matchedFormats = {};\n\n\t\t\t\t\t// Ignore bogus nodes like the <a> tag created by moveStart()\n\t\t\t\t\tparents = Tools.grep(parents, function(node) {\n\t\t\t\t\t\treturn node.nodeType == 1 && !node.getAttribute('data-mce-bogus');\n\t\t\t\t\t});\n\n\t\t\t\t\t// Check for new formats\n\t\t\t\t\teach(formatChangeData, function(callbacks, format) {\n\t\t\t\t\t\teach(parents, function(node) {\n\t\t\t\t\t\t\tif (matchNode(node, format, {}, callbacks.similar)) {\n\t\t\t\t\t\t\t\tif (!currentFormats[format]) {\n\t\t\t\t\t\t\t\t\t// Execute callbacks\n\t\t\t\t\t\t\t\t\teach(callbacks, function(callback) {\n\t\t\t\t\t\t\t\t\t\tcallback(true, {node: node, format: format, parents: parents});\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tcurrentFormats[format] = callbacks;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tmatchedFormats[format] = callbacks;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (matchesUnInheritedFormatSelector(node, format)) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\t// Check if current formats still match\n\t\t\t\t\teach(currentFormats, function(callbacks, format) {\n\t\t\t\t\t\tif (!matchedFormats[format]) {\n\t\t\t\t\t\t\tdelete currentFormats[format];\n\n\t\t\t\t\t\t\teach(callbacks, function(callback) {\n\t\t\t\t\t\t\t\tcallback(false, {node: e.element, format: format, parents: parents});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Add format listeners\n\t\t\teach(formats.split(','), function(format) {\n\t\t\t\tif (!formatChangeData[format]) {\n\t\t\t\t\tformatChangeData[format] = [];\n\t\t\t\t\tformatChangeData[format].similar = similar;\n\t\t\t\t}\n\n\t\t\t\tformatChangeData[format].push(callback);\n\t\t\t});\n\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Returns a preview css text for the specified format.\n\t\t *\n\t\t * @method getCssText\n\t\t * @param {String/Object} format Format to generate preview css text for.\n\t\t * @return {String} Css text for the specified format.\n\t\t * @example\n\t\t * var cssText1 = editor.formatter.getCssText('bold');\n\t\t * var cssText2 = editor.formatter.getCssText({inline: 'b'});\n\t\t */\n\t\tfunction getCssText(format) {\n\t\t\treturn Preview.getCssText(ed, format);\n\t\t}\n\n\t\t// Expose to public\n\t\textend(this, {\n\t\t\tget: get,\n\t\t\tregister: register,\n\t\t\tunregister: unregister,\n\t\t\tapply: apply,\n\t\t\tremove: remove,\n\t\t\ttoggle: toggle,\n\t\t\tmatch: match,\n\t\t\tmatchAll: matchAll,\n\t\t\tmatchNode: matchNode,\n\t\t\tcanApply: canApply,\n\t\t\tformatChanged: formatChanged,\n\t\t\tgetCssText: getCssText\n\t\t});\n\n\t\t// Initialize\n\t\tdefaultFormats();\n\t\taddKeyboardShortcuts();\n\t\ted.on('BeforeGetContent', function(e) {\n\t\t\tif (markCaretContainersBogus && e.format != 'raw') {\n\t\t\t\tmarkCaretContainersBogus();\n\t\t\t}\n\t\t});\n\t\ted.on('mouseup keydown', function(e) {\n\t\t\tif (disableCaretContainer) {\n\t\t\t\tdisableCaretContainer(e);\n\t\t\t}\n\t\t});\n\n\t\t// Private functions\n\n\t\t/**\n\t\t * Checks if the specified nodes name matches the format inline/block or selector.\n\t\t *\n\t\t * @private\n\t\t * @param {Node} node Node to match against the specified format.\n\t\t * @param {Object} format Format object o match with.\n\t\t * @return {boolean} true/false if the format matches.\n\t\t */\n\t\tfunction matchName(node, format) {\n\t\t\t// Check for inline match\n\t\t\tif (isEq(node, format.inline)) {\n\t\t\t\treturn TRUE;\n\t\t\t}\n\n\t\t\t// Check for block match\n\t\t\tif (isEq(node, format.block)) {\n\t\t\t\treturn TRUE;\n\t\t\t}\n\n\t\t\t// Check for selector match\n\t\t\tif (format.selector) {\n\t\t\t\treturn node.nodeType == 1 && dom.is(node, format.selector);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Compares two string/nodes regardless of their case.\n\t\t *\n\t\t * @private\n\t\t * @param {String/Node} str1 Node or string to compare.\n\t\t * @param {String/Node} str2 Node or string to compare.\n\t\t * @return {boolean} True/false if they match.\n\t\t */\n\t\tfunction isEq(str1, str2) {\n\t\t\tstr1 = str1 || '';\n\t\t\tstr2 = str2 || '';\n\n\t\t\tstr1 = '' + (str1.nodeName || str1);\n\t\t\tstr2 = '' + (str2.nodeName || str2);\n\n\t\t\treturn str1.toLowerCase() == str2.toLowerCase();\n\t\t}\n\n\t\tfunction processChildElements(node, filter, process) {\n\t\t\teach(node.childNodes, function(node) {\n\t\t\t\tif (isElementNode(node)) {\n\t\t\t\t\tif (filter(node)) {\n\t\t\t\t\t\tprocess(node);\n\t\t\t\t\t}\n\t\t\t\t\tif (node.hasChildNodes()) {\n\t\t\t\t\t\tprocessChildElements(node, filter, process);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction isElementNode(node) {\n\t\t\treturn node.nodeType == 1 && !isBookmarkNode(node) && !isWhiteSpaceNode(node) && !isCaretNode(node);\n\t\t}\n\n\t\tfunction hasStyle(name) {\n\t\t\treturn Fun.curry(function(name, node) {\n\t\t\t\treturn !!(node && getStyle(node, name));\n\t\t\t}, name);\n\t\t}\n\n\t\tfunction applyStyle(name, value) {\n\t\t\treturn Fun.curry(function(name, value, node) {\n\t\t\t\tdom.setStyle(node, name, value);\n\t\t\t}, name, value);\n\t\t}\n\n\t\t/**\n\t\t * Returns the style by name on the specified node. This method modifies the style\n\t\t * contents to make it more easy to match. This will resolve a few browser issues.\n\t\t *\n\t\t * @private\n\t\t * @param {Node} node to get style from.\n\t\t * @param {String} name Style name to get.\n\t\t * @return {String} Style item value.\n\t\t */\n\t\tfunction getStyle(node, name) {\n\t\t\treturn normalizeStyleValue(dom.getStyle(node, name), name);\n\t\t}\n\n\t\t/**\n\t\t * Normalize style value by name. This method modifies the style contents\n\t\t * to make it more easy to match. This will resolve a few browser issues.\n\t\t *\n\t\t * @private\n\t\t * @param {String} value Value to get style from.\n\t\t * @param {String} name Style name to get.\n\t\t * @return {String} Style item value.\n\t\t */\n\t\tfunction normalizeStyleValue(value, name) {\n\t\t\t// Force the format to hex\n\t\t\tif (name == 'color' || name == 'backgroundColor') {\n\t\t\t\tvalue = dom.toHex(value);\n\t\t\t}\n\n\t\t\t// Opera will return bold as 700\n\t\t\tif (name == 'fontWeight' && value == 700) {\n\t\t\t\tvalue = 'bold';\n\t\t\t}\n\n\t\t\t// Normalize fontFamily so \"'Font name', Font\" becomes: \"Font name,Font\"\n\t\t\tif (name == 'fontFamily') {\n\t\t\t\tvalue = value.replace(/[\\'\\\"]/g, '').replace(/,\\s+/g, ',');\n\t\t\t}\n\n\t\t\treturn '' + value;\n\t\t}\n\n\t\t/**\n\t\t * Replaces variables in the value. The variable format is %var.\n\t\t *\n\t\t * @private\n\t\t * @param {String} value Value to replace variables in.\n\t\t * @param {Object} vars Name/value array with variables to replace.\n\t\t * @return {String} New value with replaced variables.\n\t\t */\n\t\tfunction replaceVars(value, vars) {\n\t\t\tif (typeof value != \"string\") {\n\t\t\t\tvalue = value(vars);\n\t\t\t} else if (vars) {\n\t\t\t\tvalue = value.replace(/%(\\w+)/g, function(str, name) {\n\t\t\t\t\treturn vars[name] || str;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t\tfunction isWhiteSpaceNode(node) {\n\t\t\treturn node && node.nodeType === 3 && /^([\\t \\r\\n]+|)$/.test(node.nodeValue);\n\t\t}\n\n\t\tfunction wrap(node, name, attrs) {\n\t\t\tvar wrapper = dom.create(name, attrs);\n\n\t\t\tnode.parentNode.insertBefore(wrapper, node);\n\t\t\twrapper.appendChild(node);\n\n\t\t\treturn wrapper;\n\t\t}\n\n\t\t/**\n\t\t * Expands the specified range like object to depending on format.\n\t\t *\n\t\t * For example on block formats it will move the start/end position\n\t\t * to the beginning of the current block.\n\t\t *\n\t\t * @private\n\t\t * @param {Object} rng Range like object.\n\t\t * @param {Array} format Array with formats to expand by.\n\t\t * @param {Boolean} remove\n\t\t * @return {Object} Expanded range like object.\n\t\t */\n\t\tfunction expandRng(rng, format, remove) {\n\t\t\tvar lastIdx, leaf, endPoint,\n\t\t\t\tstartContainer = rng.startContainer,\n\t\t\t\tstartOffset = rng.startOffset,\n\t\t\t\tendContainer = rng.endContainer,\n\t\t\t\tendOffset = rng.endOffset;\n\n\t\t\t// This function walks up the tree if there is no siblings before/after the node\n\t\t\tfunction findParentContainer(start) {\n\t\t\t\tvar container, parent, sibling, siblingName, root;\n\n\t\t\t\tcontainer = parent = start ? startContainer : endContainer;\n\t\t\t\tsiblingName = start ? 'previousSibling' : 'nextSibling';\n\t\t\t\troot = dom.getRoot();\n\n\t\t\t\tfunction isBogusBr(node) {\n\t\t\t\t\treturn node.nodeName == \"BR\" && node.getAttribute('data-mce-bogus') && !node.nextSibling;\n\t\t\t\t}\n\n\t\t\t\t// If it's a text node and the offset is inside the text\n\t\t\t\tif (container.nodeType == 3 && !isWhiteSpaceNode(container)) {\n\t\t\t\t\tif (start ? startOffset > 0 : endOffset < container.nodeValue.length) {\n\t\t\t\t\t\treturn container;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/*eslint no-constant-condition:0 */\n\t\t\t\twhile (true) {\n\t\t\t\t\t// Stop expanding on block elements\n\t\t\t\t\tif (!format[0].block_expand && isBlock(parent)) {\n\t\t\t\t\t\treturn parent;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Walk left/right\n\t\t\t\t\tfor (sibling = parent[siblingName]; sibling; sibling = sibling[siblingName]) {\n\t\t\t\t\t\tif (!isBookmarkNode(sibling) && !isWhiteSpaceNode(sibling) && !isBogusBr(sibling)) {\n\t\t\t\t\t\t\treturn parent;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Check if we can move up are we at root level or body level\n\t\t\t\t\tif (parent == root || parent.parentNode == root) {\n\t\t\t\t\t\tcontainer = parent;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\t// This function walks down the tree to find the leaf at the selection.\n\t\t\t// The offset is also returned as if node initially a leaf, the offset may be in the middle of the text node.\n\t\t\tfunction findLeaf(node, offset) {\n\t\t\t\tif (offset === undef) {\n\t\t\t\t\toffset = node.nodeType === 3 ? node.length : node.childNodes.length;\n\t\t\t\t}\n\n\t\t\t\twhile (node && node.hasChildNodes()) {\n\t\t\t\t\tnode = node.childNodes[offset];\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\toffset = node.nodeType === 3 ? node.length : node.childNodes.length;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn {node: node, offset: offset};\n\t\t\t}\n\n\t\t\t// If index based start position then resolve it\n\t\t\tif (startContainer.nodeType == 1 && startContainer.hasChildNodes()) {\n\t\t\t\tlastIdx = startContainer.childNodes.length - 1;\n\t\t\t\tstartContainer = startContainer.childNodes[startOffset > lastIdx ? lastIdx : startOffset];\n\n\t\t\t\tif (startContainer.nodeType == 3) {\n\t\t\t\t\tstartOffset = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If index based end position then resolve it\n\t\t\tif (endContainer.nodeType == 1 && endContainer.hasChildNodes()) {\n\t\t\t\tlastIdx = endContainer.childNodes.length - 1;\n\t\t\t\tendContainer = endContainer.childNodes[endOffset > lastIdx ? lastIdx : endOffset - 1];\n\n\t\t\t\tif (endContainer.nodeType == 3) {\n\t\t\t\t\tendOffset = endContainer.nodeValue.length;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Expands the node to the closes contentEditable false element if it exists\n\t\t\tfunction findParentContentEditable(node) {\n\t\t\t\tvar parent = node;\n\n\t\t\t\twhile (parent) {\n\t\t\t\t\tif (parent.nodeType === 1 && getContentEditable(parent)) {\n\t\t\t\t\t\treturn getContentEditable(parent) === \"false\" ? parent : node;\n\t\t\t\t\t}\n\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tfunction findWordEndPoint(container, offset, start) {\n\t\t\t\tvar walker, node, pos, lastTextNode;\n\n\t\t\t\tfunction findSpace(node, offset) {\n\t\t\t\t\tvar pos, pos2, str = node.nodeValue;\n\n\t\t\t\t\tif (typeof offset == \"undefined\") {\n\t\t\t\t\t\toffset = start ? str.length : 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\tpos = str.lastIndexOf(' ', offset);\n\t\t\t\t\t\tpos2 = str.lastIndexOf('\\u00a0', offset);\n\t\t\t\t\t\tpos = pos > pos2 ? pos : pos2;\n\n\t\t\t\t\t\t// Include the space on remove to avoid tag soup\n\t\t\t\t\t\tif (pos !== -1 && !remove) {\n\t\t\t\t\t\t\tpos++;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpos = str.indexOf(' ', offset);\n\t\t\t\t\t\tpos2 = str.indexOf('\\u00a0', offset);\n\t\t\t\t\t\tpos = pos !== -1 && (pos2 === -1 || pos < pos2) ? pos : pos2;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn pos;\n\t\t\t\t}\n\n\t\t\t\tif (container.nodeType === 3) {\n\t\t\t\t\tpos = findSpace(container, offset);\n\n\t\t\t\t\tif (pos !== -1) {\n\t\t\t\t\t\treturn {container: container, offset: pos};\n\t\t\t\t\t}\n\n\t\t\t\t\tlastTextNode = container;\n\t\t\t\t}\n\n\t\t\t\t// Walk the nodes inside the block\n\t\t\t\twalker = new TreeWalker(container, dom.getParent(container, isBlock) || ed.getBody());\n\t\t\t\twhile ((node = walker[start ? 'prev' : 'next']())) {\n\t\t\t\t\tif (node.nodeType === 3) {\n\t\t\t\t\t\tlastTextNode = node;\n\t\t\t\t\t\tpos = findSpace(node);\n\n\t\t\t\t\t\tif (pos !== -1) {\n\t\t\t\t\t\t\treturn {container: node, offset: pos};\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (isBlock(node)) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (lastTextNode) {\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\toffset = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toffset = lastTextNode.length;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {container: lastTextNode, offset: offset};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction findSelectorEndPoint(container, sibling_name) {\n\t\t\t\tvar parents, i, y, curFormat;\n\n\t\t\t\tif (container.nodeType == 3 && container.nodeValue.length === 0 && container[sibling_name]) {\n\t\t\t\t\tcontainer = container[sibling_name];\n\t\t\t\t}\n\n\t\t\t\tparents = getParents(container);\n\t\t\t\tfor (i = 0; i < parents.length; i++) {\n\t\t\t\t\tfor (y = 0; y < format.length; y++) {\n\t\t\t\t\t\tcurFormat = format[y];\n\n\t\t\t\t\t\t// If collapsed state is set then skip formats that doesn't match that\n\t\t\t\t\t\tif (\"collapsed\" in curFormat && curFormat.collapsed !== rng.collapsed) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (dom.is(parents[i], curFormat.selector)) {\n\t\t\t\t\t\t\treturn parents[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\tfunction findBlockEndPoint(container, sibling_name) {\n\t\t\t\tvar node, root = dom.getRoot();\n\n\t\t\t\t// Expand to block of similar type\n\t\t\t\tif (!format[0].wrapper) {\n\t\t\t\t\tnode = dom.getParent(container, format[0].block, root);\n\t\t\t\t}\n\n\t\t\t\t// Expand to first wrappable block element or any block element\n\t\t\t\tif (!node) {\n\t\t\t\t\tnode = dom.getParent(container.nodeType == 3 ? container.parentNode : container, function(node) {\n\t\t\t\t\t\t// Fixes #6183 where it would expand to editable parent element in inline mode\n\t\t\t\t\t\treturn node != root && isTextBlock(node);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Exclude inner lists from wrapping\n\t\t\t\tif (node && format[0].wrapper) {\n\t\t\t\t\tnode = getParents(node, 'ul,ol').reverse()[0] || node;\n\t\t\t\t}\n\n\t\t\t\t// Didn't find a block element look for first/last wrappable element\n\t\t\t\tif (!node) {\n\t\t\t\t\tnode = container;\n\n\t\t\t\t\twhile (node[sibling_name] && !isBlock(node[sibling_name])) {\n\t\t\t\t\t\tnode = node[sibling_name];\n\n\t\t\t\t\t\t// Break on BR but include it will be removed later on\n\t\t\t\t\t\t// we can't remove it now since we need to check if it can be wrapped\n\t\t\t\t\t\tif (isEq(node, 'br')) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn node || container;\n\t\t\t}\n\n\t\t\t// Expand to closest contentEditable element\n\t\t\tstartContainer = findParentContentEditable(startContainer);\n\t\t\tendContainer = findParentContentEditable(endContainer);\n\n\t\t\t// Exclude bookmark nodes if possible\n\t\t\tif (isBookmarkNode(startContainer.parentNode) || isBookmarkNode(startContainer)) {\n\t\t\t\tstartContainer = isBookmarkNode(startContainer) ? startContainer : startContainer.parentNode;\n\t\t\t\tstartContainer = startContainer.nextSibling || startContainer;\n\n\t\t\t\tif (startContainer.nodeType == 3) {\n\t\t\t\t\tstartOffset = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (isBookmarkNode(endContainer.parentNode) || isBookmarkNode(endContainer)) {\n\t\t\t\tendContainer = isBookmarkNode(endContainer) ? endContainer : endContainer.parentNode;\n\t\t\t\tendContainer = endContainer.previousSibling || endContainer;\n\n\t\t\t\tif (endContainer.nodeType == 3) {\n\t\t\t\t\tendOffset = endContainer.length;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (format[0].inline) {\n\t\t\t\tif (rng.collapsed) {\n\t\t\t\t\t// Expand left to closest word boundary\n\t\t\t\t\tendPoint = findWordEndPoint(startContainer, startOffset, true);\n\t\t\t\t\tif (endPoint) {\n\t\t\t\t\t\tstartContainer = endPoint.container;\n\t\t\t\t\t\tstartOffset = endPoint.offset;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Expand right to closest word boundary\n\t\t\t\t\tendPoint = findWordEndPoint(endContainer, endOffset);\n\t\t\t\t\tif (endPoint) {\n\t\t\t\t\t\tendContainer = endPoint.container;\n\t\t\t\t\t\tendOffset = endPoint.offset;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Avoid applying formatting to a trailing space.\n\t\t\t\tleaf = findLeaf(endContainer, endOffset);\n\t\t\t\tif (leaf.node) {\n\t\t\t\t\twhile (leaf.node && leaf.offset === 0 && leaf.node.previousSibling) {\n\t\t\t\t\t\tleaf = findLeaf(leaf.node.previousSibling);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (leaf.node && leaf.offset > 0 && leaf.node.nodeType === 3 &&\n\t\t\t\t\t\t\tleaf.node.nodeValue.charAt(leaf.offset - 1) === ' ') {\n\n\t\t\t\t\t\tif (leaf.offset > 1) {\n\t\t\t\t\t\t\tendContainer = leaf.node;\n\t\t\t\t\t\t\tendContainer.splitText(leaf.offset - 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Move start/end point up the tree if the leaves are sharp and if we are in different containers\n\t\t\t// Example * becomes !: !<p><b><i>*text</i><i>text*</i></b></p>!\n\t\t\t// This will reduce the number of wrapper elements that needs to be created\n\t\t\t// Move start point up the tree\n\t\t\tif (format[0].inline || format[0].block_expand) {\n\t\t\t\tif (!format[0].inline || (startContainer.nodeType != 3 || startOffset === 0)) {\n\t\t\t\t\tstartContainer = findParentContainer(true);\n\t\t\t\t}\n\n\t\t\t\tif (!format[0].inline || (endContainer.nodeType != 3 || endOffset === endContainer.nodeValue.length)) {\n\t\t\t\t\tendContainer = findParentContainer();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Expand start/end container to matching selector\n\t\t\tif (format[0].selector && format[0].expand !== FALSE && !format[0].inline) {\n\t\t\t\t// Find new startContainer/endContainer if there is better one\n\t\t\t\tstartContainer = findSelectorEndPoint(startContainer, 'previousSibling');\n\t\t\t\tendContainer = findSelectorEndPoint(endContainer, 'nextSibling');\n\t\t\t}\n\n\t\t\t// Expand start/end container to matching block element or text node\n\t\t\tif (format[0].block || format[0].selector) {\n\t\t\t\t// Find new startContainer/endContainer if there is better one\n\t\t\t\tstartContainer = findBlockEndPoint(startContainer, 'previousSibling');\n\t\t\t\tendContainer = findBlockEndPoint(endContainer, 'nextSibling');\n\n\t\t\t\t// Non block element then try to expand up the leaf\n\t\t\t\tif (format[0].block) {\n\t\t\t\t\tif (!isBlock(startContainer)) {\n\t\t\t\t\t\tstartContainer = findParentContainer(true);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!isBlock(endContainer)) {\n\t\t\t\t\t\tendContainer = findParentContainer();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Setup index for startContainer\n\t\t\tif (startContainer.nodeType == 1) {\n\t\t\t\tstartOffset = nodeIndex(startContainer);\n\t\t\t\tstartContainer = startContainer.parentNode;\n\t\t\t}\n\n\t\t\t// Setup index for endContainer\n\t\t\tif (endContainer.nodeType == 1) {\n\t\t\t\tendOffset = nodeIndex(endContainer) + 1;\n\t\t\t\tendContainer = endContainer.parentNode;\n\t\t\t}\n\n\t\t\t// Return new range like object\n\t\t\treturn {\n\t\t\t\tstartContainer: startContainer,\n\t\t\t\tstartOffset: startOffset,\n\t\t\t\tendContainer: endContainer,\n\t\t\t\tendOffset: endOffset\n\t\t\t};\n\t\t}\n\n\t\tfunction isColorFormatAndAnchor(node, format) {\n\t\t\treturn format.links && node.tagName == 'A';\n\t\t}\n\n\t\t/**\n\t\t * Removes the specified format for the specified node. It will also remove the node if it doesn't have\n\t\t * any attributes if the format specifies it to do so.\n\t\t *\n\t\t * @private\n\t\t * @param {Object} format Format object with items to remove from node.\n\t\t * @param {Object} vars Name/value object with variables to apply to format.\n\t\t * @param {Node} node Node to remove the format styles on.\n\t\t * @param {Node} compare_node Optional compare node, if specified the styles will be compared to that node.\n\t\t * @return {Boolean} True/false if the node was removed or not.\n\t\t */\n\t\tfunction removeFormat(format, vars, node, compare_node) {\n\t\t\tvar i, attrs, stylesModified;\n\n\t\t\t// Check if node matches format\n\t\t\tif (!matchName(node, format) && !isColorFormatAndAnchor(node, format)) {\n\t\t\t\treturn FALSE;\n\t\t\t}\n\n\t\t\t// Should we compare with format attribs and styles\n\t\t\tif (format.remove != 'all') {\n\t\t\t\t// Remove styles\n\t\t\t\teach(format.styles, function(value, name) {\n\t\t\t\t\tvalue = normalizeStyleValue(replaceVars(value, vars), name);\n\n\t\t\t\t\t// Indexed array\n\t\t\t\t\tif (typeof name === 'number') {\n\t\t\t\t\t\tname = value;\n\t\t\t\t\t\tcompare_node = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (format.remove_similar || (!compare_node || isEq(getStyle(compare_node, name), value))) {\n\t\t\t\t\t\tdom.setStyle(node, name, '');\n\t\t\t\t\t}\n\n\t\t\t\t\tstylesModified = 1;\n\t\t\t\t});\n\n\t\t\t\t// Remove style attribute if it's empty\n\t\t\t\tif (stylesModified && dom.getAttrib(node, 'style') === '') {\n\t\t\t\t\tnode.removeAttribute('style');\n\t\t\t\t\tnode.removeAttribute('data-mce-style');\n\t\t\t\t}\n\n\t\t\t\t// Remove attributes\n\t\t\t\teach(format.attributes, function(value, name) {\n\t\t\t\t\tvar valueOut;\n\n\t\t\t\t\tvalue = replaceVars(value, vars);\n\n\t\t\t\t\t// Indexed array\n\t\t\t\t\tif (typeof name === 'number') {\n\t\t\t\t\t\tname = value;\n\t\t\t\t\t\tcompare_node = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!compare_node || isEq(dom.getAttrib(compare_node, name), value)) {\n\t\t\t\t\t\t// Keep internal classes\n\t\t\t\t\t\tif (name == 'class') {\n\t\t\t\t\t\t\tvalue = dom.getAttrib(node, name);\n\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\t// Build new class value where everything is removed except the internal prefixed classes\n\t\t\t\t\t\t\t\tvalueOut = '';\n\t\t\t\t\t\t\t\teach(value.split(/\\s+/), function(cls) {\n\t\t\t\t\t\t\t\t\tif (/mce\\-\\w+/.test(cls)) {\n\t\t\t\t\t\t\t\t\t\tvalueOut += (valueOut ? ' ' : '') + cls;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// We got some internal classes left\n\t\t\t\t\t\t\t\tif (valueOut) {\n\t\t\t\t\t\t\t\t\tdom.setAttrib(node, name, valueOut);\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// IE6 has a bug where the attribute doesn't get removed correctly\n\t\t\t\t\t\tif (name == \"class\") {\n\t\t\t\t\t\t\tnode.removeAttribute('className');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Remove mce prefixed attributes\n\t\t\t\t\t\tif (MCE_ATTR_RE.test(name)) {\n\t\t\t\t\t\t\tnode.removeAttribute('data-mce-' + name);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode.removeAttribute(name);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Remove classes\n\t\t\t\teach(format.classes, function(value) {\n\t\t\t\t\tvalue = replaceVars(value, vars);\n\n\t\t\t\t\tif (!compare_node || dom.hasClass(compare_node, value)) {\n\t\t\t\t\t\tdom.removeClass(node, value);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Check for non internal attributes\n\t\t\t\tattrs = dom.getAttribs(node);\n\t\t\t\tfor (i = 0; i < attrs.length; i++) {\n\t\t\t\t\tvar attrName = attrs[i].nodeName;\n\t\t\t\t\tif (attrName.indexOf('_') !== 0 && attrName.indexOf('data-') !== 0) {\n\t\t\t\t\t\treturn FALSE;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Remove the inline child if it's empty for example <b> or <span>\n\t\t\tif (format.remove != 'none') {\n\t\t\t\tremoveNode(node, format);\n\t\t\t\treturn TRUE;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Removes the node and wrap it's children in paragraphs before doing so or\n\t\t * appends BR elements to the beginning/end of the block element if forcedRootBlocks is disabled.\n\t\t *\n\t\t * If the div in the node below gets removed:\n\t\t *  text<div>text</div>text\n\t\t *\n\t\t * Output becomes:\n\t\t *  text<div><br />text<br /></div>text\n\t\t *\n\t\t * So when the div is removed the result is:\n\t\t *  text<br />text<br />text\n\t\t *\n\t\t * @private\n\t\t * @param {Node} node Node to remove + apply BR/P elements to.\n\t\t * @param {Object} format Format rule.\n\t\t * @return {Node} Input node.\n\t\t */\n\t\tfunction removeNode(node, format) {\n\t\t\tvar parentNode = node.parentNode, rootBlockElm;\n\n\t\t\tfunction find(node, next, inc) {\n\t\t\t\tnode = getNonWhiteSpaceSibling(node, next, inc);\n\n\t\t\t\treturn !node || (node.nodeName == 'BR' || isBlock(node));\n\t\t\t}\n\n\t\t\tif (format.block) {\n\t\t\t\tif (!forcedRootBlock) {\n\t\t\t\t\t// Append BR elements if needed before we remove the block\n\t\t\t\t\tif (isBlock(node) && !isBlock(parentNode)) {\n\t\t\t\t\t\tif (!find(node, FALSE) && !find(node.firstChild, TRUE, 1)) {\n\t\t\t\t\t\t\tnode.insertBefore(dom.create('br'), node.firstChild);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!find(node, TRUE) && !find(node.lastChild, FALSE, 1)) {\n\t\t\t\t\t\t\tnode.appendChild(dom.create('br'));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Wrap the block in a forcedRootBlock if we are at the root of document\n\t\t\t\t\tif (parentNode == dom.getRoot()) {\n\t\t\t\t\t\tif (!format.list_block || !isEq(node, format.list_block)) {\n\t\t\t\t\t\t\teach(grep(node.childNodes), function(node) {\n\t\t\t\t\t\t\t\tif (isValid(forcedRootBlock, node.nodeName.toLowerCase())) {\n\t\t\t\t\t\t\t\t\tif (!rootBlockElm) {\n\t\t\t\t\t\t\t\t\t\trootBlockElm = wrap(node, forcedRootBlock);\n\t\t\t\t\t\t\t\t\t\tdom.setAttribs(rootBlockElm, ed.settings.forced_root_block_attrs);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\trootBlockElm.appendChild(node);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\trootBlockElm = 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Never remove nodes that isn't the specified inline element if a selector is specified too\n\t\t\tif (format.selector && format.inline && !isEq(format.inline, node)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdom.remove(node, 1);\n\t\t}\n\n\t\t/**\n\t\t * Returns the next/previous non whitespace node.\n\t\t *\n\t\t * @private\n\t\t * @param {Node} node Node to start at.\n\t\t * @param {boolean} next (Optional) Include next or previous node defaults to previous.\n\t\t * @param {boolean} inc (Optional) Include the current node in checking. Defaults to false.\n\t\t * @return {Node} Next or previous node or undefined if it wasn't found.\n\t\t */\n\t\tfunction getNonWhiteSpaceSibling(node, next, inc) {\n\t\t\tif (node) {\n\t\t\t\tnext = next ? 'nextSibling' : 'previousSibling';\n\n\t\t\t\tfor (node = inc ? node : node[next]; node; node = node[next]) {\n\t\t\t\t\tif (node.nodeType == 1 || !isWhiteSpaceNode(node)) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Merges the next/previous sibling element if they match.\n\t\t *\n\t\t * @private\n\t\t * @param {Node} prev Previous node to compare/merge.\n\t\t * @param {Node} next Next node to compare/merge.\n\t\t * @return {Node} Next node if we didn't merge and prev node if we did.\n\t\t */\n\t\tfunction mergeSiblings(prev, next) {\n\t\t\tvar sibling, tmpSibling, elementUtils = new ElementUtils(dom);\n\n\t\t\tfunction findElementSibling(node, sibling_name) {\n\t\t\t\tfor (sibling = node; sibling; sibling = sibling[sibling_name]) {\n\t\t\t\t\tif (sibling.nodeType == 3 && sibling.nodeValue.length !== 0) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (sibling.nodeType == 1 && !isBookmarkNode(sibling)) {\n\t\t\t\t\t\treturn sibling;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\t// Check if next/prev exists and that they are elements\n\t\t\tif (prev && next) {\n\t\t\t\t// If previous sibling is empty then jump over it\n\t\t\t\tprev = findElementSibling(prev, 'previousSibling');\n\t\t\t\tnext = findElementSibling(next, 'nextSibling');\n\n\t\t\t\t// Compare next and previous nodes\n\t\t\t\tif (elementUtils.compare(prev, next)) {\n\t\t\t\t\t// Append nodes between\n\t\t\t\t\tfor (sibling = prev.nextSibling; sibling && sibling != next;) {\n\t\t\t\t\t\ttmpSibling = sibling;\n\t\t\t\t\t\tsibling = sibling.nextSibling;\n\t\t\t\t\t\tprev.appendChild(tmpSibling);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove next node\n\t\t\t\t\tdom.remove(next);\n\n\t\t\t\t\t// Move children into prev node\n\t\t\t\t\teach(grep(next.childNodes), function(node) {\n\t\t\t\t\t\tprev.appendChild(node);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn prev;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn next;\n\t\t}\n\n\t\tfunction getContainer(rng, start) {\n\t\t\tvar container, offset, lastIdx;\n\n\t\t\tcontainer = rng[start ? 'startContainer' : 'endContainer'];\n\t\t\toffset = rng[start ? 'startOffset' : 'endOffset'];\n\n\t\t\tif (container.nodeType == 1) {\n\t\t\t\tlastIdx = container.childNodes.length - 1;\n\n\t\t\t\tif (!start && offset) {\n\t\t\t\t\toffset--;\n\t\t\t\t}\n\n\t\t\t\tcontainer = container.childNodes[offset > lastIdx ? lastIdx : offset];\n\t\t\t}\n\n\t\t\t// If start text node is excluded then walk to the next node\n\t\t\tif (container.nodeType === 3 && start && offset >= container.nodeValue.length) {\n\t\t\t\tcontainer = new TreeWalker(container, ed.getBody()).next() || container;\n\t\t\t}\n\n\t\t\t// If end text node is excluded then walk to the previous node\n\t\t\tif (container.nodeType === 3 && !start && offset === 0) {\n\t\t\t\tcontainer = new TreeWalker(container, ed.getBody()).prev() || container;\n\t\t\t}\n\n\t\t\treturn container;\n\t\t}\n\n\t\tfunction performCaretAction(type, name, vars, similar) {\n\t\t\tvar caretContainerId = '_mce_caret', debug = ed.settings.caret_debug;\n\n\t\t\t// Creates a caret container bogus element\n\t\t\tfunction createCaretContainer(fill) {\n\t\t\t\tvar caretContainer = dom.create('span', {id: caretContainerId, 'data-mce-bogus': true, style: debug ? 'color:red' : ''});\n\n\t\t\t\tif (fill) {\n\t\t\t\t\tcaretContainer.appendChild(ed.getDoc().createTextNode(INVISIBLE_CHAR));\n\t\t\t\t}\n\n\t\t\t\treturn caretContainer;\n\t\t\t}\n\n\t\t\tfunction isCaretContainerEmpty(node, nodes) {\n\t\t\t\twhile (node) {\n\t\t\t\t\tif ((node.nodeType === 3 && node.nodeValue !== INVISIBLE_CHAR) || node.childNodes.length > 1) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Collect nodes\n\t\t\t\t\tif (nodes && node.nodeType === 1) {\n\t\t\t\t\t\tnodes.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.firstChild;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Returns any parent caret container element\n\t\t\tfunction getParentCaretContainer(node) {\n\t\t\t\twhile (node) {\n\t\t\t\t\tif (node.id === caretContainerId) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Finds the first text node in the specified node\n\t\t\tfunction findFirstTextNode(node) {\n\t\t\t\tvar walker;\n\n\t\t\t\tif (node) {\n\t\t\t\t\twalker = new TreeWalker(node, node);\n\n\t\t\t\t\tfor (node = walker.current(); node; node = walker.next()) {\n\t\t\t\t\t\tif (node.nodeType === 3) {\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Removes the caret container for the specified node or all on the current document\n\t\t\tfunction removeCaretContainer(node, move_caret) {\n\t\t\t\tvar child, rng;\n\n\t\t\t\tif (!node) {\n\t\t\t\t\tnode = getParentCaretContainer(selection.getStart());\n\n\t\t\t\t\tif (!node) {\n\t\t\t\t\t\twhile ((node = dom.get(caretContainerId))) {\n\t\t\t\t\t\t\tremoveCaretContainer(node, false);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\trng = selection.getRng(true);\n\n\t\t\t\t\tif (isCaretContainerEmpty(node)) {\n\t\t\t\t\t\tif (move_caret !== false) {\n\t\t\t\t\t\t\trng.setStartBefore(node);\n\t\t\t\t\t\t\trng.setEndBefore(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdom.remove(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchild = findFirstTextNode(node);\n\n\t\t\t\t\t\tif (child.nodeValue.charAt(0) === INVISIBLE_CHAR) {\n\t\t\t\t\t\t\tchild.deleteData(0, 1);\n\n\t\t\t\t\t\t\t// Fix for bug #6976\n\t\t\t\t\t\t\tif (rng.startContainer == child && rng.startOffset > 0) {\n\t\t\t\t\t\t\t\trng.setStart(child, rng.startOffset - 1);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (rng.endContainer == child && rng.endOffset > 0) {\n\t\t\t\t\t\t\t\trng.setEnd(child, rng.endOffset - 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdom.remove(node, 1);\n\t\t\t\t\t}\n\n\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Applies formatting to the caret position\n\t\t\tfunction applyCaretFormat() {\n\t\t\t\tvar rng, caretContainer, textNode, offset, bookmark, container, text;\n\n\t\t\t\trng = selection.getRng(true);\n\t\t\t\toffset = rng.startOffset;\n\t\t\t\tcontainer = rng.startContainer;\n\t\t\t\ttext = container.nodeValue;\n\n\t\t\t\tcaretContainer = getParentCaretContainer(selection.getStart());\n\t\t\t\tif (caretContainer) {\n\t\t\t\t\ttextNode = findFirstTextNode(caretContainer);\n\t\t\t\t}\n\n\t\t\t\t// Expand to word if caret is in the middle of a text node and the char before/after is a alpha numeric character\n\t\t\t\tvar wordcharRegex = /[^\\s\\u00a0\\u00ad\\u200b\\ufeff]/;\n\t\t\t\tif (text && offset > 0 && offset < text.length &&\n\t\t\t\t\twordcharRegex.test(text.charAt(offset)) && wordcharRegex.test(text.charAt(offset - 1))) {\n\t\t\t\t\t// Get bookmark of caret position\n\t\t\t\t\tbookmark = selection.getBookmark();\n\n\t\t\t\t\t// Collapse bookmark range (WebKit)\n\t\t\t\t\trng.collapse(true);\n\n\t\t\t\t\t// Expand the range to the closest word and split it at those points\n\t\t\t\t\trng = expandRng(rng, get(name));\n\t\t\t\t\trng = rangeUtils.split(rng);\n\n\t\t\t\t\t// Apply the format to the range\n\t\t\t\t\tapply(name, vars, rng);\n\n\t\t\t\t\t// Move selection back to caret position\n\t\t\t\t\tselection.moveToBookmark(bookmark);\n\t\t\t\t} else {\n\t\t\t\t\tif (!caretContainer || textNode.nodeValue !== INVISIBLE_CHAR) {\n\t\t\t\t\t\tcaretContainer = createCaretContainer(true);\n\t\t\t\t\t\ttextNode = caretContainer.firstChild;\n\n\t\t\t\t\t\trng.insertNode(caretContainer);\n\t\t\t\t\t\toffset = 1;\n\n\t\t\t\t\t\tapply(name, vars, caretContainer);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tapply(name, vars, caretContainer);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Move selection to text node\n\t\t\t\t\tselection.setCursorLocation(textNode, offset);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction removeCaretFormat() {\n\t\t\t\tvar rng = selection.getRng(true), container, offset, bookmark,\n\t\t\t\t\thasContentAfter, node, formatNode, parents = [], i, caretContainer;\n\n\t\t\t\tcontainer = rng.startContainer;\n\t\t\t\toffset = rng.startOffset;\n\t\t\t\tnode = container;\n\n\t\t\t\tif (container.nodeType == 3) {\n\t\t\t\t\tif (offset != container.nodeValue.length) {\n\t\t\t\t\t\thasContentAfter = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\n\t\t\t\twhile (node) {\n\t\t\t\t\tif (matchNode(node, name, vars, similar)) {\n\t\t\t\t\t\tformatNode = node;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.nextSibling) {\n\t\t\t\t\t\thasContentAfter = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tparents.push(node);\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\n\t\t\t\t// Node doesn't have the specified format\n\t\t\t\tif (!formatNode) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Is there contents after the caret then remove the format on the element\n\t\t\t\tif (hasContentAfter) {\n\t\t\t\t\t// Get bookmark of caret position\n\t\t\t\t\tbookmark = selection.getBookmark();\n\n\t\t\t\t\t// Collapse bookmark range (WebKit)\n\t\t\t\t\trng.collapse(true);\n\n\t\t\t\t\t// Expand the range to the closest word and split it at those points\n\t\t\t\t\trng = expandRng(rng, get(name), true);\n\t\t\t\t\trng = rangeUtils.split(rng);\n\n\t\t\t\t\t// Remove the format from the range\n\t\t\t\t\tremove(name, vars, rng);\n\n\t\t\t\t\t// Move selection back to caret position\n\t\t\t\t\tselection.moveToBookmark(bookmark);\n\t\t\t\t} else {\n\t\t\t\t\tcaretContainer = createCaretContainer();\n\n\t\t\t\t\tnode = caretContainer;\n\t\t\t\t\tfor (i = parents.length - 1; i >= 0; i--) {\n\t\t\t\t\t\tnode.appendChild(dom.clone(parents[i], false));\n\t\t\t\t\t\tnode = node.firstChild;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Insert invisible character into inner most format element\n\t\t\t\t\tnode.appendChild(dom.doc.createTextNode(INVISIBLE_CHAR));\n\t\t\t\t\tnode = node.firstChild;\n\n\t\t\t\t\tvar block = dom.getParent(formatNode, isTextBlock);\n\n\t\t\t\t\tif (block && dom.isEmpty(block)) {\n\t\t\t\t\t\t// Replace formatNode with caretContainer when removing format from empty block like <p><b>|</b></p>\n\t\t\t\t\t\tformatNode.parentNode.replaceChild(caretContainer, formatNode);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Insert caret container after the formatted node\n\t\t\t\t\t\tdom.insertAfter(caretContainer, formatNode);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Move selection to text node\n\t\t\t\t\tselection.setCursorLocation(node, 1);\n\n\t\t\t\t\t// If the formatNode is empty, we can remove it safely.\n\t\t\t\t\tif (dom.isEmpty(formatNode)) {\n\t\t\t\t\t\tdom.remove(formatNode);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Checks if the parent caret container node isn't empty if that is the case it\n\t\t\t// will remove the bogus state on all children that isn't empty\n\t\t\tfunction unmarkBogusCaretParents() {\n\t\t\t\tvar caretContainer;\n\n\t\t\t\tcaretContainer = getParentCaretContainer(selection.getStart());\n\t\t\t\tif (caretContainer && !dom.isEmpty(caretContainer)) {\n\t\t\t\t\twalk(caretContainer, function(node) {\n\t\t\t\t\t\tif (node.nodeType == 1 && node.id !== caretContainerId && !dom.isEmpty(node)) {\n\t\t\t\t\t\t\tdom.setAttrib(node, 'data-mce-bogus', null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 'childNodes');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Only bind the caret events once\n\t\t\tif (!ed._hasCaretEvents) {\n\t\t\t\t// Mark current caret container elements as bogus when getting the contents so we don't end up with empty elements\n\t\t\t\tmarkCaretContainersBogus = function() {\n\t\t\t\t\tvar nodes = [], i;\n\n\t\t\t\t\tif (isCaretContainerEmpty(getParentCaretContainer(selection.getStart()), nodes)) {\n\t\t\t\t\t\t// Mark children\n\t\t\t\t\t\ti = nodes.length;\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tdom.setAttrib(nodes[i], 'data-mce-bogus', '1');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tdisableCaretContainer = function(e) {\n\t\t\t\t\tvar keyCode = e.keyCode;\n\n\t\t\t\t\tremoveCaretContainer();\n\n\t\t\t\t\t// Remove caret container if it's empty\n\t\t\t\t\tif (keyCode == 8 && selection.isCollapsed() && selection.getStart().innerHTML == INVISIBLE_CHAR) {\n\t\t\t\t\t\tremoveCaretContainer(getParentCaretContainer(selection.getStart()));\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove caret container on keydown and it's left/right arrow keys\n\t\t\t\t\tif (keyCode == 37 || keyCode == 39) {\n\t\t\t\t\t\tremoveCaretContainer(getParentCaretContainer(selection.getStart()));\n\t\t\t\t\t}\n\n\t\t\t\t\tunmarkBogusCaretParents();\n\t\t\t\t};\n\n\t\t\t\t// Remove bogus state if they got filled by contents using editor.selection.setContent\n\t\t\t\ted.on('SetContent', function(e) {\n\t\t\t\t\tif (e.selection) {\n\t\t\t\t\t\tunmarkBogusCaretParents();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ted._hasCaretEvents = true;\n\t\t\t}\n\n\t\t\t// Do apply or remove caret format\n\t\t\tif (type == \"apply\") {\n\t\t\t\tapplyCaretFormat();\n\t\t\t} else {\n\t\t\t\tremoveCaretFormat();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Moves the start to the first suitable text node.\n\t\t */\n\t\tfunction moveStart(rng) {\n\t\t\tvar container = rng.startContainer,\n\t\t\t\t\toffset = rng.startOffset, isAtEndOfText,\n\t\t\t\t\twalker, node, nodes, tmpNode;\n\n\t\t\tif (rng.startContainer == rng.endContainer) {\n\t\t\t\tif (isInlineBlock(rng.startContainer.childNodes[rng.startOffset])) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Convert text node into index if possible\n\t\t\tif (container.nodeType == 3 && offset >= container.nodeValue.length) {\n\t\t\t\t// Get the parent container location and walk from there\n\t\t\t\toffset = nodeIndex(container);\n\t\t\t\tcontainer = container.parentNode;\n\t\t\t\tisAtEndOfText = true;\n\t\t\t}\n\n\t\t\t// Move startContainer/startOffset in to a suitable node\n\t\t\tif (container.nodeType == 1) {\n\t\t\t\tnodes = container.childNodes;\n\t\t\t\tcontainer = nodes[Math.min(offset, nodes.length - 1)];\n\t\t\t\twalker = new TreeWalker(container, dom.getParent(container, dom.isBlock));\n\n\t\t\t\t// If offset is at end of the parent node walk to the next one\n\t\t\t\tif (offset > nodes.length - 1 || isAtEndOfText) {\n\t\t\t\t\twalker.next();\n\t\t\t\t}\n\n\t\t\t\tfor (node = walker.current(); node; node = walker.next()) {\n\t\t\t\t\tif (node.nodeType == 3 && !isWhiteSpaceNode(node)) {\n\t\t\t\t\t\t// IE has a \"neat\" feature where it moves the start node into the closest element\n\t\t\t\t\t\t// we can avoid this by inserting an element before it and then remove it after we set the selection\n\t\t\t\t\t\ttmpNode = dom.create('a', {'data-mce-bogus': 'all'}, INVISIBLE_CHAR);\n\t\t\t\t\t\tnode.parentNode.insertBefore(tmpNode, node);\n\n\t\t\t\t\t\t// Set selection and remove tmpNode\n\t\t\t\t\t\trng.setStart(node, 0);\n\t\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t\t\tdom.remove(tmpNode);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/undo/Diff.js\n\n/**\n * Diff.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * JS Implementation of the O(ND) Difference Algorithm by Eugene W. Myers.\n *\n * @class tinymce.undo.Diff\n * @private\n */\ndefine(\"tinymce/undo/Diff\", [\n], function () {\n\tvar KEEP = 0, INSERT = 1, DELETE = 2;\n\n\tvar diff = function (left, right) {\n\t\tvar size = left.length + right.length + 2;\n\t\tvar vDown = new Array(size);\n\t\tvar vUp = new Array(size);\n\n\t\tvar snake = function (start, end, diag) {\n\t\t\treturn {\n\t\t\t\tstart: start,\n\t\t\t\tend: end,\n\t\t\t\tdiag: diag\n\t\t\t};\n\t\t};\n\n\t\tvar buildScript = function (start1, end1, start2, end2, script) {\n\t\t\tvar middle = getMiddleSnake(start1, end1, start2, end2);\n\n\t\t\tif (middle === null || middle.start === end1 && middle.diag === end1 - end2 ||\n\t\t\t\tmiddle.end === start1 && middle.diag === start1 - start2) {\n\t\t\t\tvar i = start1;\n\t\t\t\tvar j = start2;\n\t\t\t\twhile (i < end1 || j < end2) {\n\t\t\t\t\tif (i < end1 && j < end2 && left[i] === right[j]) {\n\t\t\t\t\t\tscript.push([KEEP, left[i]]);\n\t\t\t\t\t\t++i;\n\t\t\t\t\t\t++j;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (end1 - start1 > end2 - start2) {\n\t\t\t\t\t\t\tscript.push([DELETE, left[i]]);\n\t\t\t\t\t\t\t++i;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tscript.push([INSERT, right[j]]);\n\t\t\t\t\t\t\t++j;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbuildScript(start1, middle.start, start2, middle.start - middle.diag, script);\n\t\t\t\tfor (var i2 = middle.start; i2 < middle.end; ++i2) {\n\t\t\t\t\tscript.push([KEEP, left[i2]]);\n\t\t\t\t}\n\t\t\t\tbuildScript(middle.end, end1, middle.end - middle.diag, end2, script);\n\t\t\t}\n\t\t};\n\n\t\tvar buildSnake = function (start, diag, end1, end2) {\n\t\t\tvar end = start;\n\t\t\twhile (end - diag < end2 && end < end1 && left[end] === right[end - diag]) {\n\t\t\t\t++end;\n\t\t\t}\n\t\t\treturn snake(start, end, diag);\n\t\t};\n\n\t\tvar getMiddleSnake = function (start1, end1, start2, end2) {\n\t\t\t// Myers Algorithm\n\t\t\t// Initialisations\n\t\t\tvar m = end1 - start1;\n\t\t\tvar n = end2 - start2;\n\t\t\tif (m === 0 || n === 0) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tvar delta = m - n;\n\t\t\tvar sum = n + m;\n\t\t\tvar offset = (sum % 2 === 0 ? sum : sum + 1) / 2;\n\t\t\tvDown[1 + offset] = start1;\n\t\t\tvUp[1 + offset] = end1 + 1;\n\n\t\t\tfor (var d = 0; d <= offset; ++d) {\n\t\t\t\t// Down\n\t\t\t\tfor (var k = -d; k <= d; k += 2) {\n\t\t\t\t\t// First step\n\n\t\t\t\t\tvar i = k + offset;\n\t\t\t\t\tif (k === -d || k != d && vDown[i - 1] < vDown[i + 1]) {\n\t\t\t\t\t\tvDown[i] = vDown[i + 1];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvDown[i] = vDown[i - 1] + 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar x = vDown[i];\n\t\t\t\t\tvar y = x - start1 + start2 - k;\n\n\t\t\t\t\twhile (x < end1 && y < end2 && left[x] === right[y]) {\n\t\t\t\t\t\tvDown[i] = ++x;\n\t\t\t\t\t\t++y;\n\t\t\t\t\t}\n\t\t\t\t\t// Second step\n\t\t\t\t\tif (delta % 2 != 0 && delta - d <= k && k <= delta + d) {\n\t\t\t\t\t\tif (vUp[i - delta] <= vDown[i]) {\n\t\t\t\t\t\t\treturn buildSnake(vUp[i - delta], k + start1 - start2, end1, end2);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Up\n\t\t\t\tfor (k = delta - d; k <= delta + d; k += 2) {\n\t\t\t\t\t// First step\n\t\t\t\t\ti = k + offset - delta;\n\t\t\t\t\tif (k === delta - d || k != delta + d && vUp[i + 1] <= vUp[i - 1]) {\n\t\t\t\t\t\tvUp[i] = vUp[i + 1] - 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvUp[i] = vUp[i - 1];\n\t\t\t\t\t}\n\n\t\t\t\t\tx = vUp[i] - 1;\n\t\t\t\t\ty = x - start1 + start2 - k;\n\t\t\t\t\twhile (x >= start1 && y >= start2 && left[x] === right[y]) {\n\t\t\t\t\t\tvUp[i] = x--;\n\t\t\t\t\t\ty--;\n\t\t\t\t\t}\n\t\t\t\t\t// Second step\n\t\t\t\t\tif (delta % 2 === 0 && -d <= k && k <= d) {\n\t\t\t\t\t\tif (vUp[i] <= vDown[i + delta]) {\n\t\t\t\t\t\t\treturn buildSnake(vUp[i], k + start1 - start2, end1, end2);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tvar script = [];\n\t\tbuildScript(0, left.length, 0, right.length, script);\n\t\treturn script;\n\t};\n\n\treturn {\n\t\tKEEP: KEEP,\n\t\tDELETE: DELETE,\n\t\tINSERT: INSERT,\n\t\tdiff: diff\n\t};\n});\n\n// Included from: js/tinymce/classes/undo/Fragments.js\n\n/**\n * Fragments.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module reads and applies html fragments from/to dom nodes.\n *\n * @class tinymce.undo.Fragments\n * @private\n */\ndefine(\"tinymce/undo/Fragments\", [\n\t\"tinymce/util/Arr\",\n\t\"tinymce/html/Entities\",\n\t\"tinymce/undo/Diff\"\n], function (Arr, Entities, Diff) {\n\tvar getOuterHtml = function (elm) {\n\t\tif (elm.nodeType === 1) {\n\t\t\treturn elm.outerHTML;\n\t\t} else if (elm.nodeType === 3) {\n\t\t\treturn Entities.encodeRaw(elm.data, false);\n\t\t} else if (elm.nodeType === 8) {\n\t\t\treturn '<!--' + elm.data + '-->';\n\t\t}\n\n\t\treturn '';\n\t};\n\n\tvar createFragment = function(html) {\n\t\tvar frag, node, container;\n\n\t\tcontainer = document.createElement(\"div\");\n\t\tfrag = document.createDocumentFragment();\n\n\t\tif (html) {\n\t\t\tcontainer.innerHTML = html;\n\t\t}\n\n\t\twhile ((node = container.firstChild)) {\n\t\t\tfrag.appendChild(node);\n\t\t}\n\n\t\treturn frag;\n\t};\n\n\tvar insertAt = function (elm, html, index) {\n\t\tvar fragment = createFragment(html);\n\t\tif (elm.hasChildNodes() && index < elm.childNodes.length) {\n\t\t\tvar target = elm.childNodes[index];\n\t\t\ttarget.parentNode.insertBefore(fragment, target);\n\t\t} else {\n\t\t\telm.appendChild(fragment);\n\t\t}\n\t};\n\n\tvar removeAt = function (elm, index) {\n\t\tif (elm.hasChildNodes() && index < elm.childNodes.length) {\n\t\t\tvar target = elm.childNodes[index];\n\t\t\ttarget.parentNode.removeChild(target);\n\t\t}\n\t};\n\n\tvar applyDiff = function (diff, elm) {\n\t\tvar index = 0;\n\t\tArr.each(diff, function (action) {\n\t\t\tif (action[0] === Diff.KEEP) {\n\t\t\t\tindex++;\n\t\t\t} else if (action[0] === Diff.INSERT) {\n\t\t\t\tinsertAt(elm, action[1], index);\n\t\t\t\tindex++;\n\t\t\t} else if (action[0] === Diff.DELETE) {\n\t\t\t\tremoveAt(elm, index);\n\t\t\t}\n\t\t});\n\t};\n\n\tvar read = function (elm) {\n\t\treturn Arr.map(elm.childNodes, getOuterHtml);\n\t};\n\n\tvar write = function (fragments, elm) {\n\t\tvar currentFragments = Arr.map(elm.childNodes, getOuterHtml);\n\t\tapplyDiff(Diff.diff(currentFragments, fragments), elm);\n\t\treturn elm;\n\t};\n\n\treturn {\n\t\tread: read,\n\t\twrite: write\n\t};\n});\n\n// Included from: js/tinymce/classes/undo/Levels.js\n\n/**\n * Levels.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module handles getting/setting undo levels to/from editor instances.\n *\n * @class tinymce.undo.Levels\n * @private\n */\ndefine(\"tinymce/undo/Levels\", [\n\t\"tinymce/util/Arr\",\n\t\"tinymce/undo/Fragments\"\n], function (Arr, Fragments) {\n\tvar hasIframes = function (html) {\n\t\treturn html.indexOf('</iframe>') !== -1;\n\t};\n\n\tvar createFragmentedLevel = function (fragments) {\n\t\treturn {\n\t\t\ttype: 'fragmented',\n\t\t\tfragments: fragments,\n\t\t\tcontent: '',\n\t\t\tbookmark: null,\n\t\t\tbeforeBookmark: null\n\t\t};\n\t};\n\n\tvar createCompleteLevel = function (content) {\n\t\treturn {\n\t\t\ttype: 'complete',\n\t\t\tfragments: null,\n\t\t\tcontent: content,\n\t\t\tbookmark: null,\n\t\t\tbeforeBookmark: null\n\t\t};\n\t};\n\n\tvar createFromEditor = function (editor) {\n\t\tvar fragments, content, trimmedFragments;\n\n\t\tfragments = Fragments.read(editor.getBody());\n\t\ttrimmedFragments = Arr.map(fragments, function (html) {\n\t\t\treturn editor.serializer.trimContent(html);\n\t\t});\n\t\tcontent = trimmedFragments.join('');\n\n\t\treturn hasIframes(content) ? createFragmentedLevel(trimmedFragments) : createCompleteLevel(content);\n\t};\n\n\tvar applyToEditor = function (editor, level, before) {\n\t\tif (level.type === 'fragmented') {\n\t\t\tFragments.write(level.fragments, editor.getBody());\n\t\t} else {\n\t\t\teditor.setContent(level.content, {format: 'raw'});\n\t\t}\n\n\t\teditor.selection.moveToBookmark(before ? level.beforeBookmark : level.bookmark);\n\t};\n\n\tvar getLevelContent = function (level) {\n\t\treturn level.type === 'fragmented' ? level.fragments.join('') : level.content;\n\t};\n\n\tvar isEq = function (level1, level2) {\n\t\treturn getLevelContent(level1) === getLevelContent(level2);\n\t};\n\n\treturn {\n\t\tcreateFragmentedLevel: createFragmentedLevel,\n\t\tcreateCompleteLevel: createCompleteLevel,\n\t\tcreateFromEditor: createFromEditor,\n\t\tapplyToEditor: applyToEditor,\n\t\tisEq: isEq\n\t};\n});\n\n// Included from: js/tinymce/classes/UndoManager.js\n\n/**\n * UndoManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles the undo/redo history levels for the editor. Since the built-in undo/redo has major drawbacks a custom one was needed.\n *\n * @class tinymce.UndoManager\n */\ndefine(\"tinymce/UndoManager\", [\n\t\"tinymce/util/VK\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/undo/Levels\"\n], function(VK, Tools, Levels) {\n\treturn function(editor) {\n\t\tvar self = this, index = 0, data = [], beforeBookmark, isFirstTypedCharacter, locks = 0;\n\n\t\tfunction setDirty(state) {\n\t\t\teditor.setDirty(state);\n\t\t}\n\n\t\tfunction addNonTypingUndoLevel(e) {\n\t\t\tself.typing = false;\n\t\t\tself.add({}, e);\n\t\t}\n\n\t\tfunction endTyping() {\n\t\t\tif (self.typing) {\n\t\t\t\tself.typing = false;\n\t\t\t\tself.add();\n\t\t\t}\n\t\t}\n\n\t\t// Add initial undo level when the editor is initialized\n\t\teditor.on('init', function() {\n\t\t\tself.add();\n\t\t});\n\n\t\t// Get position before an execCommand is processed\n\t\teditor.on('BeforeExecCommand', function(e) {\n\t\t\tvar cmd = e.command;\n\n\t\t\tif (cmd !== 'Undo' && cmd !== 'Redo' && cmd !== 'mceRepaint') {\n\t\t\t\tendTyping();\n\t\t\t\tself.beforeChange();\n\t\t\t}\n\t\t});\n\n\t\t// Add undo level after an execCommand call was made\n\t\teditor.on('ExecCommand', function(e) {\n\t\t\tvar cmd = e.command;\n\n\t\t\tif (cmd !== 'Undo' && cmd !== 'Redo' && cmd !== 'mceRepaint') {\n\t\t\t\taddNonTypingUndoLevel(e);\n\t\t\t}\n\t\t});\n\n\t\teditor.on('ObjectResizeStart Cut', function() {\n\t\t\tself.beforeChange();\n\t\t});\n\n\t\teditor.on('SaveContent ObjectResized blur', addNonTypingUndoLevel);\n\t\teditor.on('DragEnd', addNonTypingUndoLevel);\n\n\t\teditor.on('KeyUp', function(e) {\n\t\t\tvar keyCode = e.keyCode;\n\n\t\t\t// If key is prevented then don't add undo level\n\t\t\t// This would happen on keyboard shortcuts for example\n\t\t\tif (e.isDefaultPrevented()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ((keyCode >= 33 && keyCode <= 36) || (keyCode >= 37 && keyCode <= 40) || keyCode === 45 || e.ctrlKey) {\n\t\t\t\taddNonTypingUndoLevel();\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\n\t\t\tif (keyCode === 46 || keyCode === 8) {\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\n\t\t\t// Fire a TypingUndo event on the first character entered\n\t\t\tif (isFirstTypedCharacter && self.typing) {\n\t\t\t\t// Make it dirty if the content was changed after typing the first character\n\t\t\t\tif (!editor.isDirty()) {\n\t\t\t\t\tsetDirty(data[0] && !Levels.isEq(Levels.createFromEditor(editor), data[0]));\n\n\t\t\t\t\t// Fire initial change event\n\t\t\t\t\tif (editor.isDirty()) {\n\t\t\t\t\t\teditor.fire('change', {level: data[0], lastLevel: null});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\teditor.fire('TypingUndo');\n\t\t\t\tisFirstTypedCharacter = false;\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\t\t});\n\n\t\teditor.on('KeyDown', function(e) {\n\t\t\tvar keyCode = e.keyCode;\n\n\t\t\t// If key is prevented then don't add undo level\n\t\t\t// This would happen on keyboard shortcuts for example\n\t\t\tif (e.isDefaultPrevented()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Is character position keys left,right,up,down,home,end,pgdown,pgup,enter\n\t\t\tif ((keyCode >= 33 && keyCode <= 36) || (keyCode >= 37 && keyCode <= 40) || keyCode === 45) {\n\t\t\t\tif (self.typing) {\n\t\t\t\t\taddNonTypingUndoLevel(e);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// If key isn't Ctrl+Alt/AltGr\n\t\t\tvar modKey = (e.ctrlKey && !e.altKey) || e.metaKey;\n\t\t\tif ((keyCode < 16 || keyCode > 20) && keyCode !== 224 && keyCode !== 91 && !self.typing && !modKey) {\n\t\t\t\tself.beforeChange();\n\t\t\t\tself.typing = true;\n\t\t\t\tself.add({}, e);\n\t\t\t\tisFirstTypedCharacter = true;\n\t\t\t}\n\t\t});\n\n\t\teditor.on('MouseDown', function(e) {\n\t\t\tif (self.typing) {\n\t\t\t\taddNonTypingUndoLevel(e);\n\t\t\t}\n\t\t});\n\n\t\t// Add keyboard shortcuts for undo/redo keys\n\t\teditor.addShortcut('meta+z', '', 'Undo');\n\t\teditor.addShortcut('meta+y,meta+shift+z', '', 'Redo');\n\n\t\teditor.on('AddUndo Undo Redo ClearUndos', function(e) {\n\t\t\tif (!e.isDefaultPrevented()) {\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\t\t});\n\n\t\t/*eslint consistent-this:0 */\n\t\tself = {\n\t\t\t// Explode for debugging reasons\n\t\t\tdata: data,\n\n\t\t\t/**\n\t\t\t * State if the user is currently typing or not. This will add a typing operation into one undo\n\t\t\t * level instead of one new level for each keystroke.\n\t\t\t *\n\t\t\t * @field {Boolean} typing\n\t\t\t */\n\t\t\ttyping: false,\n\n\t\t\t/**\n\t\t\t * Stores away a bookmark to be used when performing an undo action so that the selection is before\n\t\t\t * the change has been made.\n\t\t\t *\n\t\t\t * @method beforeChange\n\t\t\t */\n\t\t\tbeforeChange: function() {\n\t\t\t\tif (!locks) {\n\t\t\t\t\tbeforeBookmark = editor.selection.getBookmark(2, true);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds a new undo level/snapshot to the undo list.\n\t\t\t *\n\t\t\t * @method add\n\t\t\t * @param {Object} level Optional undo level object to add.\n\t\t\t * @param {DOMEvent} event Optional event responsible for the creation of the undo level.\n\t\t\t * @return {Object} Undo level that got added or null it a level wasn't needed.\n\t\t\t */\n\t\t\tadd: function(level, event) {\n\t\t\t\tvar i, settings = editor.settings, lastLevel, currentLevel;\n\n\t\t\t\tcurrentLevel = Levels.createFromEditor(editor);\n\t\t\t\tlevel = level || {};\n\t\t\t\tlevel = Tools.extend(level, currentLevel);\n\n\t\t\t\tif (locks || editor.removed) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tlastLevel = data[index];\n\t\t\t\tif (editor.fire('BeforeAddUndo', {level: level, lastLevel: lastLevel, originalEvent: event}).isDefaultPrevented()) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\t// Add undo level if needed\n\t\t\t\tif (lastLevel && Levels.isEq(lastLevel, level)) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\t// Set before bookmark on previous level\n\t\t\t\tif (data[index]) {\n\t\t\t\t\tdata[index].beforeBookmark = beforeBookmark;\n\t\t\t\t}\n\n\t\t\t\t// Time to compress\n\t\t\t\tif (settings.custom_undo_redo_levels) {\n\t\t\t\t\tif (data.length > settings.custom_undo_redo_levels) {\n\t\t\t\t\t\tfor (i = 0; i < data.length - 1; i++) {\n\t\t\t\t\t\t\tdata[i] = data[i + 1];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdata.length--;\n\t\t\t\t\t\tindex = data.length;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Get a non intrusive normalized bookmark\n\t\t\t\tlevel.bookmark = editor.selection.getBookmark(2, true);\n\n\t\t\t\t// Crop array if needed\n\t\t\t\tif (index < data.length - 1) {\n\t\t\t\t\tdata.length = index + 1;\n\t\t\t\t}\n\n\t\t\t\tdata.push(level);\n\t\t\t\tindex = data.length - 1;\n\n\t\t\t\tvar args = {level: level, lastLevel: lastLevel, originalEvent: event};\n\n\t\t\t\teditor.fire('AddUndo', args);\n\n\t\t\t\tif (index > 0) {\n\t\t\t\t\tsetDirty(true);\n\t\t\t\t\teditor.fire('change', args);\n\t\t\t\t}\n\n\t\t\t\treturn level;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Undoes the last action.\n\t\t\t *\n\t\t\t * @method undo\n\t\t\t * @return {Object} Undo level or null if no undo was performed.\n\t\t\t */\n\t\t\tundo: function() {\n\t\t\t\tvar level;\n\n\t\t\t\tif (self.typing) {\n\t\t\t\t\tself.add();\n\t\t\t\t\tself.typing = false;\n\t\t\t\t}\n\n\t\t\t\tif (index > 0) {\n\t\t\t\t\tlevel = data[--index];\n\t\t\t\t\tLevels.applyToEditor(editor, level, true);\n\t\t\t\t\tsetDirty(true);\n\t\t\t\t\teditor.fire('undo', {level: level});\n\t\t\t\t}\n\n\t\t\t\treturn level;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Redoes the last action.\n\t\t\t *\n\t\t\t * @method redo\n\t\t\t * @return {Object} Redo level or null if no redo was performed.\n\t\t\t */\n\t\t\tredo: function() {\n\t\t\t\tvar level;\n\n\t\t\t\tif (index < data.length - 1) {\n\t\t\t\t\tlevel = data[++index];\n\t\t\t\t\tLevels.applyToEditor(editor, level, false);\n\t\t\t\t\tsetDirty(true);\n\t\t\t\t\teditor.fire('redo', {level: level});\n\t\t\t\t}\n\n\t\t\t\treturn level;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Removes all undo levels.\n\t\t\t *\n\t\t\t * @method clear\n\t\t\t */\n\t\t\tclear: function() {\n\t\t\t\tdata = [];\n\t\t\t\tindex = 0;\n\t\t\t\tself.typing = false;\n\t\t\t\tself.data = data;\n\t\t\t\teditor.fire('ClearUndos');\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Returns true/false if the undo manager has any undo levels.\n\t\t\t *\n\t\t\t * @method hasUndo\n\t\t\t * @return {Boolean} true/false if the undo manager has any undo levels.\n\t\t\t */\n\t\t\thasUndo: function() {\n\t\t\t\t// Has undo levels or typing and content isn't the same as the initial level\n\t\t\t\treturn index > 0 || (self.typing && data[0] && !Levels.isEq(Levels.createFromEditor(editor), data[0]));\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Returns true/false if the undo manager has any redo levels.\n\t\t\t *\n\t\t\t * @method hasRedo\n\t\t\t * @return {Boolean} true/false if the undo manager has any redo levels.\n\t\t\t */\n\t\t\thasRedo: function() {\n\t\t\t\treturn index < data.length - 1 && !self.typing;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Executes the specified mutator function as an undo transaction. The selection\n\t\t\t * before the modification will be stored to the undo stack and if the DOM changes\n\t\t\t * it will add a new undo level. Any methods within the translation that adds undo levels will\n\t\t\t * be ignored. So a translation can include calls to execCommand or editor.insertContent.\n\t\t\t *\n\t\t\t * @method transact\n\t\t\t * @param {function} callback Function that gets executed and has dom manipulation logic in it.\n\t\t\t * @return {Object} Undo level that got added or null it a level wasn't needed.\n\t\t\t */\n\t\t\ttransact: function(callback) {\n\t\t\t\tendTyping();\n\t\t\t\tself.beforeChange();\n\n\t\t\t\ttry {\n\t\t\t\t\tlocks++;\n\t\t\t\t\tcallback();\n\t\t\t\t} finally {\n\t\t\t\t\tlocks--;\n\t\t\t\t}\n\n\t\t\t\treturn self.add();\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds an extra \"hidden\" undo level by first applying the first mutation and store that to the undo stack\n\t\t\t * then roll back that change and do the second mutation on top of the stack. This will produce an extra\n\t\t\t * undo level that the user doesn't see until they undo.\n\t\t\t *\n\t\t\t * @method extra\n\t\t\t * @param {function} callback1 Function that does mutation but gets stored as a \"hidden\" extra undo level.\n\t\t\t * @param {function} callback2 Function that does mutation but gets displayed to the user.\n\t\t\t */\n\t\t\textra: function (callback1, callback2) {\n\t\t\t\tvar lastLevel, bookmark;\n\n\t\t\t\tif (self.transact(callback1)) {\n\t\t\t\t\tbookmark = data[index].bookmark;\n\t\t\t\t\tlastLevel = data[index - 1];\n\t\t\t\t\tLevels.applyToEditor(editor, lastLevel, true);\n\n\t\t\t\t\tif (self.transact(callback2)) {\n\t\t\t\t\t\tdata[index - 1].beforeBookmark = bookmark;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn self;\n\t};\n});\n\n// Included from: js/tinymce/classes/EnterKey.js\n\n/**\n * EnterKey.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Contains logic for handling the enter key to split/generate block elements.\n *\n * @private\n * @class tinymce.EnterKey\n */\ndefine(\"tinymce/EnterKey\", [\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/caret/CaretContainer\",\n\t\"tinymce/Env\"\n], function(TreeWalker, RangeUtils, CaretContainer, Env) {\n\tvar isIE = Env.ie && Env.ie < 11;\n\n\treturn function(editor) {\n\t\tvar dom = editor.dom, selection = editor.selection, settings = editor.settings;\n\t\tvar undoManager = editor.undoManager, schema = editor.schema, nonEmptyElementsMap = schema.getNonEmptyElements(),\n\t\t\tmoveCaretBeforeOnEnterElementsMap = schema.getMoveCaretBeforeOnEnterElements();\n\n\t\tfunction handleEnterKey(evt) {\n\t\t\tvar rng, tmpRng, editableRoot, container, offset, parentBlock, documentMode, shiftKey,\n\t\t\t\tnewBlock, fragment, containerBlock, parentBlockName, containerBlockName, newBlockName, isAfterLastNodeInContainer;\n\n\t\t\t// Returns true if the block can be split into two blocks or not\n\t\t\tfunction canSplitBlock(node) {\n\t\t\t\treturn node &&\n\t\t\t\t\tdom.isBlock(node) &&\n\t\t\t\t\t!/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName) &&\n\t\t\t\t\t!/^(fixed|absolute)/i.test(node.style.position) &&\n\t\t\t\t\tdom.getContentEditable(node) !== \"true\";\n\t\t\t}\n\n\t\t\tfunction isTableCell(node) {\n\t\t\t\treturn node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\n\t\t\t}\n\n\t\t\t// Renders empty block on IE\n\t\t\tfunction renderBlockOnIE(block) {\n\t\t\t\tvar oldRng;\n\n\t\t\t\tif (dom.isBlock(block)) {\n\t\t\t\t\toldRng = selection.getRng();\n\t\t\t\t\tblock.appendChild(dom.create('span', null, '\\u00a0'));\n\t\t\t\t\tselection.select(block);\n\t\t\t\t\tblock.lastChild.outerHTML = '';\n\t\t\t\t\tselection.setRng(oldRng);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Remove the first empty inline element of the block so this: <p><b><em></em></b>x</p> becomes this: <p>x</p>\n\t\t\tfunction trimInlineElementsOnLeftSideOfBlock(block) {\n\t\t\t\tvar node = block, firstChilds = [], i;\n\n\t\t\t\tif (!node) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Find inner most first child ex: <p><i><b>*</b></i></p>\n\t\t\t\twhile ((node = node.firstChild)) {\n\t\t\t\t\tif (dom.isBlock(node)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.nodeType == 1 && !nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n\t\t\t\t\t\tfirstChilds.push(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ti = firstChilds.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = firstChilds[i];\n\t\t\t\t\tif (!node.hasChildNodes() || (node.firstChild == node.lastChild && node.firstChild.nodeValue === '')) {\n\t\t\t\t\t\tdom.remove(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Remove <a> </a> see #5381\n\t\t\t\t\t\tif (node.nodeName == \"A\" && (node.innerText || node.textContent) === ' ') {\n\t\t\t\t\t\t\tdom.remove(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Moves the caret to a suitable position within the root for example in the first non\n\t\t\t// pure whitespace text node or before an image\n\t\t\tfunction moveToCaretPosition(root) {\n\t\t\t\tvar walker, node, rng, lastNode = root, tempElm;\n\t\t\t\tfunction firstNonWhiteSpaceNodeSibling(node) {\n\t\t\t\t\twhile (node) {\n\t\t\t\t\t\tif (node.nodeType == 1 || (node.nodeType == 3 && node.data && /[\\r\\n\\s]/.test(node.data))) {\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!root) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Old IE versions doesn't properly render blocks with br elements in them\n\t\t\t\t// For example <p><br></p> wont be rendered correctly in a contentEditable area\n\t\t\t\t// until you remove the br producing <p></p>\n\t\t\t\tif (Env.ie && Env.ie < 9 && parentBlock && parentBlock.firstChild) {\n\t\t\t\t\tif (parentBlock.firstChild == parentBlock.lastChild && parentBlock.firstChild.tagName == 'BR') {\n\t\t\t\t\t\tdom.remove(parentBlock.firstChild);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (/^(LI|DT|DD)$/.test(root.nodeName)) {\n\t\t\t\t\tvar firstChild = firstNonWhiteSpaceNodeSibling(root.firstChild);\n\n\t\t\t\t\tif (firstChild && /^(UL|OL|DL)$/.test(firstChild.nodeName)) {\n\t\t\t\t\t\troot.insertBefore(dom.doc.createTextNode('\\u00a0'), root.firstChild);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\trng = dom.createRng();\n\n\t\t\t\t// Normalize whitespace to remove empty text nodes. Fix for: #6904\n\t\t\t\t// Gecko will be able to place the caret in empty text nodes but it won't render propery\n\t\t\t\t// Older IE versions will sometimes crash so for now ignore all IE versions\n\t\t\t\tif (!Env.ie) {\n\t\t\t\t\troot.normalize();\n\t\t\t\t}\n\n\t\t\t\tif (root.hasChildNodes()) {\n\t\t\t\t\twalker = new TreeWalker(root, root);\n\n\t\t\t\t\twhile ((node = walker.current())) {\n\t\t\t\t\t\tif (node.nodeType == 3) {\n\t\t\t\t\t\t\trng.setStart(node, 0);\n\t\t\t\t\t\t\trng.setEnd(node, 0);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]) {\n\t\t\t\t\t\t\trng.setStartBefore(node);\n\t\t\t\t\t\t\trng.setEndBefore(node);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlastNode = node;\n\t\t\t\t\t\tnode = walker.next();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!node) {\n\t\t\t\t\t\trng.setStart(lastNode, 0);\n\t\t\t\t\t\trng.setEnd(lastNode, 0);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (root.nodeName == 'BR') {\n\t\t\t\t\t\tif (root.nextSibling && dom.isBlock(root.nextSibling)) {\n\t\t\t\t\t\t\t// Trick on older IE versions to render the caret before the BR between two lists\n\t\t\t\t\t\t\tif (!documentMode || documentMode < 9) {\n\t\t\t\t\t\t\t\ttempElm = dom.create('br');\n\t\t\t\t\t\t\t\troot.parentNode.insertBefore(tempElm, root);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\trng.setStartBefore(root);\n\t\t\t\t\t\t\trng.setEndBefore(root);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setStartAfter(root);\n\t\t\t\t\t\t\trng.setEndAfter(root);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng.setStart(root, 0);\n\t\t\t\t\t\trng.setEnd(root, 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tselection.setRng(rng);\n\n\t\t\t\t// Remove tempElm created for old IE:s\n\t\t\t\tdom.remove(tempElm);\n\t\t\t\tselection.scrollIntoView(root);\n\t\t\t}\n\n\t\t\tfunction setForcedBlockAttrs(node) {\n\t\t\t\tvar forcedRootBlockName = settings.forced_root_block;\n\n\t\t\t\tif (forcedRootBlockName && forcedRootBlockName.toLowerCase() === node.tagName.toLowerCase()) {\n\t\t\t\t\tdom.setAttribs(node, settings.forced_root_block_attrs);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction emptyBlock(elm) {\n\t\t\t\t// BR is needed in empty blocks on non IE browsers\n\t\t\t\telm.innerHTML = !isIE ? '<br data-mce-bogus=\"1\">' : '';\n\t\t\t}\n\n\t\t\t// Creates a new block element by cloning the current one or creating a new one if the name is specified\n\t\t\t// This function will also copy any text formatting from the parent block and add it to the new one\n\t\t\tfunction createNewBlock(name) {\n\t\t\t\tvar node = container, block, clonedNode, caretNode, textInlineElements = schema.getTextInlineElements();\n\n\t\t\t\tif (name || parentBlockName == \"TABLE\") {\n\t\t\t\t\tblock = dom.create(name || newBlockName);\n\t\t\t\t\tsetForcedBlockAttrs(block);\n\t\t\t\t} else {\n\t\t\t\t\tblock = parentBlock.cloneNode(false);\n\t\t\t\t}\n\n\t\t\t\tcaretNode = block;\n\n\t\t\t\t// Clone any parent styles\n\t\t\t\tif (settings.keep_styles !== false) {\n\t\t\t\t\tdo {\n\t\t\t\t\t\tif (textInlineElements[node.nodeName]) {\n\t\t\t\t\t\t\t// Never clone a caret containers\n\t\t\t\t\t\t\tif (node.id == '_mce_caret') {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tclonedNode = node.cloneNode(false);\n\t\t\t\t\t\t\tdom.setAttrib(clonedNode, 'id', ''); // Remove ID since it needs to be document unique\n\n\t\t\t\t\t\t\tif (block.hasChildNodes()) {\n\t\t\t\t\t\t\t\tclonedNode.appendChild(block.firstChild);\n\t\t\t\t\t\t\t\tblock.appendChild(clonedNode);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcaretNode = clonedNode;\n\t\t\t\t\t\t\t\tblock.appendChild(clonedNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} while ((node = node.parentNode) && node != editableRoot);\n\t\t\t\t}\n\n\t\t\t\t// BR is needed in empty blocks on non IE browsers\n\t\t\t\tif (!isIE) {\n\t\t\t\t\tcaretNode.innerHTML = '<br data-mce-bogus=\"1\">';\n\t\t\t\t}\n\n\t\t\t\treturn block;\n\t\t\t}\n\n\t\t\t// Returns true/false if the caret is at the start/end of the parent block element\n\t\t\tfunction isCaretAtStartOrEndOfBlock(start) {\n\t\t\t\tvar walker, node, name;\n\n\t\t\t\t// Caret is in the middle of a text node like \"a|b\"\n\t\t\t\tif (container.nodeType == 3 && (start ? offset > 0 : offset < container.nodeValue.length)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// If after the last element in block node edge case for #5091\n\t\t\t\tif (container.parentNode == parentBlock && isAfterLastNodeInContainer && !start) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// If the caret if before the first element in parentBlock\n\t\t\t\tif (start && container.nodeType == 1 && container == parentBlock.firstChild) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// Caret can be before/after a table\n\t\t\t\tif (container.nodeName === \"TABLE\" || (container.previousSibling && container.previousSibling.nodeName == \"TABLE\")) {\n\t\t\t\t\treturn (isAfterLastNodeInContainer && !start) || (!isAfterLastNodeInContainer && start);\n\t\t\t\t}\n\n\t\t\t\t// Walk the DOM and look for text nodes or non empty elements\n\t\t\t\twalker = new TreeWalker(container, parentBlock);\n\n\t\t\t\t// If caret is in beginning or end of a text block then jump to the next/previous node\n\t\t\t\tif (container.nodeType == 3) {\n\t\t\t\t\tif (start && offset === 0) {\n\t\t\t\t\t\twalker.prev();\n\t\t\t\t\t} else if (!start && offset == container.nodeValue.length) {\n\t\t\t\t\t\twalker.next();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twhile ((node = walker.current())) {\n\t\t\t\t\tif (node.nodeType === 1) {\n\t\t\t\t\t\t// Ignore bogus elements\n\t\t\t\t\t\tif (!node.getAttribute('data-mce-bogus')) {\n\t\t\t\t\t\t\t// Keep empty elements like <img /> <input /> but not trailing br:s like <p>text|<br></p>\n\t\t\t\t\t\t\tname = node.nodeName.toLowerCase();\n\t\t\t\t\t\t\tif (nonEmptyElementsMap[name] && name !== 'br') {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (node.nodeType === 3 && !/^[ \\t\\r\\n]*$/.test(node.nodeValue)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\twalker.prev();\n\t\t\t\t\t} else {\n\t\t\t\t\t\twalker.next();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Wraps any text nodes or inline elements in the specified forced root block name\n\t\t\tfunction wrapSelfAndSiblingsInDefaultBlock(container, offset) {\n\t\t\t\tvar newBlock, parentBlock, startNode, node, next, rootBlockName, blockName = newBlockName || 'P';\n\n\t\t\t\t// Not in a block element or in a table cell or caption\n\t\t\t\tparentBlock = dom.getParent(container, dom.isBlock);\n\t\t\t\tif (!parentBlock || !canSplitBlock(parentBlock)) {\n\t\t\t\t\tparentBlock = parentBlock || editableRoot;\n\n\t\t\t\t\tif (parentBlock == editor.getBody() || isTableCell(parentBlock)) {\n\t\t\t\t\t\trootBlockName = parentBlock.nodeName.toLowerCase();\n\t\t\t\t\t} else {\n\t\t\t\t\t\trootBlockName = parentBlock.parentNode.nodeName.toLowerCase();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!parentBlock.hasChildNodes()) {\n\t\t\t\t\t\tnewBlock = dom.create(blockName);\n\t\t\t\t\t\tsetForcedBlockAttrs(newBlock);\n\t\t\t\t\t\tparentBlock.appendChild(newBlock);\n\t\t\t\t\t\trng.setStart(newBlock, 0);\n\t\t\t\t\t\trng.setEnd(newBlock, 0);\n\t\t\t\t\t\treturn newBlock;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Find parent that is the first child of parentBlock\n\t\t\t\t\tnode = container;\n\t\t\t\t\twhile (node.parentNode != parentBlock) {\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Loop left to find start node start wrapping at\n\t\t\t\t\twhile (node && !dom.isBlock(node)) {\n\t\t\t\t\t\tstartNode = node;\n\t\t\t\t\t\tnode = node.previousSibling;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (startNode && schema.isValidChild(rootBlockName, blockName.toLowerCase())) {\n\t\t\t\t\t\tnewBlock = dom.create(blockName);\n\t\t\t\t\t\tsetForcedBlockAttrs(newBlock);\n\t\t\t\t\t\tstartNode.parentNode.insertBefore(newBlock, startNode);\n\n\t\t\t\t\t\t// Start wrapping until we hit a block\n\t\t\t\t\t\tnode = startNode;\n\t\t\t\t\t\twhile (node && !dom.isBlock(node)) {\n\t\t\t\t\t\t\tnext = node.nextSibling;\n\t\t\t\t\t\t\tnewBlock.appendChild(node);\n\t\t\t\t\t\t\tnode = next;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Restore range to it's past location\n\t\t\t\t\t\trng.setStart(container, offset);\n\t\t\t\t\t\trng.setEnd(container, offset);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\t// Inserts a block or br before/after or in the middle of a split list of the LI is empty\n\t\t\tfunction handleEmptyListItem() {\n\t\t\t\tfunction isFirstOrLastLi(first) {\n\t\t\t\t\tvar node = containerBlock[first ? 'firstChild' : 'lastChild'];\n\n\t\t\t\t\t// Find first/last element since there might be whitespace there\n\t\t\t\t\twhile (node) {\n\t\t\t\t\t\tif (node.nodeType == 1) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node[first ? 'nextSibling' : 'previousSibling'];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node === parentBlock;\n\t\t\t\t}\n\n\t\t\t\tfunction getContainerBlock() {\n\t\t\t\t\tvar containerBlockParent = containerBlock.parentNode;\n\n\t\t\t\t\tif (/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)) {\n\t\t\t\t\t\treturn containerBlockParent;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn containerBlock;\n\t\t\t\t}\n\n\t\t\t\tif (containerBlock == editor.getBody()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Check if we are in an nested list\n\t\t\t\tvar containerBlockParentName = containerBlock.parentNode.nodeName;\n\t\t\t\tif (/^(OL|UL|LI)$/.test(containerBlockParentName)) {\n\t\t\t\t\tnewBlockName = 'LI';\n\t\t\t\t}\n\n\t\t\t\tnewBlock = newBlockName ? createNewBlock(newBlockName) : dom.create('BR');\n\n\t\t\t\tif (isFirstOrLastLi(true) && isFirstOrLastLi()) {\n\t\t\t\t\tif (containerBlockParentName == 'LI') {\n\t\t\t\t\t\t// Nested list is inside a LI\n\t\t\t\t\t\tdom.insertAfter(newBlock, getContainerBlock());\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Is first and last list item then replace the OL/UL with a text block\n\t\t\t\t\t\tdom.replace(newBlock, containerBlock);\n\t\t\t\t\t}\n\t\t\t\t} else if (isFirstOrLastLi(true)) {\n\t\t\t\t\tif (containerBlockParentName == 'LI') {\n\t\t\t\t\t\t// List nested in an LI then move the list to a new sibling LI\n\t\t\t\t\t\tdom.insertAfter(newBlock, getContainerBlock());\n\t\t\t\t\t\tnewBlock.appendChild(dom.doc.createTextNode(' ')); // Needed for IE so the caret can be placed\n\t\t\t\t\t\tnewBlock.appendChild(containerBlock);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// First LI in list then remove LI and add text block before list\n\t\t\t\t\t\tcontainerBlock.parentNode.insertBefore(newBlock, containerBlock);\n\t\t\t\t\t}\n\t\t\t\t} else if (isFirstOrLastLi()) {\n\t\t\t\t\t// Last LI in list then remove LI and add text block after list\n\t\t\t\t\tdom.insertAfter(newBlock, getContainerBlock());\n\t\t\t\t\trenderBlockOnIE(newBlock);\n\t\t\t\t} else {\n\t\t\t\t\t// Middle LI in list the split the list and insert a text block in the middle\n\t\t\t\t\t// Extract after fragment and insert it after the current block\n\t\t\t\t\tcontainerBlock = getContainerBlock();\n\t\t\t\t\ttmpRng = rng.cloneRange();\n\t\t\t\t\ttmpRng.setStartAfter(parentBlock);\n\t\t\t\t\ttmpRng.setEndAfter(containerBlock);\n\t\t\t\t\tfragment = tmpRng.extractContents();\n\n\t\t\t\t\tif (newBlockName == 'LI' && fragment.firstChild.nodeName == 'LI') {\n\t\t\t\t\t\tnewBlock = fragment.firstChild;\n\t\t\t\t\t\tdom.insertAfter(fragment, containerBlock);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdom.insertAfter(fragment, containerBlock);\n\t\t\t\t\t\tdom.insertAfter(newBlock, containerBlock);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tdom.remove(parentBlock);\n\t\t\t\tmoveToCaretPosition(newBlock);\n\t\t\t\tundoManager.add();\n\t\t\t}\n\n\t\t\t// Inserts a BR element if the forced_root_block option is set to false or empty string\n\t\t\tfunction insertBr() {\n\t\t\t\teditor.execCommand(\"InsertLineBreak\", false, evt);\n\t\t\t}\n\n\t\t\t// Trims any linebreaks at the beginning of node user for example when pressing enter in a PRE element\n\t\t\tfunction trimLeadingLineBreaks(node) {\n\t\t\t\tdo {\n\t\t\t\t\tif (node.nodeType === 3) {\n\t\t\t\t\t\tnode.nodeValue = node.nodeValue.replace(/^[\\r\\n]+/, '');\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.firstChild;\n\t\t\t\t} while (node);\n\t\t\t}\n\n\t\t\tfunction getEditableRoot(node) {\n\t\t\t\tvar root = dom.getRoot(), parent, editableRoot;\n\n\t\t\t\t// Get all parents until we hit a non editable parent or the root\n\t\t\t\tparent = node;\n\t\t\t\twhile (parent !== root && dom.getContentEditable(parent) !== \"false\") {\n\t\t\t\t\tif (dom.getContentEditable(parent) === \"true\") {\n\t\t\t\t\t\teditableRoot = parent;\n\t\t\t\t\t}\n\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn parent !== root ? editableRoot : root;\n\t\t\t}\n\n\t\t\t// Adds a BR at the end of blocks that only contains an IMG or INPUT since\n\t\t\t// these might be floated and then they won't expand the block\n\t\t\tfunction addBrToBlockIfNeeded(block) {\n\t\t\t\tvar lastChild;\n\n\t\t\t\t// IE will render the blocks correctly other browsers needs a BR\n\t\t\t\tif (!isIE) {\n\t\t\t\t\tblock.normalize(); // Remove empty text nodes that got left behind by the extract\n\n\t\t\t\t\t// Check if the block is empty or contains a floated last child\n\t\t\t\t\tlastChild = block.lastChild;\n\t\t\t\t\tif (!lastChild || (/^(left|right)$/gi.test(dom.getStyle(lastChild, 'float', true)))) {\n\t\t\t\t\t\tdom.add(block, 'br');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction insertNewBlockAfter() {\n\t\t\t\t// If the caret is at the end of a header we produce a P tag after it similar to Word unless we are in a hgroup\n\t\t\t\tif (/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName) && containerBlockName != 'HGROUP') {\n\t\t\t\t\tnewBlock = createNewBlock(newBlockName);\n\t\t\t\t} else {\n\t\t\t\t\tnewBlock = createNewBlock();\n\t\t\t\t}\n\n\t\t\t\t// Split the current container block element if enter is pressed inside an empty inner block element\n\t\t\t\tif (settings.end_container_on_empty_block && canSplitBlock(containerBlock) && dom.isEmpty(parentBlock)) {\n\t\t\t\t\t// Split container block for example a BLOCKQUOTE at the current blockParent location for example a P\n\t\t\t\t\tnewBlock = dom.split(containerBlock, parentBlock);\n\t\t\t\t} else {\n\t\t\t\t\tdom.insertAfter(newBlock, parentBlock);\n\t\t\t\t}\n\n\t\t\t\tmoveToCaretPosition(newBlock);\n\t\t\t}\n\n\t\t\trng = selection.getRng(true);\n\n\t\t\t// Event is blocked by some other handler for example the lists plugin\n\t\t\tif (evt.isDefaultPrevented()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Delete any selected contents\n\t\t\tif (!rng.collapsed) {\n\t\t\t\teditor.execCommand('Delete');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Setup range items and newBlockName\n\t\t\tnew RangeUtils(dom).normalize(rng);\n\t\t\tcontainer = rng.startContainer;\n\t\t\toffset = rng.startOffset;\n\t\t\tnewBlockName = (settings.force_p_newlines ? 'p' : '') || settings.forced_root_block;\n\t\t\tnewBlockName = newBlockName ? newBlockName.toUpperCase() : '';\n\t\t\tdocumentMode = dom.doc.documentMode;\n\t\t\tshiftKey = evt.shiftKey;\n\n\t\t\t// Resolve node index\n\t\t\tif (container.nodeType == 1 && container.hasChildNodes()) {\n\t\t\t\tisAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n\n\t\t\t\tcontainer = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n\t\t\t\tif (isAfterLastNodeInContainer && container.nodeType == 3) {\n\t\t\t\t\toffset = container.nodeValue.length;\n\t\t\t\t} else {\n\t\t\t\t\toffset = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Get editable root node, normally the body element but sometimes a div or span\n\t\t\teditableRoot = getEditableRoot(container);\n\n\t\t\t// If there is no editable root then enter is done inside a contentEditable false element\n\t\t\tif (!editableRoot) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tundoManager.beforeChange();\n\n\t\t\t// If editable root isn't block nor the root of the editor\n\t\t\tif (!dom.isBlock(editableRoot) && editableRoot != dom.getRoot()) {\n\t\t\t\tif (!newBlockName || shiftKey) {\n\t\t\t\t\tinsertBr();\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Wrap the current node and it's sibling in a default block if it's needed.\n\t\t\t// for example this <td>text|<b>text2</b></td> will become this <td><p>text|<b>text2</p></b></td>\n\t\t\t// This won't happen if root blocks are disabled or the shiftKey is pressed\n\t\t\tif ((newBlockName && !shiftKey) || (!newBlockName && shiftKey)) {\n\t\t\t\tcontainer = wrapSelfAndSiblingsInDefaultBlock(container, offset);\n\t\t\t}\n\n\t\t\t// Find parent block and setup empty block paddings\n\t\t\tparentBlock = dom.getParent(container, dom.isBlock);\n\t\t\tcontainerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n\n\t\t\t// Setup block names\n\t\t\tparentBlockName = parentBlock ? parentBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5\n\t\t\tcontainerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5\n\n\t\t\t// Enter inside block contained within a LI then split or insert before/after LI\n\t\t\tif (containerBlockName == 'LI' && !evt.ctrlKey) {\n\t\t\t\tparentBlock = containerBlock;\n\t\t\t\tparentBlockName = containerBlockName;\n\t\t\t}\n\n\t\t\tif (editor.undoManager.typing) {\n\t\t\t\teditor.undoManager.typing = false;\n\t\t\t\teditor.undoManager.add();\n\t\t\t}\n\n\t\t\t// Handle enter in list item\n\t\t\tif (/^(LI|DT|DD)$/.test(parentBlockName)) {\n\t\t\t\tif (!newBlockName && shiftKey) {\n\t\t\t\t\tinsertBr();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Handle enter inside an empty list item\n\t\t\t\tif (dom.isEmpty(parentBlock)) {\n\t\t\t\t\thandleEmptyListItem();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Don't split PRE tags but insert a BR instead easier when writing code samples etc\n\t\t\tif (parentBlockName == 'PRE' && settings.br_in_pre !== false) {\n\t\t\t\tif (!shiftKey) {\n\t\t\t\t\tinsertBr();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// If no root block is configured then insert a BR by default or if the shiftKey is pressed\n\t\t\t\tif ((!newBlockName && !shiftKey && parentBlockName != 'LI') || (newBlockName && shiftKey)) {\n\t\t\t\t\tinsertBr();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If parent block is root then never insert new blocks\n\t\t\tif (newBlockName && parentBlock === editor.getBody()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Default block name if it's not configured\n\t\t\tnewBlockName = newBlockName || 'P';\n\n\t\t\t// Insert new block before/after the parent block depending on caret location\n\t\t\tif (CaretContainer.isCaretContainerBlock(parentBlock)) {\n\t\t\t\tnewBlock = CaretContainer.showCaretContainerBlock(parentBlock);\n\t\t\t\tif (dom.isEmpty(parentBlock)) {\n\t\t\t\t\temptyBlock(parentBlock);\n\t\t\t\t}\n\t\t\t\tmoveToCaretPosition(newBlock);\n\t\t\t} else if (isCaretAtStartOrEndOfBlock()) {\n\t\t\t\tinsertNewBlockAfter();\n\t\t\t} else if (isCaretAtStartOrEndOfBlock(true)) {\n\t\t\t\t// Insert new block before\n\t\t\t\tnewBlock = parentBlock.parentNode.insertBefore(createNewBlock(), parentBlock);\n\t\t\t\trenderBlockOnIE(newBlock);\n\t\t\t\tmoveToCaretPosition(parentBlock);\n\t\t\t} else {\n\t\t\t\t// Extract after fragment and insert it after the current block\n\t\t\t\ttmpRng = rng.cloneRange();\n\t\t\t\ttmpRng.setEndAfter(parentBlock);\n\t\t\t\tfragment = tmpRng.extractContents();\n\t\t\t\ttrimLeadingLineBreaks(fragment);\n\t\t\t\tnewBlock = fragment.firstChild;\n\t\t\t\tdom.insertAfter(fragment, parentBlock);\n\t\t\t\ttrimInlineElementsOnLeftSideOfBlock(newBlock);\n\t\t\t\taddBrToBlockIfNeeded(parentBlock);\n\n\t\t\t\tif (dom.isEmpty(parentBlock)) {\n\t\t\t\t\temptyBlock(parentBlock);\n\t\t\t\t}\n\n\t\t\t\tnewBlock.normalize();\n\n\t\t\t\t// New block might become empty if it's <p><b>a |</b></p>\n\t\t\t\tif (dom.isEmpty(newBlock)) {\n\t\t\t\t\tdom.remove(newBlock);\n\t\t\t\t\tinsertNewBlockAfter();\n\t\t\t\t} else {\n\t\t\t\t\tmoveToCaretPosition(newBlock);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdom.setAttrib(newBlock, 'id', ''); // Remove ID since it needs to be document unique\n\n\t\t\t// Allow custom handling of new blocks\n\t\t\teditor.fire('NewBlock', {newBlock: newBlock});\n\n\t\t\tundoManager.typing = false;\n\t\t\tundoManager.add();\n\t\t}\n\n\t\teditor.on('keydown', function(evt) {\n\t\t\tif (evt.keyCode == 13) {\n\t\t\t\tif (handleEnterKey(evt) !== false) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n});\n\n// Included from: js/tinymce/classes/ForceBlocks.js\n\n/**\n * ForceBlocks.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Makes sure that everything gets wrapped in paragraphs.\n *\n * @private\n * @class tinymce.ForceBlocks\n */\ndefine(\"tinymce/ForceBlocks\", [], function() {\n\treturn function(editor) {\n\t\tvar settings = editor.settings, dom = editor.dom, selection = editor.selection;\n\t\tvar schema = editor.schema, blockElements = schema.getBlockElements();\n\n\t\tfunction addRootBlocks() {\n\t\t\tvar node = selection.getStart(), rootNode = editor.getBody(), rng;\n\t\t\tvar startContainer, startOffset, endContainer, endOffset, rootBlockNode;\n\t\t\tvar tempNode, offset = -0xFFFFFF, wrapped, restoreSelection;\n\t\t\tvar tmpRng, rootNodeName, forcedRootBlock;\n\n\t\t\tforcedRootBlock = settings.forced_root_block;\n\n\t\t\tif (!node || node.nodeType !== 1 || !forcedRootBlock) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check if node is wrapped in block\n\t\t\twhile (node && node != rootNode) {\n\t\t\t\tif (blockElements[node.nodeName]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\t// Get current selection\n\t\t\trng = selection.getRng();\n\t\t\tif (rng.setStart) {\n\t\t\t\tstartContainer = rng.startContainer;\n\t\t\t\tstartOffset = rng.startOffset;\n\t\t\t\tendContainer = rng.endContainer;\n\t\t\t\tendOffset = rng.endOffset;\n\n\t\t\t\ttry {\n\t\t\t\t\trestoreSelection = editor.getDoc().activeElement === rootNode;\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// IE throws unspecified error here sometimes\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Force control range into text range\n\t\t\t\tif (rng.item) {\n\t\t\t\t\tnode = rng.item(0);\n\t\t\t\t\trng = editor.getDoc().body.createTextRange();\n\t\t\t\t\trng.moveToElementText(node);\n\t\t\t\t}\n\n\t\t\t\trestoreSelection = rng.parentElement().ownerDocument === editor.getDoc();\n\t\t\t\ttmpRng = rng.duplicate();\n\t\t\t\ttmpRng.collapse(true);\n\t\t\t\tstartOffset = tmpRng.move('character', offset) * -1;\n\n\t\t\t\tif (!tmpRng.collapsed) {\n\t\t\t\t\ttmpRng = rng.duplicate();\n\t\t\t\t\ttmpRng.collapse(false);\n\t\t\t\t\tendOffset = (tmpRng.move('character', offset) * -1) - startOffset;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Wrap non block elements and text nodes\n\t\t\tnode = rootNode.firstChild;\n\t\t\trootNodeName = rootNode.nodeName.toLowerCase();\n\t\t\twhile (node) {\n\t\t\t\t// TODO: Break this up, too complex\n\t\t\t\tif (((node.nodeType === 3 || (node.nodeType == 1 && !blockElements[node.nodeName]))) &&\n\t\t\t\t\tschema.isValidChild(rootNodeName, forcedRootBlock.toLowerCase())) {\n\t\t\t\t\t// Remove empty text nodes\n\t\t\t\t\tif (node.nodeType === 3 && node.nodeValue.length === 0) {\n\t\t\t\t\t\ttempNode = node;\n\t\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t\t\tdom.remove(tempNode);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!rootBlockNode) {\n\t\t\t\t\t\trootBlockNode = dom.create(forcedRootBlock, editor.settings.forced_root_block_attrs);\n\t\t\t\t\t\tnode.parentNode.insertBefore(rootBlockNode, node);\n\t\t\t\t\t\twrapped = true;\n\t\t\t\t\t}\n\n\t\t\t\t\ttempNode = node;\n\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t\trootBlockNode.appendChild(tempNode);\n\t\t\t\t} else {\n\t\t\t\t\trootBlockNode = null;\n\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (wrapped && restoreSelection) {\n\t\t\t\tif (rng.setStart) {\n\t\t\t\t\trng.setStart(startContainer, startOffset);\n\t\t\t\t\trng.setEnd(endContainer, endOffset);\n\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t} else {\n\t\t\t\t\t// Only select if the previous selection was inside the document to prevent auto focus in quirks mode\n\t\t\t\t\ttry {\n\t\t\t\t\t\trng = editor.getDoc().body.createTextRange();\n\t\t\t\t\t\trng.moveToElementText(rootNode);\n\t\t\t\t\t\trng.collapse(true);\n\t\t\t\t\t\trng.moveStart('character', startOffset);\n\n\t\t\t\t\t\tif (endOffset > 0) {\n\t\t\t\t\t\t\trng.moveEnd('character', endOffset);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\trng.select();\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// Ignore\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\t\t}\n\n\t\t// Force root blocks\n\t\tif (settings.forced_root_block) {\n\t\t\teditor.on('NodeChange', addRootBlocks);\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/CaretUtils.js\n\n/**\n * CaretUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility functions shared by the caret logic.\n *\n * @private\n * @class tinymce.caret.CaretUtils\n */\ndefine(\"tinymce/caret/CaretUtils\", [\n\t\"tinymce/util/Fun\",\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/caret/CaretContainer\",\n\t\"tinymce/caret/CaretCandidate\"\n], function(Fun, TreeWalker, NodeType, CaretPosition, CaretContainer, CaretCandidate) {\n\tvar isContentEditableTrue = NodeType.isContentEditableTrue,\n\t\tisContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tisBlockLike = NodeType.matchStyleValues('display', 'block table table-cell table-caption'),\n\t\tisCaretContainer = CaretContainer.isCaretContainer,\n\t\tisCaretContainerBlock = CaretContainer.isCaretContainerBlock,\n\t\tcurry = Fun.curry,\n\t\tisElement = NodeType.isElement,\n\t\tisCaretCandidate = CaretCandidate.isCaretCandidate;\n\n\tfunction isForwards(direction) {\n\t\treturn direction > 0;\n\t}\n\n\tfunction isBackwards(direction) {\n\t\treturn direction < 0;\n\t}\n\n\tfunction skipCaretContainers(walk, shallow) {\n\t\tvar node;\n\n\t\twhile ((node = walk(shallow))) {\n\t\t\tif (!isCaretContainerBlock(node)) {\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction findNode(node, direction, predicateFn, rootNode, shallow) {\n\t\tvar walker = new TreeWalker(node, rootNode);\n\n\t\tif (isBackwards(direction)) {\n\t\t\tif (isContentEditableFalse(node) || isCaretContainerBlock(node)) {\n\t\t\t\tnode = skipCaretContainers(walker.prev, true);\n\t\t\t\tif (predicateFn(node)) {\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile ((node = skipCaretContainers(walker.prev, shallow))) {\n\t\t\t\tif (predicateFn(node)) {\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (isForwards(direction)) {\n\t\t\tif (isContentEditableFalse(node) || isCaretContainerBlock(node)) {\n\t\t\t\tnode = skipCaretContainers(walker.next, true);\n\t\t\t\tif (predicateFn(node)) {\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile ((node = skipCaretContainers(walker.next, shallow))) {\n\t\t\t\tif (predicateFn(node)) {\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction getEditingHost(node, rootNode) {\n\t\tfor (node = node.parentNode; node && node != rootNode; node = node.parentNode) {\n\t\t\tif (isContentEditableTrue(node)) {\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\n\t\treturn rootNode;\n\t}\n\n\tfunction getParentBlock(node, rootNode) {\n\t\twhile (node && node != rootNode) {\n\t\t\tif (isBlockLike(node)) {\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction isInSameBlock(caretPosition1, caretPosition2, rootNode) {\n\t\treturn getParentBlock(caretPosition1.container(), rootNode) == getParentBlock(caretPosition2.container(), rootNode);\n\t}\n\n\tfunction isInSameEditingHost(caretPosition1, caretPosition2, rootNode) {\n\t\treturn getEditingHost(caretPosition1.container(), rootNode) == getEditingHost(caretPosition2.container(), rootNode);\n\t}\n\n\tfunction getChildNodeAtRelativeOffset(relativeOffset, caretPosition) {\n\t\tvar container, offset;\n\n\t\tif (!caretPosition) {\n\t\t\treturn null;\n\t\t}\n\n\t\tcontainer = caretPosition.container();\n\t\toffset = caretPosition.offset();\n\n\t\tif (!isElement(container)) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn container.childNodes[offset + relativeOffset];\n\t}\n\n\tfunction beforeAfter(before, node) {\n\t\tvar range = node.ownerDocument.createRange();\n\n\t\tif (before) {\n\t\t\trange.setStartBefore(node);\n\t\t\trange.setEndBefore(node);\n\t\t} else {\n\t\t\trange.setStartAfter(node);\n\t\t\trange.setEndAfter(node);\n\t\t}\n\n\t\treturn range;\n\t}\n\n\tfunction isNodesInSameBlock(rootNode, node1, node2) {\n\t\treturn getParentBlock(node1, rootNode) == getParentBlock(node2, rootNode);\n\t}\n\n\tfunction lean(left, rootNode, node) {\n\t\tvar sibling, siblingName;\n\n\t\tif (left) {\n\t\t\tsiblingName = 'previousSibling';\n\t\t} else {\n\t\t\tsiblingName = 'nextSibling';\n\t\t}\n\n\t\twhile (node && node != rootNode) {\n\t\t\tsibling = node[siblingName];\n\n\t\t\tif (isCaretContainer(sibling)) {\n\t\t\t\tsibling = sibling[siblingName];\n\t\t\t}\n\n\t\t\tif (isContentEditableFalse(sibling)) {\n\t\t\t\tif (isNodesInSameBlock(rootNode, sibling, node)) {\n\t\t\t\t\treturn sibling;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (isCaretCandidate(sibling)) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tvar before = curry(beforeAfter, true);\n\tvar after = curry(beforeAfter, false);\n\n\tfunction normalizeRange(direction, rootNode, range) {\n\t\tvar node, container, offset, location;\n\t\tvar leanLeft = curry(lean, true, rootNode);\n\t\tvar leanRight = curry(lean, false, rootNode);\n\n\t\tcontainer = range.startContainer;\n\t\toffset = range.startOffset;\n\n\t\tif (CaretContainer.isCaretContainerBlock(container)) {\n\t\t\tif (!isElement(container)) {\n\t\t\t\tcontainer = container.parentNode;\n\t\t\t}\n\n\t\t\tlocation = container.getAttribute('data-mce-caret');\n\n\t\t\tif (location == 'before') {\n\t\t\t\tnode = container.nextSibling;\n\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\treturn before(node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (location == 'after') {\n\t\t\t\tnode = container.previousSibling;\n\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\treturn after(node);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!range.collapsed) {\n\t\t\treturn range;\n\t\t}\n\n\t\tif (NodeType.isText(container)) {\n\t\t\tif (isCaretContainer(container)) {\n\t\t\t\tif (direction === 1) {\n\t\t\t\t\tnode = leanRight(container);\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn before(node);\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = leanLeft(container);\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn after(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (direction === -1) {\n\t\t\t\t\tnode = leanLeft(container);\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn after(node);\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = leanRight(container);\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn before(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn range;\n\t\t\t}\n\n\t\t\tif (CaretContainer.endsWithCaretContainer(container) && offset >= container.data.length - 1) {\n\t\t\t\tif (direction === 1) {\n\t\t\t\t\tnode = leanRight(container);\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn before(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn range;\n\t\t\t}\n\n\t\t\tif (CaretContainer.startsWithCaretContainer(container) && offset <= 1) {\n\t\t\t\tif (direction === -1) {\n\t\t\t\t\tnode = leanLeft(container);\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn after(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn range;\n\t\t\t}\n\n\t\t\tif (offset === container.data.length) {\n\t\t\t\tnode = leanRight(container);\n\t\t\t\tif (node) {\n\t\t\t\t\treturn before(node);\n\t\t\t\t}\n\n\t\t\t\treturn range;\n\t\t\t}\n\n\t\t\tif (offset === 0) {\n\t\t\t\tnode = leanLeft(container);\n\t\t\t\tif (node) {\n\t\t\t\t\treturn after(node);\n\t\t\t\t}\n\n\t\t\t\treturn range;\n\t\t\t}\n\t\t}\n\n\t\treturn range;\n\t}\n\n\tfunction isNextToContentEditableFalse(relativeOffset, caretPosition) {\n\t\treturn isContentEditableFalse(getChildNodeAtRelativeOffset(relativeOffset, caretPosition));\n\t}\n\n\treturn {\n\t\tisForwards: isForwards,\n\t\tisBackwards: isBackwards,\n\t\tfindNode: findNode,\n\t\tgetEditingHost: getEditingHost,\n\t\tgetParentBlock: getParentBlock,\n\t\tisInSameBlock: isInSameBlock,\n\t\tisInSameEditingHost: isInSameEditingHost,\n\t\tisBeforeContentEditableFalse: curry(isNextToContentEditableFalse, 0),\n\t\tisAfterContentEditableFalse: curry(isNextToContentEditableFalse, -1),\n\t\tnormalizeRange: normalizeRange\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/CaretWalker.js\n\n/**\n * CaretWalker.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module contains logic for moving around a virtual caret in logical order within a DOM element.\n *\n * It ignores the most obvious invalid caret locations such as within a script element or within a\n * contentEditable=false element but it will return locations that isn't possible to render visually.\n *\n * @private\n * @class tinymce.caret.CaretWalker\n * @example\n * var caretWalker = new CaretWalker(rootElm);\n *\n * var prevLogicalCaretPosition = caretWalker.prev(CaretPosition.fromRangeStart(range));\n * var nextLogicalCaretPosition = caretWalker.next(CaretPosition.fromRangeEnd(range));\n */\ndefine(\"tinymce/caret/CaretWalker\", [\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/caret/CaretCandidate\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/caret/CaretUtils\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/util/Fun\"\n], function(NodeType, CaretCandidate, CaretPosition, CaretUtils, Arr, Fun) {\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tisText = NodeType.isText,\n\t\tisElement = NodeType.isElement,\n\t\tisBr = NodeType.isBr,\n\t\tisForwards = CaretUtils.isForwards,\n\t\tisBackwards = CaretUtils.isBackwards,\n\t\tisCaretCandidate = CaretCandidate.isCaretCandidate,\n\t\tisAtomic = CaretCandidate.isAtomic,\n\t\tisEditableCaretCandidate = CaretCandidate.isEditableCaretCandidate;\n\n\tfunction getParents(node, rootNode) {\n\t\tvar parents = [];\n\n\t\twhile (node && node != rootNode) {\n\t\t\tparents.push(node);\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn parents;\n\t}\n\n\tfunction nodeAtIndex(container, offset) {\n\t\tif (container.hasChildNodes() && offset < container.childNodes.length) {\n\t\t\treturn container.childNodes[offset];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction getCaretCandidatePosition(direction, node) {\n\t\tif (isForwards(direction)) {\n\t\t\tif (isCaretCandidate(node.previousSibling) && !isText(node.previousSibling)) {\n\t\t\t\treturn CaretPosition.before(node);\n\t\t\t}\n\n\t\t\tif (isText(node)) {\n\t\t\t\treturn CaretPosition(node, 0);\n\t\t\t}\n\t\t}\n\n\t\tif (isBackwards(direction)) {\n\t\t\tif (isCaretCandidate(node.nextSibling) && !isText(node.nextSibling)) {\n\t\t\t\treturn CaretPosition.after(node);\n\t\t\t}\n\n\t\t\tif (isText(node)) {\n\t\t\t\treturn CaretPosition(node, node.data.length);\n\t\t\t}\n\t\t}\n\n\t\tif (isBackwards(direction)) {\n\t\t\tif (isBr(node)) {\n\t\t\t\treturn CaretPosition.before(node);\n\t\t\t}\n\n\t\t\treturn CaretPosition.after(node);\n\t\t}\n\n\t\treturn CaretPosition.before(node);\n\t}\n\n\t// Jumps over BR elements <p>|<br></p><p>a</p> -> <p><br></p><p>|a</p>\n\tfunction isBrBeforeBlock(node, rootNode) {\n\t\tvar next;\n\n\t\tif (!NodeType.isBr(node)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tnext = findCaretPosition(1, CaretPosition.after(node), rootNode);\n\t\tif (!next) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !CaretUtils.isInSameBlock(CaretPosition.before(node), CaretPosition.before(next), rootNode);\n\t}\n\n\tfunction findCaretPosition(direction, startCaretPosition, rootNode) {\n\t\tvar container, offset, node, nextNode, innerNode,\n\t\t\trootContentEditableFalseElm, caretPosition;\n\n\t\tif (!isElement(rootNode) || !startCaretPosition) {\n\t\t\treturn null;\n\t\t}\n\n\t\tcaretPosition = startCaretPosition;\n\t\tcontainer = caretPosition.container();\n\t\toffset = caretPosition.offset();\n\n\t\tif (isText(container)) {\n\t\t\tif (isBackwards(direction) && offset > 0) {\n\t\t\t\treturn CaretPosition(container, --offset);\n\t\t\t}\n\n\t\t\tif (isForwards(direction) && offset < container.length) {\n\t\t\t\treturn CaretPosition(container, ++offset);\n\t\t\t}\n\n\t\t\tnode = container;\n\t\t} else {\n\t\t\tif (isBackwards(direction) && offset > 0) {\n\t\t\t\tnextNode = nodeAtIndex(container, offset - 1);\n\t\t\t\tif (isCaretCandidate(nextNode)) {\n\t\t\t\t\tif (!isAtomic(nextNode)) {\n\t\t\t\t\t\tinnerNode = CaretUtils.findNode(nextNode, direction, isEditableCaretCandidate, nextNode);\n\t\t\t\t\t\tif (innerNode) {\n\t\t\t\t\t\t\tif (isText(innerNode)) {\n\t\t\t\t\t\t\t\treturn CaretPosition(innerNode, innerNode.data.length);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn CaretPosition.after(innerNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isText(nextNode)) {\n\t\t\t\t\t\treturn CaretPosition(nextNode, nextNode.data.length);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn CaretPosition.before(nextNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (isForwards(direction) && offset < container.childNodes.length) {\n\t\t\t\tnextNode = nodeAtIndex(container, offset);\n\t\t\t\tif (isCaretCandidate(nextNode)) {\n\t\t\t\t\tif (isBrBeforeBlock(nextNode, rootNode)) {\n\t\t\t\t\t\treturn findCaretPosition(direction, CaretPosition.after(nextNode), rootNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!isAtomic(nextNode)) {\n\t\t\t\t\t\tinnerNode = CaretUtils.findNode(nextNode, direction, isEditableCaretCandidate, nextNode);\n\t\t\t\t\t\tif (innerNode) {\n\t\t\t\t\t\t\tif (isText(innerNode)) {\n\t\t\t\t\t\t\t\treturn CaretPosition(innerNode, 0);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn CaretPosition.before(innerNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isText(nextNode)) {\n\t\t\t\t\t\treturn CaretPosition(nextNode, 0);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn CaretPosition.after(nextNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tnode = caretPosition.getNode();\n\t\t}\n\n\t\tif ((isForwards(direction) && caretPosition.isAtEnd()) || (isBackwards(direction) && caretPosition.isAtStart())) {\n\t\t\tnode = CaretUtils.findNode(node, direction, Fun.constant(true), rootNode, true);\n\t\t\tif (isEditableCaretCandidate(node)) {\n\t\t\t\treturn getCaretCandidatePosition(direction, node);\n\t\t\t}\n\t\t}\n\n\t\tnextNode = CaretUtils.findNode(node, direction, isEditableCaretCandidate, rootNode);\n\n\t\trootContentEditableFalseElm = Arr.last(Arr.filter(getParents(container, rootNode), isContentEditableFalse));\n\t\tif (rootContentEditableFalseElm && (!nextNode || !rootContentEditableFalseElm.contains(nextNode))) {\n\t\t\tif (isForwards(direction)) {\n\t\t\t\tcaretPosition = CaretPosition.after(rootContentEditableFalseElm);\n\t\t\t} else {\n\t\t\t\tcaretPosition = CaretPosition.before(rootContentEditableFalseElm);\n\t\t\t}\n\n\t\t\treturn caretPosition;\n\t\t}\n\n\t\tif (nextNode) {\n\t\t\treturn getCaretCandidatePosition(direction, nextNode);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\treturn function(rootNode) {\n\t\treturn {\n\t\t\t/**\n\t\t\t * Returns the next logical caret position from the specificed input\n\t\t\t * caretPoisiton or null if there isn't any more positions left for example\n\t\t\t * at the end specified root element.\n\t\t\t *\n\t\t\t * @method next\n\t\t\t * @param {tinymce.caret.CaretPosition} caretPosition Caret position to start from.\n\t\t\t * @return {tinymce.caret.CaretPosition} CaretPosition or null if no position was found.\n\t\t\t */\n\t\t\tnext: function(caretPosition) {\n\t\t\t\treturn findCaretPosition(1, caretPosition, rootNode);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Returns the previous logical caret position from the specificed input\n\t\t\t * caretPoisiton or null if there isn't any more positions left for example\n\t\t\t * at the end specified root element.\n\t\t\t *\n\t\t\t * @method prev\n\t\t\t * @param {tinymce.caret.CaretPosition} caretPosition Caret position to start from.\n\t\t\t * @return {tinymce.caret.CaretPosition} CaretPosition or null if no position was found.\n\t\t\t */\n\t\t\tprev: function(caretPosition) {\n\t\t\t\treturn findCaretPosition(-1, caretPosition, rootNode);\n\t\t\t}\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/InsertList.js\n\n/**\n * InsertList.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Handles inserts of lists into the editor instance.\n *\n * @class tinymce.InsertList\n * @private\n */\ndefine(\"tinymce/InsertList\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/caret/CaretWalker\",\n\t\"tinymce/caret/CaretPosition\"\n], function(Tools, CaretWalker, CaretPosition) {\n\tvar isListFragment = function(fragment) {\n\t\tvar firstChild = fragment.firstChild;\n\t\tvar lastChild = fragment.lastChild;\n\n\t\t// Skip meta since it's likely <meta><ul>..</ul>\n\t\tif (firstChild && firstChild.name === 'meta') {\n\t\t\tfirstChild = firstChild.next;\n\t\t}\n\n\t\t// Skip mce_marker since it's likely <ul>..</ul><span id=\"mce_marker\"></span>\n\t\tif (lastChild && lastChild.attr('id') === 'mce_marker') {\n\t\t\tlastChild = lastChild.prev;\n\t\t}\n\n\t\tif (!firstChild || firstChild !== lastChild) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn firstChild.name === 'ul' || firstChild.name === 'ol';\n\t};\n\n\tvar cleanupDomFragment = function (domFragment) {\n\t\tvar firstChild = domFragment.firstChild;\n\t\tvar lastChild = domFragment.lastChild;\n\n\t\t// TODO: remove the meta tag from paste logic\n\t\tif (firstChild && firstChild.nodeName === 'META') {\n\t\t\tfirstChild.parentNode.removeChild(firstChild);\n\t\t}\n\n\t\tif (lastChild && lastChild.id === 'mce_marker') {\n\t\t\tlastChild.parentNode.removeChild(lastChild);\n\t\t}\n\n\t\treturn domFragment;\n\t};\n\n\tvar toDomFragment = function(dom, serializer, fragment) {\n\t\tvar html = serializer.serialize(fragment);\n\t\tvar domFragment = dom.createFragment(html);\n\n\t\treturn cleanupDomFragment(domFragment);\n\t};\n\n\tvar listItems = function(elm) {\n\t\treturn Tools.grep(elm.childNodes, function(child) {\n\t\t\treturn child.nodeName === 'LI';\n\t\t});\n\t};\n\n\tvar isEmpty = function (elm) {\n\t\treturn !elm.firstChild;\n\t};\n\n\tvar trimListItems = function(elms) {\n\t\treturn elms.length > 0 && isEmpty(elms[elms.length - 1]) ? elms.slice(0, -1) : elms;\n\t};\n\n\tvar getParentLi = function(dom, node) {\n\t\tvar parentBlock = dom.getParent(node, dom.isBlock);\n\t\treturn parentBlock && parentBlock.nodeName === 'LI' ? parentBlock : null;\n\t};\n\n\tvar isParentBlockLi = function(dom, node) {\n\t\treturn !!getParentLi(dom, node);\n\t};\n\n\tvar getSplit = function(parentNode, rng) {\n\t\tvar beforeRng = rng.cloneRange();\n\t\tvar afterRng = rng.cloneRange();\n\n\t\tbeforeRng.setStartBefore(parentNode);\n\t\tafterRng.setEndAfter(parentNode);\n\n\t\treturn [\n\t\t\tbeforeRng.cloneContents(),\n\t\t\tafterRng.cloneContents()\n\t\t];\n\t};\n\n\tvar findFirstIn = function(node, rootNode) {\n\t\tvar caretPos = CaretPosition.before(node);\n\t\tvar caretWalker = new CaretWalker(rootNode);\n\t\tvar newCaretPos = caretWalker.next(caretPos);\n\n\t\treturn newCaretPos ? newCaretPos.toRange() : null;\n\t};\n\n\tvar findLastOf = function(node, rootNode) {\n\t\tvar caretPos = CaretPosition.after(node);\n\t\tvar caretWalker = new CaretWalker(rootNode);\n\t\tvar newCaretPos = caretWalker.prev(caretPos);\n\n\t\treturn newCaretPos ? newCaretPos.toRange() : null;\n\t};\n\n\tvar insertMiddle = function(target, elms, rootNode, rng) {\n\t\tvar parts = getSplit(target, rng);\n\t\tvar parentElm = target.parentNode;\n\n\t\tparentElm.insertBefore(parts[0], target);\n\t\tTools.each(elms, function(li) {\n\t\t\tparentElm.insertBefore(li, target);\n\t\t});\n\t\tparentElm.insertBefore(parts[1], target);\n\t\tparentElm.removeChild(target);\n\n\t\treturn findLastOf(elms[elms.length - 1], rootNode);\n\t};\n\n\tvar insertBefore = function(target, elms, rootNode) {\n\t\tvar parentElm = target.parentNode;\n\n\t\tTools.each(elms, function(elm) {\n\t\t\tparentElm.insertBefore(elm, target);\n\t\t});\n\n\t\treturn findFirstIn(target, rootNode);\n\t};\n\n\tvar insertAfter = function(target, elms, rootNode, dom) {\n\t\tdom.insertAfter(elms.reverse(), target);\n\t\treturn findLastOf(elms[0], rootNode);\n\t};\n\n\tvar insertAtCaret = function(serializer, dom, rng, fragment) {\n\t\tvar domFragment = toDomFragment(dom, serializer, fragment);\n\t\tvar liTarget = getParentLi(dom, rng.startContainer);\n\t\tvar liElms = trimListItems(listItems(domFragment.firstChild));\n\t\tvar BEGINNING = 1, END = 2;\n\t\tvar rootNode = dom.getRoot();\n\n\t\tvar isAt = function(location) {\n\t\t\tvar caretPos = CaretPosition.fromRangeStart(rng);\n\t\t\tvar caretWalker = new CaretWalker(dom.getRoot());\n\t\t\tvar newPos = location === BEGINNING ? caretWalker.prev(caretPos) : caretWalker.next(caretPos);\n\n\t\t\treturn newPos ? getParentLi(dom, newPos.getNode()) !== liTarget : true;\n\t\t};\n\n\t\tif (isAt(BEGINNING)) {\n\t\t\treturn insertBefore(liTarget, liElms, rootNode);\n\t\t} else if (isAt(END)) {\n\t\t\treturn insertAfter(liTarget, liElms, rootNode, dom);\n\t\t}\n\n\t\treturn insertMiddle(liTarget, liElms, rootNode, rng);\n\t};\n\n\treturn {\n\t\tisListFragment: isListFragment,\n\t\tinsertAtCaret: insertAtCaret,\n\t\tisParentBlockLi: isParentBlockLi,\n\t\ttrimListItems: trimListItems,\n\t\tlistItems: listItems\n\t};\n});\n\n// Included from: js/tinymce/classes/InsertContent.js\n\n/**\n * InsertContent.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Handles inserts of contents into the editor instance.\n *\n * @class tinymce.InsertContent\n * @private\n */\ndefine(\"tinymce/InsertContent\", [\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/html/Serializer\",\n\t\"tinymce/caret/CaretWalker\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/dom/ElementUtils\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/InsertList\"\n], function(Env, Tools, Serializer, CaretWalker, CaretPosition, ElementUtils, NodeType, InsertList) {\n\tvar isTableCell = NodeType.matchNodeNames('td th');\n\n\tvar validInsertion = function (editor, value, parentNode) {\n\t\t// Should never insert content into bogus elements, since these can\n\t\t// be resize handles or similar\n\t\tif (parentNode.getAttribute('data-mce-bogus') === 'all') {\n\t\t\tparentNode.parentNode.insertBefore(editor.dom.createFragment(value), parentNode);\n\t\t} else {\n\t\t\t// Check if parent is empty or only has one BR element then set the innerHTML of that parent\n\t\t\tvar node = parentNode.firstChild;\n\t\t\tvar node2 = parentNode.lastChild;\n\t\t\tif (!node || (node === node2 && node.nodeName === 'BR')) {///\n\t\t\t\teditor.dom.setHTML(parentNode, value);\n\t\t\t} else {\n\t\t\t\teditor.selection.setContent(value);\n\t\t\t}\n\t\t}\n\t};\n\n\tvar insertHtmlAtCaret = function(editor, value, details) {\n\t\tvar parser, serializer, parentNode, rootNode, fragment, args;\n\t\tvar marker, rng, node, node2, bookmarkHtml, merge;\n\t\tvar textInlineElements = editor.schema.getTextInlineElements();\n\t\tvar selection = editor.selection, dom = editor.dom;\n\n\t\tfunction trimOrPaddLeftRight(html) {\n\t\t\tvar rng, container, offset;\n\n\t\t\trng = selection.getRng(true);\n\t\t\tcontainer = rng.startContainer;\n\t\t\toffset = rng.startOffset;\n\n\t\t\tfunction hasSiblingText(siblingName) {\n\t\t\t\treturn container[siblingName] && container[siblingName].nodeType == 3;\n\t\t\t}\n\n\t\t\tif (container.nodeType == 3) {\n\t\t\t\tif (offset > 0) {\n\t\t\t\t\thtml = html.replace(/^&nbsp;/, ' ');\n\t\t\t\t} else if (!hasSiblingText('previousSibling')) {\n\t\t\t\t\thtml = html.replace(/^ /, '&nbsp;');\n\t\t\t\t}\n\n\t\t\t\tif (offset < container.length) {\n\t\t\t\t\thtml = html.replace(/&nbsp;(<br>|)$/, ' ');\n\t\t\t\t} else if (!hasSiblingText('nextSibling')) {\n\t\t\t\t\thtml = html.replace(/(&nbsp;| )(<br>|)$/, '&nbsp;');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn html;\n\t\t}\n\n\t\t// Removes &nbsp; from a [b] c -> a &nbsp;c -> a c\n\t\tfunction trimNbspAfterDeleteAndPaddValue() {\n\t\t\tvar rng, container, offset;\n\n\t\t\trng = selection.getRng(true);\n\t\t\tcontainer = rng.startContainer;\n\t\t\toffset = rng.startOffset;\n\n\t\t\tif (container.nodeType == 3 && rng.collapsed) {\n\t\t\t\tif (container.data[offset] === '\\u00a0') {\n\t\t\t\t\tcontainer.deleteData(offset, 1);\n\n\t\t\t\t\tif (!/[\\u00a0| ]$/.test(value)) {\n\t\t\t\t\t\tvalue += ' ';\n\t\t\t\t\t}\n\t\t\t\t} else if (container.data[offset - 1] === '\\u00a0') {\n\t\t\t\t\tcontainer.deleteData(offset - 1, 1);\n\n\t\t\t\t\tif (!/[\\u00a0| ]$/.test(value)) {\n\t\t\t\t\t\tvalue = ' ' + value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction reduceInlineTextElements() {\n\t\t\tif (merge) {\n\t\t\t\tvar root = editor.getBody(), elementUtils = new ElementUtils(dom);\n\n\t\t\t\tTools.each(dom.select('*[data-mce-fragment]'), function(node) {\n\t\t\t\t\tfor (var testNode = node.parentNode; testNode && testNode != root; testNode = testNode.parentNode) {\n\t\t\t\t\t\tif (textInlineElements[node.nodeName.toLowerCase()] && elementUtils.compare(testNode, node)) {\n\t\t\t\t\t\t\tdom.remove(node, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction markFragmentElements(fragment) {\n\t\t\tvar node = fragment;\n\n\t\t\twhile ((node = node.walk())) {\n\t\t\t\tif (node.type === 1) {\n\t\t\t\t\tnode.attr('data-mce-fragment', '1');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction umarkFragmentElements(elm) {\n\t\t\tTools.each(elm.getElementsByTagName('*'), function(elm) {\n\t\t\t\telm.removeAttribute('data-mce-fragment');\n\t\t\t});\n\t\t}\n\n\t\tfunction isPartOfFragment(node) {\n\t\t\treturn !!node.getAttribute('data-mce-fragment');\n\t\t}\n\n\t\tfunction canHaveChildren(node) {\n\t\t\treturn node && !editor.schema.getShortEndedElements()[node.nodeName];\n\t\t}\n\n\t\tfunction moveSelectionToMarker(marker) {\n\t\t\tvar parentEditableFalseElm, parentBlock, nextRng;\n\n\t\t\tfunction getContentEditableFalseParent(node) {\n\t\t\t\tvar root = editor.getBody();\n\n\t\t\t\tfor (; node && node !== root; node = node.parentNode) {\n\t\t\t\t\tif (editor.dom.getContentEditable(node) === 'false') {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (!marker) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tselection.scrollIntoView(marker);\n\n\t\t\t// If marker is in cE=false then move selection to that element instead\n\t\t\tparentEditableFalseElm = getContentEditableFalseParent(marker);\n\t\t\tif (parentEditableFalseElm) {\n\t\t\t\tdom.remove(marker);\n\t\t\t\tselection.select(parentEditableFalseElm);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Move selection before marker and remove it\n\t\t\trng = dom.createRng();\n\n\t\t\t// If previous sibling is a text node set the selection to the end of that node\n\t\t\tnode = marker.previousSibling;\n\t\t\tif (node && node.nodeType == 3) {\n\t\t\t\trng.setStart(node, node.nodeValue.length);\n\n\t\t\t\t// TODO: Why can't we normalize on IE\n\t\t\t\tif (!Env.ie) {\n\t\t\t\t\tnode2 = marker.nextSibling;\n\t\t\t\t\tif (node2 && node2.nodeType == 3) {\n\t\t\t\t\t\tnode.appendData(node2.data);\n\t\t\t\t\t\tnode2.parentNode.removeChild(node2);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// If the previous sibling isn't a text node or doesn't exist set the selection before the marker node\n\t\t\t\trng.setStartBefore(marker);\n\t\t\t\trng.setEndBefore(marker);\n\t\t\t}\n\n\t\t\tfunction findNextCaretRng(rng) {\n\t\t\t\tvar caretPos = CaretPosition.fromRangeStart(rng);\n\t\t\t\tvar caretWalker = new CaretWalker(editor.getBody());\n\n\t\t\t\tcaretPos = caretWalker.next(caretPos);\n\t\t\t\tif (caretPos) {\n\t\t\t\t\treturn caretPos.toRange();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Remove the marker node and set the new range\n\t\t\tparentBlock = dom.getParent(marker, dom.isBlock);\n\t\t\tdom.remove(marker);\n\n\t\t\tif (parentBlock && dom.isEmpty(parentBlock)) {\n\t\t\t\teditor.$(parentBlock).empty();\n\n\t\t\t\trng.setStart(parentBlock, 0);\n\t\t\t\trng.setEnd(parentBlock, 0);\n\n\t\t\t\tif (!isTableCell(parentBlock) && !isPartOfFragment(parentBlock) && (nextRng = findNextCaretRng(rng))) {\n\t\t\t\t\trng = nextRng;\n\t\t\t\t\tdom.remove(parentBlock);\n\t\t\t\t} else {\n\t\t\t\t\tdom.add(parentBlock, dom.create('br', {'data-mce-bogus': '1'}));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tselection.setRng(rng);\n\t\t}\n\n\t\t// Check for whitespace before/after value\n\t\tif (/^ | $/.test(value)) {\n\t\t\tvalue = trimOrPaddLeftRight(value);\n\t\t}\n\n\t\t// Setup parser and serializer\n\t\tparser = editor.parser;\n\t\tmerge = details.merge;\n\n\t\tserializer = new Serializer({\n\t\t\tvalidate: editor.settings.validate\n\t\t}, editor.schema);\n\t\tbookmarkHtml = '<span id=\"mce_marker\" data-mce-type=\"bookmark\">&#xFEFF;&#x200B;</span>';\n\n\t\t// Run beforeSetContent handlers on the HTML to be inserted\n\t\targs = {content: value, format: 'html', selection: true};\n\t\teditor.fire('BeforeSetContent', args);\n\t\tvalue = args.content;\n\n\t\t// Add caret at end of contents if it's missing\n\t\tif (value.indexOf('{$caret}') == -1) {\n\t\t\tvalue += '{$caret}';\n\t\t}\n\n\t\t// Replace the caret marker with a span bookmark element\n\t\tvalue = value.replace(/\\{\\$caret\\}/, bookmarkHtml);\n\n\t\t// If selection is at <body>|<p></p> then move it into <body><p>|</p>\n\t\trng = selection.getRng();\n\t\tvar caretElement = rng.startContainer || (rng.parentElement ? rng.parentElement() : null);\n\t\tvar body = editor.getBody();\n\t\tif (caretElement === body && selection.isCollapsed()) {\n\t\t\tif (dom.isBlock(body.firstChild) && canHaveChildren(body.firstChild) && dom.isEmpty(body.firstChild)) {\n\t\t\t\trng = dom.createRng();\n\t\t\t\trng.setStart(body.firstChild, 0);\n\t\t\t\trng.setEnd(body.firstChild, 0);\n\t\t\t\tselection.setRng(rng);\n\t\t\t}\n\t\t}\n\n\t\t// Insert node maker where we will insert the new HTML and get it's parent\n\t\tif (!selection.isCollapsed()) {\n\t\t\t// Fix for #2595 seems that delete removes one extra character on\n\t\t\t// WebKit for some odd reason if you double click select a word\n\t\t\teditor.selection.setRng(editor.selection.getRng());\n\t\t\teditor.getDoc().execCommand('Delete', false, null);\n\t\t\ttrimNbspAfterDeleteAndPaddValue();\n\t\t}\n\n\t\tparentNode = selection.getNode();\n\n\t\t// Parse the fragment within the context of the parent node\n\t\tvar parserArgs = {context: parentNode.nodeName.toLowerCase(), data: details.data};\n\t\tfragment = parser.parse(value, parserArgs);\n\n\t\t// Custom handling of lists\n\t\tif (details.paste === true && InsertList.isListFragment(fragment) && InsertList.isParentBlockLi(dom, parentNode)) {\n\t\t\trng = InsertList.insertAtCaret(serializer, dom, editor.selection.getRng(true), fragment);\n\t\t\teditor.selection.setRng(rng);\n\t\t\teditor.fire('SetContent', args);\n\t\t\treturn;\n\t\t}\n\n\t\tmarkFragmentElements(fragment);\n\n\t\t// Move the caret to a more suitable location\n\t\tnode = fragment.lastChild;\n\t\tif (node.attr('id') == 'mce_marker') {\n\t\t\tmarker = node;\n\n\t\t\tfor (node = node.prev; node; node = node.walk(true)) {\n\t\t\t\tif (node.type == 3 || !dom.isBlock(node.name)) {\n\t\t\t\t\tif (editor.schema.isValidChild(node.parent.name, 'span')) {\n\t\t\t\t\t\tnode.parent.insert(marker, node, node.name === 'br');\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\teditor._selectionOverrides.showBlockCaretContainer(parentNode);\n\n\t\t// If parser says valid we can insert the contents into that parent\n\t\tif (!parserArgs.invalid) {\n\t\t\tvalue = serializer.serialize(fragment);\n\t\t\tvalidInsertion(editor, value, parentNode);\n\t\t} else {\n\t\t\t// If the fragment was invalid within that context then we need\n\t\t\t// to parse and process the parent it's inserted into\n\n\t\t\t// Insert bookmark node and get the parent\n\t\t\tselection.setContent(bookmarkHtml);\n\t\t\tparentNode = selection.getNode();\n\t\t\trootNode = editor.getBody();\n\n\t\t\t// Opera will return the document node when selection is in root\n\t\t\tif (parentNode.nodeType == 9) {\n\t\t\t\tparentNode = node = rootNode;\n\t\t\t} else {\n\t\t\t\tnode = parentNode;\n\t\t\t}\n\n\t\t\t// Find the ancestor just before the root element\n\t\t\twhile (node !== rootNode) {\n\t\t\t\tparentNode = node;\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\t// Get the outer/inner HTML depending on if we are in the root and parser and serialize that\n\t\t\tvalue = parentNode == rootNode ? rootNode.innerHTML : dom.getOuterHTML(parentNode);\n\t\t\tvalue = serializer.serialize(\n\t\t\t\tparser.parse(\n\t\t\t\t\t// Need to replace by using a function since $ in the contents would otherwise be a problem\n\t\t\t\t\tvalue.replace(/<span (id=\"mce_marker\"|id=mce_marker).+?<\\/span>/i, function() {\n\t\t\t\t\t\treturn serializer.serialize(fragment);\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t);\n\n\t\t\t// Set the inner/outer HTML depending on if we are in the root or not\n\t\t\tif (parentNode == rootNode) {\n\t\t\t\tdom.setHTML(rootNode, value);\n\t\t\t} else {\n\t\t\t\tdom.setOuterHTML(parentNode, value);\n\t\t\t}\n\t\t}\n\n\t\treduceInlineTextElements();\n\t\tmoveSelectionToMarker(dom.get('mce_marker'));\n\t\tumarkFragmentElements(editor.getBody());\n\t\teditor.fire('SetContent', args);\n\t\teditor.addVisual();\n\t};\n\n\tvar processValue = function (value) {\n\t\tvar details;\n\n\t\tif (typeof value !== 'string') {\n\t\t\tdetails = Tools.extend({\n\t\t\t\tpaste: value.paste,\n\t\t\t\tdata: {\n\t\t\t\t\tpaste: value.paste\n\t\t\t\t}\n\t\t\t}, value);\n\n\t\t\treturn {\n\t\t\t\tcontent: value.content,\n\t\t\t\tdetails: details\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tcontent: value,\n\t\t\tdetails: {}\n\t\t};\n\t};\n\n\tvar insertAtCaret = function (editor, value) {\n\t\tvar result = processValue(value);\n\t\tinsertHtmlAtCaret(editor, result.content, result.details);\n\t};\n\n\treturn {\n\t\tinsertAtCaret: insertAtCaret\n\t};\n});\n\n// Included from: js/tinymce/classes/EditorCommands.js\n\n/**\n * EditorCommands.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class enables you to add custom editor commands and it contains\n * overrides for native browser commands to address various bugs and issues.\n *\n * @class tinymce.EditorCommands\n */\ndefine(\"tinymce/EditorCommands\", [\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/InsertContent\",\n\t\"tinymce/dom/NodeType\"\n], function(Env, Tools, RangeUtils, TreeWalker, InsertContent, NodeType) {\n\t// Added for compression purposes\n\tvar each = Tools.each, extend = Tools.extend;\n\tvar map = Tools.map, inArray = Tools.inArray, explode = Tools.explode;\n\tvar isOldIE = Env.ie && Env.ie < 11;\n\tvar TRUE = true, FALSE = false;\n\n\treturn function(editor) {\n\t\tvar dom, selection, formatter,\n\t\t\tcommands = {state: {}, exec: {}, value: {}},\n\t\t\tsettings = editor.settings,\n\t\t\tbookmark;\n\n\t\teditor.on('PreInit', function() {\n\t\t\tdom = editor.dom;\n\t\t\tselection = editor.selection;\n\t\t\tsettings = editor.settings;\n\t\t\tformatter = editor.formatter;\n\t\t});\n\n\t\t/**\n\t\t * Executes the specified command.\n\t\t *\n\t\t * @method execCommand\n\t\t * @param {String} command Command to execute.\n\t\t * @param {Boolean} ui Optional user interface state.\n\t\t * @param {Object} value Optional value for command.\n\t\t * @param {Object} args Optional extra arguments to the execCommand.\n\t\t * @return {Boolean} true/false if the command was found or not.\n\t\t */\n\t\tfunction execCommand(command, ui, value, args) {\n\t\t\tvar func, customCommand, state = 0;\n\n\t\t\tif (!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command) && (!args || !args.skip_focus)) {\n\t\t\t\teditor.focus();\n\t\t\t}\n\n\t\t\targs = editor.fire('BeforeExecCommand', {command: command, ui: ui, value: value});\n\t\t\tif (args.isDefaultPrevented()) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tcustomCommand = command.toLowerCase();\n\t\t\tif ((func = commands.exec[customCommand])) {\n\t\t\t\tfunc(customCommand, ui, value);\n\t\t\t\teditor.fire('ExecCommand', {command: command, ui: ui, value: value});\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Plugin commands\n\t\t\teach(editor.plugins, function(p) {\n\t\t\t\tif (p.execCommand && p.execCommand(command, ui, value)) {\n\t\t\t\t\teditor.fire('ExecCommand', {command: command, ui: ui, value: value});\n\t\t\t\t\tstate = true;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (state) {\n\t\t\t\treturn state;\n\t\t\t}\n\n\t\t\t// Theme commands\n\t\t\tif (editor.theme && editor.theme.execCommand && editor.theme.execCommand(command, ui, value)) {\n\t\t\t\teditor.fire('ExecCommand', {command: command, ui: ui, value: value});\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Browser commands\n\t\t\ttry {\n\t\t\t\tstate = editor.getDoc().execCommand(command, ui, value);\n\t\t\t} catch (ex) {\n\t\t\t\t// Ignore old IE errors\n\t\t\t}\n\n\t\t\tif (state) {\n\t\t\t\teditor.fire('ExecCommand', {command: command, ui: ui, value: value});\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t/**\n\t\t * Queries the current state for a command for example if the current selection is \"bold\".\n\t\t *\n\t\t * @method queryCommandState\n\t\t * @param {String} command Command to check the state of.\n\t\t * @return {Boolean/Number} true/false if the selected contents is bold or not, -1 if it's not found.\n\t\t */\n\t\tfunction queryCommandState(command) {\n\t\t\tvar func;\n\n\t\t\t// Is hidden then return undefined\n\t\t\tif (editor.quirks.isHidden()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcommand = command.toLowerCase();\n\t\t\tif ((func = commands.state[command])) {\n\t\t\t\treturn func(command);\n\t\t\t}\n\n\t\t\t// Browser commands\n\t\t\ttry {\n\t\t\t\treturn editor.getDoc().queryCommandState(command);\n\t\t\t} catch (ex) {\n\t\t\t\t// Fails sometimes see bug: 1896577\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t/**\n\t\t * Queries the command value for example the current fontsize.\n\t\t *\n\t\t * @method queryCommandValue\n\t\t * @param {String} command Command to check the value of.\n\t\t * @return {Object} Command value of false if it's not found.\n\t\t */\n\t\tfunction queryCommandValue(command) {\n\t\t\tvar func;\n\n\t\t\t// Is hidden then return undefined\n\t\t\tif (editor.quirks.isHidden()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcommand = command.toLowerCase();\n\t\t\tif ((func = commands.value[command])) {\n\t\t\t\treturn func(command);\n\t\t\t}\n\n\t\t\t// Browser commands\n\t\t\ttry {\n\t\t\t\treturn editor.getDoc().queryCommandValue(command);\n\t\t\t} catch (ex) {\n\t\t\t\t// Fails sometimes see bug: 1896577\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Adds commands to the command collection.\n\t\t *\n\t\t * @method addCommands\n\t\t * @param {Object} command_list Name/value collection with commands to add, the names can also be comma separated.\n\t\t * @param {String} type Optional type to add, defaults to exec. Can be value or state as well.\n\t\t */\n\t\tfunction addCommands(command_list, type) {\n\t\t\ttype = type || 'exec';\n\n\t\t\teach(command_list, function(callback, command) {\n\t\t\t\teach(command.toLowerCase().split(','), function(command) {\n\t\t\t\t\tcommands[type][command] = callback;\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction addCommand(command, callback, scope) {\n\t\t\tcommand = command.toLowerCase();\n\t\t\tcommands.exec[command] = function(command, ui, value, args) {\n\t\t\t\treturn callback.call(scope || editor, ui, value, args);\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Returns true/false if the command is supported or not.\n\t\t *\n\t\t * @method queryCommandSupported\n\t\t * @param {String} command Command that we check support for.\n\t\t * @return {Boolean} true/false if the command is supported or not.\n\t\t */\n\t\tfunction queryCommandSupported(command) {\n\t\t\tcommand = command.toLowerCase();\n\n\t\t\tif (commands.exec[command]) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Browser commands\n\t\t\ttry {\n\t\t\t\treturn editor.getDoc().queryCommandSupported(command);\n\t\t\t} catch (ex) {\n\t\t\t\t// Fails sometimes see bug: 1896577\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction addQueryStateHandler(command, callback, scope) {\n\t\t\tcommand = command.toLowerCase();\n\t\t\tcommands.state[command] = function() {\n\t\t\t\treturn callback.call(scope || editor);\n\t\t\t};\n\t\t}\n\n\t\tfunction addQueryValueHandler(command, callback, scope) {\n\t\t\tcommand = command.toLowerCase();\n\t\t\tcommands.value[command] = function() {\n\t\t\t\treturn callback.call(scope || editor);\n\t\t\t};\n\t\t}\n\n\t\tfunction hasCustomCommand(command) {\n\t\t\tcommand = command.toLowerCase();\n\t\t\treturn !!commands.exec[command];\n\t\t}\n\n\t\t// Expose public methods\n\t\textend(this, {\n\t\t\texecCommand: execCommand,\n\t\t\tqueryCommandState: queryCommandState,\n\t\t\tqueryCommandValue: queryCommandValue,\n\t\t\tqueryCommandSupported: queryCommandSupported,\n\t\t\taddCommands: addCommands,\n\t\t\taddCommand: addCommand,\n\t\t\taddQueryStateHandler: addQueryStateHandler,\n\t\t\taddQueryValueHandler: addQueryValueHandler,\n\t\t\thasCustomCommand: hasCustomCommand\n\t\t});\n\n\t\t// Private methods\n\n\t\tfunction execNativeCommand(command, ui, value) {\n\t\t\tif (ui === undefined) {\n\t\t\t\tui = FALSE;\n\t\t\t}\n\n\t\t\tif (value === undefined) {\n\t\t\t\tvalue = null;\n\t\t\t}\n\n\t\t\treturn editor.getDoc().execCommand(command, ui, value);\n\t\t}\n\n\t\tfunction isFormatMatch(name) {\n\t\t\treturn formatter.match(name);\n\t\t}\n\n\t\tfunction toggleFormat(name, value) {\n\t\t\tformatter.toggle(name, value ? {value: value} : undefined);\n\t\t\teditor.nodeChanged();\n\t\t}\n\n\t\tfunction storeSelection(type) {\n\t\t\tbookmark = selection.getBookmark(type);\n\t\t}\n\n\t\tfunction restoreSelection() {\n\t\t\tselection.moveToBookmark(bookmark);\n\t\t}\n\n\t\t// Add execCommand overrides\n\t\taddCommands({\n\t\t\t// Ignore these, added for compatibility\n\t\t\t'mceResetDesignMode,mceBeginUndoLevel': function() {},\n\n\t\t\t// Add undo manager logic\n\t\t\t'mceEndUndoLevel,mceAddUndoLevel': function() {\n\t\t\t\teditor.undoManager.add();\n\t\t\t},\n\n\t\t\t'Cut,Copy,Paste': function(command) {\n\t\t\t\tvar doc = editor.getDoc(), failed;\n\n\t\t\t\t// Try executing the native command\n\t\t\t\ttry {\n\t\t\t\t\texecNativeCommand(command);\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Command failed\n\t\t\t\t\tfailed = TRUE;\n\t\t\t\t}\n\n\t\t\t\t// Chrome reports the paste command as supported however older IE:s will return false for cut/paste\n\t\t\t\tif (command === 'paste' && !doc.queryCommandEnabled(command)) {\n\t\t\t\t\tfailed = true;\n\t\t\t\t}\n\n\t\t\t\t// Present alert message about clipboard access not being available\n\t\t\t\tif (failed || !doc.queryCommandSupported(command)) {\n\t\t\t\t\tvar msg = editor.translate(\n\t\t\t\t\t\t\"Your browser doesn't support direct access to the clipboard. \" +\n\t\t\t\t\t\t\"Please use the Ctrl+X/C/V keyboard shortcuts instead.\"\n\t\t\t\t\t);\n\n\t\t\t\t\tif (Env.mac) {\n\t\t\t\t\t\tmsg = msg.replace(/Ctrl\\+/g, '\\u2318+');\n\t\t\t\t\t}\n\n\t\t\t\t\teditor.notificationManager.open({text: msg, type: 'error'});\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// Override unlink command\n\t\t\tunlink: function() {\n\t\t\t\tif (selection.isCollapsed()) {\n\t\t\t\t\tvar elm = editor.dom.getParent(editor.selection.getStart(), 'a');\n\t\t\t\t\tif (elm) {\n\t\t\t\t\t\teditor.dom.remove(elm, true);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tformatter.remove(\"link\");\n\t\t\t},\n\n\t\t\t// Override justify commands to use the text formatter engine\n\t\t\t'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone': function(command) {\n\t\t\t\tvar align = command.substring(7);\n\n\t\t\t\tif (align == 'full') {\n\t\t\t\t\talign = 'justify';\n\t\t\t\t}\n\n\t\t\t\t// Remove all other alignments first\n\t\t\t\teach('left,center,right,justify'.split(','), function(name) {\n\t\t\t\t\tif (align != name) {\n\t\t\t\t\t\tformatter.remove('align' + name);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (align != 'none') {\n\t\t\t\t\ttoggleFormat('align' + align);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// Override list commands to fix WebKit bug\n\t\t\t'InsertUnorderedList,InsertOrderedList': function(command) {\n\t\t\t\tvar listElm, listParent;\n\n\t\t\t\texecNativeCommand(command);\n\n\t\t\t\t// WebKit produces lists within block elements so we need to split them\n\t\t\t\t// we will replace the native list creation logic to custom logic later on\n\t\t\t\t// TODO: Remove this when the list creation logic is removed\n\t\t\t\tlistElm = dom.getParent(selection.getNode(), 'ol,ul');\n\t\t\t\tif (listElm) {\n\t\t\t\t\tlistParent = listElm.parentNode;\n\n\t\t\t\t\t// If list is within a text block then split that block\n\t\t\t\t\tif (/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)) {\n\t\t\t\t\t\tstoreSelection();\n\t\t\t\t\t\tdom.split(listParent, listElm);\n\t\t\t\t\t\trestoreSelection();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// Override commands to use the text formatter engine\n\t\t\t'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function(command) {\n\t\t\t\ttoggleFormat(command);\n\t\t\t},\n\n\t\t\t// Override commands to use the text formatter engine\n\t\t\t'ForeColor,HiliteColor,FontName': function(command, ui, value) {\n\t\t\t\ttoggleFormat(command, value);\n\t\t\t},\n\n\t\t\tFontSize: function(command, ui, value) {\n\t\t\t\tvar fontClasses, fontSizes;\n\n\t\t\t\t// Convert font size 1-7 to styles\n\t\t\t\tif (value >= 1 && value <= 7) {\n\t\t\t\t\tfontSizes = explode(settings.font_size_style_values);\n\t\t\t\t\tfontClasses = explode(settings.font_size_classes);\n\n\t\t\t\t\tif (fontClasses) {\n\t\t\t\t\t\tvalue = fontClasses[value - 1] || value;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalue = fontSizes[value - 1] || value;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttoggleFormat(command, value);\n\t\t\t},\n\n\t\t\tRemoveFormat: function(command) {\n\t\t\t\tformatter.remove(command);\n\t\t\t},\n\n\t\t\tmceBlockQuote: function() {\n\t\t\t\ttoggleFormat('blockquote');\n\t\t\t},\n\n\t\t\tFormatBlock: function(command, ui, value) {\n\t\t\t\treturn toggleFormat(value || 'p');\n\t\t\t},\n\n\t\t\tmceCleanup: function() {\n\t\t\t\tvar bookmark = selection.getBookmark();\n\n\t\t\t\teditor.setContent(editor.getContent({cleanup: TRUE}), {cleanup: TRUE});\n\n\t\t\t\tselection.moveToBookmark(bookmark);\n\t\t\t},\n\n\t\t\tmceRemoveNode: function(command, ui, value) {\n\t\t\t\tvar node = value || selection.getNode();\n\n\t\t\t\t// Make sure that the body node isn't removed\n\t\t\t\tif (node != editor.getBody()) {\n\t\t\t\t\tstoreSelection();\n\t\t\t\t\teditor.dom.remove(node, TRUE);\n\t\t\t\t\trestoreSelection();\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tmceSelectNodeDepth: function(command, ui, value) {\n\t\t\t\tvar counter = 0;\n\n\t\t\t\tdom.getParent(selection.getNode(), function(node) {\n\t\t\t\t\tif (node.nodeType == 1 && counter++ == value) {\n\t\t\t\t\t\tselection.select(node);\n\t\t\t\t\t\treturn FALSE;\n\t\t\t\t\t}\n\t\t\t\t}, editor.getBody());\n\t\t\t},\n\n\t\t\tmceSelectNode: function(command, ui, value) {\n\t\t\t\tselection.select(value);\n\t\t\t},\n\n\t\t\tmceInsertContent: function(command, ui, value) {\n\t\t\t\tInsertContent.insertAtCaret(editor, value);\n\t\t\t},\n\n\t\t\tmceInsertRawHTML: function(command, ui, value) {\n\t\t\t\tselection.setContent('tiny_mce_marker');\n\t\t\t\teditor.setContent(\n\t\t\t\t\teditor.getContent().replace(/tiny_mce_marker/g, function() {\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t},\n\n\t\t\tmceToggleFormat: function(command, ui, value) {\n\t\t\t\ttoggleFormat(value);\n\t\t\t},\n\n\t\t\tmceSetContent: function(command, ui, value) {\n\t\t\t\teditor.setContent(value);\n\t\t\t},\n\n\t\t\t'Indent,Outdent': function(command) {\n\t\t\t\tvar intentValue, indentUnit, value;\n\n\t\t\t\t// Setup indent level\n\t\t\t\tintentValue = settings.indentation;\n\t\t\t\tindentUnit = /[a-z%]+$/i.exec(intentValue);\n\t\t\t\tintentValue = parseInt(intentValue, 10);\n\n\t\t\t\tif (!queryCommandState('InsertUnorderedList') && !queryCommandState('InsertOrderedList')) {\n\t\t\t\t\t// If forced_root_blocks is set to false we don't have a block to indent so lets create a div\n\t\t\t\t\tif (!settings.forced_root_block && !dom.getParent(selection.getNode(), dom.isBlock)) {\n\t\t\t\t\t\tformatter.apply('div');\n\t\t\t\t\t}\n\n\t\t\t\t\teach(selection.getSelectedBlocks(), function(element) {\n\t\t\t\t\t\tif (dom.getContentEditable(element) === \"false\") {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (element.nodeName !== \"LI\") {\n\t\t\t\t\t\t\tvar indentStyleName = editor.getParam('indent_use_margin', false) ? 'margin' : 'padding';\n\t\t\t\t\t\t\tindentStyleName = element.nodeName === 'TABLE' ? 'margin' : indentStyleName;\n\t\t\t\t\t\t\tindentStyleName += dom.getStyle(element, 'direction', true) == 'rtl' ? 'Right' : 'Left';\n\n\t\t\t\t\t\t\tif (command == 'outdent') {\n\t\t\t\t\t\t\t\tvalue = Math.max(0, parseInt(element.style[indentStyleName] || 0, 10) - intentValue);\n\t\t\t\t\t\t\t\tdom.setStyle(element, indentStyleName, value ? value + indentUnit : '');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvalue = (parseInt(element.style[indentStyleName] || 0, 10) + intentValue) + indentUnit;\n\t\t\t\t\t\t\t\tdom.setStyle(element, indentStyleName, value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\texecNativeCommand(command);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tmceRepaint: function() {\n\t\t\t},\n\n\t\t\tInsertHorizontalRule: function() {\n\t\t\t\teditor.execCommand('mceInsertContent', false, '<hr />');\n\t\t\t},\n\n\t\t\tmceToggleVisualAid: function() {\n\t\t\t\teditor.hasVisual = !editor.hasVisual;\n\t\t\t\teditor.addVisual();\n\t\t\t},\n\n\t\t\tmceReplaceContent: function(command, ui, value) {\n\t\t\t\teditor.execCommand('mceInsertContent', false, value.replace(/\\{\\$selection\\}/g, selection.getContent({format: 'text'})));\n\t\t\t},\n\n\t\t\tmceInsertLink: function(command, ui, value) {\n\t\t\t\tvar anchor;\n\n\t\t\t\tif (typeof value == 'string') {\n\t\t\t\t\tvalue = {href: value};\n\t\t\t\t}\n\n\t\t\t\tanchor = dom.getParent(selection.getNode(), 'a');\n\n\t\t\t\t// Spaces are never valid in URLs and it's a very common mistake for people to make so we fix it here.\n\t\t\t\tvalue.href = value.href.replace(' ', '%20');\n\n\t\t\t\t// Remove existing links if there could be child links or that the href isn't specified\n\t\t\t\tif (!anchor || !value.href) {\n\t\t\t\t\tformatter.remove('link');\n\t\t\t\t}\n\n\t\t\t\t// Apply new link to selection\n\t\t\t\tif (value.href) {\n\t\t\t\t\tformatter.apply('link', value, anchor);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tselectAll: function() {\n\t\t\t\tvar root = dom.getRoot(), rng;\n\n\t\t\t\tif (selection.getRng().setStart) {\n\t\t\t\t\tvar editingHost = dom.getParent(selection.getStart(), NodeType.isContentEditableTrue);\n\t\t\t\t\tif (editingHost) {\n\t\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\t\trng.selectNodeContents(editingHost);\n\t\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// IE will render it's own root level block elements and sometimes\n\t\t\t\t\t// even put font elements in them when the user starts typing. So we need to\n\t\t\t\t\t// move the selection to a more suitable element from this:\n\t\t\t\t\t// <body>|<p></p></body> to this: <body><p>|</p></body>\n\t\t\t\t\trng = selection.getRng();\n\t\t\t\t\tif (!rng.item) {\n\t\t\t\t\t\trng.moveToElementText(root);\n\t\t\t\t\t\trng.select();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"delete\": function() {\n\t\t\t\texecNativeCommand(\"Delete\");\n\n\t\t\t\t// Check if body is empty after the delete call if so then set the contents\n\t\t\t\t// to an empty string and move the caret to any block produced by that operation\n\t\t\t\t// this fixes the issue with root blocks not being properly produced after a delete call on IE\n\t\t\t\tvar body = editor.getBody();\n\n\t\t\t\tif (dom.isEmpty(body)) {\n\t\t\t\t\teditor.setContent('');\n\n\t\t\t\t\tif (body.firstChild && dom.isBlock(body.firstChild)) {\n\t\t\t\t\t\teditor.selection.setCursorLocation(body.firstChild, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.selection.setCursorLocation(body, 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tmceNewDocument: function() {\n\t\t\t\teditor.setContent('');\n\t\t\t},\n\n\t\t\tInsertLineBreak: function(command, ui, value) {\n\t\t\t\t// We load the current event in from EnterKey.js when appropriate to heed\n\t\t\t\t// certain event-specific variations such as ctrl-enter in a list\n\t\t\t\tvar evt = value;\n\t\t\t\tvar brElm, extraBr, marker;\n\t\t\t\tvar rng = selection.getRng(true);\n\t\t\t\tnew RangeUtils(dom).normalize(rng);\n\n\t\t\t\tvar offset = rng.startOffset;\n\t\t\t\tvar container = rng.startContainer;\n\n\t\t\t\t// Resolve node index\n\t\t\t\tif (container.nodeType == 1 && container.hasChildNodes()) {\n\t\t\t\t\tvar isAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n\n\t\t\t\t\tcontainer = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n\t\t\t\t\tif (isAfterLastNodeInContainer && container.nodeType == 3) {\n\t\t\t\t\t\toffset = container.nodeValue.length;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toffset = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar parentBlock = dom.getParent(container, dom.isBlock);\n\t\t\t\tvar parentBlockName = parentBlock ? parentBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5\n\t\t\t\tvar containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n\t\t\t\tvar containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5\n\n\t\t\t\t// Enter inside block contained within a LI then split or insert before/after LI\n\t\t\t\tvar isControlKey = evt && evt.ctrlKey;\n\t\t\t\tif (containerBlockName == 'LI' && !isControlKey) {\n\t\t\t\t\tparentBlock = containerBlock;\n\t\t\t\t\tparentBlockName = containerBlockName;\n\t\t\t\t}\n\n\t\t\t\t// Walks the parent block to the right and look for BR elements\n\t\t\t\tfunction hasRightSideContent() {\n\t\t\t\t\tvar walker = new TreeWalker(container, parentBlock), node;\n\t\t\t\t\tvar nonEmptyElementsMap = editor.schema.getNonEmptyElements();\n\n\t\t\t\t\twhile ((node = walker.next())) {\n\t\t\t\t\t\tif (nonEmptyElementsMap[node.nodeName.toLowerCase()] || node.length > 0) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (container && container.nodeType == 3 && offset >= container.nodeValue.length) {\n\t\t\t\t\t// Insert extra BR element at the end block elements\n\t\t\t\t\tif (!isOldIE && !hasRightSideContent()) {\n\t\t\t\t\t\tbrElm = dom.create('br');\n\t\t\t\t\t\trng.insertNode(brElm);\n\t\t\t\t\t\trng.setStartAfter(brElm);\n\t\t\t\t\t\trng.setEndAfter(brElm);\n\t\t\t\t\t\textraBr = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbrElm = dom.create('br');\n\t\t\t\trng.insertNode(brElm);\n\n\t\t\t\t// Rendering modes below IE8 doesn't display BR elements in PRE unless we have a \\n before it\n\t\t\t\tvar documentMode = dom.doc.documentMode;\n\t\t\t\tif (isOldIE && parentBlockName == 'PRE' && (!documentMode || documentMode < 8)) {\n\t\t\t\t\tbrElm.parentNode.insertBefore(dom.doc.createTextNode('\\r'), brElm);\n\t\t\t\t}\n\n\t\t\t\t// Insert temp marker and scroll to that\n\t\t\t\tmarker = dom.create('span', {}, '&nbsp;');\n\t\t\t\tbrElm.parentNode.insertBefore(marker, brElm);\n\t\t\t\tselection.scrollIntoView(marker);\n\t\t\t\tdom.remove(marker);\n\n\t\t\t\tif (!extraBr) {\n\t\t\t\t\trng.setStartAfter(brElm);\n\t\t\t\t\trng.setEndAfter(brElm);\n\t\t\t\t} else {\n\t\t\t\t\trng.setStartBefore(brElm);\n\t\t\t\t\trng.setEndBefore(brElm);\n\t\t\t\t}\n\n\t\t\t\tselection.setRng(rng);\n\t\t\t\teditor.undoManager.add();\n\n\t\t\t\treturn TRUE;\n\t\t\t}\n\t\t});\n\n\t\t// Add queryCommandState overrides\n\t\taddCommands({\n\t\t\t// Override justify commands\n\t\t\t'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull': function(command) {\n\t\t\t\tvar name = 'align' + command.substring(7);\n\t\t\t\tvar nodes = selection.isCollapsed() ? [dom.getParent(selection.getNode(), dom.isBlock)] : selection.getSelectedBlocks();\n\t\t\t\tvar matches = map(nodes, function(node) {\n\t\t\t\t\treturn !!formatter.matchNode(node, name);\n\t\t\t\t});\n\t\t\t\treturn inArray(matches, TRUE) !== -1;\n\t\t\t},\n\n\t\t\t'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function(command) {\n\t\t\t\treturn isFormatMatch(command);\n\t\t\t},\n\n\t\t\tmceBlockQuote: function() {\n\t\t\t\treturn isFormatMatch('blockquote');\n\t\t\t},\n\n\t\t\tOutdent: function() {\n\t\t\t\tvar node;\n\n\t\t\t\tif (settings.inline_styles) {\n\t\t\t\t\tif ((node = dom.getParent(selection.getStart(), dom.isBlock)) && parseInt(node.style.paddingLeft, 10) > 0) {\n\t\t\t\t\t\treturn TRUE;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((node = dom.getParent(selection.getEnd(), dom.isBlock)) && parseInt(node.style.paddingLeft, 10) > 0) {\n\t\t\t\t\t\treturn TRUE;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn (\n\t\t\t\t\tqueryCommandState('InsertUnorderedList') ||\n\t\t\t\t\tqueryCommandState('InsertOrderedList') ||\n\t\t\t\t\t(!settings.inline_styles && !!dom.getParent(selection.getNode(), 'BLOCKQUOTE'))\n\t\t\t\t);\n\t\t\t},\n\n\t\t\t'InsertUnorderedList,InsertOrderedList': function(command) {\n\t\t\t\tvar list = dom.getParent(selection.getNode(), 'ul,ol');\n\n\t\t\t\treturn list &&\n\t\t\t\t\t(\n\t\t\t\t\t\tcommand === 'insertunorderedlist' && list.tagName === 'UL' ||\n\t\t\t\t\t\tcommand === 'insertorderedlist' && list.tagName === 'OL'\n\t\t\t\t\t);\n\t\t\t}\n\t\t}, 'state');\n\n\t\t// Add queryCommandValue overrides\n\t\taddCommands({\n\t\t\t'FontSize,FontName': function(command) {\n\t\t\t\tvar value = 0, parent;\n\n\t\t\t\tif ((parent = dom.getParent(selection.getNode(), 'span'))) {\n\t\t\t\t\tif (command == 'fontsize') {\n\t\t\t\t\t\tvalue = parent.style.fontSize;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalue = parent.style.fontFamily.replace(/, /g, ',').replace(/[\\'\\\"]/g, '').toLowerCase();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}, 'value');\n\n\t\t// Add undo manager logic\n\t\taddCommands({\n\t\t\tUndo: function() {\n\t\t\t\teditor.undoManager.undo();\n\t\t\t},\n\n\t\t\tRedo: function() {\n\t\t\t\teditor.undoManager.redo();\n\t\t\t}\n\t\t});\n\t};\n});\n\n// Included from: js/tinymce/classes/util/URI.js\n\n/**\n * URI.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles parsing, modification and serialization of URI/URL strings.\n * @class tinymce.util.URI\n */\ndefine(\"tinymce/util/URI\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\tvar each = Tools.each, trim = Tools.trim;\n\tvar queryParts = \"source protocol authority userInfo user password host port relative path directory file query anchor\".split(' ');\n\tvar DEFAULT_PORTS = {\n\t\t'ftp': 21,\n\t\t'http': 80,\n\t\t'https': 443,\n\t\t'mailto': 25\n\t};\n\n\t/**\n\t * Constructs a new URI instance.\n\t *\n\t * @constructor\n\t * @method URI\n\t * @param {String} url URI string to parse.\n\t * @param {Object} settings Optional settings object.\n\t */\n\tfunction URI(url, settings) {\n\t\tvar self = this, baseUri, base_url;\n\n\t\turl = trim(url);\n\t\tsettings = self.settings = settings || {};\n\t\tbaseUri = settings.base_uri;\n\n\t\t// Strange app protocol that isn't http/https or local anchor\n\t\t// For example: mailto,skype,tel etc.\n\t\tif (/^([\\w\\-]+):([^\\/]{2})/i.test(url) || /^\\s*#/.test(url)) {\n\t\t\tself.source = url;\n\t\t\treturn;\n\t\t}\n\n\t\tvar isProtocolRelative = url.indexOf('//') === 0;\n\n\t\t// Absolute path with no host, fake host and protocol\n\t\tif (url.indexOf('/') === 0 && !isProtocolRelative) {\n\t\t\turl = (baseUri ? baseUri.protocol || 'http' : 'http') + '://mce_host' + url;\n\t\t}\n\n\t\t// Relative path http:// or protocol relative //path\n\t\tif (!/^[\\w\\-]*:?\\/\\//.test(url)) {\n\t\t\tbase_url = settings.base_uri ? settings.base_uri.path : new URI(location.href).directory;\n\t\t\tif (settings.base_uri.protocol === \"\") {\n\t\t\t\turl = '//mce_host' + self.toAbsPath(base_url, url);\n\t\t\t} else {\n\t\t\t\turl = /([^#?]*)([#?]?.*)/.exec(url);\n\t\t\t\turl = ((baseUri && baseUri.protocol) || 'http') + '://mce_host' + self.toAbsPath(base_url, url[1]) + url[2];\n\t\t\t}\n\t\t}\n\n\t\t// Parse URL (Credits goes to Steave, http://blog.stevenlevithan.com/archives/parseuri)\n\t\turl = url.replace(/@@/g, '(mce_at)'); // Zope 3 workaround, they use @@something\n\n\t\t/*jshint maxlen: 255 */\n\t\t/*eslint max-len: 0 */\n\t\turl = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@\\/]*):?([^:@\\/]*))?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(url);\n\n\t\teach(queryParts, function(v, i) {\n\t\t\tvar part = url[i];\n\n\t\t\t// Zope 3 workaround, they use @@something\n\t\t\tif (part) {\n\t\t\t\tpart = part.replace(/\\(mce_at\\)/g, '@@');\n\t\t\t}\n\n\t\t\tself[v] = part;\n\t\t});\n\n\t\tif (baseUri) {\n\t\t\tif (!self.protocol) {\n\t\t\t\tself.protocol = baseUri.protocol;\n\t\t\t}\n\n\t\t\tif (!self.userInfo) {\n\t\t\t\tself.userInfo = baseUri.userInfo;\n\t\t\t}\n\n\t\t\tif (!self.port && self.host === 'mce_host') {\n\t\t\t\tself.port = baseUri.port;\n\t\t\t}\n\n\t\t\tif (!self.host || self.host === 'mce_host') {\n\t\t\t\tself.host = baseUri.host;\n\t\t\t}\n\n\t\t\tself.source = '';\n\t\t}\n\n\t\tif (isProtocolRelative) {\n\t\t\tself.protocol = '';\n\t\t}\n\n\t\t//t.path = t.path || '/';\n\t}\n\n\tURI.prototype = {\n\t\t/**\n\t\t * Sets the internal path part of the URI.\n\t\t *\n\t\t * @method setPath\n\t\t * @param {string} path Path string to set.\n\t\t */\n\t\tsetPath: function(path) {\n\t\t\tvar self = this;\n\n\t\t\tpath = /^(.*?)\\/?(\\w+)?$/.exec(path);\n\n\t\t\t// Update path parts\n\t\t\tself.path = path[0];\n\t\t\tself.directory = path[1];\n\t\t\tself.file = path[2];\n\n\t\t\t// Rebuild source\n\t\t\tself.source = '';\n\t\t\tself.getURI();\n\t\t},\n\n\t\t/**\n\t\t * Converts the specified URI into a relative URI based on the current URI instance location.\n\t\t *\n\t\t * @method toRelative\n\t\t * @param {String} uri URI to convert into a relative path/URI.\n\t\t * @return {String} Relative URI from the point specified in the current URI instance.\n\t\t * @example\n\t\t * // Converts an absolute URL to an relative URL url will be somedir/somefile.htm\n\t\t * var url = new tinymce.util.URI('http://www.site.com/dir/').toRelative('http://www.site.com/dir/somedir/somefile.htm');\n\t\t */\n\t\ttoRelative: function(uri) {\n\t\t\tvar self = this, output;\n\n\t\t\tif (uri === \"./\") {\n\t\t\t\treturn uri;\n\t\t\t}\n\n\t\t\turi = new URI(uri, {base_uri: self});\n\n\t\t\t// Not on same domain/port or protocol\n\t\t\tif ((uri.host != 'mce_host' && self.host != uri.host && uri.host) || self.port != uri.port ||\n\t\t\t\t(self.protocol != uri.protocol && uri.protocol !== \"\")) {\n\t\t\t\treturn uri.getURI();\n\t\t\t}\n\n\t\t\tvar tu = self.getURI(), uu = uri.getURI();\n\n\t\t\t// Allow usage of the base_uri when relative_urls = true\n\t\t\tif (tu == uu || (tu.charAt(tu.length - 1) == \"/\" && tu.substr(0, tu.length - 1) == uu)) {\n\t\t\t\treturn tu;\n\t\t\t}\n\n\t\t\toutput = self.toRelPath(self.path, uri.path);\n\n\t\t\t// Add query\n\t\t\tif (uri.query) {\n\t\t\t\toutput += '?' + uri.query;\n\t\t\t}\n\n\t\t\t// Add anchor\n\t\t\tif (uri.anchor) {\n\t\t\t\toutput += '#' + uri.anchor;\n\t\t\t}\n\n\t\t\treturn output;\n\t\t},\n\n\t\t/**\n\t\t * Converts the specified URI into a absolute URI based on the current URI instance location.\n\t\t *\n\t\t * @method toAbsolute\n\t\t * @param {String} uri URI to convert into a relative path/URI.\n\t\t * @param {Boolean} noHost No host and protocol prefix.\n\t\t * @return {String} Absolute URI from the point specified in the current URI instance.\n\t\t * @example\n\t\t * // Converts an relative URL to an absolute URL url will be http://www.site.com/dir/somedir/somefile.htm\n\t\t * var url = new tinymce.util.URI('http://www.site.com/dir/').toAbsolute('somedir/somefile.htm');\n\t\t */\n\t\ttoAbsolute: function(uri, noHost) {\n\t\t\turi = new URI(uri, {base_uri: this});\n\n\t\t\treturn uri.getURI(noHost && this.isSameOrigin(uri));\n\t\t},\n\n\t\t/**\n\t\t * Determine whether the given URI has the same origin as this URI.  Based on RFC-6454.\n\t\t * Supports default ports for protocols listed in DEFAULT_PORTS.  Unsupported protocols will fail safe: they\n\t\t * won't match, if the port specifications differ.\n\t\t *\n\t\t * @method isSameOrigin\n\t\t * @param {tinymce.util.URI} uri Uri instance to compare.\n\t\t * @returns {Boolean} True if the origins are the same.\n\t\t */\n\t\tisSameOrigin: function(uri) {\n\t\t\tif (this.host == uri.host && this.protocol == uri.protocol) {\n\t\t\t\tif (this.port == uri.port) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tvar defaultPort = DEFAULT_PORTS[this.protocol];\n\t\t\t\tif (defaultPort && ((this.port || defaultPort) == (uri.port || defaultPort))) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Converts a absolute path into a relative path.\n\t\t *\n\t\t * @method toRelPath\n\t\t * @param {String} base Base point to convert the path from.\n\t\t * @param {String} path Absolute path to convert into a relative path.\n\t\t */\n\t\ttoRelPath: function(base, path) {\n\t\t\tvar items, breakPoint = 0, out = '', i, l;\n\n\t\t\t// Split the paths\n\t\t\tbase = base.substring(0, base.lastIndexOf('/'));\n\t\t\tbase = base.split('/');\n\t\t\titems = path.split('/');\n\n\t\t\tif (base.length >= items.length) {\n\t\t\t\tfor (i = 0, l = base.length; i < l; i++) {\n\t\t\t\t\tif (i >= items.length || base[i] != items[i]) {\n\t\t\t\t\t\tbreakPoint = i + 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (base.length < items.length) {\n\t\t\t\tfor (i = 0, l = items.length; i < l; i++) {\n\t\t\t\t\tif (i >= base.length || base[i] != items[i]) {\n\t\t\t\t\t\tbreakPoint = i + 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (breakPoint === 1) {\n\t\t\t\treturn path;\n\t\t\t}\n\n\t\t\tfor (i = 0, l = base.length - (breakPoint - 1); i < l; i++) {\n\t\t\t\tout += \"../\";\n\t\t\t}\n\n\t\t\tfor (i = breakPoint - 1, l = items.length; i < l; i++) {\n\t\t\t\tif (i != breakPoint - 1) {\n\t\t\t\t\tout += \"/\" + items[i];\n\t\t\t\t} else {\n\t\t\t\t\tout += items[i];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn out;\n\t\t},\n\n\t\t/**\n\t\t * Converts a relative path into a absolute path.\n\t\t *\n\t\t * @method toAbsPath\n\t\t * @param {String} base Base point to convert the path from.\n\t\t * @param {String} path Relative path to convert into an absolute path.\n\t\t */\n\t\ttoAbsPath: function(base, path) {\n\t\t\tvar i, nb = 0, o = [], tr, outPath;\n\n\t\t\t// Split paths\n\t\t\ttr = /\\/$/.test(path) ? '/' : '';\n\t\t\tbase = base.split('/');\n\t\t\tpath = path.split('/');\n\n\t\t\t// Remove empty chunks\n\t\t\teach(base, function(k) {\n\t\t\t\tif (k) {\n\t\t\t\t\to.push(k);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tbase = o;\n\n\t\t\t// Merge relURLParts chunks\n\t\t\tfor (i = path.length - 1, o = []; i >= 0; i--) {\n\t\t\t\t// Ignore empty or .\n\t\t\t\tif (path[i].length === 0 || path[i] === \".\") {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Is parent\n\t\t\t\tif (path[i] === '..') {\n\t\t\t\t\tnb++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Move up\n\t\t\t\tif (nb > 0) {\n\t\t\t\t\tnb--;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\to.push(path[i]);\n\t\t\t}\n\n\t\t\ti = base.length - nb;\n\n\t\t\t// If /a/b/c or /\n\t\t\tif (i <= 0) {\n\t\t\t\toutPath = o.reverse().join('/');\n\t\t\t} else {\n\t\t\t\toutPath = base.slice(0, i).join('/') + '/' + o.reverse().join('/');\n\t\t\t}\n\n\t\t\t// Add front / if it's needed\n\t\t\tif (outPath.indexOf('/') !== 0) {\n\t\t\t\toutPath = '/' + outPath;\n\t\t\t}\n\n\t\t\t// Add traling / if it's needed\n\t\t\tif (tr && outPath.lastIndexOf('/') !== outPath.length - 1) {\n\t\t\t\toutPath += tr;\n\t\t\t}\n\n\t\t\treturn outPath;\n\t\t},\n\n\t\t/**\n\t\t * Returns the full URI of the internal structure.\n\t\t *\n\t\t * @method getURI\n\t\t * @param {Boolean} noProtoHost Optional no host and protocol part. Defaults to false.\n\t\t */\n\t\tgetURI: function(noProtoHost) {\n\t\t\tvar s, self = this;\n\n\t\t\t// Rebuild source\n\t\t\tif (!self.source || noProtoHost) {\n\t\t\t\ts = '';\n\n\t\t\t\tif (!noProtoHost) {\n\t\t\t\t\tif (self.protocol) {\n\t\t\t\t\t\ts += self.protocol + '://';\n\t\t\t\t\t} else {\n\t\t\t\t\t\ts += '//';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (self.userInfo) {\n\t\t\t\t\t\ts += self.userInfo + '@';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (self.host) {\n\t\t\t\t\t\ts += self.host;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (self.port) {\n\t\t\t\t\t\ts += ':' + self.port;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (self.path) {\n\t\t\t\t\ts += self.path;\n\t\t\t\t}\n\n\t\t\t\tif (self.query) {\n\t\t\t\t\ts += '?' + self.query;\n\t\t\t\t}\n\n\t\t\t\tif (self.anchor) {\n\t\t\t\t\ts += '#' + self.anchor;\n\t\t\t\t}\n\n\t\t\t\tself.source = s;\n\t\t\t}\n\n\t\t\treturn self.source;\n\t\t}\n\t};\n\n\tURI.parseDataUri = function(uri) {\n\t\tvar type, matches;\n\n\t\turi = decodeURIComponent(uri).split(',');\n\n\t\tmatches = /data:([^;]+)/.exec(uri[0]);\n\t\tif (matches) {\n\t\t\ttype = matches[1];\n\t\t}\n\n\t\treturn {\n\t\t\ttype: type,\n\t\t\tdata: uri[1]\n\t\t};\n\t};\n\n\tURI.getDocumentBaseUrl = function(loc) {\n\t\tvar baseUrl;\n\n\t\t// Pass applewebdata:// and other non web protocols though\n\t\tif (loc.protocol.indexOf('http') !== 0 && loc.protocol !== 'file:') {\n\t\t\tbaseUrl = loc.href;\n\t\t} else {\n\t\t\tbaseUrl = loc.protocol + '//' + loc.host + loc.pathname;\n\t\t}\n\n\t\tif (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(baseUrl)) {\n\t\t\tbaseUrl = baseUrl.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n\n\t\t\tif (!/[\\/\\\\]$/.test(baseUrl)) {\n\t\t\t\tbaseUrl += '/';\n\t\t\t}\n\t\t}\n\n\t\treturn baseUrl;\n\t};\n\n\treturn URI;\n});\n\n// Included from: js/tinymce/classes/util/Class.js\n\n/**\n * Class.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This utilitiy class is used for easier inheritance.\n *\n * Features:\n * * Exposed super functions: this._super();\n * * Mixins\n * * Dummy functions\n * * Property functions: var value = object.value(); and object.value(newValue);\n * * Static functions\n * * Defaults settings\n */\ndefine(\"tinymce/util/Class\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\tvar each = Tools.each, extend = Tools.extend;\n\n\tvar extendClass, initializing;\n\n\tfunction Class() {\n\t}\n\n\t// Provides classical inheritance, based on code made by John Resig\n\tClass.extend = extendClass = function(prop) {\n\t\tvar self = this, _super = self.prototype, prototype, name, member;\n\n\t\t// The dummy class constructor\n\t\tfunction Class() {\n\t\t\tvar i, mixins, mixin, self = this;\n\n\t\t\t// All construction is actually done in the init method\n\t\t\tif (!initializing) {\n\t\t\t\t// Run class constuctor\n\t\t\t\tif (self.init) {\n\t\t\t\t\tself.init.apply(self, arguments);\n\t\t\t\t}\n\n\t\t\t\t// Run mixin constructors\n\t\t\t\tmixins = self.Mixins;\n\t\t\t\tif (mixins) {\n\t\t\t\t\ti = mixins.length;\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tmixin = mixins[i];\n\t\t\t\t\t\tif (mixin.init) {\n\t\t\t\t\t\t\tmixin.init.apply(self, arguments);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Dummy function, needs to be extended in order to provide functionality\n\t\tfunction dummy() {\n\t\t\treturn this;\n\t\t}\n\n\t\t// Creates a overloaded method for the class\n\t\t// this enables you to use this._super(); to call the super function\n\t\tfunction createMethod(name, fn) {\n\t\t\treturn function() {\n\t\t\t\tvar self = this, tmp = self._super, ret;\n\n\t\t\t\tself._super = _super[name];\n\t\t\t\tret = fn.apply(self, arguments);\n\t\t\t\tself._super = tmp;\n\n\t\t\t\treturn ret;\n\t\t\t};\n\t\t}\n\n\t\t// Instantiate a base class (but only create the instance,\n\t\t// don't run the init constructor)\n\t\tinitializing = true;\n\n\t\t/*eslint new-cap:0 */\n\t\tprototype = new self();\n\t\tinitializing = false;\n\n\t\t// Add mixins\n\t\tif (prop.Mixins) {\n\t\t\teach(prop.Mixins, function(mixin) {\n\t\t\t\tfor (var name in mixin) {\n\t\t\t\t\tif (name !== \"init\") {\n\t\t\t\t\t\tprop[name] = mixin[name];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (_super.Mixins) {\n\t\t\t\tprop.Mixins = _super.Mixins.concat(prop.Mixins);\n\t\t\t}\n\t\t}\n\n\t\t// Generate dummy methods\n\t\tif (prop.Methods) {\n\t\t\teach(prop.Methods.split(','), function(name) {\n\t\t\t\tprop[name] = dummy;\n\t\t\t});\n\t\t}\n\n\t\t// Generate property methods\n\t\tif (prop.Properties) {\n\t\t\teach(prop.Properties.split(','), function(name) {\n\t\t\t\tvar fieldName = '_' + name;\n\n\t\t\t\tprop[name] = function(value) {\n\t\t\t\t\tvar self = this, undef;\n\n\t\t\t\t\t// Set value\n\t\t\t\t\tif (value !== undef) {\n\t\t\t\t\t\tself[fieldName] = value;\n\n\t\t\t\t\t\treturn self;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Get value\n\t\t\t\t\treturn self[fieldName];\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\t// Static functions\n\t\tif (prop.Statics) {\n\t\t\teach(prop.Statics, function(func, name) {\n\t\t\t\tClass[name] = func;\n\t\t\t});\n\t\t}\n\n\t\t// Default settings\n\t\tif (prop.Defaults && _super.Defaults) {\n\t\t\tprop.Defaults = extend({}, _super.Defaults, prop.Defaults);\n\t\t}\n\n\t\t// Copy the properties over onto the new prototype\n\t\tfor (name in prop) {\n\t\t\tmember = prop[name];\n\n\t\t\tif (typeof member == \"function\" && _super[name]) {\n\t\t\t\tprototype[name] = createMethod(name, member);\n\t\t\t} else {\n\t\t\t\tprototype[name] = member;\n\t\t\t}\n\t\t}\n\n\t\t// Populate our constructed prototype object\n\t\tClass.prototype = prototype;\n\n\t\t// Enforce the constructor to be what we expect\n\t\tClass.constructor = Class;\n\n\t\t// And make this class extendible\n\t\tClass.extend = extendClass;\n\n\t\treturn Class;\n\t};\n\n\treturn Class;\n});\n\n// Included from: js/tinymce/classes/util/EventDispatcher.js\n\n/**\n * EventDispatcher.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class lets you add/remove and fire events by name on the specified scope. This makes\n * it easy to add event listener logic to any class.\n *\n * @class tinymce.util.EventDispatcher\n * @example\n *  var eventDispatcher = new EventDispatcher();\n *\n *  eventDispatcher.on('click', function() {console.log('data');});\n *  eventDispatcher.fire('click', {data: 123});\n */\ndefine(\"tinymce/util/EventDispatcher\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\tvar nativeEvents = Tools.makeMap(\n\t\t\"focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange \" +\n\t\t\"mouseout mouseenter mouseleave wheel keydown keypress keyup input contextmenu dragstart dragend dragover \" +\n\t\t\"draggesture dragdrop drop drag submit \" +\n\t\t\"compositionstart compositionend compositionupdate touchstart touchmove touchend\",\n\t\t' '\n\t);\n\n\tfunction Dispatcher(settings) {\n\t\tvar self = this, scope, bindings = {}, toggleEvent;\n\n\t\tfunction returnFalse() {\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction returnTrue() {\n\t\t\treturn true;\n\t\t}\n\n\t\tsettings = settings || {};\n\t\tscope = settings.scope || self;\n\t\ttoggleEvent = settings.toggleEvent || returnFalse;\n\n\t\t/**\n\t\t * Fires the specified event by name.\n\t\t *\n\t\t * @method fire\n\t\t * @param {String} name Name of the event to fire.\n\t\t * @param {Object?} args Event arguments.\n\t\t * @return {Object} Event args instance passed in.\n\t\t * @example\n\t\t * instance.fire('event', {...});\n\t\t */\n\t\tfunction fire(name, args) {\n\t\t\tvar handlers, i, l, callback;\n\n\t\t\tname = name.toLowerCase();\n\t\t\targs = args || {};\n\t\t\targs.type = name;\n\n\t\t\t// Setup target is there isn't one\n\t\t\tif (!args.target) {\n\t\t\t\targs.target = scope;\n\t\t\t}\n\n\t\t\t// Add event delegation methods if they are missing\n\t\t\tif (!args.preventDefault) {\n\t\t\t\t// Add preventDefault method\n\t\t\t\targs.preventDefault = function() {\n\t\t\t\t\targs.isDefaultPrevented = returnTrue;\n\t\t\t\t};\n\n\t\t\t\t// Add stopPropagation\n\t\t\t\targs.stopPropagation = function() {\n\t\t\t\t\targs.isPropagationStopped = returnTrue;\n\t\t\t\t};\n\n\t\t\t\t// Add stopImmediatePropagation\n\t\t\t\targs.stopImmediatePropagation = function() {\n\t\t\t\t\targs.isImmediatePropagationStopped = returnTrue;\n\t\t\t\t};\n\n\t\t\t\t// Add event delegation states\n\t\t\t\targs.isDefaultPrevented = returnFalse;\n\t\t\t\targs.isPropagationStopped = returnFalse;\n\t\t\t\targs.isImmediatePropagationStopped = returnFalse;\n\t\t\t}\n\n\t\t\tif (settings.beforeFire) {\n\t\t\t\tsettings.beforeFire(args);\n\t\t\t}\n\n\t\t\thandlers = bindings[name];\n\t\t\tif (handlers) {\n\t\t\t\tfor (i = 0, l = handlers.length; i < l; i++) {\n\t\t\t\t\tcallback = handlers[i];\n\n\t\t\t\t\t// Unbind handlers marked with \"once\"\n\t\t\t\t\tif (callback.once) {\n\t\t\t\t\t\toff(name, callback.func);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Stop immediate propagation if needed\n\t\t\t\t\tif (args.isImmediatePropagationStopped()) {\n\t\t\t\t\t\targs.stopPropagation();\n\t\t\t\t\t\treturn args;\n\t\t\t\t\t}\n\n\t\t\t\t\t// If callback returns false then prevent default and stop all propagation\n\t\t\t\t\tif (callback.func.call(scope, args) === false) {\n\t\t\t\t\t\targs.preventDefault();\n\t\t\t\t\t\treturn args;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn args;\n\t\t}\n\n\t\t/**\n\t\t * Binds an event listener to a specific event by name.\n\t\t *\n\t\t * @method on\n\t\t * @param {String} name Event name or space separated list of events to bind.\n\t\t * @param {callback} callback Callback to be executed when the event occurs.\n\t\t * @param {Boolean} first Optional flag if the event should be prepended. Use this with care.\n\t\t * @return {Object} Current class instance.\n\t\t * @example\n\t\t * instance.on('event', function(e) {\n\t\t *     // Callback logic\n\t\t * });\n\t\t */\n\t\tfunction on(name, callback, prepend, extra) {\n\t\t\tvar handlers, names, i;\n\n\t\t\tif (callback === false) {\n\t\t\t\tcallback = returnFalse;\n\t\t\t}\n\n\t\t\tif (callback) {\n\t\t\t\tcallback = {\n\t\t\t\t\tfunc: callback\n\t\t\t\t};\n\n\t\t\t\tif (extra) {\n\t\t\t\t\tTools.extend(callback, extra);\n\t\t\t\t}\n\n\t\t\t\tnames = name.toLowerCase().split(' ');\n\t\t\t\ti = names.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tname = names[i];\n\t\t\t\t\thandlers = bindings[name];\n\t\t\t\t\tif (!handlers) {\n\t\t\t\t\t\thandlers = bindings[name] = [];\n\t\t\t\t\t\ttoggleEvent(name, true);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (prepend) {\n\t\t\t\t\t\thandlers.unshift(callback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\thandlers.push(callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self;\n\t\t}\n\n\t\t/**\n\t\t * Unbinds an event listener to a specific event by name.\n\t\t *\n\t\t * @method off\n\t\t * @param {String?} name Name of the event to unbind.\n\t\t * @param {callback?} callback Callback to unbind.\n\t\t * @return {Object} Current class instance.\n\t\t * @example\n\t\t * // Unbind specific callback\n\t\t * instance.off('event', handler);\n\t\t *\n\t\t * // Unbind all listeners by name\n\t\t * instance.off('event');\n\t\t *\n\t\t * // Unbind all events\n\t\t * instance.off();\n\t\t */\n\t\tfunction off(name, callback) {\n\t\t\tvar i, handlers, bindingName, names, hi;\n\n\t\t\tif (name) {\n\t\t\t\tnames = name.toLowerCase().split(' ');\n\t\t\t\ti = names.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tname = names[i];\n\t\t\t\t\thandlers = bindings[name];\n\n\t\t\t\t\t// Unbind all handlers\n\t\t\t\t\tif (!name) {\n\t\t\t\t\t\tfor (bindingName in bindings) {\n\t\t\t\t\t\t\ttoggleEvent(bindingName, false);\n\t\t\t\t\t\t\tdelete bindings[bindingName];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn self;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (handlers) {\n\t\t\t\t\t\t// Unbind all by name\n\t\t\t\t\t\tif (!callback) {\n\t\t\t\t\t\t\thandlers.length = 0;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Unbind specific ones\n\t\t\t\t\t\t\thi = handlers.length;\n\t\t\t\t\t\t\twhile (hi--) {\n\t\t\t\t\t\t\t\tif (handlers[hi].func === callback) {\n\t\t\t\t\t\t\t\t\thandlers = handlers.slice(0, hi).concat(handlers.slice(hi + 1));\n\t\t\t\t\t\t\t\t\tbindings[name] = handlers;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!handlers.length) {\n\t\t\t\t\t\t\ttoggleEvent(name, false);\n\t\t\t\t\t\t\tdelete bindings[name];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (name in bindings) {\n\t\t\t\t\ttoggleEvent(name, false);\n\t\t\t\t}\n\n\t\t\t\tbindings = {};\n\t\t\t}\n\n\t\t\treturn self;\n\t\t}\n\n\t\t/**\n\t\t * Binds an event listener to a specific event by name\n\t\t * and automatically unbind the event once the callback fires.\n\t\t *\n\t\t * @method once\n\t\t * @param {String} name Event name or space separated list of events to bind.\n\t\t * @param {callback} callback Callback to be executed when the event occurs.\n\t\t * @param {Boolean} first Optional flag if the event should be prepended. Use this with care.\n\t\t * @return {Object} Current class instance.\n\t\t * @example\n\t\t * instance.once('event', function(e) {\n\t\t *     // Callback logic\n\t\t * });\n\t\t */\n\t\tfunction once(name, callback, prepend) {\n\t\t\treturn on(name, callback, prepend, {once: true});\n\t\t}\n\n\t\t/**\n\t\t * Returns true/false if the dispatcher has a event of the specified name.\n\t\t *\n\t\t * @method has\n\t\t * @param {String} name Name of the event to check for.\n\t\t * @return {Boolean} true/false if the event exists or not.\n\t\t */\n\t\tfunction has(name) {\n\t\t\tname = name.toLowerCase();\n\t\t\treturn !(!bindings[name] || bindings[name].length === 0);\n\t\t}\n\n\t\t// Expose\n\t\tself.fire = fire;\n\t\tself.on = on;\n\t\tself.off = off;\n\t\tself.once = once;\n\t\tself.has = has;\n\t}\n\n\t/**\n\t * Returns true/false if the specified event name is a native browser event or not.\n\t *\n\t * @method isNative\n\t * @param {String} name Name to check if it's native.\n\t * @return {Boolean} true/false if the event is native or not.\n\t * @static\n\t */\n\tDispatcher.isNative = function(name) {\n\t\treturn !!nativeEvents[name.toLowerCase()];\n\t};\n\n\treturn Dispatcher;\n});\n\n// Included from: js/tinymce/classes/data/Binding.js\n\n/**\n * Binding.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class gets dynamically extended to provide a binding between two models. This makes it possible to\n * sync the state of two properties in two models by a layer of abstraction.\n *\n * @private\n * @class tinymce.data.Binding\n */\ndefine(\"tinymce/data/Binding\", [], function() {\n\t/**\n\t * Constructs a new bidning.\n\t *\n\t * @constructor\n\t * @method Binding\n\t * @param {Object} settings Settings to the binding.\n\t */\n\tfunction Binding(settings) {\n\t\tthis.create = settings.create;\n\t}\n\n\t/**\n\t * Creates a binding for a property on a model.\n\t *\n\t * @method create\n\t * @param {tinymce.data.ObservableObject} model Model to create binding to.\n\t * @param {String} name Name of property to bind.\n\t * @return {tinymce.data.Binding} Binding instance.\n\t */\n\tBinding.create = function(model, name) {\n\t\treturn new Binding({\n\t\t\tcreate: function(otherModel, otherName) {\n\t\t\t\tvar bindings;\n\n\t\t\t\tfunction fromSelfToOther(e) {\n\t\t\t\t\totherModel.set(otherName, e.value);\n\t\t\t\t}\n\n\t\t\t\tfunction fromOtherToSelf(e) {\n\t\t\t\t\tmodel.set(name, e.value);\n\t\t\t\t}\n\n\t\t\t\totherModel.on('change:' + otherName, fromOtherToSelf);\n\t\t\t\tmodel.on('change:' + name, fromSelfToOther);\n\n\t\t\t\t// Keep track of the bindings\n\t\t\t\tbindings = otherModel._bindings;\n\n\t\t\t\tif (!bindings) {\n\t\t\t\t\tbindings = otherModel._bindings = [];\n\n\t\t\t\t\totherModel.on('destroy', function() {\n\t\t\t\t\t\tvar i = bindings.length;\n\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tbindings[i]();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tbindings.push(function() {\n\t\t\t\t\tmodel.off('change:' + name, fromSelfToOther);\n\t\t\t\t});\n\n\t\t\t\treturn model.get(name);\n\t\t\t}\n\t\t});\n\t};\n\n\treturn Binding;\n});\n\n// Included from: js/tinymce/classes/util/Observable.js\n\n/**\n * Observable.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This mixin will add event binding logic to classes.\n *\n * @mixin tinymce.util.Observable\n */\ndefine(\"tinymce/util/Observable\", [\n\t\"tinymce/util/EventDispatcher\"\n], function(EventDispatcher) {\n\tfunction getEventDispatcher(obj) {\n\t\tif (!obj._eventDispatcher) {\n\t\t\tobj._eventDispatcher = new EventDispatcher({\n\t\t\t\tscope: obj,\n\t\t\t\ttoggleEvent: function(name, state) {\n\t\t\t\t\tif (EventDispatcher.isNative(name) && obj.toggleNativeEvent) {\n\t\t\t\t\t\tobj.toggleNativeEvent(name, state);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn obj._eventDispatcher;\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Fires the specified event by name. Consult the\n\t\t * <a href=\"/docs/advanced/events\">event reference</a> for more details on each event.\n\t\t *\n\t\t * @method fire\n\t\t * @param {String} name Name of the event to fire.\n\t\t * @param {Object?} args Event arguments.\n\t\t * @param {Boolean?} bubble True/false if the event is to be bubbled.\n\t\t * @return {Object} Event args instance passed in.\n\t\t * @example\n\t\t * instance.fire('event', {...});\n\t\t */\n\t\tfire: function(name, args, bubble) {\n\t\t\tvar self = this;\n\n\t\t\t// Prevent all events except the remove event after the instance has been removed\n\t\t\tif (self.removed && name !== \"remove\") {\n\t\t\t\treturn args;\n\t\t\t}\n\n\t\t\targs = getEventDispatcher(self).fire(name, args, bubble);\n\n\t\t\t// Bubble event up to parents\n\t\t\tif (bubble !== false && self.parent) {\n\t\t\t\tvar parent = self.parent();\n\t\t\t\twhile (parent && !args.isPropagationStopped()) {\n\t\t\t\t\tparent.fire(name, args, false);\n\t\t\t\t\tparent = parent.parent();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn args;\n\t\t},\n\n\t\t/**\n\t\t * Binds an event listener to a specific event by name. Consult the\n\t\t * <a href=\"/docs/advanced/events\">event reference</a> for more details on each event.\n\t\t *\n\t\t * @method on\n\t\t * @param {String} name Event name or space separated list of events to bind.\n\t\t * @param {callback} callback Callback to be executed when the event occurs.\n\t\t * @param {Boolean} first Optional flag if the event should be prepended. Use this with care.\n\t\t * @return {Object} Current class instance.\n\t\t * @example\n\t\t * instance.on('event', function(e) {\n\t\t *     // Callback logic\n\t\t * });\n\t\t */\n\t\ton: function(name, callback, prepend) {\n\t\t\treturn getEventDispatcher(this).on(name, callback, prepend);\n\t\t},\n\n\t\t/**\n\t\t * Unbinds an event listener to a specific event by name. Consult the\n\t\t * <a href=\"/docs/advanced/events\">event reference</a> for more details on each event.\n\t\t *\n\t\t * @method off\n\t\t * @param {String?} name Name of the event to unbind.\n\t\t * @param {callback?} callback Callback to unbind.\n\t\t * @return {Object} Current class instance.\n\t\t * @example\n\t\t * // Unbind specific callback\n\t\t * instance.off('event', handler);\n\t\t *\n\t\t * // Unbind all listeners by name\n\t\t * instance.off('event');\n\t\t *\n\t\t * // Unbind all events\n\t\t * instance.off();\n\t\t */\n\t\toff: function(name, callback) {\n\t\t\treturn getEventDispatcher(this).off(name, callback);\n\t\t},\n\n\t\t/**\n\t\t * Bind the event callback and once it fires the callback is removed. Consult the\n\t\t * <a href=\"/docs/advanced/events\">event reference</a> for more details on each event.\n\t\t *\n\t\t * @method once\n\t\t * @param {String} name Name of the event to bind.\n\t\t * @param {callback} callback Callback to bind only once.\n\t\t * @return {Object} Current class instance.\n\t\t */\n\t\tonce: function(name, callback) {\n\t\t\treturn getEventDispatcher(this).once(name, callback);\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the object has a event of the specified name.\n\t\t *\n\t\t * @method hasEventListeners\n\t\t * @param {String} name Name of the event to check for.\n\t\t * @return {Boolean} true/false if the event exists or not.\n\t\t */\n\t\thasEventListeners: function(name) {\n\t\t\treturn getEventDispatcher(this).has(name);\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/data/ObservableObject.js\n\n/**\n * ObservableObject.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is a object that is observable when properties changes a change event gets emitted.\n *\n * @private\n * @class tinymce.data.ObservableObject\n */\ndefine(\"tinymce/data/ObservableObject\", [\n\t\"tinymce/data/Binding\",\n\t\"tinymce/util/Observable\",\n\t\"tinymce/util/Class\",\n\t\"tinymce/util/Tools\"\n], function(Binding, Observable, Class, Tools) {\n\tfunction isNode(node) {\n\t\treturn node.nodeType > 0;\n\t}\n\n\t// Todo: Maybe this should be shallow compare since it might be huge object references\n\tfunction isEqual(a, b) {\n\t\tvar k, checked;\n\n\t\t// Strict equals\n\t\tif (a === b) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Compare null\n\t\tif (a === null || b === null) {\n\t\t\treturn a === b;\n\t\t}\n\n\t\t// Compare number, boolean, string, undefined\n\t\tif (typeof a !== \"object\" || typeof b !== \"object\") {\n\t\t\treturn a === b;\n\t\t}\n\n\t\t// Compare arrays\n\t\tif (Tools.isArray(b)) {\n\t\t\tif (a.length !== b.length) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tk = a.length;\n\t\t\twhile (k--) {\n\t\t\t\tif (!isEqual(a[k], b[k])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Shallow compare nodes\n\t\tif (isNode(a) || isNode(b)) {\n\t\t\treturn a === b;\n\t\t}\n\n\t\t// Compare objects\n\t\tchecked = {};\n\t\tfor (k in b) {\n\t\t\tif (!isEqual(a[k], b[k])) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tchecked[k] = true;\n\t\t}\n\n\t\tfor (k in a) {\n\t\t\tif (!checked[k] && !isEqual(a[k], b[k])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\treturn Class.extend({\n\t\tMixins: [Observable],\n\n\t\t/**\n\t\t * Constructs a new observable object instance.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} data Initial data for the object.\n\t\t */\n\t\tinit: function(data) {\n\t\t\tvar name, value;\n\n\t\t\tdata = data || {};\n\n\t\t\tfor (name in data) {\n\t\t\t\tvalue = data[name];\n\n\t\t\t\tif (value instanceof Binding) {\n\t\t\t\t\tdata[name] = value.create(this, name);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.data = data;\n\t\t},\n\n\t\t/**\n\t\t * Sets a property on the value this will call\n\t\t * observers if the value is a change from the current value.\n\t\t *\n\t\t * @method set\n\t\t * @param {String/object} name Name of the property to set or a object of items to set.\n\t\t * @param {Object} value Value to set for the property.\n\t\t * @return {tinymce.data.ObservableObject} Observable object instance.\n\t\t */\n\t\tset: function(name, value) {\n\t\t\tvar key, args, oldValue = this.data[name];\n\n\t\t\tif (value instanceof Binding) {\n\t\t\t\tvalue = value.create(this, name);\n\t\t\t}\n\n\t\t\tif (typeof name === \"object\") {\n\t\t\t\tfor (key in name) {\n\t\t\t\t\tthis.set(key, name[key]);\n\t\t\t\t}\n\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\tif (!isEqual(oldValue, value)) {\n\t\t\t\tthis.data[name] = value;\n\n\t\t\t\targs = {\n\t\t\t\t\ttarget: this,\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\toldValue: oldValue\n\t\t\t\t};\n\n\t\t\t\tthis.fire('change:' + name, args);\n\t\t\t\tthis.fire('change', args);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Gets a property by name.\n\t\t *\n\t\t * @method get\n\t\t * @param {String} name Name of the property to get.\n\t\t * @return {Object} Object value of propery.\n\t\t */\n\t\tget: function(name) {\n\t\t\treturn this.data[name];\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the specified property exists.\n\t\t *\n\t\t * @method has\n\t\t * @param {String} name Name of the property to check for.\n\t\t * @return {Boolean} true/false if the item exists.\n\t\t */\n\t\thas: function(name) {\n\t\t\treturn name in this.data;\n\t\t},\n\n\t\t/**\n\t\t * Returns a dynamic property binding for the specified property name. This makes\n\t\t * it possible to sync the state of two properties in two ObservableObject instances.\n\t\t *\n\t\t * @method bind\n\t\t * @param {String} name Name of the property to sync with the property it's inserted to.\n\t\t * @return {tinymce.data.Binding} Data binding instance.\n\t\t */\n\t\tbind: function(name) {\n\t\t\treturn Binding.create(this, name);\n\t\t},\n\n\t\t/**\n\t\t * Destroys the observable object and fires the \"destroy\"\n\t\t * event and clean up any internal resources.\n\t\t *\n\t\t * @method destroy\n\t\t */\n\t\tdestroy: function() {\n\t\t\tthis.fire('destroy');\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Selector.js\n\n/**\n * Selector.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*eslint no-nested-ternary:0 */\n\n/**\n * Selector engine, enables you to select controls by using CSS like expressions.\n * We currently only support basic CSS expressions to reduce the size of the core\n * and the ones we support should be enough for most cases.\n *\n * @example\n * Supported expressions:\n *  element\n *  element#name\n *  element.class\n *  element[attr]\n *  element[attr*=value]\n *  element[attr~=value]\n *  element[attr!=value]\n *  element[attr^=value]\n *  element[attr$=value]\n *  element:<state>\n *  element:not(<expression>)\n *  element:first\n *  element:last\n *  element:odd\n *  element:even\n *  element element\n *  element > element\n *\n * @class tinymce.ui.Selector\n */\ndefine(\"tinymce/ui/Selector\", [\n\t\"tinymce/util/Class\"\n], function(Class) {\n\t\"use strict\";\n\n\t/**\n\t * Produces an array with a unique set of objects. It will not compare the values\n\t * but the references of the objects.\n\t *\n\t * @private\n\t * @method unqiue\n\t * @param {Array} array Array to make into an array with unique items.\n\t * @return {Array} Array with unique items.\n\t */\n\tfunction unique(array) {\n\t\tvar uniqueItems = [], i = array.length, item;\n\n\t\twhile (i--) {\n\t\t\titem = array[i];\n\n\t\t\tif (!item.__checked) {\n\t\t\t\tuniqueItems.push(item);\n\t\t\t\titem.__checked = 1;\n\t\t\t}\n\t\t}\n\n\t\ti = uniqueItems.length;\n\t\twhile (i--) {\n\t\t\tdelete uniqueItems[i].__checked;\n\t\t}\n\n\t\treturn uniqueItems;\n\t}\n\n\tvar expression = /^([\\w\\\\*]+)?(?:#([\\w\\-\\\\]+))?(?:\\.([\\w\\\\\\.]+))?(?:\\[\\@?([\\w\\\\]+)([\\^\\$\\*!~]?=)([\\w\\\\]+)\\])?(?:\\:(.+))?/i;\n\n\t/*jshint maxlen:255 */\n\t/*eslint max-len:0 */\n\tvar chunker = /((?:\\((?:\\([^()]+\\)|[^()]+)+\\)|\\[(?:\\[[^\\[\\]]*\\]|['\"][^'\"]*['\"]|[^\\[\\]'\"]+)+\\]|\\\\.|[^ >+~,(\\[\\\\]+)+|[>+~])(\\s*,\\s*)?((?:.|\\r|\\n)*)/g,\n\t\twhiteSpace = /^\\s*|\\s*$/g,\n\t\tCollection;\n\n\tvar Selector = Class.extend({\n\t\t/**\n\t\t * Constructs a new Selector instance.\n\t\t *\n\t\t * @constructor\n\t\t * @method init\n\t\t * @param {String} selector CSS like selector expression.\n\t\t */\n\t\tinit: function(selector) {\n\t\t\tvar match = this.match;\n\n\t\t\tfunction compileNameFilter(name) {\n\t\t\t\tif (name) {\n\t\t\t\t\tname = name.toLowerCase();\n\n\t\t\t\t\treturn function(item) {\n\t\t\t\t\t\treturn name === '*' || item.type === name;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction compileIdFilter(id) {\n\t\t\t\tif (id) {\n\t\t\t\t\treturn function(item) {\n\t\t\t\t\t\treturn item._name === id;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction compileClassesFilter(classes) {\n\t\t\t\tif (classes) {\n\t\t\t\t\tclasses = classes.split('.');\n\n\t\t\t\t\treturn function(item) {\n\t\t\t\t\t\tvar i = classes.length;\n\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tif (!item.classes.contains(classes[i])) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction compileAttrFilter(name, cmp, check) {\n\t\t\t\tif (name) {\n\t\t\t\t\treturn function(item) {\n\t\t\t\t\t\tvar value = item[name] ? item[name]() : '';\n\n\t\t\t\t\t\treturn !cmp ? !!check :\n\t\t\t\t\t\t\tcmp === \"=\" ? value === check :\n\t\t\t\t\t\t\tcmp === \"*=\" ? value.indexOf(check) >= 0 :\n\t\t\t\t\t\t\tcmp === \"~=\" ? (\" \" + value + \" \").indexOf(\" \" + check + \" \") >= 0 :\n\t\t\t\t\t\t\tcmp === \"!=\" ? value != check :\n\t\t\t\t\t\t\tcmp === \"^=\" ? value.indexOf(check) === 0 :\n\t\t\t\t\t\t\tcmp === \"$=\" ? value.substr(value.length - check.length) === check :\n\t\t\t\t\t\t\tfalse;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction compilePsuedoFilter(name) {\n\t\t\t\tvar notSelectors;\n\n\t\t\t\tif (name) {\n\t\t\t\t\tname = /(?:not\\((.+)\\))|(.+)/i.exec(name);\n\n\t\t\t\t\tif (!name[1]) {\n\t\t\t\t\t\tname = name[2];\n\n\t\t\t\t\t\treturn function(item, index, length) {\n\t\t\t\t\t\t\treturn name === 'first' ? index === 0 :\n\t\t\t\t\t\t\t\tname === 'last' ? index === length - 1 :\n\t\t\t\t\t\t\t\tname === 'even' ? index % 2 === 0 :\n\t\t\t\t\t\t\t\tname === 'odd' ? index % 2 === 1 :\n\t\t\t\t\t\t\t\titem[name] ? item[name]() :\n\t\t\t\t\t\t\t\tfalse;\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\t// Compile not expression\n\t\t\t\t\tnotSelectors = parseChunks(name[1], []);\n\n\t\t\t\t\treturn function(item) {\n\t\t\t\t\t\treturn !match(item, notSelectors);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction compile(selector, filters, direct) {\n\t\t\t\tvar parts;\n\n\t\t\t\tfunction add(filter) {\n\t\t\t\t\tif (filter) {\n\t\t\t\t\t\tfilters.push(filter);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Parse expression into parts\n\t\t\t\tparts = expression.exec(selector.replace(whiteSpace, ''));\n\n\t\t\t\tadd(compileNameFilter(parts[1]));\n\t\t\t\tadd(compileIdFilter(parts[2]));\n\t\t\t\tadd(compileClassesFilter(parts[3]));\n\t\t\t\tadd(compileAttrFilter(parts[4], parts[5], parts[6]));\n\t\t\t\tadd(compilePsuedoFilter(parts[7]));\n\n\t\t\t\t// Mark the filter with pseudo for performance\n\t\t\t\tfilters.pseudo = !!parts[7];\n\t\t\t\tfilters.direct = direct;\n\n\t\t\t\treturn filters;\n\t\t\t}\n\n\t\t\t// Parser logic based on Sizzle by John Resig\n\t\t\tfunction parseChunks(selector, selectors) {\n\t\t\t\tvar parts = [], extra, matches, i;\n\n\t\t\t\tdo {\n\t\t\t\t\tchunker.exec(\"\");\n\t\t\t\t\tmatches = chunker.exec(selector);\n\n\t\t\t\t\tif (matches) {\n\t\t\t\t\t\tselector = matches[3];\n\t\t\t\t\t\tparts.push(matches[1]);\n\n\t\t\t\t\t\tif (matches[2]) {\n\t\t\t\t\t\t\textra = matches[3];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} while (matches);\n\n\t\t\t\tif (extra) {\n\t\t\t\t\tparseChunks(extra, selectors);\n\t\t\t\t}\n\n\t\t\t\tselector = [];\n\t\t\t\tfor (i = 0; i < parts.length; i++) {\n\t\t\t\t\tif (parts[i] != '>') {\n\t\t\t\t\t\tselector.push(compile(parts[i], [], parts[i - 1] === '>'));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tselectors.push(selector);\n\n\t\t\t\treturn selectors;\n\t\t\t}\n\n\t\t\tthis._selectors = parseChunks(selector, []);\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the selector matches the specified control.\n\t\t *\n\t\t * @method match\n\t\t * @param {tinymce.ui.Control} control Control to match against the selector.\n\t\t * @param {Array} selectors Optional array of selectors, mostly used internally.\n\t\t * @return {Boolean} true/false state if the control matches or not.\n\t\t */\n\t\tmatch: function(control, selectors) {\n\t\t\tvar i, l, si, sl, selector, fi, fl, filters, index, length, siblings, count, item;\n\n\t\t\tselectors = selectors || this._selectors;\n\t\t\tfor (i = 0, l = selectors.length; i < l; i++) {\n\t\t\t\tselector = selectors[i];\n\t\t\t\tsl = selector.length;\n\t\t\t\titem = control;\n\t\t\t\tcount = 0;\n\n\t\t\t\tfor (si = sl - 1; si >= 0; si--) {\n\t\t\t\t\tfilters = selector[si];\n\n\t\t\t\t\twhile (item) {\n\t\t\t\t\t\t// Find the index and length since a pseudo filter like :first needs it\n\t\t\t\t\t\tif (filters.pseudo) {\n\t\t\t\t\t\t\tsiblings = item.parent().items();\n\t\t\t\t\t\t\tindex = length = siblings.length;\n\t\t\t\t\t\t\twhile (index--) {\n\t\t\t\t\t\t\t\tif (siblings[index] === item) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (fi = 0, fl = filters.length; fi < fl; fi++) {\n\t\t\t\t\t\t\tif (!filters[fi](item, index, length)) {\n\t\t\t\t\t\t\t\tfi = fl + 1;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (fi === fl) {\n\t\t\t\t\t\t\tcount++;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// If it didn't match the right most expression then\n\t\t\t\t\t\t\t// break since it's no point looking at the parents\n\t\t\t\t\t\t\tif (si === sl - 1) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\titem = item.parent();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If we found all selectors then return true otherwise continue looking\n\t\t\t\tif (count === sl) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Returns a tinymce.ui.Collection with matches of the specified selector inside the specified container.\n\t\t *\n\t\t * @method find\n\t\t * @param {tinymce.ui.Control} container Container to look for items in.\n\t\t * @return {tinymce.ui.Collection} Collection with matched elements.\n\t\t */\n\t\tfind: function(container) {\n\t\t\tvar matches = [], i, l, selectors = this._selectors;\n\n\t\t\tfunction collect(items, selector, index) {\n\t\t\t\tvar i, l, fi, fl, item, filters = selector[index];\n\n\t\t\t\tfor (i = 0, l = items.length; i < l; i++) {\n\t\t\t\t\titem = items[i];\n\n\t\t\t\t\t// Run each filter against the item\n\t\t\t\t\tfor (fi = 0, fl = filters.length; fi < fl; fi++) {\n\t\t\t\t\t\tif (!filters[fi](item, i, l)) {\n\t\t\t\t\t\t\tfi = fl + 1;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// All filters matched the item\n\t\t\t\t\tif (fi === fl) {\n\t\t\t\t\t\t// Matched item is on the last expression like: panel toolbar [button]\n\t\t\t\t\t\tif (index == selector.length - 1) {\n\t\t\t\t\t\t\tmatches.push(item);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Collect next expression type\n\t\t\t\t\t\t\tif (item.items) {\n\t\t\t\t\t\t\t\tcollect(item.items(), selector, index + 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (filters.direct) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Collect child items\n\t\t\t\t\tif (item.items) {\n\t\t\t\t\t\tcollect(item.items(), selector, index);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (container.items) {\n\t\t\t\tfor (i = 0, l = selectors.length; i < l; i++) {\n\t\t\t\t\tcollect(container.items(), selectors[i], 0);\n\t\t\t\t}\n\n\t\t\t\t// Unique the matches if needed\n\t\t\t\tif (l > 1) {\n\t\t\t\t\tmatches = unique(matches);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Fix for circular reference\n\t\t\tif (!Collection) {\n\t\t\t\t// TODO: Fix me!\n\t\t\t\tCollection = Selector.Collection;\n\t\t\t}\n\n\t\t\treturn new Collection(matches);\n\t\t}\n\t});\n\n\treturn Selector;\n});\n\n// Included from: js/tinymce/classes/ui/Collection.js\n\n/**\n * Collection.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Control collection, this class contains control instances and it enables you to\n * perform actions on all the contained items. This is very similar to how jQuery works.\n *\n * @example\n * someCollection.show().disabled(true);\n *\n * @class tinymce.ui.Collection\n */\ndefine(\"tinymce/ui/Collection\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/ui/Selector\",\n\t\"tinymce/util/Class\"\n], function(Tools, Selector, Class) {\n\t\"use strict\";\n\n\tvar Collection, proto, push = Array.prototype.push, slice = Array.prototype.slice;\n\n\tproto = {\n\t\t/**\n\t\t * Current number of contained control instances.\n\t\t *\n\t\t * @field length\n\t\t * @type Number\n\t\t */\n\t\tlength: 0,\n\n\t\t/**\n\t\t * Constructor for the collection.\n\t\t *\n\t\t * @constructor\n\t\t * @method init\n\t\t * @param {Array} items Optional array with items to add.\n\t\t */\n\t\tinit: function(items) {\n\t\t\tif (items) {\n\t\t\t\tthis.add(items);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Adds new items to the control collection.\n\t\t *\n\t\t * @method add\n\t\t * @param {Array} items Array if items to add to collection.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\tadd: function(items) {\n\t\t\tvar self = this;\n\n\t\t\t// Force single item into array\n\t\t\tif (!Tools.isArray(items)) {\n\t\t\t\tif (items instanceof Collection) {\n\t\t\t\t\tself.add(items.toArray());\n\t\t\t\t} else {\n\t\t\t\t\tpush.call(self, items);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tpush.apply(self, items);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Sets the contents of the collection. This will remove any existing items\n\t\t * and replace them with the ones specified in the input array.\n\t\t *\n\t\t * @method set\n\t\t * @param {Array} items Array with items to set into the Collection.\n\t\t * @return {tinymce.ui.Collection} Collection instance.\n\t\t */\n\t\tset: function(items) {\n\t\t\tvar self = this, len = self.length, i;\n\n\t\t\tself.length = 0;\n\t\t\tself.add(items);\n\n\t\t\t// Remove old entries\n\t\t\tfor (i = self.length; i < len; i++) {\n\t\t\t\tdelete self[i];\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Filters the collection item based on the specified selector expression or selector function.\n\t\t *\n\t\t * @method filter\n\t\t * @param {String} selector Selector expression to filter items by.\n\t\t * @return {tinymce.ui.Collection} Collection containing the filtered items.\n\t\t */\n\t\tfilter: function(selector) {\n\t\t\tvar self = this, i, l, matches = [], item, match;\n\n\t\t\t// Compile string into selector expression\n\t\t\tif (typeof selector === \"string\") {\n\t\t\t\tselector = new Selector(selector);\n\n\t\t\t\tmatch = function(item) {\n\t\t\t\t\treturn selector.match(item);\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\t// Use selector as matching function\n\t\t\t\tmatch = selector;\n\t\t\t}\n\n\t\t\tfor (i = 0, l = self.length; i < l; i++) {\n\t\t\t\titem = self[i];\n\n\t\t\t\tif (match(item)) {\n\t\t\t\t\tmatches.push(item);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn new Collection(matches);\n\t\t},\n\n\t\t/**\n\t\t * Slices the items within the collection.\n\t\t *\n\t\t * @method slice\n\t\t * @param {Number} index Index to slice at.\n\t\t * @param {Number} len Optional length to slice.\n\t\t * @return {tinymce.ui.Collection} Current collection.\n\t\t */\n\t\tslice: function() {\n\t\t\treturn new Collection(slice.apply(this, arguments));\n\t\t},\n\n\t\t/**\n\t\t * Makes the current collection equal to the specified index.\n\t\t *\n\t\t * @method eq\n\t\t * @param {Number} index Index of the item to set the collection to.\n\t\t * @return {tinymce.ui.Collection} Current collection.\n\t\t */\n\t\teq: function(index) {\n\t\t\treturn index === -1 ? this.slice(index) : this.slice(index, +index + 1);\n\t\t},\n\n\t\t/**\n\t\t * Executes the specified callback on each item in collection.\n\t\t *\n\t\t * @method each\n\t\t * @param {function} callback Callback to execute for each item in collection.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\teach: function(callback) {\n\t\t\tTools.each(this, callback);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Returns an JavaScript array object of the contents inside the collection.\n\t\t *\n\t\t * @method toArray\n\t\t * @return {Array} Array with all items from collection.\n\t\t */\n\t\ttoArray: function() {\n\t\t\treturn Tools.toArray(this);\n\t\t},\n\n\t\t/**\n\t\t * Finds the index of the specified control or return -1 if it isn't in the collection.\n\t\t *\n\t\t * @method indexOf\n\t\t * @param {Control} ctrl Control instance to look for.\n\t\t * @return {Number} Index of the specified control or -1.\n\t\t */\n\t\tindexOf: function(ctrl) {\n\t\t\tvar self = this, i = self.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tif (self[i] === ctrl) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn i;\n\t\t},\n\n\t\t/**\n\t\t * Returns a new collection of the contents in reverse order.\n\t\t *\n\t\t * @method reverse\n\t\t * @return {tinymce.ui.Collection} Collection instance with reversed items.\n\t\t */\n\t\treverse: function() {\n\t\t\treturn new Collection(Tools.toArray(this).reverse());\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the class exists or not.\n\t\t *\n\t\t * @method hasClass\n\t\t * @param {String} cls Class to check for.\n\t\t * @return {Boolean} true/false state if the class exists or not.\n\t\t */\n\t\thasClass: function(cls) {\n\t\t\treturn this[0] ? this[0].classes.contains(cls) : false;\n\t\t},\n\n\t\t/**\n\t\t * Sets/gets the specific property on the items in the collection. The same as executing control.<property>(<value>);\n\t\t *\n\t\t * @method prop\n\t\t * @param {String} name Property name to get/set.\n\t\t * @param {Object} value Optional object value to set.\n\t\t * @return {tinymce.ui.Collection} Current collection instance or value of the first item on a get operation.\n\t\t */\n\t\tprop: function(name, value) {\n\t\t\tvar self = this, undef, item;\n\n\t\t\tif (value !== undef) {\n\t\t\t\tself.each(function(item) {\n\t\t\t\t\tif (item[name]) {\n\t\t\t\t\t\titem[name](value);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\titem = self[0];\n\n\t\t\tif (item && item[name]) {\n\t\t\t\treturn item[name]();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Executes the specific function name with optional arguments an all items in collection if it exists.\n\t\t *\n\t\t * @example collection.exec(\"myMethod\", arg1, arg2, arg3);\n\t\t * @method exec\n\t\t * @param {String} name Name of the function to execute.\n\t\t * @param {Object} ... Multiple arguments to pass to each function.\n\t\t * @return {tinymce.ui.Collection} Current collection.\n\t\t */\n\t\texec: function(name) {\n\t\t\tvar self = this, args = Tools.toArray(arguments).slice(1);\n\n\t\t\tself.each(function(item) {\n\t\t\t\tif (item[name]) {\n\t\t\t\t\titem[name].apply(item, args);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Remove all items from collection and DOM.\n\t\t *\n\t\t * @method remove\n\t\t * @return {tinymce.ui.Collection} Current collection.\n\t\t */\n\t\tremove: function() {\n\t\t\tvar i = this.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tthis[i].remove();\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Adds a class to all items in the collection.\n\t\t *\n\t\t * @method addClass\n\t\t * @param {String} cls Class to add to each item.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\taddClass: function(cls) {\n\t\t\treturn this.each(function(item) {\n\t\t\t\titem.classes.add(cls);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Removes the specified class from all items in collection.\n\t\t *\n\t\t * @method removeClass\n\t\t * @param {String} cls Class to remove from each item.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\tremoveClass: function(cls) {\n\t\t\treturn this.each(function(item) {\n\t\t\t\titem.classes.remove(cls);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Fires the specified event by name and arguments on the control. This will execute all\n\t\t * bound event handlers.\n\t\t *\n\t\t * @method fire\n\t\t * @param {String} name Name of the event to fire.\n\t\t * @param {Object} args Optional arguments to pass to the event.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\t// fire: function(event, args) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Binds a callback to the specified event. This event can both be\n\t\t * native browser events like \"click\" or custom ones like PostRender.\n\t\t *\n\t\t * The callback function will have two parameters the first one being the control that received the event\n\t\t * the second one will be the event object either the browsers native event object or a custom JS object.\n\t\t *\n\t\t * @method on\n\t\t * @param {String} name Name of the event to bind. For example \"click\".\n\t\t * @param {String/function} callback Callback function to execute ones the event occurs.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\t// on: function(name, callback) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Unbinds the specified event and optionally a specific callback. If you omit the name\n\t\t * parameter all event handlers will be removed. If you omit the callback all event handles\n\t\t * by the specified name will be removed.\n\t\t *\n\t\t * @method off\n\t\t * @param {String} name Optional name for the event to unbind.\n\t\t * @param {function} callback Optional callback function to unbind.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\t// off: function(name, callback) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Shows the items in the current collection.\n\t\t *\n\t\t * @method show\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\t// show: function() {}, -- Generated by code below\n\n\t\t/**\n\t\t * Hides the items in the current collection.\n\t\t *\n\t\t * @method hide\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\t// hide: function() {}, -- Generated by code below\n\n\t\t/**\n\t\t * Sets/gets the text contents of the items in the current collection.\n\t\t *\n\t\t * @method text\n\t\t * @return {tinymce.ui.Collection} Current collection instance or text value of the first item on a get operation.\n\t\t */\n\t\t// text: function(value) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Sets/gets the name contents of the items in the current collection.\n\t\t *\n\t\t * @method name\n\t\t * @return {tinymce.ui.Collection} Current collection instance or name value of the first item on a get operation.\n\t\t */\n\t\t// name: function(value) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Sets/gets the disabled state on the items in the current collection.\n\t\t *\n\t\t * @method disabled\n\t\t * @return {tinymce.ui.Collection} Current collection instance or disabled state of the first item on a get operation.\n\t\t */\n\t\t// disabled: function(state) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Sets/gets the active state on the items in the current collection.\n\t\t *\n\t\t * @method active\n\t\t * @return {tinymce.ui.Collection} Current collection instance or active state of the first item on a get operation.\n\t\t */\n\t\t// active: function(state) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Sets/gets the selected state on the items in the current collection.\n\t\t *\n\t\t * @method selected\n\t\t * @return {tinymce.ui.Collection} Current collection instance or selected state of the first item on a get operation.\n\t\t */\n\t\t// selected: function(state) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Sets/gets the selected state on the items in the current collection.\n\t\t *\n\t\t * @method visible\n\t\t * @return {tinymce.ui.Collection} Current collection instance or visible state of the first item on a get operation.\n\t\t */\n\t\t// visible: function(state) {}, -- Generated by code below\n\t};\n\n\t// Extend tinymce.ui.Collection prototype with some generated control specific methods\n\tTools.each('fire on off show hide append prepend before after reflow'.split(' '), function(name) {\n\t\tproto[name] = function() {\n\t\t\tvar args = Tools.toArray(arguments);\n\n\t\t\tthis.each(function(ctrl) {\n\t\t\t\tif (name in ctrl) {\n\t\t\t\t\tctrl[name].apply(ctrl, args);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn this;\n\t\t};\n\t});\n\n\t// Extend tinymce.ui.Collection prototype with some property methods\n\tTools.each('text name disabled active selected checked visible parent value data'.split(' '), function(name) {\n\t\tproto[name] = function(value) {\n\t\t\treturn this.prop(name, value);\n\t\t};\n\t});\n\n\t// Create class based on the new prototype\n\tCollection = Class.extend(proto);\n\n\t// Stick Collection into Selector to prevent circual references\n\tSelector.Collection = Collection;\n\n\treturn Collection;\n});\n\n// Included from: js/tinymce/classes/ui/DomUtils.js\n\n/**\n * DomUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Private UI DomUtils proxy.\n *\n * @private\n * @class tinymce.ui.DomUtils\n */\ndefine(\"tinymce/ui/DomUtils\", [\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/dom/DOMUtils\"\n], function(Env, Tools, DOMUtils) {\n\t\"use strict\";\n\n\tvar count = 0;\n\n\tvar funcs = {\n\t\tid: function() {\n\t\t\treturn 'mceu_' + (count++);\n\t\t},\n\n\t\tcreate: function(name, attrs, children) {\n\t\t\tvar elm = document.createElement(name);\n\n\t\t\tDOMUtils.DOM.setAttribs(elm, attrs);\n\n\t\t\tif (typeof children === 'string') {\n\t\t\t\telm.innerHTML = children;\n\t\t\t} else {\n\t\t\t\tTools.each(children, function(child) {\n\t\t\t\t\tif (child.nodeType) {\n\t\t\t\t\t\telm.appendChild(child);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn elm;\n\t\t},\n\n\t\tcreateFragment: function(html) {\n\t\t\treturn DOMUtils.DOM.createFragment(html);\n\t\t},\n\n\t\tgetWindowSize: function() {\n\t\t\treturn DOMUtils.DOM.getViewPort();\n\t\t},\n\n\t\tgetSize: function(elm) {\n\t\t\tvar width, height;\n\n\t\t\tif (elm.getBoundingClientRect) {\n\t\t\t\tvar rect = elm.getBoundingClientRect();\n\n\t\t\t\twidth = Math.max(rect.width || (rect.right - rect.left), elm.offsetWidth);\n\t\t\t\theight = Math.max(rect.height || (rect.bottom - rect.bottom), elm.offsetHeight);\n\t\t\t} else {\n\t\t\t\twidth = elm.offsetWidth;\n\t\t\t\theight = elm.offsetHeight;\n\t\t\t}\n\n\t\t\treturn {width: width, height: height};\n\t\t},\n\n\t\tgetPos: function(elm, root) {\n\t\t\treturn DOMUtils.DOM.getPos(elm, root || funcs.getContainer());\n\t\t},\n\n\t\tgetContainer: function () {\n\t\t\treturn Env.container ? Env.container : document.body;\n\t\t},\n\n\t\tgetViewPort: function(win) {\n\t\t\treturn DOMUtils.DOM.getViewPort(win);\n\t\t},\n\n\t\tget: function(id) {\n\t\t\treturn document.getElementById(id);\n\t\t},\n\n\t\taddClass: function(elm, cls) {\n\t\t\treturn DOMUtils.DOM.addClass(elm, cls);\n\t\t},\n\n\t\tremoveClass: function(elm, cls) {\n\t\t\treturn DOMUtils.DOM.removeClass(elm, cls);\n\t\t},\n\n\t\thasClass: function(elm, cls) {\n\t\t\treturn DOMUtils.DOM.hasClass(elm, cls);\n\t\t},\n\n\t\ttoggleClass: function(elm, cls, state) {\n\t\t\treturn DOMUtils.DOM.toggleClass(elm, cls, state);\n\t\t},\n\n\t\tcss: function(elm, name, value) {\n\t\t\treturn DOMUtils.DOM.setStyle(elm, name, value);\n\t\t},\n\n\t\tgetRuntimeStyle: function(elm, name) {\n\t\t\treturn DOMUtils.DOM.getStyle(elm, name, true);\n\t\t},\n\n\t\ton: function(target, name, callback, scope) {\n\t\t\treturn DOMUtils.DOM.bind(target, name, callback, scope);\n\t\t},\n\n\t\toff: function(target, name, callback) {\n\t\t\treturn DOMUtils.DOM.unbind(target, name, callback);\n\t\t},\n\n\t\tfire: function(target, name, args) {\n\t\t\treturn DOMUtils.DOM.fire(target, name, args);\n\t\t},\n\n\t\tinnerHtml: function(elm, html) {\n\t\t\t// Workaround for <div> in <p> bug on IE 8 #6178\n\t\t\tDOMUtils.DOM.setHTML(elm, html);\n\t\t}\n\t};\n\n\treturn funcs;\n});\n\n// Included from: js/tinymce/classes/ui/BoxUtils.js\n\n/**\n * BoxUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility class for box parsing and measuring.\n *\n * @private\n * @class tinymce.ui.BoxUtils\n */\ndefine(\"tinymce/ui/BoxUtils\", [\n], function() {\n\t\"use strict\";\n\n\treturn {\n\t\t/**\n\t\t * Parses the specified box value. A box value contains 1-4 properties in clockwise order.\n\t\t *\n\t\t * @method parseBox\n\t\t * @param {String/Number} value Box value \"0 1 2 3\" or \"0\" etc.\n\t\t * @return {Object} Object with top/right/bottom/left properties.\n\t\t * @private\n\t\t */\n\t\tparseBox: function(value) {\n\t\t\tvar len, radix = 10;\n\n\t\t\tif (!value) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (typeof value === \"number\") {\n\t\t\t\tvalue = value || 0;\n\n\t\t\t\treturn {\n\t\t\t\t\ttop: value,\n\t\t\t\t\tleft: value,\n\t\t\t\t\tbottom: value,\n\t\t\t\t\tright: value\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tvalue = value.split(' ');\n\t\t\tlen = value.length;\n\n\t\t\tif (len === 1) {\n\t\t\t\tvalue[1] = value[2] = value[3] = value[0];\n\t\t\t} else if (len === 2) {\n\t\t\t\tvalue[2] = value[0];\n\t\t\t\tvalue[3] = value[1];\n\t\t\t} else if (len === 3) {\n\t\t\t\tvalue[3] = value[1];\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\ttop: parseInt(value[0], radix) || 0,\n\t\t\t\tright: parseInt(value[1], radix) || 0,\n\t\t\t\tbottom: parseInt(value[2], radix) || 0,\n\t\t\t\tleft: parseInt(value[3], radix) || 0\n\t\t\t};\n\t\t},\n\n\t\tmeasureBox: function(elm, prefix) {\n\t\t\tfunction getStyle(name) {\n\t\t\t\tvar defaultView = document.defaultView;\n\n\t\t\t\tif (defaultView) {\n\t\t\t\t\t// Remove camelcase\n\t\t\t\t\tname = name.replace(/[A-Z]/g, function(a) {\n\t\t\t\t\t\treturn '-' + a;\n\t\t\t\t\t});\n\n\t\t\t\t\treturn defaultView.getComputedStyle(elm, null).getPropertyValue(name);\n\t\t\t\t}\n\n\t\t\t\treturn elm.currentStyle[name];\n\t\t\t}\n\n\t\t\tfunction getSide(name) {\n\t\t\t\tvar val = parseFloat(getStyle(name), 10);\n\n\t\t\t\treturn isNaN(val) ? 0 : val;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\ttop: getSide(prefix + \"TopWidth\"),\n\t\t\t\tright: getSide(prefix + \"RightWidth\"),\n\t\t\t\tbottom: getSide(prefix + \"BottomWidth\"),\n\t\t\t\tleft: getSide(prefix + \"LeftWidth\")\n\t\t\t};\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/ClassList.js\n\n/**\n * ClassList.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Handles adding and removal of classes.\n *\n * @private\n * @class tinymce.ui.ClassList\n */\ndefine(\"tinymce/ui/ClassList\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\t\"use strict\";\n\n\tfunction noop() {\n\t}\n\n\t/**\n\t * Constructs a new class list the specified onchange\n\t * callback will be executed when the class list gets modifed.\n\t *\n\t * @constructor ClassList\n\t * @param {function} onchange Onchange callback to be executed.\n\t */\n\tfunction ClassList(onchange) {\n\t\tthis.cls = [];\n\t\tthis.cls._map = {};\n\t\tthis.onchange = onchange || noop;\n\t\tthis.prefix = '';\n\t}\n\n\tTools.extend(ClassList.prototype, {\n\t\t/**\n\t\t * Adds a new class to the class list.\n\t\t *\n\t\t * @method add\n\t\t * @param {String} cls Class to be added.\n\t\t * @return {tinymce.ui.ClassList} Current class list instance.\n\t\t */\n\t\tadd: function(cls) {\n\t\t\tif (cls && !this.contains(cls)) {\n\t\t\t\tthis.cls._map[cls] = true;\n\t\t\t\tthis.cls.push(cls);\n\t\t\t\tthis._change();\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Removes the specified class from the class list.\n\t\t *\n\t\t * @method remove\n\t\t * @param {String} cls Class to be removed.\n\t\t * @return {tinymce.ui.ClassList} Current class list instance.\n\t\t */\n\t\tremove: function(cls) {\n\t\t\tif (this.contains(cls)) {\n\t\t\t\tfor (var i = 0; i < this.cls.length; i++) {\n\t\t\t\t\tif (this.cls[i] === cls) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.cls.splice(i, 1);\n\t\t\t\tdelete this.cls._map[cls];\n\t\t\t\tthis._change();\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Toggles a class in the class list.\n\t\t *\n\t\t * @method toggle\n\t\t * @param {String} cls Class to be added/removed.\n\t\t * @param {Boolean} state Optional state if it should be added/removed.\n\t\t * @return {tinymce.ui.ClassList} Current class list instance.\n\t\t */\n\t\ttoggle: function(cls, state) {\n\t\t\tvar curState = this.contains(cls);\n\n\t\t\tif (curState !== state) {\n\t\t\t\tif (curState) {\n\t\t\t\t\tthis.remove(cls);\n\t\t\t\t} else {\n\t\t\t\t\tthis.add(cls);\n\t\t\t\t}\n\n\t\t\t\tthis._change();\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Returns true if the class list has the specified class.\n\t\t *\n\t\t * @method contains\n\t\t * @param {String} cls Class to look for.\n\t\t * @return {Boolean} true/false if the class exists or not.\n\t\t */\n\t\tcontains: function(cls) {\n\t\t\treturn !!this.cls._map[cls];\n\t\t},\n\n\t\t/**\n\t\t * Returns a space separated list of classes.\n\t\t *\n\t\t * @method toString\n\t\t * @return {String} Space separated list of classes.\n\t\t */\n\n\t\t_change: function() {\n\t\t\tdelete this.clsValue;\n\t\t\tthis.onchange.call(this);\n\t\t}\n\t});\n\n\t// IE 8 compatibility\n\tClassList.prototype.toString = function() {\n\t\tvar value;\n\n\t\tif (this.clsValue) {\n\t\t\treturn this.clsValue;\n\t\t}\n\n\t\tvalue = '';\n\t\tfor (var i = 0; i < this.cls.length; i++) {\n\t\t\tif (i > 0) {\n\t\t\t\tvalue += ' ';\n\t\t\t}\n\n\t\t\tvalue += this.prefix + this.cls[i];\n\t\t}\n\n\t\treturn value;\n\t};\n\n\treturn ClassList;\n});\n\n// Included from: js/tinymce/classes/ui/ReflowQueue.js\n\n/**\n * ReflowQueue.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class will automatically reflow controls on the next animation frame within a few milliseconds on older browsers.\n * If the user manually reflows then the automatic reflow will be cancelled. This class is used internally when various control states\n * changes that triggers a reflow.\n *\n * @class tinymce.ui.ReflowQueue\n * @static\n */\ndefine(\"tinymce/ui/ReflowQueue\", [\n\t\"tinymce/util/Delay\"\n], function(Delay) {\n\tvar dirtyCtrls = {}, animationFrameRequested;\n\n\treturn {\n\t\t/**\n\t\t * Adds a control to the next automatic reflow call. This is the control that had a state\n\t\t * change for example if the control was hidden/shown.\n\t\t *\n\t\t * @method add\n\t\t * @param {tinymce.ui.Control} ctrl Control to add to queue.\n\t\t */\n\t\tadd: function(ctrl) {\n\t\t\tvar parent = ctrl.parent();\n\n\t\t\tif (parent) {\n\t\t\t\tif (!parent._layout || parent._layout.isNative()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!dirtyCtrls[parent._id]) {\n\t\t\t\t\tdirtyCtrls[parent._id] = parent;\n\t\t\t\t}\n\n\t\t\t\tif (!animationFrameRequested) {\n\t\t\t\t\tanimationFrameRequested = true;\n\n\t\t\t\t\tDelay.requestAnimationFrame(function() {\n\t\t\t\t\t\tvar id, ctrl;\n\n\t\t\t\t\t\tanimationFrameRequested = false;\n\n\t\t\t\t\t\tfor (id in dirtyCtrls) {\n\t\t\t\t\t\t\tctrl = dirtyCtrls[id];\n\n\t\t\t\t\t\t\tif (ctrl.state.get('rendered')) {\n\t\t\t\t\t\t\t\tctrl.reflow();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdirtyCtrls = {};\n\t\t\t\t\t}, document.body);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Removes the specified control from the automatic reflow. This will happen when for example the user\n\t\t * manually triggers a reflow.\n\t\t *\n\t\t * @method remove\n\t\t * @param {tinymce.ui.Control} ctrl Control to remove from queue.\n\t\t */\n\t\tremove: function(ctrl) {\n\t\t\tif (dirtyCtrls[ctrl._id]) {\n\t\t\t\tdelete dirtyCtrls[ctrl._id];\n\t\t\t}\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Control.js\n\n/**\n * Control.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*eslint consistent-this:0 */\n\n/**\n * This is the base class for all controls and containers. All UI control instances inherit\n * from this one as it has the base logic needed by all of them.\n *\n * @class tinymce.ui.Control\n */\ndefine(\"tinymce/ui/Control\", [\n\t\"tinymce/util/Class\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/EventDispatcher\",\n\t\"tinymce/data/ObservableObject\",\n\t\"tinymce/ui/Collection\",\n\t\"tinymce/ui/DomUtils\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/ui/BoxUtils\",\n\t\"tinymce/ui/ClassList\",\n\t\"tinymce/ui/ReflowQueue\"\n], function(Class, Tools, EventDispatcher, ObservableObject, Collection, DomUtils, $, BoxUtils, ClassList, ReflowQueue) {\n\t\"use strict\";\n\n\tvar hasMouseWheelEventSupport = \"onmousewheel\" in document;\n\tvar hasWheelEventSupport = false;\n\tvar classPrefix = \"mce-\";\n\tvar Control, idCounter = 0;\n\n\tvar proto = {\n\t\tStatics: {\n\t\t\tclassPrefix: classPrefix\n\t\t},\n\n\t\tisRtl: function() {\n\t\t\treturn Control.rtl;\n\t\t},\n\n\t\t/**\n\t\t * Class/id prefix to use for all controls.\n\t\t *\n\t\t * @final\n\t\t * @field {String} classPrefix\n\t\t */\n\t\tclassPrefix: classPrefix,\n\n\t\t/**\n\t\t * Constructs a new control instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {String} style Style CSS properties to add.\n\t\t * @setting {String} border Border box values example: 1 1 1 1\n\t\t * @setting {String} padding Padding box values example: 1 1 1 1\n\t\t * @setting {String} margin Margin box values example: 1 1 1 1\n\t\t * @setting {Number} minWidth Minimal width for the control.\n\t\t * @setting {Number} minHeight Minimal height for the control.\n\t\t * @setting {String} classes Space separated list of classes to add.\n\t\t * @setting {String} role WAI-ARIA role to use for control.\n\t\t * @setting {Boolean} hidden Is the control hidden by default.\n\t\t * @setting {Boolean} disabled Is the control disabled by default.\n\t\t * @setting {String} name Name of the control instance.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this, classes, defaultClasses;\n\n\t\t\tfunction applyClasses(classes) {\n\t\t\t\tvar i;\n\n\t\t\t\tclasses = classes.split(' ');\n\t\t\t\tfor (i = 0; i < classes.length; i++) {\n\t\t\t\t\tself.classes.add(classes[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.settings = settings = Tools.extend({}, self.Defaults, settings);\n\n\t\t\t// Initial states\n\t\t\tself._id = settings.id || ('mceu_' + (idCounter++));\n\t\t\tself._aria = {role: settings.role};\n\t\t\tself._elmCache = {};\n\t\t\tself.$ = $;\n\n\t\t\tself.state = new ObservableObject({\n\t\t\t\tvisible: true,\n\t\t\t\tactive: false,\n\t\t\t\tdisabled: false,\n\t\t\t\tvalue: ''\n\t\t\t});\n\n\t\t\tself.data = new ObservableObject(settings.data);\n\n\t\t\tself.classes = new ClassList(function() {\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.getEl().className = this.toString();\n\t\t\t\t}\n\t\t\t});\n\t\t\tself.classes.prefix = self.classPrefix;\n\n\t\t\t// Setup classes\n\t\t\tclasses = settings.classes;\n\t\t\tif (classes) {\n\t\t\t\tif (self.Defaults) {\n\t\t\t\t\tdefaultClasses = self.Defaults.classes;\n\n\t\t\t\t\tif (defaultClasses && classes != defaultClasses) {\n\t\t\t\t\t\tapplyClasses(defaultClasses);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tapplyClasses(classes);\n\t\t\t}\n\n\t\t\tTools.each('title text name visible disabled active value'.split(' '), function(name) {\n\t\t\t\tif (name in settings) {\n\t\t\t\t\tself[name](settings[name]);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('click', function() {\n\t\t\t\tif (self.disabled()) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/**\n\t\t\t * Name/value object with settings for the current control.\n\t\t\t *\n\t\t\t * @field {Object} settings\n\t\t\t */\n\t\t\tself.settings = settings;\n\n\t\t\tself.borderBox = BoxUtils.parseBox(settings.border);\n\t\t\tself.paddingBox = BoxUtils.parseBox(settings.padding);\n\t\t\tself.marginBox = BoxUtils.parseBox(settings.margin);\n\n\t\t\tif (settings.hidden) {\n\t\t\t\tself.hide();\n\t\t\t}\n\t\t},\n\n\t\t// Will generate getter/setter methods for these properties\n\t\tProperties: 'parent,name',\n\n\t\t/**\n\t\t * Returns the root element to render controls into.\n\t\t *\n\t\t * @method getContainerElm\n\t\t * @return {Element} HTML DOM element to render into.\n\t\t */\n\t\tgetContainerElm: function() {\n\t\t\treturn DomUtils.getContainer();\n\t\t},\n\n\t\t/**\n\t\t * Returns a control instance for the current DOM element.\n\t\t *\n\t\t * @method getParentCtrl\n\t\t * @param {Element} elm HTML dom element to get parent control from.\n\t\t * @return {tinymce.ui.Control} Control instance or undefined.\n\t\t */\n\t\tgetParentCtrl: function(elm) {\n\t\t\tvar ctrl, lookup = this.getRoot().controlIdLookup;\n\n\t\t\twhile (elm && lookup) {\n\t\t\t\tctrl = lookup[elm.id];\n\t\t\t\tif (ctrl) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\telm = elm.parentNode;\n\t\t\t}\n\n\t\t\treturn ctrl;\n\t\t},\n\n\t\t/**\n\t\t * Initializes the current controls layout rect.\n\t\t * This will be executed by the layout managers to determine the\n\t\t * default minWidth/minHeight etc.\n\t\t *\n\t\t * @method initLayoutRect\n\t\t * @return {Object} Layout rect instance.\n\t\t */\n\t\tinitLayoutRect: function() {\n\t\t\tvar self = this, settings = self.settings, borderBox, layoutRect;\n\t\t\tvar elm = self.getEl(), width, height, minWidth, minHeight, autoResize;\n\t\t\tvar startMinWidth, startMinHeight, initialSize;\n\n\t\t\t// Measure the current element\n\t\t\tborderBox = self.borderBox = self.borderBox || BoxUtils.measureBox(elm, 'border');\n\t\t\tself.paddingBox = self.paddingBox || BoxUtils.measureBox(elm, 'padding');\n\t\t\tself.marginBox = self.marginBox || BoxUtils.measureBox(elm, 'margin');\n\t\t\tinitialSize = DomUtils.getSize(elm);\n\n\t\t\t// Setup minWidth/minHeight and width/height\n\t\t\tstartMinWidth = settings.minWidth;\n\t\t\tstartMinHeight = settings.minHeight;\n\t\t\tminWidth = startMinWidth || initialSize.width;\n\t\t\tminHeight = startMinHeight || initialSize.height;\n\t\t\twidth = settings.width;\n\t\t\theight = settings.height;\n\t\t\tautoResize = settings.autoResize;\n\t\t\tautoResize = typeof autoResize != \"undefined\" ? autoResize : !width && !height;\n\n\t\t\twidth = width || minWidth;\n\t\t\theight = height || minHeight;\n\n\t\t\tvar deltaW = borderBox.left + borderBox.right;\n\t\t\tvar deltaH = borderBox.top + borderBox.bottom;\n\n\t\t\tvar maxW = settings.maxWidth || 0xFFFF;\n\t\t\tvar maxH = settings.maxHeight || 0xFFFF;\n\n\t\t\t// Setup initial layout rect\n\t\t\tself._layoutRect = layoutRect = {\n\t\t\t\tx: settings.x || 0,\n\t\t\t\ty: settings.y || 0,\n\t\t\t\tw: width,\n\t\t\t\th: height,\n\t\t\t\tdeltaW: deltaW,\n\t\t\t\tdeltaH: deltaH,\n\t\t\t\tcontentW: width - deltaW,\n\t\t\t\tcontentH: height - deltaH,\n\t\t\t\tinnerW: width - deltaW,\n\t\t\t\tinnerH: height - deltaH,\n\t\t\t\tstartMinWidth: startMinWidth || 0,\n\t\t\t\tstartMinHeight: startMinHeight || 0,\n\t\t\t\tminW: Math.min(minWidth, maxW),\n\t\t\t\tminH: Math.min(minHeight, maxH),\n\t\t\t\tmaxW: maxW,\n\t\t\t\tmaxH: maxH,\n\t\t\t\tautoResize: autoResize,\n\t\t\t\tscrollW: 0\n\t\t\t};\n\n\t\t\tself._lastLayoutRect = {};\n\n\t\t\treturn layoutRect;\n\t\t},\n\n\t\t/**\n\t\t * Getter/setter for the current layout rect.\n\t\t *\n\t\t * @method layoutRect\n\t\t * @param {Object} [newRect] Optional new layout rect.\n\t\t * @return {tinymce.ui.Control/Object} Current control or rect object.\n\t\t */\n\t\tlayoutRect: function(newRect) {\n\t\t\tvar self = this, curRect = self._layoutRect, lastLayoutRect, size, deltaWidth, deltaHeight, undef, repaintControls;\n\n\t\t\t// Initialize default layout rect\n\t\t\tif (!curRect) {\n\t\t\t\tcurRect = self.initLayoutRect();\n\t\t\t}\n\n\t\t\t// Set new rect values\n\t\t\tif (newRect) {\n\t\t\t\t// Calc deltas between inner and outer sizes\n\t\t\t\tdeltaWidth = curRect.deltaW;\n\t\t\t\tdeltaHeight = curRect.deltaH;\n\n\t\t\t\t// Set x position\n\t\t\t\tif (newRect.x !== undef) {\n\t\t\t\t\tcurRect.x = newRect.x;\n\t\t\t\t}\n\n\t\t\t\t// Set y position\n\t\t\t\tif (newRect.y !== undef) {\n\t\t\t\t\tcurRect.y = newRect.y;\n\t\t\t\t}\n\n\t\t\t\t// Set minW\n\t\t\t\tif (newRect.minW !== undef) {\n\t\t\t\t\tcurRect.minW = newRect.minW;\n\t\t\t\t}\n\n\t\t\t\t// Set minH\n\t\t\t\tif (newRect.minH !== undef) {\n\t\t\t\t\tcurRect.minH = newRect.minH;\n\t\t\t\t}\n\n\t\t\t\t// Set new width and calculate inner width\n\t\t\t\tsize = newRect.w;\n\t\t\t\tif (size !== undef) {\n\t\t\t\t\tsize = size < curRect.minW ? curRect.minW : size;\n\t\t\t\t\tsize = size > curRect.maxW ? curRect.maxW : size;\n\t\t\t\t\tcurRect.w = size;\n\t\t\t\t\tcurRect.innerW = size - deltaWidth;\n\t\t\t\t}\n\n\t\t\t\t// Set new height and calculate inner height\n\t\t\t\tsize = newRect.h;\n\t\t\t\tif (size !== undef) {\n\t\t\t\t\tsize = size < curRect.minH ? curRect.minH : size;\n\t\t\t\t\tsize = size > curRect.maxH ? curRect.maxH : size;\n\t\t\t\t\tcurRect.h = size;\n\t\t\t\t\tcurRect.innerH = size - deltaHeight;\n\t\t\t\t}\n\n\t\t\t\t// Set new inner width and calculate width\n\t\t\t\tsize = newRect.innerW;\n\t\t\t\tif (size !== undef) {\n\t\t\t\t\tsize = size < curRect.minW - deltaWidth ? curRect.minW - deltaWidth : size;\n\t\t\t\t\tsize = size > curRect.maxW - deltaWidth ? curRect.maxW - deltaWidth : size;\n\t\t\t\t\tcurRect.innerW = size;\n\t\t\t\t\tcurRect.w = size + deltaWidth;\n\t\t\t\t}\n\n\t\t\t\t// Set new height and calculate inner height\n\t\t\t\tsize = newRect.innerH;\n\t\t\t\tif (size !== undef) {\n\t\t\t\t\tsize = size < curRect.minH - deltaHeight ? curRect.minH - deltaHeight : size;\n\t\t\t\t\tsize = size > curRect.maxH - deltaHeight ? curRect.maxH - deltaHeight : size;\n\t\t\t\t\tcurRect.innerH = size;\n\t\t\t\t\tcurRect.h = size + deltaHeight;\n\t\t\t\t}\n\n\t\t\t\t// Set new contentW\n\t\t\t\tif (newRect.contentW !== undef) {\n\t\t\t\t\tcurRect.contentW = newRect.contentW;\n\t\t\t\t}\n\n\t\t\t\t// Set new contentH\n\t\t\t\tif (newRect.contentH !== undef) {\n\t\t\t\t\tcurRect.contentH = newRect.contentH;\n\t\t\t\t}\n\n\t\t\t\t// Compare last layout rect with the current one to see if we need to repaint or not\n\t\t\t\tlastLayoutRect = self._lastLayoutRect;\n\t\t\t\tif (lastLayoutRect.x !== curRect.x || lastLayoutRect.y !== curRect.y ||\n\t\t\t\t\tlastLayoutRect.w !== curRect.w || lastLayoutRect.h !== curRect.h) {\n\t\t\t\t\trepaintControls = Control.repaintControls;\n\n\t\t\t\t\tif (repaintControls) {\n\t\t\t\t\t\tif (repaintControls.map && !repaintControls.map[self._id]) {\n\t\t\t\t\t\t\trepaintControls.push(self);\n\t\t\t\t\t\t\trepaintControls.map[self._id] = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tlastLayoutRect.x = curRect.x;\n\t\t\t\t\tlastLayoutRect.y = curRect.y;\n\t\t\t\t\tlastLayoutRect.w = curRect.w;\n\t\t\t\t\tlastLayoutRect.h = curRect.h;\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\treturn curRect;\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this, style, bodyStyle, bodyElm, rect, borderBox;\n\t\t\tvar borderW, borderH, lastRepaintRect, round, value;\n\n\t\t\t// Use Math.round on all values on IE < 9\n\t\t\tround = !document.createRange ? Math.round : function(value) {\n\t\t\t\treturn value;\n\t\t\t};\n\n\t\t\tstyle = self.getEl().style;\n\t\t\trect = self._layoutRect;\n\t\t\tlastRepaintRect = self._lastRepaintRect || {};\n\n\t\t\tborderBox = self.borderBox;\n\t\t\tborderW = borderBox.left + borderBox.right;\n\t\t\tborderH = borderBox.top + borderBox.bottom;\n\n\t\t\tif (rect.x !== lastRepaintRect.x) {\n\t\t\t\tstyle.left = round(rect.x) + 'px';\n\t\t\t\tlastRepaintRect.x = rect.x;\n\t\t\t}\n\n\t\t\tif (rect.y !== lastRepaintRect.y) {\n\t\t\t\tstyle.top = round(rect.y) + 'px';\n\t\t\t\tlastRepaintRect.y = rect.y;\n\t\t\t}\n\n\t\t\tif (rect.w !== lastRepaintRect.w) {\n\t\t\t\tvalue = round(rect.w - borderW);\n\t\t\t\tstyle.width = (value >= 0 ? value : 0) + 'px';\n\t\t\t\tlastRepaintRect.w = rect.w;\n\t\t\t}\n\n\t\t\tif (rect.h !== lastRepaintRect.h) {\n\t\t\t\tvalue = round(rect.h - borderH);\n\t\t\t\tstyle.height = (value >= 0 ? value : 0) + 'px';\n\t\t\t\tlastRepaintRect.h = rect.h;\n\t\t\t}\n\n\t\t\t// Update body if needed\n\t\t\tif (self._hasBody && rect.innerW !== lastRepaintRect.innerW) {\n\t\t\t\tvalue = round(rect.innerW);\n\n\t\t\t\tbodyElm = self.getEl('body');\n\t\t\t\tif (bodyElm) {\n\t\t\t\t\tbodyStyle = bodyElm.style;\n\t\t\t\t\tbodyStyle.width = (value >= 0 ? value : 0) + 'px';\n\t\t\t\t}\n\n\t\t\t\tlastRepaintRect.innerW = rect.innerW;\n\t\t\t}\n\n\t\t\tif (self._hasBody && rect.innerH !== lastRepaintRect.innerH) {\n\t\t\t\tvalue = round(rect.innerH);\n\n\t\t\t\tbodyElm = bodyElm || self.getEl('body');\n\t\t\t\tif (bodyElm) {\n\t\t\t\t\tbodyStyle = bodyStyle || bodyElm.style;\n\t\t\t\t\tbodyStyle.height = (value >= 0 ? value : 0) + 'px';\n\t\t\t\t}\n\n\t\t\t\tlastRepaintRect.innerH = rect.innerH;\n\t\t\t}\n\n\t\t\tself._lastRepaintRect = lastRepaintRect;\n\t\t\tself.fire('repaint', {}, false);\n\t\t},\n\n\t\t/**\n\t\t * Updates the controls layout rect by re-measuing it.\n\t\t */\n\t\tupdateLayoutRect: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.parent()._lastRect = null;\n\n\t\t\tDomUtils.css(self.getEl(), {width: '', height: ''});\n\n\t\t\tself._layoutRect = self._lastRepaintRect = self._lastLayoutRect = null;\n\t\t\tself.initLayoutRect();\n\t\t},\n\n\t\t/**\n\t\t * Binds a callback to the specified event. This event can both be\n\t\t * native browser events like \"click\" or custom ones like PostRender.\n\t\t *\n\t\t * The callback function will be passed a DOM event like object that enables yout do stop propagation.\n\t\t *\n\t\t * @method on\n\t\t * @param {String} name Name of the event to bind. For example \"click\".\n\t\t * @param {String/function} callback Callback function to execute ones the event occurs.\n\t\t * @return {tinymce.ui.Control} Current control object.\n\t\t */\n\t\ton: function(name, callback) {\n\t\t\tvar self = this;\n\n\t\t\tfunction resolveCallbackName(name) {\n\t\t\t\tvar callback, scope;\n\n\t\t\t\tif (typeof name != 'string') {\n\t\t\t\t\treturn name;\n\t\t\t\t}\n\n\t\t\t\treturn function(e) {\n\t\t\t\t\tif (!callback) {\n\t\t\t\t\t\tself.parentsAndSelf().each(function(ctrl) {\n\t\t\t\t\t\t\tvar callbacks = ctrl.settings.callbacks;\n\n\t\t\t\t\t\t\tif (callbacks && (callback = callbacks[name])) {\n\t\t\t\t\t\t\t\tscope = ctrl;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!callback) {\n\t\t\t\t\t\te.action = name;\n\t\t\t\t\t\tthis.fire('execute', e);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn callback.call(scope, e);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tgetEventDispatcher(self).on(name, resolveCallbackName(callback));\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Unbinds the specified event and optionally a specific callback. If you omit the name\n\t\t * parameter all event handlers will be removed. If you omit the callback all event handles\n\t\t * by the specified name will be removed.\n\t\t *\n\t\t * @method off\n\t\t * @param {String} [name] Name for the event to unbind.\n\t\t * @param {function} [callback] Callback function to unbind.\n\t\t * @return {tinymce.ui.Control} Current control object.\n\t\t */\n\t\toff: function(name, callback) {\n\t\t\tgetEventDispatcher(this).off(name, callback);\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Fires the specified event by name and arguments on the control. This will execute all\n\t\t * bound event handlers.\n\t\t *\n\t\t * @method fire\n\t\t * @param {String} name Name of the event to fire.\n\t\t * @param {Object} [args] Arguments to pass to the event.\n\t\t * @param {Boolean} [bubble] Value to control bubbling. Defaults to true.\n\t\t * @return {Object} Current arguments object.\n\t\t */\n\t\tfire: function(name, args, bubble) {\n\t\t\tvar self = this;\n\n\t\t\targs = args || {};\n\n\t\t\tif (!args.control) {\n\t\t\t\targs.control = self;\n\t\t\t}\n\n\t\t\targs = getEventDispatcher(self).fire(name, args);\n\n\t\t\t// Bubble event up to parents\n\t\t\tif (bubble !== false && self.parent) {\n\t\t\t\tvar parent = self.parent();\n\t\t\t\twhile (parent && !args.isPropagationStopped()) {\n\t\t\t\t\tparent.fire(name, args, false);\n\t\t\t\t\tparent = parent.parent();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn args;\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the specified event has any listeners.\n\t\t *\n\t\t * @method hasEventListeners\n\t\t * @param {String} name Name of the event to check for.\n\t\t * @return {Boolean} True/false state if the event has listeners.\n\t\t */\n\t\thasEventListeners: function(name) {\n\t\t\treturn getEventDispatcher(this).has(name);\n\t\t},\n\n\t\t/**\n\t\t * Returns a control collection with all parent controls.\n\t\t *\n\t\t * @method parents\n\t\t * @param {String} selector Optional selector expression to find parents.\n\t\t * @return {tinymce.ui.Collection} Collection with all parent controls.\n\t\t */\n\t\tparents: function(selector) {\n\t\t\tvar self = this, ctrl, parents = new Collection();\n\n\t\t\t// Add each parent to collection\n\t\t\tfor (ctrl = self.parent(); ctrl; ctrl = ctrl.parent()) {\n\t\t\t\tparents.add(ctrl);\n\t\t\t}\n\n\t\t\t// Filter away everything that doesn't match the selector\n\t\t\tif (selector) {\n\t\t\t\tparents = parents.filter(selector);\n\t\t\t}\n\n\t\t\treturn parents;\n\t\t},\n\n\t\t/**\n\t\t * Returns the current control and it's parents.\n\t\t *\n\t\t * @method parentsAndSelf\n\t\t * @param {String} selector Optional selector expression to find parents.\n\t\t * @return {tinymce.ui.Collection} Collection with all parent controls.\n\t\t */\n\t\tparentsAndSelf: function(selector) {\n\t\t\treturn new Collection(this).add(this.parents(selector));\n\t\t},\n\n\t\t/**\n\t\t * Returns the control next to the current control.\n\t\t *\n\t\t * @method next\n\t\t * @return {tinymce.ui.Control} Next control instance.\n\t\t */\n\t\tnext: function() {\n\t\t\tvar parentControls = this.parent().items();\n\n\t\t\treturn parentControls[parentControls.indexOf(this) + 1];\n\t\t},\n\n\t\t/**\n\t\t * Returns the control previous to the current control.\n\t\t *\n\t\t * @method prev\n\t\t * @return {tinymce.ui.Control} Previous control instance.\n\t\t */\n\t\tprev: function() {\n\t\t\tvar parentControls = this.parent().items();\n\n\t\t\treturn parentControls[parentControls.indexOf(this) - 1];\n\t\t},\n\n\t\t/**\n\t\t * Sets the inner HTML of the control element.\n\t\t *\n\t\t * @method innerHtml\n\t\t * @param {String} html Html string to set as inner html.\n\t\t * @return {tinymce.ui.Control} Current control object.\n\t\t */\n\t\tinnerHtml: function(html) {\n\t\t\tthis.$el.html(html);\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Returns the control DOM element or sub element.\n\t\t *\n\t\t * @method getEl\n\t\t * @param {String} [suffix] Suffix to get element by.\n\t\t * @return {Element} HTML DOM element for the current control or it's children.\n\t\t */\n\t\tgetEl: function(suffix) {\n\t\t\tvar id = suffix ? this._id + '-' + suffix : this._id;\n\n\t\t\tif (!this._elmCache[id]) {\n\t\t\t\tthis._elmCache[id] = $('#' + id)[0];\n\t\t\t}\n\n\t\t\treturn this._elmCache[id];\n\t\t},\n\n\t\t/**\n\t\t * Sets the visible state to true.\n\t\t *\n\t\t * @method show\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tshow: function() {\n\t\t\treturn this.visible(true);\n\t\t},\n\n\t\t/**\n\t\t * Sets the visible state to false.\n\t\t *\n\t\t * @method hide\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\thide: function() {\n\t\t\treturn this.visible(false);\n\t\t},\n\n\t\t/**\n\t\t * Focuses the current control.\n\t\t *\n\t\t * @method focus\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tfocus: function() {\n\t\t\ttry {\n\t\t\t\tthis.getEl().focus();\n\t\t\t} catch (ex) {\n\t\t\t\t// Ignore IE error\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Blurs the current control.\n\t\t *\n\t\t * @method blur\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tblur: function() {\n\t\t\tthis.getEl().blur();\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Sets the specified aria property.\n\t\t *\n\t\t * @method aria\n\t\t * @param {String} name Name of the aria property to set.\n\t\t * @param {String} value Value of the aria property.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\taria: function(name, value) {\n\t\t\tvar self = this, elm = self.getEl(self.ariaTarget);\n\n\t\t\tif (typeof value === \"undefined\") {\n\t\t\t\treturn self._aria[name];\n\t\t\t}\n\n\t\t\tself._aria[name] = value;\n\n\t\t\tif (self.state.get('rendered')) {\n\t\t\t\telm.setAttribute(name == 'role' ? name : 'aria-' + name, value);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Encodes the specified string with HTML entities. It will also\n\t\t * translate the string to different languages.\n\t\t *\n\t\t * @method encode\n\t\t * @param {String/Object/Array} text Text to entity encode.\n\t\t * @param {Boolean} [translate=true] False if the contents shouldn't be translated.\n\t\t * @return {String} Encoded and possible traslated string.\n\t\t */\n\t\tencode: function(text, translate) {\n\t\t\tif (translate !== false) {\n\t\t\t\ttext = this.translate(text);\n\t\t\t}\n\n\t\t\treturn (text || '').replace(/[&<>\"]/g, function(match) {\n\t\t\t\treturn '&#' + match.charCodeAt(0) + ';';\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns the translated string.\n\t\t *\n\t\t * @method translate\n\t\t * @param {String} text Text to translate.\n\t\t * @return {String} Translated string or the same as the input.\n\t\t */\n\t\ttranslate: function(text) {\n\t\t\treturn Control.translate ? Control.translate(text) : text;\n\t\t},\n\n\t\t/**\n\t\t * Adds items before the current control.\n\t\t *\n\t\t * @method before\n\t\t * @param {Array/tinymce.ui.Collection} items Array of items to prepend before this control.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tbefore: function(items) {\n\t\t\tvar self = this, parent = self.parent();\n\n\t\t\tif (parent) {\n\t\t\t\tparent.insert(items, parent.items().indexOf(self), true);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Adds items after the current control.\n\t\t *\n\t\t * @method after\n\t\t * @param {Array/tinymce.ui.Collection} items Array of items to append after this control.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tafter: function(items) {\n\t\t\tvar self = this, parent = self.parent();\n\n\t\t\tif (parent) {\n\t\t\t\tparent.insert(items, parent.items().indexOf(self));\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Removes the current control from DOM and from UI collections.\n\t\t *\n\t\t * @method remove\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tremove: function() {\n\t\t\tvar self = this, elm = self.getEl(), parent = self.parent(), newItems, i;\n\n\t\t\tif (self.items) {\n\t\t\t\tvar controls = self.items().toArray();\n\t\t\t\ti = controls.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tcontrols[i].remove();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (parent && parent.items) {\n\t\t\t\tnewItems = [];\n\n\t\t\t\tparent.items().each(function(item) {\n\t\t\t\t\tif (item !== self) {\n\t\t\t\t\t\tnewItems.push(item);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tparent.items().set(newItems);\n\t\t\t\tparent._lastRect = null;\n\t\t\t}\n\n\t\t\tif (self._eventsRoot && self._eventsRoot == self) {\n\t\t\t\t$(elm).off();\n\t\t\t}\n\n\t\t\tvar lookup = self.getRoot().controlIdLookup;\n\t\t\tif (lookup) {\n\t\t\t\tdelete lookup[self._id];\n\t\t\t}\n\n\t\t\tif (elm && elm.parentNode) {\n\t\t\t\telm.parentNode.removeChild(elm);\n\t\t\t}\n\n\t\t\tself.state.set('rendered', false);\n\t\t\tself.state.destroy();\n\n\t\t\tself.fire('remove');\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control before the specified element.\n\t\t *\n\t\t * @method renderBefore\n\t\t * @param {Element} elm Element to render before.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\trenderBefore: function(elm) {\n\t\t\t$(elm).before(this.renderHtml());\n\t\t\tthis.postRender();\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control to the specified element.\n\t\t *\n\t\t * @method renderBefore\n\t\t * @param {Element} elm Element to render to.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\trenderTo: function(elm) {\n\t\t\t$(elm || this.getContainerElm()).append(this.renderHtml());\n\t\t\tthis.postRender();\n\t\t\treturn this;\n\t\t},\n\n\t\tpreRender: function() {\n\t\t},\n\n\t\trender: function() {\n\t\t},\n\n\t\trenderHtml: function() {\n\t\t\treturn '<div id=\"' + this._id + '\" class=\"' + this.classes + '\"></div>';\n\t\t},\n\n\t\t/**\n\t\t * Post render method. Called after the control has been rendered to the target.\n\t\t *\n\t\t * @method postRender\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, settings = self.settings, elm, box, parent, name, parentEventsRoot;\n\n\t\t\tself.$el = $(self.getEl());\n\t\t\tself.state.set('rendered', true);\n\n\t\t\t// Bind on<event> settings\n\t\t\tfor (name in settings) {\n\t\t\t\tif (name.indexOf(\"on\") === 0) {\n\t\t\t\t\tself.on(name.substr(2), settings[name]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (self._eventsRoot) {\n\t\t\t\tfor (parent = self.parent(); !parentEventsRoot && parent; parent = parent.parent()) {\n\t\t\t\t\tparentEventsRoot = parent._eventsRoot;\n\t\t\t\t}\n\n\t\t\t\tif (parentEventsRoot) {\n\t\t\t\t\tfor (name in parentEventsRoot._nativeEvents) {\n\t\t\t\t\t\tself._nativeEvents[name] = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbindPendingEvents(self);\n\n\t\t\tif (settings.style) {\n\t\t\t\telm = self.getEl();\n\t\t\t\tif (elm) {\n\t\t\t\t\telm.setAttribute('style', settings.style);\n\t\t\t\t\telm.style.cssText = settings.style;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (self.settings.border) {\n\t\t\t\tbox = self.borderBox;\n\t\t\t\tself.$el.css({\n\t\t\t\t\t'border-top-width': box.top,\n\t\t\t\t\t'border-right-width': box.right,\n\t\t\t\t\t'border-bottom-width': box.bottom,\n\t\t\t\t\t'border-left-width': box.left\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Add instance to lookup\n\t\t\tvar root = self.getRoot();\n\t\t\tif (!root.controlIdLookup) {\n\t\t\t\troot.controlIdLookup = {};\n\t\t\t}\n\n\t\t\troot.controlIdLookup[self._id] = self;\n\n\t\t\tfor (var key in self._aria) {\n\t\t\t\tself.aria(key, self._aria[key]);\n\t\t\t}\n\n\t\t\tif (self.state.get('visible') === false) {\n\t\t\t\tself.getEl().style.display = 'none';\n\t\t\t}\n\n\t\t\tself.bindStates();\n\n\t\t\tself.state.on('change:visible', function(e) {\n\t\t\t\tvar state = e.value, parentCtrl;\n\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.getEl().style.display = state === false ? 'none' : '';\n\n\t\t\t\t\t// Need to force a reflow here on IE 8\n\t\t\t\t\tself.getEl().getBoundingClientRect();\n\t\t\t\t}\n\n\t\t\t\t// Parent container needs to reflow\n\t\t\t\tparentCtrl = self.parent();\n\t\t\t\tif (parentCtrl) {\n\t\t\t\t\tparentCtrl._lastRect = null;\n\t\t\t\t}\n\n\t\t\t\tself.fire(state ? 'show' : 'hide');\n\n\t\t\t\tReflowQueue.add(self);\n\t\t\t});\n\n\t\t\tself.fire('postrender', {}, false);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t},\n\n\t\t/**\n\t\t * Scrolls the current control into view.\n\t\t *\n\t\t * @method scrollIntoView\n\t\t * @param {String} align Alignment in view top|center|bottom.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tscrollIntoView: function(align) {\n\t\t\tfunction getOffset(elm, rootElm) {\n\t\t\t\tvar x, y, parent = elm;\n\n\t\t\t\tx = y = 0;\n\t\t\t\twhile (parent && parent != rootElm && parent.nodeType) {\n\t\t\t\t\tx += parent.offsetLeft || 0;\n\t\t\t\t\ty += parent.offsetTop || 0;\n\t\t\t\t\tparent = parent.offsetParent;\n\t\t\t\t}\n\n\t\t\t\treturn {x: x, y: y};\n\t\t\t}\n\n\t\t\tvar elm = this.getEl(), parentElm = elm.parentNode;\n\t\t\tvar x, y, width, height, parentWidth, parentHeight;\n\t\t\tvar pos = getOffset(elm, parentElm);\n\n\t\t\tx = pos.x;\n\t\t\ty = pos.y;\n\t\t\twidth = elm.offsetWidth;\n\t\t\theight = elm.offsetHeight;\n\t\t\tparentWidth = parentElm.clientWidth;\n\t\t\tparentHeight = parentElm.clientHeight;\n\n\t\t\tif (align == \"end\") {\n\t\t\t\tx -= parentWidth - width;\n\t\t\t\ty -= parentHeight - height;\n\t\t\t} else if (align == \"center\") {\n\t\t\t\tx -= (parentWidth / 2) - (width / 2);\n\t\t\t\ty -= (parentHeight / 2) - (height / 2);\n\t\t\t}\n\n\t\t\tparentElm.scrollLeft = x;\n\t\t\tparentElm.scrollTop = y;\n\n\t\t\treturn this;\n\t\t},\n\n\t\tgetRoot: function() {\n\t\t\tvar ctrl = this, rootControl, parents = [];\n\n\t\t\twhile (ctrl) {\n\t\t\t\tif (ctrl.rootControl) {\n\t\t\t\t\trootControl = ctrl.rootControl;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tparents.push(ctrl);\n\t\t\t\trootControl = ctrl;\n\t\t\t\tctrl = ctrl.parent();\n\t\t\t}\n\n\t\t\tif (!rootControl) {\n\t\t\t\trootControl = this;\n\t\t\t}\n\n\t\t\tvar i = parents.length;\n\t\t\twhile (i--) {\n\t\t\t\tparents[i].rootControl = rootControl;\n\t\t\t}\n\n\t\t\treturn rootControl;\n\t\t},\n\n\t\t/**\n\t\t * Reflows the current control and it's parents.\n\t\t * This should be used after you for example append children to the current control so\n\t\t * that the layout managers know that they need to reposition everything.\n\t\t *\n\t\t * @example\n\t\t * container.append({type: 'button', text: 'My button'}).reflow();\n\t\t *\n\t\t * @method reflow\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\treflow: function() {\n\t\t\tReflowQueue.remove(this);\n\n\t\t\tvar parent = this.parent();\n\t\t\tif (parent._layout && !parent._layout.isNative()) {\n\t\t\t\tparent.reflow();\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Sets/gets the parent container for the control.\n\t\t *\n\t\t * @method parent\n\t\t * @param {tinymce.ui.Container} parent Optional parent to set.\n\t\t * @return {tinymce.ui.Control} Parent control or the current control on a set action.\n\t\t */\n\t\t// parent: function(parent) {} -- Generated\n\n\t\t/**\n\t\t * Sets/gets the text for the control.\n\t\t *\n\t\t * @method text\n\t\t * @param {String} value Value to set to control.\n\t\t * @return {String/tinymce.ui.Control} Current control on a set operation or current value on a get.\n\t\t */\n\t\t// text: function(value) {} -- Generated\n\n\t\t/**\n\t\t * Sets/gets the disabled state on the control.\n\t\t *\n\t\t * @method disabled\n\t\t * @param {Boolean} state Value to set to control.\n\t\t * @return {Boolean/tinymce.ui.Control} Current control on a set operation or current state on a get.\n\t\t */\n\t\t// disabled: function(state) {} -- Generated\n\n\t\t/**\n\t\t * Sets/gets the active for the control.\n\t\t *\n\t\t * @method active\n\t\t * @param {Boolean} state Value to set to control.\n\t\t * @return {Boolean/tinymce.ui.Control} Current control on a set operation or current state on a get.\n\t\t */\n\t\t// active: function(state) {} -- Generated\n\n\t\t/**\n\t\t * Sets/gets the name for the control.\n\t\t *\n\t\t * @method name\n\t\t * @param {String} value Value to set to control.\n\t\t * @return {String/tinymce.ui.Control} Current control on a set operation or current value on a get.\n\t\t */\n\t\t// name: function(value) {} -- Generated\n\n\t\t/**\n\t\t * Sets/gets the title for the control.\n\t\t *\n\t\t * @method title\n\t\t * @param {String} value Value to set to control.\n\t\t * @return {String/tinymce.ui.Control} Current control on a set operation or current value on a get.\n\t\t */\n\t\t// title: function(value) {} -- Generated\n\n\t\t/**\n\t\t * Sets/gets the visible for the control.\n\t\t *\n\t\t * @method visible\n\t\t * @param {Boolean} state Value to set to control.\n\t\t * @return {Boolean/tinymce.ui.Control} Current control on a set operation or current state on a get.\n\t\t */\n\t\t// visible: function(value) {} -- Generated\n\t};\n\n\t/**\n\t * Setup state properties.\n\t */\n\tTools.each('text title visible disabled active value'.split(' '), function(name) {\n\t\tproto[name] = function(value) {\n\t\t\tif (arguments.length === 0) {\n\t\t\t\treturn this.state.get(name);\n\t\t\t}\n\n\t\t\tif (typeof value != \"undefined\") {\n\t\t\t\tthis.state.set(name, value);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t};\n\t});\n\n\tControl = Class.extend(proto);\n\n\tfunction getEventDispatcher(obj) {\n\t\tif (!obj._eventDispatcher) {\n\t\t\tobj._eventDispatcher = new EventDispatcher({\n\t\t\t\tscope: obj,\n\t\t\t\ttoggleEvent: function(name, state) {\n\t\t\t\t\tif (state && EventDispatcher.isNative(name)) {\n\t\t\t\t\t\tif (!obj._nativeEvents) {\n\t\t\t\t\t\t\tobj._nativeEvents = {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tobj._nativeEvents[name] = true;\n\n\t\t\t\t\t\tif (obj.state.get('rendered')) {\n\t\t\t\t\t\t\tbindPendingEvents(obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn obj._eventDispatcher;\n\t}\n\n\tfunction bindPendingEvents(eventCtrl) {\n\t\tvar i, l, parents, eventRootCtrl, nativeEvents, name;\n\n\t\tfunction delegate(e) {\n\t\t\tvar control = eventCtrl.getParentCtrl(e.target);\n\n\t\t\tif (control) {\n\t\t\t\tcontrol.fire(e.type, e);\n\t\t\t}\n\t\t}\n\n\t\tfunction mouseLeaveHandler() {\n\t\t\tvar ctrl = eventRootCtrl._lastHoverCtrl;\n\n\t\t\tif (ctrl) {\n\t\t\t\tctrl.fire(\"mouseleave\", {target: ctrl.getEl()});\n\n\t\t\t\tctrl.parents().each(function(ctrl) {\n\t\t\t\t\tctrl.fire(\"mouseleave\", {target: ctrl.getEl()});\n\t\t\t\t});\n\n\t\t\t\teventRootCtrl._lastHoverCtrl = null;\n\t\t\t}\n\t\t}\n\n\t\tfunction mouseEnterHandler(e) {\n\t\t\tvar ctrl = eventCtrl.getParentCtrl(e.target), lastCtrl = eventRootCtrl._lastHoverCtrl, idx = 0, i, parents, lastParents;\n\n\t\t\t// Over on a new control\n\t\t\tif (ctrl !== lastCtrl) {\n\t\t\t\teventRootCtrl._lastHoverCtrl = ctrl;\n\n\t\t\t\tparents = ctrl.parents().toArray().reverse();\n\t\t\t\tparents.push(ctrl);\n\n\t\t\t\tif (lastCtrl) {\n\t\t\t\t\tlastParents = lastCtrl.parents().toArray().reverse();\n\t\t\t\t\tlastParents.push(lastCtrl);\n\n\t\t\t\t\tfor (idx = 0; idx < lastParents.length; idx++) {\n\t\t\t\t\t\tif (parents[idx] !== lastParents[idx]) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (i = lastParents.length - 1; i >= idx; i--) {\n\t\t\t\t\t\tlastCtrl = lastParents[i];\n\t\t\t\t\t\tlastCtrl.fire(\"mouseleave\", {\n\t\t\t\t\t\t\ttarget: lastCtrl.getEl()\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (i = idx; i < parents.length; i++) {\n\t\t\t\t\tctrl = parents[i];\n\t\t\t\t\tctrl.fire(\"mouseenter\", {\n\t\t\t\t\t\ttarget: ctrl.getEl()\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction fixWheelEvent(e) {\n\t\t\te.preventDefault();\n\n\t\t\tif (e.type == \"mousewheel\") {\n\t\t\t\te.deltaY = -1 / 40 * e.wheelDelta;\n\n\t\t\t\tif (e.wheelDeltaX) {\n\t\t\t\t\te.deltaX = -1 / 40 * e.wheelDeltaX;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\te.deltaX = 0;\n\t\t\t\te.deltaY = e.detail;\n\t\t\t}\n\n\t\t\te = eventCtrl.fire(\"wheel\", e);\n\t\t}\n\n\t\tnativeEvents = eventCtrl._nativeEvents;\n\t\tif (nativeEvents) {\n\t\t\t// Find event root element if it exists\n\t\t\tparents = eventCtrl.parents().toArray();\n\t\t\tparents.unshift(eventCtrl);\n\t\t\tfor (i = 0, l = parents.length; !eventRootCtrl && i < l; i++) {\n\t\t\t\teventRootCtrl = parents[i]._eventsRoot;\n\t\t\t}\n\n\t\t\t// Event root wasn't found the use the root control\n\t\t\tif (!eventRootCtrl) {\n\t\t\t\teventRootCtrl = parents[parents.length - 1] || eventCtrl;\n\t\t\t}\n\n\t\t\t// Set the eventsRoot property on children that didn't have it\n\t\t\teventCtrl._eventsRoot = eventRootCtrl;\n\t\t\tfor (l = i, i = 0; i < l; i++) {\n\t\t\t\tparents[i]._eventsRoot = eventRootCtrl;\n\t\t\t}\n\n\t\t\tvar eventRootDelegates = eventRootCtrl._delegates;\n\t\t\tif (!eventRootDelegates) {\n\t\t\t\teventRootDelegates = eventRootCtrl._delegates = {};\n\t\t\t}\n\n\t\t\t// Bind native event delegates\n\t\t\tfor (name in nativeEvents) {\n\t\t\t\tif (!nativeEvents) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (name === \"wheel\" && !hasWheelEventSupport) {\n\t\t\t\t\tif (hasMouseWheelEventSupport) {\n\t\t\t\t\t\t$(eventCtrl.getEl()).on(\"mousewheel\", fixWheelEvent);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$(eventCtrl.getEl()).on(\"DOMMouseScroll\", fixWheelEvent);\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Special treatment for mousenter/mouseleave since these doesn't bubble\n\t\t\t\tif (name === \"mouseenter\" || name === \"mouseleave\") {\n\t\t\t\t\t// Fake mousenter/mouseleave\n\t\t\t\t\tif (!eventRootCtrl._hasMouseEnter) {\n\t\t\t\t\t\t$(eventRootCtrl.getEl()).on(\"mouseleave\", mouseLeaveHandler).on(\"mouseover\", mouseEnterHandler);\n\t\t\t\t\t\teventRootCtrl._hasMouseEnter = 1;\n\t\t\t\t\t}\n\t\t\t\t} else if (!eventRootDelegates[name]) {\n\t\t\t\t\t$(eventRootCtrl.getEl()).on(name, delegate);\n\t\t\t\t\teventRootDelegates[name] = true;\n\t\t\t\t}\n\n\t\t\t\t// Remove the event once it's bound\n\t\t\t\tnativeEvents[name] = false;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn Control;\n});\n\n// Included from: js/tinymce/classes/ui/Factory.js\n\n/**\n * Factory.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*global tinymce:true */\n\n/**\n * This class is a factory for control instances. This enables you\n * to create instances of controls without having to require the UI controls directly.\n *\n * It also allow you to override or add new control types.\n *\n * @class tinymce.ui.Factory\n */\ndefine(\"tinymce/ui/Factory\", [], function() {\n\t\"use strict\";\n\n\tvar types = {}, namespaceInit;\n\n\treturn {\n\t\t/**\n\t\t * Adds a new control instance type to the factory.\n\t\t *\n\t\t * @method add\n\t\t * @param {String} type Type name for example \"button\".\n\t\t * @param {function} typeClass Class type function.\n\t\t */\n\t\tadd: function(type, typeClass) {\n\t\t\ttypes[type.toLowerCase()] = typeClass;\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the specified type exists or not.\n\t\t *\n\t\t * @method has\n\t\t * @param {String} type Type to look for.\n\t\t * @return {Boolean} true/false if the control by name exists.\n\t\t */\n\t\thas: function(type) {\n\t\t\treturn !!types[type.toLowerCase()];\n\t\t},\n\n\t\t/**\n\t\t * Creates a new control instance based on the settings provided. The instance created will be\n\t\t * based on the specified type property it can also create whole structures of components out of\n\t\t * the specified JSON object.\n\t\t *\n\t\t * @example\n\t\t * tinymce.ui.Factory.create({\n\t\t *     type: 'button',\n\t\t *     text: 'Hello world!'\n\t\t * });\n\t\t *\n\t\t * @method create\n\t\t * @param {Object/String} settings Name/Value object with items used to create the type.\n\t\t * @return {tinymce.ui.Control} Control instance based on the specified type.\n\t\t */\n\t\tcreate: function(type, settings) {\n\t\t\tvar ControlType, name, namespace;\n\n\t\t\t// Build type lookup\n\t\t\tif (!namespaceInit) {\n\t\t\t\tnamespace = tinymce.ui;\n\n\t\t\t\tfor (name in namespace) {\n\t\t\t\t\ttypes[name.toLowerCase()] = namespace[name];\n\t\t\t\t}\n\n\t\t\t\tnamespaceInit = true;\n\t\t\t}\n\n\t\t\t// If string is specified then use it as the type\n\t\t\tif (typeof type == 'string') {\n\t\t\t\tsettings = settings || {};\n\t\t\t\tsettings.type = type;\n\t\t\t} else {\n\t\t\t\tsettings = type;\n\t\t\t\ttype = settings.type;\n\t\t\t}\n\n\t\t\t// Find control type\n\t\t\ttype = type.toLowerCase();\n\t\t\tControlType = types[type];\n\n\t\t\t// #if debug\n\n\t\t\tif (!ControlType) {\n\t\t\t\tthrow new Error(\"Could not find control by type: \" + type);\n\t\t\t}\n\n\t\t\t// #endif\n\n\t\t\tControlType = new ControlType(settings);\n\t\t\tControlType.type = type; // Set the type on the instance, this will be used by the Selector engine\n\n\t\t\treturn ControlType;\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/KeyboardNavigation.js\n\n/**\n * KeyboardNavigation.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles keyboard navigation of controls and elements.\n *\n * @class tinymce.ui.KeyboardNavigation\n */\ndefine(\"tinymce/ui/KeyboardNavigation\", [\n], function() {\n\t\"use strict\";\n\n\t/**\n\t * This class handles all keyboard navigation for WAI-ARIA support. Each root container\n\t * gets an instance of this class.\n\t *\n\t * @constructor\n\t */\n\treturn function(settings) {\n\t\tvar root = settings.root, focusedElement, focusedControl;\n\n\t\tfunction isElement(node) {\n\t\t\treturn node && node.nodeType === 1;\n\t\t}\n\n\t\ttry {\n\t\t\tfocusedElement = document.activeElement;\n\t\t} catch (ex) {\n\t\t\t// IE sometimes fails to return a proper element\n\t\t\tfocusedElement = document.body;\n\t\t}\n\n\t\tfocusedControl = root.getParentCtrl(focusedElement);\n\n\t\t/**\n\t\t * Returns the currently focused elements wai aria role of the currently\n\t\t * focused element or specified element.\n\t\t *\n\t\t * @private\n\t\t * @param {Element} elm Optional element to get role from.\n\t\t * @return {String} Role of specified element.\n\t\t */\n\t\tfunction getRole(elm) {\n\t\t\telm = elm || focusedElement;\n\n\t\t\tif (isElement(elm)) {\n\t\t\t\treturn elm.getAttribute('role');\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\t/**\n\t\t * Returns the wai role of the parent element of the currently\n\t\t * focused element or specified element.\n\t\t *\n\t\t * @private\n\t\t * @param {Element} elm Optional element to get parent role from.\n\t\t * @return {String} Role of the first parent that has a role.\n\t\t */\n\t\tfunction getParentRole(elm) {\n\t\t\tvar role, parent = elm || focusedElement;\n\n\t\t\twhile ((parent = parent.parentNode)) {\n\t\t\t\tif ((role = getRole(parent))) {\n\t\t\t\t\treturn role;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Returns a wai aria property by name for example aria-selected.\n\t\t *\n\t\t * @private\n\t\t * @param {String} name Name of the aria property to get for example \"disabled\".\n\t\t * @return {String} Aria property value.\n\t\t */\n\t\tfunction getAriaProp(name) {\n\t\t\tvar elm = focusedElement;\n\n\t\t\tif (isElement(elm)) {\n\t\t\t\treturn elm.getAttribute('aria-' + name);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Is the element a text input element or not.\n\t\t *\n\t\t * @private\n\t\t * @param {Element} elm Element to check if it's an text input element or not.\n\t\t * @return {Boolean} True/false if the element is a text element or not.\n\t\t */\n\t\tfunction isTextInputElement(elm) {\n\t\t\tvar tagName = elm.tagName.toUpperCase();\n\n\t\t\t// Notice: since type can be \"email\" etc we don't check the type\n\t\t\t// So all input elements gets treated as text input elements\n\t\t\treturn tagName == \"INPUT\" || tagName == \"TEXTAREA\" || tagName == \"SELECT\";\n\t\t}\n\n\t\t/**\n\t\t * Returns true/false if the specified element can be focused or not.\n\t\t *\n\t\t * @private\n\t\t * @param {Element} elm DOM element to check if it can be focused or not.\n\t\t * @return {Boolean} True/false if the element can have focus.\n\t\t */\n\t\tfunction canFocus(elm) {\n\t\t\tif (isTextInputElement(elm) && !elm.hidden) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (/^(button|menuitem|checkbox|tab|menuitemcheckbox|option|gridcell|slider)$/.test(getRole(elm))) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t/**\n\t\t * Returns an array of focusable visible elements within the specified container element.\n\t\t *\n\t\t * @private\n\t\t * @param {Element} elm DOM element to find focusable elements within.\n\t\t * @return {Array} Array of focusable elements.\n\t\t */\n\t\tfunction getFocusElements(elm) {\n\t\t\tvar elements = [];\n\n\t\t\tfunction collect(elm) {\n\t\t\t\tif (elm.nodeType != 1 || elm.style.display == 'none' || elm.disabled) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (canFocus(elm)) {\n\t\t\t\t\telements.push(elm);\n\t\t\t\t}\n\n\t\t\t\tfor (var i = 0; i < elm.childNodes.length; i++) {\n\t\t\t\t\tcollect(elm.childNodes[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcollect(elm || root.getEl());\n\n\t\t\treturn elements;\n\t\t}\n\n\t\t/**\n\t\t * Returns the navigation root control for the specified control. The navigation root\n\t\t * is the control that the keyboard navigation gets scoped to for example a menubar or toolbar group.\n\t\t * It will look for parents of the specified target control or the currently focused control if this option is omitted.\n\t\t *\n\t\t * @private\n\t\t * @param {tinymce.ui.Control} targetControl Optional target control to find root of.\n\t\t * @return {tinymce.ui.Control} Navigation root control.\n\t\t */\n\t\tfunction getNavigationRoot(targetControl) {\n\t\t\tvar navigationRoot, controls;\n\n\t\t\ttargetControl = targetControl || focusedControl;\n\t\t\tcontrols = targetControl.parents().toArray();\n\t\t\tcontrols.unshift(targetControl);\n\n\t\t\tfor (var i = 0; i < controls.length; i++) {\n\t\t\t\tnavigationRoot = controls[i];\n\n\t\t\t\tif (navigationRoot.settings.ariaRoot) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn navigationRoot;\n\t\t}\n\n\t\t/**\n\t\t * Focuses the first item in the specified targetControl element or the last aria index if the\n\t\t * navigation root has the ariaRemember option enabled.\n\t\t *\n\t\t * @private\n\t\t * @param {tinymce.ui.Control} targetControl Target control to focus the first item in.\n\t\t */\n\t\tfunction focusFirst(targetControl) {\n\t\t\tvar navigationRoot = getNavigationRoot(targetControl);\n\t\t\tvar focusElements = getFocusElements(navigationRoot.getEl());\n\n\t\t\tif (navigationRoot.settings.ariaRemember && \"lastAriaIndex\" in navigationRoot) {\n\t\t\t\tmoveFocusToIndex(navigationRoot.lastAriaIndex, focusElements);\n\t\t\t} else {\n\t\t\t\tmoveFocusToIndex(0, focusElements);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus to the specified index within the elements list.\n\t\t * This will scope the index to the size of the element list if it changed.\n\t\t *\n\t\t * @private\n\t\t * @param {Number} idx Specified index to move to.\n\t\t * @param {Array} elements Array with dom elements to move focus within.\n\t\t * @return {Number} Input index or a changed index if it was out of range.\n\t\t */\n\t\tfunction moveFocusToIndex(idx, elements) {\n\t\t\tif (idx < 0) {\n\t\t\t\tidx = elements.length - 1;\n\t\t\t} else if (idx >= elements.length) {\n\t\t\t\tidx = 0;\n\t\t\t}\n\n\t\t\tif (elements[idx]) {\n\t\t\t\telements[idx].focus();\n\t\t\t}\n\n\t\t\treturn idx;\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus forwards or backwards.\n\t\t *\n\t\t * @private\n\t\t * @param {Number} dir Direction to move in positive means forward, negative means backwards.\n\t\t * @param {Array} elements Optional array of elements to move within defaults to the current navigation roots elements.\n\t\t */\n\t\tfunction moveFocus(dir, elements) {\n\t\t\tvar idx = -1, navigationRoot = getNavigationRoot();\n\n\t\t\telements = elements || getFocusElements(navigationRoot.getEl());\n\n\t\t\tfor (var i = 0; i < elements.length; i++) {\n\t\t\t\tif (elements[i] === focusedElement) {\n\t\t\t\t\tidx = i;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tidx += dir;\n\t\t\tnavigationRoot.lastAriaIndex = moveFocusToIndex(idx, elements);\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus to the left this is called by the left key.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tfunction left() {\n\t\t\tvar parentRole = getParentRole();\n\n\t\t\tif (parentRole == \"tablist\") {\n\t\t\t\tmoveFocus(-1, getFocusElements(focusedElement.parentNode));\n\t\t\t} else if (focusedControl.parent().submenu) {\n\t\t\t\tcancel();\n\t\t\t} else {\n\t\t\t\tmoveFocus(-1);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus to the right this is called by the right key.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tfunction right() {\n\t\t\tvar role = getRole(), parentRole = getParentRole();\n\n\t\t\tif (parentRole == \"tablist\") {\n\t\t\t\tmoveFocus(1, getFocusElements(focusedElement.parentNode));\n\t\t\t} else if (role == \"menuitem\" && parentRole == \"menu\" && getAriaProp('haspopup')) {\n\t\t\t\tenter();\n\t\t\t} else {\n\t\t\t\tmoveFocus(1);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus to the up this is called by the up key.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tfunction up() {\n\t\t\tmoveFocus(-1);\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus to the up this is called by the down key.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tfunction down() {\n\t\t\tvar role = getRole(), parentRole = getParentRole();\n\n\t\t\tif (role == \"menuitem\" && parentRole == \"menubar\") {\n\t\t\t\tenter();\n\t\t\t} else if (role == \"button\" && getAriaProp('haspopup')) {\n\t\t\t\tenter({key: 'down'});\n\t\t\t} else {\n\t\t\t\tmoveFocus(1);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus to the next item or previous item depending on shift key.\n\t\t *\n\t\t * @private\n\t\t * @param {DOMEvent} e DOM event object.\n\t\t */\n\t\tfunction tab(e) {\n\t\t\tvar parentRole = getParentRole();\n\n\t\t\tif (parentRole == \"tablist\") {\n\t\t\t\tvar elm = getFocusElements(focusedControl.getEl('body'))[0];\n\n\t\t\t\tif (elm) {\n\t\t\t\t\telm.focus();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tmoveFocus(e.shiftKey ? -1 : 1);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Calls the cancel event on the currently focused control. This is normally done using the Esc key.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tfunction cancel() {\n\t\t\tfocusedControl.fire('cancel');\n\t\t}\n\n\t\t/**\n\t\t * Calls the click event on the currently focused control. This is normally done using the Enter/Space keys.\n\t\t *\n\t\t * @private\n\t\t * @param {Object} aria Optional aria data to pass along with the enter event.\n\t\t */\n\t\tfunction enter(aria) {\n\t\t\taria = aria || {};\n\t\t\tfocusedControl.fire('click', {target: focusedElement, aria: aria});\n\t\t}\n\n\t\troot.on('keydown', function(e) {\n\t\t\tfunction handleNonTabOrEscEvent(e, handler) {\n\t\t\t\t// Ignore non tab keys for text elements\n\t\t\t\tif (isTextInputElement(focusedElement)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (getRole(focusedElement) === 'slider') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (handler(e) !== false) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (e.isDefaultPrevented()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (e.keyCode) {\n\t\t\t\tcase 37: // DOM_VK_LEFT\n\t\t\t\t\thandleNonTabOrEscEvent(e, left);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 39: // DOM_VK_RIGHT\n\t\t\t\t\thandleNonTabOrEscEvent(e, right);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 38: // DOM_VK_UP\n\t\t\t\t\thandleNonTabOrEscEvent(e, up);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 40: // DOM_VK_DOWN\n\t\t\t\t\thandleNonTabOrEscEvent(e, down);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 27: // DOM_VK_ESCAPE\n\t\t\t\t\tcancel();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 14: // DOM_VK_ENTER\n\t\t\t\tcase 13: // DOM_VK_RETURN\n\t\t\t\tcase 32: // DOM_VK_SPACE\n\t\t\t\t\thandleNonTabOrEscEvent(e, enter);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 9: // DOM_VK_TAB\n\t\t\t\t\tif (tab(e) !== false) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\troot.on('focusin', function(e) {\n\t\t\tfocusedElement = e.target;\n\t\t\tfocusedControl = e.control;\n\t\t});\n\n\t\treturn {\n\t\t\tfocusFirst: focusFirst\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Container.js\n\n/**\n * Container.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Container control. This is extended by all controls that can have\n * children such as panels etc. You can also use this class directly as an\n * generic container instance. The container doesn't have any specific role or style.\n *\n * @-x-less Container.less\n * @class tinymce.ui.Container\n * @extends tinymce.ui.Control\n */\ndefine(\"tinymce/ui/Container\", [\n\t\"tinymce/ui/Control\",\n\t\"tinymce/ui/Collection\",\n\t\"tinymce/ui/Selector\",\n\t\"tinymce/ui/Factory\",\n\t\"tinymce/ui/KeyboardNavigation\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/ui/ClassList\",\n\t\"tinymce/ui/ReflowQueue\"\n], function(Control, Collection, Selector, Factory, KeyboardNavigation, Tools, $, ClassList, ReflowQueue) {\n\t\"use strict\";\n\n\tvar selectorCache = {};\n\n\treturn Control.extend({\n\t\t/**\n\t\t * Constructs a new control instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Array} items Items to add to container in JSON format or control instances.\n\t\t * @setting {String} layout Layout manager by name to use.\n\t\t * @setting {Object} defaults Default settings to apply to all items.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tsettings = self.settings;\n\n\t\t\tif (settings.fixed) {\n\t\t\t\tself.state.set('fixed', true);\n\t\t\t}\n\n\t\t\tself._items = new Collection();\n\n\t\t\tif (self.isRtl()) {\n\t\t\t\tself.classes.add('rtl');\n\t\t\t}\n\n\t\t\tself.bodyClasses = new ClassList(function() {\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.getEl('body').className = this.toString();\n\t\t\t\t}\n\t\t\t});\n\t\t\tself.bodyClasses.prefix = self.classPrefix;\n\n\t\t\tself.classes.add('container');\n\t\t\tself.bodyClasses.add('container-body');\n\n\t\t\tif (settings.containerCls) {\n\t\t\t\tself.classes.add(settings.containerCls);\n\t\t\t}\n\n\t\t\tself._layout = Factory.create((settings.layout || '') + 'layout');\n\n\t\t\tif (self.settings.items) {\n\t\t\t\tself.add(self.settings.items);\n\t\t\t} else {\n\t\t\t\tself.add(self.render());\n\t\t\t}\n\n\t\t\t// TODO: Fix this!\n\t\t\tself._hasBody = true;\n\t\t},\n\n\t\t/**\n\t\t * Returns a collection of child items that the container currently have.\n\t\t *\n\t\t * @method items\n\t\t * @return {tinymce.ui.Collection} Control collection direct child controls.\n\t\t */\n\t\titems: function() {\n\t\t\treturn this._items;\n\t\t},\n\n\t\t/**\n\t\t * Find child controls by selector.\n\t\t *\n\t\t * @method find\n\t\t * @param {String} selector Selector CSS pattern to find children by.\n\t\t * @return {tinymce.ui.Collection} Control collection with child controls.\n\t\t */\n\t\tfind: function(selector) {\n\t\t\tselector = selectorCache[selector] = selectorCache[selector] || new Selector(selector);\n\n\t\t\treturn selector.find(this);\n\t\t},\n\n\t\t/**\n\t\t * Adds one or many items to the current container. This will create instances of\n\t\t * the object representations if needed.\n\t\t *\n\t\t * @method add\n\t\t * @param {Array/Object/tinymce.ui.Control} items Array or item that will be added to the container.\n\t\t * @return {tinymce.ui.Collection} Current collection control.\n\t\t */\n\t\tadd: function(items) {\n\t\t\tvar self = this;\n\n\t\t\tself.items().add(self.create(items)).parent(self);\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Focuses the current container instance. This will look\n\t\t * for the first control in the container and focus that.\n\t\t *\n\t\t * @method focus\n\t\t * @param {Boolean} keyboard Optional true/false if the focus was a keyboard focus or not.\n\t\t * @return {tinymce.ui.Collection} Current instance.\n\t\t */\n\t\tfocus: function(keyboard) {\n\t\t\tvar self = this, focusCtrl, keyboardNav, items;\n\n\t\t\tif (keyboard) {\n\t\t\t\tkeyboardNav = self.keyboardNav || self.parents().eq(-1)[0].keyboardNav;\n\n\t\t\t\tif (keyboardNav) {\n\t\t\t\t\tkeyboardNav.focusFirst(self);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\titems = self.find('*');\n\n\t\t\t// TODO: Figure out a better way to auto focus alert dialog buttons\n\t\t\tif (self.statusbar) {\n\t\t\t\titems.add(self.statusbar.items());\n\t\t\t}\n\n\t\t\titems.each(function(ctrl) {\n\t\t\t\tif (ctrl.settings.autofocus) {\n\t\t\t\t\tfocusCtrl = null;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (ctrl.canFocus) {\n\t\t\t\t\tfocusCtrl = focusCtrl || ctrl;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (focusCtrl) {\n\t\t\t\tfocusCtrl.focus();\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Replaces the specified child control with a new control.\n\t\t *\n\t\t * @method replace\n\t\t * @param {tinymce.ui.Control} oldItem Old item to be replaced.\n\t\t * @param {tinymce.ui.Control} newItem New item to be inserted.\n\t\t */\n\t\treplace: function(oldItem, newItem) {\n\t\t\tvar ctrlElm, items = this.items(), i = items.length;\n\n\t\t\t// Replace the item in collection\n\t\t\twhile (i--) {\n\t\t\t\tif (items[i] === oldItem) {\n\t\t\t\t\titems[i] = newItem;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (i >= 0) {\n\t\t\t\t// Remove new item from DOM\n\t\t\t\tctrlElm = newItem.getEl();\n\t\t\t\tif (ctrlElm) {\n\t\t\t\t\tctrlElm.parentNode.removeChild(ctrlElm);\n\t\t\t\t}\n\n\t\t\t\t// Remove old item from DOM\n\t\t\t\tctrlElm = oldItem.getEl();\n\t\t\t\tif (ctrlElm) {\n\t\t\t\t\tctrlElm.parentNode.removeChild(ctrlElm);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Adopt the item\n\t\t\tnewItem.parent(this);\n\t\t},\n\n\t\t/**\n\t\t * Creates the specified items. If any of the items is plain JSON style objects\n\t\t * it will convert these into real tinymce.ui.Control instances.\n\t\t *\n\t\t * @method create\n\t\t * @param {Array} items Array of items to convert into control instances.\n\t\t * @return {Array} Array with control instances.\n\t\t */\n\t\tcreate: function(items) {\n\t\t\tvar self = this, settings, ctrlItems = [];\n\n\t\t\t// Non array structure, then force it into an array\n\t\t\tif (!Tools.isArray(items)) {\n\t\t\t\titems = [items];\n\t\t\t}\n\n\t\t\t// Add default type to each child control\n\t\t\tTools.each(items, function(item) {\n\t\t\t\tif (item) {\n\t\t\t\t\t// Construct item if needed\n\t\t\t\t\tif (!(item instanceof Control)) {\n\t\t\t\t\t\t// Name only then convert it to an object\n\t\t\t\t\t\tif (typeof item == \"string\") {\n\t\t\t\t\t\t\titem = {type: item};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Create control instance based on input settings and default settings\n\t\t\t\t\t\tsettings = Tools.extend({}, self.settings.defaults, item);\n\t\t\t\t\t\titem.type = settings.type = settings.type || item.type || self.settings.defaultType ||\n\t\t\t\t\t\t\t(settings.defaults ? settings.defaults.type : null);\n\t\t\t\t\t\titem = Factory.create(settings);\n\t\t\t\t\t}\n\n\t\t\t\t\tctrlItems.push(item);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn ctrlItems;\n\t\t},\n\n\t\t/**\n\t\t * Renders new control instances.\n\t\t *\n\t\t * @private\n\t\t */\n\t\trenderNew: function() {\n\t\t\tvar self = this;\n\n\t\t\t// Render any new items\n\t\t\tself.items().each(function(ctrl, index) {\n\t\t\t\tvar containerElm;\n\n\t\t\t\tctrl.parent(self);\n\n\t\t\t\tif (!ctrl.state.get('rendered')) {\n\t\t\t\t\tcontainerElm = self.getEl('body');\n\n\t\t\t\t\t// Insert or append the item\n\t\t\t\t\tif (containerElm.hasChildNodes() && index <= containerElm.childNodes.length - 1) {\n\t\t\t\t\t\t$(containerElm.childNodes[index]).before(ctrl.renderHtml());\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$(containerElm).append(ctrl.renderHtml());\n\t\t\t\t\t}\n\n\t\t\t\t\tctrl.postRender();\n\t\t\t\t\tReflowQueue.add(ctrl);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself._layout.applyClasses(self.items().filter(':visible'));\n\t\t\tself._lastRect = null;\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Appends new instances to the current container.\n\t\t *\n\t\t * @method append\n\t\t * @param {Array/tinymce.ui.Collection} items Array if controls to append.\n\t\t * @return {tinymce.ui.Container} Current container instance.\n\t\t */\n\t\tappend: function(items) {\n\t\t\treturn this.add(items).renderNew();\n\t\t},\n\n\t\t/**\n\t\t * Prepends new instances to the current container.\n\t\t *\n\t\t * @method prepend\n\t\t * @param {Array/tinymce.ui.Collection} items Array if controls to prepend.\n\t\t * @return {tinymce.ui.Container} Current container instance.\n\t\t */\n\t\tprepend: function(items) {\n\t\t\tvar self = this;\n\n\t\t\tself.items().set(self.create(items).concat(self.items().toArray()));\n\n\t\t\treturn self.renderNew();\n\t\t},\n\n\t\t/**\n\t\t * Inserts an control at a specific index.\n\t\t *\n\t\t * @method insert\n\t\t * @param {Array/tinymce.ui.Collection} items Array if controls to insert.\n\t\t * @param {Number} index Index to insert controls at.\n\t\t * @param {Boolean} [before=false] Inserts controls before the index.\n\t\t */\n\t\tinsert: function(items, index, before) {\n\t\t\tvar self = this, curItems, beforeItems, afterItems;\n\n\t\t\titems = self.create(items);\n\t\t\tcurItems = self.items();\n\n\t\t\tif (!before && index < curItems.length - 1) {\n\t\t\t\tindex += 1;\n\t\t\t}\n\n\t\t\tif (index >= 0 && index < curItems.length) {\n\t\t\t\tbeforeItems = curItems.slice(0, index).toArray();\n\t\t\t\tafterItems = curItems.slice(index).toArray();\n\t\t\t\tcurItems.set(beforeItems.concat(items, afterItems));\n\t\t\t}\n\n\t\t\treturn self.renderNew();\n\t\t},\n\n\t\t/**\n\t\t * Populates the form fields from the specified JSON data object.\n\t\t *\n\t\t * Control items in the form that matches the data will have it's value set.\n\t\t *\n\t\t * @method fromJSON\n\t\t * @param {Object} data JSON data object to set control values by.\n\t\t * @return {tinymce.ui.Container} Current form instance.\n\t\t */\n\t\tfromJSON: function(data) {\n\t\t\tvar self = this;\n\n\t\t\tfor (var name in data) {\n\t\t\t\tself.find('#' + name).value(data[name]);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Serializes the form into a JSON object by getting all items\n\t\t * that has a name and a value.\n\t\t *\n\t\t * @method toJSON\n\t\t * @return {Object} JSON object with form data.\n\t\t */\n\t\ttoJSON: function() {\n\t\t\tvar self = this, data = {};\n\n\t\t\tself.find('*').each(function(ctrl) {\n\t\t\t\tvar name = ctrl.name(), value = ctrl.value();\n\n\t\t\t\tif (name && typeof value != \"undefined\") {\n\t\t\t\t\tdata[name] = value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn data;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout, role = this.settings.role;\n\n\t\t\tself.preRender();\n\t\t\tlayout.preRender(self);\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\"' + (role ? ' role=\"' + this.settings.role + '\"' : '') + '>' +\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\n\t\t\t\t\t\t(self.settings.html || '') + layout.renderHtml(self) +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Post render method. Called after the control has been rendered to the target.\n\t\t *\n\t\t * @method postRender\n\t\t * @return {tinymce.ui.Container} Current combobox instance.\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, box;\n\n\t\t\tself.items().exec('postRender');\n\t\t\tself._super();\n\n\t\t\tself._layout.postRender(self);\n\t\t\tself.state.set('rendered', true);\n\n\t\t\tif (self.settings.style) {\n\t\t\t\tself.$el.css(self.settings.style);\n\t\t\t}\n\n\t\t\tif (self.settings.border) {\n\t\t\t\tbox = self.borderBox;\n\t\t\t\tself.$el.css({\n\t\t\t\t\t'border-top-width': box.top,\n\t\t\t\t\t'border-right-width': box.right,\n\t\t\t\t\t'border-bottom-width': box.bottom,\n\t\t\t\t\t'border-left-width': box.left\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!self.parent()) {\n\t\t\t\tself.keyboardNav = new KeyboardNavigation({\n\t\t\t\t\troot: self\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Initializes the current controls layout rect.\n\t\t * This will be executed by the layout managers to determine the\n\t\t * default minWidth/minHeight etc.\n\t\t *\n\t\t * @method initLayoutRect\n\t\t * @return {Object} Layout rect instance.\n\t\t */\n\t\tinitLayoutRect: function() {\n\t\t\tvar self = this, layoutRect = self._super();\n\n\t\t\t// Recalc container size by asking layout manager\n\t\t\tself._layout.recalc(self);\n\n\t\t\treturn layoutRect;\n\t\t},\n\n\t\t/**\n\t\t * Recalculates the positions of the controls in the current container.\n\t\t * This is invoked by the reflow method and shouldn't be called directly.\n\t\t *\n\t\t * @method recalc\n\t\t */\n\t\trecalc: function() {\n\t\t\tvar self = this, rect = self._layoutRect, lastRect = self._lastRect;\n\n\t\t\tif (!lastRect || lastRect.w != rect.w || lastRect.h != rect.h) {\n\t\t\t\tself._layout.recalc(self);\n\t\t\t\trect = self.layoutRect();\n\t\t\t\tself._lastRect = {x: rect.x, y: rect.y, w: rect.w, h: rect.h};\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Reflows the current container and it's children and possible parents.\n\t\t * This should be used after you for example append children to the current control so\n\t\t * that the layout managers know that they need to reposition everything.\n\t\t *\n\t\t * @example\n\t\t * container.append({type: 'button', text: 'My button'}).reflow();\n\t\t *\n\t\t * @method reflow\n\t\t * @return {tinymce.ui.Container} Current container instance.\n\t\t */\n\t\treflow: function() {\n\t\t\tvar i;\n\n\t\t\tReflowQueue.remove(this);\n\n\t\t\tif (this.visible()) {\n\t\t\t\tControl.repaintControls = [];\n\t\t\t\tControl.repaintControls.map = {};\n\n\t\t\t\tthis.recalc();\n\t\t\t\ti = Control.repaintControls.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tControl.repaintControls[i].repaint();\n\t\t\t\t}\n\n\t\t\t\t// TODO: Fix me!\n\t\t\t\tif (this.settings.layout !== \"flow\" && this.settings.layout !== \"stack\") {\n\t\t\t\t\tthis.repaint();\n\t\t\t\t}\n\n\t\t\t\tControl.repaintControls = [];\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/DragHelper.js\n\n/**\n * DragHelper.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Drag/drop helper class.\n *\n * @example\n * var dragHelper = new tinymce.ui.DragHelper('mydiv', {\n *     start: function(evt) {\n *     },\n *\n *     drag: function(evt) {\n *     },\n *\n *     end: function(evt) {\n *     }\n * });\n *\n * @class tinymce.ui.DragHelper\n */\ndefine(\"tinymce/ui/DragHelper\", [\n\t\"tinymce/dom/DomQuery\"\n], function($) {\n\t\"use strict\";\n\n\tfunction getDocumentSize(doc) {\n\t\tvar documentElement, body, scrollWidth, clientWidth;\n\t\tvar offsetWidth, scrollHeight, clientHeight, offsetHeight, max = Math.max;\n\n\t\tdocumentElement = doc.documentElement;\n\t\tbody = doc.body;\n\n\t\tscrollWidth = max(documentElement.scrollWidth, body.scrollWidth);\n\t\tclientWidth = max(documentElement.clientWidth, body.clientWidth);\n\t\toffsetWidth = max(documentElement.offsetWidth, body.offsetWidth);\n\n\t\tscrollHeight = max(documentElement.scrollHeight, body.scrollHeight);\n\t\tclientHeight = max(documentElement.clientHeight, body.clientHeight);\n\t\toffsetHeight = max(documentElement.offsetHeight, body.offsetHeight);\n\n\t\treturn {\n\t\t\twidth: scrollWidth < offsetWidth ? clientWidth : scrollWidth,\n\t\t\theight: scrollHeight < offsetHeight ? clientHeight : scrollHeight\n\t\t};\n\t}\n\n\tfunction updateWithTouchData(e) {\n\t\tvar keys, i;\n\n\t\tif (e.changedTouches) {\n\t\t\tkeys = \"screenX screenY pageX pageY clientX clientY\".split(' ');\n\t\t\tfor (i = 0; i < keys.length; i++) {\n\t\t\t\te[keys[i]] = e.changedTouches[0][keys[i]];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn function(id, settings) {\n\t\tvar $eventOverlay, doc = settings.document || document, downButton, start, stop, drag, startX, startY;\n\n\t\tsettings = settings || {};\n\n\t\tfunction getHandleElm() {\n\t\t\treturn doc.getElementById(settings.handle || id);\n\t\t}\n\n\t\tstart = function(e) {\n\t\t\tvar docSize = getDocumentSize(doc), handleElm, cursor;\n\n\t\t\tupdateWithTouchData(e);\n\n\t\t\te.preventDefault();\n\t\t\tdownButton = e.button;\n\t\t\thandleElm = getHandleElm();\n\t\t\tstartX = e.screenX;\n\t\t\tstartY = e.screenY;\n\n\t\t\t// Grab cursor from handle so we can place it on overlay\n\t\t\tif (window.getComputedStyle) {\n\t\t\t\tcursor = window.getComputedStyle(handleElm, null).getPropertyValue(\"cursor\");\n\t\t\t} else {\n\t\t\t\tcursor = handleElm.runtimeStyle.cursor;\n\t\t\t}\n\n\t\t\t$eventOverlay = $('<div></div>').css({\n\t\t\t\tposition: \"absolute\",\n\t\t\t\ttop: 0, left: 0,\n\t\t\t\twidth: docSize.width,\n\t\t\t\theight: docSize.height,\n\t\t\t\tzIndex: 0x7FFFFFFF,\n\t\t\t\topacity: 0.0001,\n\t\t\t\tcursor: cursor\n\t\t\t}).appendTo(doc.body);\n\n\t\t\t$(doc).on('mousemove touchmove', drag).on('mouseup touchend', stop);\n\n\t\t\tsettings.start(e);\n\t\t};\n\n\t\tdrag = function(e) {\n\t\t\tupdateWithTouchData(e);\n\n\t\t\tif (e.button !== downButton) {\n\t\t\t\treturn stop(e);\n\t\t\t}\n\n\t\t\te.deltaX = e.screenX - startX;\n\t\t\te.deltaY = e.screenY - startY;\n\n\t\t\te.preventDefault();\n\t\t\tsettings.drag(e);\n\t\t};\n\n\t\tstop = function(e) {\n\t\t\tupdateWithTouchData(e);\n\n\t\t\t$(doc).off('mousemove touchmove', drag).off('mouseup touchend', stop);\n\n\t\t\t$eventOverlay.remove();\n\n\t\t\tif (settings.stop) {\n\t\t\t\tsettings.stop(e);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Destroys the drag/drop helper instance.\n\t\t *\n\t\t * @method destroy\n\t\t */\n\t\tthis.destroy = function() {\n\t\t\t$(getHandleElm()).off();\n\t\t};\n\n\t\t$(getHandleElm()).on('mousedown touchstart', start);\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Scrollable.js\n\n/**\n * Scrollable.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This mixin makes controls scrollable using custom scrollbars.\n *\n * @-x-less Scrollable.less\n * @mixin tinymce.ui.Scrollable\n */\ndefine(\"tinymce/ui/Scrollable\", [\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/ui/DragHelper\"\n], function($, DragHelper) {\n\t\"use strict\";\n\n\treturn {\n\t\tinit: function() {\n\t\t\tvar self = this;\n\t\t\tself.on('repaint', self.renderScroll);\n\t\t},\n\n\t\trenderScroll: function() {\n\t\t\tvar self = this, margin = 2;\n\n\t\t\tfunction repaintScroll() {\n\t\t\t\tvar hasScrollH, hasScrollV, bodyElm;\n\n\t\t\t\tfunction repaintAxis(axisName, posName, sizeName, contentSizeName, hasScroll, ax) {\n\t\t\t\t\tvar containerElm, scrollBarElm, scrollThumbElm;\n\t\t\t\t\tvar containerSize, scrollSize, ratio, rect;\n\t\t\t\t\tvar posNameLower, sizeNameLower;\n\n\t\t\t\t\tscrollBarElm = self.getEl('scroll' + axisName);\n\t\t\t\t\tif (scrollBarElm) {\n\t\t\t\t\t\tposNameLower = posName.toLowerCase();\n\t\t\t\t\t\tsizeNameLower = sizeName.toLowerCase();\n\n\t\t\t\t\t\t$(self.getEl('absend')).css(posNameLower, self.layoutRect()[contentSizeName] - 1);\n\n\t\t\t\t\t\tif (!hasScroll) {\n\t\t\t\t\t\t\t$(scrollBarElm).css('display', 'none');\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$(scrollBarElm).css('display', 'block');\n\t\t\t\t\t\tcontainerElm = self.getEl('body');\n\t\t\t\t\t\tscrollThumbElm = self.getEl('scroll' + axisName + \"t\");\n\t\t\t\t\t\tcontainerSize = containerElm[\"client\" + sizeName] - (margin * 2);\n\t\t\t\t\t\tcontainerSize -= hasScrollH && hasScrollV ? scrollBarElm[\"client\" + ax] : 0;\n\t\t\t\t\t\tscrollSize = containerElm[\"scroll\" + sizeName];\n\t\t\t\t\t\tratio = containerSize / scrollSize;\n\n\t\t\t\t\t\trect = {};\n\t\t\t\t\t\trect[posNameLower] = containerElm[\"offset\" + posName] + margin;\n\t\t\t\t\t\trect[sizeNameLower] = containerSize;\n\t\t\t\t\t\t$(scrollBarElm).css(rect);\n\n\t\t\t\t\t\trect = {};\n\t\t\t\t\t\trect[posNameLower] = containerElm[\"scroll\" + posName] * ratio;\n\t\t\t\t\t\trect[sizeNameLower] = containerSize * ratio;\n\t\t\t\t\t\t$(scrollThumbElm).css(rect);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbodyElm = self.getEl('body');\n\t\t\t\thasScrollH = bodyElm.scrollWidth > bodyElm.clientWidth;\n\t\t\t\thasScrollV = bodyElm.scrollHeight > bodyElm.clientHeight;\n\n\t\t\t\trepaintAxis(\"h\", \"Left\", \"Width\", \"contentW\", hasScrollH, \"Height\");\n\t\t\t\trepaintAxis(\"v\", \"Top\", \"Height\", \"contentH\", hasScrollV, \"Width\");\n\t\t\t}\n\n\t\t\tfunction addScroll() {\n\t\t\t\tfunction addScrollAxis(axisName, posName, sizeName, deltaPosName, ax) {\n\t\t\t\t\tvar scrollStart, axisId = self._id + '-scroll' + axisName, prefix = self.classPrefix;\n\n\t\t\t\t\t$(self.getEl()).append(\n\t\t\t\t\t\t'<div id=\"' + axisId + '\" class=\"' + prefix + 'scrollbar ' + prefix + 'scrollbar-' + axisName + '\">' +\n\t\t\t\t\t\t\t'<div id=\"' + axisId + 't\" class=\"' + prefix + 'scrollbar-thumb\"></div>' +\n\t\t\t\t\t\t'</div>'\n\t\t\t\t\t);\n\n\t\t\t\t\tself.draghelper = new DragHelper(axisId + 't', {\n\t\t\t\t\t\tstart: function() {\n\t\t\t\t\t\t\tscrollStart = self.getEl('body')[\"scroll\" + posName];\n\t\t\t\t\t\t\t$('#' + axisId).addClass(prefix + 'active');\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\tdrag: function(e) {\n\t\t\t\t\t\t\tvar ratio, hasScrollH, hasScrollV, containerSize, layoutRect = self.layoutRect();\n\n\t\t\t\t\t\t\thasScrollH = layoutRect.contentW > layoutRect.innerW;\n\t\t\t\t\t\t\thasScrollV = layoutRect.contentH > layoutRect.innerH;\n\t\t\t\t\t\t\tcontainerSize = self.getEl('body')[\"client\" + sizeName] - (margin * 2);\n\t\t\t\t\t\t\tcontainerSize -= hasScrollH && hasScrollV ? self.getEl('scroll' + axisName)[\"client\" + ax] : 0;\n\n\t\t\t\t\t\t\tratio = containerSize / self.getEl('body')[\"scroll\" + sizeName];\n\t\t\t\t\t\t\tself.getEl('body')[\"scroll\" + posName] = scrollStart + (e[\"delta\" + deltaPosName] / ratio);\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\tstop: function() {\n\t\t\t\t\t\t\t$('#' + axisId).removeClass(prefix + 'active');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tself.classes.add('scroll');\n\n\t\t\t\taddScrollAxis(\"v\", \"Top\", \"Height\", \"Y\", \"Width\");\n\t\t\t\taddScrollAxis(\"h\", \"Left\", \"Width\", \"X\", \"Height\");\n\t\t\t}\n\n\t\t\tif (self.settings.autoScroll) {\n\t\t\t\tif (!self._hasScroll) {\n\t\t\t\t\tself._hasScroll = true;\n\t\t\t\t\taddScroll();\n\n\t\t\t\t\tself.on('wheel', function(e) {\n\t\t\t\t\t\tvar bodyEl = self.getEl('body');\n\n\t\t\t\t\t\tbodyEl.scrollLeft += (e.deltaX || 0) * 10;\n\t\t\t\t\t\tbodyEl.scrollTop += e.deltaY * 10;\n\n\t\t\t\t\t\trepaintScroll();\n\t\t\t\t\t});\n\n\t\t\t\t\t$(self.getEl('body')).on(\"scroll\", repaintScroll);\n\t\t\t\t}\n\n\t\t\t\trepaintScroll();\n\t\t\t}\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Panel.js\n\n/**\n * Panel.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new panel.\n *\n * @-x-less Panel.less\n * @class tinymce.ui.Panel\n * @extends tinymce.ui.Container\n * @mixes tinymce.ui.Scrollable\n */\ndefine(\"tinymce/ui/Panel\", [\n\t\"tinymce/ui/Container\",\n\t\"tinymce/ui/Scrollable\"\n], function(Container, Scrollable) {\n\t\"use strict\";\n\n\treturn Container.extend({\n\t\tDefaults: {\n\t\t\tlayout: 'fit',\n\t\t\tcontainerCls: 'panel'\n\t\t},\n\n\t\tMixins: [Scrollable],\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout, innerHtml = self.settings.html;\n\n\t\t\tself.preRender();\n\t\t\tlayout.preRender(self);\n\n\t\t\tif (typeof innerHtml == \"undefined\") {\n\t\t\t\tinnerHtml = (\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\n\t\t\t\t\t\tlayout.renderHtml(self) +\n\t\t\t\t\t'</div>'\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tif (typeof innerHtml == 'function') {\n\t\t\t\t\tinnerHtml = innerHtml.call(self);\n\t\t\t\t}\n\n\t\t\t\tself._hasBody = false;\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\" hidefocus=\"1\" tabindex=\"-1\" role=\"group\">' +\n\t\t\t\t\t(self._preBodyHtml || '') +\n\t\t\t\t\tinnerHtml +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Movable.js\n\n/**\n * Movable.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Movable mixin. Makes controls movable absolute and relative to other elements.\n *\n * @mixin tinymce.ui.Movable\n */\ndefine(\"tinymce/ui/Movable\", [\n\t\"tinymce/ui/DomUtils\"\n], function(DomUtils) {\n\t\"use strict\";\n\n\tfunction calculateRelativePosition(ctrl, targetElm, rel) {\n\t\tvar ctrlElm, pos, x, y, selfW, selfH, targetW, targetH, viewport, size;\n\n\t\tviewport = DomUtils.getViewPort();\n\n\t\t// Get pos of target\n\t\tpos = DomUtils.getPos(targetElm);\n\t\tx = pos.x;\n\t\ty = pos.y;\n\n\t\tif (ctrl.state.get('fixed') && DomUtils.getRuntimeStyle(document.body, 'position') == 'static') {\n\t\t\tx -= viewport.x;\n\t\t\ty -= viewport.y;\n\t\t}\n\n\t\t// Get size of self\n\t\tctrlElm = ctrl.getEl();\n\t\tsize = DomUtils.getSize(ctrlElm);\n\t\tselfW = size.width;\n\t\tselfH = size.height;\n\n\t\t// Get size of target\n\t\tsize = DomUtils.getSize(targetElm);\n\t\ttargetW = size.width;\n\t\ttargetH = size.height;\n\n\t\t// Parse align string\n\t\trel = (rel || '').split('');\n\n\t\t// Target corners\n\t\tif (rel[0] === 'b') {\n\t\t\ty += targetH;\n\t\t}\n\n\t\tif (rel[1] === 'r') {\n\t\t\tx += targetW;\n\t\t}\n\n\t\tif (rel[0] === 'c') {\n\t\t\ty += Math.round(targetH / 2);\n\t\t}\n\n\t\tif (rel[1] === 'c') {\n\t\t\tx += Math.round(targetW / 2);\n\t\t}\n\n\t\t// Self corners\n\t\tif (rel[3] === 'b') {\n\t\t\ty -= selfH;\n\t\t}\n\n\t\tif (rel[4] === 'r') {\n\t\t\tx -= selfW;\n\t\t}\n\n\t\tif (rel[3] === 'c') {\n\t\t\ty -= Math.round(selfH / 2);\n\t\t}\n\n\t\tif (rel[4] === 'c') {\n\t\t\tx -= Math.round(selfW / 2);\n\t\t}\n\n\t\treturn {\n\t\t\tx: x,\n\t\t\ty: y,\n\t\t\tw: selfW,\n\t\t\th: selfH\n\t\t};\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Tests various positions to get the most suitable one.\n\t\t *\n\t\t * @method testMoveRel\n\t\t * @param {DOMElement} elm Element to position against.\n\t\t * @param {Array} rels Array with relative positions.\n\t\t * @return {String} Best suitable relative position.\n\t\t */\n\t\ttestMoveRel: function(elm, rels) {\n\t\t\tvar viewPortRect = DomUtils.getViewPort();\n\n\t\t\tfor (var i = 0; i < rels.length; i++) {\n\t\t\t\tvar pos = calculateRelativePosition(this, elm, rels[i]);\n\n\t\t\t\tif (this.state.get('fixed')) {\n\t\t\t\t\tif (pos.x > 0 && pos.x + pos.w < viewPortRect.w && pos.y > 0 && pos.y + pos.h < viewPortRect.h) {\n\t\t\t\t\t\treturn rels[i];\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (pos.x > viewPortRect.x && pos.x + pos.w < viewPortRect.w + viewPortRect.x &&\n\t\t\t\t\t\tpos.y > viewPortRect.y && pos.y + pos.h < viewPortRect.h + viewPortRect.y) {\n\t\t\t\t\t\treturn rels[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn rels[0];\n\t\t},\n\n\t\t/**\n\t\t * Move relative to the specified element.\n\t\t *\n\t\t * @method moveRel\n\t\t * @param {Element} elm Element to move relative to.\n\t\t * @param {String} rel Relative mode. For example: br-tl.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tmoveRel: function(elm, rel) {\n\t\t\tif (typeof rel != 'string') {\n\t\t\t\trel = this.testMoveRel(elm, rel);\n\t\t\t}\n\n\t\t\tvar pos = calculateRelativePosition(this, elm, rel);\n\t\t\treturn this.moveTo(pos.x, pos.y);\n\t\t},\n\n\t\t/**\n\t\t * Move by a relative x, y values.\n\t\t *\n\t\t * @method moveBy\n\t\t * @param {Number} dx Relative x position.\n\t\t * @param {Number} dy Relative y position.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tmoveBy: function(dx, dy) {\n\t\t\tvar self = this, rect = self.layoutRect();\n\n\t\t\tself.moveTo(rect.x + dx, rect.y + dy);\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Move to absolute position.\n\t\t *\n\t\t * @method moveTo\n\t\t * @param {Number} x Absolute x position.\n\t\t * @param {Number} y Absolute y position.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tmoveTo: function(x, y) {\n\t\t\tvar self = this;\n\n\t\t\t// TODO: Move this to some global class\n\t\t\tfunction constrain(value, max, size) {\n\t\t\t\tif (value < 0) {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\n\t\t\t\tif (value + size > max) {\n\t\t\t\t\tvalue = max - size;\n\t\t\t\t\treturn value < 0 ? 0 : value;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tif (self.settings.constrainToViewport) {\n\t\t\t\tvar viewPortRect = DomUtils.getViewPort(window);\n\t\t\t\tvar layoutRect = self.layoutRect();\n\n\t\t\t\tx = constrain(x, viewPortRect.w + viewPortRect.x, layoutRect.w);\n\t\t\t\ty = constrain(y, viewPortRect.h + viewPortRect.y, layoutRect.h);\n\t\t\t}\n\n\t\t\tif (self.state.get('rendered')) {\n\t\t\t\tself.layoutRect({x: x, y: y}).repaint();\n\t\t\t} else {\n\t\t\t\tself.settings.x = x;\n\t\t\t\tself.settings.y = y;\n\t\t\t}\n\n\t\t\tself.fire('move', {x: x, y: y});\n\n\t\t\treturn self;\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Resizable.js\n\n/**\n * Resizable.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Resizable mixin. Enables controls to be resized.\n *\n * @mixin tinymce.ui.Resizable\n */\ndefine(\"tinymce/ui/Resizable\", [\n\t\"tinymce/ui/DomUtils\"\n], function(DomUtils) {\n\t\"use strict\";\n\n\treturn {\n\t\t/**\n\t\t * Resizes the control to contents.\n\t\t *\n\t\t * @method resizeToContent\n\t\t */\n\t\tresizeToContent: function() {\n\t\t\tthis._layoutRect.autoResize = true;\n\t\t\tthis._lastRect = null;\n\t\t\tthis.reflow();\n\t\t},\n\n\t\t/**\n\t\t * Resizes the control to a specific width/height.\n\t\t *\n\t\t * @method resizeTo\n\t\t * @param {Number} w Control width.\n\t\t * @param {Number} h Control height.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tresizeTo: function(w, h) {\n\t\t\t// TODO: Fix hack\n\t\t\tif (w <= 1 || h <= 1) {\n\t\t\t\tvar rect = DomUtils.getWindowSize();\n\n\t\t\t\tw = w <= 1 ? w * rect.w : w;\n\t\t\t\th = h <= 1 ? h * rect.h : h;\n\t\t\t}\n\n\t\t\tthis._layoutRect.autoResize = false;\n\t\t\treturn this.layoutRect({minW: w, minH: h, w: w, h: h}).reflow();\n\t\t},\n\n\t\t/**\n\t\t * Resizes the control to a specific relative width/height.\n\t\t *\n\t\t * @method resizeBy\n\t\t * @param {Number} dw Relative control width.\n\t\t * @param {Number} dh Relative control height.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tresizeBy: function(dw, dh) {\n\t\t\tvar self = this, rect = self.layoutRect();\n\n\t\t\treturn self.resizeTo(rect.w + dw, rect.h + dh);\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/FloatPanel.js\n\n/**\n * FloatPanel.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates a floating panel.\n *\n * @-x-less FloatPanel.less\n * @class tinymce.ui.FloatPanel\n * @extends tinymce.ui.Panel\n * @mixes tinymce.ui.Movable\n * @mixes tinymce.ui.Resizable\n */\ndefine(\"tinymce/ui/FloatPanel\", [\n\t\"tinymce/ui/Panel\",\n\t\"tinymce/ui/Movable\",\n\t\"tinymce/ui/Resizable\",\n\t\"tinymce/ui/DomUtils\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/util/Delay\"\n], function(Panel, Movable, Resizable, DomUtils, $, Delay) {\n\t\"use strict\";\n\n\tvar documentClickHandler, documentScrollHandler, windowResizeHandler, visiblePanels = [];\n\tvar zOrder = [], hasModal;\n\n\tfunction isChildOf(ctrl, parent) {\n\t\twhile (ctrl) {\n\t\t\tif (ctrl == parent) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tctrl = ctrl.parent();\n\t\t}\n\t}\n\n\tfunction skipOrHidePanels(e) {\n\t\t// Hide any float panel when a click/focus out is out side that float panel and the\n\t\t// float panels direct parent for example a click on a menu button\n\t\tvar i = visiblePanels.length;\n\n\t\twhile (i--) {\n\t\t\tvar panel = visiblePanels[i], clickCtrl = panel.getParentCtrl(e.target);\n\n\t\t\tif (panel.settings.autohide) {\n\t\t\t\tif (clickCtrl) {\n\t\t\t\t\tif (isChildOf(clickCtrl, panel) || panel.parent() === clickCtrl) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\te = panel.fire('autohide', {target: e.target});\n\t\t\t\tif (!e.isDefaultPrevented()) {\n\t\t\t\t\tpanel.hide();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction bindDocumentClickHandler() {\n\n\t\tif (!documentClickHandler) {\n\t\t\tdocumentClickHandler = function(e) {\n\t\t\t\t// Gecko fires click event and in the wrong order on Mac so lets normalize\n\t\t\t\tif (e.button == 2) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tskipOrHidePanels(e);\n\t\t\t};\n\n\t\t\t$(document).on('click touchstart', documentClickHandler);\n\t\t}\n\t}\n\n\tfunction bindDocumentScrollHandler() {\n\t\tif (!documentScrollHandler) {\n\t\t\tdocumentScrollHandler = function() {\n\t\t\t\tvar i;\n\n\t\t\t\ti = visiblePanels.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\trepositionPanel(visiblePanels[i]);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t$(window).on('scroll', documentScrollHandler);\n\t\t}\n\t}\n\n\tfunction bindWindowResizeHandler() {\n\t\tif (!windowResizeHandler) {\n\t\t\tvar docElm = document.documentElement, clientWidth = docElm.clientWidth, clientHeight = docElm.clientHeight;\n\n\t\t\twindowResizeHandler = function() {\n\t\t\t\t// Workaround for #7065 IE 7 fires resize events event though the window wasn't resized\n\t\t\t\tif (!document.all || clientWidth != docElm.clientWidth || clientHeight != docElm.clientHeight) {\n\t\t\t\t\tclientWidth = docElm.clientWidth;\n\t\t\t\t\tclientHeight = docElm.clientHeight;\n\t\t\t\t\tFloatPanel.hideAll();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t$(window).on('resize', windowResizeHandler);\n\t\t}\n\t}\n\n\t/**\n\t * Repositions the panel to the top of page if the panel is outside of the visual viewport. It will\n\t * also reposition all child panels of the current panel.\n\t */\n\tfunction repositionPanel(panel) {\n\t\tvar scrollY = DomUtils.getViewPort().y;\n\n\t\tfunction toggleFixedChildPanels(fixed, deltaY) {\n\t\t\tvar parent;\n\n\t\t\tfor (var i = 0; i < visiblePanels.length; i++) {\n\t\t\t\tif (visiblePanels[i] != panel) {\n\t\t\t\t\tparent = visiblePanels[i].parent();\n\n\t\t\t\t\twhile (parent && (parent = parent.parent())) {\n\t\t\t\t\t\tif (parent == panel) {\n\t\t\t\t\t\t\tvisiblePanels[i].fixed(fixed).moveBy(0, deltaY).repaint();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (panel.settings.autofix) {\n\t\t\tif (!panel.state.get('fixed')) {\n\t\t\t\tpanel._autoFixY = panel.layoutRect().y;\n\n\t\t\t\tif (panel._autoFixY < scrollY) {\n\t\t\t\t\tpanel.fixed(true).layoutRect({y: 0}).repaint();\n\t\t\t\t\ttoggleFixedChildPanels(true, scrollY - panel._autoFixY);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (panel._autoFixY > scrollY) {\n\t\t\t\t\tpanel.fixed(false).layoutRect({y: panel._autoFixY}).repaint();\n\t\t\t\t\ttoggleFixedChildPanels(false, panel._autoFixY - scrollY);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction addRemove(add, ctrl) {\n\t\tvar i, zIndex = FloatPanel.zIndex || 0xFFFF, topModal;\n\n\t\tif (add) {\n\t\t\tzOrder.push(ctrl);\n\t\t} else {\n\t\t\ti = zOrder.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tif (zOrder[i] === ctrl) {\n\t\t\t\t\tzOrder.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (zOrder.length) {\n\t\t\tfor (i = 0; i < zOrder.length; i++) {\n\t\t\t\tif (zOrder[i].modal) {\n\t\t\t\t\tzIndex++;\n\t\t\t\t\ttopModal = zOrder[i];\n\t\t\t\t}\n\n\t\t\t\tzOrder[i].getEl().style.zIndex = zIndex;\n\t\t\t\tzOrder[i].zIndex = zIndex;\n\t\t\t\tzIndex++;\n\t\t\t}\n\t\t}\n\n\t\tvar modalBlockEl = $('#' + ctrl.classPrefix + 'modal-block', ctrl.getContainerElm())[0];\n\n\t\tif (topModal) {\n\t\t\t$(modalBlockEl).css('z-index', topModal.zIndex - 1);\n\t\t} else if (modalBlockEl) {\n\t\t\tmodalBlockEl.parentNode.removeChild(modalBlockEl);\n\t\t\thasModal = false;\n\t\t}\n\n\t\tFloatPanel.currentZIndex = zIndex;\n\t}\n\n\tvar FloatPanel = Panel.extend({\n\t\tMixins: [Movable, Resizable],\n\n\t\t/**\n\t\t * Constructs a new control instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Boolean} autohide Automatically hide the panel.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tself._eventsRoot = self;\n\n\t\t\tself.classes.add('floatpanel');\n\n\t\t\t// Hide floatpanes on click out side the root button\n\t\t\tif (settings.autohide) {\n\t\t\t\tbindDocumentClickHandler();\n\t\t\t\tbindWindowResizeHandler();\n\t\t\t\tvisiblePanels.push(self);\n\t\t\t}\n\n\t\t\tif (settings.autofix) {\n\t\t\t\tbindDocumentScrollHandler();\n\n\t\t\t\tself.on('move', function() {\n\t\t\t\t\trepositionPanel(this);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.on('postrender show', function(e) {\n\t\t\t\tif (e.control == self) {\n\t\t\t\t\tvar $modalBlockEl, prefix = self.classPrefix;\n\n\t\t\t\t\tif (self.modal && !hasModal) {\n\t\t\t\t\t\t$modalBlockEl = $('#' + prefix + 'modal-block', self.getContainerElm());\n\t\t\t\t\t\tif (!$modalBlockEl[0]) {\n\t\t\t\t\t\t\t$modalBlockEl = $(\n\t\t\t\t\t\t\t\t'<div id=\"' + prefix + 'modal-block\" class=\"' + prefix + 'reset ' + prefix + 'fade\"></div>'\n\t\t\t\t\t\t\t).appendTo(self.getContainerElm());\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tDelay.setTimeout(function() {\n\t\t\t\t\t\t\t$modalBlockEl.addClass(prefix + 'in');\n\t\t\t\t\t\t\t$(self.getEl()).addClass(prefix + 'in');\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\thasModal = true;\n\t\t\t\t\t}\n\n\t\t\t\t\taddRemove(true, self);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('show', function() {\n\t\t\t\tself.parents().each(function(ctrl) {\n\t\t\t\t\tif (ctrl.state.get('fixed')) {\n\t\t\t\t\t\tself.fixed(true);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif (settings.popover) {\n\t\t\t\tself._preBodyHtml = '<div class=\"' + self.classPrefix + 'arrow\"></div>';\n\t\t\t\tself.classes.add('popover').add('bottom').add(self.isRtl() ? 'end' : 'start');\n\t\t\t}\n\n\t\t\tself.aria('label', settings.ariaLabel);\n\t\t\tself.aria('labelledby', self._id);\n\t\t\tself.aria('describedby', self.describedBy || self._id + '-none');\n\t\t},\n\n\t\tfixed: function(state) {\n\t\t\tvar self = this;\n\n\t\t\tif (self.state.get('fixed') != state) {\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tvar viewport = DomUtils.getViewPort();\n\n\t\t\t\t\tif (state) {\n\t\t\t\t\t\tself.layoutRect().y -= viewport.y;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.layoutRect().y += viewport.y;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tself.classes.toggle('fixed', state);\n\t\t\t\tself.state.set('fixed', state);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Shows the current float panel.\n\t\t *\n\t\t * @method show\n\t\t * @return {tinymce.ui.FloatPanel} Current floatpanel instance.\n\t\t */\n\t\tshow: function() {\n\t\t\tvar self = this, i, state = self._super();\n\n\t\t\ti = visiblePanels.length;\n\t\t\twhile (i--) {\n\t\t\t\tif (visiblePanels[i] === self) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (i === -1) {\n\t\t\t\tvisiblePanels.push(self);\n\t\t\t}\n\n\t\t\treturn state;\n\t\t},\n\n\t\t/**\n\t\t * Hides the current float panel.\n\t\t *\n\t\t * @method hide\n\t\t * @return {tinymce.ui.FloatPanel} Current floatpanel instance.\n\t\t */\n\t\thide: function() {\n\t\t\tremoveVisiblePanel(this);\n\t\t\taddRemove(false, this);\n\n\t\t\treturn this._super();\n\t\t},\n\n\t\t/**\n\t\t * Hide all visible float panels with he autohide setting enabled. This is for\n\t\t * manually hiding floating menus or panels.\n\t\t *\n\t\t * @method hideAll\n\t\t */\n\t\thideAll: function() {\n\t\t\tFloatPanel.hideAll();\n\t\t},\n\n\t\t/**\n\t\t * Closes the float panel. This will remove the float panel from page and fire the close event.\n\t\t *\n\t\t * @method close\n\t\t */\n\t\tclose: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (!self.fire('close').isDefaultPrevented()) {\n\t\t\t\tself.remove();\n\t\t\t\taddRemove(false, self);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Removes the float panel from page.\n\t\t *\n\t\t * @method remove\n\t\t */\n\t\tremove: function() {\n\t\t\tremoveVisiblePanel(this);\n\t\t\tthis._super();\n\t\t},\n\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self.settings.bodyRole) {\n\t\t\t\tthis.getEl('body').setAttribute('role', self.settings.bodyRole);\n\t\t\t}\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n\n\t/**\n\t * Hide all visible float panels with he autohide setting enabled. This is for\n\t * manually hiding floating menus or panels.\n\t *\n\t * @static\n\t * @method hideAll\n\t */\n\tFloatPanel.hideAll = function() {\n\t\tvar i = visiblePanels.length;\n\n\t\twhile (i--) {\n\t\t\tvar panel = visiblePanels[i];\n\n\t\t\tif (panel && panel.settings.autohide) {\n\t\t\t\tpanel.hide();\n\t\t\t\tvisiblePanels.splice(i, 1);\n\t\t\t}\n\t\t}\n\t};\n\n\tfunction removeVisiblePanel(panel) {\n\t\tvar i;\n\n\t\ti = visiblePanels.length;\n\t\twhile (i--) {\n\t\t\tif (visiblePanels[i] === panel) {\n\t\t\t\tvisiblePanels.splice(i, 1);\n\t\t\t}\n\t\t}\n\n\t\ti = zOrder.length;\n\t\twhile (i--) {\n\t\t\tif (zOrder[i] === panel) {\n\t\t\t\tzOrder.splice(i, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn FloatPanel;\n});\n\n// Included from: js/tinymce/classes/ui/Window.js\n\n/**\n * Window.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new window.\n *\n * @-x-less Window.less\n * @class tinymce.ui.Window\n * @extends tinymce.ui.FloatPanel\n */\ndefine(\"tinymce/ui/Window\", [\n\t\"tinymce/ui/FloatPanel\",\n\t\"tinymce/ui/Panel\",\n\t\"tinymce/ui/DomUtils\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/ui/DragHelper\",\n\t\"tinymce/ui/BoxUtils\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Delay\"\n], function(FloatPanel, Panel, DomUtils, $, DragHelper, BoxUtils, Env, Delay) {\n\t\"use strict\";\n\n\tvar windows = [], oldMetaValue = '';\n\n\tfunction toggleFullScreenState(state) {\n\t\tvar noScaleMetaValue = 'width=device-width,initial-scale=1.0,user-scalable=0,minimum-scale=1.0,maximum-scale=1.0',\n\t\t\tviewport = $(\"meta[name=viewport]\")[0],\n\t\t\tcontentValue;\n\n\t\tif (Env.overrideViewPort === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!viewport) {\n\t\t\tviewport = document.createElement('meta');\n\t\t\tviewport.setAttribute('name', 'viewport');\n\t\t\tdocument.getElementsByTagName('head')[0].appendChild(viewport);\n\t\t}\n\n\t\tcontentValue = viewport.getAttribute('content');\n\t\tif (contentValue && typeof oldMetaValue != 'undefined') {\n\t\t\toldMetaValue = contentValue;\n\t\t}\n\n\t\tviewport.setAttribute('content', state ? noScaleMetaValue : oldMetaValue);\n\t}\n\n\tfunction toggleBodyFullScreenClasses(classPrefix, state) {\n\t\tif (checkFullscreenWindows() && state === false) {\n\t\t\t$([document.documentElement, document.body]).removeClass(classPrefix + 'fullscreen');\n\t\t}\n\t}\n\n\tfunction checkFullscreenWindows() {\n\t\tfor (var i = 0; i < windows.length; i++) {\n\t\t\tif (windows[i]._fullscreen) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tfunction handleWindowResize() {\n\t\tif (!Env.desktop) {\n\t\t\tvar lastSize = {\n\t\t\t\tw: window.innerWidth,\n\t\t\t\th: window.innerHeight\n\t\t\t};\n\n\t\t\tDelay.setInterval(function() {\n\t\t\t\tvar w = window.innerWidth,\n\t\t\t\t\th = window.innerHeight;\n\n\t\t\t\tif (lastSize.w != w || lastSize.h != h) {\n\t\t\t\t\tlastSize = {\n\t\t\t\t\t\tw: w,\n\t\t\t\t\t\th: h\n\t\t\t\t\t};\n\n\t\t\t\t\t$(window).trigger('resize');\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t}\n\n\t\tfunction reposition() {\n\t\t\tvar i, rect = DomUtils.getWindowSize(), layoutRect;\n\n\t\t\tfor (i = 0; i < windows.length; i++) {\n\t\t\t\tlayoutRect = windows[i].layoutRect();\n\n\t\t\t\twindows[i].moveTo(\n\t\t\t\t\twindows[i].settings.x || Math.max(0, rect.w / 2 - layoutRect.w / 2),\n\t\t\t\t\twindows[i].settings.y || Math.max(0, rect.h / 2 - layoutRect.h / 2)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t$(window).on('resize', reposition);\n\t}\n\n\tvar Window = FloatPanel.extend({\n\t\tmodal: true,\n\n\t\tDefaults: {\n\t\t\tborder: 1,\n\t\t\tlayout: 'flex',\n\t\t\tcontainerCls: 'panel',\n\t\t\trole: 'dialog',\n\t\t\tcallbacks: {\n\t\t\t\tsubmit: function() {\n\t\t\t\t\tthis.fire('submit', {data: this.toJSON()});\n\t\t\t\t},\n\n\t\t\t\tclose: function() {\n\t\t\t\t\tthis.close();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\n\t\t\tif (self.isRtl()) {\n\t\t\t\tself.classes.add('rtl');\n\t\t\t}\n\n\t\t\tself.classes.add('window');\n\t\t\tself.bodyClasses.add('window-body');\n\t\t\tself.state.set('fixed', true);\n\n\t\t\t// Create statusbar\n\t\t\tif (settings.buttons) {\n\t\t\t\tself.statusbar = new Panel({\n\t\t\t\t\tlayout: 'flex',\n\t\t\t\t\tborder: '1 0 0 0',\n\t\t\t\t\tspacing: 3,\n\t\t\t\t\tpadding: 10,\n\t\t\t\t\talign: 'center',\n\t\t\t\t\tpack: self.isRtl() ? 'start' : 'end',\n\t\t\t\t\tdefaults: {\n\t\t\t\t\t\ttype: 'button'\n\t\t\t\t\t},\n\t\t\t\t\titems: settings.buttons\n\t\t\t\t});\n\n\t\t\t\tself.statusbar.classes.add('foot');\n\t\t\t\tself.statusbar.parent(self);\n\t\t\t}\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tvar closeClass = self.classPrefix + 'close';\n\n\t\t\t\tif (DomUtils.hasClass(e.target, closeClass) || DomUtils.hasClass(e.target.parentNode, closeClass)) {\n\t\t\t\t\tself.close();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('cancel', function() {\n\t\t\t\tself.close();\n\t\t\t});\n\n\t\t\tself.aria('describedby', self.describedBy || self._id + '-none');\n\t\t\tself.aria('label', settings.title);\n\t\t\tself._fullscreen = false;\n\t\t},\n\n\t\t/**\n\t\t * Recalculates the positions of the controls in the current container.\n\t\t * This is invoked by the reflow method and shouldn't be called directly.\n\t\t *\n\t\t * @method recalc\n\t\t */\n\t\trecalc: function() {\n\t\t\tvar self = this, statusbar = self.statusbar, layoutRect, width, x, needsRecalc;\n\n\t\t\tif (self._fullscreen) {\n\t\t\t\tself.layoutRect(DomUtils.getWindowSize());\n\t\t\t\tself.layoutRect().contentH = self.layoutRect().innerH;\n\t\t\t}\n\n\t\t\tself._super();\n\n\t\t\tlayoutRect = self.layoutRect();\n\n\t\t\t// Resize window based on title width\n\t\t\tif (self.settings.title && !self._fullscreen) {\n\t\t\t\twidth = layoutRect.headerW;\n\t\t\t\tif (width > layoutRect.w) {\n\t\t\t\t\tx = layoutRect.x - Math.max(0, width / 2);\n\t\t\t\t\tself.layoutRect({w: width, x: x});\n\t\t\t\t\tneedsRecalc = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Resize window based on statusbar width\n\t\t\tif (statusbar) {\n\t\t\t\tstatusbar.layoutRect({w: self.layoutRect().innerW}).recalc();\n\n\t\t\t\twidth = statusbar.layoutRect().minW + layoutRect.deltaW;\n\t\t\t\tif (width > layoutRect.w) {\n\t\t\t\t\tx = layoutRect.x - Math.max(0, width - layoutRect.w);\n\t\t\t\t\tself.layoutRect({w: width, x: x});\n\t\t\t\t\tneedsRecalc = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Recalc body and disable auto resize\n\t\t\tif (needsRecalc) {\n\t\t\t\tself.recalc();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Initializes the current controls layout rect.\n\t\t * This will be executed by the layout managers to determine the\n\t\t * default minWidth/minHeight etc.\n\t\t *\n\t\t * @method initLayoutRect\n\t\t * @return {Object} Layout rect instance.\n\t\t */\n\t\tinitLayoutRect: function() {\n\t\t\tvar self = this, layoutRect = self._super(), deltaH = 0, headEl;\n\n\t\t\t// Reserve vertical space for title\n\t\t\tif (self.settings.title && !self._fullscreen) {\n\t\t\t\theadEl = self.getEl('head');\n\n\t\t\t\tvar size = DomUtils.getSize(headEl);\n\n\t\t\t\tlayoutRect.headerW = size.width;\n\t\t\t\tlayoutRect.headerH = size.height;\n\n\t\t\t\tdeltaH += layoutRect.headerH;\n\t\t\t}\n\n\t\t\t// Reserve vertical space for statusbar\n\t\t\tif (self.statusbar) {\n\t\t\t\tdeltaH += self.statusbar.layoutRect().h;\n\t\t\t}\n\n\t\t\tlayoutRect.deltaH += deltaH;\n\t\t\tlayoutRect.minH += deltaH;\n\t\t\t//layoutRect.innerH -= deltaH;\n\t\t\tlayoutRect.h += deltaH;\n\n\t\t\tvar rect = DomUtils.getWindowSize();\n\n\t\t\tlayoutRect.x = self.settings.x || Math.max(0, rect.w / 2 - layoutRect.w / 2);\n\t\t\tlayoutRect.y = self.settings.y || Math.max(0, rect.h / 2 - layoutRect.h / 2);\n\n\t\t\treturn layoutRect;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout, id = self._id, prefix = self.classPrefix;\n\t\t\tvar settings = self.settings, headerHtml = '', footerHtml = '', html = settings.html;\n\n\t\t\tself.preRender();\n\t\t\tlayout.preRender(self);\n\n\t\t\tif (settings.title) {\n\t\t\t\theaderHtml = (\n\t\t\t\t\t'<div id=\"' + id + '-head\" class=\"' + prefix + 'window-head\">' +\n\t\t\t\t\t\t'<div id=\"' + id + '-title\" class=\"' + prefix + 'title\">' + self.encode(settings.title) + '</div>' +\n\t\t\t\t\t\t'<div id=\"' + id + '-dragh\" class=\"' + prefix + 'dragh\"></div>' +\n\t\t\t\t\t\t'<button type=\"button\" class=\"' + prefix + 'close\" aria-hidden=\"true\">' +\n\t\t\t\t\t\t\t'<i class=\"mce-ico mce-i-remove\"></i>' +\n\t\t\t\t\t\t'</button>' +\n\t\t\t\t\t'</div>'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (settings.url) {\n\t\t\t\thtml = '<iframe src=\"' + settings.url + '\" tabindex=\"-1\"></iframe>';\n\t\t\t}\n\n\t\t\tif (typeof html == \"undefined\") {\n\t\t\t\thtml = layout.renderHtml(self);\n\t\t\t}\n\n\t\t\tif (self.statusbar) {\n\t\t\t\tfooterHtml = self.statusbar.renderHtml();\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" hidefocus=\"1\">' +\n\t\t\t\t\t'<div class=\"' + self.classPrefix + 'reset\" role=\"application\">' +\n\t\t\t\t\t\theaderHtml +\n\t\t\t\t\t\t'<div id=\"' + id + '-body\" class=\"' + self.bodyClasses + '\">' +\n\t\t\t\t\t\t\thtml +\n\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\tfooterHtml +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Switches the window fullscreen mode.\n\t\t *\n\t\t * @method fullscreen\n\t\t * @param {Boolean} state True/false state.\n\t\t * @return {tinymce.ui.Window} Current window instance.\n\t\t */\n\t\tfullscreen: function(state) {\n\t\t\tvar self = this, documentElement = document.documentElement, slowRendering, prefix = self.classPrefix, layoutRect;\n\n\t\t\tif (state != self._fullscreen) {\n\t\t\t\t$(window).on('resize', function() {\n\t\t\t\t\tvar time;\n\n\t\t\t\t\tif (self._fullscreen) {\n\t\t\t\t\t\t// Time the layout time if it's to slow use a timeout to not hog the CPU\n\t\t\t\t\t\tif (!slowRendering) {\n\t\t\t\t\t\t\ttime = new Date().getTime();\n\n\t\t\t\t\t\t\tvar rect = DomUtils.getWindowSize();\n\t\t\t\t\t\t\tself.moveTo(0, 0).resizeTo(rect.w, rect.h);\n\n\t\t\t\t\t\t\tif ((new Date().getTime()) - time > 50) {\n\t\t\t\t\t\t\t\tslowRendering = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (!self._timer) {\n\t\t\t\t\t\t\t\tself._timer = Delay.setTimeout(function() {\n\t\t\t\t\t\t\t\t\tvar rect = DomUtils.getWindowSize();\n\t\t\t\t\t\t\t\t\tself.moveTo(0, 0).resizeTo(rect.w, rect.h);\n\n\t\t\t\t\t\t\t\t\tself._timer = 0;\n\t\t\t\t\t\t\t\t}, 50);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tlayoutRect = self.layoutRect();\n\t\t\t\tself._fullscreen = state;\n\n\t\t\t\tif (!state) {\n\t\t\t\t\tself.borderBox = BoxUtils.parseBox(self.settings.border);\n\t\t\t\t\tself.getEl('head').style.display = '';\n\t\t\t\t\tlayoutRect.deltaH += layoutRect.headerH;\n\t\t\t\t\t$([documentElement, document.body]).removeClass(prefix + 'fullscreen');\n\t\t\t\t\tself.classes.remove('fullscreen');\n\t\t\t\t\tself.moveTo(self._initial.x, self._initial.y).resizeTo(self._initial.w, self._initial.h);\n\t\t\t\t} else {\n\t\t\t\t\tself._initial = {x: layoutRect.x, y: layoutRect.y, w: layoutRect.w, h: layoutRect.h};\n\n\t\t\t\t\tself.borderBox = BoxUtils.parseBox('0');\n\t\t\t\t\tself.getEl('head').style.display = 'none';\n\t\t\t\t\tlayoutRect.deltaH -= layoutRect.headerH + 2;\n\t\t\t\t\t$([documentElement, document.body]).addClass(prefix + 'fullscreen');\n\t\t\t\t\tself.classes.add('fullscreen');\n\n\t\t\t\t\tvar rect = DomUtils.getWindowSize();\n\t\t\t\t\tself.moveTo(0, 0).resizeTo(rect.w, rect.h);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self.reflow();\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, startPos;\n\n\t\t\tsetTimeout(function() {\n\t\t\t\tself.classes.add('in');\n\t\t\t\tself.fire('open');\n\t\t\t}, 0);\n\n\t\t\tself._super();\n\n\t\t\tif (self.statusbar) {\n\t\t\t\tself.statusbar.postRender();\n\t\t\t}\n\n\t\t\tself.focus();\n\n\t\t\tthis.dragHelper = new DragHelper(self._id + '-dragh', {\n\t\t\t\tstart: function() {\n\t\t\t\t\tstartPos = {\n\t\t\t\t\t\tx: self.layoutRect().x,\n\t\t\t\t\t\ty: self.layoutRect().y\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\tdrag: function(e) {\n\t\t\t\t\tself.moveTo(startPos.x + e.deltaX, startPos.y + e.deltaY);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('submit', function(e) {\n\t\t\t\tif (!e.isDefaultPrevented()) {\n\t\t\t\t\tself.close();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\twindows.push(self);\n\t\t\ttoggleFullScreenState(true);\n\t\t},\n\n\t\t/**\n\t\t * Fires a submit event with the serialized form.\n\t\t *\n\t\t * @method submit\n\t\t * @return {Object} Event arguments object.\n\t\t */\n\t\tsubmit: function() {\n\t\t\treturn this.fire('submit', {data: this.toJSON()});\n\t\t},\n\n\t\t/**\n\t\t * Removes the current control from DOM and from UI collections.\n\t\t *\n\t\t * @method remove\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tremove: function() {\n\t\t\tvar self = this, i;\n\n\t\t\tself.dragHelper.destroy();\n\t\t\tself._super();\n\n\t\t\tif (self.statusbar) {\n\t\t\t\tthis.statusbar.remove();\n\t\t\t}\n\n\t\t\ttoggleBodyFullScreenClasses(self.classPrefix, false);\n\n\t\t\ti = windows.length;\n\t\t\twhile (i--) {\n\t\t\t\tif (windows[i] === self) {\n\t\t\t\t\twindows.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttoggleFullScreenState(windows.length > 0);\n\t\t},\n\n\t\t/**\n\t\t * Returns the contentWindow object of the iframe if it exists.\n\t\t *\n\t\t * @method getContentWindow\n\t\t * @return {Window} window object or null.\n\t\t */\n\t\tgetContentWindow: function() {\n\t\t\tvar ifr = this.getEl().getElementsByTagName('iframe')[0];\n\t\t\treturn ifr ? ifr.contentWindow : null;\n\t\t}\n\t});\n\n\thandleWindowResize();\n\n\treturn Window;\n});\n\n// Included from: js/tinymce/classes/ui/MessageBox.js\n\n/**\n * MessageBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is used to create MessageBoxes like alerts/confirms etc.\n *\n * @class tinymce.ui.MessageBox\n * @extends tinymce.ui.FloatPanel\n */\ndefine(\"tinymce/ui/MessageBox\", [\n\t\"tinymce/ui/Window\"\n], function(Window) {\n\t\"use strict\";\n\n\tvar MessageBox = Window.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tsettings = {\n\t\t\t\tborder: 1,\n\t\t\t\tpadding: 20,\n\t\t\t\tlayout: 'flex',\n\t\t\t\tpack: \"center\",\n\t\t\t\talign: \"center\",\n\t\t\t\tcontainerCls: 'panel',\n\t\t\t\tautoScroll: true,\n\t\t\t\tbuttons: {type: \"button\", text: \"Ok\", action: \"ok\"},\n\t\t\t\titems: {\n\t\t\t\t\ttype: \"label\",\n\t\t\t\t\tmultiline: true,\n\t\t\t\t\tmaxWidth: 500,\n\t\t\t\t\tmaxHeight: 200\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._super(settings);\n\t\t},\n\n\t\tStatics: {\n\t\t\t/**\n\t\t\t * Ok buttons constant.\n\t\t\t *\n\t\t\t * @static\n\t\t\t * @final\n\t\t\t * @field {Number} OK\n\t\t\t */\n\t\t\tOK: 1,\n\n\t\t\t/**\n\t\t\t * Ok/cancel buttons constant.\n\t\t\t *\n\t\t\t * @static\n\t\t\t * @final\n\t\t\t * @field {Number} OK_CANCEL\n\t\t\t */\n\t\t\tOK_CANCEL: 2,\n\n\t\t\t/**\n\t\t\t * yes/no buttons constant.\n\t\t\t *\n\t\t\t * @static\n\t\t\t * @final\n\t\t\t * @field {Number} YES_NO\n\t\t\t */\n\t\t\tYES_NO: 3,\n\n\t\t\t/**\n\t\t\t * yes/no/cancel buttons constant.\n\t\t\t *\n\t\t\t * @static\n\t\t\t * @final\n\t\t\t * @field {Number} YES_NO_CANCEL\n\t\t\t */\n\t\t\tYES_NO_CANCEL: 4,\n\n\t\t\t/**\n\t\t\t * Constructs a new message box and renders it to the body element.\n\t\t\t *\n\t\t\t * @static\n\t\t\t * @method msgBox\n\t\t\t * @param {Object} settings Name/value object with settings.\n\t\t\t */\n\t\t\tmsgBox: function(settings) {\n\t\t\t\tvar buttons, callback = settings.callback || function() {};\n\n\t\t\t\tfunction createButton(text, status, primary) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: \"button\",\n\t\t\t\t\t\ttext: text,\n\t\t\t\t\t\tsubtype: primary ? 'primary' : '',\n\t\t\t\t\t\tonClick: function(e) {\n\t\t\t\t\t\t\te.control.parents()[1].close();\n\t\t\t\t\t\t\tcallback(status);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tswitch (settings.buttons) {\n\t\t\t\t\tcase MessageBox.OK_CANCEL:\n\t\t\t\t\t\tbuttons = [\n\t\t\t\t\t\t\tcreateButton('Ok', true, true),\n\t\t\t\t\t\t\tcreateButton('Cancel', false)\n\t\t\t\t\t\t];\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase MessageBox.YES_NO:\n\t\t\t\t\tcase MessageBox.YES_NO_CANCEL:\n\t\t\t\t\t\tbuttons = [\n\t\t\t\t\t\t\tcreateButton('Yes', 1, true),\n\t\t\t\t\t\t\tcreateButton('No', 0)\n\t\t\t\t\t\t];\n\n\t\t\t\t\t\tif (settings.buttons == MessageBox.YES_NO_CANCEL) {\n\t\t\t\t\t\t\tbuttons.push(createButton('Cancel', -1));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbuttons = [\n\t\t\t\t\t\t\tcreateButton('Ok', true, true)\n\t\t\t\t\t\t];\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\treturn new Window({\n\t\t\t\t\tpadding: 20,\n\t\t\t\t\tx: settings.x,\n\t\t\t\t\ty: settings.y,\n\t\t\t\t\tminWidth: 300,\n\t\t\t\t\tminHeight: 100,\n\t\t\t\t\tlayout: \"flex\",\n\t\t\t\t\tpack: \"center\",\n\t\t\t\t\talign: \"center\",\n\t\t\t\t\tbuttons: buttons,\n\t\t\t\t\ttitle: settings.title,\n\t\t\t\t\trole: 'alertdialog',\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: \"label\",\n\t\t\t\t\t\tmultiline: true,\n\t\t\t\t\t\tmaxWidth: 500,\n\t\t\t\t\t\tmaxHeight: 200,\n\t\t\t\t\t\ttext: settings.text\n\t\t\t\t\t},\n\t\t\t\t\tonPostRender: function() {\n\t\t\t\t\t\tthis.aria('describedby', this.items()[0]._id);\n\t\t\t\t\t},\n\t\t\t\t\tonClose: settings.onClose,\n\t\t\t\t\tonCancel: function() {\n\t\t\t\t\t\tcallback(false);\n\t\t\t\t\t}\n\t\t\t\t}).renderTo(document.body).reflow();\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Creates a new alert dialog.\n\t\t\t *\n\t\t\t * @method alert\n\t\t\t * @param {Object} settings Settings for the alert dialog.\n\t\t\t * @param {function} [callback] Callback to execute when the user makes a choice.\n\t\t\t */\n\t\t\talert: function(settings, callback) {\n\t\t\t\tif (typeof settings == \"string\") {\n\t\t\t\t\tsettings = {text: settings};\n\t\t\t\t}\n\n\t\t\t\tsettings.callback = callback;\n\t\t\t\treturn MessageBox.msgBox(settings);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Creates a new confirm dialog.\n\t\t\t *\n\t\t\t * @method confirm\n\t\t\t * @param {Object} settings Settings for the confirm dialog.\n\t\t\t * @param {function} [callback] Callback to execute when the user makes a choice.\n\t\t\t */\n\t\t\tconfirm: function(settings, callback) {\n\t\t\t\tif (typeof settings == \"string\") {\n\t\t\t\t\tsettings = {text: settings};\n\t\t\t\t}\n\n\t\t\t\tsettings.callback = callback;\n\t\t\t\tsettings.buttons = MessageBox.OK_CANCEL;\n\n\t\t\t\treturn MessageBox.msgBox(settings);\n\t\t\t}\n\t\t}\n\t});\n\n\treturn MessageBox;\n});\n\n// Included from: js/tinymce/classes/WindowManager.js\n\n/**\n * WindowManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles the creation of native windows and dialogs. This class can be extended to provide for example inline dialogs.\n *\n * @class tinymce.WindowManager\n * @example\n * // Opens a new dialog with the file.htm file and the size 320x240\n * // It also adds a custom parameter this can be retrieved by using tinyMCEPopup.getWindowArg inside the dialog.\n * tinymce.activeEditor.windowManager.open({\n *    url: 'file.htm',\n *    width: 320,\n *    height: 240\n * }, {\n *    custom_param: 1\n * });\n *\n * // Displays an alert box using the active editors window manager instance\n * tinymce.activeEditor.windowManager.alert('Hello world!');\n *\n * // Displays an confirm box and an alert message will be displayed depending on what you choose in the confirm\n * tinymce.activeEditor.windowManager.confirm(\"Do you want to do something\", function(s) {\n *    if (s)\n *       tinymce.activeEditor.windowManager.alert(\"Ok\");\n *    else\n *       tinymce.activeEditor.windowManager.alert(\"Cancel\");\n * });\n */\ndefine(\"tinymce/WindowManager\", [\n\t\"tinymce/ui/Window\",\n\t\"tinymce/ui/MessageBox\"\n], function(Window, MessageBox) {\n\treturn function(editor) {\n\t\tvar self = this, windows = [];\n\n\t\tfunction getTopMostWindow() {\n\t\t\tif (windows.length) {\n\t\t\t\treturn windows[windows.length - 1];\n\t\t\t}\n\t\t}\n\n\t\tfunction fireOpenEvent(win) {\n\t\t\teditor.fire('OpenWindow', {\n\t\t\t\twin: win\n\t\t\t});\n\t\t}\n\n\t\tfunction fireCloseEvent(win) {\n\t\t\teditor.fire('CloseWindow', {\n\t\t\t\twin: win\n\t\t\t});\n\t\t}\n\n\t\tself.windows = windows;\n\n\t\teditor.on('remove', function() {\n\t\t\tvar i = windows.length;\n\n\t\t\twhile (i--) {\n\t\t\t\twindows[i].close();\n\t\t\t}\n\t\t});\n\n\t\t/**\n\t\t * Opens a new window.\n\t\t *\n\t\t * @method open\n\t\t * @param {Object} args Optional name/value settings collection contains things like width/height/url etc.\n\t\t * @param {Object} params Options like title, file, width, height etc.\n\t\t * @option {String} title Window title.\n\t\t * @option {String} file URL of the file to open in the window.\n\t\t * @option {Number} width Width in pixels.\n\t\t * @option {Number} height Height in pixels.\n\t\t * @option {Boolean} autoScroll Specifies whether the popup window can have scrollbars if required (i.e. content\n\t\t * larger than the popup size specified).\n\t\t */\n\t\tself.open = function(args, params) {\n\t\t\tvar win;\n\n\t\t\teditor.editorManager.setActive(editor);\n\n\t\t\targs.title = args.title || ' ';\n\n\t\t\t// Handle URL\n\t\t\targs.url = args.url || args.file; // Legacy\n\t\t\tif (args.url) {\n\t\t\t\targs.width = parseInt(args.width || 320, 10);\n\t\t\t\targs.height = parseInt(args.height || 240, 10);\n\t\t\t}\n\n\t\t\t// Handle body\n\t\t\tif (args.body) {\n\t\t\t\targs.items = {\n\t\t\t\t\tdefaults: args.defaults,\n\t\t\t\t\ttype: args.bodyType || 'form',\n\t\t\t\t\titems: args.body,\n\t\t\t\t\tdata: args.data,\n\t\t\t\t\tcallbacks: args.commands\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!args.url && !args.buttons) {\n\t\t\t\targs.buttons = [\n\t\t\t\t\t{text: 'Ok', subtype: 'primary', onclick: function() {\n\t\t\t\t\t\twin.find('form')[0].submit();\n\t\t\t\t\t}},\n\n\t\t\t\t\t{text: 'Cancel', onclick: function() {\n\t\t\t\t\t\twin.close();\n\t\t\t\t\t}}\n\t\t\t\t];\n\t\t\t}\n\n\t\t\twin = new Window(args);\n\t\t\twindows.push(win);\n\n\t\t\twin.on('close', function() {\n\t\t\t\tvar i = windows.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tif (windows[i] === win) {\n\t\t\t\t\t\twindows.splice(i, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!windows.length) {\n\t\t\t\t\teditor.focus();\n\t\t\t\t}\n\n\t\t\t\tfireCloseEvent(win);\n\t\t\t});\n\n\t\t\t// Handle data\n\t\t\tif (args.data) {\n\t\t\t\twin.on('postRender', function() {\n\t\t\t\t\tthis.find('*').each(function(ctrl) {\n\t\t\t\t\t\tvar name = ctrl.name();\n\n\t\t\t\t\t\tif (name in args.data) {\n\t\t\t\t\t\t\tctrl.value(args.data[name]);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// store args and parameters\n\t\t\twin.features = args || {};\n\t\t\twin.params = params || {};\n\n\t\t\t// Takes a snapshot in the FocusManager of the selection before focus is lost to dialog\n\t\t\tif (windows.length === 1) {\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\n\t\t\twin = win.renderTo().reflow();\n\n\t\t\tfireOpenEvent(win);\n\n\t\t\treturn win;\n\t\t};\n\n\t\t/**\n\t\t * Creates a alert dialog. Please don't use the blocking behavior of this\n\t\t * native version use the callback method instead then it can be extended.\n\t\t *\n\t\t * @method alert\n\t\t * @param {String} message Text to display in the new alert dialog.\n\t\t * @param {function} callback Callback function to be executed after the user has selected ok.\n\t\t * @param {Object} scope Optional scope to execute the callback in.\n\t\t * @example\n\t\t * // Displays an alert box using the active editors window manager instance\n\t\t * tinymce.activeEditor.windowManager.alert('Hello world!');\n\t\t */\n\t\tself.alert = function(message, callback, scope) {\n\t\t\tvar win;\n\n\t\t\twin = MessageBox.alert(message, function() {\n\t\t\t\tif (callback) {\n\t\t\t\t\tcallback.call(scope || this);\n\t\t\t\t} else {\n\t\t\t\t\teditor.focus();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\twin.on('close', function() {\n\t\t\t\tfireCloseEvent(win);\n\t\t\t});\n\n\t\t\tfireOpenEvent(win);\n\t\t};\n\n\t\t/**\n\t\t * Creates a confirm dialog. Please don't use the blocking behavior of this\n\t\t * native version use the callback method instead then it can be extended.\n\t\t *\n\t\t * @method confirm\n\t\t * @param {String} message Text to display in the new confirm dialog.\n\t\t * @param {function} callback Callback function to be executed after the user has selected ok or cancel.\n\t\t * @param {Object} scope Optional scope to execute the callback in.\n\t\t * @example\n\t\t * // Displays an confirm box and an alert message will be displayed depending on what you choose in the confirm\n\t\t * tinymce.activeEditor.windowManager.confirm(\"Do you want to do something\", function(s) {\n\t\t *    if (s)\n\t\t *       tinymce.activeEditor.windowManager.alert(\"Ok\");\n\t\t *    else\n\t\t *       tinymce.activeEditor.windowManager.alert(\"Cancel\");\n\t\t * });\n\t\t */\n\t\tself.confirm = function(message, callback, scope) {\n\t\t\tvar win;\n\n\t\t\twin = MessageBox.confirm(message, function(state) {\n\t\t\t\tcallback.call(scope || this, state);\n\t\t\t});\n\n\t\t\twin.on('close', function() {\n\t\t\t\tfireCloseEvent(win);\n\t\t\t});\n\n\t\t\tfireOpenEvent(win);\n\t\t};\n\n\t\t/**\n\t\t * Closes the top most window.\n\t\t *\n\t\t * @method close\n\t\t */\n\t\tself.close = function() {\n\t\t\tif (getTopMostWindow()) {\n\t\t\t\tgetTopMostWindow().close();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Returns the params of the last window open call. This can be used in iframe based\n\t\t * dialog to get params passed from the tinymce plugin.\n\t\t *\n\t\t * @example\n\t\t * var dialogArguments = top.tinymce.activeEditor.windowManager.getParams();\n\t\t *\n\t\t * @method getParams\n\t\t * @return {Object} Name/value object with parameters passed from windowManager.open call.\n\t\t */\n\t\tself.getParams = function() {\n\t\t\treturn getTopMostWindow() ? getTopMostWindow().params : null;\n\t\t};\n\n\t\t/**\n\t\t * Sets the params of the last opened window.\n\t\t *\n\t\t * @method setParams\n\t\t * @param {Object} params Params object to set for the last opened window.\n\t\t */\n\t\tself.setParams = function(params) {\n\t\t\tif (getTopMostWindow()) {\n\t\t\t\tgetTopMostWindow().params = params;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Returns the currently opened window objects.\n\t\t *\n\t\t * @method getWindows\n\t\t * @return {Array} Array of the currently opened windows.\n\t\t */\n\t\tself.getWindows = function() {\n\t\t\treturn windows;\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Tooltip.js\n\n/**\n * Tooltip.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a tooltip instance.\n *\n * @-x-less ToolTip.less\n * @class tinymce.ui.ToolTip\n * @extends tinymce.ui.Control\n * @mixes tinymce.ui.Movable\n */\ndefine(\"tinymce/ui/Tooltip\", [\n\t\"tinymce/ui/Control\",\n\t\"tinymce/ui/Movable\"\n], function(Control, Movable) {\n\treturn Control.extend({\n\t\tMixins: [Movable],\n\n\t\tDefaults: {\n\t\t\tclasses: 'widget tooltip tooltip-n'\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, prefix = self.classPrefix;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\" role=\"presentation\">' +\n\t\t\t\t\t'<div class=\"' + prefix + 'tooltip-arrow\"></div>' +\n\t\t\t\t\t'<div class=\"' + prefix + 'tooltip-inner\">' + self.encode(self.state.get('text')) + '</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:text', function(e) {\n\t\t\t\tself.getEl().lastChild.innerHTML = self.encode(e.value);\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this, style, rect;\n\n\t\t\tstyle = self.getEl().style;\n\t\t\trect = self._layoutRect;\n\n\t\t\tstyle.left = rect.x + 'px';\n\t\t\tstyle.top = rect.y + 'px';\n\t\t\tstyle.zIndex = 0xFFFF + 0xFFFF;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Widget.js\n\n/**\n * Widget.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Widget base class a widget is a control that has a tooltip and some basic states.\n *\n * @class tinymce.ui.Widget\n * @extends tinymce.ui.Control\n */\ndefine(\"tinymce/ui/Widget\", [\n\t\"tinymce/ui/Control\",\n\t\"tinymce/ui/Tooltip\"\n], function(Control, Tooltip) {\n\t\"use strict\";\n\n\tvar tooltip;\n\n\tvar Widget = Control.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {String} tooltip Tooltip text to display when hovering.\n\t\t * @setting {Boolean} autofocus True if the control should be focused when rendered.\n\t\t * @setting {String} text Text to display inside widget.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tsettings = self.settings;\n\t\t\tself.canFocus = true;\n\n\t\t\tif (settings.tooltip && Widget.tooltips !== false) {\n\t\t\t\tself.on('mouseenter', function(e) {\n\t\t\t\t\tvar tooltip = self.tooltip().moveTo(-0xFFFF);\n\n\t\t\t\t\tif (e.control == self) {\n\t\t\t\t\t\tvar rel = tooltip.text(settings.tooltip).show().testMoveRel(self.getEl(), ['bc-tc', 'bc-tl', 'bc-tr']);\n\n\t\t\t\t\t\ttooltip.classes.toggle('tooltip-n', rel == 'bc-tc');\n\t\t\t\t\t\ttooltip.classes.toggle('tooltip-nw', rel == 'bc-tl');\n\t\t\t\t\t\ttooltip.classes.toggle('tooltip-ne', rel == 'bc-tr');\n\n\t\t\t\t\t\ttooltip.moveRel(self.getEl(), rel);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttooltip.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.on('mouseleave mousedown click', function() {\n\t\t\t\t\tself.tooltip().hide();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.aria('label', settings.ariaLabel || settings.tooltip);\n\t\t},\n\n\t\t/**\n\t\t * Returns the current tooltip instance.\n\t\t *\n\t\t * @method tooltip\n\t\t * @return {tinymce.ui.Tooltip} Tooltip instance.\n\t\t */\n\t\ttooltip: function() {\n\t\t\tif (!tooltip) {\n\t\t\t\ttooltip = new Tooltip({type: 'tooltip'});\n\t\t\t\ttooltip.renderTo();\n\t\t\t}\n\n\t\t\treturn tooltip;\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, settings = self.settings;\n\n\t\t\tself._super();\n\n\t\t\tif (!self.parent() && (settings.width || settings.height)) {\n\t\t\t\tself.initLayoutRect();\n\t\t\t\tself.repaint();\n\t\t\t}\n\n\t\t\tif (settings.autofocus) {\n\t\t\t\tself.focus();\n\t\t\t}\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tfunction disable(state) {\n\t\t\t\tself.aria('disabled', state);\n\t\t\t\tself.classes.toggle('disabled', state);\n\t\t\t}\n\n\t\t\tfunction active(state) {\n\t\t\t\tself.aria('pressed', state);\n\t\t\t\tself.classes.toggle('active', state);\n\t\t\t}\n\n\t\t\tself.state.on('change:disabled', function(e) {\n\t\t\t\tdisable(e.value);\n\t\t\t});\n\n\t\t\tself.state.on('change:active', function(e) {\n\t\t\t\tactive(e.value);\n\t\t\t});\n\n\t\t\tif (self.state.get('disabled')) {\n\t\t\t\tdisable(true);\n\t\t\t}\n\n\t\t\tif (self.state.get('active')) {\n\t\t\t\tactive(true);\n\t\t\t}\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\t/**\n\t\t * Removes the current control from DOM and from UI collections.\n\t\t *\n\t\t * @method remove\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tremove: function() {\n\t\t\tthis._super();\n\n\t\t\tif (tooltip) {\n\t\t\t\ttooltip.remove();\n\t\t\t\ttooltip = null;\n\t\t\t}\n\t\t}\n\t});\n\n\treturn Widget;\n});\n\n// Included from: js/tinymce/classes/ui/Progress.js\n\n/**\n * Progress.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Progress control.\n *\n * @-x-less Progress.less\n * @class tinymce.ui.Progress\n * @extends tinymce.ui.Control\n */\ndefine(\"tinymce/ui/Progress\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\tDefaults: {\n\t\t\tvalue: 0\n\t\t},\n\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('progress');\n\n\t\t\tif (!self.settings.filter) {\n\t\t\t\tself.settings.filter = function(value) {\n\t\t\t\t\treturn Math.round(value);\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = this.classPrefix;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<div class=\"' + prefix + 'bar-container\">' +\n\t\t\t\t\t\t'<div class=\"' + prefix + 'bar\"></div>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t\t'<div class=\"' + prefix + 'text\">0%</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself._super();\n\t\t\tself.value(self.settings.value);\n\n\t\t\treturn self;\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tfunction setValue(value) {\n\t\t\t\tvalue = self.settings.filter(value);\n\t\t\t\tself.getEl().lastChild.innerHTML = value + '%';\n\t\t\t\tself.getEl().firstChild.firstChild.style.width = value + '%';\n\t\t\t}\n\n\t\t\tself.state.on('change:value', function(e) {\n\t\t\t\tsetValue(e.value);\n\t\t\t});\n\n\t\t\tsetValue(self.state.get('value'));\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Notification.js\n\n/**\n * Notification.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a notification instance.\n *\n * @-x-less Notification.less\n * @class tinymce.ui.Notification\n * @extends tinymce.ui.Container\n * @mixes tinymce.ui.Movable\n */\ndefine(\"tinymce/ui/Notification\", [\n\t\"tinymce/ui/Control\",\n\t\"tinymce/ui/Movable\",\n\t\"tinymce/ui/Progress\",\n\t\"tinymce/util/Delay\"\n], function(Control, Movable, Progress, Delay) {\n\treturn Control.extend({\n\t\tMixins: [Movable],\n\n\t\tDefaults: {\n\t\t\tclasses: 'widget notification'\n\t\t},\n\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\n\t\t\tif (settings.text) {\n\t\t\t\tself.text(settings.text);\n\t\t\t}\n\n\t\t\tif (settings.icon) {\n\t\t\t\tself.icon = settings.icon;\n\t\t\t}\n\n\t\t\tif (settings.color) {\n\t\t\t\tself.color = settings.color;\n\t\t\t}\n\n\t\t\tif (settings.type) {\n\t\t\t\tself.classes.add('notification-' + settings.type);\n\t\t\t}\n\n\t\t\tif (settings.timeout && (settings.timeout < 0 || settings.timeout > 0) && !settings.closeButton) {\n\t\t\t\tself.closeButton = false;\n\t\t\t} else {\n\t\t\t\tself.classes.add('has-close');\n\t\t\t\tself.closeButton = true;\n\t\t\t}\n\n\t\t\tif (settings.progressBar) {\n\t\t\t\tself.progressBar = new Progress();\n\t\t\t}\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tif (e.target.className.indexOf(self.classPrefix + 'close') != -1) {\n\t\t\t\t\tself.close();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, prefix = self.classPrefix, icon = '', closeButton = '', progressBar = '', notificationStyle = '';\n\n\t\t\tif (self.icon) {\n\t\t\t\ticon = '<i class=\"' + prefix + 'ico' + ' ' + prefix + 'i-' + self.icon + '\"></i>';\n\t\t\t}\n\n\t\t\tif (self.color) {\n\t\t\t\tnotificationStyle = ' style=\"background-color: ' + self.color + '\"';\n\t\t\t}\n\n\t\t\tif (self.closeButton) {\n\t\t\t\tcloseButton = '<button type=\"button\" class=\"' + prefix + 'close\" aria-hidden=\"true\">\\u00d7</button>';\n\t\t\t}\n\n\t\t\tif (self.progressBar) {\n\t\t\t\tprogressBar = self.progressBar.renderHtml();\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\"' + notificationStyle + ' role=\"presentation\">' +\n\t\t\t\t\ticon +\n\t\t\t\t\t'<div class=\"' + prefix + 'notification-inner\">' + self.state.get('text') + '</div>' +\n\t\t\t\t\tprogressBar +\n\t\t\t\t\tcloseButton +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tDelay.setTimeout(function() {\n\t\t\t\tself.$el.addClass(self.classPrefix + 'in');\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:text', function(e) {\n\t\t\t\tself.getEl().childNodes[1].innerHTML = e.value;\n\t\t\t});\n\t\t\tif (self.progressBar) {\n\t\t\t\tself.progressBar.bindStates();\n\t\t\t}\n\t\t\treturn self._super();\n\t\t},\n\n\t\tclose: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (!self.fire('close').isDefaultPrevented()) {\n\t\t\t\tself.remove();\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this, style, rect;\n\n\t\t\tstyle = self.getEl().style;\n\t\t\trect = self._layoutRect;\n\n\t\t\tstyle.left = rect.x + 'px';\n\t\t\tstyle.top = rect.y + 'px';\n\n\t\t\t// Hardcoded arbitrary z-value because we want the\n\t\t\t// notifications under the other windows\n\t\t\tstyle.zIndex = 0xFFFF - 1;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/NotificationManager.js\n\n/**\n * NotificationManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles the creation of TinyMCE's notifications.\n *\n * @class tinymce.notificationManager\n * @example\n * // Opens a new notification of type \"error\" with text \"An error occurred.\"\n * tinymce.activeEditor.notificationManager.open({\n *    text: 'An error occurred.',\n *    type: 'error'\n * });\n */\ndefine(\"tinymce/NotificationManager\", [\n\t\"tinymce/ui/Notification\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/util/Tools\"\n], function(Notification, Delay, Tools) {\n\treturn function(editor) {\n\t\tvar self = this, notifications = [];\n\n\t\tfunction getLastNotification() {\n\t\t\tif (notifications.length) {\n\t\t\t\treturn notifications[notifications.length - 1];\n\t\t\t}\n\t\t}\n\n\t\tself.notifications = notifications;\n\n\t\tfunction resizeWindowEvent() {\n\t\t\tDelay.requestAnimationFrame(function() {\n\t\t\t\tprePositionNotifications();\n\t\t\t\tpositionNotifications();\n\t\t\t});\n\t\t}\n\n\t\t// Since the viewport will change based on the present notifications, we need to move them all to the\n\t\t// top left of the viewport to give an accurate size measurement so we can position them later.\n\t\tfunction prePositionNotifications() {\n\t\t\tfor (var i = 0; i < notifications.length; i++) {\n\t\t\t\tnotifications[i].moveTo(0, 0);\n\t\t\t}\n\t\t}\n\n\t\tfunction positionNotifications() {\n\t\t\tif (notifications.length > 0) {\n\t\t\t\tvar firstItem = notifications.slice(0, 1)[0];\n\t\t\t\tvar container = editor.inline ? editor.getElement() : editor.getContentAreaContainer();\n\t\t\t\tfirstItem.moveRel(container, 'tc-tc');\n\t\t\t\tif (notifications.length > 1) {\n\t\t\t\t\tfor (var i = 1; i < notifications.length; i++) {\n\t\t\t\t\t\tnotifications[i].moveRel(notifications[i - 1].getEl(), 'bc-tc');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\teditor.on('remove', function() {\n\t\t\tvar i = notifications.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tnotifications[i].close();\n\t\t\t}\n\t\t});\n\n\t\teditor.on('ResizeEditor', positionNotifications);\n\t\teditor.on('ResizeWindow', resizeWindowEvent);\n\n\t\t/**\n\t\t * Opens a new notification.\n\t\t *\n\t\t * @method open\n\t\t * @param {Object} args Optional name/value settings collection contains things like timeout/color/message etc.\n\t\t */\n\t\tself.open = function(args) {\n\t\t\t// Never open notification if editor has been removed.\n\t\t\tif (editor.removed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar notif;\n\n\t\t\teditor.editorManager.setActive(editor);\n\n\t\t\tvar duplicate = findDuplicateMessage(notifications, args);\n\n\t\t\tif (duplicate === null) {\n\t\t\t\tnotif = new Notification(args);\n\t\t\t\tnotifications.push(notif);\n\n\t\t\t\t//If we have a timeout value\n\t\t\t\tif (args.timeout > 0) {\n\t\t\t\t\t\tnotif.timer = setTimeout(function() {\n\t\t\t\t\t\t\tnotif.close();\n\t\t\t\t\t\t}, args.timeout);\n\t\t\t\t}\n\n\t\t\t\tnotif.on('close', function() {\n\t\t\t\t\tvar i = notifications.length;\n\n\t\t\t\t\tif (notif.timer) {\n\t\t\t\t\t\teditor.getWin().clearTimeout(notif.timer);\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (notifications[i] === notif) {\n\t\t\t\t\t\t\tnotifications.splice(i, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tpositionNotifications();\n\t\t\t\t});\n\n\t\t\t\tnotif.renderTo();\n\n\t\t\t\tpositionNotifications();\n\t\t\t} else {\n\t\t\t\tnotif = duplicate;\n\t\t\t}\n\n\t\t\treturn notif;\n\t\t};\n\n\t\t/**\n\t\t * Closes the top most notification.\n\t\t *\n\t\t * @method close\n\t\t */\n\t\tself.close = function() {\n\t\t\tif (getLastNotification()) {\n\t\t\t\tgetLastNotification().close();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Returns the currently opened notification objects.\n\t\t *\n\t\t * @method getNotifications\n\t\t * @return {Array} Array of the currently opened notifications.\n\t\t */\n\t\tself.getNotifications = function() {\n\t\t\treturn notifications;\n\t\t};\n\n\t\teditor.on('SkinLoaded', function() {\n\t\t\tvar serviceMessage = editor.settings.service_message;\n\n\t\t\tif (serviceMessage) {\n\t\t\t\teditor.notificationManager.open({\n\t\t\t\t\ttext: serviceMessage,\n\t\t\t\t\ttype: 'warning',\n\t\t\t\t\ttimeout: 0,\n\t\t\t\t\ticon: ''\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t/**\n\t\t * Finds any existing notification with the same properties as the new one.\n\t\t * Returns either the found notification or null.\n\t\t *\n\t\t * @param {Notification[]} notificationArray - Array of current notifications\n\t\t * @param {type: string, } newNotification - New notification object\n\t\t * @returns {?Notification}\n\t\t */\n\t\tfunction findDuplicateMessage(notificationArray, newNotification) {\n\t\t\tif (!isPlainTextNotification(newNotification)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tvar filteredNotifications = Tools.grep(notificationArray, function (notification) {\n\t\t\t\treturn isSameNotification(newNotification, notification);\n\t\t\t});\n\n\t\t\treturn filteredNotifications.length === 0 ? null : filteredNotifications[0];\n\t\t}\n\n\t\t/**\n\t\t * Checks if the passed in args object has the same\n\t\t * type and text properties as the sent in notification.\n\t\t *\n\t\t * @param {type: string, text: string} a - New notification args object\n\t\t * @param {Notification} b - Old notification\n\t\t * @returns {boolean}\n\t\t */\n\t\tfunction isSameNotification(a, b) {\n\t\t\treturn a.type === b.settings.type && a.text === b.settings.text;\n\t\t}\n\n\t\t/**\n\t\t * Checks that the notification does not have a progressBar\n\t\t * or timeour property.\n\t\t *\n\t\t * @param {Notification} notification - Notification to check\n\t\t * @returns {boolean}\n\t\t */\n\t\tfunction isPlainTextNotification(notification) {\n\t\t\treturn !notification.progressBar && !notification.timeout;\n\t\t}\n\n\t\t//self.positionNotifications = positionNotifications;\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/NodePath.js\n\n/**\n * NodePath.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Handles paths of nodes within an element.\n *\n * @private\n * @class tinymce.dom.NodePath\n */\ndefine(\"tinymce/dom/NodePath\", [\n\t\"tinymce/dom/DOMUtils\"\n], function(DOMUtils) {\n\tfunction create(rootNode, targetNode, normalized) {\n\t\tvar path = [];\n\n\t\tfor (; targetNode && targetNode != rootNode; targetNode = targetNode.parentNode) {\n\t\t\tpath.push(DOMUtils.nodeIndex(targetNode, normalized));\n\t\t}\n\n\t\treturn path;\n\t}\n\n\tfunction resolve(rootNode, path) {\n\t\tvar i, node, children;\n\n\t\tfor (node = rootNode, i = path.length - 1; i >= 0; i--) {\n\t\t\tchildren = node.childNodes;\n\n\t\t\tif (path[i] > children.length - 1) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tnode = children[path[i]];\n\t\t}\n\n\t\treturn node;\n\t}\n\n\treturn {\n\t\tcreate: create,\n\t\tresolve: resolve\n\t};\n});\n\n// Included from: js/tinymce/classes/util/Quirks.js\n\n/**\n * Quirks.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n *\n * @ignore-file\n */\n\n/**\n * This file includes fixes for various browser quirks it's made to make it easy to add/remove browser specific fixes.\n *\n * @private\n * @class tinymce.util.Quirks\n */\ndefine(\"tinymce/util/Quirks\", [\n\t\"tinymce/util/VK\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/NodePath\",\n\t\"tinymce/html/Node\",\n\t\"tinymce/html/Entities\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/caret/CaretContainer\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/caret/CaretWalker\"\n], function(VK, RangeUtils, TreeWalker, NodePath, Node, Entities, Env, Tools, Delay, CaretContainer, CaretPosition, CaretWalker) {\n\treturn function(editor) {\n\t\tvar each = Tools.each, $ = editor.$;\n\t\tvar BACKSPACE = VK.BACKSPACE, DELETE = VK.DELETE, dom = editor.dom, selection = editor.selection,\n\t\t\tsettings = editor.settings, parser = editor.parser, serializer = editor.serializer;\n\t\tvar isGecko = Env.gecko, isIE = Env.ie, isWebKit = Env.webkit;\n\t\tvar mceInternalUrlPrefix = 'data:text/mce-internal,';\n\t\tvar mceInternalDataType = isIE ? 'Text' : 'URL';\n\n\t\t/**\n\t\t * Executes a command with a specific state this can be to enable/disable browser editing features.\n\t\t */\n\t\tfunction setEditorCommandState(cmd, state) {\n\t\t\ttry {\n\t\t\t\teditor.getDoc().execCommand(cmd, false, state);\n\t\t\t} catch (ex) {\n\t\t\t\t// Ignore\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Returns current IE document mode.\n\t\t */\n\t\tfunction getDocumentMode() {\n\t\t\tvar documentMode = editor.getDoc().documentMode;\n\n\t\t\treturn documentMode ? documentMode : 6;\n\t\t}\n\n\t\t/**\n\t\t * Returns true/false if the event is prevented or not.\n\t\t *\n\t\t * @private\n\t\t * @param {Event} e Event object.\n\t\t * @return {Boolean} true/false if the event is prevented or not.\n\t\t */\n\t\tfunction isDefaultPrevented(e) {\n\t\t\treturn e.isDefaultPrevented();\n\t\t}\n\n\t\t/**\n\t\t * Sets Text/URL data on the event's dataTransfer object to a special data:text/mce-internal url.\n\t\t * This is to workaround the inability to set custom contentType on IE and Safari.\n\t\t * The editor's selected content is encoded into this url so drag and drop between editors will work.\n\t\t *\n\t\t * @private\n\t\t * @param {DragEvent} e Event object\n\t\t */\n\t\tfunction setMceInternalContent(e) {\n\t\t\tvar selectionHtml, internalContent;\n\n\t\t\tif (e.dataTransfer) {\n\t\t\t\tif (editor.selection.isCollapsed() && e.target.tagName == 'IMG') {\n\t\t\t\t\tselection.select(e.target);\n\t\t\t\t}\n\n\t\t\t\tselectionHtml = editor.selection.getContent();\n\n\t\t\t\t// Safari/IE doesn't support custom dataTransfer items so we can only use URL and Text\n\t\t\t\tif (selectionHtml.length > 0) {\n\t\t\t\t\tinternalContent = mceInternalUrlPrefix + escape(editor.id) + ',' + escape(selectionHtml);\n\t\t\t\t\te.dataTransfer.setData(mceInternalDataType, internalContent);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Gets content of special data:text/mce-internal url on the event's dataTransfer object.\n\t\t * This is to workaround the inability to set custom contentType on IE and Safari.\n\t\t * The editor's selected content is encoded into this url so drag and drop between editors will work.\n\t\t *\n\t\t * @private\n\t\t * @param {DragEvent} e Event object\n\t\t * @returns {String} mce-internal content\n\t\t */\n\t\tfunction getMceInternalContent(e) {\n\t\t\tvar internalContent;\n\n\t\t\tif (e.dataTransfer) {\n\t\t\t\tinternalContent = e.dataTransfer.getData(mceInternalDataType);\n\n\t\t\t\tif (internalContent && internalContent.indexOf(mceInternalUrlPrefix) >= 0) {\n\t\t\t\t\tinternalContent = internalContent.substr(mceInternalUrlPrefix.length).split(',');\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: unescape(internalContent[0]),\n\t\t\t\t\t\thtml: unescape(internalContent[1])\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\t/**\n\t\t * Inserts contents using the paste clipboard command if it's available if it isn't it will fallback\n\t\t * to the core command.\n\t\t *\n\t\t * @private\n\t\t * @param {String} content Content to insert at selection.\n\t\t */\n\t\tfunction insertClipboardContents(content) {\n\t\t\tif (editor.queryCommandSupported('mceInsertClipboardContent')) {\n\t\t\t\teditor.execCommand('mceInsertClipboardContent', false, {content: content});\n\t\t\t} else {\n\t\t\t\teditor.execCommand('mceInsertContent', false, content);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Fixes a WebKit bug when deleting contents using backspace or delete key.\n\t\t * WebKit will produce a span element if you delete across two block elements.\n\t\t *\n\t\t * Example:\n\t\t * <h1>a</h1><p>|b</p>\n\t\t *\n\t\t * Will produce this on backspace:\n\t\t * <h1>a<span style=\"<all runtime styles>\">b</span></p>\n\t\t *\n\t\t * This fixes the backspace to produce:\n\t\t * <h1>a|b</p>\n\t\t *\n\t\t * See bug: https://bugs.webkit.org/show_bug.cgi?id=45784\n\t\t *\n\t\t * This fixes the following delete scenarios:\n\t\t *  1. Delete by pressing backspace key.\n\t\t *  2. Delete by pressing delete key.\n\t\t *  3. Delete by pressing backspace key with ctrl/cmd (Word delete).\n\t\t *  4. Delete by pressing delete key with ctrl/cmd (Word delete).\n\t\t *  5. Delete by drag/dropping contents inside the editor.\n\t\t *  6. Delete by using Cut Ctrl+X/Cmd+X.\n\t\t *  7. Delete by selecting contents and writing a character.\n\t\t *\n\t\t * This code is a ugly hack since writing full custom delete logic for just this bug\n\t\t * fix seemed like a huge task. I hope we can remove this before the year 2030.\n\t\t */\n\t\tfunction cleanupStylesWhenDeleting() {\n\t\t\tvar doc = editor.getDoc(), dom = editor.dom, selection = editor.selection;\n\t\t\tvar MutationObserver = window.MutationObserver, olderWebKit, dragStartRng;\n\n\t\t\t// Add mini polyfill for older WebKits\n\t\t\t// TODO: Remove this when old Safari versions gets updated\n\t\t\tif (!MutationObserver) {\n\t\t\t\tolderWebKit = true;\n\n\t\t\t\tMutationObserver = function() {\n\t\t\t\t\tvar records = [], target;\n\n\t\t\t\t\tfunction nodeInsert(e) {\n\t\t\t\t\t\tvar target = e.relatedNode || e.target;\n\t\t\t\t\t\trecords.push({target: target, addedNodes: [target]});\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction attrModified(e) {\n\t\t\t\t\t\tvar target = e.relatedNode || e.target;\n\t\t\t\t\t\trecords.push({target: target, attributeName: e.attrName});\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observe = function(node) {\n\t\t\t\t\t\ttarget = node;\n\t\t\t\t\t\ttarget.addEventListener('DOMSubtreeModified', nodeInsert, false);\n\t\t\t\t\t\ttarget.addEventListener('DOMNodeInsertedIntoDocument', nodeInsert, false);\n\t\t\t\t\t\ttarget.addEventListener('DOMNodeInserted', nodeInsert, false);\n\t\t\t\t\t\ttarget.addEventListener('DOMAttrModified', attrModified, false);\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.disconnect = function() {\n\t\t\t\t\t\ttarget.removeEventListener('DOMSubtreeModified', nodeInsert, false);\n\t\t\t\t\t\ttarget.removeEventListener('DOMNodeInsertedIntoDocument', nodeInsert, false);\n\t\t\t\t\t\ttarget.removeEventListener('DOMNodeInserted', nodeInsert, false);\n\t\t\t\t\t\ttarget.removeEventListener('DOMAttrModified', attrModified, false);\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.takeRecords = function() {\n\t\t\t\t\t\treturn records;\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tfunction isTrailingBr(node) {\n\t\t\t\tvar blockElements = dom.schema.getBlockElements(), rootNode = editor.getBody();\n\n\t\t\t\tif (node.nodeName != 'BR') {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tfor (; node != rootNode && !blockElements[node.nodeName]; node = node.parentNode) {\n\t\t\t\t\tif (node.nextSibling) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tfunction isSiblingsIgnoreWhiteSpace(node1, node2) {\n\t\t\t\tvar node;\n\n\t\t\t\tfor (node = node1.nextSibling; node && node != node2; node = node.nextSibling) {\n\t\t\t\t\tif (node.nodeType == 3 && $.trim(node.data).length === 0) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node !== node2) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn node === node2;\n\t\t\t}\n\n\t\t\tfunction findCaretNode(node, forward, startNode) {\n\t\t\t\tvar walker, current, nonEmptyElements;\n\n\t\t\t\t// Protect against the possibility we are asked to find a caret node relative\n\t\t\t\t// to a node that is no longer in the DOM tree. In this case attempting to\n\t\t\t\t// select on any match leads to a scenario where selection is completely removed\n\t\t\t\t// from the editor. This scenario is met in real world at a minimum on\n\t\t\t\t// WebKit browsers when selecting all and Cmd-X cutting to delete content.\n\t\t\t\tif (!dom.isChildOf(node, editor.getBody())) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tnonEmptyElements = dom.schema.getNonEmptyElements();\n\n\t\t\t\twalker = new TreeWalker(startNode || node, node);\n\n\t\t\t\twhile ((current = walker[forward ? 'next' : 'prev']())) {\n\t\t\t\t\tif (nonEmptyElements[current.nodeName] && !isTrailingBr(current)) {\n\t\t\t\t\t\treturn current;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (current.nodeType == 3 && current.data.length > 0) {\n\t\t\t\t\t\treturn current;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction deleteRangeBetweenTextBlocks(rng) {\n\t\t\t\tvar startBlock, endBlock, caretNodeBefore, caretNodeAfter, textBlockElements;\n\n\t\t\t\tif (rng.collapsed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstartBlock = dom.getParent(RangeUtils.getNode(rng.startContainer, rng.startOffset), dom.isBlock);\n\t\t\t\tendBlock = dom.getParent(RangeUtils.getNode(rng.endContainer, rng.endOffset), dom.isBlock);\n\t\t\t\ttextBlockElements = editor.schema.getTextBlockElements();\n\n\t\t\t\tif (startBlock == endBlock) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!textBlockElements[startBlock.nodeName] || !textBlockElements[endBlock.nodeName]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (dom.getContentEditable(startBlock) === \"false\" || dom.getContentEditable(endBlock) === \"false\") {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\trng.deleteContents();\n\n\t\t\t\tcaretNodeBefore = findCaretNode(startBlock, false);\n\t\t\t\tcaretNodeAfter = findCaretNode(endBlock, true);\n\n\t\t\t\tif (!dom.isEmpty(endBlock)) {\n\t\t\t\t\t$(startBlock).append(endBlock.childNodes);\n\t\t\t\t}\n\n\t\t\t\t$(endBlock).remove();\n\n\t\t\t\tif (caretNodeBefore) {\n\t\t\t\t\tif (caretNodeBefore.nodeType == 1) {\n\t\t\t\t\t\tif (caretNodeBefore.nodeName == \"BR\") {\n\t\t\t\t\t\t\trng.setStartBefore(caretNodeBefore);\n\t\t\t\t\t\t\trng.setEndBefore(caretNodeBefore);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setStartAfter(caretNodeBefore);\n\t\t\t\t\t\t\trng.setEndAfter(caretNodeBefore);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng.setStart(caretNodeBefore, caretNodeBefore.data.length);\n\t\t\t\t\t\trng.setEnd(caretNodeBefore, caretNodeBefore.data.length);\n\t\t\t\t\t}\n\t\t\t\t} else if (caretNodeAfter) {\n\t\t\t\t\tif (caretNodeAfter.nodeType == 1) {\n\t\t\t\t\t\trng.setStartBefore(caretNodeAfter);\n\t\t\t\t\t\trng.setEndBefore(caretNodeAfter);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng.setStart(caretNodeAfter, 0);\n\t\t\t\t\t\trng.setEnd(caretNodeAfter, 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tselection.setRng(rng);\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tfunction expandBetweenBlocks(rng, isForward) {\n\t\t\t\tvar caretNode, targetCaretNode, textBlock, targetTextBlock, container, offset;\n\n\t\t\t\tif (!rng.collapsed) {\n\t\t\t\t\treturn rng;\n\t\t\t\t}\n\n\t\t\t\tcontainer = rng.startContainer;\n\t\t\t\toffset = rng.startOffset;\n\n\t\t\t\tif (container.nodeType == 3) {\n\t\t\t\t\tif (isForward) {\n\t\t\t\t\t\tif (offset < container.data.length) {\n\t\t\t\t\t\t\treturn rng;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (offset > 0) {\n\t\t\t\t\t\t\treturn rng;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcaretNode = RangeUtils.getNode(container, offset);\n\t\t\t\ttextBlock = dom.getParent(caretNode, dom.isBlock);\n\t\t\t\ttargetCaretNode = findCaretNode(editor.getBody(), isForward, caretNode);\n\t\t\t\ttargetTextBlock = dom.getParent(targetCaretNode, dom.isBlock);\n\t\t\t\tvar isAfter = container.nodeType === 1 && offset > container.childNodes.length - 1;\n\n\t\t\t\tif (!caretNode || !targetCaretNode) {\n\t\t\t\t\treturn rng;\n\t\t\t\t}\n\n\t\t\t\tif (targetTextBlock && textBlock != targetTextBlock) {\n\t\t\t\t\tif (!isForward) {\n\t\t\t\t\t\tif (!isSiblingsIgnoreWhiteSpace(targetTextBlock, textBlock)) {\n\t\t\t\t\t\t\treturn rng;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (targetCaretNode.nodeType == 1) {\n\t\t\t\t\t\t\tif (targetCaretNode.nodeName == \"BR\") {\n\t\t\t\t\t\t\t\trng.setStartBefore(targetCaretNode);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trng.setStartAfter(targetCaretNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setStart(targetCaretNode, targetCaretNode.data.length);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (caretNode.nodeType == 1) {\n\t\t\t\t\t\t\tif (isAfter) {\n\t\t\t\t\t\t\t\trng.setEndAfter(caretNode);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trng.setEndBefore(caretNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setEndBefore(caretNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!isSiblingsIgnoreWhiteSpace(textBlock, targetTextBlock)) {\n\t\t\t\t\t\t\treturn rng;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (caretNode.nodeType == 1) {\n\t\t\t\t\t\t\tif (caretNode.nodeName == \"BR\") {\n\t\t\t\t\t\t\t\trng.setStartBefore(caretNode);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trng.setStartAfter(caretNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setStart(caretNode, caretNode.data.length);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (targetCaretNode.nodeType == 1) {\n\t\t\t\t\t\t\trng.setEnd(targetCaretNode, 0);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setEndBefore(targetCaretNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\tfunction handleTextBlockMergeDelete(isForward) {\n\t\t\t\tvar rng = selection.getRng();\n\n\t\t\t\trng = expandBetweenBlocks(rng, isForward);\n\n\t\t\t\tif (deleteRangeBetweenTextBlocks(rng)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * This retains the formatting if the last character is to be deleted.\n\t\t\t *\n\t\t\t * Backspace on this: <p><b><i>a|</i></b></p> would become <p>|</p> in WebKit.\n\t\t\t * With this patch: <p><b><i>|<br></i></b></p>\n\t\t\t */\n\t\t\tfunction handleLastBlockCharacterDelete(isForward, rng) {\n\t\t\t\tvar path, blockElm, newBlockElm, clonedBlockElm, sibling,\n\t\t\t\t\tcontainer, offset, br, currentFormatNodes;\n\n\t\t\t\tfunction cloneTextBlockWithFormats(blockElm, node) {\n\t\t\t\t\tcurrentFormatNodes = $(node).parents().filter(function(idx, node) {\n\t\t\t\t\t\treturn !!editor.schema.getTextInlineElements()[node.nodeName];\n\t\t\t\t\t});\n\n\t\t\t\t\tnewBlockElm = blockElm.cloneNode(false);\n\n\t\t\t\t\tcurrentFormatNodes = Tools.map(currentFormatNodes, function(formatNode) {\n\t\t\t\t\t\tformatNode = formatNode.cloneNode(false);\n\n\t\t\t\t\t\tif (newBlockElm.hasChildNodes()) {\n\t\t\t\t\t\t\tformatNode.appendChild(newBlockElm.firstChild);\n\t\t\t\t\t\t\tnewBlockElm.appendChild(formatNode);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnewBlockElm.appendChild(formatNode);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnewBlockElm.appendChild(formatNode);\n\n\t\t\t\t\t\treturn formatNode;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (currentFormatNodes.length) {\n\t\t\t\t\t\tbr = dom.create('br');\n\t\t\t\t\t\tcurrentFormatNodes[0].appendChild(br);\n\t\t\t\t\t\tdom.replace(newBlockElm, blockElm);\n\n\t\t\t\t\t\trng.setStartBefore(br);\n\t\t\t\t\t\trng.setEndBefore(br);\n\t\t\t\t\t\teditor.selection.setRng(rng);\n\n\t\t\t\t\t\treturn br;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tfunction isTextBlock(node) {\n\t\t\t\t\treturn node && editor.schema.getTextBlockElements()[node.tagName];\n\t\t\t\t}\n\n\t\t\t\tif (!rng.collapsed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tcontainer = rng.startContainer;\n\t\t\t\toffset = rng.startOffset;\n\t\t\t\tblockElm = dom.getParent(container, dom.isBlock);\n\t\t\t\tif (!isTextBlock(blockElm)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (container.nodeType == 1) {\n\t\t\t\t\tcontainer = container.childNodes[offset];\n\t\t\t\t\tif (container && container.tagName != 'BR') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isForward) {\n\t\t\t\t\t\tsibling = blockElm.nextSibling;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsibling = blockElm.previousSibling;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (dom.isEmpty(blockElm) && isTextBlock(sibling) && dom.isEmpty(sibling)) {\n\t\t\t\t\t\tif (cloneTextBlockWithFormats(blockElm, container)) {\n\t\t\t\t\t\t\tdom.remove(sibling);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (container.nodeType == 3) {\n\t\t\t\t\tpath = NodePath.create(blockElm, container);\n\t\t\t\t\tclonedBlockElm = blockElm.cloneNode(true);\n\t\t\t\t\tcontainer = NodePath.resolve(clonedBlockElm, path);\n\n\t\t\t\t\tif (isForward) {\n\t\t\t\t\t\tif (offset >= container.data.length) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcontainer.deleteData(offset, 1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (offset <= 0) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcontainer.deleteData(offset - 1, 1);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (dom.isEmpty(clonedBlockElm)) {\n\t\t\t\t\t\treturn cloneTextBlockWithFormats(blockElm, container);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction customDelete(isForward) {\n\t\t\t\tvar mutationObserver, rng, caretElement;\n\n\t\t\t\tif (handleTextBlockMergeDelete(isForward)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tTools.each(editor.getBody().getElementsByTagName('*'), function(elm) {\n\t\t\t\t\t// Mark existing spans\n\t\t\t\t\tif (elm.tagName == 'SPAN') {\n\t\t\t\t\t\telm.setAttribute('mce-data-marked', 1);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Make sure all elements has a data-mce-style attribute\n\t\t\t\t\tif (!elm.hasAttribute('data-mce-style') && elm.hasAttribute('style')) {\n\t\t\t\t\t\teditor.dom.setAttrib(elm, 'style', editor.dom.getAttrib(elm, 'style'));\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Observe added nodes and style attribute changes\n\t\t\t\tmutationObserver = new MutationObserver(function() {});\n\t\t\t\tmutationObserver.observe(editor.getDoc(), {\n\t\t\t\t\tchildList: true,\n\t\t\t\t\tattributes: true,\n\t\t\t\t\tsubtree: true,\n\t\t\t\t\tattributeFilter: ['style']\n\t\t\t\t});\n\n\t\t\t\teditor.getDoc().execCommand(isForward ? 'ForwardDelete' : 'Delete', false, null);\n\n\t\t\t\trng = editor.selection.getRng();\n\t\t\t\tcaretElement = rng.startContainer.parentNode;\n\n\t\t\t\tTools.each(mutationObserver.takeRecords(), function(record) {\n\t\t\t\t\tif (!dom.isChildOf(record.target, editor.getBody())) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Restore style attribute to previous value\n\t\t\t\t\tif (record.attributeName == \"style\") {\n\t\t\t\t\t\tvar oldValue = record.target.getAttribute('data-mce-style');\n\n\t\t\t\t\t\tif (oldValue) {\n\t\t\t\t\t\t\trecord.target.setAttribute(\"style\", oldValue);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trecord.target.removeAttribute(\"style\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove all spans that aren't marked and retain selection\n\t\t\t\t\tTools.each(record.addedNodes, function(node) {\n\t\t\t\t\t\tif (node.nodeName == \"SPAN\" && !node.getAttribute('mce-data-marked')) {\n\t\t\t\t\t\t\tvar offset, container;\n\n\t\t\t\t\t\t\tif (node == caretElement) {\n\t\t\t\t\t\t\t\toffset = rng.startOffset;\n\t\t\t\t\t\t\t\tcontainer = node.firstChild;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tdom.remove(node, true);\n\n\t\t\t\t\t\t\tif (container) {\n\t\t\t\t\t\t\t\trng.setStart(container, offset);\n\t\t\t\t\t\t\t\trng.setEnd(container, offset);\n\t\t\t\t\t\t\t\teditor.selection.setRng(rng);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tmutationObserver.disconnect();\n\n\t\t\t\t// Remove any left over marks\n\t\t\t\tTools.each(editor.dom.select('span[mce-data-marked]'), function(span) {\n\t\t\t\t\tspan.removeAttribute('mce-data-marked');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction transactCustomDelete(isForward) {\n\t\t\t\teditor.undoManager.transact(function () {\n\t\t\t\t\tcustomDelete(isForward);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tvar isForward = e.keyCode == DELETE, isMetaOrCtrl = e.ctrlKey || e.metaKey;\n\n\t\t\t\tif (!isDefaultPrevented(e) && (isForward || e.keyCode == BACKSPACE)) {\n\t\t\t\t\tvar rng = editor.selection.getRng(), container = rng.startContainer, offset = rng.startOffset;\n\n\t\t\t\t\t// Shift+Delete is cut\n\t\t\t\t\tif (isForward && e.shiftKey) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (handleLastBlockCharacterDelete(isForward, rng)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Ignore non meta delete in the where there is text before/after the caret\n\t\t\t\t\tif (!isMetaOrCtrl && rng.collapsed && container.nodeType == 3) {\n\t\t\t\t\t\tif (isForward ? offset < container.data.length : offset > 0) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tif (isMetaOrCtrl) {\n\t\t\t\t\t\teditor.selection.getSel().modify(\"extend\", isForward ? \"forward\" : \"backward\", e.metaKey ? \"lineboundary\" : \"word\");\n\t\t\t\t\t}\n\n\t\t\t\t\tcustomDelete(isForward);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Handle case where text is deleted by typing over\n\t\t\teditor.on('keypress', function(e) {\n\t\t\t\tif (!isDefaultPrevented(e) && !selection.isCollapsed() && e.charCode > 31 && !VK.metaKeyPressed(e)) {\n\t\t\t\t\tvar rng, currentFormatNodes, fragmentNode, blockParent, caretNode, charText;\n\n\t\t\t\t\trng = editor.selection.getRng();\n\t\t\t\t\tcharText = String.fromCharCode(e.charCode);\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t// Keep track of current format nodes\n\t\t\t\t\tcurrentFormatNodes = $(rng.startContainer).parents().filter(function(idx, node) {\n\t\t\t\t\t\treturn !!editor.schema.getTextInlineElements()[node.nodeName];\n\t\t\t\t\t});\n\n\t\t\t\t\tcustomDelete(true);\n\n\t\t\t\t\t// Check if the browser removed them\n\t\t\t\t\tcurrentFormatNodes = currentFormatNodes.filter(function(idx, node) {\n\t\t\t\t\t\treturn !$.contains(editor.getBody(), node);\n\t\t\t\t\t});\n\n\t\t\t\t\t// Then re-add them\n\t\t\t\t\tif (currentFormatNodes.length) {\n\t\t\t\t\t\tfragmentNode = dom.createFragment();\n\n\t\t\t\t\t\tcurrentFormatNodes.each(function(idx, formatNode) {\n\t\t\t\t\t\t\tformatNode = formatNode.cloneNode(false);\n\n\t\t\t\t\t\t\tif (fragmentNode.hasChildNodes()) {\n\t\t\t\t\t\t\t\tformatNode.appendChild(fragmentNode.firstChild);\n\t\t\t\t\t\t\t\tfragmentNode.appendChild(formatNode);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcaretNode = formatNode;\n\t\t\t\t\t\t\t\tfragmentNode.appendChild(formatNode);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfragmentNode.appendChild(formatNode);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tcaretNode.appendChild(editor.getDoc().createTextNode(charText));\n\n\t\t\t\t\t\t// Prevent edge case where older WebKit would add an extra BR element\n\t\t\t\t\t\tblockParent = dom.getParent(rng.startContainer, dom.isBlock);\n\t\t\t\t\t\tif (dom.isEmpty(blockParent)) {\n\t\t\t\t\t\t\t$(blockParent).empty().append(fragmentNode);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.insertNode(fragmentNode);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\trng.setStart(caretNode.firstChild, 1);\n\t\t\t\t\t\trng.setEnd(caretNode.firstChild, 1);\n\t\t\t\t\t\teditor.selection.setRng(rng);\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.selection.setContent(charText);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.addCommand('Delete', function() {\n\t\t\t\tcustomDelete();\n\t\t\t});\n\n\t\t\teditor.addCommand('ForwardDelete', function() {\n\t\t\t\tcustomDelete(true);\n\t\t\t});\n\n\t\t\t// Older WebKits doesn't properly handle the clipboard so we can't add the rest\n\t\t\tif (olderWebKit) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\teditor.on('dragstart', function(e) {\n\t\t\t\tdragStartRng = selection.getRng();\n\t\t\t\tsetMceInternalContent(e);\n\t\t\t});\n\n\t\t\teditor.on('drop', function(e) {\n\t\t\t\tif (!isDefaultPrevented(e)) {\n\t\t\t\t\tvar internalContent = getMceInternalContent(e);\n\n\t\t\t\t\tif (internalContent) {\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t// Safari has a weird issue where drag/dropping images sometimes\n\t\t\t\t\t\t// produces a green plus icon. When this happens the caretRangeFromPoint\n\t\t\t\t\t\t// will return \"null\" even though the x, y coordinate is correct.\n\t\t\t\t\t\t// But if we detach the insert from the drop event we will get a proper range\n\t\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\t\tvar pointRng = RangeUtils.getCaretRangeFromPoint(e.x, e.y, doc);\n\n\t\t\t\t\t\t\tif (dragStartRng) {\n\t\t\t\t\t\t\t\tselection.setRng(dragStartRng);\n\t\t\t\t\t\t\t\tdragStartRng = null;\n\t\t\t\t\t\t\t\ttransactCustomDelete();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tselection.setRng(pointRng);\n\t\t\t\t\t\t\tinsertClipboardContents(internalContent.html);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('cut', function(e) {\n\t\t\t\tif (!isDefaultPrevented(e) && e.clipboardData && !editor.selection.isCollapsed()) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.clipboardData.clearData();\n\t\t\t\t\te.clipboardData.setData('text/html', editor.selection.getContent());\n\t\t\t\t\te.clipboardData.setData('text/plain', editor.selection.getContent({format: 'text'}));\n\n\t\t\t\t\t// Needed delay for https://code.google.com/p/chromium/issues/detail?id=363288#c3\n\t\t\t\t\t// Nested delete/forwardDelete not allowed on execCommand(\"cut\")\n\t\t\t\t\t// This is ugly but not sure how to work around it otherwise\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\ttransactCustomDelete(true);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Makes sure that the editor body becomes empty when backspace or delete is pressed in empty editors.\n\t\t *\n\t\t * For example:\n\t\t * <p><b>|</b></p>\n\t\t *\n\t\t * Or:\n\t\t * <h1>|</h1>\n\t\t *\n\t\t * Or:\n\t\t * [<h1></h1>]\n\t\t */\n\t\tfunction emptyEditorWhenDeleting() {\n\t\t\tfunction serializeRng(rng) {\n\t\t\t\tvar body = dom.create(\"body\");\n\t\t\t\tvar contents = rng.cloneContents();\n\t\t\t\tbody.appendChild(contents);\n\t\t\t\treturn selection.serializer.serialize(body, {format: 'html'});\n\t\t\t}\n\n\t\t\tfunction allContentsSelected(rng) {\n\t\t\t\tif (!rng.setStart) {\n\t\t\t\t\tif (rng.item) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar bodyRng = rng.duplicate();\n\t\t\t\t\tbodyRng.moveToElementText(editor.getBody());\n\t\t\t\t\treturn RangeUtils.compareRanges(rng, bodyRng);\n\t\t\t\t}\n\n\t\t\t\tvar selection = serializeRng(rng);\n\n\t\t\t\tvar allRng = dom.createRng();\n\t\t\t\tallRng.selectNode(editor.getBody());\n\n\t\t\t\tvar allSelection = serializeRng(allRng);\n\t\t\t\treturn selection === allSelection;\n\t\t\t}\n\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tvar keyCode = e.keyCode, isCollapsed, body;\n\n\t\t\t\t// Empty the editor if it's needed for example backspace at <p><b>|</b></p>\n\t\t\t\tif (!isDefaultPrevented(e) && (keyCode == DELETE || keyCode == BACKSPACE)) {\n\t\t\t\t\tisCollapsed = editor.selection.isCollapsed();\n\t\t\t\t\tbody = editor.getBody();\n\n\t\t\t\t\t// Selection is collapsed but the editor isn't empty\n\t\t\t\t\tif (isCollapsed && !dom.isEmpty(body)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Selection isn't collapsed but not all the contents is selected\n\t\t\t\t\tif (!isCollapsed && !allContentsSelected(editor.selection.getRng())) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Manually empty the editor\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\teditor.setContent('');\n\n\t\t\t\t\tif (body.firstChild && dom.isBlock(body.firstChild)) {\n\t\t\t\t\t\teditor.selection.setCursorLocation(body.firstChild, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.selection.setCursorLocation(body, 0);\n\t\t\t\t\t}\n\n\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * WebKit doesn't select all the nodes in the body when you press Ctrl+A.\n\t\t * IE selects more than the contents <body>[<p>a</p>]</body> instead of <body><p>[a]</p]</body> see bug #6438\n\t\t * This selects the whole body so that backspace/delete logic will delete everything\n\t\t */\n\t\tfunction selectAll() {\n\t\t\teditor.shortcuts.add('meta+a', null, 'SelectAll');\n\t\t}\n\n\t\t/**\n\t\t * WebKit has a weird issue where it some times fails to properly convert keypresses to input method keystrokes.\n\t\t * The IME on Mac doesn't initialize when it doesn't fire a proper focus event.\n\t\t *\n\t\t * This seems to happen when the user manages to click the documentElement element then the window doesn't get proper focus until\n\t\t * you enter a character into the editor.\n\t\t *\n\t\t * It also happens when the first focus in made to the body.\n\t\t *\n\t\t * See: https://bugs.webkit.org/show_bug.cgi?id=83566\n\t\t */\n\t\tfunction inputMethodFocus() {\n\t\t\tif (!editor.settings.content_editable) {\n\t\t\t\t// Case 1 IME doesn't initialize if you focus the document\n\t\t\t\t// Disabled since it was interferring with the cE=false logic\n\t\t\t\t// Also coultn't reproduce the issue on Safari 9\n\t\t\t\t/*dom.bind(editor.getDoc(), 'focusin', function() {\n\t\t\t\t\tselection.setRng(selection.getRng());\n\t\t\t\t});*/\n\n\t\t\t\t// Case 2 IME doesn't initialize if you click the documentElement it also doesn't properly fire the focusin event\n\t\t\t\t// Needs to be both down/up due to weird rendering bug on Chrome Windows\n\t\t\t\tdom.bind(editor.getDoc(), 'mousedown mouseup', function(e) {\n\t\t\t\t\tvar rng;\n\n\t\t\t\t\tif (e.target == editor.getDoc().documentElement) {\n\t\t\t\t\t\trng = selection.getRng();\n\t\t\t\t\t\teditor.getBody().focus();\n\n\t\t\t\t\t\tif (e.type == 'mousedown') {\n\t\t\t\t\t\t\tif (CaretContainer.isCaretContainer(rng.startContainer)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Edge case for mousedown, drag select and mousedown again within selection on Chrome Windows to render caret\n\t\t\t\t\t\t\tselection.placeCaretAt(e.clientX, e.clientY);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Backspacing in FireFox/IE from a paragraph into a horizontal rule results in a floating text node because the\n\t\t * browser just deletes the paragraph - the browser fails to merge the text node with a horizontal rule so it is\n\t\t * left there. TinyMCE sees a floating text node and wraps it in a paragraph on the key up event (ForceBlocks.js\n\t\t * addRootBlocks), meaning the action does nothing. With this code, FireFox/IE matche the behaviour of other\n\t\t * browsers.\n\t\t *\n\t\t * It also fixes a bug on Firefox where it's impossible to delete HR elements.\n\t\t */\n\t\tfunction removeHrOnBackspace() {\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tif (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\n\t\t\t\t\t// Check if there is any HR elements this is faster since getRng on IE 7 & 8 is slow\n\t\t\t\t\tif (!editor.getBody().getElementsByTagName('hr').length) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (selection.isCollapsed() && selection.getRng(true).startOffset === 0) {\n\t\t\t\t\t\tvar node = selection.getNode();\n\t\t\t\t\t\tvar previousSibling = node.previousSibling;\n\n\t\t\t\t\t\tif (node.nodeName == 'HR') {\n\t\t\t\t\t\t\tdom.remove(node);\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === \"hr\") {\n\t\t\t\t\t\t\tdom.remove(previousSibling);\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Firefox 3.x has an issue where the body element won't get proper focus if you click out\n\t\t * side it's rectangle.\n\t\t */\n\t\tfunction focusBody() {\n\t\t\t// Fix for a focus bug in FF 3.x where the body element\n\t\t\t// wouldn't get proper focus if the user clicked on the HTML element\n\t\t\tif (!window.Range.prototype.getClientRects) { // Detect getClientRects got introduced in FF 4\n\t\t\t\teditor.on('mousedown', function(e) {\n\t\t\t\t\tif (!isDefaultPrevented(e) && e.target.nodeName === \"HTML\") {\n\t\t\t\t\t\tvar body = editor.getBody();\n\n\t\t\t\t\t\t// Blur the body it's focused but not correctly focused\n\t\t\t\t\t\tbody.blur();\n\n\t\t\t\t\t\t// Refocus the body after a little while\n\t\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\t\tbody.focus();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * WebKit has a bug where it isn't possible to select image, hr or anchor elements\n\t\t * by clicking on them so we need to fake that.\n\t\t */\n\t\tfunction selectControlElements() {\n\t\t\teditor.on('click', function(e) {\n\t\t\t\tvar target = e.target;\n\n\t\t\t\t// Workaround for bug, http://bugs.webkit.org/show_bug.cgi?id=12250\n\t\t\t\t// WebKit can't even do simple things like selecting an image\n\t\t\t\tif (/^(IMG|HR)$/.test(target.nodeName) && dom.getContentEditableParent(target) !== \"false\") {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tselection.select(target);\n\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t}\n\n\t\t\t\tif (target.nodeName == 'A' && dom.hasClass(target, 'mce-item-anchor')) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tselection.select(target);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Fixes a Gecko bug where the style attribute gets added to the wrong element when deleting between two block elements.\n\t\t *\n\t\t * Fixes do backspace/delete on this:\n\t\t * <p>bla[ck</p><p style=\"color:red\">r]ed</p>\n\t\t *\n\t\t * Would become:\n\t\t * <p>bla|ed</p>\n\t\t *\n\t\t * Instead of:\n\t\t * <p style=\"color:red\">bla|ed</p>\n\t\t */\n\t\tfunction removeStylesWhenDeletingAcrossBlockElements() {\n\t\t\tfunction getAttributeApplyFunction() {\n\t\t\t\tvar template = dom.getAttribs(selection.getStart().cloneNode(false));\n\n\t\t\t\treturn function() {\n\t\t\t\t\tvar target = selection.getStart();\n\n\t\t\t\t\tif (target !== editor.getBody()) {\n\t\t\t\t\t\tdom.setAttrib(target, \"style\", null);\n\n\t\t\t\t\t\teach(template, function(attr) {\n\t\t\t\t\t\t\ttarget.setAttributeNode(attr.cloneNode(true));\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tfunction isSelectionAcrossElements() {\n\t\t\t\treturn !selection.isCollapsed() &&\n\t\t\t\t\tdom.getParent(selection.getStart(), dom.isBlock) != dom.getParent(selection.getEnd(), dom.isBlock);\n\t\t\t}\n\n\t\t\teditor.on('keypress', function(e) {\n\t\t\t\tvar applyAttributes;\n\n\t\t\t\tif (!isDefaultPrevented(e) && (e.keyCode == 8 || e.keyCode == 46) && isSelectionAcrossElements()) {\n\t\t\t\t\tapplyAttributes = getAttributeApplyFunction();\n\t\t\t\t\teditor.getDoc().execCommand('delete', false, null);\n\t\t\t\t\tapplyAttributes();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdom.bind(editor.getDoc(), 'cut', function(e) {\n\t\t\t\tvar applyAttributes;\n\n\t\t\t\tif (!isDefaultPrevented(e) && isSelectionAcrossElements()) {\n\t\t\t\t\tapplyAttributes = getAttributeApplyFunction();\n\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\tapplyAttributes();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Screen readers on IE needs to have the role application set on the body.\n\t\t */\n\t\tfunction ensureBodyHasRoleApplication() {\n\t\t\tdocument.body.setAttribute(\"role\", \"application\");\n\t\t}\n\n\t\t/**\n\t\t * Backspacing into a table behaves differently depending upon browser type.\n\t\t * Therefore, disable Backspace when cursor immediately follows a table.\n\t\t */\n\t\tfunction disableBackspaceIntoATable() {\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tif (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\n\t\t\t\t\tif (selection.isCollapsed() && selection.getRng(true).startOffset === 0) {\n\t\t\t\t\t\tvar previousSibling = selection.getNode().previousSibling;\n\t\t\t\t\t\tif (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === \"table\") {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Old IE versions can't properly render BR elements in PRE tags white in contentEditable mode. So this\n\t\t * logic adds a \\n before the BR so that it will get rendered.\n\t\t */\n\t\tfunction addNewLinesBeforeBrInPre() {\n\t\t\t// IE8+ rendering mode does the right thing with BR in PRE\n\t\t\tif (getDocumentMode() > 7) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Enable display: none in area and add a specific class that hides all BR elements in PRE to\n\t\t\t// avoid the caret from getting stuck at the BR elements while pressing the right arrow key\n\t\t\tsetEditorCommandState('RespectVisibilityInDesign', true);\n\t\t\teditor.contentStyles.push('.mceHideBrInPre pre br {display: none}');\n\t\t\tdom.addClass(editor.getBody(), 'mceHideBrInPre');\n\n\t\t\t// Adds a \\n before all BR elements in PRE to get them visual\n\t\t\tparser.addNodeFilter('pre', function(nodes) {\n\t\t\t\tvar i = nodes.length, brNodes, j, brElm, sibling;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tbrNodes = nodes[i].getAll('br');\n\t\t\t\t\tj = brNodes.length;\n\t\t\t\t\twhile (j--) {\n\t\t\t\t\t\tbrElm = brNodes[j];\n\n\t\t\t\t\t\t// Add \\n before BR in PRE elements on older IE:s so the new lines get rendered\n\t\t\t\t\t\tsibling = brElm.prev;\n\t\t\t\t\t\tif (sibling && sibling.type === 3 && sibling.value.charAt(sibling.value - 1) != '\\n') {\n\t\t\t\t\t\t\tsibling.value += '\\n';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbrElm.parent.insert(new Node('#text', 3), brElm, true).value = '\\n';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Removes any \\n before BR elements in PRE since other browsers and in contentEditable=false mode they will be visible\n\t\t\tserializer.addNodeFilter('pre', function(nodes) {\n\t\t\t\tvar i = nodes.length, brNodes, j, brElm, sibling;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tbrNodes = nodes[i].getAll('br');\n\t\t\t\t\tj = brNodes.length;\n\t\t\t\t\twhile (j--) {\n\t\t\t\t\t\tbrElm = brNodes[j];\n\t\t\t\t\t\tsibling = brElm.prev;\n\t\t\t\t\t\tif (sibling && sibling.type == 3) {\n\t\t\t\t\t\t\tsibling.value = sibling.value.replace(/\\r?\\n$/, '');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Moves style width/height to attribute width/height when the user resizes an image on IE.\n\t\t */\n\t\tfunction removePreSerializedStylesWhenSelectingControls() {\n\t\t\tdom.bind(editor.getBody(), 'mouseup', function() {\n\t\t\t\tvar value, node = selection.getNode();\n\n\t\t\t\t// Moved styles to attributes on IMG eements\n\t\t\t\tif (node.nodeName == 'IMG') {\n\t\t\t\t\t// Convert style width to width attribute\n\t\t\t\t\tif ((value = dom.getStyle(node, 'width'))) {\n\t\t\t\t\t\tdom.setAttrib(node, 'width', value.replace(/[^0-9%]+/g, ''));\n\t\t\t\t\t\tdom.setStyle(node, 'width', '');\n\t\t\t\t\t}\n\n\t\t\t\t\t// Convert style height to height attribute\n\t\t\t\t\tif ((value = dom.getStyle(node, 'height'))) {\n\t\t\t\t\t\tdom.setAttrib(node, 'height', value.replace(/[^0-9%]+/g, ''));\n\t\t\t\t\t\tdom.setStyle(node, 'height', '');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Removes a blockquote when backspace is pressed at the beginning of it.\n\t\t *\n\t\t * For example:\n\t\t * <blockquote><p>|x</p></blockquote>\n\t\t *\n\t\t * Becomes:\n\t\t * <p>|x</p>\n\t\t */\n\t\tfunction removeBlockQuoteOnBackSpace() {\n\t\t\t// Add block quote deletion handler\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tvar rng, container, offset, root, parent;\n\n\t\t\t\tif (isDefaultPrevented(e) || e.keyCode != VK.BACKSPACE) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\trng = selection.getRng();\n\t\t\t\tcontainer = rng.startContainer;\n\t\t\t\toffset = rng.startOffset;\n\t\t\t\troot = dom.getRoot();\n\t\t\t\tparent = container;\n\n\t\t\t\tif (!rng.collapsed || offset !== 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twhile (parent && parent.parentNode && parent.parentNode.firstChild == parent && parent.parentNode != root) {\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\t// Is the cursor at the beginning of a blockquote?\n\t\t\t\tif (parent.tagName === 'BLOCKQUOTE') {\n\t\t\t\t\t// Remove the blockquote\n\t\t\t\t\teditor.formatter.toggle('blockquote', null, parent);\n\n\t\t\t\t\t// Move the caret to the beginning of container\n\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\trng.setStart(container, 0);\n\t\t\t\t\trng.setEnd(container, 0);\n\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Sets various Gecko editing options on mouse down and before a execCommand to disable inline table editing that is broken etc.\n\t\t */\n\t\tfunction setGeckoEditingOptions() {\n\t\t\tfunction setOpts() {\n\t\t\t\trefreshContentEditable();\n\n\t\t\t\tsetEditorCommandState(\"StyleWithCSS\", false);\n\t\t\t\tsetEditorCommandState(\"enableInlineTableEditing\", false);\n\n\t\t\t\tif (!settings.object_resizing) {\n\t\t\t\t\tsetEditorCommandState(\"enableObjectResizing\", false);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!settings.readonly) {\n\t\t\t\teditor.on('BeforeExecCommand MouseDown', setOpts);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Fixes a gecko link bug, when a link is placed at the end of block elements there is\n\t\t * no way to move the caret behind the link. This fix adds a bogus br element after the link.\n\t\t *\n\t\t * For example this:\n\t\t * <p><b><a href=\"#\">x</a></b></p>\n\t\t *\n\t\t * Becomes this:\n\t\t * <p><b><a href=\"#\">x</a></b><br></p>\n\t\t */\n\t\tfunction addBrAfterLastLinks() {\n\t\t\tfunction fixLinks() {\n\t\t\t\teach(dom.select('a'), function(node) {\n\t\t\t\t\tvar parentNode = node.parentNode, root = dom.getRoot();\n\n\t\t\t\t\tif (parentNode.lastChild === node) {\n\t\t\t\t\t\twhile (parentNode && !dom.isBlock(parentNode)) {\n\t\t\t\t\t\t\tif (parentNode.parentNode.lastChild !== parentNode || parentNode === root) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tparentNode = parentNode.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdom.add(parentNode, 'br', {'data-mce-bogus': 1});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\teditor.on('SetContent ExecCommand', function(e) {\n\t\t\t\tif (e.type == \"setcontent\" || e.command === 'mceInsertLink') {\n\t\t\t\t\tfixLinks();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * WebKit will produce DIV elements here and there by default. But since TinyMCE uses paragraphs by\n\t\t * default we want to change that behavior.\n\t\t */\n\t\tfunction setDefaultBlockType() {\n\t\t\tif (settings.forced_root_block) {\n\t\t\t\teditor.on('init', function() {\n\t\t\t\t\tsetEditorCommandState('DefaultParagraphSeparator', settings.forced_root_block);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Deletes the selected image on IE instead of navigating to previous page.\n\t\t */\n\t\tfunction deleteControlItemOnBackSpace() {\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tvar rng;\n\n\t\t\t\tif (!isDefaultPrevented(e) && e.keyCode == BACKSPACE) {\n\t\t\t\t\trng = editor.getDoc().selection.createRange();\n\t\t\t\t\tif (rng && rng.item) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\teditor.undoManager.beforeChange();\n\t\t\t\t\t\tdom.remove(rng.item(0));\n\t\t\t\t\t\teditor.undoManager.add();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * IE10 doesn't properly render block elements with the right height until you add contents to them.\n\t\t * This fixes that by adding a padding-right to all empty text block elements.\n\t\t * See: https://connect.microsoft.com/IE/feedback/details/743881\n\t\t */\n\t\tfunction renderEmptyBlocksFix() {\n\t\t\tvar emptyBlocksCSS;\n\n\t\t\t// IE10+\n\t\t\tif (getDocumentMode() >= 10) {\n\t\t\t\temptyBlocksCSS = '';\n\t\t\t\teach('p div h1 h2 h3 h4 h5 h6'.split(' '), function(name, i) {\n\t\t\t\t\temptyBlocksCSS += (i > 0 ? ',' : '') + name + ':empty';\n\t\t\t\t});\n\n\t\t\t\teditor.contentStyles.push(emptyBlocksCSS + '{padding-right: 1px !important}');\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Old IE versions can't retain contents within noscript elements so this logic will store the contents\n\t\t * as a attribute and the insert that value as it's raw text when the DOM is serialized.\n\t\t */\n\t\tfunction keepNoScriptContents() {\n\t\t\tif (getDocumentMode() < 9) {\n\t\t\t\tparser.addNodeFilter('noscript', function(nodes) {\n\t\t\t\t\tvar i = nodes.length, node, textNode;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\t\ttextNode = node.firstChild;\n\n\t\t\t\t\t\tif (textNode) {\n\t\t\t\t\t\t\tnode.attr('data-mce-innertext', textNode.value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tserializer.addNodeFilter('noscript', function(nodes) {\n\t\t\t\t\tvar i = nodes.length, node, textNode, value;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\t\ttextNode = nodes[i].firstChild;\n\n\t\t\t\t\t\tif (textNode) {\n\t\t\t\t\t\t\ttextNode.value = Entities.decode(textNode.value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Old IE can't retain noscript value so an attribute is used to store it\n\t\t\t\t\t\t\tvalue = node.attributes.map['data-mce-innertext'];\n\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\tnode.attr('data-mce-innertext', null);\n\t\t\t\t\t\t\t\ttextNode = new Node('#text', 3);\n\t\t\t\t\t\t\t\ttextNode.value = value;\n\t\t\t\t\t\t\t\ttextNode.raw = true;\n\t\t\t\t\t\t\t\tnode.append(textNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * IE has an issue where you can't select/move the caret by clicking outside the body if the document is in standards mode.\n\t\t */\n\t\tfunction fixCaretSelectionOfDocumentElementOnIe() {\n\t\t\tvar doc = dom.doc, body = doc.body, started, startRng, htmlElm;\n\n\t\t\t// Return range from point or null if it failed\n\t\t\tfunction rngFromPoint(x, y) {\n\t\t\t\tvar rng = body.createTextRange();\n\n\t\t\t\ttry {\n\t\t\t\t\trng.moveToPoint(x, y);\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// IE sometimes throws and exception, so lets just ignore it\n\t\t\t\t\trng = null;\n\t\t\t\t}\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\t// Fires while the selection is changing\n\t\t\tfunction selectionChange(e) {\n\t\t\t\tvar pointRng;\n\n\t\t\t\t// Check if the button is down or not\n\t\t\t\tif (e.button) {\n\t\t\t\t\t// Create range from mouse position\n\t\t\t\t\tpointRng = rngFromPoint(e.x, e.y);\n\n\t\t\t\t\tif (pointRng) {\n\t\t\t\t\t\t// Check if pointRange is before/after selection then change the endPoint\n\t\t\t\t\t\tif (pointRng.compareEndPoints('StartToStart', startRng) > 0) {\n\t\t\t\t\t\t\tpointRng.setEndPoint('StartToStart', startRng);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpointRng.setEndPoint('EndToEnd', startRng);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpointRng.select();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tendSelection();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Removes listeners\n\t\t\tfunction endSelection() {\n\t\t\t\tvar rng = doc.selection.createRange();\n\n\t\t\t\t// If the range is collapsed then use the last start range\n\t\t\t\tif (startRng && !rng.item && rng.compareEndPoints('StartToEnd', rng) === 0) {\n\t\t\t\t\tstartRng.select();\n\t\t\t\t}\n\n\t\t\t\tdom.unbind(doc, 'mouseup', endSelection);\n\t\t\t\tdom.unbind(doc, 'mousemove', selectionChange);\n\t\t\t\tstartRng = started = 0;\n\t\t\t}\n\n\t\t\t// Make HTML element unselectable since we are going to handle selection by hand\n\t\t\tdoc.documentElement.unselectable = true;\n\n\t\t\t// Detect when user selects outside BODY\n\t\t\tdom.bind(doc, 'mousedown contextmenu', function(e) {\n\t\t\t\tif (e.target.nodeName === 'HTML') {\n\t\t\t\t\tif (started) {\n\t\t\t\t\t\tendSelection();\n\t\t\t\t\t}\n\n\t\t\t\t\t// Detect vertical scrollbar, since IE will fire a mousedown on the scrollbar and have target set as HTML\n\t\t\t\t\thtmlElm = doc.documentElement;\n\t\t\t\t\tif (htmlElm.scrollHeight > htmlElm.clientHeight) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tstarted = 1;\n\t\t\t\t\t// Setup start position\n\t\t\t\t\tstartRng = rngFromPoint(e.x, e.y);\n\t\t\t\t\tif (startRng) {\n\t\t\t\t\t\t// Listen for selection change events\n\t\t\t\t\t\tdom.bind(doc, 'mouseup', endSelection);\n\t\t\t\t\t\tdom.bind(doc, 'mousemove', selectionChange);\n\n\t\t\t\t\t\tdom.getRoot().focus();\n\t\t\t\t\t\tstartRng.select();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Fixes selection issues where the caret can be placed between two inline elements like <b>a</b>|<b>b</b>\n\t\t * this fix will lean the caret right into the closest inline element.\n\t\t */\n\t\tfunction normalizeSelection() {\n\t\t\t// Normalize selection for example <b>a</b><i>|a</i> becomes <b>a|</b><i>a</i> except for Ctrl+A since it selects everything\n\t\t\teditor.on('keyup focusin mouseup', function(e) {\n\t\t\t\tif (e.keyCode != 65 || !VK.metaKeyPressed(e)) {\n\t\t\t\t\tselection.normalize();\n\t\t\t\t}\n\t\t\t}, true);\n\t\t}\n\n\t\t/**\n\t\t * Forces Gecko to render a broken image icon if it fails to load an image.\n\t\t */\n\t\tfunction showBrokenImageIcon() {\n\t\t\teditor.contentStyles.push(\n\t\t\t\t'img:-moz-broken {' +\n\t\t\t\t\t'-moz-force-broken-image-icon:1;' +\n\t\t\t\t\t'min-width:24px;' +\n\t\t\t\t\t'min-height:24px' +\n\t\t\t\t'}'\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * iOS has a bug where it's impossible to type if the document has a touchstart event\n\t\t * bound and the user touches the document while having the on screen keyboard visible.\n\t\t *\n\t\t * The touch event moves the focus to the parent document while having the caret inside the iframe\n\t\t * this fix moves the focus back into the iframe document.\n\t\t */\n\t\tfunction restoreFocusOnKeyDown() {\n\t\t\tif (!editor.inline) {\n\t\t\t\teditor.on('keydown', function() {\n\t\t\t\t\tif (document.activeElement == document.body) {\n\t\t\t\t\t\teditor.getWin().focus();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * IE 11 has an annoying issue where you can't move focus into the editor\n\t\t * by clicking on the white area HTML element. We used to be able to to fix this with\n\t\t * the fixCaretSelectionOfDocumentElementOnIe fix. But since M$ removed the selection\n\t\t * object it's not possible anymore. So we need to hack in a ungly CSS to force the\n\t\t * body to be at least 150px. If the user clicks the HTML element out side this 150px region\n\t\t * we simply move the focus into the first paragraph. Not ideal since you loose the\n\t\t * positioning of the caret but goot enough for most cases.\n\t\t */\n\t\tfunction bodyHeight() {\n\t\t\tif (!editor.inline) {\n\t\t\t\teditor.contentStyles.push('body {min-height: 150px}');\n\t\t\t\teditor.on('click', function(e) {\n\t\t\t\t\tvar rng;\n\n\t\t\t\t\tif (e.target.nodeName == 'HTML') {\n\t\t\t\t\t\t// Edge seems to only need focus if we set the range\n\t\t\t\t\t\t// the caret will become invisible and moved out of the iframe!!\n\t\t\t\t\t\tif (Env.ie > 11) {\n\t\t\t\t\t\t\teditor.getBody().focus();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Need to store away non collapsed ranges since the focus call will mess that up see #7382\n\t\t\t\t\t\trng = editor.selection.getRng();\n\t\t\t\t\t\teditor.getBody().focus();\n\t\t\t\t\t\teditor.selection.setRng(rng);\n\t\t\t\t\t\teditor.selection.normalize();\n\t\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Firefox on Mac OS will move the browser back to the previous page if you press CMD+Left arrow.\n\t\t * You might then loose all your work so we need to block that behavior and replace it with our own.\n\t\t */\n\t\tfunction blockCmdArrowNavigation() {\n\t\t\tif (Env.mac) {\n\t\t\t\teditor.on('keydown', function(e) {\n\t\t\t\t\tif (VK.metaKeyPressed(e) && !e.shiftKey && (e.keyCode == 37 || e.keyCode == 39)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\teditor.selection.getSel().modify('move', e.keyCode == 37 ? 'backward' : 'forward', 'lineboundary');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Disables the autolinking in IE 9+ this is then re-enabled by the autolink plugin.\n\t\t */\n\t\tfunction disableAutoUrlDetect() {\n\t\t\tsetEditorCommandState(\"AutoUrlDetect\", false);\n\t\t}\n\n\t\t/**\n\t\t * iOS 7.1 introduced two new bugs:\n\t\t * 1) It's possible to open links within a contentEditable area by clicking on them.\n\t\t * 2) If you hold down the finger it will display the link/image touch callout menu.\n\t\t */\n\t\tfunction tapLinksAndImages() {\n\t\t\teditor.on('click', function(e) {\n\t\t\t\tvar elm = e.target;\n\n\t\t\t\tdo {\n\t\t\t\t\tif (elm.tagName === 'A') {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} while ((elm = elm.parentNode));\n\t\t\t});\n\n\t\t\teditor.contentStyles.push('.mce-content-body {-webkit-touch-callout: none}');\n\t\t}\n\n\t\t/**\n\t\t * iOS Safari and possible other browsers have a bug where it won't fire\n\t\t * a click event when a contentEditable is focused. This function fakes click events\n\t\t * by using touchstart/touchend and measuring the time and distance travelled.\n\t\t */\n\t\t/*\n\t\tfunction touchClickEvent() {\n\t\t\teditor.on('touchstart', function(e) {\n\t\t\t\tvar elm, time, startTouch, changedTouches;\n\n\t\t\t\telm = e.target;\n\t\t\t\ttime = new Date().getTime();\n\t\t\t\tchangedTouches = e.changedTouches;\n\n\t\t\t\tif (!changedTouches || changedTouches.length > 1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstartTouch = changedTouches[0];\n\n\t\t\t\teditor.once('touchend', function(e) {\n\t\t\t\t\tvar endTouch = e.changedTouches[0], args;\n\n\t\t\t\t\tif (new Date().getTime() - time > 500) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Math.abs(startTouch.clientX - endTouch.clientX) > 5) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Math.abs(startTouch.clientY - endTouch.clientY) > 5) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\targs = {\n\t\t\t\t\t\ttarget: elm\n\t\t\t\t\t};\n\n\t\t\t\t\teach('pageX pageY clientX clientY screenX screenY'.split(' '), function(key) {\n\t\t\t\t\t\targs[key] = endTouch[key];\n\t\t\t\t\t});\n\n\t\t\t\t\targs = editor.fire('click', args);\n\n\t\t\t\t\tif (!args.isDefaultPrevented()) {\n\t\t\t\t\t\t// iOS WebKit can't place the caret properly once\n\t\t\t\t\t\t// you bind touch events so we need to do this manually\n\t\t\t\t\t\t// TODO: Expand to the closest word? Touble tap still works.\n\t\t\t\t\t\teditor.selection.placeCaretAt(endTouch.clientX, endTouch.clientY);\n\t\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\t*/\n\n\t\t/**\n\t\t * WebKit has a bug where it will allow forms to be submitted if they are inside a contentEditable element.\n\t\t * For example this: <form><button></form>\n\t\t */\n\t\tfunction blockFormSubmitInsideEditor() {\n\t\t\teditor.on('init', function() {\n\t\t\t\teditor.dom.bind(editor.getBody(), 'submit', function(e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Sometimes WebKit/Blink generates BR elements with the Apple-interchange-newline class.\n\t\t *\n\t\t * Scenario:\n\t\t *  1) Create a table 2x2.\n\t\t *  2) Select and copy cells A2-B2.\n\t\t *  3) Paste and it will add BR element to table cell.\n\t\t */\n\t\tfunction removeAppleInterchangeBrs() {\n\t\t\tparser.addNodeFilter('br', function(nodes) {\n\t\t\t\tvar i = nodes.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tif (nodes[i].attr('class') == 'Apple-interchange-newline') {\n\t\t\t\t\t\tnodes[i].remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * IE cannot set custom contentType's on drag events, and also does not properly drag/drop between\n\t\t * editors. This uses a special data:text/mce-internal URL to pass data when drag/drop between editors.\n\t\t */\n\t\tfunction ieInternalDragAndDrop() {\n\t\t\teditor.on('dragstart', function(e) {\n\t\t\t\tsetMceInternalContent(e);\n\t\t\t});\n\n\t\t\teditor.on('drop', function(e) {\n\t\t\t\tif (!isDefaultPrevented(e)) {\n\t\t\t\t\tvar internalContent = getMceInternalContent(e);\n\n\t\t\t\t\tif (internalContent && internalContent.id != editor.id) {\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tvar rng = RangeUtils.getCaretRangeFromPoint(e.x, e.y, editor.getDoc());\n\t\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t\t\tinsertClipboardContents(internalContent.html);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction refreshContentEditable() {\n\t\t\t// No-op since Mozilla seems to have fixed the caret repaint issues\n\t\t}\n\n\t\tfunction isHidden() {\n\t\t\tvar sel;\n\n\t\t\tif (!isGecko) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\t// Weird, wheres that cursor selection?\n\t\t\tsel = editor.selection.getSel();\n\t\t\treturn (!sel || !sel.rangeCount || sel.rangeCount === 0);\n\t\t}\n\n\t\t/**\n\t\t * Properly empties the editor if all contents is selected and deleted this to\n\t\t * prevent empty paragraphs from being produced at beginning/end of contents.\n\t\t */\n\t\tfunction emptyEditorOnDeleteEverything() {\n\t\t\tfunction isEverythingSelected(editor) {\n\t\t\t\tvar caretWalker = new CaretWalker(editor.getBody());\n\t\t\t\tvar rng = editor.selection.getRng();\n\t\t\t\tvar startCaretPos = CaretPosition.fromRangeStart(rng);\n\t\t\t\tvar endCaretPos = CaretPosition.fromRangeEnd(rng);\n\t\t\t\tvar prev = caretWalker.prev(startCaretPos);\n\t\t\t\tvar next = caretWalker.next(endCaretPos);\n\n\t\t\t\treturn !editor.selection.isCollapsed() &&\n\t\t\t\t\t(!prev || (prev.isAtStart() && startCaretPos.isEqual(prev))) &&\n\t\t\t\t\t(!next || (next.isAtEnd() && startCaretPos.isEqual(next)));\n\t\t\t}\n\n\t\t\t// Type over case delete and insert this won't cover typeover with a IME but at least it covers the common case\n\t\t\teditor.on('keypress', function (e) {\n\t\t\t\tif (!isDefaultPrevented(e) && !selection.isCollapsed() && e.charCode > 31 && !VK.metaKeyPressed(e)) {\n\t\t\t\t\tif (isEverythingSelected(editor)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\teditor.setContent(String.fromCharCode(e.charCode));\n\t\t\t\t\t\teditor.selection.select(editor.getBody(), true);\n\t\t\t\t\t\teditor.selection.collapse(false);\n\t\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('keydown', function (e) {\n\t\t\t\tvar keyCode = e.keyCode;\n\n\t\t\t\tif (!isDefaultPrevented(e) && (keyCode == DELETE || keyCode == BACKSPACE)) {\n\t\t\t\t\tif (isEverythingSelected(editor)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\teditor.setContent('');\n\t\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// All browsers\n\t\tremoveBlockQuoteOnBackSpace();\n\t\temptyEditorWhenDeleting();\n\n\t\t// Windows phone will return a range like [body, 0] on mousedown so\n\t\t// it will always normalize to the wrong location\n\t\tif (!Env.windowsPhone) {\n\t\t\tnormalizeSelection();\n\t\t}\n\n\t\t// WebKit\n\t\tif (isWebKit) {\n\t\t\temptyEditorOnDeleteEverything();\n\t\t\tcleanupStylesWhenDeleting();\n\t\t\tinputMethodFocus();\n\t\t\tselectControlElements();\n\t\t\tsetDefaultBlockType();\n\t\t\tblockFormSubmitInsideEditor();\n\t\t\tdisableBackspaceIntoATable();\n\t\t\tremoveAppleInterchangeBrs();\n\n\t\t\t//touchClickEvent();\n\n\t\t\t// iOS\n\t\t\tif (Env.iOS) {\n\t\t\t\trestoreFocusOnKeyDown();\n\t\t\t\tbodyHeight();\n\t\t\t\ttapLinksAndImages();\n\t\t\t} else {\n\t\t\t\tselectAll();\n\t\t\t}\n\t\t}\n\n\t\t// IE\n\t\tif (isIE && Env.ie < 11) {\n\t\t\tremoveHrOnBackspace();\n\t\t\tensureBodyHasRoleApplication();\n\t\t\taddNewLinesBeforeBrInPre();\n\t\t\tremovePreSerializedStylesWhenSelectingControls();\n\t\t\tdeleteControlItemOnBackSpace();\n\t\t\trenderEmptyBlocksFix();\n\t\t\tkeepNoScriptContents();\n\t\t\tfixCaretSelectionOfDocumentElementOnIe();\n\t\t}\n\n\t\tif (Env.ie >= 11) {\n\t\t\tbodyHeight();\n\t\t\tdisableBackspaceIntoATable();\n\t\t}\n\n\t\tif (Env.ie) {\n\t\t\tselectAll();\n\t\t\tdisableAutoUrlDetect();\n\t\t\tieInternalDragAndDrop();\n\t\t}\n\n\t\t// Gecko\n\t\tif (isGecko) {\n\t\t\temptyEditorOnDeleteEverything();\n\t\t\tremoveHrOnBackspace();\n\t\t\tfocusBody();\n\t\t\tremoveStylesWhenDeletingAcrossBlockElements();\n\t\t\tsetGeckoEditingOptions();\n\t\t\taddBrAfterLastLinks();\n\t\t\tshowBrokenImageIcon();\n\t\t\tblockCmdArrowNavigation();\n\t\t\tdisableBackspaceIntoATable();\n\t\t}\n\n\t\treturn {\n\t\t\trefreshContentEditable: refreshContentEditable,\n\t\t\tisHidden: isHidden\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/EditorObservable.js\n\n/**\n * EditorObservable.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This mixin contains the event logic for the tinymce.Editor class.\n *\n * @mixin tinymce.EditorObservable\n * @extends tinymce.util.Observable\n */\ndefine(\"tinymce/EditorObservable\", [\n\t\"tinymce/util/Observable\",\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/util/Tools\"\n], function(Observable, DOMUtils, Tools) {\n\tvar DOM = DOMUtils.DOM, customEventRootDelegates;\n\n\t/**\n\t * Returns the event target so for the specified event. Some events fire\n\t * only on document, some fire on documentElement etc. This also handles the\n\t * custom event root setting where it returns that element instead of the body.\n\t *\n\t * @private\n\t * @param {tinymce.Editor} editor Editor instance to get event target from.\n\t * @param {String} eventName Name of the event for example \"click\".\n\t * @return {Element/Document} HTML Element or document target to bind on.\n\t */\n\tfunction getEventTarget(editor, eventName) {\n\t\tif (eventName == 'selectionchange') {\n\t\t\treturn editor.getDoc();\n\t\t}\n\n\t\t// Need to bind mousedown/mouseup etc to document not body in iframe mode\n\t\t// Since the user might click on the HTML element not the BODY\n\t\tif (!editor.inline && /^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName)) {\n\t\t\treturn editor.getDoc().documentElement;\n\t\t}\n\n\t\t// Bind to event root instead of body if it's defined\n\t\tif (editor.settings.event_root) {\n\t\t\tif (!editor.eventRoot) {\n\t\t\t\teditor.eventRoot = DOM.select(editor.settings.event_root)[0];\n\t\t\t}\n\n\t\t\treturn editor.eventRoot;\n\t\t}\n\n\t\treturn editor.getBody();\n\t}\n\n\t/**\n\t * Binds a event delegate for the specified name this delegate will fire\n\t * the event to the editor dispatcher.\n\t *\n\t * @private\n\t * @param {tinymce.Editor} editor Editor instance to get event target from.\n\t * @param {String} eventName Name of the event for example \"click\".\n\t */\n\tfunction bindEventDelegate(editor, eventName) {\n\t\tvar eventRootElm = getEventTarget(editor, eventName), delegate;\n\n\t\tfunction isListening(editor) {\n\t\t\treturn !editor.hidden && !editor.readonly;\n\t\t}\n\n\t\tif (!editor.delegates) {\n\t\t\teditor.delegates = {};\n\t\t}\n\n\t\tif (editor.delegates[eventName]) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (editor.settings.event_root) {\n\t\t\tif (!customEventRootDelegates) {\n\t\t\t\tcustomEventRootDelegates = {};\n\t\t\t\teditor.editorManager.on('removeEditor', function() {\n\t\t\t\t\tvar name;\n\n\t\t\t\t\tif (!editor.editorManager.activeEditor) {\n\t\t\t\t\t\tif (customEventRootDelegates) {\n\t\t\t\t\t\t\tfor (name in customEventRootDelegates) {\n\t\t\t\t\t\t\t\teditor.dom.unbind(getEventTarget(editor, name));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcustomEventRootDelegates = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (customEventRootDelegates[eventName]) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdelegate = function(e) {\n\t\t\t\tvar target = e.target, editors = editor.editorManager.editors, i = editors.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tvar body = editors[i].getBody();\n\n\t\t\t\t\tif (body === target || DOM.isChildOf(target, body)) {\n\t\t\t\t\t\tif (isListening(editors[i])) {\n\t\t\t\t\t\t\teditors[i].fire(eventName, e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tcustomEventRootDelegates[eventName] = delegate;\n\t\t\tDOM.bind(eventRootElm, eventName, delegate);\n\t\t} else {\n\t\t\tdelegate = function(e) {\n\t\t\t\tif (isListening(editor)) {\n\t\t\t\t\teditor.fire(eventName, e);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tDOM.bind(eventRootElm, eventName, delegate);\n\t\t\teditor.delegates[eventName] = delegate;\n\t\t}\n\t}\n\n\tvar EditorObservable = {\n\t\t/**\n\t\t * Bind any pending event delegates. This gets executed after the target body/document is created.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tbindPendingEventDelegates: function() {\n\t\t\tvar self = this;\n\n\t\t\tTools.each(self._pendingNativeEvents, function(name) {\n\t\t\t\tbindEventDelegate(self, name);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Toggles a native event on/off this is called by the EventDispatcher when\n\t\t * the first native event handler is added and when the last native event handler is removed.\n\t\t *\n\t\t * @private\n\t\t */\n\t\ttoggleNativeEvent: function(name, state) {\n\t\t\tvar self = this;\n\n\t\t\t// Never bind focus/blur since the FocusManager fakes those\n\t\t\tif (name == \"focus\" || name == \"blur\") {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (state) {\n\t\t\t\tif (self.initialized) {\n\t\t\t\t\tbindEventDelegate(self, name);\n\t\t\t\t} else {\n\t\t\t\t\tif (!self._pendingNativeEvents) {\n\t\t\t\t\t\tself._pendingNativeEvents = [name];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself._pendingNativeEvents.push(name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (self.initialized) {\n\t\t\t\tself.dom.unbind(getEventTarget(self, name), name, self.delegates[name]);\n\t\t\t\tdelete self.delegates[name];\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Unbinds all native event handlers that means delegates, custom events bound using the Events API etc.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tunbindAllNativeEvents: function() {\n\t\t\tvar self = this, name;\n\n\t\t\tif (self.delegates) {\n\t\t\t\tfor (name in self.delegates) {\n\t\t\t\t\tself.dom.unbind(getEventTarget(self, name), name, self.delegates[name]);\n\t\t\t\t}\n\n\t\t\t\tdelete self.delegates;\n\t\t\t}\n\n\t\t\tif (!self.inline) {\n\t\t\t\tself.getBody().onload = null;\n\t\t\t\tself.dom.unbind(self.getWin());\n\t\t\t\tself.dom.unbind(self.getDoc());\n\t\t\t}\n\n\t\t\tself.dom.unbind(self.getBody());\n\t\t\tself.dom.unbind(self.getContainer());\n\t\t}\n\t};\n\n\tEditorObservable = Tools.extend({}, Observable, EditorObservable);\n\n\treturn EditorObservable;\n});\n\n// Included from: js/tinymce/classes/Mode.js\n\n/**\n * Mode.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Mode switcher logic.\n *\n * @private\n * @class tinymce.Mode\n */\ndefine(\"tinymce/Mode\", [], function() {\n\tfunction setEditorCommandState(editor, cmd, state) {\n\t\ttry {\n\t\t\teditor.getDoc().execCommand(cmd, false, state);\n\t\t} catch (ex) {\n\t\t\t// Ignore\n\t\t}\n\t}\n\n\tfunction clickBlocker(editor) {\n\t\tvar target, handler;\n\n\t\ttarget = editor.getBody();\n\n\t\thandler = function(e) {\n\t\t\tif (editor.dom.getParents(e.target, 'a').length > 0) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t};\n\n\t\teditor.dom.bind(target, 'click', handler);\n\n\t\treturn {\n\t\t\tunbind: function() {\n\t\t\t\teditor.dom.unbind(target, 'click', handler);\n\t\t\t}\n\t\t};\n\t}\n\n\tfunction toggleReadOnly(editor, state) {\n\t\tif (editor._clickBlocker) {\n\t\t\teditor._clickBlocker.unbind();\n\t\t\teditor._clickBlocker = null;\n\t\t}\n\n\t\tif (state) {\n\t\t\teditor._clickBlocker = clickBlocker(editor);\n\t\t\teditor.selection.controlSelection.hideResizeRect();\n\t\t\teditor.readonly = true;\n\t\t\teditor.getBody().contentEditable = false;\n\t\t} else {\n\t\t\teditor.readonly = false;\n\t\t\teditor.getBody().contentEditable = true;\n\t\t\tsetEditorCommandState(editor, \"StyleWithCSS\", false);\n\t\t\tsetEditorCommandState(editor, \"enableInlineTableEditing\", false);\n\t\t\tsetEditorCommandState(editor, \"enableObjectResizing\", false);\n\t\t\teditor.focus();\n\t\t\teditor.nodeChanged();\n\t\t}\n\t}\n\n\tfunction setMode(editor, mode) {\n\t\tvar currentMode = editor.readonly ? 'readonly' : 'design';\n\n\t\tif (mode == currentMode) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (editor.initialized) {\n\t\t\ttoggleReadOnly(editor, mode == 'readonly');\n\t\t} else {\n\t\t\teditor.on('init', function() {\n\t\t\t\ttoggleReadOnly(editor, mode == 'readonly');\n\t\t\t});\n\t\t}\n\n\t\t// Event is NOT preventable\n\t\teditor.fire('SwitchMode', {mode: mode});\n\t}\n\n\treturn {\n\t\tsetMode: setMode\n\t};\n});\n\n// Included from: js/tinymce/classes/Shortcuts.js\n\n/**\n * Shortcuts.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Contains all logic for handling of keyboard shortcuts.\n *\n * @class tinymce.Shortcuts\n * @example\n * editor.shortcuts.add('ctrl+a', function() {});\n * editor.shortcuts.add('meta+a', function() {}); // \"meta\" maps to Command on Mac and Ctrl on PC\n * editor.shortcuts.add('ctrl+alt+a', function() {});\n * editor.shortcuts.add('access+a', function() {}); // \"access\" maps to ctrl+alt on Mac and shift+alt on PC\n */\ndefine(\"tinymce/Shortcuts\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/Env\"\n], function(Tools, Env) {\n\tvar each = Tools.each, explode = Tools.explode;\n\n\tvar keyCodeLookup = {\n\t\t\"f9\": 120,\n\t\t\"f10\": 121,\n\t\t\"f11\": 122\n\t};\n\n\tvar modifierNames = Tools.makeMap('alt,ctrl,shift,meta,access');\n\n\treturn function(editor) {\n\t\tvar self = this, shortcuts = {}, pendingPatterns = [];\n\n\t\tfunction parseShortcut(pattern) {\n\t\t\tvar id, key, shortcut = {};\n\n\t\t\t// Parse modifiers and keys ctrl+alt+b for example\n\t\t\teach(explode(pattern, '+'), function(value) {\n\t\t\t\tif (value in modifierNames) {\n\t\t\t\t\tshortcut[value] = true;\n\t\t\t\t} else {\n\t\t\t\t\t// Allow numeric keycodes like ctrl+219 for ctrl+[\n\t\t\t\t\tif (/^[0-9]{2,}$/.test(value)) {\n\t\t\t\t\t\tshortcut.keyCode = parseInt(value, 10);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tshortcut.charCode = value.charCodeAt(0);\n\t\t\t\t\t\tshortcut.keyCode = keyCodeLookup[value] || value.toUpperCase().charCodeAt(0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Generate unique id for modifier combination and set default state for unused modifiers\n\t\t\tid = [shortcut.keyCode];\n\t\t\tfor (key in modifierNames) {\n\t\t\t\tif (shortcut[key]) {\n\t\t\t\t\tid.push(key);\n\t\t\t\t} else {\n\t\t\t\t\tshortcut[key] = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tshortcut.id = id.join(',');\n\n\t\t\t// Handle special access modifier differently depending on Mac/Win\n\t\t\tif (shortcut.access) {\n\t\t\t\tshortcut.alt = true;\n\n\t\t\t\tif (Env.mac) {\n\t\t\t\t\tshortcut.ctrl = true;\n\t\t\t\t} else {\n\t\t\t\t\tshortcut.shift = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Handle special meta modifier differently depending on Mac/Win\n\t\t\tif (shortcut.meta) {\n\t\t\t\tif (Env.mac) {\n\t\t\t\t\tshortcut.meta = true;\n\t\t\t\t} else {\n\t\t\t\t\tshortcut.ctrl = true;\n\t\t\t\t\tshortcut.meta = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn shortcut;\n\t\t}\n\n\t\tfunction createShortcut(pattern, desc, cmdFunc, scope) {\n\t\t\tvar shortcuts;\n\n\t\t\tshortcuts = Tools.map(explode(pattern, '>'), parseShortcut);\n\t\t\tshortcuts[shortcuts.length - 1] = Tools.extend(shortcuts[shortcuts.length - 1], {\n\t\t\t\tfunc: cmdFunc,\n\t\t\t\tscope: scope || editor\n\t\t\t});\n\n\t\t\treturn Tools.extend(shortcuts[0], {\n\t\t\t\tdesc: editor.translate(desc),\n\t\t\t\tsubpatterns: shortcuts.slice(1)\n\t\t\t});\n\t\t}\n\n\t\tfunction hasModifier(e) {\n\t\t\treturn e.altKey || e.ctrlKey || e.metaKey;\n\t\t}\n\n\t\tfunction isFunctionKey(e) {\n\t\t\treturn e.type === \"keydown\" && e.keyCode >= 112 && e.keyCode <= 123;\n\t\t}\n\n\t\tfunction matchShortcut(e, shortcut) {\n\t\t\tif (!shortcut) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (shortcut.ctrl != e.ctrlKey || shortcut.meta != e.metaKey) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (shortcut.alt != e.altKey || shortcut.shift != e.shiftKey) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (e.keyCode == shortcut.keyCode || (e.charCode && e.charCode == shortcut.charCode)) {\n\t\t\t\te.preventDefault();\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction executeShortcutAction(shortcut) {\n\t\t\treturn shortcut.func ? shortcut.func.call(shortcut.scope) : null;\n\t\t}\n\n\t\teditor.on('keyup keypress keydown', function(e) {\n\t\t\tif ((hasModifier(e) || isFunctionKey(e)) && !e.isDefaultPrevented()) {\n\t\t\t\teach(shortcuts, function(shortcut) {\n\t\t\t\t\tif (matchShortcut(e, shortcut)) {\n\t\t\t\t\t\tpendingPatterns = shortcut.subpatterns.slice(0);\n\n\t\t\t\t\t\tif (e.type == \"keydown\") {\n\t\t\t\t\t\t\texecuteShortcutAction(shortcut);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (matchShortcut(e, pendingPatterns[0])) {\n\t\t\t\t\tif (pendingPatterns.length === 1) {\n\t\t\t\t\t\tif (e.type == \"keydown\") {\n\t\t\t\t\t\t\texecuteShortcutAction(pendingPatterns[0]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tpendingPatterns.shift();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t/**\n\t\t * Adds a keyboard shortcut for some command or function.\n\t\t *\n\t\t * @method add\n\t\t * @param {String} pattern Shortcut pattern. Like for example: ctrl+alt+o.\n\t\t * @param {String} desc Text description for the command.\n\t\t * @param {String/Function} cmdFunc Command name string or function to execute when the key is pressed.\n\t\t * @param {Object} scope Optional scope to execute the function in.\n\t\t * @return {Boolean} true/false state if the shortcut was added or not.\n\t\t */\n\t\tself.add = function(pattern, desc, cmdFunc, scope) {\n\t\t\tvar cmd;\n\n\t\t\tcmd = cmdFunc;\n\n\t\t\tif (typeof cmdFunc === 'string') {\n\t\t\t\tcmdFunc = function() {\n\t\t\t\t\teditor.execCommand(cmd, false, null);\n\t\t\t\t};\n\t\t\t} else if (Tools.isArray(cmd)) {\n\t\t\t\tcmdFunc = function() {\n\t\t\t\t\teditor.execCommand(cmd[0], cmd[1], cmd[2]);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\teach(explode(Tools.trim(pattern.toLowerCase())), function(pattern) {\n\t\t\t\tvar shortcut = createShortcut(pattern, desc, cmdFunc, scope);\n\t\t\t\tshortcuts[shortcut.id] = shortcut;\n\t\t\t});\n\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * Remove a keyboard shortcut by pattern.\n\t\t *\n\t\t * @method remove\n\t\t * @param {String} pattern Shortcut pattern. Like for example: ctrl+alt+o.\n\t\t * @return {Boolean} true/false state if the shortcut was removed or not.\n\t\t */\n\t\tself.remove = function(pattern) {\n\t\t\tvar shortcut = createShortcut(pattern);\n\n\t\t\tif (shortcuts[shortcut.id]) {\n\t\t\t\tdelete shortcuts[shortcut.id];\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/file/Uploader.js\n\n/**\n * Uploader.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Upload blobs or blob infos to the specified URL or handler.\n *\n * @private\n * @class tinymce.file.Uploader\n * @example\n * var uploader = new Uploader({\n *     url: '/upload.php',\n *     basePath: '/base/path',\n *     credentials: true,\n *     handler: function(data, success, failure) {\n *         ...\n *     }\n * });\n *\n * uploader.upload(blobInfos).then(function(result) {\n *     ...\n * });\n */\ndefine(\"tinymce/file/Uploader\", [\n\t\"tinymce/util/Promise\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Fun\"\n], function(Promise, Tools, Fun) {\n\treturn function(uploadStatus, settings) {\n\t\tvar pendingPromises = {};\n\n\t\tfunction filename(blobInfo) {\n\t\t\tvar ext, extensions;\n\n\t\t\textensions = {\n\t\t\t\t'image/jpeg': 'jpg',\n\t\t\t\t'image/jpg': 'jpg',\n\t\t\t\t'image/gif': 'gif',\n\t\t\t\t'image/png': 'png'\n\t\t\t};\n\n\t\t\text = extensions[blobInfo.blob().type.toLowerCase()] || 'dat';\n\n\t\t\treturn blobInfo.filename() + '.' + ext;\n\t\t}\n\n\t\tfunction pathJoin(path1, path2) {\n\t\t\tif (path1) {\n\t\t\t\treturn path1.replace(/\\/$/, '') + '/' + path2.replace(/^\\//, '');\n\t\t\t}\n\n\t\t\treturn path2;\n\t\t}\n\n\t\tfunction blobInfoToData(blobInfo) {\n\t\t\treturn {\n\t\t\t\tid: blobInfo.id,\n\t\t\t\tblob: blobInfo.blob,\n\t\t\t\tbase64: blobInfo.base64,\n\t\t\t\tfilename: Fun.constant(filename(blobInfo))\n\t\t\t};\n\t\t}\n\n\t\tfunction defaultHandler(blobInfo, success, failure, progress) {\n\t\t\tvar xhr, formData;\n\n\t\t\txhr = new XMLHttpRequest();\n\t\t\txhr.open('POST', settings.url);\n\t\t\txhr.withCredentials = settings.credentials;\n\n\t\t\txhr.upload.onprogress = function(e) {\n\t\t\t\tprogress(e.loaded / e.total * 100);\n\t\t\t};\n\n\t\t\txhr.onerror = function() {\n\t\t\t\tfailure(\"Image upload failed due to a XHR Transport error. Code: \" + xhr.status);\n\t\t\t};\n\n\t\t\txhr.onload = function() {\n\t\t\t\tvar json;\n\n\t\t\t\tif (xhr.status != 200) {\n\t\t\t\t\tfailure(\"HTTP Error: \" + xhr.status);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tjson = JSON.parse(xhr.responseText);\n\n\t\t\t\tif (!json || typeof json.location != \"string\") {\n\t\t\t\t\tfailure(\"Invalid JSON: \" + xhr.responseText);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsuccess(pathJoin(settings.basePath, json.location));\n\t\t\t};\n\n\t\t\tformData = new FormData();\n\t\t\tformData.append('file', blobInfo.blob(), blobInfo.filename());\n\n\t\t\txhr.send(formData);\n\t\t}\n\n\t\tfunction noUpload() {\n\t\t\treturn new Promise(function(resolve) {\n\t\t\t\tresolve([]);\n\t\t\t});\n\t\t}\n\n\t\tfunction handlerSuccess(blobInfo, url) {\n\t\t\treturn {\n\t\t\t\turl: url,\n\t\t\t\tblobInfo: blobInfo,\n\t\t\t\tstatus: true\n\t\t\t};\n\t\t}\n\n\t\tfunction handlerFailure(blobInfo, error) {\n\t\t\treturn {\n\t\t\t\turl: '',\n\t\t\t\tblobInfo: blobInfo,\n\t\t\t\tstatus: false,\n\t\t\t\terror: error\n\t\t\t};\n\t\t}\n\n\t\tfunction resolvePending(blobUri, result) {\n\t\t\tTools.each(pendingPromises[blobUri], function(resolve) {\n\t\t\t\tresolve(result);\n\t\t\t});\n\n\t\t\tdelete pendingPromises[blobUri];\n\t\t}\n\n\t\tfunction uploadBlobInfo(blobInfo, handler, openNotification) {\n\t\t\tuploadStatus.markPending(blobInfo.blobUri());\n\n\t\t\treturn new Promise(function(resolve) {\n\t\t\t\tvar notification, progress;\n\n\t\t\t\tvar noop = function() {\n\t\t\t\t};\n\n\t\t\t\ttry {\n\t\t\t\t\tvar closeNotification = function() {\n\t\t\t\t\t\tif (notification) {\n\t\t\t\t\t\t\tnotification.close();\n\t\t\t\t\t\t\tprogress = noop; // Once it's closed it's closed\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tvar success = function(url) {\n\t\t\t\t\t\tcloseNotification();\n\t\t\t\t\t\tuploadStatus.markUploaded(blobInfo.blobUri(), url);\n\t\t\t\t\t\tresolvePending(blobInfo.blobUri(), handlerSuccess(blobInfo, url));\n\t\t\t\t\t\tresolve(handlerSuccess(blobInfo, url));\n\t\t\t\t\t};\n\n\t\t\t\t\tvar failure = function(error) {\n\t\t\t\t\t\tcloseNotification();\n\t\t\t\t\t\tuploadStatus.removeFailed(blobInfo.blobUri());\n\t\t\t\t\t\tresolvePending(blobInfo.blobUri(), handlerFailure(blobInfo, error));\n\t\t\t\t\t\tresolve(handlerFailure(blobInfo, error));\n\t\t\t\t\t};\n\n\t\t\t\t\tprogress = function(percent) {\n\t\t\t\t\t\tif (percent < 0 || percent > 100) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!notification) {\n\t\t\t\t\t\t\tnotification = openNotification();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnotification.progressBar.value(percent);\n\t\t\t\t\t};\n\n\t\t\t\t\thandler(blobInfoToData(blobInfo), success, failure, progress);\n\t\t\t\t} catch (ex) {\n\t\t\t\t\tresolve(handlerFailure(blobInfo, ex.message));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction isDefaultHandler(handler) {\n\t\t\treturn handler === defaultHandler;\n\t\t}\n\n\t\tfunction pendingUploadBlobInfo(blobInfo) {\n\t\t\tvar blobUri = blobInfo.blobUri();\n\n\t\t\treturn new Promise(function(resolve) {\n\t\t\t\tpendingPromises[blobUri] = pendingPromises[blobUri] || [];\n\t\t\t\tpendingPromises[blobUri].push(resolve);\n\t\t\t});\n\t\t}\n\n\t\tfunction uploadBlobs(blobInfos, openNotification) {\n\t\t\tblobInfos = Tools.grep(blobInfos, function(blobInfo) {\n\t\t\t\treturn !uploadStatus.isUploaded(blobInfo.blobUri());\n\t\t\t});\n\n\t\t\treturn Promise.all(Tools.map(blobInfos, function(blobInfo) {\n\t\t\t\treturn uploadStatus.isPending(blobInfo.blobUri()) ?\n\t\t\t\t\tpendingUploadBlobInfo(blobInfo) : uploadBlobInfo(blobInfo, settings.handler, openNotification);\n\t\t\t}));\n\t\t}\n\n\t\tfunction upload(blobInfos, openNotification) {\n\t\t\treturn (!settings.url && isDefaultHandler(settings.handler)) ? noUpload() : uploadBlobs(blobInfos, openNotification);\n\t\t}\n\n\t\tsettings = Tools.extend({\n\t\t\tcredentials: false,\n\t\t\t// We are adding a notify argument to this (at the moment, until it doesn't work)\n\t\t\thandler: defaultHandler\n\t\t}, settings);\n\n\t\treturn {\n\t\t\tupload: upload\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/file/Conversions.js\n\n/**\n * Conversions.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Converts blob/uris back and forth.\n *\n * @private\n * @class tinymce.file.Conversions\n */\ndefine(\"tinymce/file/Conversions\", [\n\t\"tinymce/util/Promise\"\n], function(Promise) {\n\tfunction blobUriToBlob(url) {\n\t\treturn new Promise(function(resolve) {\n\t\t\tvar xhr = new XMLHttpRequest();\n\n\t\t\txhr.open('GET', url, true);\n\t\t\txhr.responseType = 'blob';\n\n\t\t\txhr.onload = function() {\n\t\t\t\tif (this.status == 200) {\n\t\t\t\t\tresolve(this.response);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\txhr.send();\n\t\t});\n\t}\n\n\tfunction parseDataUri(uri) {\n\t\tvar type, matches;\n\n\t\turi = decodeURIComponent(uri).split(',');\n\n\t\tmatches = /data:([^;]+)/.exec(uri[0]);\n\t\tif (matches) {\n\t\t\ttype = matches[1];\n\t\t}\n\n\t\treturn {\n\t\t\ttype: type,\n\t\t\tdata: uri[1]\n\t\t};\n\t}\n\n\tfunction dataUriToBlob(uri) {\n\t\treturn new Promise(function(resolve) {\n\t\t\tvar str, arr, i;\n\n\t\t\turi = parseDataUri(uri);\n\n\t\t\t// Might throw error if data isn't proper base64\n\t\t\ttry {\n\t\t\t\tstr = atob(uri.data);\n\t\t\t} catch (e) {\n\t\t\t\tresolve(new Blob([]));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tarr = new Uint8Array(str.length);\n\n\t\t\tfor (i = 0; i < arr.length; i++) {\n\t\t\t\tarr[i] = str.charCodeAt(i);\n\t\t\t}\n\n\t\t\tresolve(new Blob([arr], {type: uri.type}));\n\t\t});\n\t}\n\n\tfunction uriToBlob(url) {\n\t\tif (url.indexOf('blob:') === 0) {\n\t\t\treturn blobUriToBlob(url);\n\t\t}\n\n\t\tif (url.indexOf('data:') === 0) {\n\t\t\treturn dataUriToBlob(url);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction blobToDataUri(blob) {\n\t\treturn new Promise(function(resolve) {\n\t\t\tvar reader = new FileReader();\n\n\t\t\treader.onloadend = function() {\n\t\t\t\tresolve(reader.result);\n\t\t\t};\n\n\t\t\treader.readAsDataURL(blob);\n\t\t});\n\t}\n\n\treturn {\n\t\turiToBlob: uriToBlob,\n\t\tblobToDataUri: blobToDataUri,\n\t\tparseDataUri: parseDataUri\n\t};\n});\n\n// Included from: js/tinymce/classes/file/ImageScanner.js\n\n/**\n * ImageScanner.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Finds images with data uris or blob uris. If data uris are found it will convert them into blob uris.\n *\n * @private\n * @class tinymce.file.ImageScanner\n */\ndefine(\"tinymce/file/ImageScanner\", [\n\t\"tinymce/util/Promise\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/util/Fun\",\n\t\"tinymce/file/Conversions\",\n\t\"tinymce/Env\"\n], function(Promise, Arr, Fun, Conversions, Env) {\n\tvar count = 0;\n\n\tvar uniqueId = function(prefix) {\n\t\treturn (prefix || 'blobid') + (count++);\n\t};\n\n\treturn function(uploadStatus, blobCache) {\n\t\tvar cachedPromises = {};\n\n\t\tfunction findAll(elm, predicate) {\n\t\t\tvar images, promises;\n\n\t\t\tfunction imageToBlobInfo(img, resolve) {\n\t\t\t\tvar base64, blobInfo;\n\n\t\t\t\tif (img.src.indexOf('blob:') === 0) {\n\t\t\t\t\tblobInfo = blobCache.getByUri(img.src);\n\n\t\t\t\t\tif (blobInfo) {\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\timage: img,\n\t\t\t\t\t\t\tblobInfo: blobInfo\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tConversions.uriToBlob(img.src).then(function (blob) {\n\t\t\t\t\t\t\tConversions.blobToDataUri(blob).then(function (dataUri) {\n\t\t\t\t\t\t\t\tbase64 = Conversions.parseDataUri(dataUri).data;\n\t\t\t\t\t\t\t\tblobInfo = blobCache.create(uniqueId(), blob, base64);\n\t\t\t\t\t\t\t\tblobCache.add(blobInfo);\n\n\t\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\t\timage: img,\n\t\t\t\t\t\t\t\t\tblobInfo: blobInfo\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tbase64 = Conversions.parseDataUri(img.src).data;\n\t\t\t\tblobInfo = blobCache.findFirst(function(cachedBlobInfo) {\n\t\t\t\t\treturn cachedBlobInfo.base64() === base64;\n\t\t\t\t});\n\n\t\t\t\tif (blobInfo) {\n\t\t\t\t\tresolve({\n\t\t\t\t\t\timage: img,\n\t\t\t\t\t\tblobInfo: blobInfo\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tConversions.uriToBlob(img.src).then(function(blob) {\n\t\t\t\t\t\tblobInfo = blobCache.create(uniqueId(), blob, base64);\n\t\t\t\t\t\tblobCache.add(blobInfo);\n\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\timage: img,\n\t\t\t\t\t\t\tblobInfo: blobInfo\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!predicate) {\n\t\t\t\tpredicate = Fun.constant(true);\n\t\t\t}\n\n\t\t\timages = Arr.filter(elm.getElementsByTagName('img'), function(img) {\n\t\t\t\tvar src = img.src;\n\n\t\t\t\tif (!Env.fileApi) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (img.hasAttribute('data-mce-bogus')) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (img.hasAttribute('data-mce-placeholder')) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (!src || src == Env.transparentSrc) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (src.indexOf('blob:') === 0) {\n\t\t\t\t\treturn !uploadStatus.isUploaded(src);\n\t\t\t\t}\n\n\t\t\t\tif (src.indexOf('data:') === 0) {\n\t\t\t\t\treturn predicate(img);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\tpromises = Arr.map(images, function(img) {\n\t\t\t\tvar newPromise;\n\n\t\t\t\tif (cachedPromises[img.src]) {\n\t\t\t\t\t// Since the cached promise will return the cached image\n\t\t\t\t\t// We need to wrap it and resolve with the actual image\n\t\t\t\t\treturn new Promise(function(resolve) {\n\t\t\t\t\t\tcachedPromises[img.src].then(function(imageInfo) {\n\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\timage: img,\n\t\t\t\t\t\t\t\tblobInfo: imageInfo.blobInfo\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tnewPromise = new Promise(function(resolve) {\n\t\t\t\t\timageToBlobInfo(img, resolve);\n\t\t\t\t}).then(function(result) {\n\t\t\t\t\tdelete cachedPromises[result.image.src];\n\t\t\t\t\treturn result;\n\t\t\t\t})['catch'](function(error) {\n\t\t\t\t\tdelete cachedPromises[img.src];\n\t\t\t\t\treturn error;\n\t\t\t\t});\n\n\t\t\t\tcachedPromises[img.src] = newPromise;\n\n\t\t\t\treturn newPromise;\n\t\t\t});\n\n\t\t\treturn Promise.all(promises);\n\t\t}\n\n\t\treturn {\n\t\t\tfindAll: findAll\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/file/BlobCache.js\n\n/**\n * BlobCache.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Hold blob info objects where a blob has extra internal information.\n *\n * @private\n * @class tinymce.file.BlobCache\n */\ndefine(\"tinymce/file/BlobCache\", [\n\t\"tinymce/util/Arr\",\n\t\"tinymce/util/Fun\"\n], function(Arr, Fun) {\n\treturn function() {\n\t\tvar cache = [], constant = Fun.constant;\n\n\t\tfunction create(id, blob, base64, filename) {\n\t\t\treturn {\n\t\t\t\tid: constant(id),\n\t\t\t\tfilename: constant(filename || id),\n\t\t\t\tblob: constant(blob),\n\t\t\t\tbase64: constant(base64),\n\t\t\t\tblobUri: constant(URL.createObjectURL(blob))\n\t\t\t};\n\t\t}\n\n\t\tfunction add(blobInfo) {\n\t\t\tif (!get(blobInfo.id())) {\n\t\t\t\tcache.push(blobInfo);\n\t\t\t}\n\t\t}\n\n\t\tfunction get(id) {\n\t\t\treturn findFirst(function(cachedBlobInfo) {\n\t\t\t\treturn cachedBlobInfo.id() === id;\n\t\t\t});\n\t\t}\n\n\t\tfunction findFirst(predicate) {\n\t\t\treturn Arr.filter(cache, predicate)[0];\n\t\t}\n\n\t\tfunction getByUri(blobUri) {\n\t\t\treturn findFirst(function(blobInfo) {\n\t\t\t\treturn blobInfo.blobUri() == blobUri;\n\t\t\t});\n\t\t}\n\n\t\tfunction removeByUri(blobUri) {\n\t\t\tcache = Arr.filter(cache, function(blobInfo) {\n\t\t\t\tif (blobInfo.blobUri() === blobUri) {\n\t\t\t\t\tURL.revokeObjectURL(blobInfo.blobUri());\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\t\t}\n\n\t\tfunction destroy() {\n\t\t\tArr.each(cache, function(cachedBlobInfo) {\n\t\t\t\tURL.revokeObjectURL(cachedBlobInfo.blobUri());\n\t\t\t});\n\n\t\t\tcache = [];\n\t\t}\n\n\t\treturn {\n\t\t\tcreate: create,\n\t\t\tadd: add,\n\t\t\tget: get,\n\t\t\tgetByUri: getByUri,\n\t\t\tfindFirst: findFirst,\n\t\t\tremoveByUri: removeByUri,\n\t\t\tdestroy: destroy\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/file/UploadStatus.js\n\n/**\n * UploadStatus.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Holds the current status of a blob uri, if it's pending or uploaded and what the result urls was.\n *\n * @private\n * @class tinymce.file.UploadStatus\n */\ndefine(\"tinymce/file/UploadStatus\", [\n], function() {\n\treturn function() {\n\t\tvar PENDING = 1, UPLOADED = 2;\n\t\tvar blobUriStatuses = {};\n\n\t\tfunction createStatus(status, resultUri) {\n\t\t\treturn {\n\t\t\t\tstatus: status,\n\t\t\t\tresultUri: resultUri\n\t\t\t};\n\t\t}\n\n\t\tfunction hasBlobUri(blobUri) {\n\t\t\treturn blobUri in blobUriStatuses;\n\t\t}\n\n\t\tfunction getResultUri(blobUri) {\n\t\t\tvar result = blobUriStatuses[blobUri];\n\n\t\t\treturn result ? result.resultUri : null;\n\t\t}\n\n\t\tfunction isPending(blobUri) {\n\t\t\treturn hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === PENDING : false;\n\t\t}\n\n\t\tfunction isUploaded(blobUri) {\n\t\t\treturn hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === UPLOADED : false;\n\t\t}\n\n\t\tfunction markPending(blobUri) {\n\t\t\tblobUriStatuses[blobUri] = createStatus(PENDING, null);\n\t\t}\n\n\t\tfunction markUploaded(blobUri, resultUri) {\n\t\t\tblobUriStatuses[blobUri] = createStatus(UPLOADED, resultUri);\n\t\t}\n\n\t\tfunction removeFailed(blobUri) {\n\t\t\tdelete blobUriStatuses[blobUri];\n\t\t}\n\n\t\tfunction destroy() {\n\t\t\tblobUriStatuses = {};\n\t\t}\n\n\t\treturn {\n\t\t\thasBlobUri: hasBlobUri,\n\t\t\tgetResultUri: getResultUri,\n\t\t\tisPending: isPending,\n\t\t\tisUploaded: isUploaded,\n\t\t\tmarkPending: markPending,\n\t\t\tmarkUploaded: markUploaded,\n\t\t\tremoveFailed: removeFailed,\n\t\t\tdestroy: destroy\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/ErrorReporter.js\n\n/**\n * ErrorReporter.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Various error reporting helper functions.\n *\n * @class tinymce.ErrorReporter\n * @private\n */\ndefine(\"tinymce/ErrorReporter\", [\n\t\"tinymce/AddOnManager\"\n], function (AddOnManager) {\n\tvar PluginManager = AddOnManager.PluginManager;\n\n\tvar resolvePluginName = function (targetUrl, suffix) {\n\t\tfor (var name in PluginManager.urls) {\n\t\t\tvar matchUrl = PluginManager.urls[name] + '/plugin' + suffix + '.js';\n\t\t\tif (matchUrl === targetUrl) {\n\t\t\t\treturn name;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t};\n\n\tvar pluginUrlToMessage = function (editor, url) {\n\t\tvar plugin = resolvePluginName(url, editor.suffix);\n\t\treturn plugin ?\n\t\t\t'Failed to load plugin: ' + plugin + ' from url ' + url :\n\t\t\t'Failed to load plugin url: ' + url;\n\t};\n\n\tvar displayNotification = function (editor, message) {\n\t\teditor.notificationManager.open({\n\t\t\ttype: 'error',\n\t\t\ttext: message\n\t\t});\n\t};\n\n\tvar displayError = function (editor, message) {\n\t\tif (editor._skinLoaded) {\n\t\t\tdisplayNotification(editor, message);\n\t\t} else {\n\t\t\teditor.on('SkinLoaded', function () {\n\t\t\t\tdisplayNotification(editor, message);\n\t\t\t});\n\t\t}\n\t};\n\n\tvar uploadError = function (editor, message) {\n\t\tdisplayError(editor, 'Failed to upload image: ' + message);\n\t};\n\n\tvar pluginLoadError = function (editor, url) {\n\t\tdisplayError(editor, pluginUrlToMessage(editor, url));\n\t};\n\n\treturn {\n\t\tpluginLoadError: pluginLoadError,\n\t\tuploadError: uploadError\n\t};\n});\n\n// Included from: js/tinymce/classes/EditorUpload.js\n\n/**\n * EditorUpload.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Handles image uploads, updates undo stack and patches over various internal functions.\n *\n * @private\n * @class tinymce.EditorUpload\n */\ndefine(\"tinymce/EditorUpload\", [\n\t\"tinymce/util/Arr\",\n\t\"tinymce/file/Uploader\",\n\t\"tinymce/file/ImageScanner\",\n\t\"tinymce/file/BlobCache\",\n\t\"tinymce/file/UploadStatus\",\n\t\"tinymce/ErrorReporter\"\n], function(Arr, Uploader, ImageScanner, BlobCache, UploadStatus, ErrorReporter) {\n\treturn function(editor) {\n\t\tvar blobCache = new BlobCache(), uploader, imageScanner, settings = editor.settings;\n\t\tvar uploadStatus = new UploadStatus();\n\n\t\tfunction aliveGuard(callback) {\n\t\t\treturn function(result) {\n\t\t\t\tif (editor.selection) {\n\t\t\t\t\treturn callback(result);\n\t\t\t\t}\n\n\t\t\t\treturn [];\n\t\t\t};\n\t\t}\n\n\t\tfunction cacheInvalidator() {\n\t\t\treturn '?' + (new Date()).getTime();\n\t\t}\n\n\t\t// Replaces strings without regexps to avoid FF regexp to big issue\n\t\tfunction replaceString(content, search, replace) {\n\t\t\tvar index = 0;\n\n\t\t\tdo {\n\t\t\t\tindex = content.indexOf(search, index);\n\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tcontent = content.substring(0, index) + replace + content.substr(index + search.length);\n\t\t\t\t\tindex += replace.length - search.length + 1;\n\t\t\t\t}\n\t\t\t} while (index !== -1);\n\n\t\t\treturn content;\n\t\t}\n\n\t\tfunction replaceImageUrl(content, targetUrl, replacementUrl) {\n\t\t\tcontent = replaceString(content, 'src=\"' + targetUrl + '\"', 'src=\"' + replacementUrl + '\"');\n\t\t\tcontent = replaceString(content, 'data-mce-src=\"' + targetUrl + '\"', 'data-mce-src=\"' + replacementUrl + '\"');\n\n\t\t\treturn content;\n\t\t}\n\n\t\tfunction replaceUrlInUndoStack(targetUrl, replacementUrl) {\n\t\t\tArr.each(editor.undoManager.data, function(level) {\n\t\t\t\tif (level.type === 'fragmented') {\n\t\t\t\t\tlevel.fragments = Arr.map(level.fragments, function (fragment) {\n\t\t\t\t\t\treturn replaceImageUrl(fragment, targetUrl, replacementUrl);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tlevel.content = replaceImageUrl(level.content, targetUrl, replacementUrl);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction openNotification() {\n\t\t\treturn editor.notificationManager.open({\n\t\t\t\ttext: editor.translate('Image uploading...'),\n\t\t\t\ttype: 'info',\n\t\t\t\ttimeout: -1,\n\t\t\t\tprogressBar: true\n\t\t\t});\n\t\t}\n\n\t\tfunction replaceImageUri(image, resultUri) {\n\t\t\tblobCache.removeByUri(image.src);\n\t\t\treplaceUrlInUndoStack(image.src, resultUri);\n\n\t\t\teditor.$(image).attr({\n\t\t\t\tsrc: settings.images_reuse_filename ? resultUri + cacheInvalidator() : resultUri,\n\t\t\t\t'data-mce-src': editor.convertURL(resultUri, 'src')\n\t\t\t});\n\t\t}\n\n\t\tfunction uploadImages(callback) {\n\t\t\tif (!uploader) {\n\t\t\t\tuploader = new Uploader(uploadStatus, {\n\t\t\t\t\turl: settings.images_upload_url,\n\t\t\t\t\tbasePath: settings.images_upload_base_path,\n\t\t\t\t\tcredentials: settings.images_upload_credentials,\n\t\t\t\t\thandler: settings.images_upload_handler\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn scanForImages().then(aliveGuard(function(imageInfos) {\n\t\t\t\tvar blobInfos;\n\n\t\t\t\tblobInfos = Arr.map(imageInfos, function(imageInfo) {\n\t\t\t\t\treturn imageInfo.blobInfo;\n\t\t\t\t});\n\n\t\t\t\treturn uploader.upload(blobInfos, openNotification).then(aliveGuard(function(result) {\n\t\t\t\t\tresult = Arr.map(result, function(uploadInfo, index) {\n\t\t\t\t\t\tvar image = imageInfos[index].image;\n\n\t\t\t\t\t\tif (uploadInfo.status && editor.settings.images_replace_blob_uris !== false) {\n\t\t\t\t\t\t\treplaceImageUri(image, uploadInfo.url);\n\t\t\t\t\t\t} else if (uploadInfo.error) {\n\t\t\t\t\t\t\tErrorReporter.uploadError(editor, uploadInfo.error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\telement: image,\n\t\t\t\t\t\t\tstatus: uploadInfo.status\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\n\t\t\t\t\tif (callback) {\n\t\t\t\t\t\tcallback(result);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn result;\n\t\t\t\t}));\n\t\t\t}));\n\t\t}\n\n\t\tfunction uploadImagesAuto(callback) {\n\t\t\tif (settings.automatic_uploads !== false) {\n\t\t\t\treturn uploadImages(callback);\n\t\t\t}\n\t\t}\n\n\t\tfunction isValidDataUriImage(imgElm) {\n\t\t\treturn settings.images_dataimg_filter ? settings.images_dataimg_filter(imgElm) : true;\n\t\t}\n\n\t\tfunction scanForImages() {\n\t\t\tif (!imageScanner) {\n\t\t\t\timageScanner = new ImageScanner(uploadStatus, blobCache);\n\t\t\t}\n\n\t\t\treturn imageScanner.findAll(editor.getBody(), isValidDataUriImage).then(aliveGuard(function(result) {\n\t\t\t\tArr.each(result, function(resultItem) {\n\t\t\t\t\treplaceUrlInUndoStack(resultItem.image.src, resultItem.blobInfo.blobUri());\n\t\t\t\t\tresultItem.image.src = resultItem.blobInfo.blobUri();\n\t\t\t\t\tresultItem.image.removeAttribute('data-mce-src');\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t}));\n\t\t}\n\n\t\tfunction destroy() {\n\t\t\tblobCache.destroy();\n\t\t\tuploadStatus.destroy();\n\t\t\timageScanner = uploader = null;\n\t\t}\n\n\t\tfunction replaceBlobUris(content) {\n\t\t\treturn content.replace(/src=\"(blob:[^\"]+)\"/g, function(match, blobUri) {\n\t\t\t\tvar resultUri = uploadStatus.getResultUri(blobUri);\n\n\t\t\t\tif (resultUri) {\n\t\t\t\t\treturn 'src=\"' + resultUri + '\"';\n\t\t\t\t}\n\n\t\t\t\tvar blobInfo = blobCache.getByUri(blobUri);\n\n\t\t\t\tif (!blobInfo) {\n\t\t\t\t\tblobInfo = Arr.reduce(editor.editorManager.editors, function(result, editor) {\n\t\t\t\t\t\treturn result || editor.editorUpload.blobCache.getByUri(blobUri);\n\t\t\t\t\t}, null);\n\t\t\t\t}\n\n\t\t\t\tif (blobInfo) {\n\t\t\t\t\treturn 'src=\"data:' + blobInfo.blob().type + ';base64,' + blobInfo.base64() + '\"';\n\t\t\t\t}\n\n\t\t\t\treturn match;\n\t\t\t});\n\t\t}\n\n\t\teditor.on('setContent', function() {\n\t\t\tif (editor.settings.automatic_uploads !== false) {\n\t\t\t\tuploadImagesAuto();\n\t\t\t} else {\n\t\t\t\tscanForImages();\n\t\t\t}\n\t\t});\n\n\t\teditor.on('RawSaveContent', function(e) {\n\t\t\te.content = replaceBlobUris(e.content);\n\t\t});\n\n\t\teditor.on('getContent', function(e) {\n\t\t\tif (e.source_view || e.format == 'raw') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\te.content = replaceBlobUris(e.content);\n\t\t});\n\n\t\teditor.on('PostRender', function() {\n\t\t\teditor.parser.addNodeFilter('img', function(images) {\n\t\t\t\tArr.each(images, function(img) {\n\t\t\t\t\tvar src = img.attr('src');\n\n\t\t\t\t\tif (blobCache.getByUri(src)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar resultUri = uploadStatus.getResultUri(src);\n\t\t\t\t\tif (resultUri) {\n\t\t\t\t\t\timg.attr('src', resultUri);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treturn {\n\t\t\tblobCache: blobCache,\n\t\t\tuploadImages: uploadImages,\n\t\t\tuploadImagesAuto: uploadImagesAuto,\n\t\t\tscanForImages: scanForImages,\n\t\t\tdestroy: destroy\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/FakeCaret.js\n\n/**\n * FakeCaret.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module contains logic for rendering a fake visual caret.\n *\n * @private\n * @class tinymce.caret.FakeCaret\n */\ndefine(\"tinymce/caret/FakeCaret\", [\n\t\"tinymce/caret/CaretContainer\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/geom/ClientRect\",\n\t\"tinymce/util/Delay\"\n], function(CaretContainer, CaretPosition, NodeType, RangeUtils, $, ClientRect, Delay) {\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse;\n\n\treturn function(rootNode, isBlock) {\n\t\tvar cursorInterval, $lastVisualCaret, caretContainerNode;\n\n\t\tfunction getAbsoluteClientRect(node, before) {\n\t\t\tvar clientRect = ClientRect.collapse(node.getBoundingClientRect(), before),\n\t\t\t\tdocElm, scrollX, scrollY, margin, rootRect;\n\n\t\t\tif (rootNode.tagName == 'BODY') {\n\t\t\t\tdocElm = rootNode.ownerDocument.documentElement;\n\t\t\t\tscrollX = rootNode.scrollLeft || docElm.scrollLeft;\n\t\t\t\tscrollY = rootNode.scrollTop || docElm.scrollTop;\n\t\t\t} else {\n\t\t\t\trootRect = rootNode.getBoundingClientRect();\n\t\t\t\tscrollX = rootNode.scrollLeft - rootRect.left;\n\t\t\t\tscrollY = rootNode.scrollTop - rootRect.top;\n\t\t\t}\n\n\t\t\tclientRect.left += scrollX;\n\t\t\tclientRect.right += scrollX;\n\t\t\tclientRect.top += scrollY;\n\t\t\tclientRect.bottom += scrollY;\n\t\t\tclientRect.width = 1;\n\n\t\t\tmargin = node.offsetWidth - node.clientWidth;\n\n\t\t\tif (margin > 0) {\n\t\t\t\tif (before) {\n\t\t\t\t\tmargin *= -1;\n\t\t\t\t}\n\n\t\t\t\tclientRect.left += margin;\n\t\t\t\tclientRect.right += margin;\n\t\t\t}\n\n\t\t\treturn clientRect;\n\t\t}\n\n\t\tfunction trimInlineCaretContainers() {\n\t\t\tvar contentEditableFalseNodes, node, sibling, i, data;\n\n\t\t\tcontentEditableFalseNodes = $('*[contentEditable=false]', rootNode);\n\t\t\tfor (i = 0; i < contentEditableFalseNodes.length; i++) {\n\t\t\t\tnode = contentEditableFalseNodes[i];\n\n\t\t\t\tsibling = node.previousSibling;\n\t\t\t\tif (CaretContainer.endsWithCaretContainer(sibling)) {\n\t\t\t\t\tdata = sibling.data;\n\n\t\t\t\t\tif (data.length == 1) {\n\t\t\t\t\t\tsibling.parentNode.removeChild(sibling);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsibling.deleteData(data.length - 1, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tsibling = node.nextSibling;\n\t\t\t\tif (CaretContainer.startsWithCaretContainer(sibling)) {\n\t\t\t\t\tdata = sibling.data;\n\n\t\t\t\t\tif (data.length == 1) {\n\t\t\t\t\t\tsibling.parentNode.removeChild(sibling);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsibling.deleteData(0, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction show(before, node) {\n\t\t\tvar clientRect, rng;\n\n\t\t\thide();\n\n\t\t\tif (isBlock(node)) {\n\t\t\t\tcaretContainerNode = CaretContainer.insertBlock('p', node, before);\n\t\t\t\tclientRect = getAbsoluteClientRect(node, before);\n\t\t\t\t$(caretContainerNode).css('top', clientRect.top);\n\n\t\t\t\t$lastVisualCaret = $('<div class=\"mce-visual-caret\" data-mce-bogus=\"all\"></div>').css(clientRect).appendTo(rootNode);\n\n\t\t\t\tif (before) {\n\t\t\t\t\t$lastVisualCaret.addClass('mce-visual-caret-before');\n\t\t\t\t}\n\n\t\t\t\tstartBlink();\n\n\t\t\t\trng = node.ownerDocument.createRange();\n\t\t\t\trng.setStart(caretContainerNode, 0);\n\t\t\t\trng.setEnd(caretContainerNode, 0);\n\t\t\t} else {\n\t\t\t\tcaretContainerNode = CaretContainer.insertInline(node, before);\n\t\t\t\trng = node.ownerDocument.createRange();\n\n\t\t\t\tif (isContentEditableFalse(caretContainerNode.nextSibling)) {\n\t\t\t\t\trng.setStart(caretContainerNode, 0);\n\t\t\t\t\trng.setEnd(caretContainerNode, 0);\n\t\t\t\t} else {\n\t\t\t\t\trng.setStart(caretContainerNode, 1);\n\t\t\t\t\trng.setEnd(caretContainerNode, 1);\n\t\t\t\t}\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\treturn rng;\n\t\t}\n\n\t\tfunction hide() {\n\t\t\ttrimInlineCaretContainers();\n\n\t\t\tif (caretContainerNode) {\n\t\t\t\tCaretContainer.remove(caretContainerNode);\n\t\t\t\tcaretContainerNode = null;\n\t\t\t}\n\n\t\t\tif ($lastVisualCaret) {\n\t\t\t\t$lastVisualCaret.remove();\n\t\t\t\t$lastVisualCaret = null;\n\t\t\t}\n\n\t\t\tclearInterval(cursorInterval);\n\t\t}\n\n\t\tfunction startBlink() {\n\t\t\tcursorInterval = Delay.setInterval(function() {\n\t\t\t\t$('div.mce-visual-caret', rootNode).toggleClass('mce-visual-caret-hidden');\n\t\t\t}, 500);\n\t\t}\n\n\t\tfunction destroy() {\n\t\t\tDelay.clearInterval(cursorInterval);\n\t\t}\n\n\t\tfunction getCss() {\n\t\t\treturn (\n\t\t\t\t'.mce-visual-caret {' +\n\t\t\t\t\t'position: absolute;' +\n\t\t\t\t\t'background-color: black;' +\n\t\t\t\t\t'background-color: currentcolor;' +\n\t\t\t\t'}' +\n\t\t\t\t'.mce-visual-caret-hidden {' +\n\t\t\t\t\t'display: none;' +\n\t\t\t\t'}' +\n\t\t\t\t'*[data-mce-caret] {' +\n\t\t\t\t\t'position: absolute;' +\n\t\t\t\t\t'left: -1000px;' +\n\t\t\t\t\t'right: auto;' +\n\t\t\t\t\t'top: 0;' +\n\t\t\t\t\t'margin: 0;' +\n\t\t\t\t\t'padding: 0;' +\n\t\t\t\t'}'\n\t\t\t);\n\t\t}\n\n\t\treturn {\n\t\t\tshow: show,\n\t\t\thide: hide,\n\t\t\tgetCss: getCss,\n\t\t\tdestroy: destroy\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/Dimensions.js\n\n/**\n * Dimensions.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module measures nodes and returns client rects. The client rects has an\n * extra node property.\n *\n * @private\n * @class tinymce.dom.Dimensions\n */\ndefine(\"tinymce/dom/Dimensions\", [\n\t\"tinymce/util/Arr\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/geom/ClientRect\"\n], function(Arr, NodeType, ClientRect) {\n\n\tfunction getClientRects(node) {\n\t\tfunction toArrayWithNode(clientRects) {\n\t\t\treturn Arr.map(clientRects, function(clientRect) {\n\t\t\t\tclientRect = ClientRect.clone(clientRect);\n\t\t\t\tclientRect.node = node;\n\n\t\t\t\treturn clientRect;\n\t\t\t});\n\t\t}\n\n\t\tif (Arr.isArray(node)) {\n\t\t\treturn Arr.reduce(node, function(result, node) {\n\t\t\t\treturn result.concat(getClientRects(node));\n\t\t\t}, []);\n\t\t}\n\n\t\tif (NodeType.isElement(node)) {\n\t\t\treturn toArrayWithNode(node.getClientRects());\n\t\t}\n\n\t\tif (NodeType.isText(node)) {\n\t\t\tvar rng = node.ownerDocument.createRange();\n\n\t\t\trng.setStart(node, 0);\n\t\t\trng.setEnd(node, node.data.length);\n\n\t\t\treturn toArrayWithNode(rng.getClientRects());\n\t\t}\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Returns the client rects for a specific node.\n\t\t *\n\t\t * @method getClientRects\n\t\t * @param {Array/DOMNode} node Node or array of nodes to get client rects on.\n\t\t * @param {Array} Array of client rects with a extra node property.\n\t\t */\n\t\tgetClientRects: getClientRects\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/LineWalker.js\n\n/**\n * LineWalker.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module lets you walk the document line by line\n * returing nodes and client rects for each line.\n *\n * @private\n * @class tinymce.caret.LineWalker\n */\ndefine(\"tinymce/caret/LineWalker\", [\n\t\"tinymce/util/Fun\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/dom/Dimensions\",\n\t\"tinymce/caret/CaretCandidate\",\n\t\"tinymce/caret/CaretUtils\",\n\t\"tinymce/caret/CaretWalker\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/geom/ClientRect\"\n], function(Fun, Arr, Dimensions, CaretCandidate, CaretUtils, CaretWalker, CaretPosition, ClientRect) {\n\tvar curry = Fun.curry;\n\n\tfunction findUntil(direction, rootNode, predicateFn, node) {\n\t\twhile ((node = CaretUtils.findNode(node, direction, CaretCandidate.isEditableCaretCandidate, rootNode))) {\n\t\t\tif (predicateFn(node)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction walkUntil(direction, isAboveFn, isBeflowFn, rootNode, predicateFn, caretPosition) {\n\t\tvar line = 0, node, result = [], targetClientRect;\n\n\t\tfunction add(node) {\n\t\t\tvar i, clientRect, clientRects;\n\n\t\t\tclientRects = Dimensions.getClientRects(node);\n\t\t\tif (direction == -1) {\n\t\t\t\tclientRects = clientRects.reverse();\n\t\t\t}\n\n\t\t\tfor (i = 0; i < clientRects.length; i++) {\n\t\t\t\tclientRect = clientRects[i];\n\t\t\t\tif (isBeflowFn(clientRect, targetClientRect)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (result.length > 0 && isAboveFn(clientRect, Arr.last(result))) {\n\t\t\t\t\tline++;\n\t\t\t\t}\n\n\t\t\t\tclientRect.line = line;\n\n\t\t\t\tif (predicateFn(clientRect)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tresult.push(clientRect);\n\t\t\t}\n\t\t}\n\n\t\ttargetClientRect = Arr.last(caretPosition.getClientRects());\n\t\tif (!targetClientRect) {\n\t\t\treturn result;\n\t\t}\n\n\t\tnode = caretPosition.getNode();\n\t\tadd(node);\n\t\tfindUntil(direction, rootNode, add, node);\n\n\t\treturn result;\n\t}\n\n\tfunction aboveLineNumber(lineNumber, clientRect) {\n\t\treturn clientRect.line > lineNumber;\n\t}\n\n\tfunction isLine(lineNumber, clientRect) {\n\t\treturn clientRect.line === lineNumber;\n\t}\n\n\tvar upUntil = curry(walkUntil, -1, ClientRect.isAbove, ClientRect.isBelow);\n\tvar downUntil = curry(walkUntil, 1, ClientRect.isBelow, ClientRect.isAbove);\n\n\tfunction positionsUntil(direction, rootNode, predicateFn, node) {\n\t\tvar caretWalker = new CaretWalker(rootNode), walkFn, isBelowFn, isAboveFn,\n\t\t\tcaretPosition, result = [], line = 0, clientRect, targetClientRect;\n\n\t\tfunction getClientRect(caretPosition) {\n\t\t\tif (direction == 1) {\n\t\t\t\treturn Arr.last(caretPosition.getClientRects());\n\t\t\t}\n\n\t\t\treturn Arr.last(caretPosition.getClientRects());\n\t\t}\n\n\t\tif (direction == 1) {\n\t\t\twalkFn = caretWalker.next;\n\t\t\tisBelowFn = ClientRect.isBelow;\n\t\t\tisAboveFn = ClientRect.isAbove;\n\t\t\tcaretPosition = CaretPosition.after(node);\n\t\t} else {\n\t\t\twalkFn = caretWalker.prev;\n\t\t\tisBelowFn = ClientRect.isAbove;\n\t\t\tisAboveFn = ClientRect.isBelow;\n\t\t\tcaretPosition = CaretPosition.before(node);\n\t\t}\n\n\t\ttargetClientRect = getClientRect(caretPosition);\n\n\t\tdo {\n\t\t\tif (!caretPosition.isVisible()) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tclientRect = getClientRect(caretPosition);\n\n\t\t\tif (isAboveFn(clientRect, targetClientRect)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (result.length > 0 && isBelowFn(clientRect, Arr.last(result))) {\n\t\t\t\tline++;\n\t\t\t}\n\n\t\t\tclientRect = ClientRect.clone(clientRect);\n\t\t\tclientRect.position = caretPosition;\n\t\t\tclientRect.line = line;\n\n\t\t\tif (predicateFn(clientRect)) {\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tresult.push(clientRect);\n\t\t} while ((caretPosition = walkFn(caretPosition)));\n\n\t\treturn result;\n\t}\n\n\treturn {\n\t\tupUntil: upUntil,\n\t\tdownUntil: downUntil,\n\n\t\t/**\n\t\t * Find client rects with line and caret position until the predicate returns true.\n\t\t *\n\t\t * @method positionsUntil\n\t\t * @param {Number} direction Direction forward/backward 1/-1.\n\t\t * @param {DOMNode} rootNode Root node to walk within.\n\t\t * @param {function} predicateFn Gets the client rect as it's input.\n\t\t * @param {DOMNode} node Node to start walking from.\n\t\t * @return {Array} Array of client rects with line and position properties.\n\t\t */\n\t\tpositionsUntil: positionsUntil,\n\n\t\tisAboveLine: curry(aboveLineNumber),\n\t\tisLine: curry(isLine)\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/LineUtils.js\n\n/**\n * LineUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility functions for working with lines.\n *\n * @private\n * @class tinymce.caret.LineUtils\n */\ndefine(\"tinymce/caret/LineUtils\", [\n\t\"tinymce/util/Fun\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/Dimensions\",\n\t\"tinymce/geom/ClientRect\",\n\t\"tinymce/caret/CaretUtils\",\n\t\"tinymce/caret/CaretCandidate\"\n], function(Fun, Arr, NodeType, Dimensions, ClientRect, CaretUtils, CaretCandidate) {\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tfindNode = CaretUtils.findNode,\n\t\tcurry = Fun.curry;\n\n\tfunction distanceToRectLeft(clientRect, clientX) {\n\t\treturn Math.abs(clientRect.left - clientX);\n\t}\n\n\tfunction distanceToRectRight(clientRect, clientX) {\n\t\treturn Math.abs(clientRect.right - clientX);\n\t}\n\n\tfunction findClosestClientRect(clientRects, clientX) {\n\t\tfunction isInside(clientX, clientRect) {\n\t\t\treturn clientX >= clientRect.left && clientX <= clientRect.right;\n\t\t}\n\n\t\treturn Arr.reduce(clientRects, function(oldClientRect, clientRect) {\n\t\t\tvar oldDistance, newDistance;\n\n\t\t\toldDistance = Math.min(distanceToRectLeft(oldClientRect, clientX), distanceToRectRight(oldClientRect, clientX));\n\t\t\tnewDistance = Math.min(distanceToRectLeft(clientRect, clientX), distanceToRectRight(clientRect, clientX));\n\n\t\t\tif (isInside(clientX, clientRect)) {\n\t\t\t\treturn clientRect;\n\t\t\t}\n\n\t\t\tif (isInside(clientX, oldClientRect)) {\n\t\t\t\treturn oldClientRect;\n\t\t\t}\n\n\t\t\t// cE=false has higher priority\n\t\t\tif (newDistance == oldDistance && isContentEditableFalse(clientRect.node)) {\n\t\t\t\treturn clientRect;\n\t\t\t}\n\n\t\t\tif (newDistance < oldDistance) {\n\t\t\t\treturn clientRect;\n\t\t\t}\n\n\t\t\treturn oldClientRect;\n\t\t});\n\t}\n\n\tfunction walkUntil(direction, rootNode, predicateFn, node) {\n\t\twhile ((node = findNode(node, direction, CaretCandidate.isEditableCaretCandidate, rootNode))) {\n\t\t\tif (predicateFn(node)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction findLineNodeRects(rootNode, targetNodeRect) {\n\t\tvar clientRects = [];\n\n\t\tfunction collect(checkPosFn, node) {\n\t\t\tvar lineRects;\n\n\t\t\tlineRects = Arr.filter(Dimensions.getClientRects(node), function(clientRect) {\n\t\t\t\treturn !checkPosFn(clientRect, targetNodeRect);\n\t\t\t});\n\n\t\t\tclientRects = clientRects.concat(lineRects);\n\n\t\t\treturn lineRects.length === 0;\n\t\t}\n\n\t\tclientRects.push(targetNodeRect);\n\t\twalkUntil(-1, rootNode, curry(collect, ClientRect.isAbove), targetNodeRect.node);\n\t\twalkUntil(1, rootNode, curry(collect, ClientRect.isBelow), targetNodeRect.node);\n\n\t\treturn clientRects;\n\t}\n\n\tfunction getContentEditableFalseChildren(rootNode) {\n\t\treturn Arr.filter(Arr.toArray(rootNode.getElementsByTagName('*')), isContentEditableFalse);\n\t}\n\n\tfunction caretInfo(clientRect, clientX) {\n\t\treturn {\n\t\t\tnode: clientRect.node,\n\t\t\tbefore: distanceToRectLeft(clientRect, clientX) < distanceToRectRight(clientRect, clientX)\n\t\t};\n\t}\n\n\tfunction closestCaret(rootNode, clientX, clientY) {\n\t\tvar contentEditableFalseNodeRects, closestNodeRect;\n\n\t\tcontentEditableFalseNodeRects = Dimensions.getClientRects(getContentEditableFalseChildren(rootNode));\n\t\tcontentEditableFalseNodeRects = Arr.filter(contentEditableFalseNodeRects, function(clientRect) {\n\t\t\treturn clientY >= clientRect.top && clientY <= clientRect.bottom;\n\t\t});\n\n\t\tclosestNodeRect = findClosestClientRect(contentEditableFalseNodeRects, clientX);\n\t\tif (closestNodeRect) {\n\t\t\tclosestNodeRect = findClosestClientRect(findLineNodeRects(rootNode, closestNodeRect), clientX);\n\t\t\tif (closestNodeRect && isContentEditableFalse(closestNodeRect.node)) {\n\t\t\t\treturn caretInfo(closestNodeRect, clientX);\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\treturn {\n\t\tfindClosestClientRect: findClosestClientRect,\n\t\tfindLineNodeRects: findLineNodeRects,\n\t\tclosestCaret: closestCaret\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/MousePosition.js\n\n/**\n * MousePosition.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module calculates an absolute coordinate inside the editor body for both local and global mouse events.\n *\n * @private\n * @class tinymce.dom.MousePosition\n */\ndefine(\"tinymce/dom/MousePosition\", [\n], function() {\n\tvar getAbsolutePosition = function (elm) {\n\t\tvar doc, docElem, win, clientRect;\n\n\t\tclientRect = elm.getBoundingClientRect();\n\t\tdoc = elm.ownerDocument;\n\t\tdocElem = doc.documentElement;\n\t\twin = doc.defaultView;\n\n\t\treturn {\n\t\t\ttop: clientRect.top + win.pageYOffset - docElem.clientTop,\n\t\t\tleft: clientRect.left + win.pageXOffset - docElem.clientLeft\n\t\t};\n\t};\n\n\tvar getBodyPosition = function (editor) {\n\t\treturn editor.inline ? getAbsolutePosition(editor.getBody()) : {left: 0, top: 0};\n\t};\n\n\tvar getScrollPosition = function (editor) {\n\t\tvar body = editor.getBody();\n\t\treturn editor.inline ? {left: body.scrollLeft, top: body.scrollTop} : {left: 0, top: 0};\n\t};\n\n\tvar getBodyScroll = function (editor) {\n\t\tvar body = editor.getBody(), docElm = editor.getDoc().documentElement;\n\t\tvar inlineScroll = {left: body.scrollLeft, top: body.scrollTop};\n\t\tvar iframeScroll = {left: body.scrollLeft || docElm.scrollLeft, top: body.scrollTop || docElm.scrollTop};\n\n\t\treturn editor.inline ? inlineScroll : iframeScroll;\n\t};\n\n\tvar getMousePosition = function (editor, event) {\n\t\tif (event.target.ownerDocument !== editor.getDoc()) {\n\t\t\tvar iframePosition = getAbsolutePosition(editor.getContentAreaContainer());\n\t\t\tvar scrollPosition = getBodyScroll(editor);\n\n\t\t\treturn {\n\t\t\t\tleft: event.pageX - iframePosition.left + scrollPosition.left,\n\t\t\t\ttop: event.pageY - iframePosition.top + scrollPosition.top\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tleft: event.pageX,\n\t\t\ttop: event.pageY\n\t\t};\n\t};\n\n\tvar calculatePosition = function (bodyPosition, scrollPosition, mousePosition) {\n\t\treturn {\n\t\t\tpageX: (mousePosition.left - bodyPosition.left) + scrollPosition.left,\n\t\t\tpageY: (mousePosition.top - bodyPosition.top) + scrollPosition.top\n\t\t};\n\t};\n\n\tvar calc = function (editor, event) {\n\t\treturn calculatePosition(getBodyPosition(editor), getScrollPosition(editor), getMousePosition(editor, event));\n\t};\n\n\treturn {\n\t\tcalc: calc\n\t};\n});\n\n// Included from: js/tinymce/classes/DragDropOverrides.js\n\n/**\n * DragDropOverrides.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module contains logic overriding the drag/drop logic of the editor.\n *\n * @private\n * @class tinymce.DragDropOverrides\n */\ndefine(\"tinymce/DragDropOverrides\", [\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/util/Fun\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/dom/MousePosition\"\n], function(\n\tNodeType, Arr, Fun, Delay, DOMUtils, MousePosition\n) {\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tisContentEditableTrue = NodeType.isContentEditableTrue;\n\n\tvar isDraggable = function (rootElm, elm) {\n\t\treturn isContentEditableFalse(elm) && elm !== rootElm;\n\t};\n\n\tvar isValidDropTarget = function (editor, targetElement, dragElement) {\n\t\tif (targetElement === dragElement || editor.dom.isChildOf(targetElement, dragElement)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (isContentEditableFalse(targetElement)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tvar cloneElement = function (elm) {\n\t\tvar cloneElm = elm.cloneNode(true);\n\t\tcloneElm.removeAttribute('data-mce-selected');\n\t\treturn cloneElm;\n\t};\n\n\tvar createGhost = function (editor, elm, width, height) {\n\t\tvar clonedElm = elm.cloneNode(true);\n\n\t\teditor.dom.setStyles(clonedElm, {width: width, height: height});\n\t\teditor.dom.setAttrib(clonedElm, 'data-mce-selected', null);\n\n\t\tvar ghostElm = editor.dom.create('div', {\n\t\t\t'class': 'mce-drag-container',\n\t\t\t'data-mce-bogus': 'all',\n\t\t\tunselectable: 'on',\n\t\t\tcontenteditable: 'false'\n\t\t});\n\n\t\teditor.dom.setStyles(ghostElm, {\n\t\t\tposition: 'absolute',\n\t\t\topacity: 0.5,\n\t\t\toverflow: 'hidden',\n\t\t\tborder: 0,\n\t\t\tpadding: 0,\n\t\t\tmargin: 0,\n\t\t\twidth: width,\n\t\t\theight: height\n\t\t});\n\n\t\teditor.dom.setStyles(clonedElm, {\n\t\t\tmargin: 0,\n\t\t\tboxSizing: 'border-box'\n\t\t});\n\n\t\tghostElm.appendChild(clonedElm);\n\n\t\treturn ghostElm;\n\t};\n\n\tvar appendGhostToBody = function (ghostElm, bodyElm) {\n\t\tif (ghostElm.parentNode !== bodyElm) {\n\t\t\tbodyElm.appendChild(ghostElm);\n\t\t}\n\t};\n\n\tvar moveGhost = function (ghostElm, position, width, height, maxX, maxY) {\n\t\tvar overflowX = 0, overflowY = 0;\n\n\t\tghostElm.style.left = position.pageX + 'px';\n\t\tghostElm.style.top = position.pageY + 'px';\n\n\t\tif (position.pageX + width > maxX) {\n\t\t\toverflowX = (position.pageX + width) - maxX;\n\t\t}\n\n\t\tif (position.pageY + height > maxY) {\n\t\t\toverflowY = (position.pageY + height) - maxY;\n\t\t}\n\n\t\tghostElm.style.width = (width - overflowX) + 'px';\n\t\tghostElm.style.height = (height - overflowY) + 'px';\n\t};\n\n\tvar removeElement = function (elm) {\n\t\tif (elm && elm.parentNode) {\n\t\t\telm.parentNode.removeChild(elm);\n\t\t}\n\t};\n\n\tvar isLeftMouseButtonPressed = function (e) {\n\t\treturn e.button === 0;\n\t};\n\n\tvar hasDraggableElement = function (state) {\n\t\treturn state.element;\n\t};\n\n\tvar applyRelPos = function (state, position) {\n\t\treturn {\n\t\t\tpageX: position.pageX - state.relX,\n\t\t\tpageY: position.pageY + 5\n\t\t};\n\t};\n\n\tvar start = function (state, editor) {\n\t\treturn function (e) {\n\t\t\tif (isLeftMouseButtonPressed(e)) {\n\t\t\t\tvar ceElm = Arr.find(editor.dom.getParents(e.target), Fun.or(isContentEditableFalse, isContentEditableTrue));\n\n\t\t\t\tif (isDraggable(editor.getBody(), ceElm)) {\n\t\t\t\t\tvar elmPos = editor.dom.getPos(ceElm);\n\t\t\t\t\tvar bodyElm = editor.getBody();\n\t\t\t\t\tvar docElm = editor.getDoc().documentElement;\n\n\t\t\t\t\tstate.element = ceElm;\n\t\t\t\t\tstate.screenX = e.screenX;\n\t\t\t\t\tstate.screenY = e.screenY;\n\t\t\t\t\tstate.maxX = (editor.inline ? bodyElm.scrollWidth : docElm.offsetWidth) - 2;\n\t\t\t\t\tstate.maxY = (editor.inline ? bodyElm.scrollHeight : docElm.offsetHeight) - 2;\n\t\t\t\t\tstate.relX = e.pageX - elmPos.x;\n\t\t\t\t\tstate.relY = e.pageY - elmPos.y;\n\t\t\t\t\tstate.width = ceElm.offsetWidth;\n\t\t\t\t\tstate.height = ceElm.offsetHeight;\n\t\t\t\t\tstate.ghost = createGhost(editor, ceElm, state.width, state.height);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t};\n\n\tvar move = function (state, editor) {\n\t\t// Reduces laggy drag behavior on Gecko\n\t\tvar throttledPlaceCaretAt = Delay.throttle(function (clientX, clientY) {\n\t\t\teditor._selectionOverrides.hideFakeCaret();\n\t\t\teditor.selection.placeCaretAt(clientX, clientY);\n\t\t}, 0);\n\n\t\treturn function (e) {\n\t\t\tvar movement = Math.max(Math.abs(e.screenX - state.screenX), Math.abs(e.screenY - state.screenY));\n\n\t\t\tif (hasDraggableElement(state) && !state.dragging && movement > 10) {\n\t\t\t\tvar args = editor.fire('dragstart', {target: state.element});\n\t\t\t\tif (args.isDefaultPrevented()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstate.dragging = true;\n\t\t\t\teditor.focus();\n\t\t\t}\n\n\t\t\tif (state.dragging) {\n\t\t\t\tvar targetPos = applyRelPos(state, MousePosition.calc(editor, e));\n\n\t\t\t\tappendGhostToBody(state.ghost, editor.getBody());\n\t\t\t\tmoveGhost(state.ghost, targetPos, state.width, state.height, state.maxX, state.maxY);\n\n\t\t\t\tthrottledPlaceCaretAt(e.clientX, e.clientY);\n\t\t\t}\n\t\t};\n\t};\n\n\t// Returns the raw element instead of the fake cE=false element\n\tvar getRawTarget = function (selection) {\n\t\tvar rng = selection.getSel().getRangeAt(0);\n\t\tvar startContainer = rng.startContainer;\n\t\treturn startContainer.nodeType === 3 ? startContainer.parentNode : startContainer;\n\t};\n\n\tvar drop = function (state, editor) {\n\t\treturn function (e) {\n\t\t\tif (state.dragging) {\n\t\t\t\tif (isValidDropTarget(editor, getRawTarget(editor.selection), state.element)) {\n\t\t\t\t\tvar targetClone = cloneElement(state.element);\n\n\t\t\t\t\tvar args = editor.fire('drop', {\n\t\t\t\t\t\ttargetClone: targetClone,\n\t\t\t\t\t\tclientX: e.clientX,\n\t\t\t\t\t\tclientY: e.clientY\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!args.isDefaultPrevented()) {\n\t\t\t\t\t\ttargetClone = args.targetClone;\n\n\t\t\t\t\t\teditor.undoManager.transact(function() {\n\t\t\t\t\t\t\tremoveElement(state.element);\n\t\t\t\t\t\t\teditor.insertContent(editor.dom.getOuterHTML(targetClone));\n\t\t\t\t\t\t\teditor._selectionOverrides.hideFakeCaret();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tremoveDragState(state);\n\t\t};\n\t};\n\n\tvar stop = function (state, editor) {\n\t\treturn function () {\n\t\t\tremoveDragState(state);\n\t\t\tif (state.dragging) {\n\t\t\t\teditor.fire('dragend');\n\t\t\t}\n\t\t};\n\t};\n\n\tvar removeDragState = function (state) {\n\t\tstate.dragging = false;\n\t\tstate.element = null;\n\t\tremoveElement(state.ghost);\n\t};\n\n\tvar bindFakeDragEvents = function (editor) {\n\t\tvar state = {}, pageDom, dragStartHandler, dragHandler, dropHandler, dragEndHandler, rootDocument;\n\n\t\tpageDom = DOMUtils.DOM;\n\t\trootDocument = document;\n\t\tdragStartHandler = start(state, editor);\n\t\tdragHandler = move(state, editor);\n\t\tdropHandler = drop(state, editor);\n\t\tdragEndHandler = stop(state, editor);\n\n\t\teditor.on('mousedown', dragStartHandler);\n\t\teditor.on('mousemove', dragHandler);\n\t\teditor.on('mouseup', dropHandler);\n\n\t\tpageDom.bind(rootDocument, 'mousemove', dragHandler);\n\t\tpageDom.bind(rootDocument, 'mouseup', dragEndHandler);\n\n\t\teditor.on('remove', function () {\n\t\t\tpageDom.unbind(rootDocument, 'mousemove', dragHandler);\n\t\t\tpageDom.unbind(rootDocument, 'mouseup', dragEndHandler);\n\t\t});\n\t};\n\n\tvar blockIeDrop = function (editor) {\n\t\teditor.on('drop', function(e) {\n\t\t\t// FF doesn't pass out clientX/clientY for drop since this is for IE we just use null instead\n\t\t\tvar realTarget = typeof e.clientX !== 'undefined' ? editor.getDoc().elementFromPoint(e.clientX, e.clientY) : null;\n\n\t\t\tif (isContentEditableFalse(realTarget) || isContentEditableFalse(editor.dom.getContentEditableParent(realTarget))) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t});\n\t};\n\n\tvar init = function (editor) {\n\t\tbindFakeDragEvents(editor);\n\t\tblockIeDrop(editor);\n\t};\n\n\treturn {\n\t\tinit: init\n\t};\n});\n\n// Included from: js/tinymce/classes/SelectionOverrides.js\n\n/**\n * SelectionOverrides.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module contains logic overriding the selection with keyboard/mouse\n * around contentEditable=false regions.\n *\n * @example\n * // Disable the default cE=false selection\n * tinymce.activeEditor.on('ShowCaret BeforeObjectSelected', function(e) {\n *     e.preventDefault();\n * });\n *\n * @private\n * @class tinymce.SelectionOverrides\n */\ndefine(\"tinymce/SelectionOverrides\", [\n\t\"tinymce/Env\",\n\t\"tinymce/caret/CaretWalker\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/caret/CaretContainer\",\n\t\"tinymce/caret/CaretUtils\",\n\t\"tinymce/caret/FakeCaret\",\n\t\"tinymce/caret/LineWalker\",\n\t\"tinymce/caret/LineUtils\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/geom/ClientRect\",\n\t\"tinymce/util/VK\",\n\t\"tinymce/util/Fun\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/DragDropOverrides\"\n], function(\n\tEnv, CaretWalker, CaretPosition, CaretContainer, CaretUtils, FakeCaret, LineWalker,\n\tLineUtils, NodeType, RangeUtils, ClientRect, VK, Fun, Arr, Delay, DragDropOverrides\n) {\n\tvar curry = Fun.curry,\n\t\tisContentEditableTrue = NodeType.isContentEditableTrue,\n\t\tisContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tisElement = NodeType.isElement,\n\t\tisAfterContentEditableFalse = CaretUtils.isAfterContentEditableFalse,\n\t\tisBeforeContentEditableFalse = CaretUtils.isBeforeContentEditableFalse,\n\t\tgetSelectedNode = RangeUtils.getSelectedNode;\n\n\tfunction getVisualCaretPosition(walkFn, caretPosition) {\n\t\twhile ((caretPosition = walkFn(caretPosition))) {\n\t\t\tif (caretPosition.isVisible()) {\n\t\t\t\treturn caretPosition;\n\t\t\t}\n\t\t}\n\n\t\treturn caretPosition;\n\t}\n\n\tfunction SelectionOverrides(editor) {\n\t\tvar rootNode = editor.getBody(), caretWalker = new CaretWalker(rootNode);\n\t\tvar getNextVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.next);\n\t\tvar getPrevVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.prev),\n\t\t\tfakeCaret = new FakeCaret(editor.getBody(), isBlock),\n\t\t\trealSelectionId = 'sel-' + editor.dom.uniqueId(),\n\t\t\tselectedContentEditableNode, $ = editor.$;\n\n\t\tfunction isFakeSelectionElement(elm) {\n\t\t\treturn editor.dom.hasClass(elm, 'mce-offscreen-selection');\n\t\t}\n\n\t\tfunction getRealSelectionElement() {\n\t\t\tvar container = editor.dom.get(realSelectionId);\n\t\t\treturn container ? container.getElementsByTagName('*')[0] : container;\n\t\t}\n\n\t\tfunction isBlock(node) {\n\t\t\treturn editor.dom.isBlock(node);\n\t\t}\n\n\t\tfunction setRange(range) {\n\t\t\t//console.log('setRange', range);\n\t\t\tif (range) {\n\t\t\t\teditor.selection.setRng(range);\n\t\t\t}\n\t\t}\n\n\t\tfunction getRange() {\n\t\t\treturn editor.selection.getRng();\n\t\t}\n\n\t\tfunction scrollIntoView(node, alignToTop) {\n\t\t\teditor.selection.scrollIntoView(node, alignToTop);\n\t\t}\n\n\t\tfunction showCaret(direction, node, before) {\n\t\t\tvar e;\n\n\t\t\te = editor.fire('ShowCaret', {\n\t\t\t\ttarget: node,\n\t\t\t\tdirection: direction,\n\t\t\t\tbefore: before\n\t\t\t});\n\n\t\t\tif (e.isDefaultPrevented()) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tscrollIntoView(node, direction === -1);\n\n\t\t\treturn fakeCaret.show(before, node);\n\t\t}\n\n\t\tfunction selectNode(node) {\n\t\t\tvar e;\n\n\t\t\te = editor.fire('BeforeObjectSelected', {target: node});\n\t\t\tif (e.isDefaultPrevented()) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn getNodeRange(node);\n\t\t}\n\n\t\tfunction getNodeRange(node) {\n\t\t\tvar rng = node.ownerDocument.createRange();\n\n\t\t\trng.selectNode(node);\n\n\t\t\treturn rng;\n\t\t}\n\n\t\tfunction isMoveInsideSameBlock(fromCaretPosition, toCaretPosition) {\n\t\t\tvar inSameBlock = CaretUtils.isInSameBlock(fromCaretPosition, toCaretPosition);\n\n\t\t\t// Handle bogus BR <p>abc|<br></p>\n\t\t\tif (!inSameBlock && NodeType.isBr(fromCaretPosition.getNode())) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn inSameBlock;\n\t\t}\n\n\t\tfunction getNormalizedRangeEndPoint(direction, range) {\n\t\t\trange = CaretUtils.normalizeRange(direction, rootNode, range);\n\n\t\t\tif (direction == -1) {\n\t\t\t\treturn CaretPosition.fromRangeStart(range);\n\t\t\t}\n\n\t\t\treturn CaretPosition.fromRangeEnd(range);\n\t\t}\n\n\t\tfunction isRangeInCaretContainerBlock(range) {\n\t\t\treturn CaretContainer.isCaretContainerBlock(range.startContainer);\n\t\t}\n\n\t\tfunction moveToCeFalseHorizontally(direction, getNextPosFn, isBeforeContentEditableFalseFn, range) {\n\t\t\tvar node, caretPosition, peekCaretPosition, rangeIsInContainerBlock;\n\n\t\t\tif (!range.collapsed) {\n\t\t\t\tnode = getSelectedNode(range);\n\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\treturn showCaret(direction, node, direction == -1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trangeIsInContainerBlock = isRangeInCaretContainerBlock(range);\n\t\t\tcaretPosition = getNormalizedRangeEndPoint(direction, range);\n\n\t\t\tif (isBeforeContentEditableFalseFn(caretPosition)) {\n\t\t\t\treturn selectNode(caretPosition.getNode(direction == -1));\n\t\t\t}\n\n\t\t\tcaretPosition = getNextPosFn(caretPosition);\n\t\t\tif (!caretPosition) {\n\t\t\t\tif (rangeIsInContainerBlock) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (isBeforeContentEditableFalseFn(caretPosition)) {\n\t\t\t\treturn showCaret(direction, caretPosition.getNode(direction == -1), direction == 1);\n\t\t\t}\n\n\t\t\t// Peek ahead for handling of ab|c<span cE=false> -> abc|<span cE=false>\n\t\t\tpeekCaretPosition = getNextPosFn(caretPosition);\n\t\t\tif (isBeforeContentEditableFalseFn(peekCaretPosition)) {\n\t\t\t\tif (isMoveInsideSameBlock(caretPosition, peekCaretPosition)) {\n\t\t\t\t\treturn showCaret(direction, peekCaretPosition.getNode(direction == -1), direction == 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (rangeIsInContainerBlock) {\n\t\t\t\treturn renderRangeCaret(caretPosition.toRange());\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction moveToCeFalseVertically(direction, walkerFn, range) {\n\t\t\tvar caretPosition, linePositions, nextLinePositions,\n\t\t\t\tclosestNextLineRect, caretClientRect, clientX,\n\t\t\t\tdist1, dist2, contentEditableFalseNode;\n\n\t\t\tcontentEditableFalseNode = getSelectedNode(range);\n\t\t\tcaretPosition = getNormalizedRangeEndPoint(direction, range);\n\t\t\tlinePositions = walkerFn(rootNode, LineWalker.isAboveLine(1), caretPosition);\n\t\t\tnextLinePositions = Arr.filter(linePositions, LineWalker.isLine(1));\n\t\t\tcaretClientRect = Arr.last(caretPosition.getClientRects());\n\n\t\t\tif (isBeforeContentEditableFalse(caretPosition)) {\n\t\t\t\tcontentEditableFalseNode = caretPosition.getNode();\n\t\t\t}\n\n\t\t\tif (isAfterContentEditableFalse(caretPosition)) {\n\t\t\t\tcontentEditableFalseNode = caretPosition.getNode(true);\n\t\t\t}\n\n\t\t\tif (!caretClientRect) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tclientX = caretClientRect.left;\n\n\t\t\tclosestNextLineRect = LineUtils.findClosestClientRect(nextLinePositions, clientX);\n\t\t\tif (closestNextLineRect) {\n\t\t\t\tif (isContentEditableFalse(closestNextLineRect.node)) {\n\t\t\t\t\tdist1 = Math.abs(clientX - closestNextLineRect.left);\n\t\t\t\t\tdist2 = Math.abs(clientX - closestNextLineRect.right);\n\n\t\t\t\t\treturn showCaret(direction, closestNextLineRect.node, dist1 < dist2);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (contentEditableFalseNode) {\n\t\t\t\tvar caretPositions = LineWalker.positionsUntil(direction, rootNode, LineWalker.isAboveLine(1), contentEditableFalseNode);\n\n\t\t\t\tclosestNextLineRect = LineUtils.findClosestClientRect(Arr.filter(caretPositions, LineWalker.isLine(1)), clientX);\n\t\t\t\tif (closestNextLineRect) {\n\t\t\t\t\treturn renderRangeCaret(closestNextLineRect.position.toRange());\n\t\t\t\t}\n\n\t\t\t\tclosestNextLineRect = Arr.last(Arr.filter(caretPositions, LineWalker.isLine(0)));\n\t\t\t\tif (closestNextLineRect) {\n\t\t\t\t\treturn renderRangeCaret(closestNextLineRect.position.toRange());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction exitPreBlock(direction, range) {\n\t\t\tvar pre, caretPos, newBlock;\n\n\t\t\tfunction createTextBlock() {\n\t\t\t\tvar textBlock = editor.dom.create(editor.settings.forced_root_block);\n\n\t\t\t\tif (!Env.ie || Env.ie >= 11) {\n\t\t\t\t\ttextBlock.innerHTML = '<br data-mce-bogus=\"1\">';\n\t\t\t\t}\n\n\t\t\t\treturn textBlock;\n\t\t\t}\n\n\t\t\tif (range.collapsed && editor.settings.forced_root_block) {\n\t\t\t\tpre = editor.dom.getParent(range.startContainer, 'PRE');\n\t\t\t\tif (!pre) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (direction == 1) {\n\t\t\t\t\tcaretPos = getNextVisualCaretPosition(CaretPosition.fromRangeStart(range));\n\t\t\t\t} else {\n\t\t\t\t\tcaretPos = getPrevVisualCaretPosition(CaretPosition.fromRangeStart(range));\n\t\t\t\t}\n\n\t\t\t\tif (!caretPos) {\n\t\t\t\t\tnewBlock = createTextBlock();\n\n\t\t\t\t\tif (direction == 1) {\n\t\t\t\t\t\teditor.$(pre).after(newBlock);\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.$(pre).before(newBlock);\n\t\t\t\t\t}\n\n\t\t\t\t\teditor.selection.select(newBlock, true);\n\t\t\t\t\teditor.selection.collapse();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction moveH(direction, getNextPosFn, isBeforeContentEditableFalseFn, range) {\n\t\t\tvar newRange;\n\n\t\t\tnewRange = moveToCeFalseHorizontally(direction, getNextPosFn, isBeforeContentEditableFalseFn, range);\n\t\t\tif (newRange) {\n\t\t\t\treturn newRange;\n\t\t\t}\n\n\t\t\tnewRange = exitPreBlock(direction, range);\n\t\t\tif (newRange) {\n\t\t\t\treturn newRange;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction moveV(direction, walkerFn, range) {\n\t\t\tvar newRange;\n\n\t\t\tnewRange = moveToCeFalseVertically(direction, walkerFn, range);\n\t\t\tif (newRange) {\n\t\t\t\treturn newRange;\n\t\t\t}\n\n\t\t\tnewRange = exitPreBlock(direction, range);\n\t\t\tif (newRange) {\n\t\t\t\treturn newRange;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction getBlockCaretContainer() {\n\t\t\treturn $('*[data-mce-caret]')[0];\n\t\t}\n\n\t\tfunction showBlockCaretContainer(blockCaretContainer) {\n\t\t\tif (blockCaretContainer.hasAttribute('data-mce-caret')) {\n\t\t\t\tCaretContainer.showCaretContainerBlock(blockCaretContainer);\n\t\t\t\tsetRange(getRange()); // Removes control rect on IE\n\t\t\t\tscrollIntoView(blockCaretContainer[0]);\n\t\t\t}\n\t\t}\n\n\t\tfunction renderCaretAtRange(range) {\n\t\t\tvar caretPosition, ceRoot;\n\n\t\t\trange = CaretUtils.normalizeRange(1, rootNode, range);\n\t\t\tcaretPosition = CaretPosition.fromRangeStart(range);\n\n\t\t\tif (isContentEditableFalse(caretPosition.getNode())) {\n\t\t\t\treturn showCaret(1, caretPosition.getNode(), !caretPosition.isAtEnd());\n\t\t\t}\n\n\t\t\tif (isContentEditableFalse(caretPosition.getNode(true))) {\n\t\t\t\treturn showCaret(1, caretPosition.getNode(true), false);\n\t\t\t}\n\n\t\t\t// TODO: Should render caret before/after depending on where you click on the page forces after now\n\t\t\tceRoot = editor.dom.getParent(caretPosition.getNode(), Fun.or(isContentEditableFalse, isContentEditableTrue));\n\t\t\tif (isContentEditableFalse(ceRoot)) {\n\t\t\t\treturn showCaret(1, ceRoot, false);\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction renderRangeCaret(range) {\n\t\t\tvar caretRange;\n\n\t\t\tif (!range || !range.collapsed) {\n\t\t\t\treturn range;\n\t\t\t}\n\n\t\t\tcaretRange = renderCaretAtRange(range);\n\t\t\tif (caretRange) {\n\t\t\t\treturn caretRange;\n\t\t\t}\n\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction deleteContentEditableNode(node) {\n\t\t\tvar nextCaretPosition, prevCaretPosition, prevCeFalseElm, nextElement;\n\n\t\t\tif (!isContentEditableFalse(node)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (isContentEditableFalse(node.previousSibling)) {\n\t\t\t\tprevCeFalseElm = node.previousSibling;\n\t\t\t}\n\n\t\t\tprevCaretPosition = getPrevVisualCaretPosition(CaretPosition.before(node));\n\t\t\tif (!prevCaretPosition) {\n\t\t\t\tnextCaretPosition = getNextVisualCaretPosition(CaretPosition.after(node));\n\t\t\t}\n\n\t\t\tif (nextCaretPosition && isElement(nextCaretPosition.getNode())) {\n\t\t\t\tnextElement = nextCaretPosition.getNode();\n\t\t\t}\n\n\t\t\tCaretContainer.remove(node.previousSibling);\n\t\t\tCaretContainer.remove(node.nextSibling);\n\t\t\teditor.dom.remove(node);\n\n\t\t\tif (editor.dom.isEmpty(editor.getBody())) {\n\t\t\t\teditor.setContent('');\n\t\t\t\teditor.focus();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (prevCeFalseElm) {\n\t\t\t\treturn CaretPosition.after(prevCeFalseElm).toRange();\n\t\t\t}\n\n\t\t\tif (nextElement) {\n\t\t\t\treturn CaretPosition.before(nextElement).toRange();\n\t\t\t}\n\n\t\t\tif (prevCaretPosition) {\n\t\t\t\treturn prevCaretPosition.toRange();\n\t\t\t}\n\n\t\t\tif (nextCaretPosition) {\n\t\t\t\treturn nextCaretPosition.toRange();\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction isTextBlock(node) {\n\t\t\tvar textBlocks = editor.schema.getTextBlockElements();\n\t\t\treturn node.nodeName in textBlocks;\n\t\t}\n\n\t\tfunction isEmpty(elm) {\n\t\t\treturn editor.dom.isEmpty(elm);\n\t\t}\n\n\t\tfunction mergeTextBlocks(direction, fromCaretPosition, toCaretPosition) {\n\t\t\tvar dom = editor.dom, fromBlock, toBlock, node, ceTarget;\n\n\t\t\tfromBlock = dom.getParent(fromCaretPosition.getNode(), dom.isBlock);\n\t\t\ttoBlock = dom.getParent(toCaretPosition.getNode(), dom.isBlock);\n\n\t\t\tif (direction === -1) {\n\t\t\t\tceTarget = toCaretPosition.getNode(true);\n\t\t\t\tif (isAfterContentEditableFalse(toCaretPosition) && isBlock(ceTarget)) {\n\t\t\t\t\tif (isTextBlock(fromBlock)) {\n\t\t\t\t\t\tif (isEmpty(fromBlock)) {\n\t\t\t\t\t\t\tdom.remove(fromBlock);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn CaretPosition.after(ceTarget).toRange();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn deleteContentEditableNode(toCaretPosition.getNode(true));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tceTarget = fromCaretPosition.getNode();\n\t\t\t\tif (isBeforeContentEditableFalse(fromCaretPosition) && isBlock(ceTarget)) {\n\t\t\t\t\tif (isTextBlock(toBlock)) {\n\t\t\t\t\t\tif (isEmpty(toBlock)) {\n\t\t\t\t\t\t\tdom.remove(toBlock);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn CaretPosition.before(ceTarget).toRange();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn deleteContentEditableNode(fromCaretPosition.getNode());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Verify that both blocks are text blocks\n\t\t\tif (fromBlock === toBlock || !isTextBlock(fromBlock) || !isTextBlock(toBlock)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\twhile ((node = fromBlock.firstChild)) {\n\t\t\t\ttoBlock.appendChild(node);\n\t\t\t}\n\n\t\t\teditor.dom.remove(fromBlock);\n\n\t\t\treturn toCaretPosition.toRange();\n\t\t}\n\n\t\tfunction backspaceDelete(direction, beforeFn, afterFn, range) {\n\t\t\tvar node, caretPosition, peekCaretPosition, newCaretPosition;\n\n\t\t\tif (!range.collapsed) {\n\t\t\t\tnode = getSelectedNode(range);\n\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\treturn renderRangeCaret(deleteContentEditableNode(node));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcaretPosition = getNormalizedRangeEndPoint(direction, range);\n\n\t\t\tif (afterFn(caretPosition) && CaretContainer.isCaretContainerBlock(range.startContainer)) {\n\t\t\t\tnewCaretPosition = direction == -1 ? caretWalker.prev(caretPosition) : caretWalker.next(caretPosition);\n\t\t\t\treturn newCaretPosition ? renderRangeCaret(newCaretPosition.toRange()) : range;\n\t\t\t}\n\n\t\t\tif (beforeFn(caretPosition)) {\n\t\t\t\treturn renderRangeCaret(deleteContentEditableNode(caretPosition.getNode(direction == -1)));\n\t\t\t}\n\n\t\t\tpeekCaretPosition = direction == -1 ? caretWalker.prev(caretPosition) : caretWalker.next(caretPosition);\n\t\t\tif (beforeFn(peekCaretPosition)) {\n\t\t\t\tif (direction === -1) {\n\t\t\t\t\treturn mergeTextBlocks(direction, caretPosition, peekCaretPosition);\n\t\t\t\t}\n\n\t\t\t\treturn mergeTextBlocks(direction, peekCaretPosition, caretPosition);\n\t\t\t}\n\t\t}\n\n\t\tfunction registerEvents() {\n\t\t\tvar right = curry(moveH, 1, getNextVisualCaretPosition, isBeforeContentEditableFalse);\n\t\t\tvar left = curry(moveH, -1, getPrevVisualCaretPosition, isAfterContentEditableFalse);\n\t\t\tvar deleteForward = curry(backspaceDelete, 1, isBeforeContentEditableFalse, isAfterContentEditableFalse);\n\t\t\tvar backspace = curry(backspaceDelete, -1, isAfterContentEditableFalse, isBeforeContentEditableFalse);\n\t\t\tvar up = curry(moveV, -1, LineWalker.upUntil);\n\t\t\tvar down = curry(moveV, 1, LineWalker.downUntil);\n\n\t\t\tfunction override(evt, moveFn) {\n\t\t\t\tvar range = moveFn(getRange());\n\n\t\t\t\tif (range && !evt.isDefaultPrevented()) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\tsetRange(range);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction getContentEditableRoot(node) {\n\t\t\t\tvar root = editor.getBody();\n\n\t\t\t\twhile (node && node != root) {\n\t\t\t\t\tif (isContentEditableTrue(node) || isContentEditableFalse(node)) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tfunction isXYWithinRange(clientX, clientY, range) {\n\t\t\t\tif (range.collapsed) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn Arr.reduce(range.getClientRects(), function(state, rect) {\n\t\t\t\t\treturn state || ClientRect.containsXY(rect, clientX, clientY);\n\t\t\t\t}, false);\n\t\t\t}\n\n\t\t\t// Some browsers (Chrome) lets you place the caret after a cE=false\n\t\t\t// Make sure we render the caret container in this case\n\t\t\teditor.on('mouseup', function() {\n\t\t\t\tvar range = getRange();\n\n\t\t\t\tif (range.collapsed) {\n\t\t\t\t\tsetRange(renderCaretAtRange(range));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('click', function(e) {\n\t\t\t\tvar contentEditableRoot;\n\n\t\t\t\tcontentEditableRoot\t= getContentEditableRoot(e.target);\n\t\t\t\tif (contentEditableRoot) {\n\t\t\t\t\t// Prevent clicks on links in a cE=false element\n\t\t\t\t\tif (isContentEditableFalse(contentEditableRoot)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\teditor.focus();\n\t\t\t\t\t}\n\n\t\t\t\t\t// Removes fake selection if a cE=true is clicked within a cE=false like the toc title\n\t\t\t\t\tif (isContentEditableTrue(contentEditableRoot)) {\n\t\t\t\t\t\tif (editor.dom.isChildOf(contentEditableRoot, editor.selection.getNode())) {\n\t\t\t\t\t\t\tremoveContentEditableSelection();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('blur NewBlock', function () {\n\t\t\t\tremoveContentEditableSelection();\n\t\t\t\thideFakeCaret();\n\t\t\t});\n\n\t\t\tfunction handleTouchSelect(editor) {\n\t\t\t\tvar moved = false;\n\n\t\t\t\teditor.on('touchstart', function () {\n\t\t\t\t\tmoved = false;\n\t\t\t\t});\n\n\t\t\t\teditor.on('touchmove', function () {\n\t\t\t\t\tmoved = true;\n\t\t\t\t});\n\n\t\t\t\teditor.on('touchend', function (e) {\n\t\t\t\t\tvar contentEditableRoot\t= getContentEditableRoot(e.target);\n\n\t\t\t\t\tif (isContentEditableFalse(contentEditableRoot)) {\n\t\t\t\t\t\tif (!moved) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tsetContentEditableSelection(selectNode(contentEditableRoot));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvar hasNormalCaretPosition = function (elm) {\n\t\t\t\tvar caretWalker = new CaretWalker(elm);\n\n\t\t\t\tif (!elm.firstChild) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar startPos = CaretPosition.before(elm.firstChild);\n\t\t\t\tvar newPos = caretWalker.next(startPos);\n\n\t\t\t\treturn newPos && !isBeforeContentEditableFalse(newPos) && !isAfterContentEditableFalse(newPos);\n\t\t\t};\n\n\t\t\tvar isInSameBlock = function (node1, node2) {\n\t\t\t\tvar block1 = editor.dom.getParent(node1, editor.dom.isBlock);\n\t\t\t\tvar block2 = editor.dom.getParent(node2, editor.dom.isBlock);\n\t\t\t\treturn block1 === block2;\n\t\t\t};\n\n\t\t\tvar isContentKey = function (e) {\n\t\t\t\tif (e.keyCode >= 112 && e.keyCode <= 123) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\t// Checks if the target node is in a block and if that block has a caret position better than the\n\t\t\t// suggested caretNode this is to prevent the caret from being sucked in towards a cE=false block if\n\t\t\t// they are adjacent on the vertical axis\n\t\t\tvar hasBetterMouseTarget = function (targetNode, caretNode) {\n\t\t\t\tvar targetBlock = editor.dom.getParent(targetNode, editor.dom.isBlock);\n\t\t\t\tvar caretBlock = editor.dom.getParent(caretNode, editor.dom.isBlock);\n\n\t\t\t\treturn targetBlock && !isInSameBlock(targetBlock, caretBlock) && hasNormalCaretPosition(targetBlock);\n\t\t\t};\n\n\t\t\thandleTouchSelect(editor);\n\n\t\t\teditor.on('mousedown', function(e) {\n\t\t\t\tvar contentEditableRoot;\n\n\t\t\t\tcontentEditableRoot\t= getContentEditableRoot(e.target);\n\t\t\t\tif (contentEditableRoot) {\n\t\t\t\t\tif (isContentEditableFalse(contentEditableRoot)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tsetContentEditableSelection(selectNode(contentEditableRoot));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!isXYWithinRange(e.clientX, e.clientY, editor.selection.getRng())) {\n\t\t\t\t\t\t\teditor.selection.placeCaretAt(e.clientX, e.clientY);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Remove needs to be called here since the mousedown might alter the selection without calling selection.setRng\n\t\t\t\t\t// and therefore not fire the AfterSetSelectionRange event.\n\t\t\t\t\tremoveContentEditableSelection();\n\t\t\t\t\thideFakeCaret();\n\n\t\t\t\t\tvar caretInfo = LineUtils.closestCaret(rootNode, e.clientX, e.clientY);\n\t\t\t\t\tif (caretInfo) {\n\t\t\t\t\t\tif (!hasBetterMouseTarget(e.target, caretInfo.node)) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\teditor.getBody().focus();\n\t\t\t\t\t\t\tsetRange(showCaret(1, caretInfo.node, caretInfo.before));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tif (VK.modifierPressed(e)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tswitch (e.keyCode) {\n\t\t\t\t\tcase VK.RIGHT:\n\t\t\t\t\t\toverride(e, right);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase VK.DOWN:\n\t\t\t\t\t\toverride(e, down);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase VK.LEFT:\n\t\t\t\t\t\toverride(e, left);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase VK.UP:\n\t\t\t\t\t\toverride(e, up);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase VK.DELETE:\n\t\t\t\t\t\toverride(e, deleteForward);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase VK.BACKSPACE:\n\t\t\t\t\t\toverride(e, backspace);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tif (isContentEditableFalse(editor.selection.getNode()) && isContentKey(e)) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfunction paddEmptyContentEditableArea() {\n\t\t\t\tvar br, ceRoot = getContentEditableRoot(editor.selection.getNode());\n\n\t\t\t\tif (isContentEditableTrue(ceRoot) && isBlock(ceRoot) && editor.dom.isEmpty(ceRoot)) {\n\t\t\t\t\tbr = editor.dom.create('br', {\"data-mce-bogus\": \"1\"});\n\t\t\t\t\teditor.$(ceRoot).empty().append(br);\n\t\t\t\t\teditor.selection.setRng(CaretPosition.before(br).toRange());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handleBlockContainer(e) {\n\t\t\t\tvar blockCaretContainer = getBlockCaretContainer();\n\n\t\t\t\tif (!blockCaretContainer) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.type == 'compositionstart') {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tshowBlockCaretContainer(blockCaretContainer);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (CaretContainer.hasContent(blockCaretContainer)) {\n\t\t\t\t\tshowBlockCaretContainer(blockCaretContainer);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handleEmptyBackspaceDelete(e) {\n\t\t\t\tvar prevent;\n\n\t\t\t\tswitch (e.keyCode) {\n\t\t\t\t\tcase VK.DELETE:\n\t\t\t\t\t\tprevent = paddEmptyContentEditableArea();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase VK.BACKSPACE:\n\t\t\t\t\t\tprevent = paddEmptyContentEditableArea();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (prevent) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Must be added to \"top\" since undoManager needs to be executed after\n\t\t\teditor.on('keyup compositionstart', function(e) {\n\t\t\t\thandleBlockContainer(e);\n\t\t\t\thandleEmptyBackspaceDelete(e);\n\t\t\t}, true);\n\n\t\t\teditor.on('cut', function() {\n\t\t\t\tvar node = editor.selection.getNode();\n\n\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\tsetRange(renderRangeCaret(deleteContentEditableNode(node)));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('getSelectionRange', function(e) {\n\t\t\t\tvar rng = e.range;\n\n\t\t\t\tif (selectedContentEditableNode) {\n\t\t\t\t\tif (!selectedContentEditableNode.parentNode) {\n\t\t\t\t\t\tselectedContentEditableNode = null;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\trng = rng.cloneRange();\n\t\t\t\t\trng.selectNode(selectedContentEditableNode);\n\t\t\t\t\te.range = rng;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('setSelectionRange', function(e) {\n\t\t\t\tvar rng;\n\n\t\t\t\trng = setContentEditableSelection(e.range);\n\t\t\t\tif (rng) {\n\t\t\t\t\te.range = rng;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('AfterSetSelectionRange', function(e) {\n\t\t\t\tvar rng = e.range;\n\n\t\t\t\tif (!isRangeInCaretContainer(rng)) {\n\t\t\t\t\thideFakeCaret();\n\t\t\t\t}\n\n\t\t\t\tif (!isFakeSelectionElement(rng.startContainer.parentNode)) {\n\t\t\t\t\tremoveContentEditableSelection();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('focus', function() {\n\t\t\t\t// Make sure we have a proper fake caret on focus\n\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\teditor.selection.setRng(renderRangeCaret(editor.selection.getRng()));\n\t\t\t\t}, 0);\n\t\t\t});\n\n\t\t\teditor.on('copy', function (e) {\n\t\t\t\tvar clipboardData = e.clipboardData;\n\n\t\t\t\t// Make sure we get proper html/text for the fake cE=false selection\n\t\t\t\t// Doesn't work at all on Edge since it doesn't have proper clipboardData support\n\t\t\t\tif (!e.isDefaultPrevented() && e.clipboardData && !Env.ie) {\n\t\t\t\t\tvar realSelectionElement = getRealSelectionElement();\n\t\t\t\t\tif (realSelectionElement) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tclipboardData.clearData();\n\t\t\t\t\t\tclipboardData.setData('text/html', realSelectionElement.outerHTML);\n\t\t\t\t\t\tclipboardData.setData('text/plain', realSelectionElement.outerText);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tDragDropOverrides.init(editor);\n\t\t}\n\n\t\tfunction addCss() {\n\t\t\tvar styles = editor.contentStyles, rootClass = '.mce-content-body';\n\n\t\t\tstyles.push(fakeCaret.getCss());\n\t\t\tstyles.push(\n\t\t\t\trootClass + ' .mce-offscreen-selection {' +\n\t\t\t\t\t'position: absolute;' +\n\t\t\t\t\t'left: -9999999999px;' +\n\t\t\t\t\t'max-width: 1000000px;' +\n\t\t\t\t'}' +\n\t\t\t\trootClass + ' *[contentEditable=false] {' +\n\t\t\t\t\t'cursor: default;' +\n\t\t\t\t'}' +\n\t\t\t\trootClass + ' *[contentEditable=true] {' +\n\t\t\t\t\t'cursor: text;' +\n\t\t\t\t'}'\n\t\t\t);\n\t\t}\n\n\t\tfunction isRangeInCaretContainer(rng) {\n\t\t\treturn CaretContainer.isCaretContainer(rng.startContainer) || CaretContainer.isCaretContainer(rng.endContainer);\n\t\t}\n\n\t\tfunction setContentEditableSelection(range) {\n\t\t\tvar node, $ = editor.$, dom = editor.dom, $realSelectionContainer, sel,\n\t\t\t\tstartContainer, startOffset, endOffset, e, caretPosition, targetClone, origTargetClone;\n\n\t\t\tif (!range) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (range.collapsed) {\n\t\t\t\tif (!isRangeInCaretContainer(range)) {\n\t\t\t\t\tcaretPosition = getNormalizedRangeEndPoint(1, range);\n\n\t\t\t\t\tif (isContentEditableFalse(caretPosition.getNode())) {\n\t\t\t\t\t\treturn showCaret(1, caretPosition.getNode(), !caretPosition.isAtEnd());\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isContentEditableFalse(caretPosition.getNode(true))) {\n\t\t\t\t\t\treturn showCaret(1, caretPosition.getNode(true), false);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tstartContainer = range.startContainer;\n\t\t\tstartOffset = range.startOffset;\n\t\t\tendOffset = range.endOffset;\n\n\t\t\t// Normalizes <span cE=false>[</span>] to [<span cE=false></span>]\n\t\t\tif (startContainer.nodeType == 3 && startOffset == 0 && isContentEditableFalse(startContainer.parentNode)) {\n\t\t\t\tstartContainer = startContainer.parentNode;\n\t\t\t\tstartOffset = dom.nodeIndex(startContainer);\n\t\t\t\tstartContainer = startContainer.parentNode;\n\t\t\t}\n\n\t\t\tif (startContainer.nodeType != 1) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (endOffset == startOffset + 1) {\n\t\t\t\tnode = startContainer.childNodes[startOffset];\n\t\t\t}\n\n\t\t\tif (!isContentEditableFalse(node)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\ttargetClone = origTargetClone = node.cloneNode(true);\n\t\t\te = editor.fire('ObjectSelected', {target: node, targetClone: targetClone});\n\t\t\tif (e.isDefaultPrevented()) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\ttargetClone = e.targetClone;\n\t\t\t$realSelectionContainer = $('#' + realSelectionId);\n\t\t\tif ($realSelectionContainer.length === 0) {\n\t\t\t\t$realSelectionContainer = $(\n\t\t\t\t\t'<div data-mce-bogus=\"all\" class=\"mce-offscreen-selection\"></div>'\n\t\t\t\t).attr('id', realSelectionId);\n\n\t\t\t\t$realSelectionContainer.appendTo(editor.getBody());\n\t\t\t}\n\n\t\t\trange = editor.dom.createRng();\n\n\t\t\t// WHY is IE making things so hard! Copy on <i contentEditable=\"false\">x</i> produces: <em>x</em>\n\t\t\t// This is a ridiculous hack where we place the selection from a block over the inline element\n\t\t\t// so that just the inline element is copied as is and not converted.\n\t\t\tif (targetClone === origTargetClone && Env.ie) {\n\t\t\t\t$realSelectionContainer.empty().append('<p style=\"font-size: 0\" data-mce-bogus=\"all\">\\u00a0</p>').append(targetClone);\n\t\t\t\trange.setStartAfter($realSelectionContainer[0].firstChild.firstChild);\n\t\t\t\trange.setEndAfter(targetClone);\n\t\t\t} else {\n\t\t\t\t$realSelectionContainer.empty().append('\\u00a0').append(targetClone).append('\\u00a0');\n\t\t\t\trange.setStart($realSelectionContainer[0].firstChild, 1);\n\t\t\t\trange.setEnd($realSelectionContainer[0].lastChild, 0);\n\t\t\t}\n\n\t\t\t$realSelectionContainer.css({\n\t\t\t\ttop: dom.getPos(node, editor.getBody()).y\n\t\t\t});\n\n\t\t\t$realSelectionContainer[0].focus();\n\t\t\tsel = editor.selection.getSel();\n\t\t\tsel.removeAllRanges();\n\t\t\tsel.addRange(range);\n\n\t\t\teditor.$('*[data-mce-selected]').removeAttr('data-mce-selected');\n\t\t\tnode.setAttribute('data-mce-selected', 1);\n\t\t\tselectedContentEditableNode = node;\n\t\t\thideFakeCaret();\n\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction removeContentEditableSelection() {\n\t\t\tif (selectedContentEditableNode) {\n\t\t\t\tselectedContentEditableNode.removeAttribute('data-mce-selected');\n\t\t\t\teditor.$('#' + realSelectionId).remove();\n\t\t\t\tselectedContentEditableNode = null;\n\t\t\t}\n\t\t}\n\n\t\tfunction destroy() {\n\t\t\tfakeCaret.destroy();\n\t\t\tselectedContentEditableNode = null;\n\t\t}\n\n\t\tfunction hideFakeCaret() {\n\t\t\tfakeCaret.hide();\n\t\t}\n\n\t\tif (Env.ceFalse) {\n\t\t\tregisterEvents();\n\t\t\taddCss();\n\t\t}\n\n\t\treturn {\n\t\t\tshowBlockCaretContainer: showBlockCaretContainer,\n\t\t\thideFakeCaret: hideFakeCaret,\n\t\t\tdestroy: destroy\n\t\t};\n\t}\n\n\treturn SelectionOverrides;\n});\n\n// Included from: js/tinymce/classes/util/Uuid.js\n\n/**\n * Uuid.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Generates unique ids.\n *\n * @class tinymce.util.Uuid\n * @private\n */\ndefine(\"tinymce/util/Uuid\", [\n], function() {\n\tvar count = 0;\n\n\tvar seed = function () {\n\t\tvar rnd = function () {\n\t\t\treturn Math.round(Math.random() * 0xFFFFFFFF).toString(36);\n\t\t};\n\n\t\tvar now = new Date().getTime();\n\t\treturn 's' + now.toString(36) + rnd() + rnd() + rnd();\n\t};\n\n\tvar uuid = function (prefix) {\n\t\treturn prefix + (count++) + seed();\n\t};\n\n\treturn {\n\t\tuuid: uuid\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Sidebar.js\n\n/**\n * Sidebar.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module handle sidebar instances for the editor.\n *\n * @class tinymce.ui.Sidebar\n * @private\n */\ndefine(\"tinymce/ui/Sidebar\", [\n], function(\n) {\n\tvar add = function (editor, name, settings) {\n\t\tvar sidebars = editor.sidebars ? editor.sidebars : [];\n\t\tsidebars.push({name: name, settings: settings});\n\t\teditor.sidebars = sidebars;\n\t};\n\n\treturn {\n\t\tadd: add\n\t};\n});\n\n// Included from: js/tinymce/classes/Editor.js\n\n/**\n * Editor.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*jshint scripturl:true */\n\n/**\n * Include the base event class documentation.\n *\n * @include ../../../tools/docs/tinymce.Event.js\n */\n\n/**\n * This class contains the core logic for a TinyMCE editor.\n *\n * @class tinymce.Editor\n * @mixes tinymce.util.Observable\n * @example\n * // Add a class to all paragraphs in the editor.\n * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'someclass');\n *\n * // Gets the current editors selection as text\n * tinymce.activeEditor.selection.getContent({format: 'text'});\n *\n * // Creates a new editor instance\n * var ed = new tinymce.Editor('textareaid', {\n *     some_setting: 1\n * }, tinymce.EditorManager);\n *\n * // Select each item the user clicks on\n * ed.on('click', function(e) {\n *     ed.selection.select(e.target);\n * });\n *\n * ed.render();\n */\ndefine(\"tinymce/Editor\", [\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/AddOnManager\",\n\t\"tinymce/NodeChange\",\n\t\"tinymce/html/Node\",\n\t\"tinymce/dom/Serializer\",\n\t\"tinymce/html/Serializer\",\n\t\"tinymce/dom/Selection\",\n\t\"tinymce/Formatter\",\n\t\"tinymce/UndoManager\",\n\t\"tinymce/EnterKey\",\n\t\"tinymce/ForceBlocks\",\n\t\"tinymce/EditorCommands\",\n\t\"tinymce/util/URI\",\n\t\"tinymce/dom/ScriptLoader\",\n\t\"tinymce/dom/EventUtils\",\n\t\"tinymce/WindowManager\",\n\t\"tinymce/NotificationManager\",\n\t\"tinymce/html/Schema\",\n\t\"tinymce/html/DomParser\",\n\t\"tinymce/util/Quirks\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/EditorObservable\",\n\t\"tinymce/Mode\",\n\t\"tinymce/Shortcuts\",\n\t\"tinymce/EditorUpload\",\n\t\"tinymce/SelectionOverrides\",\n\t\"tinymce/util/Uuid\",\n\t\"tinymce/ui/Sidebar\",\n\t\"tinymce/ErrorReporter\"\n], function(\n\tDOMUtils, DomQuery, AddOnManager, NodeChange, Node, DomSerializer, Serializer,\n\tSelection, Formatter, UndoManager, EnterKey, ForceBlocks, EditorCommands,\n\tURI, ScriptLoader, EventUtils, WindowManager, NotificationManager,\n\tSchema, DomParser, Quirks, Env, Tools, Delay, EditorObservable, Mode, Shortcuts, EditorUpload,\n\tSelectionOverrides, Uuid, Sidebar, ErrorReporter\n) {\n\t// Shorten these names\n\tvar DOM = DOMUtils.DOM, ThemeManager = AddOnManager.ThemeManager, PluginManager = AddOnManager.PluginManager;\n\tvar extend = Tools.extend, each = Tools.each, explode = Tools.explode;\n\tvar inArray = Tools.inArray, trim = Tools.trim, resolve = Tools.resolve;\n\tvar Event = EventUtils.Event;\n\tvar isGecko = Env.gecko, ie = Env.ie;\n\n\t/**\n\t * Include documentation for all the events.\n\t *\n\t * @include ../../../tools/docs/tinymce.Editor.js\n\t */\n\n\t/**\n\t * Constructs a editor instance by id.\n\t *\n\t * @constructor\n\t * @method Editor\n\t * @param {String} id Unique id for the editor.\n\t * @param {Object} settings Settings for the editor.\n\t * @param {tinymce.EditorManager} editorManager EditorManager instance.\n\t */\n\tfunction Editor(id, settings, editorManager) {\n\t\tvar self = this, documentBaseUrl, baseUri, defaultSettings;\n\n\t\tdocumentBaseUrl = self.documentBaseUrl = editorManager.documentBaseURL;\n\t\tbaseUri = editorManager.baseURI;\n\t\tdefaultSettings = editorManager.defaultSettings;\n\n\t\t/**\n\t\t * Name/value collection with editor settings.\n\t\t *\n\t\t * @property settings\n\t\t * @type Object\n\t\t * @example\n\t\t * // Get the value of the theme setting\n\t\t * tinymce.activeEditor.windowManager.alert(\"You are using the \" + tinymce.activeEditor.settings.theme + \" theme\");\n\t\t */\n\t\tsettings = extend({\n\t\t\tid: id,\n\t\t\ttheme: 'modern',\n\t\t\tdelta_width: 0,\n\t\t\tdelta_height: 0,\n\t\t\tpopup_css: '',\n\t\t\tplugins: '',\n\t\t\tdocument_base_url: documentBaseUrl,\n\t\t\tadd_form_submit_trigger: true,\n\t\t\tsubmit_patch: true,\n\t\t\tadd_unload_trigger: true,\n\t\t\tconvert_urls: true,\n\t\t\trelative_urls: true,\n\t\t\tremove_script_host: true,\n\t\t\tobject_resizing: true,\n\t\t\tdoctype: '<!DOCTYPE html>',\n\t\t\tvisual: true,\n\t\t\tfont_size_style_values: 'xx-small,x-small,small,medium,large,x-large,xx-large',\n\n\t\t\t// See: http://www.w3.org/TR/CSS2/fonts.html#propdef-font-size\n\t\t\tfont_size_legacy_values: 'xx-small,small,medium,large,x-large,xx-large,300%',\n\t\t\tforced_root_block: 'p',\n\t\t\thidden_input: true,\n\t\t\tpadd_empty_editor: true,\n\t\t\trender_ui: true,\n\t\t\tindentation: '30px',\n\t\t\tinline_styles: true,\n\t\t\tconvert_fonts_to_spans: true,\n\t\t\tindent: 'simple',\n\t\t\tindent_before: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' +\n\t\t\t\t'tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\n\t\t\tindent_after: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' +\n\t\t\t\t'tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\n\t\t\tvalidate: true,\n\t\t\tentity_encoding: 'named',\n\t\t\turl_converter: self.convertURL,\n\t\t\turl_converter_scope: self,\n\t\t\tie7_compat: true\n\t\t}, defaultSettings, settings);\n\n\t\t// Merge external_plugins\n\t\tif (defaultSettings && defaultSettings.external_plugins && settings.external_plugins) {\n\t\t\tsettings.external_plugins = extend({}, defaultSettings.external_plugins, settings.external_plugins);\n\t\t}\n\n\t\tself.settings = settings;\n\t\tAddOnManager.language = settings.language || 'en';\n\t\tAddOnManager.languageLoad = settings.language_load;\n\t\tAddOnManager.baseURL = editorManager.baseURL;\n\n\t\t/**\n\t\t * Editor instance id, normally the same as the div/textarea that was replaced.\n\t\t *\n\t\t * @property id\n\t\t * @type String\n\t\t */\n\t\tself.id = settings.id = id;\n\n\t\t/**\n\t\t * State to force the editor to return false on a isDirty call.\n\t\t *\n\t\t * @property isNotDirty\n\t\t * @type Boolean\n\t\t * @deprecated Use editor.setDirty instead.\n\t\t */\n\t\tself.setDirty(false);\n\n\t\t/**\n\t\t * Name/Value object containing plugin instances.\n\t\t *\n\t\t * @property plugins\n\t\t * @type Object\n\t\t * @example\n\t\t * // Execute a method inside a plugin directly\n\t\t * tinymce.activeEditor.plugins.someplugin.someMethod();\n\t\t */\n\t\tself.plugins = {};\n\n\t\t/**\n\t\t * URI object to document configured for the TinyMCE instance.\n\t\t *\n\t\t * @property documentBaseURI\n\t\t * @type tinymce.util.URI\n\t\t * @example\n\t\t * // Get relative URL from the location of document_base_url\n\t\t * tinymce.activeEditor.documentBaseURI.toRelative('/somedir/somefile.htm');\n\t\t *\n\t\t * // Get absolute URL from the location of document_base_url\n\t\t * tinymce.activeEditor.documentBaseURI.toAbsolute('somefile.htm');\n\t\t */\n\t\tself.documentBaseURI = new URI(settings.document_base_url || documentBaseUrl, {\n\t\t\tbase_uri: baseUri\n\t\t});\n\n\t\t/**\n\t\t * URI object to current document that holds the TinyMCE editor instance.\n\t\t *\n\t\t * @property baseURI\n\t\t * @type tinymce.util.URI\n\t\t * @example\n\t\t * // Get relative URL from the location of the API\n\t\t * tinymce.activeEditor.baseURI.toRelative('/somedir/somefile.htm');\n\t\t *\n\t\t * // Get absolute URL from the location of the API\n\t\t * tinymce.activeEditor.baseURI.toAbsolute('somefile.htm');\n\t\t */\n\t\tself.baseURI = baseUri;\n\n\t\t/**\n\t\t * Array with CSS files to load into the iframe.\n\t\t *\n\t\t * @property contentCSS\n\t\t * @type Array\n\t\t */\n\t\tself.contentCSS = [];\n\n\t\t/**\n\t\t * Array of CSS styles to add to head of document when the editor loads.\n\t\t *\n\t\t * @property contentStyles\n\t\t * @type Array\n\t\t */\n\t\tself.contentStyles = [];\n\n\t\t// Creates all events like onClick, onSetContent etc see Editor.Events.js for the actual logic\n\t\tself.shortcuts = new Shortcuts(self);\n\t\tself.loadedCSS = {};\n\t\tself.editorCommands = new EditorCommands(self);\n\t\tself.suffix = editorManager.suffix;\n\t\tself.editorManager = editorManager;\n\t\tself.inline = settings.inline;\n\t\tself.settings.content_editable = self.inline;\n\n\t\tif (settings.cache_suffix) {\n\t\t\tEnv.cacheSuffix = settings.cache_suffix.replace(/^[\\?\\&]+/, '');\n\t\t}\n\n\t\tif (settings.override_viewport === false) {\n\t\t\tEnv.overrideViewPort = false;\n\t\t}\n\n\t\t// Call setup\n\t\teditorManager.fire('SetupEditor', self);\n\t\tself.execCallback('setup', self);\n\n\t\t/**\n\t\t * Dom query instance with default scope to the editor document and default element is the body of the editor.\n\t\t *\n\t\t * @property $\n\t\t * @type tinymce.dom.DomQuery\n\t\t * @example\n\t\t * tinymce.activeEditor.$('p').css('color', 'red');\n\t\t * tinymce.activeEditor.$().append('<p>new</p>');\n\t\t */\n\t\tself.$ = DomQuery.overrideDefaults(function() {\n\t\t\treturn {\n\t\t\t\tcontext: self.inline ? self.getBody() : self.getDoc(),\n\t\t\t\telement: self.getBody()\n\t\t\t};\n\t\t});\n\t}\n\n\tEditor.prototype = {\n\t\t/**\n\t\t * Renders the editor/adds it to the page.\n\t\t *\n\t\t * @method render\n\t\t */\n\t\trender: function() {\n\t\t\tvar self = this, settings = self.settings, id = self.id, suffix = self.suffix;\n\n\t\t\tfunction readyHandler() {\n\t\t\t\tDOM.unbind(window, 'ready', readyHandler);\n\t\t\t\tself.render();\n\t\t\t}\n\n\t\t\t// Page is not loaded yet, wait for it\n\t\t\tif (!Event.domLoaded) {\n\t\t\t\tDOM.bind(window, 'ready', readyHandler);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Element not found, then skip initialization\n\t\t\tif (!self.getElement()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// No editable support old iOS versions etc\n\t\t\tif (!Env.contentEditable) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Hide target element early to prevent content flashing\n\t\t\tif (!settings.inline) {\n\t\t\t\tself.orgVisibility = self.getElement().style.visibility;\n\t\t\t\tself.getElement().style.visibility = 'hidden';\n\t\t\t} else {\n\t\t\t\tself.inline = true;\n\t\t\t}\n\n\t\t\tvar form = self.getElement().form || DOM.getParent(id, 'form');\n\t\t\tif (form) {\n\t\t\t\tself.formElement = form;\n\n\t\t\t\t// Add hidden input for non input elements inside form elements\n\t\t\t\tif (settings.hidden_input && !/TEXTAREA|INPUT/i.test(self.getElement().nodeName)) {\n\t\t\t\t\tDOM.insertAfter(DOM.create('input', {type: 'hidden', name: id}), id);\n\t\t\t\t\tself.hasHiddenInput = true;\n\t\t\t\t}\n\n\t\t\t\t// Pass submit/reset from form to editor instance\n\t\t\t\tself.formEventDelegate = function(e) {\n\t\t\t\t\tself.fire(e.type, e);\n\t\t\t\t};\n\n\t\t\t\tDOM.bind(form, 'submit reset', self.formEventDelegate);\n\n\t\t\t\t// Reset contents in editor when the form is reset\n\t\t\t\tself.on('reset', function() {\n\t\t\t\t\tself.setContent(self.startContent, {format: 'raw'});\n\t\t\t\t});\n\n\t\t\t\t// Check page uses id=\"submit\" or name=\"submit\" for it's submit button\n\t\t\t\tif (settings.submit_patch && !form.submit.nodeType && !form.submit.length && !form._mceOldSubmit) {\n\t\t\t\t\tform._mceOldSubmit = form.submit;\n\t\t\t\t\tform.submit = function() {\n\t\t\t\t\t\tself.editorManager.triggerSave();\n\t\t\t\t\t\tself.setDirty(false);\n\n\t\t\t\t\t\treturn form._mceOldSubmit(form);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Window manager reference, use this to open new windows and dialogs.\n\t\t\t *\n\t\t\t * @property windowManager\n\t\t\t * @type tinymce.WindowManager\n\t\t\t * @example\n\t\t\t * // Shows an alert message\n\t\t\t * tinymce.activeEditor.windowManager.alert('Hello world!');\n\t\t\t *\n\t\t\t * // Opens a new dialog with the file.htm file and the size 320x240\n\t\t\t * // It also adds a custom parameter this can be retrieved by using tinyMCEPopup.getWindowArg inside the dialog.\n\t\t\t * tinymce.activeEditor.windowManager.open({\n\t\t\t *    url: 'file.htm',\n\t\t\t *    width: 320,\n\t\t\t *    height: 240\n\t\t\t * }, {\n\t\t\t *    custom_param: 1\n\t\t\t * });\n\t\t\t */\n\t\t\tself.windowManager = new WindowManager(self);\n\n\t\t\t/**\n\t\t\t * Notification manager reference, use this to open new windows and dialogs.\n\t\t\t *\n\t\t\t * @property notificationManager\n\t\t\t * @type tinymce.NotificationManager\n\t\t\t * @example\n\t\t\t * // Shows a notification info message.\n\t\t\t * tinymce.activeEditor.notificationManager.open({text: 'Hello world!', type: 'info'});\n\t\t\t */\n\t\t\tself.notificationManager = new NotificationManager(self);\n\n\t\t\tif (settings.encoding == 'xml') {\n\t\t\t\tself.on('GetContent', function(e) {\n\t\t\t\t\tif (e.save) {\n\t\t\t\t\t\te.content = DOM.encode(e.content);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (settings.add_form_submit_trigger) {\n\t\t\t\tself.on('submit', function() {\n\t\t\t\t\tif (self.initialized) {\n\t\t\t\t\t\tself.save();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (settings.add_unload_trigger) {\n\t\t\t\tself._beforeUnload = function() {\n\t\t\t\t\tif (self.initialized && !self.destroyed && !self.isHidden()) {\n\t\t\t\t\t\tself.save({format: 'raw', no_events: true, set_dirty: false});\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tself.editorManager.on('BeforeUnload', self._beforeUnload);\n\t\t\t}\n\n\t\t\t// Load scripts\n\t\t\tfunction loadScripts() {\n\t\t\t\tvar scriptLoader = ScriptLoader.ScriptLoader;\n\n\t\t\t\tif (settings.language && settings.language != 'en' && !settings.language_url) {\n\t\t\t\t\tsettings.language_url = self.editorManager.baseURL + '/langs/' + settings.language + '.js';\n\t\t\t\t}\n\n\t\t\t\tif (settings.language_url) {\n\t\t\t\t\tscriptLoader.add(settings.language_url);\n\t\t\t\t}\n\n\t\t\t\tif (settings.theme && typeof settings.theme != \"function\" &&\n\t\t\t\t\tsettings.theme.charAt(0) != '-' && !ThemeManager.urls[settings.theme]) {\n\t\t\t\t\tvar themeUrl = settings.theme_url;\n\n\t\t\t\t\tif (themeUrl) {\n\t\t\t\t\t\tthemeUrl = self.documentBaseURI.toAbsolute(themeUrl);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthemeUrl = 'themes/' + settings.theme + '/theme' + suffix + '.js';\n\t\t\t\t\t}\n\n\t\t\t\t\tThemeManager.load(settings.theme, themeUrl);\n\t\t\t\t}\n\n\t\t\t\tif (Tools.isArray(settings.plugins)) {\n\t\t\t\t\tsettings.plugins = settings.plugins.join(' ');\n\t\t\t\t}\n\n\t\t\t\teach(settings.external_plugins, function(url, name) {\n\t\t\t\t\tPluginManager.load(name, url);\n\t\t\t\t\tsettings.plugins += ' ' + name;\n\t\t\t\t});\n\n\t\t\t\teach(settings.plugins.split(/[ ,]/), function(plugin) {\n\t\t\t\t\tplugin = trim(plugin);\n\n\t\t\t\t\tif (plugin && !PluginManager.urls[plugin]) {\n\t\t\t\t\t\tif (plugin.charAt(0) == '-') {\n\t\t\t\t\t\t\tplugin = plugin.substr(1, plugin.length);\n\n\t\t\t\t\t\t\tvar dependencies = PluginManager.dependencies(plugin);\n\n\t\t\t\t\t\t\teach(dependencies, function(dep) {\n\t\t\t\t\t\t\t\tvar defaultSettings = {\n\t\t\t\t\t\t\t\t\tprefix: 'plugins/',\n\t\t\t\t\t\t\t\t\tresource: dep,\n\t\t\t\t\t\t\t\t\tsuffix: '/plugin' + suffix + '.js'\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tdep = PluginManager.createUrl(defaultSettings, dep);\n\t\t\t\t\t\t\t\tPluginManager.load(dep.resource, dep);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tPluginManager.load(plugin, {\n\t\t\t\t\t\t\t\tprefix: 'plugins/',\n\t\t\t\t\t\t\t\tresource: plugin,\n\t\t\t\t\t\t\t\tsuffix: '/plugin' + suffix + '.js'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tscriptLoader.loadQueue(function() {\n\t\t\t\t\tif (!self.removed) {\n\t\t\t\t\t\tself.init();\n\t\t\t\t\t}\n\t\t\t\t}, self, function (urls) {\n\t\t\t\t\tErrorReporter.pluginLoadError(self, urls[0]);\n\n\t\t\t\t\tif (!self.removed) {\n\t\t\t\t\t\tself.init();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.editorManager.add(self);\n\t\t\tloadScripts();\n\t\t},\n\n\t\t/**\n\t\t * Initializes the editor this will be called automatically when\n\t\t * all plugins/themes and language packs are loaded by the rendered method.\n\t\t * This method will setup the iframe and create the theme and plugin instances.\n\t\t *\n\t\t * @method init\n\t\t */\n\t\tinit: function() {\n\t\t\tvar self = this, settings = self.settings, elm = self.getElement();\n\t\t\tvar w, h, minHeight, n, o, Theme, url, bodyId, bodyClass, re, i, initializedPlugins = [];\n\n\t\t\tself.rtl = settings.rtl_ui || self.editorManager.i18n.rtl;\n\t\t\tself.editorManager.i18n.setCode(settings.language);\n\t\t\tsettings.aria_label = settings.aria_label || DOM.getAttrib(elm, 'aria-label', self.getLang('aria.rich_text_area'));\n\n\t\t\tself.fire('ScriptsLoaded');\n\n\t\t\t/**\n\t\t\t * Reference to the theme instance that was used to generate the UI.\n\t\t\t *\n\t\t\t * @property theme\n\t\t\t * @type tinymce.Theme\n\t\t\t * @example\n\t\t\t * // Executes a method on the theme directly\n\t\t\t * tinymce.activeEditor.theme.someMethod();\n\t\t\t */\n\t\t\tif (settings.theme) {\n\t\t\t\tif (typeof settings.theme != \"function\") {\n\t\t\t\t\tsettings.theme = settings.theme.replace(/-/, '');\n\t\t\t\t\tTheme = ThemeManager.get(settings.theme);\n\t\t\t\t\tself.theme = new Theme(self, ThemeManager.urls[settings.theme]);\n\n\t\t\t\t\tif (self.theme.init) {\n\t\t\t\t\t\tself.theme.init(self, ThemeManager.urls[settings.theme] || self.documentBaseUrl.replace(/\\/$/, ''), self.$);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tself.theme = settings.theme;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction initPlugin(plugin) {\n\t\t\t\tvar Plugin = PluginManager.get(plugin), pluginUrl, pluginInstance;\n\n\t\t\t\tpluginUrl = PluginManager.urls[plugin] || self.documentBaseUrl.replace(/\\/$/, '');\n\t\t\t\tplugin = trim(plugin);\n\t\t\t\tif (Plugin && inArray(initializedPlugins, plugin) === -1) {\n\t\t\t\t\teach(PluginManager.dependencies(plugin), function(dep) {\n\t\t\t\t\t\tinitPlugin(dep);\n\t\t\t\t\t});\n\n\t\t\t\t\tif (self.plugins[plugin]) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tpluginInstance = new Plugin(self, pluginUrl, self.$);\n\n\t\t\t\t\tself.plugins[plugin] = pluginInstance;\n\n\t\t\t\t\tif (pluginInstance.init) {\n\t\t\t\t\t\tpluginInstance.init(self, pluginUrl);\n\t\t\t\t\t\tinitializedPlugins.push(plugin);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Create all plugins\n\t\t\teach(settings.plugins.replace(/\\-/g, '').split(/[ ,]/), initPlugin);\n\n\t\t\t// Measure box\n\t\t\tif (settings.render_ui && self.theme) {\n\t\t\t\tself.orgDisplay = elm.style.display;\n\n\t\t\t\tif (typeof settings.theme != \"function\") {\n\t\t\t\t\tw = settings.width || elm.style.width || elm.offsetWidth;\n\t\t\t\t\th = settings.height || elm.style.height || elm.offsetHeight;\n\t\t\t\t\tminHeight = settings.min_height || 100;\n\t\t\t\t\tre = /^[0-9\\.]+(|px)$/i;\n\n\t\t\t\t\tif (re.test('' + w)) {\n\t\t\t\t\t\tw = Math.max(parseInt(w, 10), 100);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (re.test('' + h)) {\n\t\t\t\t\t\th = Math.max(parseInt(h, 10), minHeight);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Render UI\n\t\t\t\t\to = self.theme.renderUI({\n\t\t\t\t\t\ttargetNode: elm,\n\t\t\t\t\t\twidth: w,\n\t\t\t\t\t\theight: h,\n\t\t\t\t\t\tdeltaWidth: settings.delta_width,\n\t\t\t\t\t\tdeltaHeight: settings.delta_height\n\t\t\t\t\t});\n\n\t\t\t\t\t// Resize editor\n\t\t\t\t\tif (!settings.content_editable) {\n\t\t\t\t\t\th = (o.iframeHeight || h) + (typeof h == 'number' ? (o.deltaHeight || 0) : '');\n\t\t\t\t\t\tif (h < minHeight) {\n\t\t\t\t\t\t\th = minHeight;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\to = settings.theme(self, elm);\n\n\t\t\t\t\tif (o.editorContainer.nodeType) {\n\t\t\t\t\t\to.editorContainer.id = o.editorContainer.id || self.id + \"_parent\";\n\t\t\t\t\t}\n\n\t\t\t\t\tif (o.iframeContainer.nodeType) {\n\t\t\t\t\t\to.iframeContainer.id = o.iframeContainer.id || self.id + \"_iframecontainer\";\n\t\t\t\t\t}\n\n\t\t\t\t\t// Use specified iframe height or the targets offsetHeight\n\t\t\t\t\th = o.iframeHeight || elm.offsetHeight;\n\t\t\t\t}\n\n\t\t\t\tself.editorContainer = o.editorContainer;\n\t\t\t}\n\n\t\t\t// Load specified content CSS last\n\t\t\tif (settings.content_css) {\n\t\t\t\teach(explode(settings.content_css), function(u) {\n\t\t\t\t\tself.contentCSS.push(self.documentBaseURI.toAbsolute(u));\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Load specified content CSS last\n\t\t\tif (settings.content_style) {\n\t\t\t\tself.contentStyles.push(settings.content_style);\n\t\t\t}\n\n\t\t\t// Content editable mode ends here\n\t\t\tif (settings.content_editable) {\n\t\t\t\telm = n = o = null; // Fix IE leak\n\t\t\t\treturn self.initContentBody();\n\t\t\t}\n\n\t\t\tself.iframeHTML = settings.doctype + '<html><head>';\n\n\t\t\t// We only need to override paths if we have to\n\t\t\t// IE has a bug where it remove site absolute urls to relative ones if this is specified\n\t\t\tif (settings.document_base_url != self.documentBaseUrl) {\n\t\t\t\tself.iframeHTML += '<base href=\"' + self.documentBaseURI.getURI() + '\" />';\n\t\t\t}\n\n\t\t\t// IE8 doesn't support carets behind images setting ie7_compat would force IE8+ to run in IE7 compat mode.\n\t\t\tif (!Env.caretAfter && settings.ie7_compat) {\n\t\t\t\tself.iframeHTML += '<meta http-equiv=\"X-UA-Compatible\" content=\"IE=7\" />';\n\t\t\t}\n\n\t\t\tself.iframeHTML += '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />';\n\n\t\t\t// Load the CSS by injecting them into the HTML this will reduce \"flicker\"\n\t\t\t// However we can't do that on Chrome since # will scroll to the editor for some odd reason see #2427\n\t\t\tif (!/#$/.test(document.location.href)) {\n\t\t\t\tfor (i = 0; i < self.contentCSS.length; i++) {\n\t\t\t\t\tvar cssUrl = self.contentCSS[i];\n\t\t\t\t\tself.iframeHTML += (\n\t\t\t\t\t\t'<link type=\"text/css\" ' +\n\t\t\t\t\t\t\t'rel=\"stylesheet\" ' +\n\t\t\t\t\t\t\t'href=\"' + Tools._addCacheSuffix(cssUrl) + '\" />'\n\t\t\t\t\t);\n\t\t\t\t\tself.loadedCSS[cssUrl] = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbodyId = settings.body_id || 'tinymce';\n\t\t\tif (bodyId.indexOf('=') != -1) {\n\t\t\t\tbodyId = self.getParam('body_id', '', 'hash');\n\t\t\t\tbodyId = bodyId[self.id] || bodyId;\n\t\t\t}\n\n\t\t\tbodyClass = settings.body_class || '';\n\t\t\tif (bodyClass.indexOf('=') != -1) {\n\t\t\t\tbodyClass = self.getParam('body_class', '', 'hash');\n\t\t\t\tbodyClass = bodyClass[self.id] || '';\n\t\t\t}\n\n\t\t\tif (settings.content_security_policy) {\n\t\t\t\tself.iframeHTML += '<meta http-equiv=\"Content-Security-Policy\" content=\"' + settings.content_security_policy + '\" />';\n\t\t\t}\n\n\t\t\tself.iframeHTML += '</head><body id=\"' + bodyId +\n\t\t\t\t'\" class=\"mce-content-body ' + bodyClass +\n\t\t\t\t'\" data-id=\"' + self.id + '\"><br></body></html>';\n\n\t\t\t/*eslint no-script-url:0 */\n\t\t\tvar domainRelaxUrl = 'javascript:(function(){' +\n\t\t\t\t'document.open();document.domain=\"' + document.domain + '\";' +\n\t\t\t\t'var ed = window.parent.tinymce.get(\"' + self.id + '\");document.write(ed.iframeHTML);' +\n\t\t\t\t'document.close();ed.initContentBody(true);})()';\n\n\t\t\t// Domain relaxing is required since the user has messed around with document.domain\n\t\t\tif (document.domain != location.hostname) {\n\t\t\t\t// Edge seems to be able to handle domain relaxing\n\t\t\t\tif (Env.ie && Env.ie < 12) {\n\t\t\t\t\turl = domainRelaxUrl;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Create iframe\n\t\t\t// TODO: ACC add the appropriate description on this.\n\t\t\tvar ifr = DOM.create('iframe', {\n\t\t\t\tid: self.id + \"_ifr\",\n\t\t\t\t//src: url || 'javascript:\"\"', // Workaround for HTTPS warning in IE6/7\n\t\t\t\tframeBorder: '0',\n\t\t\t\tallowTransparency: \"true\",\n\t\t\t\ttitle: self.editorManager.translate(\n\t\t\t\t\t\t\"Rich Text Area. Press ALT-F9 for menu. \" +\n\t\t\t\t\t\t\"Press ALT-F10 for toolbar. Press ALT-0 for help\"\n\t\t\t\t),\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: '100%',\n\t\t\t\t\theight: h,\n\t\t\t\t\tdisplay: 'block' // Important for Gecko to render the iframe correctly\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tifr.onload = function() {\n\t\t\t\tifr.onload = null;\n\t\t\t\tself.fire(\"load\");\n\t\t\t};\n\n\t\t\tDOM.setAttrib(ifr, \"src\", url || 'javascript:\"\"');\n\n\t\t\tself.contentAreaContainer = o.iframeContainer;\n\t\t\tself.iframeElement = ifr;\n\n\t\t\tn = DOM.add(o.iframeContainer, ifr);\n\n\t\t\t// Try accessing the document this will fail on IE when document.domain is set to the same as location.hostname\n\t\t\t// Then we have to force domain relaxing using the domainRelaxUrl approach very ugly!!\n\t\t\tif (ie) {\n\t\t\t\ttry {\n\t\t\t\t\tself.getDoc();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tn.src = url = domainRelaxUrl;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (o.editorContainer) {\n\t\t\t\tDOM.get(o.editorContainer).style.display = self.orgDisplay;\n\t\t\t\tself.hidden = DOM.isHidden(o.editorContainer);\n\t\t\t}\n\n\t\t\tself.getElement().style.display = 'none';\n\t\t\tDOM.setAttrib(self.id, 'aria-hidden', true);\n\n\t\t\tif (!url) {\n\t\t\t\tself.initContentBody();\n\t\t\t}\n\n\t\t\telm = n = o = null; // Cleanup\n\t\t},\n\n\t\t/**\n\t\t * This method get called by the init method once the iframe is loaded.\n\t\t * It will fill the iframe with contents, sets up DOM and selection objects for the iframe.\n\t\t *\n\t\t * @method initContentBody\n\t\t * @private\n\t\t */\n\t\tinitContentBody: function(skipWrite) {\n\t\t\tvar self = this, settings = self.settings, targetElm = self.getElement(), doc = self.getDoc(), body, contentCssText;\n\n\t\t\t// Restore visibility on target element\n\t\t\tif (!settings.inline) {\n\t\t\t\tself.getElement().style.visibility = self.orgVisibility;\n\t\t\t}\n\n\t\t\t// Setup iframe body\n\t\t\tif (!skipWrite && !settings.content_editable) {\n\t\t\t\tdoc.open();\n\t\t\t\tdoc.write(self.iframeHTML);\n\t\t\t\tdoc.close();\n\t\t\t}\n\n\t\t\tif (settings.content_editable) {\n\t\t\t\tself.on('remove', function() {\n\t\t\t\t\tvar bodyEl = this.getBody();\n\n\t\t\t\t\tDOM.removeClass(bodyEl, 'mce-content-body');\n\t\t\t\t\tDOM.removeClass(bodyEl, 'mce-edit-focus');\n\t\t\t\t\tDOM.setAttrib(bodyEl, 'contentEditable', null);\n\t\t\t\t});\n\n\t\t\t\tDOM.addClass(targetElm, 'mce-content-body');\n\t\t\t\tself.contentDocument = doc = settings.content_document || document;\n\t\t\t\tself.contentWindow = settings.content_window || window;\n\t\t\t\tself.bodyElement = targetElm;\n\n\t\t\t\t// Prevent leak in IE\n\t\t\t\tsettings.content_document = settings.content_window = null;\n\n\t\t\t\t// TODO: Fix this\n\t\t\t\tsettings.root_name = targetElm.nodeName.toLowerCase();\n\t\t\t}\n\n\t\t\t// It will not steal focus while setting contentEditable\n\t\t\tbody = self.getBody();\n\t\t\tbody.disabled = true;\n\t\t\tself.readonly = settings.readonly;\n\n\t\t\tif (!self.readonly) {\n\t\t\t\tif (self.inline && DOM.getStyle(body, 'position', true) == 'static') {\n\t\t\t\t\tbody.style.position = 'relative';\n\t\t\t\t}\n\n\t\t\t\tbody.contentEditable = self.getParam('content_editable_state', true);\n\t\t\t}\n\n\t\t\tbody.disabled = false;\n\n\t\t\tself.editorUpload = new EditorUpload(self);\n\n\t\t\t/**\n\t\t\t * Schema instance, enables you to validate elements and its children.\n\t\t\t *\n\t\t\t * @property schema\n\t\t\t * @type tinymce.html.Schema\n\t\t\t */\n\t\t\tself.schema = new Schema(settings);\n\n\t\t\t/**\n\t\t\t * DOM instance for the editor.\n\t\t\t *\n\t\t\t * @property dom\n\t\t\t * @type tinymce.dom.DOMUtils\n\t\t\t * @example\n\t\t\t * // Adds a class to all paragraphs within the editor\n\t\t\t * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'someclass');\n\t\t\t */\n\t\t\tself.dom = new DOMUtils(doc, {\n\t\t\t\tkeep_values: true,\n\t\t\t\turl_converter: self.convertURL,\n\t\t\t\turl_converter_scope: self,\n\t\t\t\thex_colors: settings.force_hex_style_colors,\n\t\t\t\tclass_filter: settings.class_filter,\n\t\t\t\tupdate_styles: true,\n\t\t\t\troot_element: self.inline ? self.getBody() : null,\n\t\t\t\tcollect: settings.content_editable,\n\t\t\t\tschema: self.schema,\n\t\t\t\tonSetAttrib: function(e) {\n\t\t\t\t\tself.fire('SetAttrib', e);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/**\n\t\t\t * HTML parser will be used when contents is inserted into the editor.\n\t\t\t *\n\t\t\t * @property parser\n\t\t\t * @type tinymce.html.DomParser\n\t\t\t */\n\t\t\tself.parser = new DomParser(settings, self.schema);\n\n\t\t\t// Convert src and href into data-mce-src, data-mce-href and data-mce-style\n\t\t\tself.parser.addAttributeFilter('src,href,style,tabindex', function(nodes, name) {\n\t\t\t\tvar i = nodes.length, node, dom = self.dom, value, internalName;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tvalue = node.attr(name);\n\t\t\t\t\tinternalName = 'data-mce-' + name;\n\n\t\t\t\t\t// Add internal attribute if we need to we don't on a refresh of the document\n\t\t\t\t\tif (!node.attributes.map[internalName]) {\n\t\t\t\t\t\t// Don't duplicate these since they won't get modified by any browser\n\t\t\t\t\t\tif (value.indexOf('data:') === 0 || value.indexOf('blob:') === 0) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (name === \"style\") {\n\t\t\t\t\t\t\tvalue = dom.serializeStyle(dom.parseStyle(value), node.name);\n\n\t\t\t\t\t\t\tif (!value.length) {\n\t\t\t\t\t\t\t\tvalue = null;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tnode.attr(internalName, value);\n\t\t\t\t\t\t\tnode.attr(name, value);\n\t\t\t\t\t\t} else if (name === \"tabindex\") {\n\t\t\t\t\t\t\tnode.attr(internalName, value);\n\t\t\t\t\t\t\tnode.attr(name, null);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.attr(internalName, self.convertURL(value, name, node.name));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Keep scripts from executing\n\t\t\tself.parser.addNodeFilter('script', function(nodes) {\n\t\t\t\tvar i = nodes.length, node, type;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\ttype = node.attr('type') || 'no/type';\n\t\t\t\t\tif (type.indexOf('mce-') !== 0) {\n\t\t\t\t\t\tnode.attr('type', 'mce-' + type);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.parser.addNodeFilter('#cdata', function(nodes) {\n\t\t\t\tvar i = nodes.length, node;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tnode.type = 8;\n\t\t\t\t\tnode.name = '#comment';\n\t\t\t\t\tnode.value = '[CDATA[' + node.value + ']]';\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.parser.addNodeFilter('p,h1,h2,h3,h4,h5,h6,div', function(nodes) {\n\t\t\t\tvar i = nodes.length, node, nonEmptyElements = self.schema.getNonEmptyElements();\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\n\t\t\t\t\tif (node.isEmpty(nonEmptyElements) && node.getAll('br').length === 0) {\n\t\t\t\t\t\tnode.append(new Node('br', 1)).shortEnded = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/**\n\t\t\t * DOM serializer for the editor. Will be used when contents is extracted from the editor.\n\t\t\t *\n\t\t\t * @property serializer\n\t\t\t * @type tinymce.dom.Serializer\n\t\t\t * @example\n\t\t\t * // Serializes the first paragraph in the editor into a string\n\t\t\t * tinymce.activeEditor.serializer.serialize(tinymce.activeEditor.dom.select('p')[0]);\n\t\t\t */\n\t\t\tself.serializer = new DomSerializer(settings, self);\n\n\t\t\t/**\n\t\t\t * Selection instance for the editor.\n\t\t\t *\n\t\t\t * @property selection\n\t\t\t * @type tinymce.dom.Selection\n\t\t\t * @example\n\t\t\t * // Sets some contents to the current selection in the editor\n\t\t\t * tinymce.activeEditor.selection.setContent('Some contents');\n\t\t\t *\n\t\t\t * // Gets the current selection\n\t\t\t * alert(tinymce.activeEditor.selection.getContent());\n\t\t\t *\n\t\t\t * // Selects the first paragraph found\n\t\t\t * tinymce.activeEditor.selection.select(tinymce.activeEditor.dom.select('p')[0]);\n\t\t\t */\n\t\t\tself.selection = new Selection(self.dom, self.getWin(), self.serializer, self);\n\n\t\t\t/**\n\t\t\t * Formatter instance.\n\t\t\t *\n\t\t\t * @property formatter\n\t\t\t * @type tinymce.Formatter\n\t\t\t */\n\t\t\tself.formatter = new Formatter(self);\n\n\t\t\t/**\n\t\t\t * Undo manager instance, responsible for handling undo levels.\n\t\t\t *\n\t\t\t * @property undoManager\n\t\t\t * @type tinymce.UndoManager\n\t\t\t * @example\n\t\t\t * // Undoes the last modification to the editor\n\t\t\t * tinymce.activeEditor.undoManager.undo();\n\t\t\t */\n\t\t\tself.undoManager = new UndoManager(self);\n\n\t\t\tself.forceBlocks = new ForceBlocks(self);\n\t\t\tself.enterKey = new EnterKey(self);\n\t\t\tself._nodeChangeDispatcher = new NodeChange(self);\n\t\t\tself._selectionOverrides = new SelectionOverrides(self);\n\n\t\t\tself.fire('PreInit');\n\n\t\t\tif (!settings.browser_spellcheck && !settings.gecko_spellcheck) {\n\t\t\t\tdoc.body.spellcheck = false; // Gecko\n\t\t\t\tDOM.setAttrib(body, \"spellcheck\", \"false\");\n\t\t\t}\n\n\t\t\tself.quirks = new Quirks(self);\n\t\t\tself.fire('PostRender');\n\n\t\t\tif (settings.directionality) {\n\t\t\t\tbody.dir = settings.directionality;\n\t\t\t}\n\n\t\t\tif (settings.nowrap) {\n\t\t\t\tbody.style.whiteSpace = \"nowrap\";\n\t\t\t}\n\n\t\t\tif (settings.protect) {\n\t\t\t\tself.on('BeforeSetContent', function(e) {\n\t\t\t\t\teach(settings.protect, function(pattern) {\n\t\t\t\t\t\te.content = e.content.replace(pattern, function(str) {\n\t\t\t\t\t\t\treturn '<!--mce:protected ' + escape(str) + '-->';\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.on('SetContent', function() {\n\t\t\t\tself.addVisual(self.getBody());\n\t\t\t});\n\n\t\t\t// Remove empty contents\n\t\t\tif (settings.padd_empty_editor) {\n\t\t\t\tself.on('PostProcess', function(e) {\n\t\t\t\t\te.content = e.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\\s|\\u00a0|<br \\/>|)<\\/p>[\\r\\n]*|<br \\/>[\\r\\n]*)$/, '');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.load({initial: true, format: 'html'});\n\t\t\tself.startContent = self.getContent({format: 'raw'});\n\n\t\t\t/**\n\t\t\t * Is set to true after the editor instance has been initialized\n\t\t\t *\n\t\t\t * @property initialized\n\t\t\t * @type Boolean\n\t\t\t * @example\n\t\t\t * function isEditorInitialized(editor) {\n\t\t\t *     return editor && editor.initialized;\n\t\t\t * }\n\t\t\t */\n\t\t\tself.initialized = true;\n\t\t\tself.bindPendingEventDelegates();\n\n\t\t\tself.fire('init');\n\t\t\tself.focus(true);\n\t\t\tself.nodeChanged({initial: true});\n\t\t\tself.execCallback('init_instance_callback', self);\n\n\t\t\tself.on('compositionstart compositionend', function(e) {\n\t\t\t\tself.composing = e.type === 'compositionstart';\n\t\t\t});\n\n\t\t\t// Add editor specific CSS styles\n\t\t\tif (self.contentStyles.length > 0) {\n\t\t\t\tcontentCssText = '';\n\n\t\t\t\teach(self.contentStyles, function(style) {\n\t\t\t\t\tcontentCssText += style + \"\\r\\n\";\n\t\t\t\t});\n\n\t\t\t\tself.dom.addStyle(contentCssText);\n\t\t\t}\n\n\t\t\t// Load specified content CSS last\n\t\t\teach(self.contentCSS, function(cssUrl) {\n\t\t\t\tif (!self.loadedCSS[cssUrl]) {\n\t\t\t\t\tself.dom.loadCSS(cssUrl);\n\t\t\t\t\tself.loadedCSS[cssUrl] = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Handle auto focus\n\t\t\tif (settings.auto_focus) {\n\t\t\t\tDelay.setEditorTimeout(self, function() {\n\t\t\t\t\tvar editor;\n\n\t\t\t\t\tif (settings.auto_focus === true) {\n\t\t\t\t\t\teditor = self;\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor = self.editorManager.get(settings.auto_focus);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!editor.destroyed) {\n\t\t\t\t\t\teditor.focus();\n\t\t\t\t\t}\n\t\t\t\t}, 100);\n\t\t\t}\n\n\t\t\t// Clean up references for IE\n\t\t\ttargetElm = doc = body = null;\n\t\t},\n\n\t\t/**\n\t\t * Focuses/activates the editor. This will set this editor as the activeEditor in the tinymce collection\n\t\t * it will also place DOM focus inside the editor.\n\t\t *\n\t\t * @method focus\n\t\t * @param {Boolean} skipFocus Skip DOM focus. Just set is as the active editor.\n\t\t */\n\t\tfocus: function(skipFocus) {\n\t\t\tvar self = this, selection = self.selection, contentEditable = self.settings.content_editable, rng;\n\t\t\tvar controlElm, doc = self.getDoc(), body = self.getBody(), contentEditableHost;\n\n\t\t\tfunction getContentEditableHost(node) {\n\t\t\t\treturn self.dom.getParent(node, function(node) {\n\t\t\t\t\treturn self.dom.getContentEditable(node) === \"true\";\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!skipFocus) {\n\t\t\t\t// Get selected control element\n\t\t\t\trng = selection.getRng();\n\t\t\t\tif (rng.item) {\n\t\t\t\t\tcontrolElm = rng.item(0);\n\t\t\t\t}\n\n\t\t\t\tself.quirks.refreshContentEditable();\n\n\t\t\t\t// Move focus to contentEditable=true child if needed\n\t\t\t\tcontentEditableHost = getContentEditableHost(selection.getNode());\n\t\t\t\tif (self.$.contains(body, contentEditableHost)) {\n\t\t\t\t\tcontentEditableHost.focus();\n\t\t\t\t\tselection.normalize();\n\t\t\t\t\tself.editorManager.setActive(self);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Focus the window iframe\n\t\t\t\tif (!contentEditable) {\n\t\t\t\t\t// WebKit needs this call to fire focusin event properly see #5948\n\t\t\t\t\t// But Opera pre Blink engine will produce an empty selection so skip Opera\n\t\t\t\t\tif (!Env.opera) {\n\t\t\t\t\t\tself.getBody().focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tself.getWin().focus();\n\t\t\t\t}\n\n\t\t\t\t// Focus the body as well since it's contentEditable\n\t\t\t\tif (isGecko || contentEditable) {\n\t\t\t\t\t// Check for setActive since it doesn't scroll to the element\n\t\t\t\t\tif (body.setActive) {\n\t\t\t\t\t\t// IE 11 sometimes throws \"Invalid function\" then fallback to focus\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tbody.setActive();\n\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\tbody.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbody.focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (contentEditable) {\n\t\t\t\t\t\tselection.normalize();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Restore selected control element\n\t\t\t\t// This is needed when for example an image is selected within a\n\t\t\t\t// layer a call to focus will then remove the control selection\n\t\t\t\tif (controlElm && controlElm.ownerDocument == doc) {\n\t\t\t\t\trng = doc.body.createControlRange();\n\t\t\t\t\trng.addElement(controlElm);\n\t\t\t\t\trng.select();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.editorManager.setActive(self);\n\t\t},\n\n\t\t/**\n\t\t * Executes a legacy callback. This method is useful to call old 2.x option callbacks.\n\t\t * There new event model is a better way to add callback so this method might be removed in the future.\n\t\t *\n\t\t * @method execCallback\n\t\t * @param {String} name Name of the callback to execute.\n\t\t * @return {Object} Return value passed from callback function.\n\t\t */\n\t\texecCallback: function(name) {\n\t\t\tvar self = this, callback = self.settings[name], scope;\n\n\t\t\tif (!callback) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Look through lookup\n\t\t\tif (self.callbackLookup && (scope = self.callbackLookup[name])) {\n\t\t\t\tcallback = scope.func;\n\t\t\t\tscope = scope.scope;\n\t\t\t}\n\n\t\t\tif (typeof callback === 'string') {\n\t\t\t\tscope = callback.replace(/\\.\\w+$/, '');\n\t\t\t\tscope = scope ? resolve(scope) : 0;\n\t\t\t\tcallback = resolve(callback);\n\t\t\t\tself.callbackLookup = self.callbackLookup || {};\n\t\t\t\tself.callbackLookup[name] = {func: callback, scope: scope};\n\t\t\t}\n\n\t\t\treturn callback.apply(scope || self, Array.prototype.slice.call(arguments, 1));\n\t\t},\n\n\t\t/**\n\t\t * Translates the specified string by replacing variables with language pack items it will also check if there is\n\t\t * a key matching the input.\n\t\t *\n\t\t * @method translate\n\t\t * @param {String} text String to translate by the language pack data.\n\t\t * @return {String} Translated string.\n\t\t */\n\t\ttranslate: function(text) {\n\t\t\tvar lang = this.settings.language || 'en', i18n = this.editorManager.i18n;\n\n\t\t\tif (!text) {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\ttext = i18n.data[lang + '.' + text] || text.replace(/\\{\\#([^\\}]+)\\}/g, function(a, b) {\n\t\t\t\treturn i18n.data[lang + '.' + b] || '{#' + b + '}';\n\t\t\t});\n\n\t\t\treturn this.editorManager.translate(text);\n\t\t},\n\n\t\t/**\n\t\t * Returns a language pack item by name/key.\n\t\t *\n\t\t * @method getLang\n\t\t * @param {String} name Name/key to get from the language pack.\n\t\t * @param {String} defaultVal Optional default value to retrieve.\n\t\t */\n\t\tgetLang: function(name, defaultVal) {\n\t\t\treturn (\n\t\t\t\tthis.editorManager.i18n.data[(this.settings.language || 'en') + '.' + name] ||\n\t\t\t\t(defaultVal !== undefined ? defaultVal : '{#' + name + '}')\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Returns a configuration parameter by name.\n\t\t *\n\t\t * @method getParam\n\t\t * @param {String} name Configruation parameter to retrieve.\n\t\t * @param {String} defaultVal Optional default value to return.\n\t\t * @param {String} type Optional type parameter.\n\t\t * @return {String} Configuration parameter value or default value.\n\t\t * @example\n\t\t * // Returns a specific config value from the currently active editor\n\t\t * var someval = tinymce.activeEditor.getParam('myvalue');\n\t\t *\n\t\t * // Returns a specific config value from a specific editor instance by id\n\t\t * var someval2 = tinymce.get('my_editor').getParam('myvalue');\n\t\t */\n\t\tgetParam: function(name, defaultVal, type) {\n\t\t\tvar value = name in this.settings ? this.settings[name] : defaultVal, output;\n\n\t\t\tif (type === 'hash') {\n\t\t\t\toutput = {};\n\n\t\t\t\tif (typeof value === 'string') {\n\t\t\t\t\teach(value.indexOf('=') > 0 ? value.split(/[;,](?![^=;,]*(?:[;,]|$))/) : value.split(','), function(value) {\n\t\t\t\t\t\tvalue = value.split('=');\n\n\t\t\t\t\t\tif (value.length > 1) {\n\t\t\t\t\t\t\toutput[trim(value[0])] = trim(value[1]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toutput[trim(value[0])] = trim(value);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\toutput = value;\n\t\t\t\t}\n\n\t\t\t\treturn output;\n\t\t\t}\n\n\t\t\treturn value;\n\t\t},\n\n\t\t/**\n\t\t * Dispatches out a onNodeChange event to all observers. This method should be called when you\n\t\t * need to update the UI states or element path etc.\n\t\t *\n\t\t * @method nodeChanged\n\t\t * @param {Object} args Optional args to pass to NodeChange event handlers.\n\t\t */\n\t\tnodeChanged: function(args) {\n\t\t\tthis._nodeChangeDispatcher.nodeChanged(args);\n\t\t},\n\n\t\t/**\n\t\t * Adds a button that later gets created by the theme in the editors toolbars.\n\t\t *\n\t\t * @method addButton\n\t\t * @param {String} name Button name to add.\n\t\t * @param {Object} settings Settings object with title, cmd etc.\n\t\t * @example\n\t\t * // Adds a custom button to the editor that inserts contents when clicked\n\t\t * tinymce.init({\n\t\t *    ...\n\t\t *\n\t\t *    toolbar: 'example'\n\t\t *\n\t\t *    setup: function(ed) {\n\t\t *       ed.addButton('example', {\n\t\t *          title: 'My title',\n\t\t *          image: '../js/tinymce/plugins/example/img/example.gif',\n\t\t *          onclick: function() {\n\t\t *             ed.insertContent('Hello world!!');\n\t\t *          }\n\t\t *       });\n\t\t *    }\n\t\t * });\n\t\t */\n\t\taddButton: function(name, settings) {\n\t\t\tvar self = this;\n\n\t\t\tif (settings.cmd) {\n\t\t\t\tsettings.onclick = function() {\n\t\t\t\t\tself.execCommand(settings.cmd);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!settings.text && !settings.icon) {\n\t\t\t\tsettings.icon = name;\n\t\t\t}\n\n\t\t\tself.buttons = self.buttons || {};\n\t\t\tsettings.tooltip = settings.tooltip || settings.title;\n\t\t\tself.buttons[name] = settings;\n\t\t},\n\n\t\t/**\n\t\t * Adds a sidebar for the editor instance.\n\t\t *\n\t\t * @method addSidebar\n\t\t * @param {String} name Sidebar name to add.\n\t\t * @param {Object} settings Settings object with icon, onshow etc.\n\t\t * @example\n\t\t * // Adds a custom sidebar that when clicked logs the panel element\n\t\t * tinymce.init({\n\t\t *    ...\n\t\t *    setup: function(ed) {\n\t\t *       ed.addSidebar('example', {\n\t\t *          tooltip: 'My sidebar',\n\t\t *          icon: 'my-side-bar',\n\t\t *          onshow: function(api) {\n\t\t *             console.log(api.element());\n\t\t *          }\n\t\t *       });\n\t\t *    }\n\t\t * });\n\t\t */\n\t\taddSidebar: function (name, settings) {\n\t\t\treturn Sidebar.add(this, name, settings);\n\t\t},\n\n\t\t/**\n\t\t * Adds a menu item to be used in the menus of the theme. There might be multiple instances\n\t\t * of this menu item for example it might be used in the main menus of the theme but also in\n\t\t * the context menu so make sure that it's self contained and supports multiple instances.\n\t\t *\n\t\t * @method addMenuItem\n\t\t * @param {String} name Menu item name to add.\n\t\t * @param {Object} settings Settings object with title, cmd etc.\n\t\t * @example\n\t\t * // Adds a custom menu item to the editor that inserts contents when clicked\n\t\t * // The context option allows you to add the menu item to an existing default menu\n\t\t * tinymce.init({\n\t\t *    ...\n\t\t *\n\t\t *    setup: function(ed) {\n\t\t *       ed.addMenuItem('example', {\n\t\t *          text: 'My menu item',\n\t\t *          context: 'tools',\n\t\t *          onclick: function() {\n\t\t *             ed.insertContent('Hello world!!');\n\t\t *          }\n\t\t *       });\n\t\t *    }\n\t\t * });\n\t\t */\n\t\taddMenuItem: function(name, settings) {\n\t\t\tvar self = this;\n\n\t\t\tif (settings.cmd) {\n\t\t\t\tsettings.onclick = function() {\n\t\t\t\t\tself.execCommand(settings.cmd);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tself.menuItems = self.menuItems || {};\n\t\t\tself.menuItems[name] = settings;\n\t\t},\n\n\t\t/**\n\t\t * Adds a contextual toolbar to be rendered when the selector matches.\n\t\t *\n\t\t * @method addContextToolbar\n\t\t * @param {function/string} predicate Predicate that needs to return true if provided strings get converted into CSS predicates.\n\t\t * @param {String/Array} items String or array with items to add to the context toolbar.\n\t\t */\n\t\taddContextToolbar: function(predicate, items) {\n\t\t\tvar self = this, selector;\n\n\t\t\tself.contextToolbars = self.contextToolbars || [];\n\n\t\t\t// Convert selector to predicate\n\t\t\tif (typeof predicate == \"string\") {\n\t\t\t\tselector = predicate;\n\t\t\t\tpredicate = function(elm) {\n\t\t\t\t\treturn self.dom.is(elm, selector);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tself.contextToolbars.push({\n\t\t\t\tid: Uuid.uuid('mcet'),\n\t\t\t\tpredicate: predicate,\n\t\t\t\titems: items\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Adds a custom command to the editor, you can also override existing commands with this method.\n\t\t * The command that you add can be executed with execCommand.\n\t\t *\n\t\t * @method addCommand\n\t\t * @param {String} name Command name to add/override.\n\t\t * @param {addCommandCallback} callback Function to execute when the command occurs.\n\t\t * @param {Object} scope Optional scope to execute the function in.\n\t\t * @example\n\t\t * // Adds a custom command that later can be executed using execCommand\n\t\t * tinymce.init({\n\t\t *    ...\n\t\t *\n\t\t *    setup: function(ed) {\n\t\t *       // Register example command\n\t\t *       ed.addCommand('mycommand', function(ui, v) {\n\t\t *          ed.windowManager.alert('Hello world!! Selection: ' + ed.selection.getContent({format: 'text'}));\n\t\t *       });\n\t\t *    }\n\t\t * });\n\t\t */\n\t\taddCommand: function(name, callback, scope) {\n\t\t\t/**\n\t\t\t * Callback function that gets called when a command is executed.\n\t\t\t *\n\t\t\t * @callback addCommandCallback\n\t\t\t * @param {Boolean} ui Display UI state true/false.\n\t\t\t * @param {Object} value Optional value for command.\n\t\t\t * @return {Boolean} True/false state if the command was handled or not.\n\t\t\t */\n\t\t\tthis.editorCommands.addCommand(name, callback, scope);\n\t\t},\n\n\t\t/**\n\t\t * Adds a custom query state command to the editor, you can also override existing commands with this method.\n\t\t * The command that you add can be executed with queryCommandState function.\n\t\t *\n\t\t * @method addQueryStateHandler\n\t\t * @param {String} name Command name to add/override.\n\t\t * @param {addQueryStateHandlerCallback} callback Function to execute when the command state retrieval occurs.\n\t\t * @param {Object} scope Optional scope to execute the function in.\n\t\t */\n\t\taddQueryStateHandler: function(name, callback, scope) {\n\t\t\t/**\n\t\t\t * Callback function that gets called when a queryCommandState is executed.\n\t\t\t *\n\t\t\t * @callback addQueryStateHandlerCallback\n\t\t\t * @return {Boolean} True/false state if the command is enabled or not like is it bold.\n\t\t\t */\n\t\t\tthis.editorCommands.addQueryStateHandler(name, callback, scope);\n\t\t},\n\n\t\t/**\n\t\t * Adds a custom query value command to the editor, you can also override existing commands with this method.\n\t\t * The command that you add can be executed with queryCommandValue function.\n\t\t *\n\t\t * @method addQueryValueHandler\n\t\t * @param {String} name Command name to add/override.\n\t\t * @param {addQueryValueHandlerCallback} callback Function to execute when the command value retrieval occurs.\n\t\t * @param {Object} scope Optional scope to execute the function in.\n\t\t */\n\t\taddQueryValueHandler: function(name, callback, scope) {\n\t\t\t/**\n\t\t\t * Callback function that gets called when a queryCommandValue is executed.\n\t\t\t *\n\t\t\t * @callback addQueryValueHandlerCallback\n\t\t\t * @return {Object} Value of the command or undefined.\n\t\t\t */\n\t\t\tthis.editorCommands.addQueryValueHandler(name, callback, scope);\n\t\t},\n\n\t\t/**\n\t\t * Adds a keyboard shortcut for some command or function.\n\t\t *\n\t\t * @method addShortcut\n\t\t * @param {String} pattern Shortcut pattern. Like for example: ctrl+alt+o.\n\t\t * @param {String} desc Text description for the command.\n\t\t * @param {String/Function} cmdFunc Command name string or function to execute when the key is pressed.\n\t\t * @param {Object} sc Optional scope to execute the function in.\n\t\t * @return {Boolean} true/false state if the shortcut was added or not.\n\t\t */\n\t\taddShortcut: function(pattern, desc, cmdFunc, scope) {\n\t\t\tthis.shortcuts.add(pattern, desc, cmdFunc, scope);\n\t\t},\n\n\t\t/**\n\t\t * Executes a command on the current instance. These commands can be TinyMCE internal commands prefixed with \"mce\" or\n\t\t * they can be build in browser commands such as \"Bold\". A compleate list of browser commands is available on MSDN or Mozilla.org.\n\t\t * This function will dispatch the execCommand function on each plugin, theme or the execcommand_callback option if none of these\n\t\t * return true it will handle the command as a internal browser command.\n\t\t *\n\t\t * @method execCommand\n\t\t * @param {String} cmd Command name to execute, for example mceLink or Bold.\n\t\t * @param {Boolean} ui True/false state if a UI (dialog) should be presented or not.\n\t\t * @param {mixed} value Optional command value, this can be anything.\n\t\t * @param {Object} args Optional arguments object.\n\t\t */\n\t\texecCommand: function(cmd, ui, value, args) {\n\t\t\treturn this.editorCommands.execCommand(cmd, ui, value, args);\n\t\t},\n\n\t\t/**\n\t\t * Returns a command specific state, for example if bold is enabled or not.\n\t\t *\n\t\t * @method queryCommandState\n\t\t * @param {string} cmd Command to query state from.\n\t\t * @return {Boolean} Command specific state, for example if bold is enabled or not.\n\t\t */\n\t\tqueryCommandState: function(cmd) {\n\t\t\treturn this.editorCommands.queryCommandState(cmd);\n\t\t},\n\n\t\t/**\n\t\t * Returns a command specific value, for example the current font size.\n\t\t *\n\t\t * @method queryCommandValue\n\t\t * @param {string} cmd Command to query value from.\n\t\t * @return {Object} Command specific value, for example the current font size.\n\t\t */\n\t\tqueryCommandValue: function(cmd) {\n\t\t\treturn this.editorCommands.queryCommandValue(cmd);\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the command is supported or not.\n\t\t *\n\t\t * @method queryCommandSupported\n\t\t * @param {String} cmd Command that we check support for.\n\t\t * @return {Boolean} true/false if the command is supported or not.\n\t\t */\n\t\tqueryCommandSupported: function(cmd) {\n\t\t\treturn this.editorCommands.queryCommandSupported(cmd);\n\t\t},\n\n\t\t/**\n\t\t * Shows the editor and hides any textarea/div that the editor is supposed to replace.\n\t\t *\n\t\t * @method show\n\t\t */\n\t\tshow: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self.hidden) {\n\t\t\t\tself.hidden = false;\n\n\t\t\t\tif (self.inline) {\n\t\t\t\t\tself.getBody().contentEditable = true;\n\t\t\t\t} else {\n\t\t\t\t\tDOM.show(self.getContainer());\n\t\t\t\t\tDOM.hide(self.id);\n\t\t\t\t}\n\n\t\t\t\tself.load();\n\t\t\t\tself.fire('show');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Hides the editor and shows any textarea/div that the editor is supposed to replace.\n\t\t *\n\t\t * @method hide\n\t\t */\n\t\thide: function() {\n\t\t\tvar self = this, doc = self.getDoc();\n\n\t\t\tif (!self.hidden) {\n\t\t\t\t// Fixed bug where IE has a blinking cursor left from the editor\n\t\t\t\tif (ie && doc && !self.inline) {\n\t\t\t\t\tdoc.execCommand('SelectAll');\n\t\t\t\t}\n\n\t\t\t\t// We must save before we hide so Safari doesn't crash\n\t\t\t\tself.save();\n\n\t\t\t\tif (self.inline) {\n\t\t\t\t\tself.getBody().contentEditable = false;\n\n\t\t\t\t\t// Make sure the editor gets blurred\n\t\t\t\t\tif (self == self.editorManager.focusedEditor) {\n\t\t\t\t\t\tself.editorManager.focusedEditor = null;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tDOM.hide(self.getContainer());\n\t\t\t\t\tDOM.setStyle(self.id, 'display', self.orgDisplay);\n\t\t\t\t}\n\n\t\t\t\tself.hidden = true;\n\t\t\t\tself.fire('hide');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the editor is hidden or not.\n\t\t *\n\t\t * @method isHidden\n\t\t * @return {Boolean} True/false if the editor is hidden or not.\n\t\t */\n\t\tisHidden: function() {\n\t\t\treturn !!this.hidden;\n\t\t},\n\n\t\t/**\n\t\t * Sets the progress state, this will display a throbber/progess for the editor.\n\t\t * This is ideal for asynchronous operations like an AJAX save call.\n\t\t *\n\t\t * @method setProgressState\n\t\t * @param {Boolean} state Boolean state if the progress should be shown or hidden.\n\t\t * @param {Number} time Optional time to wait before the progress gets shown.\n\t\t * @return {Boolean} Same as the input state.\n\t\t * @example\n\t\t * // Show progress for the active editor\n\t\t * tinymce.activeEditor.setProgressState(true);\n\t\t *\n\t\t * // Hide progress for the active editor\n\t\t * tinymce.activeEditor.setProgressState(false);\n\t\t *\n\t\t * // Show progress after 3 seconds\n\t\t * tinymce.activeEditor.setProgressState(true, 3000);\n\t\t */\n\t\tsetProgressState: function(state, time) {\n\t\t\tthis.fire('ProgressState', {state: state, time: time});\n\t\t},\n\n\t\t/**\n\t\t * Loads contents from the textarea or div element that got converted into an editor instance.\n\t\t * This method will move the contents from that textarea or div into the editor by using setContent\n\t\t * so all events etc that method has will get dispatched as well.\n\t\t *\n\t\t * @method load\n\t\t * @param {Object} args Optional content object, this gets passed around through the whole load process.\n\t\t * @return {String} HTML string that got set into the editor.\n\t\t */\n\t\tload: function(args) {\n\t\t\tvar self = this, elm = self.getElement(), html;\n\n\t\t\tif (elm) {\n\t\t\t\targs = args || {};\n\t\t\t\targs.load = true;\n\n\t\t\t\thtml = self.setContent(elm.value !== undefined ? elm.value : elm.innerHTML, args);\n\t\t\t\targs.element = elm;\n\n\t\t\t\tif (!args.no_events) {\n\t\t\t\t\tself.fire('LoadContent', args);\n\t\t\t\t}\n\n\t\t\t\targs.element = elm = null;\n\n\t\t\t\treturn html;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Saves the contents from a editor out to the textarea or div element that got converted into an editor instance.\n\t\t * This method will move the HTML contents from the editor into that textarea or div by getContent\n\t\t * so all events etc that method has will get dispatched as well.\n\t\t *\n\t\t * @method save\n\t\t * @param {Object} args Optional content object, this gets passed around through the whole save process.\n\t\t * @return {String} HTML string that got set into the textarea/div.\n\t\t */\n\t\tsave: function(args) {\n\t\t\tvar self = this, elm = self.getElement(), html, form;\n\n\t\t\tif (!elm || !self.initialized) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\targs = args || {};\n\t\t\targs.save = true;\n\n\t\t\targs.element = elm;\n\t\t\thtml = args.content = self.getContent(args);\n\n\t\t\tif (!args.no_events) {\n\t\t\t\tself.fire('SaveContent', args);\n\t\t\t}\n\n\t\t\t// Always run this internal event\n\t\t\tif (args.format == 'raw') {\n\t\t\t\tself.fire('RawSaveContent', args);\n\t\t\t}\n\n\t\t\thtml = args.content;\n\n\t\t\tif (!/TEXTAREA|INPUT/i.test(elm.nodeName)) {\n\t\t\t\t// Update DIV element when not in inline mode\n\t\t\t\tif (!self.inline) {\n\t\t\t\t\telm.innerHTML = html;\n\t\t\t\t}\n\n\t\t\t\t// Update hidden form element\n\t\t\t\tif ((form = DOM.getParent(self.id, 'form'))) {\n\t\t\t\t\teach(form.elements, function(elm) {\n\t\t\t\t\t\tif (elm.name == self.id) {\n\t\t\t\t\t\t\telm.value = html;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\telm.value = html;\n\t\t\t}\n\n\t\t\targs.element = elm = null;\n\n\t\t\tif (args.set_dirty !== false) {\n\t\t\t\tself.setDirty(false);\n\t\t\t}\n\n\t\t\treturn html;\n\t\t},\n\n\t\t/**\n\t\t * Sets the specified content to the editor instance, this will cleanup the content before it gets set using\n\t\t * the different cleanup rules options.\n\t\t *\n\t\t * @method setContent\n\t\t * @param {String} content Content to set to editor, normally HTML contents but can be other formats as well.\n\t\t * @param {Object} args Optional content object, this gets passed around through the whole set process.\n\t\t * @return {String} HTML string that got set into the editor.\n\t\t * @example\n\t\t * // Sets the HTML contents of the activeEditor editor\n\t\t * tinymce.activeEditor.setContent('<span>some</span> html');\n\t\t *\n\t\t * // Sets the raw contents of the activeEditor editor\n\t\t * tinymce.activeEditor.setContent('<span>some</span> html', {format: 'raw'});\n\t\t *\n\t\t * // Sets the content of a specific editor (my_editor in this example)\n\t\t * tinymce.get('my_editor').setContent(data);\n\t\t *\n\t\t * // Sets the bbcode contents of the activeEditor editor if the bbcode plugin was added\n\t\t * tinymce.activeEditor.setContent('[b]some[/b] html', {format: 'bbcode'});\n\t\t */\n\t\tsetContent: function(content, args) {\n\t\t\tvar self = this, body = self.getBody(), forcedRootBlockName, padd;\n\n\t\t\t// Setup args object\n\t\t\targs = args || {};\n\t\t\targs.format = args.format || 'html';\n\t\t\targs.set = true;\n\t\t\targs.content = content;\n\n\t\t\t// Do preprocessing\n\t\t\tif (!args.no_events) {\n\t\t\t\tself.fire('BeforeSetContent', args);\n\t\t\t}\n\n\t\t\tcontent = args.content;\n\n\t\t\t// Padd empty content in Gecko and Safari. Commands will otherwise fail on the content\n\t\t\t// It will also be impossible to place the caret in the editor unless there is a BR element present\n\t\t\tif (content.length === 0 || /^\\s+$/.test(content)) {\n\t\t\t\tpadd = ie && ie < 11 ? '' : '<br data-mce-bogus=\"1\">';\n\n\t\t\t\t// Todo: There is a lot more root elements that need special padding\n\t\t\t\t// so separate this and add all of them at some point.\n\t\t\t\tif (body.nodeName == 'TABLE') {\n\t\t\t\t\tcontent = '<tr><td>' + padd + '</td></tr>';\n\t\t\t\t} else if (/^(UL|OL)$/.test(body.nodeName)) {\n\t\t\t\t\tcontent = '<li>' + padd + '</li>';\n\t\t\t\t}\n\n\t\t\t\tforcedRootBlockName = self.settings.forced_root_block;\n\n\t\t\t\t// Check if forcedRootBlock is configured and that the block is a valid child of the body\n\t\t\t\tif (forcedRootBlockName && self.schema.isValidChild(body.nodeName.toLowerCase(), forcedRootBlockName.toLowerCase())) {\n\t\t\t\t\t// Padd with bogus BR elements on modern browsers and IE 7 and 8 since they don't render empty P tags properly\n\t\t\t\t\tcontent = padd;\n\t\t\t\t\tcontent = self.dom.createHTML(forcedRootBlockName, self.settings.forced_root_block_attrs, content);\n\t\t\t\t} else if (!ie && !content) {\n\t\t\t\t\t// We need to add a BR when forced_root_block is disabled on non IE browsers to place the caret\n\t\t\t\t\tcontent = '<br data-mce-bogus=\"1\">';\n\t\t\t\t}\n\n\t\t\t\tself.dom.setHTML(body, content);\n\n\t\t\t\tself.fire('SetContent', args);\n\t\t\t} else {\n\t\t\t\t// Parse and serialize the html\n\t\t\t\tif (args.format !== 'raw') {\n\t\t\t\t\tcontent = new Serializer({\n\t\t\t\t\t\tvalidate: self.validate\n\t\t\t\t\t}, self.schema).serialize(\n\t\t\t\t\t\tself.parser.parse(content, {isRootContent: true})\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Set the new cleaned contents to the editor\n\t\t\t\targs.content = trim(content);\n\t\t\t\tself.dom.setHTML(body, args.content);\n\n\t\t\t\t// Do post processing\n\t\t\t\tif (!args.no_events) {\n\t\t\t\t\tself.fire('SetContent', args);\n\t\t\t\t}\n\n\t\t\t\t// Don't normalize selection if the focused element isn't the body in\n\t\t\t\t// content editable mode since it will steal focus otherwise\n\t\t\t\t/*if (!self.settings.content_editable || document.activeElement === self.getBody()) {\n\t\t\t\t\tself.selection.normalize();\n\t\t\t\t}*/\n\t\t\t}\n\n\t\t\treturn args.content;\n\t\t},\n\n\t\t/**\n\t\t * Gets the content from the editor instance, this will cleanup the content before it gets returned using\n\t\t * the different cleanup rules options.\n\t\t *\n\t\t * @method getContent\n\t\t * @param {Object} args Optional content object, this gets passed around through the whole get process.\n\t\t * @return {String} Cleaned content string, normally HTML contents.\n\t\t * @example\n\t\t * // Get the HTML contents of the currently active editor\n\t\t * console.debug(tinymce.activeEditor.getContent());\n\t\t *\n\t\t * // Get the raw contents of the currently active editor\n\t\t * tinymce.activeEditor.getContent({format: 'raw'});\n\t\t *\n\t\t * // Get content of a specific editor:\n\t\t * tinymce.get('content id').getContent()\n\t\t */\n\t\tgetContent: function(args) {\n\t\t\tvar self = this, content, body = self.getBody();\n\n\t\t\t// Setup args object\n\t\t\targs = args || {};\n\t\t\targs.format = args.format || 'html';\n\t\t\targs.get = true;\n\t\t\targs.getInner = true;\n\n\t\t\t// Do preprocessing\n\t\t\tif (!args.no_events) {\n\t\t\t\tself.fire('BeforeGetContent', args);\n\t\t\t}\n\n\t\t\t// Get raw contents or by default the cleaned contents\n\t\t\tif (args.format == 'raw') {\n\t\t\t\tcontent = Tools.trim(self.serializer.getTrimmedContent());\n\t\t\t} else if (args.format == 'text') {\n\t\t\t\tcontent = body.innerText || body.textContent;\n\t\t\t} else {\n\t\t\t\tcontent = self.serializer.serialize(body, args);\n\t\t\t}\n\n\t\t\t// Trim whitespace in beginning/end of HTML\n\t\t\tif (args.format != 'text') {\n\t\t\t\targs.content = trim(content);\n\t\t\t} else {\n\t\t\t\targs.content = content;\n\t\t\t}\n\n\t\t\t// Do post processing\n\t\t\tif (!args.no_events) {\n\t\t\t\tself.fire('GetContent', args);\n\t\t\t}\n\n\t\t\treturn args.content;\n\t\t},\n\n\t\t/**\n\t\t * Inserts content at caret position.\n\t\t *\n\t\t * @method insertContent\n\t\t * @param {String} content Content to insert.\n\t\t * @param {Object} args Optional args to pass to insert call.\n\t\t */\n\t\tinsertContent: function(content, args) {\n\t\t\tif (args) {\n\t\t\t\tcontent = extend({content: content}, args);\n\t\t\t}\n\n\t\t\tthis.execCommand('mceInsertContent', false, content);\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the editor is dirty or not. It will get dirty if the user has made modifications to the contents.\n\t\t *\n\t\t * The dirty state is automatically set to true if you do modifications to the content in other\n\t\t * words when new undo levels is created or if you undo/redo to update the contents of the editor. It will also be set\n\t\t * to false if you call editor.save().\n\t\t *\n\t\t * @method isDirty\n\t\t * @return {Boolean} True/false if the editor is dirty or not. It will get dirty if the user has made modifications to the contents.\n\t\t * @example\n\t\t * if (tinymce.activeEditor.isDirty())\n\t\t *     alert(\"You must save your contents.\");\n\t\t */\n\t\tisDirty: function() {\n\t\t\treturn !this.isNotDirty;\n\t\t},\n\n\t\t/**\n\t\t * Explicitly sets the dirty state. This will fire the dirty event if the editor dirty state is changed from false to true\n\t\t * by invoking this method.\n\t\t *\n\t\t * @method setDirty\n\t\t * @param {Boolean} state True/false if the editor is considered dirty.\n\t\t * @example\n\t\t * function ajaxSave() {\n\t\t *     var editor = tinymce.get('elm1');\n\t\t *\n\t\t *     // Save contents using some XHR call\n\t\t *     alert(editor.getContent());\n\t\t *\n\t\t *     editor.setDirty(false); // Force not dirty state\n\t\t * }\n\t\t */\n\t\tsetDirty: function(state) {\n\t\t\tvar oldState = !this.isNotDirty;\n\n\t\t\tthis.isNotDirty = !state;\n\n\t\t\tif (state && state != oldState) {\n\t\t\t\tthis.fire('dirty');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Sets the editor mode. Mode can be for example \"design\", \"code\" or \"readonly\".\n\t\t *\n\t\t * @method setMode\n\t\t * @param {String} mode Mode to set the editor in.\n\t\t */\n\t\tsetMode: function(mode) {\n\t\t\tMode.setMode(this, mode);\n\t\t},\n\n\t\t/**\n\t\t * Returns the editors container element. The container element wrappes in\n\t\t * all the elements added to the page for the editor. Such as UI, iframe etc.\n\t\t *\n\t\t * @method getContainer\n\t\t * @return {Element} HTML DOM element for the editor container.\n\t\t */\n\t\tgetContainer: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (!self.container) {\n\t\t\t\tself.container = DOM.get(self.editorContainer || self.id + '_parent');\n\t\t\t}\n\n\t\t\treturn self.container;\n\t\t},\n\n\t\t/**\n\t\t * Returns the editors content area container element. The this element is the one who\n\t\t * holds the iframe or the editable element.\n\t\t *\n\t\t * @method getContentAreaContainer\n\t\t * @return {Element} HTML DOM element for the editor area container.\n\t\t */\n\t\tgetContentAreaContainer: function() {\n\t\t\treturn this.contentAreaContainer;\n\t\t},\n\n\t\t/**\n\t\t * Returns the target element/textarea that got replaced with a TinyMCE editor instance.\n\t\t *\n\t\t * @method getElement\n\t\t * @return {Element} HTML DOM element for the replaced element.\n\t\t */\n\t\tgetElement: function() {\n\t\t\tif (!this.targetElm) {\n\t\t\t\tthis.targetElm = DOM.get(this.id);\n\t\t\t}\n\n\t\t\treturn this.targetElm;\n\t\t},\n\n\t\t/**\n\t\t * Returns the iframes window object.\n\t\t *\n\t\t * @method getWin\n\t\t * @return {Window} Iframe DOM window object.\n\t\t */\n\t\tgetWin: function() {\n\t\t\tvar self = this, elm;\n\n\t\t\tif (!self.contentWindow) {\n\t\t\t\telm = self.iframeElement;\n\n\t\t\t\tif (elm) {\n\t\t\t\t\tself.contentWindow = elm.contentWindow;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self.contentWindow;\n\t\t},\n\n\t\t/**\n\t\t * Returns the iframes document object.\n\t\t *\n\t\t * @method getDoc\n\t\t * @return {Document} Iframe DOM document object.\n\t\t */\n\t\tgetDoc: function() {\n\t\t\tvar self = this, win;\n\n\t\t\tif (!self.contentDocument) {\n\t\t\t\twin = self.getWin();\n\n\t\t\t\tif (win) {\n\t\t\t\t\tself.contentDocument = win.document;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self.contentDocument;\n\t\t},\n\n\t\t/**\n\t\t * Returns the root element of the editable area.\n\t\t * For a non-inline iframe-based editor, returns the iframe's body element.\n\t\t *\n\t\t * @method getBody\n\t\t * @return {Element} The root element of the editable area.\n\t\t */\n\t\tgetBody: function() {\n\t\t\tvar doc = this.getDoc();\n\t\t\treturn this.bodyElement || (doc ? doc.body : null);\n\t\t},\n\n\t\t/**\n\t\t * URL converter function this gets executed each time a user adds an img, a or\n\t\t * any other element that has a URL in it. This will be called both by the DOM and HTML\n\t\t * manipulation functions.\n\t\t *\n\t\t * @method convertURL\n\t\t * @param {string} url URL to convert.\n\t\t * @param {string} name Attribute name src, href etc.\n\t\t * @param {string/HTMLElement} elm Tag name or HTML DOM element depending on HTML or DOM insert.\n\t\t * @return {string} Converted URL string.\n\t\t */\n\t\tconvertURL: function(url, name, elm) {\n\t\t\tvar self = this, settings = self.settings;\n\n\t\t\t// Use callback instead\n\t\t\tif (settings.urlconverter_callback) {\n\t\t\t\treturn self.execCallback('urlconverter_callback', url, elm, true, name);\n\t\t\t}\n\n\t\t\t// Don't convert link href since thats the CSS files that gets loaded into the editor also skip local file URLs\n\t\t\tif (!settings.convert_urls || (elm && elm.nodeName == 'LINK') || url.indexOf('file:') === 0 || url.length === 0) {\n\t\t\t\treturn url;\n\t\t\t}\n\n\t\t\t// Convert to relative\n\t\t\tif (settings.relative_urls) {\n\t\t\t\treturn self.documentBaseURI.toRelative(url);\n\t\t\t}\n\n\t\t\t// Convert to absolute\n\t\t\turl = self.documentBaseURI.toAbsolute(url, settings.remove_script_host);\n\n\t\t\treturn url;\n\t\t},\n\n\t\t/**\n\t\t * Adds visual aid for tables, anchors etc so they can be more easily edited inside the editor.\n\t\t *\n\t\t * @method addVisual\n\t\t * @param {Element} elm Optional root element to loop though to find tables etc that needs the visual aid.\n\t\t */\n\t\taddVisual: function(elm) {\n\t\t\tvar self = this, settings = self.settings, dom = self.dom, cls;\n\n\t\t\telm = elm || self.getBody();\n\n\t\t\tif (self.hasVisual === undefined) {\n\t\t\t\tself.hasVisual = settings.visual;\n\t\t\t}\n\n\t\t\teach(dom.select('table,a', elm), function(elm) {\n\t\t\t\tvar value;\n\n\t\t\t\tswitch (elm.nodeName) {\n\t\t\t\t\tcase 'TABLE':\n\t\t\t\t\t\tcls = settings.visual_table_class || 'mce-item-table';\n\t\t\t\t\t\tvalue = dom.getAttrib(elm, 'border');\n\n\t\t\t\t\t\tif ((!value || value == '0') && self.hasVisual) {\n\t\t\t\t\t\t\tdom.addClass(elm, cls);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdom.removeClass(elm, cls);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tcase 'A':\n\t\t\t\t\t\tif (!dom.getAttrib(elm, 'href', false)) {\n\t\t\t\t\t\t\tvalue = dom.getAttrib(elm, 'name') || elm.id;\n\t\t\t\t\t\t\tcls = settings.visual_anchor_class || 'mce-item-anchor';\n\n\t\t\t\t\t\t\tif (value && self.hasVisual) {\n\t\t\t\t\t\t\t\tdom.addClass(elm, cls);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdom.removeClass(elm, cls);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.fire('VisualAid', {element: elm, hasVisual: self.hasVisual});\n\t\t},\n\n\t\t/**\n\t\t * Removes the editor from the dom and tinymce collection.\n\t\t *\n\t\t * @method remove\n\t\t */\n\t\tremove: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (!self.removed) {\n\t\t\t\tself.save();\n\t\t\t\tself.removed = 1;\n\t\t\t\tself.unbindAllNativeEvents();\n\n\t\t\t\t// Remove any hidden input\n\t\t\t\tif (self.hasHiddenInput) {\n\t\t\t\t\tDOM.remove(self.getElement().nextSibling);\n\t\t\t\t}\n\n\t\t\t\tif (!self.inline) {\n\t\t\t\t\t// IE 9 has a bug where the selection stops working if you place the\n\t\t\t\t\t// caret inside the editor then remove the iframe\n\t\t\t\t\tif (ie && ie < 10) {\n\t\t\t\t\t\tself.getDoc().execCommand('SelectAll', false, null);\n\t\t\t\t\t}\n\n\t\t\t\t\tDOM.setStyle(self.id, 'display', self.orgDisplay);\n\t\t\t\t\tself.getBody().onload = null; // Prevent #6816\n\t\t\t\t}\n\n\t\t\t\tself.fire('remove');\n\n\t\t\t\tself.editorManager.remove(self);\n\t\t\t\tDOM.remove(self.getContainer());\n\t\t\t\tself._selectionOverrides.destroy();\n\t\t\t\tself.editorUpload.destroy();\n\t\t\t\tself.destroy();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Destroys the editor instance by removing all events, element references or other resources\n\t\t * that could leak memory. This method will be called automatically when the page is unloaded\n\t\t * but you can also call it directly if you know what you are doing.\n\t\t *\n\t\t * @method destroy\n\t\t * @param {Boolean} automatic Optional state if the destroy is an automatic destroy or user called one.\n\t\t */\n\t\tdestroy: function(automatic) {\n\t\t\tvar self = this, form;\n\n\t\t\t// One time is enough\n\t\t\tif (self.destroyed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// If user manually calls destroy and not remove\n\t\t\t// Users seems to have logic that calls destroy instead of remove\n\t\t\tif (!automatic && !self.removed) {\n\t\t\t\tself.remove();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!automatic) {\n\t\t\t\tself.editorManager.off('beforeunload', self._beforeUnload);\n\n\t\t\t\t// Manual destroy\n\t\t\t\tif (self.theme && self.theme.destroy) {\n\t\t\t\t\tself.theme.destroy();\n\t\t\t\t}\n\n\t\t\t\t// Destroy controls, selection and dom\n\t\t\t\tself.selection.destroy();\n\t\t\t\tself.dom.destroy();\n\t\t\t}\n\n\t\t\tform = self.formElement;\n\t\t\tif (form) {\n\t\t\t\tif (form._mceOldSubmit) {\n\t\t\t\t\tform.submit = form._mceOldSubmit;\n\t\t\t\t\tform._mceOldSubmit = null;\n\t\t\t\t}\n\n\t\t\t\tDOM.unbind(form, 'submit reset', self.formEventDelegate);\n\t\t\t}\n\n\t\t\tself.contentAreaContainer = self.formElement = self.container = self.editorContainer = null;\n\t\t\tself.bodyElement = self.contentDocument = self.contentWindow = null;\n\t\t\tself.iframeElement = self.targetElm = null;\n\n\t\t\tif (self.selection) {\n\t\t\t\tself.selection = self.selection.win = self.selection.dom = self.selection.dom.doc = null;\n\t\t\t}\n\n\t\t\tself.destroyed = 1;\n\t\t},\n\n\t\t/**\n\t\t * Uploads all data uri/blob uri images in the editor contents to server.\n\t\t *\n\t\t * @method uploadImages\n\t\t * @param {function} callback Optional callback with images and status for each image.\n\t\t * @return {tinymce.util.Promise} Promise instance.\n\t\t */\n\t\tuploadImages: function(callback) {\n\t\t\treturn this.editorUpload.uploadImages(callback);\n\t\t},\n\n\t\t// Internal functions\n\n\t\t_scanForImages: function() {\n\t\t\treturn this.editorUpload.scanForImages();\n\t\t}\n\t};\n\n\textend(Editor.prototype, EditorObservable);\n\n\treturn Editor;\n});\n\n// Included from: js/tinymce/classes/util/I18n.js\n\n/**\n * I18n.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * I18n class that handles translation of TinyMCE UI.\n * Uses po style with csharp style parameters.\n *\n * @class tinymce.util.I18n\n */\ndefine(\"tinymce/util/I18n\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\t\"use strict\";\n\n\tvar data = {}, code = \"en\";\n\n\treturn {\n\t\t/**\n\t\t * Sets the current language code.\n\t\t *\n\t\t * @method setCode\n\t\t * @param {String} newCode Current language code.\n\t\t */\n\t\tsetCode: function(newCode) {\n\t\t\tif (newCode) {\n\t\t\t\tcode = newCode;\n\t\t\t\tthis.rtl = this.data[newCode] ? this.data[newCode]._dir === 'rtl' : false;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the current language code.\n\t\t *\n\t\t * @method getCode\n\t\t * @return {String} Current language code.\n\t\t */\n\t\tgetCode: function() {\n\t\t\treturn code;\n\t\t},\n\n\t\t/**\n\t\t * Property gets set to true if a RTL language pack was loaded.\n\t\t *\n\t\t * @property rtl\n\t\t * @type Boolean\n\t\t */\n\t\trtl: false,\n\n\t\t/**\n\t\t * Adds translations for a specific language code.\n\t\t *\n\t\t * @method add\n\t\t * @param {String} code Language code like sv_SE.\n\t\t * @param {Array} items Name/value array with English en_US to sv_SE.\n\t\t */\n\t\tadd: function(code, items) {\n\t\t\tvar langData = data[code];\n\n\t\t\tif (!langData) {\n\t\t\t\tdata[code] = langData = {};\n\t\t\t}\n\n\t\t\tfor (var name in items) {\n\t\t\t\tlangData[name] = items[name];\n\t\t\t}\n\n\t\t\tthis.setCode(code);\n\t\t},\n\n\t\t/**\n\t\t * Translates the specified text.\n\t\t *\n\t\t * It has a few formats:\n\t\t * I18n.translate(\"Text\");\n\t\t * I18n.translate([\"Text {0}/{1}\", 0, 1]);\n\t\t * I18n.translate({raw: \"Raw string\"});\n\t\t *\n\t\t * @method translate\n\t\t * @param {String/Object/Array} text Text to translate.\n\t\t * @return {String} String that got translated.\n\t\t */\n\t\ttranslate: function(text) {\n\t\t\tvar langData = data[code] || {};\n\n\t\t\t/**\n\t\t\t * number - string\n\t\t\t * null, undefined and empty string - empty string\n\t\t\t * array - comma-delimited string\n\t\t\t * object - in [object Object]\n\t\t\t * function - in [object Function]\n\t\t\t *\n\t\t\t * @param obj\n\t\t\t * @returns {string}\n\t\t\t */\n\t\t\tfunction toString(obj) {\n\t\t\t\tif (Tools.is(obj, 'function')) {\n\t\t\t\t\treturn Object.prototype.toString.call(obj);\n\t\t\t\t}\n\t\t\t\treturn !isEmpty(obj) ? '' + obj : '';\n\t\t\t}\n\n\t\t\tfunction isEmpty(text) {\n\t\t\t\treturn text === '' || text === null || Tools.is(text, 'undefined');\n\t\t\t}\n\n\t\t\tfunction getLangData(text) {\n\t\t\t\t// make sure we work on a string and return a string\n\t\t\t\ttext = toString(text);\n\t\t\t\treturn Tools.hasOwn(langData, text) ? toString(langData[text]) : text;\n\t\t\t}\n\n\n\t\t\tif (isEmpty(text)) {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tif (Tools.is(text, 'object') && Tools.hasOwn(text, 'raw')) {\n\t\t\t\treturn toString(text.raw);\n\t\t\t}\n\n\t\t\tif (Tools.is(text, 'array')) {\n\t\t\t\tvar values = text.slice(1);\n\t\t\t\ttext = getLangData(text[0]).replace(/\\{([0-9]+)\\}/g, function($1, $2) {\n\t\t\t\t\treturn Tools.hasOwn(values, $2) ? toString(values[$2]) : $1;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn getLangData(text).replace(/{context:\\w+}$/, '');\n\t\t},\n\n\t\tdata: data\n\t};\n});\n\n// Included from: js/tinymce/classes/FocusManager.js\n\n/**\n * FocusManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class manages the focus/blur state of the editor. This class is needed since some\n * browsers fire false focus/blur states when the selection is moved to a UI dialog or similar.\n *\n * This class will fire two events focus and blur on the editor instances that got affected.\n * It will also handle the restore of selection when the focus is lost and returned.\n *\n * @class tinymce.FocusManager\n */\ndefine(\"tinymce/FocusManager\", [\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/Env\"\n], function(DOMUtils, Delay, Env) {\n\tvar selectionChangeHandler, documentFocusInHandler, documentMouseUpHandler, DOM = DOMUtils.DOM;\n\n\tvar isUIElement = function (editor, elm) {\n\t\tvar customSelector = editor ? editor.settings.custom_ui_selector : '';\n\t\tvar parent = DOM.getParent(elm, function (elm) {\n\t\t\treturn (\n\t\t\t\tFocusManager.isEditorUIElement(elm) ||\n\t\t\t\t(customSelector ? editor.dom.is(elm, customSelector) : false)\n\t\t\t);\n\t\t});\n\t\treturn parent !== null;\n\t};\n\n\t/**\n\t * Constructs a new focus manager instance.\n\t *\n\t * @constructor FocusManager\n\t * @param {tinymce.EditorManager} editorManager Editor manager instance to handle focus for.\n\t */\n\tfunction FocusManager(editorManager) {\n\t\tfunction getActiveElement() {\n\t\t\ttry {\n\t\t\t\treturn document.activeElement;\n\t\t\t} catch (ex) {\n\t\t\t\t// IE sometimes fails to get the activeElement when resizing table\n\t\t\t\t// TODO: Investigate this\n\t\t\t\treturn document.body;\n\t\t\t}\n\t\t}\n\n\t\t// We can't store a real range on IE 11 since it gets mutated so we need to use a bookmark object\n\t\t// TODO: Move this to a separate range utils class since it's it's logic is present in Selection as well.\n\t\tfunction createBookmark(dom, rng) {\n\t\t\tif (rng && rng.startContainer) {\n\t\t\t\t// Verify that the range is within the root of the editor\n\t\t\t\tif (!dom.isChildOf(rng.startContainer, dom.getRoot()) || !dom.isChildOf(rng.endContainer, dom.getRoot())) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tstartContainer: rng.startContainer,\n\t\t\t\t\tstartOffset: rng.startOffset,\n\t\t\t\t\tendContainer: rng.endContainer,\n\t\t\t\t\tendOffset: rng.endOffset\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn rng;\n\t\t}\n\n\t\tfunction bookmarkToRng(editor, bookmark) {\n\t\t\tvar rng;\n\n\t\t\tif (bookmark.startContainer) {\n\t\t\t\trng = editor.getDoc().createRange();\n\t\t\t\trng.setStart(bookmark.startContainer, bookmark.startOffset);\n\t\t\t\trng.setEnd(bookmark.endContainer, bookmark.endOffset);\n\t\t\t} else {\n\t\t\t\trng = bookmark;\n\t\t\t}\n\n\t\t\treturn rng;\n\t\t}\n\n\t\tfunction registerEvents(e) {\n\t\t\tvar editor = e.editor;\n\n\t\t\teditor.on('init', function() {\n\t\t\t\t// Gecko/WebKit has ghost selections in iframes and IE only has one selection per browser tab\n\t\t\t\tif (editor.inline || Env.ie) {\n\t\t\t\t\t// Use the onbeforedeactivate event when available since it works better see #7023\n\t\t\t\t\tif (\"onbeforedeactivate\" in document && Env.ie < 9) {\n\t\t\t\t\t\teditor.dom.bind(editor.getBody(), 'beforedeactivate', function(e) {\n\t\t\t\t\t\t\tif (e.target != editor.getBody()) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\teditor.lastRng = editor.selection.getRng();\n\t\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\t\t// IE throws \"Unexcpected call to method or property access\" some times so lets ignore it\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// On other browsers take snapshot on nodechange in inline mode since they have Ghost selections for iframes\n\t\t\t\t\t\teditor.on('nodechange mouseup keyup', function(e) {\n\t\t\t\t\t\t\tvar node = getActiveElement();\n\n\t\t\t\t\t\t\t// Only act on manual nodechanges\n\t\t\t\t\t\t\tif (e.type == 'nodechange' && e.selectionChange) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// IE 11 reports active element as iframe not body of iframe\n\t\t\t\t\t\t\tif (node && node.id == editor.id + '_ifr') {\n\t\t\t\t\t\t\t\tnode = editor.getBody();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (editor.dom.isChildOf(node, editor.getBody())) {\n\t\t\t\t\t\t\t\teditor.lastRng = editor.selection.getRng();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// Handles the issue with WebKit not retaining selection within inline document\n\t\t\t\t\t// If the user releases the mouse out side the body since a mouse up event wont occur on the body\n\t\t\t\t\tif (Env.webkit && !selectionChangeHandler) {\n\t\t\t\t\t\tselectionChangeHandler = function() {\n\t\t\t\t\t\t\tvar activeEditor = editorManager.activeEditor;\n\n\t\t\t\t\t\t\tif (activeEditor && activeEditor.selection) {\n\t\t\t\t\t\t\t\tvar rng = activeEditor.selection.getRng();\n\n\t\t\t\t\t\t\t\t// Store when it's non collapsed\n\t\t\t\t\t\t\t\tif (rng && !rng.collapsed) {\n\t\t\t\t\t\t\t\t\teditor.lastRng = rng;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tDOM.bind(document, 'selectionchange', selectionChangeHandler);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('setcontent', function() {\n\t\t\t\teditor.lastRng = null;\n\t\t\t});\n\n\t\t\t// Remove last selection bookmark on mousedown see #6305\n\t\t\teditor.on('mousedown', function() {\n\t\t\t\teditor.selection.lastFocusBookmark = null;\n\t\t\t});\n\n\t\t\teditor.on('focusin', function() {\n\t\t\t\tvar focusedEditor = editorManager.focusedEditor, lastRng;\n\n\t\t\t\tif (editor.selection.lastFocusBookmark) {\n\t\t\t\t\tlastRng = bookmarkToRng(editor, editor.selection.lastFocusBookmark);\n\t\t\t\t\teditor.selection.lastFocusBookmark = null;\n\t\t\t\t\teditor.selection.setRng(lastRng);\n\t\t\t\t}\n\n\t\t\t\tif (focusedEditor != editor) {\n\t\t\t\t\tif (focusedEditor) {\n\t\t\t\t\t\tfocusedEditor.fire('blur', {focusedEditor: editor});\n\t\t\t\t\t}\n\n\t\t\t\t\teditorManager.setActive(editor);\n\t\t\t\t\teditorManager.focusedEditor = editor;\n\t\t\t\t\teditor.fire('focus', {blurredEditor: focusedEditor});\n\t\t\t\t\teditor.focus(true);\n\t\t\t\t}\n\n\t\t\t\teditor.lastRng = null;\n\t\t\t});\n\n\t\t\teditor.on('focusout', function() {\n\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\tvar focusedEditor = editorManager.focusedEditor;\n\n\t\t\t\t\t// Still the same editor the blur was outside any editor UI\n\t\t\t\t\tif (!isUIElement(editor, getActiveElement()) && focusedEditor == editor) {\n\t\t\t\t\t\teditor.fire('blur', {focusedEditor: null});\n\t\t\t\t\t\teditorManager.focusedEditor = null;\n\n\t\t\t\t\t\t// Make sure selection is valid could be invalid if the editor is blured and removed before the timeout occurs\n\t\t\t\t\t\tif (editor.selection) {\n\t\t\t\t\t\t\teditor.selection.lastFocusBookmark = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// Check if focus is moved to an element outside the active editor by checking if the target node\n\t\t\t// isn't within the body of the activeEditor nor a UI element such as a dialog child control\n\t\t\tif (!documentFocusInHandler) {\n\t\t\t\tdocumentFocusInHandler = function(e) {\n\t\t\t\t\tvar activeEditor = editorManager.activeEditor, target;\n\n\t\t\t\t\ttarget = e.target;\n\n\t\t\t\t\tif (activeEditor && target.ownerDocument == document) {\n\t\t\t\t\t\t// Check to make sure we have a valid selection don't update the bookmark if it's\n\t\t\t\t\t\t// a focusin to the body of the editor see #7025\n\t\t\t\t\t\tif (activeEditor.selection && target != activeEditor.getBody()) {\n\t\t\t\t\t\t\tactiveEditor.selection.lastFocusBookmark = createBookmark(activeEditor.dom, activeEditor.lastRng);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Fire a blur event if the element isn't a UI element\n\t\t\t\t\t\tif (target != document.body && !isUIElement(activeEditor, target) && editorManager.focusedEditor == activeEditor) {\n\t\t\t\t\t\t\tactiveEditor.fire('blur', {focusedEditor: null});\n\t\t\t\t\t\t\teditorManager.focusedEditor = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tDOM.bind(document, 'focusin', documentFocusInHandler);\n\t\t\t}\n\n\t\t\t// Handle edge case when user starts the selection inside the editor and releases\n\t\t\t// the mouse outside the editor producing a new selection. This weird workaround is needed since\n\t\t\t// Gecko doesn't have the \"selectionchange\" event we need to do this. Fixes: #6843\n\t\t\tif (editor.inline && !documentMouseUpHandler) {\n\t\t\t\tdocumentMouseUpHandler = function(e) {\n\t\t\t\t\tvar activeEditor = editorManager.activeEditor, dom = activeEditor.dom;\n\n\t\t\t\t\tif (activeEditor.inline && dom && !dom.isChildOf(e.target, activeEditor.getBody())) {\n\t\t\t\t\t\tvar rng = activeEditor.selection.getRng();\n\n\t\t\t\t\t\tif (!rng.collapsed) {\n\t\t\t\t\t\t\tactiveEditor.lastRng = rng;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tDOM.bind(document, 'mouseup', documentMouseUpHandler);\n\t\t\t}\n\t\t}\n\n\t\tfunction unregisterDocumentEvents(e) {\n\t\t\tif (editorManager.focusedEditor == e.editor) {\n\t\t\t\teditorManager.focusedEditor = null;\n\t\t\t}\n\n\t\t\tif (!editorManager.activeEditor) {\n\t\t\t\tDOM.unbind(document, 'selectionchange', selectionChangeHandler);\n\t\t\t\tDOM.unbind(document, 'focusin', documentFocusInHandler);\n\t\t\t\tDOM.unbind(document, 'mouseup', documentMouseUpHandler);\n\t\t\t\tselectionChangeHandler = documentFocusInHandler = documentMouseUpHandler = null;\n\t\t\t}\n\t\t}\n\n\t\teditorManager.on('AddEditor', registerEvents);\n\t\teditorManager.on('RemoveEditor', unregisterDocumentEvents);\n\t}\n\n\t/**\n\t * Returns true if the specified element is part of the UI for example an button or text input.\n\t *\n\t * @method isEditorUIElement\n\t * @param  {Element} elm Element to check if it's part of the UI or not.\n\t * @return {Boolean} True/false state if the element is part of the UI or not.\n\t */\n\tFocusManager.isEditorUIElement = function(elm) {\n\t\t// Needs to be converted to string since svg can have focus: #6776\n\t\treturn elm.className.toString().indexOf('mce-') !== -1;\n\t};\n\n\tFocusManager._isUIElement = isUIElement;\n\n\treturn FocusManager;\n});\n\n// Included from: js/tinymce/classes/EditorManager.js\n\n/**\n * EditorManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class used as a factory for manager for tinymce.Editor instances.\n *\n * @example\n * tinymce.EditorManager.init({});\n *\n * @class tinymce.EditorManager\n * @mixes tinymce.util.Observable\n * @static\n */\ndefine(\"tinymce/EditorManager\", [\n\t\"tinymce/Editor\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/util/URI\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Promise\",\n\t\"tinymce/util/Observable\",\n\t\"tinymce/util/I18n\",\n\t\"tinymce/FocusManager\",\n\t\"tinymce/AddOnManager\"\n], function(Editor, $, DOMUtils, URI, Env, Tools, Promise, Observable, I18n, FocusManager, AddOnManager) {\n\tvar DOM = DOMUtils.DOM;\n\tvar explode = Tools.explode, each = Tools.each, extend = Tools.extend;\n\tvar instanceCounter = 0, beforeUnloadDelegate, EditorManager, boundGlobalEvents = false;\n\n\tfunction globalEventDelegate(e) {\n\t\teach(EditorManager.editors, function(editor) {\n\t\t\tif (e.type === 'scroll') {\n\t\t\t\teditor.fire('ScrollWindow', e);\n\t\t\t} else {\n\t\t\t\teditor.fire('ResizeWindow', e);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction toggleGlobalEvents(editors, state) {\n\t\tif (state !== boundGlobalEvents) {\n\t\t\tif (state) {\n\t\t\t\t$(window).on('resize scroll', globalEventDelegate);\n\t\t\t} else {\n\t\t\t\t$(window).off('resize scroll', globalEventDelegate);\n\t\t\t}\n\n\t\t\tboundGlobalEvents = state;\n\t\t}\n\t}\n\n\tfunction removeEditorFromList(editor) {\n\t\tvar editors = EditorManager.editors, removedFromList;\n\n\t\tdelete editors[editor.id];\n\n\t\tfor (var i = 0; i < editors.length; i++) {\n\t\t\tif (editors[i] == editor) {\n\t\t\t\teditors.splice(i, 1);\n\t\t\t\tremovedFromList = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// Select another editor since the active one was removed\n\t\tif (EditorManager.activeEditor == editor) {\n\t\t\tEditorManager.activeEditor = editors[0];\n\t\t}\n\n\t\t// Clear focusedEditor if necessary, so that we don't try to blur the destroyed editor\n\t\tif (EditorManager.focusedEditor == editor) {\n\t\t\tEditorManager.focusedEditor = null;\n\t\t}\n\n\t\treturn removedFromList;\n\t}\n\n\tfunction purgeDestroyedEditor(editor) {\n\t\t// User has manually destroyed the editor lets clean up the mess\n\t\tif (editor && editor.initialized && !(editor.getContainer() || editor.getBody()).parentNode) {\n\t\t\tremoveEditorFromList(editor);\n\t\t\teditor.unbindAllNativeEvents();\n\t\t\teditor.destroy(true);\n\t\t\teditor.removed = true;\n\t\t\teditor = null;\n\t\t}\n\n\t\treturn editor;\n\t}\n\n\tEditorManager = {\n\t\t/**\n\t\t * Dom query instance.\n\t\t *\n\t\t * @property $\n\t\t * @type tinymce.dom.DomQuery\n\t\t */\n\t\t$: $,\n\n\t\t/**\n\t\t * Major version of TinyMCE build.\n\t\t *\n\t\t * @property majorVersion\n\t\t * @type String\n\t\t */\n\t\tmajorVersion: '4',\n\n\t\t/**\n\t\t * Minor version of TinyMCE build.\n\t\t *\n\t\t * @property minorVersion\n\t\t * @type String\n\t\t */\n\t\tminorVersion: '5.6',\n\n\t\t/**\n\t\t * Release date of TinyMCE build.\n\t\t *\n\t\t * @property releaseDate\n\t\t * @type String\n\t\t */\n\t\treleaseDate: '2017-03-30',\n\n\t\t/**\n\t\t * Collection of editor instances.\n\t\t *\n\t\t * @property editors\n\t\t * @type Object\n\t\t * @example\n\t\t * for (edId in tinymce.editors)\n\t\t *     tinymce.editors[edId].save();\n\t\t */\n\t\teditors: [],\n\n\t\t/**\n\t\t * Collection of language pack data.\n\t\t *\n\t\t * @property i18n\n\t\t * @type Object\n\t\t */\n\t\ti18n: I18n,\n\n\t\t/**\n\t\t * Currently active editor instance.\n\t\t *\n\t\t * @property activeEditor\n\t\t * @type tinymce.Editor\n\t\t * @example\n\t\t * tinyMCE.activeEditor.selection.getContent();\n\t\t * tinymce.EditorManager.activeEditor.selection.getContent();\n\t\t */\n\t\tactiveEditor: null,\n\n\t\tsetup: function() {\n\t\t\tvar self = this, baseURL, documentBaseURL, suffix = \"\", preInit, src;\n\n\t\t\t// Get base URL for the current document\n\t\t\tdocumentBaseURL = URI.getDocumentBaseUrl(document.location);\n\n\t\t\t// Check if the URL is a document based format like: http://site/dir/file and file:///\n\t\t\t// leave other formats like applewebdata://... intact\n\t\t\tif (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(documentBaseURL)) {\n\t\t\t\tdocumentBaseURL = documentBaseURL.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n\n\t\t\t\tif (!/[\\/\\\\]$/.test(documentBaseURL)) {\n\t\t\t\t\tdocumentBaseURL += '/';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If tinymce is defined and has a base use that or use the old tinyMCEPreInit\n\t\t\tpreInit = window.tinymce || window.tinyMCEPreInit;\n\t\t\tif (preInit) {\n\t\t\t\tbaseURL = preInit.base || preInit.baseURL;\n\t\t\t\tsuffix = preInit.suffix;\n\t\t\t} else {\n\t\t\t\t// Get base where the tinymce script is located\n\t\t\t\tvar scripts = document.getElementsByTagName('script');\n\t\t\t\tfor (var i = 0; i < scripts.length; i++) {\n\t\t\t\t\tsrc = scripts[i].src;\n\n\t\t\t\t\t// Script types supported:\n\t\t\t\t\t// tinymce.js tinymce.min.js tinymce.dev.js\n\t\t\t\t\t// tinymce.jquery.js tinymce.jquery.min.js tinymce.jquery.dev.js\n\t\t\t\t\t// tinymce.full.js tinymce.full.min.js tinymce.full.dev.js\n\t\t\t\t\tvar srcScript = src.substring(src.lastIndexOf('/'));\n\t\t\t\t\tif (/tinymce(\\.full|\\.jquery|)(\\.min|\\.dev|)\\.js/.test(src)) {\n\t\t\t\t\t\tif (srcScript.indexOf('.min') != -1) {\n\t\t\t\t\t\t\tsuffix = '.min';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbaseURL = src.substring(0, src.lastIndexOf('/'));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// We didn't find any baseURL by looking at the script elements\n\t\t\t\t// Try to use the document.currentScript as a fallback\n\t\t\t\tif (!baseURL && document.currentScript) {\n\t\t\t\t\tsrc = document.currentScript.src;\n\n\t\t\t\t\tif (src.indexOf('.min') != -1) {\n\t\t\t\t\t\tsuffix = '.min';\n\t\t\t\t\t}\n\n\t\t\t\t\tbaseURL = src.substring(0, src.lastIndexOf('/'));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Base URL where the root directory if TinyMCE is located.\n\t\t\t *\n\t\t\t * @property baseURL\n\t\t\t * @type String\n\t\t\t */\n\t\t\tself.baseURL = new URI(documentBaseURL).toAbsolute(baseURL);\n\n\t\t\t/**\n\t\t\t * Document base URL where the current document is located.\n\t\t\t *\n\t\t\t * @property documentBaseURL\n\t\t\t * @type String\n\t\t\t */\n\t\t\tself.documentBaseURL = documentBaseURL;\n\n\t\t\t/**\n\t\t\t * Absolute baseURI for the installation path of TinyMCE.\n\t\t\t *\n\t\t\t * @property baseURI\n\t\t\t * @type tinymce.util.URI\n\t\t\t */\n\t\t\tself.baseURI = new URI(self.baseURL);\n\n\t\t\t/**\n\t\t\t * Current suffix to add to each plugin/theme that gets loaded for example \".min\".\n\t\t\t *\n\t\t\t * @property suffix\n\t\t\t * @type String\n\t\t\t */\n\t\t\tself.suffix = suffix;\n\n\t\t\tself.focusManager = new FocusManager(self);\n\t\t},\n\n\t\t/**\n\t\t * Overrides the default settings for editor instances.\n\t\t *\n\t\t * @method overrideDefaults\n\t\t * @param {Object} defaultSettings Defaults settings object.\n\t\t */\n\t\toverrideDefaults: function(defaultSettings) {\n\t\t\tvar baseUrl, suffix;\n\n\t\t\tbaseUrl = defaultSettings.base_url;\n\t\t\tif (baseUrl) {\n\t\t\t\tthis.baseURL = new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\\/+$/, ''));\n\t\t\t\tthis.baseURI = new URI(this.baseURL);\n\t\t\t}\n\n\t\t\tsuffix = defaultSettings.suffix;\n\t\t\tif (defaultSettings.suffix) {\n\t\t\t\tthis.suffix = suffix;\n\t\t\t}\n\n\t\t\tthis.defaultSettings = defaultSettings;\n\n\t\t\tvar pluginBaseUrls = defaultSettings.plugin_base_urls;\n\t\t\tfor (var name in pluginBaseUrls) {\n\t\t\t\tAddOnManager.PluginManager.urls[name] = pluginBaseUrls[name];\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Initializes a set of editors. This method will create editors based on various settings.\n\t\t *\n\t\t * @method init\n\t\t * @param {Object} settings Settings object to be passed to each editor instance.\n\t\t * @return {tinymce.util.Promise} Promise that gets resolved with an array of editors when all editor instances are initialized.\n\t\t * @example\n\t\t * // Initializes a editor using the longer method\n\t\t * tinymce.EditorManager.init({\n\t\t *    some_settings : 'some value'\n\t\t * });\n\t\t *\n\t\t * // Initializes a editor instance using the shorter version and with a promise\n\t\t * tinymce.init({\n\t\t *    some_settings : 'some value'\n\t\t * }).then(function(editors) {\n\t\t *    ...\n\t\t * });\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this, result, invalidInlineTargets;\n\n\t\t\tinvalidInlineTargets = Tools.makeMap(\n\t\t\t\t'area base basefont br col frame hr img input isindex link meta param embed source wbr track ' +\n\t\t\t\t'colgroup option tbody tfoot thead tr script noscript style textarea video audio iframe object menu',\n\t\t\t\t' '\n\t\t\t);\n\n\t\t\tfunction isInvalidInlineTarget(settings, elm) {\n\t\t\t\treturn settings.inline && elm.tagName.toLowerCase() in invalidInlineTargets;\n\t\t\t}\n\n\t\t\tfunction report(msg, elm) {\n\t\t\t\t// Log in a non test environment\n\t\t\t\tif (window.console && !window.test) {\n\t\t\t\t\twindow.console.log(msg, elm);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction createId(elm) {\n\t\t\t\tvar id = elm.id;\n\n\t\t\t\t// Use element id, or unique name or generate a unique id\n\t\t\t\tif (!id) {\n\t\t\t\t\tid = elm.name;\n\n\t\t\t\t\tif (id && !DOM.get(id)) {\n\t\t\t\t\t\tid = elm.name;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Generate unique name\n\t\t\t\t\t\tid = DOM.uniqueId();\n\t\t\t\t\t}\n\n\t\t\t\t\telm.setAttribute('id', id);\n\t\t\t\t}\n\n\t\t\t\treturn id;\n\t\t\t}\n\n\t\t\tfunction execCallback(name) {\n\t\t\t\tvar callback = settings[name];\n\n\t\t\t\tif (!callback) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\treturn callback.apply(self, Array.prototype.slice.call(arguments, 2));\n\t\t\t}\n\n\t\t\tfunction hasClass(elm, className) {\n\t\t\t\treturn className.constructor === RegExp ? className.test(elm.className) : DOM.hasClass(elm, className);\n\t\t\t}\n\n\t\t\tfunction findTargets(settings) {\n\t\t\t\tvar l, targets = [];\n\n\t\t\t\tif (settings.types) {\n\t\t\t\t\teach(settings.types, function(type) {\n\t\t\t\t\t\ttargets = targets.concat(DOM.select(type.selector));\n\t\t\t\t\t});\n\n\t\t\t\t\treturn targets;\n\t\t\t\t} else if (settings.selector) {\n\t\t\t\t\treturn DOM.select(settings.selector);\n\t\t\t\t} else if (settings.target) {\n\t\t\t\t\treturn [settings.target];\n\t\t\t\t}\n\n\t\t\t\t// Fallback to old setting\n\t\t\t\tswitch (settings.mode) {\n\t\t\t\t\tcase \"exact\":\n\t\t\t\t\t\tl = settings.elements || '';\n\n\t\t\t\t\t\tif (l.length > 0) {\n\t\t\t\t\t\t\teach(explode(l), function(id) {\n\t\t\t\t\t\t\t\tvar elm;\n\n\t\t\t\t\t\t\t\tif ((elm = DOM.get(id))) {\n\t\t\t\t\t\t\t\t\ttargets.push(elm);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\teach(document.forms, function(f) {\n\t\t\t\t\t\t\t\t\t\teach(f.elements, function(e) {\n\t\t\t\t\t\t\t\t\t\t\tif (e.name === id) {\n\t\t\t\t\t\t\t\t\t\t\t\tid = 'mce_editor_' + instanceCounter++;\n\t\t\t\t\t\t\t\t\t\t\t\tDOM.setAttrib(e, 'id', id);\n\t\t\t\t\t\t\t\t\t\t\t\ttargets.push(e);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"textareas\":\n\t\t\t\t\tcase \"specific_textareas\":\n\t\t\t\t\t\teach(DOM.select('textarea'), function(elm) {\n\t\t\t\t\t\t\tif (settings.editor_deselector && hasClass(elm, settings.editor_deselector)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!settings.editor_selector || hasClass(elm, settings.editor_selector)) {\n\t\t\t\t\t\t\t\ttargets.push(elm);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\treturn targets;\n\t\t\t}\n\n\t\t\tvar provideResults = function(editors) {\n\t\t\t\tresult = editors;\n\t\t\t};\n\n\t\t\tfunction initEditors() {\n\t\t\t\tvar initCount = 0, editors = [], targets;\n\n\t\t\t\tfunction createEditor(id, settings, targetElm) {\n\t\t\t\t\tvar editor = new Editor(id, settings, self);\n\n\t\t\t\t\teditors.push(editor);\n\n\t\t\t\t\teditor.on('init', function() {\n\t\t\t\t\t\tif (++initCount === targets.length) {\n\t\t\t\t\t\t\tprovideResults(editors);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\teditor.targetElm = editor.targetElm || targetElm;\n\t\t\t\t\teditor.render();\n\t\t\t\t}\n\n\t\t\t\tDOM.unbind(window, 'ready', initEditors);\n\t\t\t\texecCallback('onpageload');\n\n\t\t\t\ttargets = $.unique(findTargets(settings));\n\n\t\t\t\t// TODO: Deprecate this one\n\t\t\t\tif (settings.types) {\n\t\t\t\t\teach(settings.types, function(type) {\n\t\t\t\t\t\tTools.each(targets, function(elm) {\n\t\t\t\t\t\t\tif (DOM.is(elm, type.selector)) {\n\t\t\t\t\t\t\t\tcreateEditor(createId(elm), extend({}, settings, type), elm);\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tTools.each(targets, function(elm) {\n\t\t\t\t\tpurgeDestroyedEditor(self.get(elm.id));\n\t\t\t\t});\n\n\t\t\t\ttargets = Tools.grep(targets, function(elm) {\n\t\t\t\t\treturn !self.get(elm.id);\n\t\t\t\t});\n\n\t\t\t\teach(targets, function(elm) {\n\t\t\t\t\tif (isInvalidInlineTarget(settings, elm)) {\n\t\t\t\t\t\treport('Could not initialize inline editor on invalid inline target element', elm);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcreateEditor(createId(elm), settings, elm);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.settings = settings;\n\t\t\tDOM.bind(window, 'ready', initEditors);\n\n\t\t\treturn new Promise(function(resolve) {\n\t\t\t\tif (result) {\n\t\t\t\t\tresolve(result);\n\t\t\t\t} else {\n\t\t\t\t\tprovideResults = function(editors) {\n\t\t\t\t\t\tresolve(editors);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns a editor instance by id.\n\t\t *\n\t\t * @method get\n\t\t * @param {String/Number} id Editor instance id or index to return.\n\t\t * @return {tinymce.Editor} Editor instance to return.\n\t\t * @example\n\t\t * // Adds an onclick event to an editor by id (shorter version)\n\t\t * tinymce.get('mytextbox').on('click', function(e) {\n\t\t *    ed.windowManager.alert('Hello world!');\n\t\t * });\n\t\t *\n\t\t * // Adds an onclick event to an editor by id (longer version)\n\t\t * tinymce.EditorManager.get('mytextbox').on('click', function(e) {\n\t\t *    ed.windowManager.alert('Hello world!');\n\t\t * });\n\t\t */\n\t\tget: function(id) {\n\t\t\tif (!arguments.length) {\n\t\t\t\treturn this.editors;\n\t\t\t}\n\n\t\t\treturn id in this.editors ? this.editors[id] : null;\n\t\t},\n\n\t\t/**\n\t\t * Adds an editor instance to the editor collection. This will also set it as the active editor.\n\t\t *\n\t\t * @method add\n\t\t * @param {tinymce.Editor} editor Editor instance to add to the collection.\n\t\t * @return {tinymce.Editor} The same instance that got passed in.\n\t\t */\n\t\tadd: function(editor) {\n\t\t\tvar self = this, editors = self.editors;\n\n\t\t\t// Add named and index editor instance\n\t\t\teditors[editor.id] = editor;\n\t\t\teditors.push(editor);\n\n\t\t\ttoggleGlobalEvents(editors, true);\n\n\t\t\t// Doesn't call setActive method since we don't want\n\t\t\t// to fire a bunch of activate/deactivate calls while initializing\n\t\t\tself.activeEditor = editor;\n\n\t\t\tself.fire('AddEditor', {editor: editor});\n\n\t\t\tif (!beforeUnloadDelegate) {\n\t\t\t\tbeforeUnloadDelegate = function() {\n\t\t\t\t\tself.fire('BeforeUnload');\n\t\t\t\t};\n\n\t\t\t\tDOM.bind(window, 'beforeunload', beforeUnloadDelegate);\n\t\t\t}\n\n\t\t\treturn editor;\n\t\t},\n\n\t\t/**\n\t\t * Creates an editor instance and adds it to the EditorManager collection.\n\t\t *\n\t\t * @method createEditor\n\t\t * @param {String} id Instance id to use for editor.\n\t\t * @param {Object} settings Editor instance settings.\n\t\t * @return {tinymce.Editor} Editor instance that got created.\n\t\t */\n\t\tcreateEditor: function(id, settings) {\n\t\t\treturn this.add(new Editor(id, settings, this));\n\t\t},\n\n\t\t/**\n\t\t * Removes a editor or editors form page.\n\t\t *\n\t\t * @example\n\t\t * // Remove all editors bound to divs\n\t\t * tinymce.remove('div');\n\t\t *\n\t\t * // Remove all editors bound to textareas\n\t\t * tinymce.remove('textarea');\n\t\t *\n\t\t * // Remove all editors\n\t\t * tinymce.remove();\n\t\t *\n\t\t * // Remove specific instance by id\n\t\t * tinymce.remove('#id');\n\t\t *\n\t\t * @method remove\n\t\t * @param {tinymce.Editor/String/Object} [selector] CSS selector or editor instance to remove.\n\t\t * @return {tinymce.Editor} The editor that got passed in will be return if it was found otherwise null.\n\t\t */\n\t\tremove: function(selector) {\n\t\t\tvar self = this, i, editors = self.editors, editor;\n\n\t\t\t// Remove all editors\n\t\t\tif (!selector) {\n\t\t\t\tfor (i = editors.length - 1; i >= 0; i--) {\n\t\t\t\t\tself.remove(editors[i]);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Remove editors by selector\n\t\t\tif (typeof selector == \"string\") {\n\t\t\t\tselector = selector.selector || selector;\n\n\t\t\t\teach(DOM.select(selector), function(elm) {\n\t\t\t\t\teditor = editors[elm.id];\n\n\t\t\t\t\tif (editor) {\n\t\t\t\t\t\tself.remove(editor);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Remove specific editor\n\t\t\teditor = selector;\n\n\t\t\t// Not in the collection\n\t\t\tif (!editors[editor.id]) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (removeEditorFromList(editor)) {\n\t\t\t\tself.fire('RemoveEditor', {editor: editor});\n\t\t\t}\n\n\t\t\tif (!editors.length) {\n\t\t\t\tDOM.unbind(window, 'beforeunload', beforeUnloadDelegate);\n\t\t\t}\n\n\t\t\teditor.remove();\n\n\t\t\ttoggleGlobalEvents(editors, editors.length > 0);\n\n\t\t\treturn editor;\n\t\t},\n\n\t\t/**\n\t\t * Executes a specific command on the currently active editor.\n\t\t *\n\t\t * @method execCommand\n\t\t * @param {String} cmd Command to perform for example Bold.\n\t\t * @param {Boolean} ui Optional boolean state if a UI should be presented for the command or not.\n\t\t * @param {String} value Optional value parameter like for example an URL to a link.\n\t\t * @return {Boolean} true/false if the command was executed or not.\n\t\t */\n\t\texecCommand: function(cmd, ui, value) {\n\t\t\tvar self = this, editor = self.get(value);\n\n\t\t\t// Manager commands\n\t\t\tswitch (cmd) {\n\t\t\t\tcase \"mceAddEditor\":\n\t\t\t\t\tif (!self.get(value)) {\n\t\t\t\t\t\tnew Editor(value, self.settings, self).render();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\n\t\t\t\tcase \"mceRemoveEditor\":\n\t\t\t\t\tif (editor) {\n\t\t\t\t\t\teditor.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\n\t\t\t\tcase 'mceToggleEditor':\n\t\t\t\t\tif (!editor) {\n\t\t\t\t\t\tself.execCommand('mceAddEditor', 0, value);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (editor.isHidden()) {\n\t\t\t\t\t\teditor.show();\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.hide();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Run command on active editor\n\t\t\tif (self.activeEditor) {\n\t\t\t\treturn self.activeEditor.execCommand(cmd, ui, value);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Calls the save method on all editor instances in the collection. This can be useful when a form is to be submitted.\n\t\t *\n\t\t * @method triggerSave\n\t\t * @example\n\t\t * // Saves all contents\n\t\t * tinyMCE.triggerSave();\n\t\t */\n\t\ttriggerSave: function() {\n\t\t\teach(this.editors, function(editor) {\n\t\t\t\teditor.save();\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Adds a language pack, this gets called by the loaded language files like en.js.\n\t\t *\n\t\t * @method addI18n\n\t\t * @param {String} code Optional language code.\n\t\t * @param {Object} items Name/value object with translations.\n\t\t */\n\t\taddI18n: function(code, items) {\n\t\t\tI18n.add(code, items);\n\t\t},\n\n\t\t/**\n\t\t * Translates the specified string using the language pack items.\n\t\t *\n\t\t * @method translate\n\t\t * @param {String/Array/Object} text String to translate\n\t\t * @return {String} Translated string.\n\t\t */\n\t\ttranslate: function(text) {\n\t\t\treturn I18n.translate(text);\n\t\t},\n\n\t\t/**\n\t\t * Sets the active editor instance and fires the deactivate/activate events.\n\t\t *\n\t\t * @method setActive\n\t\t * @param {tinymce.Editor} editor Editor instance to set as the active instance.\n\t\t */\n\t\tsetActive: function(editor) {\n\t\t\tvar activeEditor = this.activeEditor;\n\n\t\t\tif (this.activeEditor != editor) {\n\t\t\t\tif (activeEditor) {\n\t\t\t\t\tactiveEditor.fire('deactivate', {relatedTarget: editor});\n\t\t\t\t}\n\n\t\t\t\teditor.fire('activate', {relatedTarget: activeEditor});\n\t\t\t}\n\n\t\t\tthis.activeEditor = editor;\n\t\t}\n\t};\n\n\textend(EditorManager, Observable);\n\n\tEditorManager.setup();\n\n\t// Export EditorManager as tinymce/tinymce in global namespace\n\twindow.tinymce = window.tinyMCE = EditorManager;\n\n\treturn EditorManager;\n});\n\n// Included from: js/tinymce/classes/LegacyInput.js\n\n/**\n * LegacyInput.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Converts legacy input to modern HTML.\n *\n * @class tinymce.LegacyInput\n * @private\n */\ndefine(\"tinymce/LegacyInput\", [\n\t\"tinymce/EditorManager\",\n\t\"tinymce/util/Tools\"\n], function(EditorManager, Tools) {\n\tvar each = Tools.each, explode = Tools.explode;\n\n\tEditorManager.on('AddEditor', function(e) {\n\t\tvar editor = e.editor;\n\n\t\teditor.on('preInit', function() {\n\t\t\tvar filters, fontSizes, dom, settings = editor.settings;\n\n\t\t\tfunction replaceWithSpan(node, styles) {\n\t\t\t\teach(styles, function(value, name) {\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tdom.setStyle(node, name, value);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tdom.rename(node, 'span');\n\t\t\t}\n\n\t\t\tfunction convert(e) {\n\t\t\t\tdom = editor.dom;\n\n\t\t\t\tif (settings.convert_fonts_to_spans) {\n\t\t\t\t\teach(dom.select('font,u,strike', e.node), function(node) {\n\t\t\t\t\t\tfilters[node.nodeName.toLowerCase()](dom, node);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (settings.inline_styles) {\n\t\t\t\tfontSizes = explode(settings.font_size_legacy_values);\n\n\t\t\t\tfilters = {\n\t\t\t\t\tfont: function(dom, node) {\n\t\t\t\t\t\treplaceWithSpan(node, {\n\t\t\t\t\t\t\tbackgroundColor: node.style.backgroundColor,\n\t\t\t\t\t\t\tcolor: node.color,\n\t\t\t\t\t\t\tfontFamily: node.face,\n\t\t\t\t\t\t\tfontSize: fontSizes[parseInt(node.size, 10) - 1]\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\n\t\t\t\t\tu: function(dom, node) {\n\t\t\t\t\t\t// HTML5 allows U element\n\t\t\t\t\t\tif (editor.settings.schema === \"html4\") {\n\t\t\t\t\t\t\treplaceWithSpan(node, {\n\t\t\t\t\t\t\t\ttextDecoration: 'underline'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tstrike: function(dom, node) {\n\t\t\t\t\t\treplaceWithSpan(node, {\n\t\t\t\t\t\t\ttextDecoration: 'line-through'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\teditor.on('PreProcess SetContent', convert);\n\t\t\t}\n\t\t});\n\t});\n});\n\n// Included from: js/tinymce/classes/util/XHR.js\n\n/**\n * XHR.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class enables you to send XMLHTTPRequests cross browser.\n * @class tinymce.util.XHR\n * @mixes tinymce.util.Observable\n * @static\n * @example\n * // Sends a low level Ajax request\n * tinymce.util.XHR.send({\n *    url: 'someurl',\n *    success: function(text) {\n *       console.debug(text);\n *    }\n * });\n *\n * // Add custom header to XHR request\n * tinymce.util.XHR.on('beforeSend', function(e) {\n *     e.xhr.setRequestHeader('X-Requested-With', 'Something');\n * });\n */\ndefine(\"tinymce/util/XHR\", [\n\t\"tinymce/util/Observable\",\n\t\"tinymce/util/Tools\"\n], function(Observable, Tools) {\n\tvar XHR = {\n\t\t/**\n\t\t * Sends a XMLHTTPRequest.\n\t\t * Consult the Wiki for details on what settings this method takes.\n\t\t *\n\t\t * @method send\n\t\t * @param {Object} settings Object will target URL, callbacks and other info needed to make the request.\n\t\t */\n\t\tsend: function(settings) {\n\t\t\tvar xhr, count = 0;\n\n\t\t\tfunction ready() {\n\t\t\t\tif (!settings.async || xhr.readyState == 4 || count++ > 10000) {\n\t\t\t\t\tif (settings.success && count < 10000 && xhr.status == 200) {\n\t\t\t\t\t\tsettings.success.call(settings.success_scope, '' + xhr.responseText, xhr, settings);\n\t\t\t\t\t} else if (settings.error) {\n\t\t\t\t\t\tsettings.error.call(settings.error_scope, count > 10000 ? 'TIMED_OUT' : 'GENERAL', xhr, settings);\n\t\t\t\t\t}\n\n\t\t\t\t\txhr = null;\n\t\t\t\t} else {\n\t\t\t\t\tsetTimeout(ready, 10);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Default settings\n\t\t\tsettings.scope = settings.scope || this;\n\t\t\tsettings.success_scope = settings.success_scope || settings.scope;\n\t\t\tsettings.error_scope = settings.error_scope || settings.scope;\n\t\t\tsettings.async = settings.async === false ? false : true;\n\t\t\tsettings.data = settings.data || '';\n\n\t\t\tXHR.fire('beforeInitialize', {settings: settings});\n\n\t\t\txhr = new XMLHttpRequest();\n\n\t\t\tif (xhr) {\n\t\t\t\tif (xhr.overrideMimeType) {\n\t\t\t\t\txhr.overrideMimeType(settings.content_type);\n\t\t\t\t}\n\n\t\t\t\txhr.open(settings.type || (settings.data ? 'POST' : 'GET'), settings.url, settings.async);\n\n\t\t\t\tif (settings.crossDomain) {\n\t\t\t\t\txhr.withCredentials = true;\n\t\t\t\t}\n\n\t\t\t\tif (settings.content_type) {\n\t\t\t\t\txhr.setRequestHeader('Content-Type', settings.content_type);\n\t\t\t\t}\n\n\t\t\t\tif (settings.requestheaders) {\n\t\t\t\t\tTools.each(settings.requestheaders, function(header) {\n\t\t\t\t\t\txhr.setRequestHeader(header.key, header.value);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\txhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n\n\t\t\t\txhr = XHR.fire('beforeSend', {xhr: xhr, settings: settings}).xhr;\n\t\t\t\txhr.send(settings.data);\n\n\t\t\t\t// Syncronous request\n\t\t\t\tif (!settings.async) {\n\t\t\t\t\treturn ready();\n\t\t\t\t}\n\n\t\t\t\t// Wait for response, onReadyStateChange can not be used since it leaks memory in IE\n\t\t\t\tsetTimeout(ready, 10);\n\t\t\t}\n\t\t}\n\t};\n\n\tTools.extend(XHR, Observable);\n\n\treturn XHR;\n});\n\n// Included from: js/tinymce/classes/util/JSON.js\n\n/**\n * JSON.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * JSON parser and serializer class.\n *\n * @class tinymce.util.JSON\n * @static\n * @example\n * // JSON parse a string into an object\n * var obj = tinymce.util.JSON.parse(somestring);\n *\n * // JSON serialize a object into an string\n * var str = tinymce.util.JSON.serialize(obj);\n */\ndefine(\"tinymce/util/JSON\", [], function() {\n\tfunction serialize(o, quote) {\n\t\tvar i, v, t, name;\n\n\t\tquote = quote || '\"';\n\n\t\tif (o === null) {\n\t\t\treturn 'null';\n\t\t}\n\n\t\tt = typeof o;\n\n\t\tif (t == 'string') {\n\t\t\tv = '\\bb\\tt\\nn\\ff\\rr\\\"\"\\'\\'\\\\\\\\';\n\n\t\t\t/*eslint no-control-regex:0 */\n\t\t\treturn quote + o.replace(/([\\u0080-\\uFFFF\\x00-\\x1f\\\"\\'\\\\])/g, function(a, b) {\n\t\t\t\t// Make sure single quotes never get encoded inside double quotes for JSON compatibility\n\t\t\t\tif (quote === '\"' && a === \"'\") {\n\t\t\t\t\treturn a;\n\t\t\t\t}\n\n\t\t\t\ti = v.indexOf(b);\n\n\t\t\t\tif (i + 1) {\n\t\t\t\t\treturn '\\\\' + v.charAt(i + 1);\n\t\t\t\t}\n\n\t\t\t\ta = b.charCodeAt().toString(16);\n\n\t\t\t\treturn '\\\\u' + '0000'.substring(a.length) + a;\n\t\t\t}) + quote;\n\t\t}\n\n\t\tif (t == 'object') {\n\t\t\tif (o.hasOwnProperty && Object.prototype.toString.call(o) === '[object Array]') {\n\t\t\t\tfor (i = 0, v = '['; i < o.length; i++) {\n\t\t\t\t\tv += (i > 0 ? ',' : '') + serialize(o[i], quote);\n\t\t\t\t}\n\n\t\t\t\treturn v + ']';\n\t\t\t}\n\n\t\t\tv = '{';\n\n\t\t\tfor (name in o) {\n\t\t\t\tif (o.hasOwnProperty(name)) {\n\t\t\t\t\tv += typeof o[name] != 'function' ? (v.length > 1 ? ',' + quote : quote) + name +\n\t\t\t\t\t\tquote + ':' + serialize(o[name], quote) : '';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn v + '}';\n\t\t}\n\n\t\treturn '' + o;\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Serializes the specified object as a JSON string.\n\t\t *\n\t\t * @method serialize\n\t\t * @param {Object} obj Object to serialize as a JSON string.\n\t\t * @param {String} quote Optional quote string defaults to \".\n\t\t * @return {string} JSON string serialized from input.\n\t\t */\n\t\tserialize: serialize,\n\n\t\t/**\n\t\t * Unserializes/parses the specified JSON string into a object.\n\t\t *\n\t\t * @method parse\n\t\t * @param {string} s JSON String to parse into a JavaScript object.\n\t\t * @return {Object} Object from input JSON string or undefined if it failed.\n\t\t */\n\t\tparse: function(text) {\n\t\t\ttry {\n\t\t\t\t// Trick uglify JS\n\t\t\t\treturn window[String.fromCharCode(101) + 'val']('(' + text + ')');\n\t\t\t} catch (ex) {\n\t\t\t\t// Ignore\n\t\t\t}\n\t\t}\n\n\t\t/**#@-*/\n\t};\n});\n\n// Included from: js/tinymce/classes/util/JSONRequest.js\n\n/**\n * JSONRequest.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class enables you to use JSON-RPC to call backend methods.\n *\n * @class tinymce.util.JSONRequest\n * @example\n * var json = new tinymce.util.JSONRequest({\n *     url: 'somebackend.php'\n * });\n *\n * // Send RPC call 1\n * json.send({\n *     method: 'someMethod1',\n *     params: ['a', 'b'],\n *     success: function(result) {\n *         console.dir(result);\n *     }\n * });\n *\n * // Send RPC call 2\n * json.send({\n *     method: 'someMethod2',\n *     params: ['a', 'b'],\n *     success: function(result) {\n *         console.dir(result);\n *     }\n * });\n */\ndefine(\"tinymce/util/JSONRequest\", [\n\t\"tinymce/util/JSON\",\n\t\"tinymce/util/XHR\",\n\t\"tinymce/util/Tools\"\n], function(JSON, XHR, Tools) {\n\tvar extend = Tools.extend;\n\n\tfunction JSONRequest(settings) {\n\t\tthis.settings = extend({}, settings);\n\t\tthis.count = 0;\n\t}\n\n\t/**\n\t * Simple helper function to send a JSON-RPC request without the need to initialize an object.\n\t * Consult the Wiki API documentation for more details on what you can pass to this function.\n\t *\n\t * @method sendRPC\n\t * @static\n\t * @param {Object} o Call object where there are three field id, method and params this object should also contain callbacks etc.\n\t */\n\tJSONRequest.sendRPC = function(o) {\n\t\treturn new JSONRequest().send(o);\n\t};\n\n\tJSONRequest.prototype = {\n\t\t/**\n\t\t * Sends a JSON-RPC call. Consult the Wiki API documentation for more details on what you can pass to this function.\n\t\t *\n\t\t * @method send\n\t\t * @param {Object} args Call object where there are three field id, method and params this object should also contain callbacks etc.\n\t\t */\n\t\tsend: function(args) {\n\t\t\tvar ecb = args.error, scb = args.success;\n\n\t\t\targs = extend(this.settings, args);\n\n\t\t\targs.success = function(c, x) {\n\t\t\t\tc = JSON.parse(c);\n\n\t\t\t\tif (typeof c == 'undefined') {\n\t\t\t\t\tc = {\n\t\t\t\t\t\terror: 'JSON Parse error.'\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (c.error) {\n\t\t\t\t\tecb.call(args.error_scope || args.scope, c.error, x);\n\t\t\t\t} else {\n\t\t\t\t\tscb.call(args.success_scope || args.scope, c.result);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\targs.error = function(ty, x) {\n\t\t\t\tif (ecb) {\n\t\t\t\t\tecb.call(args.error_scope || args.scope, ty, x);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\targs.data = JSON.serialize({\n\t\t\t\tid: args.id || 'c' + (this.count++),\n\t\t\t\tmethod: args.method,\n\t\t\t\tparams: args.params\n\t\t\t});\n\n\t\t\t// JSON content type for Ruby on rails. Bug: #1883287\n\t\t\targs.content_type = 'application/json';\n\n\t\t\tXHR.send(args);\n\t\t}\n\t};\n\n\treturn JSONRequest;\n});\n\n// Included from: js/tinymce/classes/util/JSONP.js\n\n/**\n * JSONP.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\ndefine(\"tinymce/util/JSONP\", [\n\t\"tinymce/dom/DOMUtils\"\n], function(DOMUtils) {\n\treturn {\n\t\tcallbacks: {},\n\t\tcount: 0,\n\n\t\tsend: function(settings) {\n\t\t\tvar self = this, dom = DOMUtils.DOM, count = settings.count !== undefined ? settings.count : self.count;\n\t\t\tvar id = 'tinymce_jsonp_' + count;\n\n\t\t\tself.callbacks[count] = function(json) {\n\t\t\t\tdom.remove(id);\n\t\t\t\tdelete self.callbacks[count];\n\n\t\t\t\tsettings.callback(json);\n\t\t\t};\n\n\t\t\tdom.add(dom.doc.body, 'script', {\n\t\t\t\tid: id,\n\t\t\t\tsrc: settings.url,\n\t\t\t\ttype: 'text/javascript'\n\t\t\t});\n\n\t\t\tself.count++;\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/util/LocalStorage.js\n\n/**\n * LocalStorage.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class will simulate LocalStorage on IE 7 and return the native version on modern browsers.\n * Storage is done using userData on IE 7 and a special serialization format. The format is designed\n * to be as small as possible by making sure that the keys and values doesn't need to be encoded. This\n * makes it possible to store for example HTML data.\n *\n * Storage format for userData:\n * <base 32 key length>,<key string>,<base 32 value length>,<value>,...\n *\n * For example this data key1=value1,key2=value2 would be:\n * 4,key1,6,value1,4,key2,6,value2\n *\n * @class tinymce.util.LocalStorage\n * @static\n * @version 4.0\n * @example\n * tinymce.util.LocalStorage.setItem('key', 'value');\n * var value = tinymce.util.LocalStorage.getItem('key');\n */\ndefine(\"tinymce/util/LocalStorage\", [], function() {\n\tvar LocalStorage, storageElm, items, keys, userDataKey, hasOldIEDataSupport;\n\n\t// Check for native support\n\ttry {\n\t\tif (window.localStorage) {\n\t\t\treturn localStorage;\n\t\t}\n\t} catch (ex) {\n\t\t// Ignore\n\t}\n\n\tuserDataKey = \"tinymce\";\n\tstorageElm = document.documentElement;\n\thasOldIEDataSupport = !!storageElm.addBehavior;\n\n\tif (hasOldIEDataSupport) {\n\t\tstorageElm.addBehavior('#default#userData');\n\t}\n\n\t/**\n\t * Gets the keys names and updates LocalStorage.length property. Since IE7 doesn't have any getters/setters.\n\t */\n\tfunction updateKeys() {\n\t\tkeys = [];\n\n\t\tfor (var key in items) {\n\t\t\tkeys.push(key);\n\t\t}\n\n\t\tLocalStorage.length = keys.length;\n\t}\n\n\t/**\n\t * Loads the userData string and parses it into the items structure.\n\t */\n\tfunction load() {\n\t\tvar key, data, value, pos = 0;\n\n\t\titems = {};\n\n\t\t// localStorage can be disabled on WebKit/Gecko so make a dummy storage\n\t\tif (!hasOldIEDataSupport) {\n\t\t\treturn;\n\t\t}\n\n\t\tfunction next(end) {\n\t\t\tvar value, nextPos;\n\n\t\t\tnextPos = end !== undefined ? pos + end : data.indexOf(',', pos);\n\t\t\tif (nextPos === -1 || nextPos > data.length) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tvalue = data.substring(pos, nextPos);\n\t\t\tpos = nextPos + 1;\n\n\t\t\treturn value;\n\t\t}\n\n\t\tstorageElm.load(userDataKey);\n\t\tdata = storageElm.getAttribute(userDataKey) || '';\n\n\t\tdo {\n\t\t\tvar offset = next();\n\t\t\tif (offset === null) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tkey = next(parseInt(offset, 32) || 0);\n\t\t\tif (key !== null) {\n\t\t\t\toffset = next();\n\t\t\t\tif (offset === null) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tvalue = next(parseInt(offset, 32) || 0);\n\n\t\t\t\tif (key) {\n\t\t\t\t\titems[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t} while (key !== null);\n\n\t\tupdateKeys();\n\t}\n\n\t/**\n\t * Saves the items structure into a the userData format.\n\t */\n\tfunction save() {\n\t\tvar value, data = '';\n\n\t\t// localStorage can be disabled on WebKit/Gecko so make a dummy storage\n\t\tif (!hasOldIEDataSupport) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (var key in items) {\n\t\t\tvalue = items[key];\n\t\t\tdata += (data ? ',' : '') + key.length.toString(32) + ',' + key + ',' + value.length.toString(32) + ',' + value;\n\t\t}\n\n\t\tstorageElm.setAttribute(userDataKey, data);\n\n\t\ttry {\n\t\t\tstorageElm.save(userDataKey);\n\t\t} catch (ex) {\n\t\t\t// Ignore disk full\n\t\t}\n\n\t\tupdateKeys();\n\t}\n\n\tLocalStorage = {\n\t\t/**\n\t\t * Length of the number of items in storage.\n\t\t *\n\t\t * @property length\n\t\t * @type Number\n\t\t * @return {Number} Number of items in storage.\n\t\t */\n\t\t//length:0,\n\n\t\t/**\n\t\t * Returns the key name by index.\n\t\t *\n\t\t * @method key\n\t\t * @param {Number} index Index of key to return.\n\t\t * @return {String} Key value or null if it wasn't found.\n\t\t */\n\t\tkey: function(index) {\n\t\t\treturn keys[index];\n\t\t},\n\n\t\t/**\n\t\t * Returns the value if the specified key or null if it wasn't found.\n\t\t *\n\t\t * @method getItem\n\t\t * @param {String} key Key of item to retrieve.\n\t\t * @return {String} Value of the specified item or null if it wasn't found.\n\t\t */\n\t\tgetItem: function(key) {\n\t\t\treturn key in items ? items[key] : null;\n\t\t},\n\n\t\t/**\n\t\t * Sets the value of the specified item by it's key.\n\t\t *\n\t\t * @method setItem\n\t\t * @param {String} key Key of the item to set.\n\t\t * @param {String} value Value of the item to set.\n\t\t */\n\t\tsetItem: function(key, value) {\n\t\t\titems[key] = \"\" + value;\n\t\t\tsave();\n\t\t},\n\n\t\t/**\n\t\t * Removes the specified item by key.\n\t\t *\n\t\t * @method removeItem\n\t\t * @param {String} key Key of item to remove.\n\t\t */\n\t\tremoveItem: function(key) {\n\t\t\tdelete items[key];\n\t\t\tsave();\n\t\t},\n\n\t\t/**\n\t\t * Removes all items.\n\t\t *\n\t\t * @method clear\n\t\t */\n\t\tclear: function() {\n\t\t\titems = {};\n\t\t\tsave();\n\t\t}\n\t};\n\n\tload();\n\n\treturn LocalStorage;\n});\n\n// Included from: js/tinymce/classes/Compat.js\n\n/**\n * Compat.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * TinyMCE core class.\n *\n * @static\n * @class tinymce\n * @borrow-members tinymce.EditorManager\n * @borrow-members tinymce.util.Tools\n */\ndefine(\"tinymce/Compat\", [\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/dom/EventUtils\",\n\t\"tinymce/dom/ScriptLoader\",\n\t\"tinymce/AddOnManager\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/Env\"\n], function(DOMUtils, EventUtils, ScriptLoader, AddOnManager, Tools, Env) {\n\tvar tinymce = window.tinymce;\n\n\t/**\n\t * @property {tinymce.dom.DOMUtils} DOM Global DOM instance.\n\t * @property {tinymce.dom.ScriptLoader} ScriptLoader Global ScriptLoader instance.\n\t * @property {tinymce.AddOnManager} PluginManager Global PluginManager instance.\n\t * @property {tinymce.AddOnManager} ThemeManager Global ThemeManager instance.\n\t */\n\ttinymce.DOM = DOMUtils.DOM;\n\ttinymce.ScriptLoader = ScriptLoader.ScriptLoader;\n\ttinymce.PluginManager = AddOnManager.PluginManager;\n\ttinymce.ThemeManager = AddOnManager.ThemeManager;\n\n\ttinymce.dom = tinymce.dom || {};\n\ttinymce.dom.Event = EventUtils.Event;\n\n\tTools.each(\n\t\t'trim isArray is toArray makeMap each map grep inArray extend create walk createNS resolve explode _addCacheSuffix'.split(' '),\n\t\tfunction(key) {\n\t\t\ttinymce[key] = Tools[key];\n\t\t}\n\t);\n\n\tTools.each('isOpera isWebKit isIE isGecko isMac'.split(' '), function(name) {\n\t\ttinymce[name] = Env[name.substr(2).toLowerCase()];\n\t});\n\n\treturn {};\n});\n\n// Describe the different namespaces\n\n/**\n * Root level namespace this contains classes directly related to the TinyMCE editor.\n *\n * @namespace tinymce\n */\n\n/**\n * Contains classes for handling the browsers DOM.\n *\n * @namespace tinymce.dom\n */\n\n/**\n * Contains html parser and serializer logic.\n *\n * @namespace tinymce.html\n */\n\n/**\n * Contains the different UI types such as buttons, listboxes etc.\n *\n * @namespace tinymce.ui\n */\n\n/**\n * Contains various utility classes such as json parser, cookies etc.\n *\n * @namespace tinymce.util\n */\n\n/**\n * Contains modules to handle data binding.\n *\n * @namespace tinymce.data\n */\n\n// Included from: js/tinymce/classes/ui/Layout.js\n\n/**\n * Layout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Base layout manager class.\n *\n * @class tinymce.ui.Layout\n */\ndefine(\"tinymce/ui/Layout\", [\n\t\"tinymce/util/Class\",\n\t\"tinymce/util/Tools\"\n], function(Class, Tools) {\n\t\"use strict\";\n\n\treturn Class.extend({\n\t\tDefaults: {\n\t\t\tfirstControlClass: 'first',\n\t\t\tlastControlClass: 'last'\n\t\t},\n\n\t\t/**\n\t\t * Constructs a layout instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tthis.settings = Tools.extend({}, this.Defaults, settings);\n\t\t},\n\n\t\t/**\n\t\t * This method gets invoked before the layout renders the controls.\n\t\t *\n\t\t * @method preRender\n\t\t * @param {tinymce.ui.Container} container Container instance to preRender.\n\t\t */\n\t\tpreRender: function(container) {\n\t\t\tcontainer.bodyClasses.add(this.settings.containerClass);\n\t\t},\n\n\t\t/**\n\t\t * Applies layout classes to the container.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tapplyClasses: function(items) {\n\t\t\tvar self = this, settings = self.settings, firstClass, lastClass, firstItem, lastItem;\n\n\t\t\tfirstClass = settings.firstControlClass;\n\t\t\tlastClass = settings.lastControlClass;\n\n\t\t\titems.each(function(item) {\n\t\t\t\titem.classes.remove(firstClass).remove(lastClass).add(settings.controlClass);\n\n\t\t\t\tif (item.visible()) {\n\t\t\t\t\tif (!firstItem) {\n\t\t\t\t\t\tfirstItem = item;\n\t\t\t\t\t}\n\n\t\t\t\t\tlastItem = item;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (firstItem) {\n\t\t\t\tfirstItem.classes.add(firstClass);\n\t\t\t}\n\n\t\t\tif (lastItem) {\n\t\t\t\tlastItem.classes.add(lastClass);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Renders the specified container and any layout specific HTML.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @param {tinymce.ui.Container} container Container to render HTML for.\n\t\t */\n\t\trenderHtml: function(container) {\n\t\t\tvar self = this, html = '';\n\n\t\t\tself.applyClasses(container.items());\n\n\t\t\tcontainer.items().each(function(item) {\n\t\t\t\thtml += item.renderHtml();\n\t\t\t});\n\n\t\t\treturn html;\n\t\t},\n\n\t\t/**\n\t\t * Recalculates the positions of the controls in the specified container.\n\t\t *\n\t\t * @method recalc\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\n\t\t */\n\t\trecalc: function() {\n\t\t},\n\n\t\t/**\n\t\t * This method gets invoked after the layout renders the controls.\n\t\t *\n\t\t * @method postRender\n\t\t * @param {tinymce.ui.Container} container Container instance to postRender.\n\t\t */\n\t\tpostRender: function() {\n\t\t},\n\n\t\tisNative: function() {\n\t\t\treturn false;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/AbsoluteLayout.js\n\n/**\n * AbsoluteLayout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * LayoutManager for absolute positioning. This layout manager is more of\n * a base class for other layouts but can be created and used directly.\n *\n * @-x-less AbsoluteLayout.less\n * @class tinymce.ui.AbsoluteLayout\n * @extends tinymce.ui.Layout\n */\ndefine(\"tinymce/ui/AbsoluteLayout\", [\n\t\"tinymce/ui/Layout\"\n], function(Layout) {\n\t\"use strict\";\n\n\treturn Layout.extend({\n\t\tDefaults: {\n\t\t\tcontainerClass: 'abs-layout',\n\t\t\tcontrolClass: 'abs-layout-item'\n\t\t},\n\n\t\t/**\n\t\t * Recalculates the positions of the controls in the specified container.\n\t\t *\n\t\t * @method recalc\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\n\t\t */\n\t\trecalc: function(container) {\n\t\t\tcontainer.items().filter(':visible').each(function(ctrl) {\n\t\t\t\tvar settings = ctrl.settings;\n\n\t\t\t\tctrl.layoutRect({\n\t\t\t\t\tx: settings.x,\n\t\t\t\t\ty: settings.y,\n\t\t\t\t\tw: settings.w,\n\t\t\t\t\th: settings.h\n\t\t\t\t});\n\n\t\t\t\tif (ctrl.recalc) {\n\t\t\t\t\tctrl.recalc();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Renders the specified container and any layout specific HTML.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @param {tinymce.ui.Container} container Container to render HTML for.\n\t\t */\n\t\trenderHtml: function(container) {\n\t\t\treturn '<div id=\"' + container._id + '-absend\" class=\"' + container.classPrefix + 'abs-end\"></div>' + this._super(container);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Button.js\n\n/**\n * Button.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is used to create buttons. You can create them directly or through the Factory.\n *\n * @example\n * // Create and render a button to the body element\n * tinymce.ui.Factory.create({\n *     type: 'button',\n *     text: 'My button'\n * }).renderTo(document.body);\n *\n * @-x-less Button.less\n * @class tinymce.ui.Button\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Button\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\tDefaults: {\n\t\t\tclasses: \"widget btn\",\n\t\t\trole: \"button\"\n\t\t},\n\n\t\t/**\n\t\t * Constructs a new button instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {String} size Size of the button small|medium|large.\n\t\t * @setting {String} image Image to use for icon.\n\t\t * @setting {String} icon Icon to use for button.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this, size;\n\n\t\t\tself._super(settings);\n\t\t\tsettings = self.settings;\n\n\t\t\tsize = self.settings.size;\n\n\t\t\tself.on('click mousedown', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\t\tself.on('touchstart', function(e) {\n\t\t\t\tself.fire('click', e);\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\t\tif (settings.subtype) {\n\t\t\t\tself.classes.add(settings.subtype);\n\t\t\t}\n\n\t\t\tif (size) {\n\t\t\t\tself.classes.add('btn-' + size);\n\t\t\t}\n\n\t\t\tif (settings.icon) {\n\t\t\t\tself.icon(settings.icon);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Sets/gets the current button icon.\n\t\t *\n\t\t * @method icon\n\t\t * @param {String} [icon] New icon identifier.\n\t\t * @return {String|tinymce.ui.MenuButton} Current icon or current MenuButton instance.\n\t\t */\n\t\ticon: function(icon) {\n\t\t\tif (!arguments.length) {\n\t\t\t\treturn this.state.get('icon');\n\t\t\t}\n\n\t\t\tthis.state.set('icon', icon);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Repaints the button for example after it's been resizes by a layout engine.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar btnElm = this.getEl().firstChild,\n\t\t\t\tbtnStyle;\n\n\t\t\tif (btnElm) {\n\t\t\t\tbtnStyle = btnElm.style;\n\t\t\t\tbtnStyle.width = btnStyle.height = \"100%\";\n\t\t\t}\n\n\t\t\tthis._super();\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix;\n\t\t\tvar icon = self.state.get('icon'), image, text = self.state.get('text'), textHtml = '';\n\n\t\t\timage = self.settings.image;\n\t\t\tif (image) {\n\t\t\t\ticon = 'none';\n\n\t\t\t\t// Support for [high dpi, low dpi] image sources\n\t\t\t\tif (typeof image != \"string\") {\n\t\t\t\t\timage = window.getSelection ? image[0] : image[1];\n\t\t\t\t}\n\n\t\t\t\timage = ' style=\"background-image: url(\\'' + image + '\\')\"';\n\t\t\t} else {\n\t\t\t\timage = '';\n\t\t\t}\n\n\t\t\tif (text) {\n\t\t\t\tself.classes.add('btn-has-text');\n\t\t\t\ttextHtml = '<span class=\"' + prefix + 'txt\">' + self.encode(text) + '</span>';\n\t\t\t}\n\n\t\t\ticon = icon ? prefix + 'ico ' + prefix + 'i-' + icon : '';\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" tabindex=\"-1\" aria-labelledby=\"' + id + '\">' +\n\t\t\t\t\t'<button role=\"presentation\" type=\"button\" tabindex=\"-1\">' +\n\t\t\t\t\t\t(icon ? '<i class=\"' + icon + '\"' + image + '></i>' : '') +\n\t\t\t\t\t\ttextHtml +\n\t\t\t\t\t'</button>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this, $ = self.$, textCls = self.classPrefix + 'txt';\n\n\t\t\tfunction setButtonText(text) {\n\t\t\t\tvar $span = $('span.' + textCls, self.getEl());\n\n\t\t\t\tif (text) {\n\t\t\t\t\tif (!$span[0]) {\n\t\t\t\t\t\t$('button:first', self.getEl()).append('<span class=\"' + textCls + '\"></span>');\n\t\t\t\t\t\t$span = $('span.' + textCls, self.getEl());\n\t\t\t\t\t}\n\n\t\t\t\t\t$span.html(self.encode(text));\n\t\t\t\t} else {\n\t\t\t\t\t$span.remove();\n\t\t\t\t}\n\n\t\t\t\tself.classes.toggle('btn-has-text', !!text);\n\t\t\t}\n\n\t\t\tself.state.on('change:text', function(e) {\n\t\t\t\tsetButtonText(e.value);\n\t\t\t});\n\n\t\t\tself.state.on('change:icon', function(e) {\n\t\t\t\tvar icon = e.value, prefix = self.classPrefix;\n\n\t\t\t\tself.settings.icon = icon;\n\t\t\t\ticon = icon ? prefix + 'ico ' + prefix + 'i-' + self.settings.icon : '';\n\n\t\t\t\tvar btnElm = self.getEl().firstChild, iconElm = btnElm.getElementsByTagName('i')[0];\n\n\t\t\t\tif (icon) {\n\t\t\t\t\tif (!iconElm || iconElm != btnElm.firstChild) {\n\t\t\t\t\t\ticonElm = document.createElement('i');\n\t\t\t\t\t\tbtnElm.insertBefore(iconElm, btnElm.firstChild);\n\t\t\t\t\t}\n\n\t\t\t\t\ticonElm.className = icon;\n\t\t\t\t} else if (iconElm) {\n\t\t\t\t\tbtnElm.removeChild(iconElm);\n\t\t\t\t}\n\n\t\t\t\tsetButtonText(self.state.get('text'));\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ButtonGroup.js\n\n/**\n * ButtonGroup.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This control enables you to put multiple buttons into a group. This is\n * useful when you want to combine similar toolbar buttons into a group.\n *\n * @example\n * // Create and render a buttongroup with two buttons to the body element\n * tinymce.ui.Factory.create({\n *     type: 'buttongroup',\n *     items: [\n *         {text: 'Button A'},\n *         {text: 'Button B'}\n *     ]\n * }).renderTo(document.body);\n *\n * @-x-less ButtonGroup.less\n * @class tinymce.ui.ButtonGroup\n * @extends tinymce.ui.Container\n */\ndefine(\"tinymce/ui/ButtonGroup\", [\n\t\"tinymce/ui/Container\"\n], function(Container) {\n\t\"use strict\";\n\n\treturn Container.extend({\n\t\tDefaults: {\n\t\t\tdefaultType: 'button',\n\t\t\trole: 'group'\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout;\n\n\t\t\tself.classes.add('btn-group');\n\t\t\tself.preRender();\n\t\t\tlayout.preRender(self);\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<div id=\"' + self._id + '-body\">' +\n\t\t\t\t\t\t(self.settings.html || '') + layout.renderHtml(self) +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Checkbox.js\n\n/**\n * Checkbox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This control creates a custom checkbox.\n *\n * @example\n * // Create and render a checkbox to the body element\n * tinymce.ui.Factory.create({\n *     type: 'checkbox',\n *     checked: true,\n *     text: 'My checkbox'\n * }).renderTo(document.body);\n *\n * @-x-less Checkbox.less\n * @class tinymce.ui.Checkbox\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Checkbox\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\tDefaults: {\n\t\t\tclasses: \"checkbox\",\n\t\t\trole: \"checkbox\",\n\t\t\tchecked: false\n\t\t},\n\n\t\t/**\n\t\t * Constructs a new Checkbox instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Boolean} checked True if the checkbox should be checked by default.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\n\t\t\tself.on('click mousedown', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tif (!self.disabled()) {\n\t\t\t\t\tself.checked(!self.checked());\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.checked(self.settings.checked);\n\t\t},\n\n\t\t/**\n\t\t * Getter/setter function for the checked state.\n\t\t *\n\t\t * @method checked\n\t\t * @param {Boolean} [state] State to be set.\n\t\t * @return {Boolean|tinymce.ui.Checkbox} True/false or checkbox if it's a set operation.\n\t\t */\n\t\tchecked: function(state) {\n\t\t\tif (!arguments.length) {\n\t\t\t\treturn this.state.get('checked');\n\t\t\t}\n\n\t\t\tthis.state.set('checked', state);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Getter/setter function for the value state.\n\t\t *\n\t\t * @method value\n\t\t * @param {Boolean} [state] State to be set.\n\t\t * @return {Boolean|tinymce.ui.Checkbox} True/false or checkbox if it's a set operation.\n\t\t */\n\t\tvalue: function(state) {\n\t\t\tif (!arguments.length) {\n\t\t\t\treturn this.checked();\n\t\t\t}\n\n\t\t\treturn this.checked(state);\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" unselectable=\"on\" aria-labelledby=\"' + id + '-al\" tabindex=\"-1\">' +\n\t\t\t\t\t'<i class=\"' + prefix + 'ico ' + prefix + 'i-checkbox\"></i>' +\n\t\t\t\t\t'<span id=\"' + id + '-al\" class=\"' + prefix + 'label\">' + self.encode(self.state.get('text')) + '</span>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tfunction checked(state) {\n\t\t\t\tself.classes.toggle(\"checked\", state);\n\t\t\t\tself.aria('checked', state);\n\t\t\t}\n\n\t\t\tself.state.on('change:text', function(e) {\n\t\t\t\tself.getEl('al').firstChild.data = self.translate(e.value);\n\t\t\t});\n\n\t\t\tself.state.on('change:checked change:value', function(e) {\n\t\t\t\tself.fire('change');\n\t\t\t\tchecked(e.value);\n\t\t\t});\n\n\t\t\tself.state.on('change:icon', function(e) {\n\t\t\t\tvar icon = e.value, prefix = self.classPrefix;\n\n\t\t\t\tif (typeof icon == 'undefined') {\n\t\t\t\t\treturn self.settings.icon;\n\t\t\t\t}\n\n\t\t\t\tself.settings.icon = icon;\n\t\t\t\ticon = icon ? prefix + 'ico ' + prefix + 'i-' + self.settings.icon : '';\n\n\t\t\t\tvar btnElm = self.getEl().firstChild, iconElm = btnElm.getElementsByTagName('i')[0];\n\n\t\t\t\tif (icon) {\n\t\t\t\t\tif (!iconElm || iconElm != btnElm.firstChild) {\n\t\t\t\t\t\ticonElm = document.createElement('i');\n\t\t\t\t\t\tbtnElm.insertBefore(iconElm, btnElm.firstChild);\n\t\t\t\t\t}\n\n\t\t\t\t\ticonElm.className = icon;\n\t\t\t\t} else if (iconElm) {\n\t\t\t\t\tbtnElm.removeChild(iconElm);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (self.state.get('checked')) {\n\t\t\t\tchecked(true);\n\t\t\t}\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ComboBox.js\n\n/**\n * ComboBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates a combobox control. Select box that you select a value from or\n * type a value into.\n *\n * @-x-less ComboBox.less\n * @class tinymce.ui.ComboBox\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/ComboBox\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/Factory\",\n\t\"tinymce/ui/DomUtils\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/util/VK\",\n\t\"tinymce/util/Tools\"\n], function(Widget, Factory, DomUtils, $, VK, Tools) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Constructs a new control instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {String} placeholder Placeholder text to display.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tsettings = self.settings;\n\n\t\t\tself.classes.add('combobox');\n\t\t\tself.subinput = true;\n\t\t\tself.ariaTarget = 'inp'; // TODO: Figure out a better way\n\n\t\t\tsettings.menu = settings.menu || settings.values;\n\n\t\t\tif (settings.menu) {\n\t\t\t\tsettings.icon = 'caret';\n\t\t\t}\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tvar elm = e.target, root = self.getEl();\n\n\t\t\t\tif (!$.contains(root, elm) && elm != root) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twhile (elm && elm != root) {\n\t\t\t\t\tif (elm.id && elm.id.indexOf('-open') != -1) {\n\t\t\t\t\t\tself.fire('action');\n\n\t\t\t\t\t\tif (settings.menu) {\n\t\t\t\t\t\t\tself.showMenu();\n\n\t\t\t\t\t\t\tif (e.aria) {\n\t\t\t\t\t\t\t\tself.menu.items()[0].focus();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telm = elm.parentNode;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// TODO: Rework this\n\t\t\tself.on('keydown', function(e) {\n\t\t\t\tvar rootControl;\n\n\t\t\t\tif (e.keyCode == 13 && e.target.nodeName === 'INPUT') {\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t// Find root control that we can do toJSON on\n\t\t\t\t\tself.parents().reverse().each(function(ctrl) {\n\t\t\t\t\t\tif (ctrl.toJSON) {\n\t\t\t\t\t\t\trootControl = ctrl;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Fire event on current text box with the serialized data of the whole form\n\t\t\t\t\tself.fire('submit', {data: rootControl.toJSON()});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('keyup', function(e) {\n\t\t\t\tif (e.target.nodeName == \"INPUT\") {\n\t\t\t\t\tvar oldValue = self.state.get('value');\n\t\t\t\t\tvar newValue = e.target.value;\n\n\t\t\t\t\tif (newValue !== oldValue) {\n\t\t\t\t\t\tself.state.set('value', newValue);\n\t\t\t\t\t\tself.fire('autocomplete', e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('mouseover', function(e) {\n\t\t\t\tvar tooltip = self.tooltip().moveTo(-0xFFFF);\n\n\t\t\t\tif (self.statusLevel() && e.target.className.indexOf(self.classPrefix + 'status') !== -1) {\n\t\t\t\t\tvar statusMessage = self.statusMessage() || 'Ok';\n\t\t\t\t\tvar rel = tooltip.text(statusMessage).show().testMoveRel(e.target, ['bc-tc', 'bc-tl', 'bc-tr']);\n\n\t\t\t\t\ttooltip.classes.toggle('tooltip-n', rel == 'bc-tc');\n\t\t\t\t\ttooltip.classes.toggle('tooltip-nw', rel == 'bc-tl');\n\t\t\t\t\ttooltip.classes.toggle('tooltip-ne', rel == 'bc-tr');\n\n\t\t\t\t\ttooltip.moveRel(e.target, rel);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tstatusLevel: function (value) {\n\t\t\tif (arguments.length > 0) {\n\t\t\t\tthis.state.set('statusLevel', value);\n\t\t\t}\n\n\t\t\treturn this.state.get('statusLevel');\n\t\t},\n\n\t\tstatusMessage: function (value) {\n\t\t\tif (arguments.length > 0) {\n\t\t\t\tthis.state.set('statusMessage', value);\n\t\t\t}\n\n\t\t\treturn this.state.get('statusMessage');\n\t\t},\n\n\t\tshowMenu: function() {\n\t\t\tvar self = this, settings = self.settings, menu;\n\n\t\t\tif (!self.menu) {\n\t\t\t\tmenu = settings.menu || [];\n\n\t\t\t\t// Is menu array then auto constuct menu control\n\t\t\t\tif (menu.length) {\n\t\t\t\t\tmenu = {\n\t\t\t\t\t\ttype: 'menu',\n\t\t\t\t\t\titems: menu\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tmenu.type = menu.type || 'menu';\n\t\t\t\t}\n\n\t\t\t\tself.menu = Factory.create(menu).parent(self).renderTo(self.getContainerElm());\n\t\t\t\tself.fire('createmenu');\n\t\t\t\tself.menu.reflow();\n\t\t\t\tself.menu.on('cancel', function(e) {\n\t\t\t\t\tif (e.control === self.menu) {\n\t\t\t\t\t\tself.focus();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.menu.on('show hide', function(e) {\n\t\t\t\t\te.control.items().each(function(ctrl) {\n\t\t\t\t\t\tctrl.active(ctrl.value() == self.value());\n\t\t\t\t\t});\n\t\t\t\t}).fire('show');\n\n\t\t\t\tself.menu.on('select', function(e) {\n\t\t\t\t\tself.value(e.control.value());\n\t\t\t\t});\n\n\t\t\t\tself.on('focusin', function(e) {\n\t\t\t\t\tif (e.target.tagName.toUpperCase() == 'INPUT') {\n\t\t\t\t\t\tself.menu.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.aria('expanded', true);\n\t\t\t}\n\n\t\t\tself.menu.show();\n\t\t\tself.menu.layoutRect({w: self.layoutRect().w});\n\t\t\tself.menu.moveRel(self.getEl(), self.isRtl() ? ['br-tr', 'tr-br'] : ['bl-tl', 'tl-bl']);\n\t\t},\n\n\t\t/**\n\t\t * Focuses the input area of the control.\n\t\t *\n\t\t * @method focus\n\t\t */\n\t\tfocus: function() {\n\t\t\tthis.getEl('inp').focus();\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this, elm = self.getEl(), openElm = self.getEl('open'), rect = self.layoutRect();\n\t\t\tvar width, lineHeight, innerPadding = 0, inputElm = elm.firstChild;\n\n\t\t\tif (self.statusLevel() && self.statusLevel() !== 'none') {\n\t\t\t\tinnerPadding = (\n\t\t\t\t\tparseInt(DomUtils.getRuntimeStyle(inputElm, 'padding-right'), 10) -\n\t\t\t\t\tparseInt(DomUtils.getRuntimeStyle(inputElm, 'padding-left'), 10)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (openElm) {\n\t\t\t\twidth = rect.w - DomUtils.getSize(openElm).width - 10;\n\t\t\t} else {\n\t\t\t\twidth = rect.w - 10;\n\t\t\t}\n\n\t\t\t// Detect old IE 7+8 add lineHeight to align caret vertically in the middle\n\t\t\tvar doc = document;\n\t\t\tif (doc.all && (!doc.documentMode || doc.documentMode <= 8)) {\n\t\t\t\tlineHeight = (self.layoutRect().h - 2) + 'px';\n\t\t\t}\n\n\t\t\t$(inputElm).css({\n\t\t\t\twidth: width - innerPadding,\n\t\t\t\tlineHeight: lineHeight\n\t\t\t});\n\n\t\t\tself._super();\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Post render method. Called after the control has been rendered to the target.\n\t\t *\n\t\t * @method postRender\n\t\t * @return {tinymce.ui.ComboBox} Current combobox instance.\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\t$(this.getEl('inp')).on('change', function(e) {\n\t\t\t\tself.state.set('value', e.target.value);\n\t\t\t\tself.fire('change', e);\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, settings = self.settings, prefix = self.classPrefix;\n\t\t\tvar value = self.state.get('value') || '';\n\t\t\tvar icon, text, openBtnHtml = '', extraAttrs = '', statusHtml = '';\n\n\t\t\tif (\"spellcheck\" in settings) {\n\t\t\t\textraAttrs += ' spellcheck=\"' + settings.spellcheck + '\"';\n\t\t\t}\n\n\t\t\tif (settings.maxLength) {\n\t\t\t\textraAttrs += ' maxlength=\"' + settings.maxLength + '\"';\n\t\t\t}\n\n\t\t\tif (settings.size) {\n\t\t\t\textraAttrs += ' size=\"' + settings.size + '\"';\n\t\t\t}\n\n\t\t\tif (settings.subtype) {\n\t\t\t\textraAttrs += ' type=\"' + settings.subtype + '\"';\n\t\t\t}\n\n\t\t\tstatusHtml = '<i id=\"' + id + '-status\" class=\"mce-status mce-ico\" style=\"display: none\"></i>';\n\n\t\t\tif (self.disabled()) {\n\t\t\t\textraAttrs += ' disabled=\"disabled\"';\n\t\t\t}\n\n\t\t\ticon = settings.icon;\n\t\t\tif (icon && icon != 'caret') {\n\t\t\t\ticon = prefix + 'ico ' + prefix + 'i-' + settings.icon;\n\t\t\t}\n\n\t\t\ttext = self.state.get('text');\n\n\t\t\tif (icon || text) {\n\t\t\t\topenBtnHtml = (\n\t\t\t\t\t'<div id=\"' + id + '-open\" class=\"' + prefix + 'btn ' + prefix + 'open\" tabIndex=\"-1\" role=\"button\">' +\n\t\t\t\t\t\t'<button id=\"' + id + '-action\" type=\"button\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t\t\t(icon != 'caret' ? '<i class=\"' + icon + '\"></i>' : '<i class=\"' + prefix + 'caret\"></i>') +\n\t\t\t\t\t\t\t(text ? (icon ? ' ' : '') + text : '') +\n\t\t\t\t\t\t'</button>' +\n\t\t\t\t\t'</div>'\n\t\t\t\t);\n\n\t\t\t\tself.classes.add('has-open');\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<input id=\"' + id + '-inp\" class=\"' + prefix + 'textbox\" value=\"' +\n\t\t\t\t\tself.encode(value, false) + '\" hidefocus=\"1\"' + extraAttrs + ' placeholder=\"' +\n\t\t\t\t\tself.encode(settings.placeholder) + '\" />' +\n\t\t\t\t\tstatusHtml +\n\t\t\t\t\topenBtnHtml +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tvalue: function(value) {\n\t\t\tif (arguments.length) {\n\t\t\t\tthis.state.set('value', value);\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\t// Make sure the real state is in sync\n\t\t\tif (this.state.get('rendered')) {\n\t\t\t\tthis.state.set('value', this.getEl('inp').value);\n\t\t\t}\n\n\t\t\treturn this.state.get('value');\n\t\t},\n\n\t\tshowAutoComplete: function (items, term) {\n\t\t\tvar self = this;\n\n\t\t\tif (items.length === 0) {\n\t\t\t\tself.hideMenu();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar insert = function (value, title) {\n\t\t\t\treturn function () {\n\t\t\t\t\tself.fire('selectitem', {\n\t\t\t\t\t\ttitle: title,\n\t\t\t\t\t\tvalue: value\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t};\n\n\t\t\tif (self.menu) {\n\t\t\t\tself.menu.items().remove();\n\t\t\t} else {\n\t\t\t\tself.menu = Factory.create({\n\t\t\t\t\ttype: 'menu',\n\t\t\t\t\tclasses: 'combobox-menu',\n\t\t\t\t\tlayout: 'flow'\n\t\t\t\t}).parent(self).renderTo();\n\t\t\t}\n\n\t\t\tTools.each(items, function (item) {\n\t\t\t\tself.menu.add({\n\t\t\t\t\ttext: item.title,\n\t\t\t\t\turl: item.previewUrl,\n\t\t\t\t\tmatch: term,\n\t\t\t\t\tclasses: 'menu-item-ellipsis',\n\t\t\t\t\tonclick: insert(item.value, item.title)\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tself.menu.renderNew();\n\t\t\tself.hideMenu();\n\n\t\t\tself.menu.on('cancel', function(e) {\n\t\t\t\tif (e.control.parent() === self.menu) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tself.focus();\n\t\t\t\t\tself.hideMenu();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.menu.on('select', function() {\n\t\t\t\tself.focus();\n\t\t\t});\n\n\t\t\tvar maxW = self.layoutRect().w;\n\t\t\tself.menu.layoutRect({w: maxW, minW: 0, maxW: maxW});\n\t\t\tself.menu.reflow();\n\t\t\tself.menu.show();\n\t\t\tself.menu.moveRel(self.getEl(), self.isRtl() ? ['br-tr', 'tr-br'] : ['bl-tl', 'tl-bl']);\n\t\t},\n\n\t\thideMenu: function() {\n\t\t\tif (this.menu) {\n\t\t\t\tthis.menu.hide();\n\t\t\t}\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:value', function(e) {\n\t\t\t\tif (self.getEl('inp').value != e.value) {\n\t\t\t\t\tself.getEl('inp').value = e.value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.state.on('change:disabled', function(e) {\n\t\t\t\tself.getEl('inp').disabled = e.value;\n\t\t\t});\n\n\t\t\tself.state.on('change:statusLevel', function(e) {\n\t\t\t\tvar statusIconElm = self.getEl('status');\n\t\t\t\tvar prefix = self.classPrefix, value = e.value;\n\n\t\t\t\tDomUtils.css(statusIconElm, 'display', value === 'none' ? 'none' : '');\n\t\t\t\tDomUtils.toggleClass(statusIconElm, prefix + 'i-checkmark', value === 'ok');\n\t\t\t\tDomUtils.toggleClass(statusIconElm, prefix + 'i-warning', value === 'warn');\n\t\t\t\tDomUtils.toggleClass(statusIconElm, prefix + 'i-error', value === 'error');\n\t\t\t\tself.classes.toggle('has-status', value !== 'none');\n\t\t\t\tself.repaint();\n\t\t\t});\n\n\t\t\tDomUtils.on(self.getEl('status'), 'mouseleave', function () {\n\t\t\t\tself.tooltip().hide();\n\t\t\t});\n\n\t\t\tself.on('cancel', function (e) {\n\t\t\t\tif (self.menu && self.menu.visible()) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tself.hideMenu();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar focusIdx = function (idx, menu) {\n\t\t\t\tif (menu && menu.items().length > 0) {\n\t\t\t\t\tmenu.items().eq(idx)[0].focus();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tself.on('keydown', function (e) {\n\t\t\t\tvar keyCode = e.keyCode;\n\n\t\t\t\tif (e.target.nodeName === 'INPUT') {\n\t\t\t\t\tif (keyCode === VK.DOWN) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tself.fire('autocomplete');\n\t\t\t\t\t\tfocusIdx(0, self.menu);\n\t\t\t\t\t} else if (keyCode === VK.UP) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tfocusIdx(-1, self.menu);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\tremove: function() {\n\t\t\t$(this.getEl('inp')).off();\n\n\t\t\tif (this.menu) {\n\t\t\t\tthis.menu.remove();\n\t\t\t}\n\n\t\t\tthis._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ColorBox.js\n\n/**\n * ColorBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This widget lets you enter colors and browse for colors by pressing the color button. It also displays\n * a preview of the current color.\n *\n * @-x-less ColorBox.less\n * @class tinymce.ui.ColorBox\n * @extends tinymce.ui.ComboBox\n */\ndefine(\"tinymce/ui/ColorBox\", [\n\t\"tinymce/ui/ComboBox\"\n], function(ComboBox) {\n\t\"use strict\";\n\n\treturn ComboBox.extend({\n\t\t/**\n\t\t * Constructs a new control instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tsettings.spellcheck = false;\n\n\t\t\tif (settings.onaction) {\n\t\t\t\tsettings.icon = 'none';\n\t\t\t}\n\n\t\t\tself._super(settings);\n\n\t\t\tself.classes.add('colorbox');\n\t\t\tself.on('change keyup postrender', function() {\n\t\t\t\tself.repaintColor(self.value());\n\t\t\t});\n\t\t},\n\n\t\trepaintColor: function(value) {\n\t\t\tvar openElm = this.getEl('open');\n\t\t\tvar elm = openElm ? openElm.getElementsByTagName('i')[0] : null;\n\n\t\t\tif (elm) {\n\t\t\t\ttry {\n\t\t\t\t\telm.style.background = value;\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Ignore\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:value', function(e) {\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.repaintColor(e.value);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/PanelButton.js\n\n/**\n * PanelButton.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new panel button.\n *\n * @class tinymce.ui.PanelButton\n * @extends tinymce.ui.Button\n */\ndefine(\"tinymce/ui/PanelButton\", [\n\t\"tinymce/ui/Button\",\n\t\"tinymce/ui/FloatPanel\"\n], function(Button, FloatPanel) {\n\t\"use strict\";\n\n\treturn Button.extend({\n\t\t/**\n\t\t * Shows the panel for the button.\n\t\t *\n\t\t * @method showPanel\n\t\t */\n\t\tshowPanel: function() {\n\t\t\tvar self = this, settings = self.settings;\n\n\t\t\tself.active(true);\n\n\t\t\tif (!self.panel) {\n\t\t\t\tvar panelSettings = settings.panel;\n\n\t\t\t\t// Wrap panel in grid layout if type if specified\n\t\t\t\t// This makes it possible to add forms or other containers directly in the panel option\n\t\t\t\tif (panelSettings.type) {\n\t\t\t\t\tpanelSettings = {\n\t\t\t\t\t\tlayout: 'grid',\n\t\t\t\t\t\titems: panelSettings\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tpanelSettings.role = panelSettings.role || 'dialog';\n\t\t\t\tpanelSettings.popover = true;\n\t\t\t\tpanelSettings.autohide = true;\n\t\t\t\tpanelSettings.ariaRoot = true;\n\n\t\t\t\tself.panel = new FloatPanel(panelSettings).on('hide', function() {\n\t\t\t\t\tself.active(false);\n\t\t\t\t}).on('cancel', function(e) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tself.focus();\n\t\t\t\t\tself.hidePanel();\n\t\t\t\t}).parent(self).renderTo(self.getContainerElm());\n\n\t\t\t\tself.panel.fire('show');\n\t\t\t\tself.panel.reflow();\n\t\t\t} else {\n\t\t\t\tself.panel.show();\n\t\t\t}\n\n\t\t\tself.panel.moveRel(self.getEl(), settings.popoverAlign || (self.isRtl() ? ['bc-tr', 'bc-tc'] : ['bc-tl', 'bc-tc']));\n\t\t},\n\n\t\t/**\n\t\t * Hides the panel for the button.\n\t\t *\n\t\t * @method hidePanel\n\t\t */\n\t\thidePanel: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self.panel) {\n\t\t\t\tself.panel.hide();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.aria('haspopup', true);\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tif (e.control === self) {\n\t\t\t\t\tif (self.panel && self.panel.visible()) {\n\t\t\t\t\t\tself.hidePanel();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.showPanel();\n\t\t\t\t\t\tself.panel.focus(!!e.aria);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\tremove: function() {\n\t\t\tif (this.panel) {\n\t\t\t\tthis.panel.remove();\n\t\t\t\tthis.panel = null;\n\t\t\t}\n\n\t\t\treturn this._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ColorButton.js\n\n/**\n * ColorButton.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates a color button control. This is a split button in which the main\n * button has a visual representation of the currently selected color. When clicked\n * the caret button displays a color picker, allowing the user to select a new color.\n *\n * @-x-less ColorButton.less\n * @class tinymce.ui.ColorButton\n * @extends tinymce.ui.PanelButton\n */\ndefine(\"tinymce/ui/ColorButton\", [\n\t\"tinymce/ui/PanelButton\",\n\t\"tinymce/dom/DOMUtils\"\n], function(PanelButton, DomUtils) {\n\t\"use strict\";\n\n\tvar DOM = DomUtils.DOM;\n\n\treturn PanelButton.extend({\n\t\t/**\n\t\t * Constructs a new ColorButton instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tthis._super(settings);\n\t\t\tthis.classes.add('colorbutton');\n\t\t},\n\n\t\t/**\n\t\t * Getter/setter for the current color.\n\t\t *\n\t\t * @method color\n\t\t * @param {String} [color] Color to set.\n\t\t * @return {String|tinymce.ui.ColorButton} Current color or current instance.\n\t\t */\n\t\tcolor: function(color) {\n\t\t\tif (color) {\n\t\t\t\tthis._color = color;\n\t\t\t\tthis.getEl('preview').style.backgroundColor = color;\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\treturn this._color;\n\t\t},\n\n\t\t/**\n\t\t * Resets the current color.\n\t\t *\n\t\t * @method resetColor\n\t\t * @return {tinymce.ui.ColorButton} Current instance.\n\t\t */\n\t\tresetColor: function() {\n\t\t\tthis._color = null;\n\t\t\tthis.getEl('preview').style.backgroundColor = null;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix, text = self.state.get('text');\n\t\t\tvar icon = self.settings.icon ? prefix + 'ico ' + prefix + 'i-' + self.settings.icon : '';\n\t\t\tvar image = self.settings.image ? ' style=\"background-image: url(\\'' + self.settings.image + '\\')\"' : '',\n\t\t\t\ttextHtml = '';\n\n\t\t\tif (text) {\n\t\t\t\tself.classes.add('btn-has-text');\n\t\t\t\ttextHtml = '<span class=\"' + prefix + 'txt\">' + self.encode(text) + '</span>';\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" role=\"button\" tabindex=\"-1\" aria-haspopup=\"true\">' +\n\t\t\t\t\t'<button role=\"presentation\" hidefocus=\"1\" type=\"button\" tabindex=\"-1\">' +\n\t\t\t\t\t\t(icon ? '<i class=\"' + icon + '\"' + image + '></i>' : '') +\n\t\t\t\t\t\t'<span id=\"' + id + '-preview\" class=\"' + prefix + 'preview\"></span>' +\n\t\t\t\t\t\ttextHtml +\n\t\t\t\t\t'</button>' +\n\t\t\t\t\t'<button type=\"button\" class=\"' + prefix + 'open\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t\t' <i class=\"' + prefix + 'caret\"></i>' +\n\t\t\t\t\t'</button>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, onClickHandler = self.settings.onclick;\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tif (e.aria && e.aria.key == 'down') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.control == self && !DOM.getParent(e.target, '.' + self.classPrefix + 'open')) {\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\tonClickHandler.call(self, e);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdelete self.settings.onclick;\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/util/Color.js\n\n/**\n * Color.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class lets you parse/serialize colors and convert rgb/hsb.\n *\n * @class tinymce.util.Color\n * @example\n * var white = new tinymce.util.Color({r: 255, g: 255, b: 255});\n * var red = new tinymce.util.Color('#FF0000');\n *\n * console.log(white.toHex(), red.toHsv());\n */\ndefine(\"tinymce/util/Color\", [], function() {\n\tvar min = Math.min, max = Math.max, round = Math.round;\n\n\t/**\n\t * Constructs a new color instance.\n\t *\n\t * @constructor\n\t * @method Color\n\t * @param {String} value Optional initial value to parse.\n\t */\n\tfunction Color(value) {\n\t\tvar self = this, r = 0, g = 0, b = 0;\n\n\t\tfunction rgb2hsv(r, g, b) {\n\t\t\tvar h, s, v, d, minRGB, maxRGB;\n\n\t\t\th = 0;\n\t\t\ts = 0;\n\t\t\tv = 0;\n\t\t\tr = r / 255;\n\t\t\tg = g / 255;\n\t\t\tb = b / 255;\n\n\t\t\tminRGB = min(r, min(g, b));\n\t\t\tmaxRGB = max(r, max(g, b));\n\n\t\t\tif (minRGB == maxRGB) {\n\t\t\t\tv = minRGB;\n\n\t\t\t\treturn {\n\t\t\t\t\th: 0,\n\t\t\t\t\ts: 0,\n\t\t\t\t\tv: v * 100\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t/*eslint no-nested-ternary:0 */\n\t\t\td = (r == minRGB) ? g - b : ((b == minRGB) ? r - g : b - r);\n\t\t\th = (r == minRGB) ? 3 : ((b == minRGB) ? 1 : 5);\n\t\t\th = 60 * (h - d / (maxRGB - minRGB));\n\t\t\ts = (maxRGB - minRGB) / maxRGB;\n\t\t\tv = maxRGB;\n\n\t\t\treturn {\n\t\t\t\th: round(h),\n\t\t\t\ts: round(s * 100),\n\t\t\t\tv: round(v * 100)\n\t\t\t};\n\t\t}\n\n\t\tfunction hsvToRgb(hue, saturation, brightness) {\n\t\t\tvar side, chroma, x, match;\n\n\t\t\thue = (parseInt(hue, 10) || 0) % 360;\n\t\t\tsaturation = parseInt(saturation, 10) / 100;\n\t\t\tbrightness = parseInt(brightness, 10) / 100;\n\t\t\tsaturation = max(0, min(saturation, 1));\n\t\t\tbrightness = max(0, min(brightness, 1));\n\n\t\t\tif (saturation === 0) {\n\t\t\t\tr = g = b = round(255 * brightness);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tside = hue / 60;\n\t\t\tchroma = brightness * saturation;\n\t\t\tx = chroma * (1 - Math.abs(side % 2 - 1));\n\t\t\tmatch = brightness - chroma;\n\n\t\t\tswitch (Math.floor(side)) {\n\t\t\t\tcase 0:\n\t\t\t\t\tr = chroma;\n\t\t\t\t\tg = x;\n\t\t\t\t\tb = 0;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1:\n\t\t\t\t\tr = x;\n\t\t\t\t\tg = chroma;\n\t\t\t\t\tb = 0;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\t\t\t\t\tr = 0;\n\t\t\t\t\tg = chroma;\n\t\t\t\t\tb = x;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 3:\n\t\t\t\t\tr = 0;\n\t\t\t\t\tg = x;\n\t\t\t\t\tb = chroma;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 4:\n\t\t\t\t\tr = x;\n\t\t\t\t\tg = 0;\n\t\t\t\t\tb = chroma;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 5:\n\t\t\t\t\tr = chroma;\n\t\t\t\t\tg = 0;\n\t\t\t\t\tb = x;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tr = g = b = 0;\n\t\t\t}\n\n\t\t\tr = round(255 * (r + match));\n\t\t\tg = round(255 * (g + match));\n\t\t\tb = round(255 * (b + match));\n\t\t}\n\n\t\t/**\n\t\t * Returns the hex string of the current color. For example: #ff00ff\n\t\t *\n\t\t * @method toHex\n\t\t * @return {String} Hex string of current color.\n\t\t */\n\t\tfunction toHex() {\n\t\t\tfunction hex(val) {\n\t\t\t\tval = parseInt(val, 10).toString(16);\n\n\t\t\t\treturn val.length > 1 ? val : '0' + val;\n\t\t\t}\n\n\t\t\treturn '#' + hex(r) + hex(g) + hex(b);\n\t\t}\n\n\t\t/**\n\t\t * Returns the r, g, b values of the color. Each channel has a range from 0-255.\n\t\t *\n\t\t * @method toRgb\n\t\t * @return {Object} Object with r, g, b fields.\n\t\t */\n\t\tfunction toRgb() {\n\t\t\treturn {\n\t\t\t\tr: r,\n\t\t\t\tg: g,\n\t\t\t\tb: b\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Returns the h, s, v values of the color. Ranges: h=0-360, s=0-100, v=0-100.\n\t\t *\n\t\t * @method toHsv\n\t\t * @return {Object} Object with h, s, v fields.\n\t\t */\n\t\tfunction toHsv() {\n\t\t\treturn rgb2hsv(r, g, b);\n\t\t}\n\n\t\t/**\n\t\t * Parses the specified value and populates the color instance.\n\t\t *\n\t\t * Supported format examples:\n\t\t *  * rbg(255,0,0)\n\t\t *  * #ff0000\n\t\t *  * #fff\n\t\t *  * {r: 255, g: 0, b: 0}\n\t\t *  * {h: 360, s: 100, v: 100}\n\t\t *\n\t\t * @method parse\n\t\t * @param {Object/String} value Color value to parse.\n\t\t * @return {tinymce.util.Color} Current color instance.\n\t\t */\n\t\tfunction parse(value) {\n\t\t\tvar matches;\n\n\t\t\tif (typeof value == 'object') {\n\t\t\t\tif (\"r\" in value) {\n\t\t\t\t\tr = value.r;\n\t\t\t\t\tg = value.g;\n\t\t\t\t\tb = value.b;\n\t\t\t\t} else if (\"v\" in value) {\n\t\t\t\t\thsvToRgb(value.h, value.s, value.v);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ((matches = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)[^\\)]*\\)/gi.exec(value))) {\n\t\t\t\t\tr = parseInt(matches[1], 10);\n\t\t\t\t\tg = parseInt(matches[2], 10);\n\t\t\t\t\tb = parseInt(matches[3], 10);\n\t\t\t\t} else if ((matches = /#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value))) {\n\t\t\t\t\tr = parseInt(matches[1], 16);\n\t\t\t\t\tg = parseInt(matches[2], 16);\n\t\t\t\t\tb = parseInt(matches[3], 16);\n\t\t\t\t} else if ((matches = /#([0-F])([0-F])([0-F])/gi.exec(value))) {\n\t\t\t\t\tr = parseInt(matches[1] + matches[1], 16);\n\t\t\t\t\tg = parseInt(matches[2] + matches[2], 16);\n\t\t\t\t\tb = parseInt(matches[3] + matches[3], 16);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tr = r < 0 ? 0 : (r > 255 ? 255 : r);\n\t\t\tg = g < 0 ? 0 : (g > 255 ? 255 : g);\n\t\t\tb = b < 0 ? 0 : (b > 255 ? 255 : b);\n\n\t\t\treturn self;\n\t\t}\n\n\t\tif (value) {\n\t\t\tparse(value);\n\t\t}\n\n\t\tself.toRgb = toRgb;\n\t\tself.toHsv = toHsv;\n\t\tself.toHex = toHex;\n\t\tself.parse = parse;\n\t}\n\n\treturn Color;\n});\n\n// Included from: js/tinymce/classes/ui/ColorPicker.js\n\n/**\n * ColorPicker.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Color picker widget lets you select colors.\n *\n * @-x-less ColorPicker.less\n * @class tinymce.ui.ColorPicker\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/ColorPicker\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/DragHelper\",\n\t\"tinymce/ui/DomUtils\",\n\t\"tinymce/util/Color\"\n], function(Widget, DragHelper, DomUtils, Color) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\tDefaults: {\n\t\t\tclasses: \"widget colorpicker\"\n\t\t},\n\n\t\t/**\n\t\t * Constructs a new colorpicker instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {String} color Initial color value.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tthis._super(settings);\n\t\t},\n\n\t\tpostRender: function() {\n\t\t\tvar self = this, color = self.color(), hsv, hueRootElm, huePointElm, svRootElm, svPointElm;\n\n\t\t\thueRootElm = self.getEl('h');\n\t\t\thuePointElm = self.getEl('hp');\n\t\t\tsvRootElm = self.getEl('sv');\n\t\t\tsvPointElm = self.getEl('svp');\n\n\t\t\tfunction getPos(elm, event) {\n\t\t\t\tvar pos = DomUtils.getPos(elm), x, y;\n\n\t\t\t\tx = event.pageX - pos.x;\n\t\t\t\ty = event.pageY - pos.y;\n\n\t\t\t\tx = Math.max(0, Math.min(x / elm.clientWidth, 1));\n\t\t\t\ty = Math.max(0, Math.min(y / elm.clientHeight, 1));\n\n\t\t\t\treturn {\n\t\t\t\t\tx: x,\n\t\t\t\t\ty: y\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tfunction updateColor(hsv, hueUpdate) {\n\t\t\t\tvar hue = (360 - hsv.h) / 360;\n\n\t\t\t\tDomUtils.css(huePointElm, {\n\t\t\t\t\ttop: (hue * 100) + '%'\n\t\t\t\t});\n\n\t\t\t\tif (!hueUpdate) {\n\t\t\t\t\tDomUtils.css(svPointElm, {\n\t\t\t\t\t\tleft: hsv.s + '%',\n\t\t\t\t\t\ttop: (100 - hsv.v) + '%'\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tsvRootElm.style.background = new Color({s: 100, v: 100, h: hsv.h}).toHex();\n\t\t\t\tself.color().parse({s: hsv.s, v: hsv.v, h: hsv.h});\n\t\t\t}\n\n\t\t\tfunction updateSaturationAndValue(e) {\n\t\t\t\tvar pos;\n\n\t\t\t\tpos = getPos(svRootElm, e);\n\t\t\t\thsv.s = pos.x * 100;\n\t\t\t\thsv.v = (1 - pos.y) * 100;\n\n\t\t\t\tupdateColor(hsv);\n\t\t\t\tself.fire('change');\n\t\t\t}\n\n\t\t\tfunction updateHue(e) {\n\t\t\t\tvar pos;\n\n\t\t\t\tpos = getPos(hueRootElm, e);\n\t\t\t\thsv = color.toHsv();\n\t\t\t\thsv.h = (1 - pos.y) * 360;\n\t\t\t\tupdateColor(hsv, true);\n\t\t\t\tself.fire('change');\n\t\t\t}\n\n\t\t\tself._repaint = function() {\n\t\t\t\thsv = color.toHsv();\n\t\t\t\tupdateColor(hsv);\n\t\t\t};\n\n\t\t\tself._super();\n\n\t\t\tself._svdraghelper = new DragHelper(self._id + '-sv', {\n\t\t\t\tstart: updateSaturationAndValue,\n\t\t\t\tdrag: updateSaturationAndValue\n\t\t\t});\n\n\t\t\tself._hdraghelper = new DragHelper(self._id + '-h', {\n\t\t\t\tstart: updateHue,\n\t\t\t\tdrag: updateHue\n\t\t\t});\n\n\t\t\tself._repaint();\n\t\t},\n\n\t\trgb: function() {\n\t\t\treturn this.color().toRgb();\n\t\t},\n\n\t\tvalue: function(value) {\n\t\t\tvar self = this;\n\n\t\t\tif (arguments.length) {\n\t\t\t\tself.color().parse(value);\n\n\t\t\t\tif (self._rendered) {\n\t\t\t\t\tself._repaint();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn self.color().toHex();\n\t\t\t}\n\t\t},\n\n\t\tcolor: function() {\n\t\t\tif (!this._color) {\n\t\t\t\tthis._color = new Color();\n\t\t\t}\n\n\t\t\treturn this._color;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix, hueHtml;\n\t\t\tvar stops = '#ff0000,#ff0080,#ff00ff,#8000ff,#0000ff,#0080ff,#00ffff,#00ff80,#00ff00,#80ff00,#ffff00,#ff8000,#ff0000';\n\n\t\t\tfunction getOldIeFallbackHtml() {\n\t\t\t\tvar i, l, html = '', gradientPrefix, stopsList;\n\n\t\t\t\tgradientPrefix = 'filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=';\n\t\t\t\tstopsList = stops.split(',');\n\t\t\t\tfor (i = 0, l = stopsList.length - 1; i < l; i++) {\n\t\t\t\t\thtml += (\n\t\t\t\t\t\t'<div class=\"' + prefix + 'colorpicker-h-chunk\" style=\"' +\n\t\t\t\t\t\t\t'height:' + (100 / l) + '%;' +\n\t\t\t\t\t\t\tgradientPrefix + stopsList[i] + ',endColorstr=' + stopsList[i + 1] + ');' +\n\t\t\t\t\t\t\t'-ms-' + gradientPrefix + stopsList[i] + ',endColorstr=' + stopsList[i + 1] + ')' +\n\t\t\t\t\t\t'\"></div>'\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\treturn html;\n\t\t\t}\n\n\t\t\tvar gradientCssText = (\n\t\t\t\t'background: -ms-linear-gradient(top,' + stops + ');' +\n\t\t\t\t'background: linear-gradient(to bottom,' + stops + ');'\n\t\t\t);\n\n\t\t\thueHtml = (\n\t\t\t\t'<div id=\"' + id + '-h\" class=\"' + prefix + 'colorpicker-h\" style=\"' + gradientCssText + '\">' +\n\t\t\t\t\tgetOldIeFallbackHtml() +\n\t\t\t\t\t'<div id=\"' + id + '-hp\" class=\"' + prefix + 'colorpicker-h-marker\"></div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<div id=\"' + id + '-sv\" class=\"' + prefix + 'colorpicker-sv\">' +\n\t\t\t\t\t\t'<div class=\"' + prefix + 'colorpicker-overlay1\">' +\n\t\t\t\t\t\t\t'<div class=\"' + prefix + 'colorpicker-overlay2\">' +\n\t\t\t\t\t\t\t\t'<div id=\"' + id + '-svp\" class=\"' + prefix + 'colorpicker-selector1\">' +\n\t\t\t\t\t\t\t\t\t'<div class=\"' + prefix + 'colorpicker-selector2\"></div>' +\n\t\t\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t\thueHtml +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Path.js\n\n/**\n * Path.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new path control.\n *\n * @-x-less Path.less\n * @class tinymce.ui.Path\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Path\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {String} delimiter Delimiter to display between row in path.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tif (!settings.delimiter) {\n\t\t\t\tsettings.delimiter = '\\u00BB';\n\t\t\t}\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('path');\n\t\t\tself.canFocus = true;\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tvar index, target = e.target;\n\n\t\t\t\tif ((index = target.getAttribute('data-index'))) {\n\t\t\t\t\tself.fire('select', {value: self.row()[index], index: index});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.row(self.settings.row);\n\t\t},\n\n\t\t/**\n\t\t * Focuses the current control.\n\t\t *\n\t\t * @method focus\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tfocus: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.getEl().firstChild.focus();\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Sets/gets the data to be used for the path.\n\t\t *\n\t\t * @method row\n\t\t * @param {Array} row Array with row name is rendered to path.\n\t\t */\n\t\trow: function(row) {\n\t\t\tif (!arguments.length) {\n\t\t\t\treturn this.state.get('row');\n\t\t\t}\n\n\t\t\tthis.state.set('row', row);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\tself._getDataPathHtml(self.state.get('row')) +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:row', function(e) {\n\t\t\t\tself.innerHtml(self._getDataPathHtml(e.value));\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\t_getDataPathHtml: function(data) {\n\t\t\tvar self = this, parts = data || [], i, l, html = '', prefix = self.classPrefix;\n\n\t\t\tfor (i = 0, l = parts.length; i < l; i++) {\n\t\t\t\thtml += (\n\t\t\t\t\t(i > 0 ? '<div class=\"' + prefix + 'divider\" aria-hidden=\"true\"> ' + self.settings.delimiter + ' </div>' : '') +\n\t\t\t\t\t'<div role=\"button\" class=\"' + prefix + 'path-item' + (i == l - 1 ? ' ' + prefix + 'last' : '') + '\" data-index=\"' +\n\t\t\t\t\ti + '\" tabindex=\"-1\" id=\"' + self._id + '-' + i + '\" aria-level=\"' + (i + 1) + '\">' + parts[i].name + '</div>'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (!html) {\n\t\t\t\thtml = '<div class=\"' + prefix + 'path-item\">\\u00a0</div>';\n\t\t\t}\n\n\t\t\treturn html;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ElementPath.js\n\n/**\n * ElementPath.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This control creates an path for the current selections parent elements in TinyMCE.\n *\n * @class tinymce.ui.ElementPath\n * @extends tinymce.ui.Path\n */\ndefine(\"tinymce/ui/ElementPath\", [\n\t\"tinymce/ui/Path\"\n], function(Path) {\n\treturn Path.extend({\n\t\t/**\n\t\t * Post render method. Called after the control has been rendered to the target.\n\t\t *\n\t\t * @method postRender\n\t\t * @return {tinymce.ui.ElementPath} Current combobox instance.\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, editor = self.settings.editor;\n\n\t\t\tfunction isHidden(elm) {\n\t\t\t\tif (elm.nodeType === 1) {\n\t\t\t\t\tif (elm.nodeName == \"BR\" || !!elm.getAttribute('data-mce-bogus')) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (elm.getAttribute('data-mce-type') === 'bookmark') {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (editor.settings.elementpath !== false) {\n\t\t\t\tself.on('select', function(e) {\n\t\t\t\t\teditor.focus();\n\t\t\t\t\teditor.selection.select(this.row()[e.index].element);\n\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t});\n\n\t\t\t\teditor.on('nodeChange', function(e) {\n\t\t\t\t\tvar outParents = [], parents = e.parents, i = parents.length;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (parents[i].nodeType == 1 && !isHidden(parents[i])) {\n\t\t\t\t\t\t\tvar args = editor.fire('ResolveName', {\n\t\t\t\t\t\t\t\tname: parents[i].nodeName.toLowerCase(),\n\t\t\t\t\t\t\t\ttarget: parents[i]\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (!args.isDefaultPrevented()) {\n\t\t\t\t\t\t\t\toutParents.push({name: args.name, element: parents[i]});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (args.isPropagationStopped()) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tself.row(outParents);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/FormItem.js\n\n/**\n * FormItem.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is a container created by the form element with\n * a label and control item.\n *\n * @class tinymce.ui.FormItem\n * @extends tinymce.ui.Container\n * @setting {String} label Label to display for the form item.\n */\ndefine(\"tinymce/ui/FormItem\", [\n\t\"tinymce/ui/Container\"\n], function(Container) {\n\t\"use strict\";\n\n\treturn Container.extend({\n\t\tDefaults: {\n\t\t\tlayout: 'flex',\n\t\t\talign: 'center',\n\t\t\tdefaults: {\n\t\t\t\tflex: 1\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout, prefix = self.classPrefix;\n\n\t\t\tself.classes.add('formitem');\n\t\t\tlayout.preRender(self);\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t(self.settings.title ? ('<div id=\"' + self._id + '-title\" class=\"' + prefix + 'title\">' +\n\t\t\t\t\t\tself.settings.title + '</div>') : '') +\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\n\t\t\t\t\t\t(self.settings.html || '') + layout.renderHtml(self) +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Form.js\n\n/**\n * Form.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates a form container. A form container has the ability\n * to automatically wrap items in tinymce.ui.FormItem instances.\n *\n * Each FormItem instance is a container for the label and the item.\n *\n * @example\n * tinymce.ui.Factory.create({\n *     type: 'form',\n *     items: [\n *         {type: 'textbox', label: 'My text box'}\n *     ]\n * }).renderTo(document.body);\n *\n * @class tinymce.ui.Form\n * @extends tinymce.ui.Container\n */\ndefine(\"tinymce/ui/Form\", [\n\t\"tinymce/ui/Container\",\n\t\"tinymce/ui/FormItem\",\n\t\"tinymce/util/Tools\"\n], function(Container, FormItem, Tools) {\n\t\"use strict\";\n\n\treturn Container.extend({\n\t\tDefaults: {\n\t\t\tcontainerCls: 'form',\n\t\t\tlayout: 'flex',\n\t\t\tdirection: 'column',\n\t\t\talign: 'stretch',\n\t\t\tflex: 1,\n\t\t\tpadding: 20,\n\t\t\tlabelGap: 30,\n\t\t\tspacing: 10,\n\t\t\tcallbacks: {\n\t\t\t\tsubmit: function() {\n\t\t\t\t\tthis.submit();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * This method gets invoked before the control is rendered.\n\t\t *\n\t\t * @method preRender\n\t\t */\n\t\tpreRender: function() {\n\t\t\tvar self = this, items = self.items();\n\n\t\t\tif (!self.settings.formItemDefaults) {\n\t\t\t\tself.settings.formItemDefaults = {\n\t\t\t\t\tlayout: 'flex',\n\t\t\t\t\tautoResize: \"overflow\",\n\t\t\t\t\tdefaults: {flex: 1}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Wrap any labeled items in FormItems\n\t\t\titems.each(function(ctrl) {\n\t\t\t\tvar formItem, label = ctrl.settings.label;\n\n\t\t\t\tif (label) {\n\t\t\t\t\tformItem = new FormItem(Tools.extend({\n\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\ttype: 'label',\n\t\t\t\t\t\t\tid: ctrl._id + '-l',\n\t\t\t\t\t\t\ttext: label,\n\t\t\t\t\t\t\tflex: 0,\n\t\t\t\t\t\t\tforId: ctrl._id,\n\t\t\t\t\t\t\tdisabled: ctrl.disabled()\n\t\t\t\t\t\t}\n\t\t\t\t\t}, self.settings.formItemDefaults));\n\n\t\t\t\t\tformItem.type = 'formitem';\n\t\t\t\t\tctrl.aria('labelledby', ctrl._id + '-l');\n\n\t\t\t\t\tif (typeof ctrl.settings.flex == \"undefined\") {\n\t\t\t\t\t\tctrl.settings.flex = 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tself.replace(ctrl, formItem);\n\t\t\t\t\tformItem.add(ctrl);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Fires a submit event with the serialized form.\n\t\t *\n\t\t * @method submit\n\t\t * @return {Object} Event arguments object.\n\t\t */\n\t\tsubmit: function() {\n\t\t\treturn this.fire('submit', {data: this.toJSON()});\n\t\t},\n\n\t\t/**\n\t\t * Post render method. Called after the control has been rendered to the target.\n\t\t *\n\t\t * @method postRender\n\t\t * @return {tinymce.ui.ComboBox} Current combobox instance.\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself._super();\n\t\t\tself.fromJSON(self.settings.data);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself._super();\n\n\t\t\tfunction recalcLabels() {\n\t\t\t\tvar maxLabelWidth = 0, labels = [], i, labelGap, items;\n\n\t\t\t\tif (self.settings.labelGapCalc === false) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (self.settings.labelGapCalc == \"children\") {\n\t\t\t\t\titems = self.find('formitem');\n\t\t\t\t} else {\n\t\t\t\t\titems = self.items();\n\t\t\t\t}\n\n\t\t\t\titems.filter('formitem').each(function(item) {\n\t\t\t\t\tvar labelCtrl = item.items()[0], labelWidth = labelCtrl.getEl().clientWidth;\n\n\t\t\t\t\tmaxLabelWidth = labelWidth > maxLabelWidth ? labelWidth : maxLabelWidth;\n\t\t\t\t\tlabels.push(labelCtrl);\n\t\t\t\t});\n\n\t\t\t\tlabelGap = self.settings.labelGap || 0;\n\n\t\t\t\ti = labels.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tlabels[i].settings.minWidth = maxLabelWidth + labelGap;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.on('show', recalcLabels);\n\t\t\trecalcLabels();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/FieldSet.js\n\n/**\n * FieldSet.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates fieldset containers.\n *\n * @-x-less FieldSet.less\n * @class tinymce.ui.FieldSet\n * @extends tinymce.ui.Form\n */\ndefine(\"tinymce/ui/FieldSet\", [\n\t\"tinymce/ui/Form\"\n], function(Form) {\n\t\"use strict\";\n\n\treturn Form.extend({\n\t\tDefaults: {\n\t\t\tcontainerCls: 'fieldset',\n\t\t\tlayout: 'flex',\n\t\t\tdirection: 'column',\n\t\t\talign: 'stretch',\n\t\t\tflex: 1,\n\t\t\tpadding: \"25 15 5 15\",\n\t\t\tlabelGap: 30,\n\t\t\tspacing: 10,\n\t\t\tborder: 1\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout, prefix = self.classPrefix;\n\n\t\t\tself.preRender();\n\t\t\tlayout.preRender(self);\n\n\t\t\treturn (\n\t\t\t\t'<fieldset id=\"' + self._id + '\" class=\"' + self.classes + '\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t(self.settings.title ? ('<legend id=\"' + self._id + '-title\" class=\"' + prefix + 'fieldset-title\">' +\n\t\t\t\t\t\tself.settings.title + '</legend>') : '') +\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\n\t\t\t\t\t\t(self.settings.html || '') + layout.renderHtml(self) +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</fieldset>'\n\t\t\t);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/content/LinkTargets.js\n\n/**\n * LinkTargets.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module is enables you to get anything that you can link to in a element.\n *\n * @private\n * @class tinymce.content.LinkTargets\n */\ndefine('tinymce/content/LinkTargets', [\n\t'tinymce/dom/DOMUtils',\n\t'tinymce/util/Fun',\n\t'tinymce/util/Arr',\n\t'tinymce/util/Uuid',\n\t'tinymce/util/Tools',\n\t'tinymce/dom/NodeType'\n], function(\n\tDOMUtils,\n\tFun,\n\tArr,\n\tUuid,\n\tTools,\n\tNodeType\n) {\n\tvar trim = Tools.trim;\n\n\tvar create = function (type, title, url, level, attach) {\n\t\treturn {\n\t\t\ttype: type,\n\t\t\ttitle: title,\n\t\t\turl: url,\n\t\t\tlevel: level,\n\t\t\tattach: attach\n\t\t};\n\t};\n\n\tvar isChildOfContentEditableTrue = function (node) {\n\t\twhile ((node = node.parentNode)) {\n\t\t\tvar value = node.contentEditable;\n\t\t\tif (value && value !== 'inherit') {\n\t\t\t\treturn NodeType.isContentEditableTrue(node);\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tvar select = function (selector, root) {\n\t\treturn DOMUtils.DOM.select(selector, root);\n\t};\n\n\tvar getElementText = function (elm) {\n\t\treturn elm.innerText || elm.textContent;\n\t};\n\n\tvar getOrGenerateId = function (elm) {\n\t\treturn elm.id ? elm.id : Uuid.uuid('h');\n\t};\n\n\tvar isAnchor = function (elm) {\n\t\treturn elm && elm.nodeName === 'A' && (elm.id || elm.name);\n\t};\n\n\tvar isValidAnchor = function (elm) {\n\t\treturn isAnchor(elm) && isEditable(elm);\n\t};\n\n\tvar isHeader = function (elm) {\n\t\treturn elm && /^(H[1-6])$/.test(elm.nodeName);\n\t};\n\n\tvar isEditable = function (elm) {\n\t\treturn isChildOfContentEditableTrue(elm) && !NodeType.isContentEditableFalse(elm);\n\t};\n\n\tvar isValidHeader = function (elm) {\n\t\treturn isHeader(elm) && isEditable(elm);\n\t};\n\n\tvar getLevel = function (elm) {\n\t\treturn isHeader(elm) ? parseInt(elm.nodeName.substr(1), 10) : 0;\n\t};\n\n\tvar headerTarget = function (elm) {\n\t\tvar headerId = getOrGenerateId(elm);\n\n\t\tvar attach = function () {\n\t\t\telm.id = headerId;\n\t\t};\n\n\t\treturn create('header', getElementText(elm), '#' + headerId, getLevel(elm), attach);\n\t};\n\n\tvar anchorTarget = function (elm) {\n\t\tvar anchorId = elm.id || elm.name;\n\t\tvar anchorText = getElementText(elm);\n\n\t\treturn create('anchor', anchorText ? anchorText : '#' + anchorId, '#' + anchorId, 0, Fun.noop);\n\t};\n\n\tvar getHeaderTargets = function (elms) {\n\t\treturn Arr.map(Arr.filter(elms, isValidHeader), headerTarget);\n\t};\n\n\tvar getAnchorTargets = function (elms) {\n\t\treturn Arr.map(Arr.filter(elms, isValidAnchor), anchorTarget);\n\t};\n\n\tvar getTargetElements = function (elm) {\n\t\tvar elms = select('h1,h2,h3,h4,h5,h6,a:not([href])', elm);\n\t\treturn elms;\n\t};\n\n\tvar hasTitle = function (target) {\n\t\treturn trim(target.title).length > 0;\n\t};\n\n\tvar find = function (elm) {\n\t\tvar elms = getTargetElements(elm);\n\t\treturn Arr.filter(getHeaderTargets(elms).concat(getAnchorTargets(elms)), hasTitle);\n\t};\n\n\treturn {\n\t\tfind: find\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/FilePicker.js\n\n/**\n * FilePicker.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*global tinymce:true */\n\n/**\n * This class creates a file picker control.\n *\n * @class tinymce.ui.FilePicker\n * @extends tinymce.ui.ComboBox\n */\ndefine(\"tinymce/ui/FilePicker\", [\n\t\"tinymce/ui/ComboBox\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/util/Fun\",\n\t\"tinymce/util/VK\",\n\t\"tinymce/content/LinkTargets\"\n], function(ComboBox, Tools, Arr, Fun, VK, LinkTargets) {\n\t\"use strict\";\n\n\tvar history = {};\n\tvar HISTORY_LENGTH = 5;\n\n\tvar toMenuItem = function (target) {\n\t\treturn {\n\t\t\ttitle: target.title,\n\t\t\tvalue: {\n\t\t\t\ttitle: {raw: target.title},\n\t\t\t\turl: target.url,\n\t\t\t\tattach: target.attach\n\t\t\t}\n\t\t};\n\t};\n\n\tvar toMenuItems = function (targets) {\n\t\treturn Tools.map(targets, toMenuItem);\n\t};\n\n\tvar staticMenuItem = function (title, url) {\n\t\treturn {\n\t\t\ttitle: title,\n\t\t\tvalue: {\n\t\t\t\ttitle: title,\n\t\t\t\turl: url,\n\t\t\t\tattach: Fun.noop\n\t\t\t}\n\t\t};\n\t};\n\n\tvar isUniqueUrl = function (url, targets) {\n\t\tvar foundTarget = Arr.find(targets, function (target) {\n\t\t\treturn target.url === url;\n\t\t});\n\n\t\treturn !foundTarget;\n\t};\n\n\tvar getSetting = function (editorSettings, name, defaultValue) {\n\t\tvar value = name in editorSettings ? editorSettings[name] : defaultValue;\n\t\treturn value === false ? null : value;\n\t};\n\n\tvar createMenuItems = function (term, targets, fileType, editorSettings) {\n\t\tvar separator = {title: '-'};\n\n\t\tvar fromHistoryMenuItems = function (history) {\n\t\t\tvar uniqueHistory = Arr.filter(history[fileType], function (url) {\n\t\t\t\treturn isUniqueUrl(url, targets);\n\t\t\t});\n\n\t\t\treturn Tools.map(uniqueHistory, function (url) {\n\t\t\t\treturn {\n\t\t\t\t\ttitle: url,\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\ttitle: url,\n\t\t\t\t\t\turl: url,\n\t\t\t\t\t\tattach: Fun.noop\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t};\n\n\t\tvar fromMenuItems = function (type) {\n\t\t\tvar filteredTargets = Arr.filter(targets, function (target) {\n\t\t\t\treturn target.type == type;\n\t\t\t});\n\n\t\t\treturn toMenuItems(filteredTargets);\n\t\t};\n\n\t\tvar anchorMenuItems = function () {\n\t\t\tvar anchorMenuItems = fromMenuItems('anchor');\n\t\t\tvar topAnchor = getSetting(editorSettings, 'anchor_top', '#top');\n\t\t\tvar bottomAchor = getSetting(editorSettings, 'anchor_bottom', '#bottom');\n\n\t\t\tif (topAnchor !== null) {\n\t\t\t\tanchorMenuItems.unshift(staticMenuItem('<top>', topAnchor));\n\t\t\t}\n\n\t\t\tif (bottomAchor !== null) {\n\t\t\t\tanchorMenuItems.push(staticMenuItem('<bottom>', bottomAchor));\n\t\t\t}\n\n\t\t\treturn anchorMenuItems;\n\t\t};\n\n\t\tvar join = function (items) {\n\t\t\treturn Arr.reduce(items, function (a, b) {\n\t\t\t\tvar bothEmpty = a.length === 0 || b.length === 0;\n\t\t\t\treturn bothEmpty ? a.concat(b) : a.concat(separator, b);\n\t\t\t}, []);\n\t\t};\n\n\t\tif (editorSettings.typeahead_urls === false) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn fileType === 'file' ? join([\n\t\t\tfilterByQuery(term, fromHistoryMenuItems(history)),\n\t\t\tfilterByQuery(term, fromMenuItems('header')),\n\t\t\tfilterByQuery(term, anchorMenuItems())\n\t\t]) : filterByQuery(term, fromHistoryMenuItems(history));\n\t};\n\n\tvar addToHistory = function (url, fileType) {\n\t\tvar items = history[fileType];\n\n\t\tif (!/^https?/.test(url)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (items) {\n\t\t\tif (Arr.indexOf(items, url) === -1) {\n\t\t\t\thistory[fileType] = items.slice(0, HISTORY_LENGTH).concat(url);\n\t\t\t}\n\t\t} else {\n\t\t\thistory[fileType] = [url];\n\t\t}\n\t};\n\n\tvar filterByQuery = function (term, menuItems) {\n\t\tvar lowerCaseTerm = term.toLowerCase();\n\t\tvar result = Tools.grep(menuItems, function (item) {\n\t\t\treturn item.title.toLowerCase().indexOf(lowerCaseTerm) !== -1;\n\t\t});\n\n\t\treturn result.length === 1 && result[0].title === term ? [] : result;\n\t};\n\n\tvar getTitle = function (linkDetails) {\n\t\tvar title = linkDetails.title;\n\t\treturn title.raw ? title.raw : title;\n\t};\n\n\tvar setupAutoCompleteHandler = function (ctrl, editorSettings, bodyElm, fileType) {\n\t\tvar autocomplete = function (term) {\n\t\t\tvar linkTargets = LinkTargets.find(bodyElm);\n\t\t\tvar menuItems = createMenuItems(term, linkTargets, fileType, editorSettings);\n\t\t\tctrl.showAutoComplete(menuItems, term);\n\t\t};\n\n\t\tctrl.on('autocomplete', function () {\n\t\t\tautocomplete(ctrl.value());\n\t\t});\n\n\t\tctrl.on('selectitem', function (e) {\n\t\t\tvar linkDetails = e.value;\n\n\t\t\tctrl.value(linkDetails.url);\n\t\t\tvar title = getTitle(linkDetails);\n\n\t\t\tif (fileType === 'image') {\n\t\t\t\tctrl.fire('change', {meta: {alt: title, attach: linkDetails.attach}});\n\t\t\t} else {\n\t\t\t\tctrl.fire('change', {meta: {text: title, attach: linkDetails.attach}});\n\t\t\t}\n\n\t\t\tctrl.focus();\n\t\t});\n\n\t\tctrl.on('click', function (e) {\n\t\t\tif (ctrl.value().length === 0 && e.target.nodeName === 'INPUT') {\n\t\t\t\tautocomplete('');\n\t\t\t}\n\t\t});\n\n\t\tctrl.on('PostRender', function () {\n\t\t\tctrl.getRoot().on('submit', function (e) {\n\t\t\t\tif (!e.isDefaultPrevented()) {\n\t\t\t\t\taddToHistory(ctrl.value(), fileType);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t};\n\n\tvar statusToUiState = function (result) {\n\t\tvar status = result.status, message = result.message;\n\n\t\tif (status === 'valid') {\n\t\t\treturn {status: 'ok', message: message};\n\t\t} else if (status === 'unknown') {\n\t\t\treturn {status: 'warn', message: message};\n\t\t} else if (status === 'invalid') {\n\t\t\treturn {status: 'warn', message: message};\n\t\t} else {\n\t\t\treturn {status: 'none', message: ''};\n\t\t}\n\t};\n\n\tvar setupLinkValidatorHandler = function (ctrl, editorSettings, fileType) {\n\t\tvar validatorHandler = editorSettings.filepicker_validator_handler;\n\t\tif (validatorHandler) {\n\t\t\tvar validateUrl = function (url) {\n\t\t\t\tif (url.length === 0) {\n\t\t\t\t\tctrl.statusLevel('none');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvalidatorHandler({\n\t\t\t\t\turl: url,\n\t\t\t\t\ttype: fileType\n\t\t\t\t}, function (result) {\n\t\t\t\t\tvar uiState = statusToUiState(result);\n\n\t\t\t\t\tctrl.statusMessage(uiState.message);\n\t\t\t\t\tctrl.statusLevel(uiState.status);\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tctrl.state.on('change:value', function (e) {\n\t\t\t\tvalidateUrl(e.value);\n\t\t\t});\n\t\t}\n\t};\n\n\treturn ComboBox.extend({\n\t\t/**\n\t\t * Constructs a new control instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this, editor = tinymce.activeEditor, editorSettings = editor.settings;\n\t\t\tvar actionCallback, fileBrowserCallback, fileBrowserCallbackTypes;\n\t\t\tvar fileType = settings.filetype;\n\n\t\t\tsettings.spellcheck = false;\n\n\t\t\tfileBrowserCallbackTypes = editorSettings.file_picker_types || editorSettings.file_browser_callback_types;\n\t\t\tif (fileBrowserCallbackTypes) {\n\t\t\t\tfileBrowserCallbackTypes = Tools.makeMap(fileBrowserCallbackTypes, /[, ]/);\n\t\t\t}\n\n\t\t\tif (!fileBrowserCallbackTypes || fileBrowserCallbackTypes[fileType]) {\n\t\t\t\tfileBrowserCallback = editorSettings.file_picker_callback;\n\t\t\t\tif (fileBrowserCallback && (!fileBrowserCallbackTypes || fileBrowserCallbackTypes[fileType])) {\n\t\t\t\t\tactionCallback = function() {\n\t\t\t\t\t\tvar meta = self.fire('beforecall').meta;\n\n\t\t\t\t\t\tmeta = Tools.extend({filetype: fileType}, meta);\n\n\t\t\t\t\t\t// file_picker_callback(callback, currentValue, metaData)\n\t\t\t\t\t\tfileBrowserCallback.call(\n\t\t\t\t\t\t\teditor,\n\t\t\t\t\t\t\tfunction(value, meta) {\n\t\t\t\t\t\t\t\tself.value(value).fire('change', {meta: meta});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tself.value(),\n\t\t\t\t\t\t\tmeta\n\t\t\t\t\t\t);\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\t// Legacy callback: file_picker_callback(id, currentValue, filetype, window)\n\t\t\t\t\tfileBrowserCallback = editorSettings.file_browser_callback;\n\t\t\t\t\tif (fileBrowserCallback && (!fileBrowserCallbackTypes || fileBrowserCallbackTypes[fileType])) {\n\t\t\t\t\t\tactionCallback = function() {\n\t\t\t\t\t\t\tfileBrowserCallback(\n\t\t\t\t\t\t\t\tself.getEl('inp').id,\n\t\t\t\t\t\t\t\tself.value(),\n\t\t\t\t\t\t\t\tfileType,\n\t\t\t\t\t\t\t\twindow\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (actionCallback) {\n\t\t\t\tsettings.icon = 'browse';\n\t\t\t\tsettings.onaction = actionCallback;\n\t\t\t}\n\n\t\t\tself._super(settings);\n\n\t\t\tsetupAutoCompleteHandler(self, editorSettings, editor.getBody(), fileType);\n\t\t\tsetupLinkValidatorHandler(self, editorSettings, fileType);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/FitLayout.js\n\n/**\n * FitLayout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This layout manager will resize the control to be the size of it's parent container.\n * In other words width: 100% and height: 100%.\n *\n * @-x-less FitLayout.less\n * @class tinymce.ui.FitLayout\n * @extends tinymce.ui.AbsoluteLayout\n */\ndefine(\"tinymce/ui/FitLayout\", [\n\t\"tinymce/ui/AbsoluteLayout\"\n], function(AbsoluteLayout) {\n\t\"use strict\";\n\n\treturn AbsoluteLayout.extend({\n\t\t/**\n\t\t * Recalculates the positions of the controls in the specified container.\n\t\t *\n\t\t * @method recalc\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\n\t\t */\n\t\trecalc: function(container) {\n\t\t\tvar contLayoutRect = container.layoutRect(), paddingBox = container.paddingBox;\n\n\t\t\tcontainer.items().filter(':visible').each(function(ctrl) {\n\t\t\t\tctrl.layoutRect({\n\t\t\t\t\tx: paddingBox.left,\n\t\t\t\t\ty: paddingBox.top,\n\t\t\t\t\tw: contLayoutRect.innerW - paddingBox.right - paddingBox.left,\n\t\t\t\t\th: contLayoutRect.innerH - paddingBox.top - paddingBox.bottom\n\t\t\t\t});\n\n\t\t\t\tif (ctrl.recalc) {\n\t\t\t\t\tctrl.recalc();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/FlexLayout.js\n\n/**\n * FlexLayout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This layout manager works similar to the CSS flex box.\n *\n * @setting {String} direction row|row-reverse|column|column-reverse\n * @setting {Number} flex A positive-number to flex by.\n * @setting {String} align start|end|center|stretch\n * @setting {String} pack start|end|justify\n *\n * @class tinymce.ui.FlexLayout\n * @extends tinymce.ui.AbsoluteLayout\n */\ndefine(\"tinymce/ui/FlexLayout\", [\n\t\"tinymce/ui/AbsoluteLayout\"\n], function(AbsoluteLayout) {\n\t\"use strict\";\n\n\treturn AbsoluteLayout.extend({\n\t\t/**\n\t\t * Recalculates the positions of the controls in the specified container.\n\t\t *\n\t\t * @method recalc\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\n\t\t */\n\t\trecalc: function(container) {\n\t\t\t// A ton of variables, needs to be in the same scope for performance\n\t\t\tvar i, l, items, contLayoutRect, contPaddingBox, contSettings, align, pack, spacing, totalFlex, availableSpace, direction;\n\t\t\tvar ctrl, ctrlLayoutRect, ctrlSettings, flex, maxSizeItems = [], size, maxSize, ratio, rect, pos, maxAlignEndPos;\n\t\t\tvar sizeName, minSizeName, posName, maxSizeName, beforeName, innerSizeName, deltaSizeName, contentSizeName;\n\t\t\tvar alignAxisName, alignInnerSizeName, alignSizeName, alignMinSizeName, alignBeforeName, alignAfterName;\n\t\t\tvar alignDeltaSizeName, alignContentSizeName;\n\t\t\tvar max = Math.max, min = Math.min;\n\n\t\t\t// Get container items, properties and settings\n\t\t\titems = container.items().filter(':visible');\n\t\t\tcontLayoutRect = container.layoutRect();\n\t\t\tcontPaddingBox = container.paddingBox;\n\t\t\tcontSettings = container.settings;\n\t\t\tdirection = container.isRtl() ? (contSettings.direction || 'row-reversed') : contSettings.direction;\n\t\t\talign = contSettings.align;\n\t\t\tpack = container.isRtl() ? (contSettings.pack || 'end') : contSettings.pack;\n\t\t\tspacing = contSettings.spacing || 0;\n\n\t\t\tif (direction == \"row-reversed\" || direction == \"column-reverse\") {\n\t\t\t\titems = items.set(items.toArray().reverse());\n\t\t\t\tdirection = direction.split('-')[0];\n\t\t\t}\n\n\t\t\t// Setup axis variable name for row/column direction since the calculations is the same\n\t\t\tif (direction == \"column\") {\n\t\t\t\tposName = \"y\";\n\t\t\t\tsizeName = \"h\";\n\t\t\t\tminSizeName = \"minH\";\n\t\t\t\tmaxSizeName = \"maxH\";\n\t\t\t\tinnerSizeName = \"innerH\";\n\t\t\t\tbeforeName = 'top';\n\t\t\t\tdeltaSizeName = \"deltaH\";\n\t\t\t\tcontentSizeName = \"contentH\";\n\n\t\t\t\talignBeforeName = \"left\";\n\t\t\t\talignSizeName = \"w\";\n\t\t\t\talignAxisName = \"x\";\n\t\t\t\talignInnerSizeName = \"innerW\";\n\t\t\t\talignMinSizeName = \"minW\";\n\t\t\t\talignAfterName = \"right\";\n\t\t\t\talignDeltaSizeName = \"deltaW\";\n\t\t\t\talignContentSizeName = \"contentW\";\n\t\t\t} else {\n\t\t\t\tposName = \"x\";\n\t\t\t\tsizeName = \"w\";\n\t\t\t\tminSizeName = \"minW\";\n\t\t\t\tmaxSizeName = \"maxW\";\n\t\t\t\tinnerSizeName = \"innerW\";\n\t\t\t\tbeforeName = 'left';\n\t\t\t\tdeltaSizeName = \"deltaW\";\n\t\t\t\tcontentSizeName = \"contentW\";\n\n\t\t\t\talignBeforeName = \"top\";\n\t\t\t\talignSizeName = \"h\";\n\t\t\t\talignAxisName = \"y\";\n\t\t\t\talignInnerSizeName = \"innerH\";\n\t\t\t\talignMinSizeName = \"minH\";\n\t\t\t\talignAfterName = \"bottom\";\n\t\t\t\talignDeltaSizeName = \"deltaH\";\n\t\t\t\talignContentSizeName = \"contentH\";\n\t\t\t}\n\n\t\t\t// Figure out total flex, availableSpace and collect any max size elements\n\t\t\tavailableSpace = contLayoutRect[innerSizeName] - contPaddingBox[beforeName] - contPaddingBox[beforeName];\n\t\t\tmaxAlignEndPos = totalFlex = 0;\n\t\t\tfor (i = 0, l = items.length; i < l; i++) {\n\t\t\t\tctrl = items[i];\n\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\n\t\t\t\tctrlSettings = ctrl.settings;\n\t\t\t\tflex = ctrlSettings.flex;\n\t\t\t\tavailableSpace -= (i < l - 1 ? spacing : 0);\n\n\t\t\t\tif (flex > 0) {\n\t\t\t\t\ttotalFlex += flex;\n\n\t\t\t\t\t// Flexed item has a max size then we need to check if we will hit that size\n\t\t\t\t\tif (ctrlLayoutRect[maxSizeName]) {\n\t\t\t\t\t\tmaxSizeItems.push(ctrl);\n\t\t\t\t\t}\n\n\t\t\t\t\tctrlLayoutRect.flex = flex;\n\t\t\t\t}\n\n\t\t\t\tavailableSpace -= ctrlLayoutRect[minSizeName];\n\n\t\t\t\t// Calculate the align end position to be used to check for overflow/underflow\n\t\t\t\tsize = contPaddingBox[alignBeforeName] + ctrlLayoutRect[alignMinSizeName] + contPaddingBox[alignAfterName];\n\t\t\t\tif (size > maxAlignEndPos) {\n\t\t\t\t\tmaxAlignEndPos = size;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Calculate minW/minH\n\t\t\trect = {};\n\t\t\tif (availableSpace < 0) {\n\t\t\t\trect[minSizeName] = contLayoutRect[minSizeName] - availableSpace + contLayoutRect[deltaSizeName];\n\t\t\t} else {\n\t\t\t\trect[minSizeName] = contLayoutRect[innerSizeName] - availableSpace + contLayoutRect[deltaSizeName];\n\t\t\t}\n\n\t\t\trect[alignMinSizeName] = maxAlignEndPos + contLayoutRect[alignDeltaSizeName];\n\n\t\t\trect[contentSizeName] = contLayoutRect[innerSizeName] - availableSpace;\n\t\t\trect[alignContentSizeName] = maxAlignEndPos;\n\t\t\trect.minW = min(rect.minW, contLayoutRect.maxW);\n\t\t\trect.minH = min(rect.minH, contLayoutRect.maxH);\n\t\t\trect.minW = max(rect.minW, contLayoutRect.startMinWidth);\n\t\t\trect.minH = max(rect.minH, contLayoutRect.startMinHeight);\n\n\t\t\t// Resize container container if minSize was changed\n\t\t\tif (contLayoutRect.autoResize && (rect.minW != contLayoutRect.minW || rect.minH != contLayoutRect.minH)) {\n\t\t\t\trect.w = rect.minW;\n\t\t\t\trect.h = rect.minH;\n\n\t\t\t\tcontainer.layoutRect(rect);\n\t\t\t\tthis.recalc(container);\n\n\t\t\t\t// Forced recalc for example if items are hidden/shown\n\t\t\t\tif (container._lastRect === null) {\n\t\t\t\t\tvar parentCtrl = container.parent();\n\t\t\t\t\tif (parentCtrl) {\n\t\t\t\t\t\tparentCtrl._lastRect = null;\n\t\t\t\t\t\tparentCtrl.recalc();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Handle max size elements, check if they will become to wide with current options\n\t\t\tratio = availableSpace / totalFlex;\n\t\t\tfor (i = 0, l = maxSizeItems.length; i < l; i++) {\n\t\t\t\tctrl = maxSizeItems[i];\n\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\n\t\t\t\tmaxSize = ctrlLayoutRect[maxSizeName];\n\t\t\t\tsize = ctrlLayoutRect[minSizeName] + ctrlLayoutRect.flex * ratio;\n\n\t\t\t\tif (size > maxSize) {\n\t\t\t\t\tavailableSpace -= (ctrlLayoutRect[maxSizeName] - ctrlLayoutRect[minSizeName]);\n\t\t\t\t\ttotalFlex -= ctrlLayoutRect.flex;\n\t\t\t\t\tctrlLayoutRect.flex = 0;\n\t\t\t\t\tctrlLayoutRect.maxFlexSize = maxSize;\n\t\t\t\t} else {\n\t\t\t\t\tctrlLayoutRect.maxFlexSize = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Setup new ratio, target layout rect, start position\n\t\t\tratio = availableSpace / totalFlex;\n\t\t\tpos = contPaddingBox[beforeName];\n\t\t\trect = {};\n\n\t\t\t// Handle pack setting moves the start position to end, center\n\t\t\tif (totalFlex === 0) {\n\t\t\t\tif (pack == \"end\") {\n\t\t\t\t\tpos = availableSpace + contPaddingBox[beforeName];\n\t\t\t\t} else if (pack == \"center\") {\n\t\t\t\t\tpos = Math.round(\n\t\t\t\t\t\t(contLayoutRect[innerSizeName] / 2) - ((contLayoutRect[innerSizeName] - availableSpace) / 2)\n\t\t\t\t\t) + contPaddingBox[beforeName];\n\n\t\t\t\t\tif (pos < 0) {\n\t\t\t\t\t\tpos = contPaddingBox[beforeName];\n\t\t\t\t\t}\n\t\t\t\t} else if (pack == \"justify\") {\n\t\t\t\t\tpos = contPaddingBox[beforeName];\n\t\t\t\t\tspacing = Math.floor(availableSpace / (items.length - 1));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Default aligning (start) the other ones needs to be calculated while doing the layout\n\t\t\trect[alignAxisName] = contPaddingBox[alignBeforeName];\n\n\t\t\t// Start laying out controls\n\t\t\tfor (i = 0, l = items.length; i < l; i++) {\n\t\t\t\tctrl = items[i];\n\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\n\t\t\t\tsize = ctrlLayoutRect.maxFlexSize || ctrlLayoutRect[minSizeName];\n\n\t\t\t\t// Align the control on the other axis\n\t\t\t\tif (align === \"center\") {\n\t\t\t\t\trect[alignAxisName] = Math.round((contLayoutRect[alignInnerSizeName] / 2) - (ctrlLayoutRect[alignSizeName] / 2));\n\t\t\t\t} else if (align === \"stretch\") {\n\t\t\t\t\trect[alignSizeName] = max(\n\t\t\t\t\t\tctrlLayoutRect[alignMinSizeName] || 0,\n\t\t\t\t\t\tcontLayoutRect[alignInnerSizeName] - contPaddingBox[alignBeforeName] - contPaddingBox[alignAfterName]\n\t\t\t\t\t);\n\t\t\t\t\trect[alignAxisName] = contPaddingBox[alignBeforeName];\n\t\t\t\t} else if (align === \"end\") {\n\t\t\t\t\trect[alignAxisName] = contLayoutRect[alignInnerSizeName] - ctrlLayoutRect[alignSizeName] - contPaddingBox.top;\n\t\t\t\t}\n\n\t\t\t\t// Calculate new size based on flex\n\t\t\t\tif (ctrlLayoutRect.flex > 0) {\n\t\t\t\t\tsize += ctrlLayoutRect.flex * ratio;\n\t\t\t\t}\n\n\t\t\t\trect[sizeName] = size;\n\t\t\t\trect[posName] = pos;\n\t\t\t\tctrl.layoutRect(rect);\n\n\t\t\t\t// Recalculate containers\n\t\t\t\tif (ctrl.recalc) {\n\t\t\t\t\tctrl.recalc();\n\t\t\t\t}\n\n\t\t\t\t// Move x/y position\n\t\t\t\tpos += size + spacing;\n\t\t\t}\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/FlowLayout.js\n\n/**\n * FlowLayout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This layout manager will place the controls by using the browsers native layout.\n *\n * @-x-less FlowLayout.less\n * @class tinymce.ui.FlowLayout\n * @extends tinymce.ui.Layout\n */\ndefine(\"tinymce/ui/FlowLayout\", [\n\t\"tinymce/ui/Layout\"\n], function(Layout) {\n\treturn Layout.extend({\n\t\tDefaults: {\n\t\t\tcontainerClass: 'flow-layout',\n\t\t\tcontrolClass: 'flow-layout-item',\n\t\t\tendClass: 'break'\n\t\t},\n\n\t\t/**\n\t\t * Recalculates the positions of the controls in the specified container.\n\t\t *\n\t\t * @method recalc\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\n\t\t */\n\t\trecalc: function(container) {\n\t\t\tcontainer.items().filter(':visible').each(function(ctrl) {\n\t\t\t\tif (ctrl.recalc) {\n\t\t\t\t\tctrl.recalc();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tisNative: function() {\n\t\t\treturn true;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/fmt/FontInfo.js\n\n/**\n * FontInfo.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Internal class for computing font size for elements.\n *\n * @private\n * @class tinymce.fmt.FontInfo\n */\ndefine(\"tinymce/fmt/FontInfo\", [\n\t\"tinymce/dom/DOMUtils\"\n], function(DOMUtils) {\n\tvar getSpecifiedFontProp = function (propName, rootElm, elm) {\n\t\twhile (elm !== rootElm) {\n\t\t\tif (elm.style[propName]) {\n\t\t\t\treturn elm.style[propName];\n\t\t\t}\n\n\t\t\telm = elm.parentNode;\n\t\t}\n\n\t\treturn '';\n\t};\n\n\tvar toPt = function (fontSize) {\n\t\tif (/[0-9.]+px$/.test(fontSize)) {\n\t\t\treturn Math.round(parseInt(fontSize, 10) * 72 / 96) + 'pt';\n\t\t}\n\n\t\treturn fontSize;\n\t};\n\n\tvar normalizeFontFamily = function (fontFamily) {\n\t\t// 'Font name', Font -> Font name,Font\n\t\treturn fontFamily.replace(/[\\'\\\"]/g, '').replace(/,\\s+/g, ',');\n\t};\n\n\tvar getComputedFontProp = function (propName, elm) {\n\t\treturn DOMUtils.DOM.getStyle(elm, propName, true);\n\t};\n\n\tvar getFontSize = function (rootElm, elm) {\n\t\tvar specifiedFontSize = getSpecifiedFontProp('fontSize', rootElm, elm);\n\t\treturn specifiedFontSize !== '' ? specifiedFontSize : getComputedFontProp('fontSize', elm);\n\t};\n\n\tvar getFontFamily = function (rootElm, elm) {\n\t\tvar specifiedFontSize = getSpecifiedFontProp('fontFamily', rootElm, elm);\n\t\tvar fontValue = specifiedFontSize !== '' ? specifiedFontSize : getComputedFontProp('fontFamily', elm);\n\n\t\treturn fontValue !== undefined ? normalizeFontFamily(fontValue) : '';\n\t};\n\n\treturn {\n\t\tgetFontSize: getFontSize,\n\t\tgetFontFamily: getFontFamily,\n\t\ttoPt: toPt\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/FormatControls.js\n\n/**\n * FormatControls.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Internal class containing all TinyMCE specific control types such as\n * format listboxes, fontlist boxes, toolbar buttons etc.\n *\n * @class tinymce.ui.FormatControls\n */\ndefine(\"tinymce/ui/FormatControls\", [\n\t\"tinymce/ui/Control\",\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/FloatPanel\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/EditorManager\",\n\t\"tinymce/Env\",\n\t\"tinymce/fmt/FontInfo\"\n], function(Control, Widget, FloatPanel, Tools, Arr, DOMUtils, EditorManager, Env, FontInfo) {\n\tvar each = Tools.each;\n\n\tvar flatten = function (ar) {\n\t\treturn Arr.reduce(ar, function (result, item) {\n\t\t\treturn result.concat(item);\n\t\t}, []);\n\t};\n\n\tEditorManager.on('AddEditor', function(e) {\n\t\tvar editor = e.editor;\n\n\t\tsetupRtlMode(editor);\n\t\tregisterControls(editor);\n\t\tsetupContainer(editor);\n\t});\n\n\tControl.translate = function(text) {\n\t\treturn EditorManager.translate(text);\n\t};\n\n\tWidget.tooltips = !Env.iOS;\n\n\tfunction setupContainer(editor) {\n\t\tif (editor.settings.ui_container) {\n\t\t\tEnv.container = DOMUtils.DOM.select(editor.settings.ui_container)[0];\n\t\t}\n\t}\n\n\tfunction setupRtlMode(editor) {\n\t\teditor.on('ScriptsLoaded', function () {\n\t\t\tif (editor.rtl) {\n\t\t\t\tControl.rtl = true;\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction registerControls(editor) {\n\t\tvar formatMenu;\n\n\t\tfunction createListBoxChangeHandler(items, formatName) {\n\t\t\treturn function() {\n\t\t\t\tvar self = this;\n\n\t\t\t\teditor.on('nodeChange', function(e) {\n\t\t\t\t\tvar formatter = editor.formatter;\n\t\t\t\t\tvar value = null;\n\n\t\t\t\t\teach(e.parents, function(node) {\n\t\t\t\t\t\teach(items, function(item) {\n\t\t\t\t\t\t\tif (formatName) {\n\t\t\t\t\t\t\t\tif (formatter.matchNode(node, formatName, {value: item.value})) {\n\t\t\t\t\t\t\t\t\tvalue = item.value;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (formatter.matchNode(node, item.value)) {\n\t\t\t\t\t\t\t\t\tvalue = item.value;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tself.value(value);\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\n\t\tfunction createFontNameListBoxChangeHandler(items) {\n\t\t\treturn function() {\n\t\t\t\tvar self = this;\n\n\t\t\t\tvar getFirstFont = function (fontFamily) {\n\t\t\t\t\treturn fontFamily ? fontFamily.split(',')[0] : '';\n\t\t\t\t};\n\n\t\t\t\teditor.on('nodeChange', function(e) {\n\t\t\t\t\tvar fontFamily, value = null;\n\n\t\t\t\t\tfontFamily = FontInfo.getFontFamily(editor.getBody(), e.element);\n\n\t\t\t\t\teach(items, function(item) {\n\t\t\t\t\t\tif (item.value.toLowerCase() === fontFamily.toLowerCase()) {\n\t\t\t\t\t\t\tvalue = item.value;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\teach(items, function(item) {\n\t\t\t\t\t\tif (!value && getFirstFont(item.value).toLowerCase() === getFirstFont(fontFamily).toLowerCase()) {\n\t\t\t\t\t\t\tvalue = item.value;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tself.value(value);\n\n\t\t\t\t\tif (!value && fontFamily) {\n\t\t\t\t\t\tself.text(getFirstFont(fontFamily));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\n\t\tfunction createFontSizeListBoxChangeHandler(items) {\n\t\t\treturn function() {\n\t\t\t\tvar self = this;\n\n\t\t\t\teditor.on('nodeChange', function(e) {\n\t\t\t\t\tvar px, pt, value = null;\n\n\t\t\t\t\tpx = FontInfo.getFontSize(editor.getBody(), e.element);\n\t\t\t\t\tpt = FontInfo.toPt(px);\n\n\t\t\t\t\teach(items, function(item) {\n\t\t\t\t\t\tif (item.value === px) {\n\t\t\t\t\t\t\tvalue = px;\n\t\t\t\t\t\t} else if (item.value === pt) {\n\t\t\t\t\t\t\tvalue = pt;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tself.value(value);\n\n\t\t\t\t\tif (!value) {\n\t\t\t\t\t\tself.text(pt);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\n\t\tfunction createFormats(formats) {\n\t\t\tformats = formats.replace(/;$/, '').split(';');\n\n\t\t\tvar i = formats.length;\n\t\t\twhile (i--) {\n\t\t\t\tformats[i] = formats[i].split('=');\n\t\t\t}\n\n\t\t\treturn formats;\n\t\t}\n\n\t\tfunction createFormatMenu() {\n\t\t\tvar count = 0, newFormats = [];\n\n\t\t\tvar defaultStyleFormats = [\n\t\t\t\t{title: 'Headings', items: [\n\t\t\t\t\t{title: 'Heading 1', format: 'h1'},\n\t\t\t\t\t{title: 'Heading 2', format: 'h2'},\n\t\t\t\t\t{title: 'Heading 3', format: 'h3'},\n\t\t\t\t\t{title: 'Heading 4', format: 'h4'},\n\t\t\t\t\t{title: 'Heading 5', format: 'h5'},\n\t\t\t\t\t{title: 'Heading 6', format: 'h6'}\n\t\t\t\t]},\n\n\t\t\t\t{title: 'Inline', items: [\n\t\t\t\t\t{title: 'Bold', icon: 'bold', format: 'bold'},\n\t\t\t\t\t{title: 'Italic', icon: 'italic', format: 'italic'},\n\t\t\t\t\t{title: 'Underline', icon: 'underline', format: 'underline'},\n\t\t\t\t\t{title: 'Strikethrough', icon: 'strikethrough', format: 'strikethrough'},\n\t\t\t\t\t{title: 'Superscript', icon: 'superscript', format: 'superscript'},\n\t\t\t\t\t{title: 'Subscript', icon: 'subscript', format: 'subscript'},\n\t\t\t\t\t{title: 'Code', icon: 'code', format: 'code'}\n\t\t\t\t]},\n\n\t\t\t\t{title: 'Blocks', items: [\n\t\t\t\t\t{title: 'Paragraph', format: 'p'},\n\t\t\t\t\t{title: 'Blockquote', format: 'blockquote'},\n\t\t\t\t\t{title: 'Div', format: 'div'},\n\t\t\t\t\t{title: 'Pre', format: 'pre'}\n\t\t\t\t]},\n\n\t\t\t\t{title: 'Alignment', items: [\n\t\t\t\t\t{title: 'Left', icon: 'alignleft', format: 'alignleft'},\n\t\t\t\t\t{title: 'Center', icon: 'aligncenter', format: 'aligncenter'},\n\t\t\t\t\t{title: 'Right', icon: 'alignright', format: 'alignright'},\n\t\t\t\t\t{title: 'Justify', icon: 'alignjustify', format: 'alignjustify'}\n\t\t\t\t]}\n\t\t\t];\n\n\t\t\tfunction createMenu(formats) {\n\t\t\t\tvar menu = [];\n\n\t\t\t\tif (!formats) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\teach(formats, function(format) {\n\t\t\t\t\tvar menuItem = {\n\t\t\t\t\t\ttext: format.title,\n\t\t\t\t\t\ticon: format.icon\n\t\t\t\t\t};\n\n\t\t\t\t\tif (format.items) {\n\t\t\t\t\t\tmenuItem.menu = createMenu(format.items);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar formatName = format.format || \"custom\" + count++;\n\n\t\t\t\t\t\tif (!format.format) {\n\t\t\t\t\t\t\tformat.name = formatName;\n\t\t\t\t\t\t\tnewFormats.push(format);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmenuItem.format = formatName;\n\t\t\t\t\t\tmenuItem.cmd = format.cmd;\n\t\t\t\t\t}\n\n\t\t\t\t\tmenu.push(menuItem);\n\t\t\t\t});\n\n\t\t\t\treturn menu;\n\t\t\t}\n\n\t\t\tfunction createStylesMenu() {\n\t\t\t\tvar menu;\n\n\t\t\t\tif (editor.settings.style_formats_merge) {\n\t\t\t\t\tif (editor.settings.style_formats) {\n\t\t\t\t\t\tmenu = createMenu(defaultStyleFormats.concat(editor.settings.style_formats));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmenu = createMenu(defaultStyleFormats);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tmenu = createMenu(editor.settings.style_formats || defaultStyleFormats);\n\t\t\t\t}\n\n\t\t\t\treturn menu;\n\t\t\t}\n\n\t\t\teditor.on('init', function() {\n\t\t\t\teach(newFormats, function(format) {\n\t\t\t\t\teditor.formatter.register(format.name, format);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\ttype: 'menu',\n\t\t\t\titems: createStylesMenu(),\n\t\t\t\tonPostRender: function(e) {\n\t\t\t\t\teditor.fire('renderFormatsMenu', {control: e.control});\n\t\t\t\t},\n\t\t\t\titemDefaults: {\n\t\t\t\t\tpreview: true,\n\n\t\t\t\t\ttextStyle: function() {\n\t\t\t\t\t\tif (this.settings.format) {\n\t\t\t\t\t\t\treturn editor.formatter.getCssText(this.settings.format);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tonPostRender: function() {\n\t\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t\tself.parent().on('show', function() {\n\t\t\t\t\t\t\tvar formatName, command;\n\n\t\t\t\t\t\t\tformatName = self.settings.format;\n\t\t\t\t\t\t\tif (formatName) {\n\t\t\t\t\t\t\t\tself.disabled(!editor.formatter.canApply(formatName));\n\t\t\t\t\t\t\t\tself.active(editor.formatter.match(formatName));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcommand = self.settings.cmd;\n\t\t\t\t\t\t\tif (command) {\n\t\t\t\t\t\t\t\tself.active(editor.queryCommandState(command));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\n\t\t\t\t\tonclick: function() {\n\t\t\t\t\t\tif (this.settings.format) {\n\t\t\t\t\t\t\ttoggleFormat(this.settings.format);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.settings.cmd) {\n\t\t\t\t\t\t\teditor.execCommand(this.settings.cmd);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tformatMenu = createFormatMenu();\n\n\t\tfunction initOnPostRender(name) {\n\t\t\treturn function() {\n\t\t\t\tvar self = this;\n\n\t\t\t\t// TODO: Fix this\n\t\t\t\tif (editor.formatter) {\n\t\t\t\t\teditor.formatter.formatChanged(name, function(state) {\n\t\t\t\t\t\tself.active(state);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\teditor.on('init', function() {\n\t\t\t\t\t\teditor.formatter.formatChanged(name, function(state) {\n\t\t\t\t\t\t\tself.active(state);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\t// Simple format controls <control/format>:<UI text>\n\t\teach({\n\t\t\tbold: 'Bold',\n\t\t\titalic: 'Italic',\n\t\t\tunderline: 'Underline',\n\t\t\tstrikethrough: 'Strikethrough',\n\t\t\tsubscript: 'Subscript',\n\t\t\tsuperscript: 'Superscript'\n\t\t}, function(text, name) {\n\t\t\teditor.addButton(name, {\n\t\t\t\ttooltip: text,\n\t\t\t\tonPostRender: initOnPostRender(name),\n\t\t\t\tonclick: function() {\n\t\t\t\t\ttoggleFormat(name);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// Simple command controls <control>:[<UI text>,<Command>]\n\t\teach({\n\t\t\toutdent: ['Decrease indent', 'Outdent'],\n\t\t\tindent: ['Increase indent', 'Indent'],\n\t\t\tcut: ['Cut', 'Cut'],\n\t\t\tcopy: ['Copy', 'Copy'],\n\t\t\tpaste: ['Paste', 'Paste'],\n\t\t\thelp: ['Help', 'mceHelp'],\n\t\t\tselectall: ['Select all', 'SelectAll'],\n\t\t\tremoveformat: ['Clear formatting', 'RemoveFormat'],\n\t\t\tvisualaid: ['Visual aids', 'mceToggleVisualAid'],\n\t\t\tnewdocument: ['New document', 'mceNewDocument']\n\t\t}, function(item, name) {\n\t\t\teditor.addButton(name, {\n\t\t\t\ttooltip: item[0],\n\t\t\t\tcmd: item[1]\n\t\t\t});\n\t\t});\n\n\t\t// Simple command controls with format state\n\t\teach({\n\t\t\tblockquote: ['Blockquote', 'mceBlockQuote'],\n\t\t\tsubscript: ['Subscript', 'Subscript'],\n\t\t\tsuperscript: ['Superscript', 'Superscript'],\n\t\t\talignleft: ['Align left', 'JustifyLeft'],\n\t\t\taligncenter: ['Align center', 'JustifyCenter'],\n\t\t\talignright: ['Align right', 'JustifyRight'],\n\t\t\talignjustify: ['Justify', 'JustifyFull'],\n\t\t\talignnone: ['No alignment', 'JustifyNone']\n\t\t}, function(item, name) {\n\t\t\teditor.addButton(name, {\n\t\t\t\ttooltip: item[0],\n\t\t\t\tcmd: item[1],\n\t\t\t\tonPostRender: initOnPostRender(name)\n\t\t\t});\n\t\t});\n\n\t\tfunction toggleUndoRedoState(type) {\n\t\t\treturn function() {\n\t\t\t\tvar self = this;\n\n\t\t\t\tfunction checkState() {\n\t\t\t\t\tvar typeFn = type == 'redo' ? 'hasRedo' : 'hasUndo';\n\t\t\t\t\treturn editor.undoManager ? editor.undoManager[typeFn]() : false;\n\t\t\t\t}\n\n\t\t\t\tself.disabled(!checkState());\n\t\t\t\teditor.on('Undo Redo AddUndo TypingUndo ClearUndos SwitchMode', function() {\n\t\t\t\t\tself.disabled(editor.readonly || !checkState());\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\n\t\tfunction toggleVisualAidState() {\n\t\t\tvar self = this;\n\n\t\t\teditor.on('VisualAid', function(e) {\n\t\t\t\tself.active(e.hasVisual);\n\t\t\t});\n\n\t\t\tself.active(editor.hasVisual);\n\t\t}\n\n\t\tvar trimMenuItems = function (menuItems) {\n\t\t\tvar outputMenuItems = menuItems;\n\n\t\t\tif (outputMenuItems.length > 0 && outputMenuItems[0].text === '-') {\n\t\t\t\toutputMenuItems = outputMenuItems.slice(1);\n\t\t\t}\n\n\t\t\tif (outputMenuItems.length > 0 && outputMenuItems[outputMenuItems.length - 1].text === '-') {\n\t\t\t\toutputMenuItems = outputMenuItems.slice(0, outputMenuItems.length - 1);\n\t\t\t}\n\n\t\t\treturn outputMenuItems;\n\t\t};\n\n\t\tvar createCustomMenuItems = function (names) {\n\t\t\tvar items, nameList;\n\n\t\t\tif (typeof names === 'string') {\n\t\t\t\tnameList = names.split(' ');\n\t\t\t} else if (Tools.isArray(names)) {\n\t\t\t\treturn flatten(Tools.map(names, createCustomMenuItems));\n\t\t\t}\n\n\t\t\titems = Tools.grep(nameList, function (name) {\n\t\t\t\treturn name === '|' || name in editor.menuItems;\n\t\t\t});\n\n\t\t\treturn Tools.map(items, function (name) {\n\t\t\t\treturn name === '|' ? {text: '-'} : editor.menuItems[name];\n\t\t\t});\n\t\t};\n\n\t\tvar createContextMenuItems = function (context) {\n\t\t\tvar outputMenuItems = [{text: '-'}];\n\t\t\tvar menuItems = Tools.grep(editor.menuItems, function (menuItem) {\n\t\t\t\treturn menuItem.context === context;\n\t\t\t});\n\n\t\t\tTools.each(menuItems, function (menuItem) {\n\t\t\t\tif (menuItem.separator == 'before') {\n\t\t\t\t\toutputMenuItems.push({text: '|'});\n\t\t\t\t}\n\n\t\t\t\tif (menuItem.prependToContext) {\n\t\t\t\t\toutputMenuItems.unshift(menuItem);\n\t\t\t\t} else {\n\t\t\t\t\toutputMenuItems.push(menuItem);\n\t\t\t\t}\n\n\t\t\t\tif (menuItem.separator == 'after') {\n\t\t\t\t\toutputMenuItems.push({text: '|'});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn outputMenuItems;\n\t\t};\n\n\t\tvar createInsertMenu = function (editorSettings) {\n\t\t\tif (editorSettings.insert_button_items) {\n\t\t\t\treturn trimMenuItems(createCustomMenuItems(editorSettings.insert_button_items));\n\t\t\t} else {\n\t\t\t\treturn trimMenuItems(createContextMenuItems('insert'));\n\t\t\t}\n\t\t};\n\n\t\teditor.addButton('undo', {\n\t\t\ttooltip: 'Undo',\n\t\t\tonPostRender: toggleUndoRedoState('undo'),\n\t\t\tcmd: 'undo'\n\t\t});\n\n\t\teditor.addButton('redo', {\n\t\t\ttooltip: 'Redo',\n\t\t\tonPostRender: toggleUndoRedoState('redo'),\n\t\t\tcmd: 'redo'\n\t\t});\n\n\t\teditor.addMenuItem('newdocument', {\n\t\t\ttext: 'New document',\n\t\t\ticon: 'newdocument',\n\t\t\tcmd: 'mceNewDocument'\n\t\t});\n\n\t\teditor.addMenuItem('undo', {\n\t\t\ttext: 'Undo',\n\t\t\ticon: 'undo',\n\t\t\tshortcut: 'Meta+Z',\n\t\t\tonPostRender: toggleUndoRedoState('undo'),\n\t\t\tcmd: 'undo'\n\t\t});\n\n\t\teditor.addMenuItem('redo', {\n\t\t\ttext: 'Redo',\n\t\t\ticon: 'redo',\n\t\t\tshortcut: 'Meta+Y',\n\t\t\tonPostRender: toggleUndoRedoState('redo'),\n\t\t\tcmd: 'redo'\n\t\t});\n\n\t\teditor.addMenuItem('visualaid', {\n\t\t\ttext: 'Visual aids',\n\t\t\tselectable: true,\n\t\t\tonPostRender: toggleVisualAidState,\n\t\t\tcmd: 'mceToggleVisualAid'\n\t\t});\n\n\t\teditor.addButton('remove', {\n\t\t\ttooltip: 'Remove',\n\t\t\ticon: 'remove',\n\t\t\tcmd: 'Delete'\n\t\t});\n\n\t\teditor.addButton('insert', {\n\t\t\ttype: 'menubutton',\n\t\t\ticon: 'insert',\n\t\t\tmenu: [],\n\t\t\toncreatemenu: function () {\n\t\t\t\tthis.menu.add(createInsertMenu(editor.settings));\n\t\t\t\tthis.menu.renderNew();\n\t\t\t}\n\t\t});\n\n\t\teach({\n\t\t\tcut: ['Cut', 'Cut', 'Meta+X'],\n\t\t\tcopy: ['Copy', 'Copy', 'Meta+C'],\n\t\t\tpaste: ['Paste', 'Paste', 'Meta+V'],\n\t\t\tselectall: ['Select all', 'SelectAll', 'Meta+A'],\n\t\t\tbold: ['Bold', 'Bold', 'Meta+B'],\n\t\t\titalic: ['Italic', 'Italic', 'Meta+I'],\n\t\t\tunderline: ['Underline', 'Underline', 'Meta+U'],\n\t\t\tstrikethrough: ['Strikethrough', 'Strikethrough'],\n\t\t\tsubscript: ['Subscript', 'Subscript'],\n\t\t\tsuperscript: ['Superscript', 'Superscript'],\n\t\t\tremoveformat: ['Clear formatting', 'RemoveFormat']\n\t\t}, function(item, name) {\n\t\t\teditor.addMenuItem(name, {\n\t\t\t\ttext: item[0],\n\t\t\t\ticon: name,\n\t\t\t\tshortcut: item[2],\n\t\t\t\tcmd: item[1]\n\t\t\t});\n\t\t});\n\n\t\teditor.on('mousedown', function() {\n\t\t\tFloatPanel.hideAll();\n\t\t});\n\n\t\tfunction toggleFormat(fmt) {\n\t\t\tif (fmt.control) {\n\t\t\t\tfmt = fmt.control.value();\n\t\t\t}\n\n\t\t\tif (fmt) {\n\t\t\t\teditor.execCommand('mceToggleFormat', false, fmt);\n\t\t\t}\n\t\t}\n\n\t\tfunction hideMenuObjects(menu) {\n\t\t\tvar count = menu.length;\n\n\t\t\tTools.each(menu, function (item) {\n\t\t\t\tif (item.menu) {\n\t\t\t\t\titem.hidden = hideMenuObjects(item.menu) === 0;\n\t\t\t\t}\n\n\t\t\t\tvar formatName = item.format;\n\t\t\t\tif (formatName) {\n\t\t\t\t\titem.hidden = !editor.formatter.canApply(formatName);\n\t\t\t\t}\n\n\t\t\t\tif (item.hidden) {\n\t\t\t\t\tcount--;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn count;\n\t\t}\n\n\t\tfunction hideFormatMenuItems(menu) {\n\t\t\tvar count = menu.items().length;\n\n\t\t\tmenu.items().each(function (item) {\n\t\t\t\tif (item.menu) {\n\t\t\t\t\titem.visible(hideFormatMenuItems(item.menu) > 0);\n\t\t\t\t}\n\n\t\t\t\tif (!item.menu && item.settings.menu) {\n\t\t\t\t\titem.visible(hideMenuObjects(item.settings.menu) > 0);\n\t\t\t\t}\n\n\t\t\t\tvar formatName = item.settings.format;\n\t\t\t\tif (formatName) {\n\t\t\t\t\titem.visible(editor.formatter.canApply(formatName));\n\t\t\t\t}\n\n\t\t\t\tif (!item.visible()) {\n\t\t\t\t\tcount--;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn count;\n\t\t}\n\n\t\teditor.addButton('styleselect', {\n\t\t\ttype: 'menubutton',\n\t\t\ttext: 'Formats',\n\t\t\tmenu: formatMenu,\n\t\t\tonShowMenu: function () {\n\t\t\t\tif (editor.settings.style_formats_autohide) {\n\t\t\t\t\thideFormatMenuItems(this.menu);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\teditor.addButton('formatselect', function() {\n\t\t\tvar items = [], blocks = createFormats(editor.settings.block_formats ||\n\t\t\t\t'Paragraph=p;' +\n\t\t\t\t'Heading 1=h1;' +\n\t\t\t\t'Heading 2=h2;' +\n\t\t\t\t'Heading 3=h3;' +\n\t\t\t\t'Heading 4=h4;' +\n\t\t\t\t'Heading 5=h5;' +\n\t\t\t\t'Heading 6=h6;' +\n\t\t\t\t'Preformatted=pre'\n\t\t\t);\n\n\t\t\teach(blocks, function(block) {\n\t\t\t\titems.push({\n\t\t\t\t\ttext: block[0],\n\t\t\t\t\tvalue: block[1],\n\t\t\t\t\ttextStyle: function() {\n\t\t\t\t\t\treturn editor.formatter.getCssText(block[1]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\ttype: 'listbox',\n\t\t\t\ttext: blocks[0][0],\n\t\t\t\tvalues: items,\n\t\t\t\tfixedWidth: true,\n\t\t\t\tonselect: toggleFormat,\n\t\t\t\tonPostRender: createListBoxChangeHandler(items)\n\t\t\t};\n\t\t});\n\n\t\teditor.addButton('fontselect', function() {\n\t\t\tvar defaultFontsFormats =\n\t\t\t\t'Andale Mono=andale mono,monospace;' +\n\t\t\t\t'Arial=arial,helvetica,sans-serif;' +\n\t\t\t\t'Arial Black=arial black,sans-serif;' +\n\t\t\t\t'Book Antiqua=book antiqua,palatino,serif;' +\n\t\t\t\t'Comic Sans MS=comic sans ms,sans-serif;' +\n\t\t\t\t'Courier New=courier new,courier,monospace;' +\n\t\t\t\t'Georgia=georgia,palatino,serif;' +\n\t\t\t\t'Helvetica=helvetica,arial,sans-serif;' +\n\t\t\t\t'Impact=impact,sans-serif;' +\n\t\t\t\t'Symbol=symbol;' +\n\t\t\t\t'Tahoma=tahoma,arial,helvetica,sans-serif;' +\n\t\t\t\t'Terminal=terminal,monaco,monospace;' +\n\t\t\t\t'Times New Roman=times new roman,times,serif;' +\n\t\t\t\t'Trebuchet MS=trebuchet ms,geneva,sans-serif;' +\n\t\t\t\t'Verdana=verdana,geneva,sans-serif;' +\n\t\t\t\t'Webdings=webdings;' +\n\t\t\t\t'Wingdings=wingdings,zapf dingbats';\n\n\t\t\tvar items = [], fonts = createFormats(editor.settings.font_formats || defaultFontsFormats);\n\n\t\t\teach(fonts, function(font) {\n\t\t\t\titems.push({\n\t\t\t\t\ttext: {raw: font[0]},\n\t\t\t\t\tvalue: font[1],\n\t\t\t\t\ttextStyle: font[1].indexOf('dings') == -1 ? 'font-family:' + font[1] : ''\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\ttype: 'listbox',\n\t\t\t\ttext: 'Font Family',\n\t\t\t\ttooltip: 'Font Family',\n\t\t\t\tvalues: items,\n\t\t\t\tfixedWidth: true,\n\t\t\t\tonPostRender: createFontNameListBoxChangeHandler(items),\n\t\t\t\tonselect: function(e) {\n\t\t\t\t\tif (e.control.settings.value) {\n\t\t\t\t\t\teditor.execCommand('FontName', false, e.control.settings.value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\n\t\teditor.addButton('fontsizeselect', function() {\n\t\t\tvar items = [], defaultFontsizeFormats = '8pt 10pt 12pt 14pt 18pt 24pt 36pt';\n\t\t\tvar fontsize_formats = editor.settings.fontsize_formats || defaultFontsizeFormats;\n\n\t\t\teach(fontsize_formats.split(' '), function(item) {\n\t\t\t\tvar text = item, value = item;\n\t\t\t\t// Allow text=value font sizes.\n\t\t\t\tvar values = item.split('=');\n\t\t\t\tif (values.length > 1) {\n\t\t\t\t\ttext = values[0];\n\t\t\t\t\tvalue = values[1];\n\t\t\t\t}\n\t\t\t\titems.push({text: text, value: value});\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\ttype: 'listbox',\n\t\t\t\ttext: 'Font Sizes',\n\t\t\t\ttooltip: 'Font Sizes',\n\t\t\t\tvalues: items,\n\t\t\t\tfixedWidth: true,\n\t\t\t\tonPostRender: createFontSizeListBoxChangeHandler(items),\n\t\t\t\tonclick: function(e) {\n\t\t\t\t\tif (e.control.settings.value) {\n\t\t\t\t\t\teditor.execCommand('FontSize', false, e.control.settings.value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\n\t\teditor.addMenuItem('formats', {\n\t\t\ttext: 'Formats',\n\t\t\tmenu: formatMenu\n\t\t});\n\t}\n});\n\n// Included from: js/tinymce/classes/ui/GridLayout.js\n\n/**\n * GridLayout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This layout manager places controls in a grid.\n *\n * @setting {Number} spacing Spacing between controls.\n * @setting {Number} spacingH Horizontal spacing between controls.\n * @setting {Number} spacingV Vertical spacing between controls.\n * @setting {Number} columns Number of columns to use.\n * @setting {String/Array} alignH start|end|center|stretch or array of values for each column.\n * @setting {String/Array} alignV start|end|center|stretch or array of values for each column.\n * @setting {String} pack start|end\n *\n * @class tinymce.ui.GridLayout\n * @extends tinymce.ui.AbsoluteLayout\n */\ndefine(\"tinymce/ui/GridLayout\", [\n\t\"tinymce/ui/AbsoluteLayout\"\n], function(AbsoluteLayout) {\n\t\"use strict\";\n\n\treturn AbsoluteLayout.extend({\n\t\t/**\n\t\t * Recalculates the positions of the controls in the specified container.\n\t\t *\n\t\t * @method recalc\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\n\t\t */\n\t\trecalc: function(container) {\n\t\t\tvar settings, rows, cols, items, contLayoutRect, width, height, rect,\n\t\t\t\tctrlLayoutRect, ctrl, x, y, posX, posY, ctrlSettings, contPaddingBox, align, spacingH, spacingV, alignH, alignV, maxX, maxY,\n\t\t\t\tcolWidths = [], rowHeights = [], ctrlMinWidth, ctrlMinHeight, availableWidth, availableHeight, reverseRows, idx;\n\n\t\t\t// Get layout settings\n\t\t\tsettings = container.settings;\n\t\t\titems = container.items().filter(':visible');\n\t\t\tcontLayoutRect = container.layoutRect();\n\t\t\tcols = settings.columns || Math.ceil(Math.sqrt(items.length));\n\t\t\trows = Math.ceil(items.length / cols);\n\t\t\tspacingH = settings.spacingH || settings.spacing || 0;\n\t\t\tspacingV = settings.spacingV || settings.spacing || 0;\n\t\t\talignH = settings.alignH || settings.align;\n\t\t\talignV = settings.alignV || settings.align;\n\t\t\tcontPaddingBox = container.paddingBox;\n\t\t\treverseRows = 'reverseRows' in settings ? settings.reverseRows : container.isRtl();\n\n\t\t\tif (alignH && typeof alignH == \"string\") {\n\t\t\t\talignH = [alignH];\n\t\t\t}\n\n\t\t\tif (alignV && typeof alignV == \"string\") {\n\t\t\t\talignV = [alignV];\n\t\t\t}\n\n\t\t\t// Zero padd columnWidths\n\t\t\tfor (x = 0; x < cols; x++) {\n\t\t\t\tcolWidths.push(0);\n\t\t\t}\n\n\t\t\t// Zero padd rowHeights\n\t\t\tfor (y = 0; y < rows; y++) {\n\t\t\t\trowHeights.push(0);\n\t\t\t}\n\n\t\t\t// Calculate columnWidths and rowHeights\n\t\t\tfor (y = 0; y < rows; y++) {\n\t\t\t\tfor (x = 0; x < cols; x++) {\n\t\t\t\t\tctrl = items[y * cols + x];\n\n\t\t\t\t\t// Out of bounds\n\t\t\t\t\tif (!ctrl) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\n\t\t\t\t\tctrlMinWidth = ctrlLayoutRect.minW;\n\t\t\t\t\tctrlMinHeight = ctrlLayoutRect.minH;\n\n\t\t\t\t\tcolWidths[x] = ctrlMinWidth > colWidths[x] ? ctrlMinWidth : colWidths[x];\n\t\t\t\t\trowHeights[y] = ctrlMinHeight > rowHeights[y] ? ctrlMinHeight : rowHeights[y];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Calculate maxX\n\t\t\tavailableWidth = contLayoutRect.innerW - contPaddingBox.left - contPaddingBox.right;\n\t\t\tfor (maxX = 0, x = 0; x < cols; x++) {\n\t\t\t\tmaxX += colWidths[x] + (x > 0 ? spacingH : 0);\n\t\t\t\tavailableWidth -= (x > 0 ? spacingH : 0) + colWidths[x];\n\t\t\t}\n\n\t\t\t// Calculate maxY\n\t\t\tavailableHeight = contLayoutRect.innerH - contPaddingBox.top - contPaddingBox.bottom;\n\t\t\tfor (maxY = 0, y = 0; y < rows; y++) {\n\t\t\t\tmaxY += rowHeights[y] + (y > 0 ? spacingV : 0);\n\t\t\t\tavailableHeight -= (y > 0 ? spacingV : 0) + rowHeights[y];\n\t\t\t}\n\n\t\t\tmaxX += contPaddingBox.left + contPaddingBox.right;\n\t\t\tmaxY += contPaddingBox.top + contPaddingBox.bottom;\n\n\t\t\t// Calculate minW/minH\n\t\t\trect = {};\n\t\t\trect.minW = maxX + (contLayoutRect.w - contLayoutRect.innerW);\n\t\t\trect.minH = maxY + (contLayoutRect.h - contLayoutRect.innerH);\n\n\t\t\trect.contentW = rect.minW - contLayoutRect.deltaW;\n\t\t\trect.contentH = rect.minH - contLayoutRect.deltaH;\n\t\t\trect.minW = Math.min(rect.minW, contLayoutRect.maxW);\n\t\t\trect.minH = Math.min(rect.minH, contLayoutRect.maxH);\n\t\t\trect.minW = Math.max(rect.minW, contLayoutRect.startMinWidth);\n\t\t\trect.minH = Math.max(rect.minH, contLayoutRect.startMinHeight);\n\n\t\t\t// Resize container container if minSize was changed\n\t\t\tif (contLayoutRect.autoResize && (rect.minW != contLayoutRect.minW || rect.minH != contLayoutRect.minH)) {\n\t\t\t\trect.w = rect.minW;\n\t\t\t\trect.h = rect.minH;\n\n\t\t\t\tcontainer.layoutRect(rect);\n\t\t\t\tthis.recalc(container);\n\n\t\t\t\t// Forced recalc for example if items are hidden/shown\n\t\t\t\tif (container._lastRect === null) {\n\t\t\t\t\tvar parentCtrl = container.parent();\n\t\t\t\t\tif (parentCtrl) {\n\t\t\t\t\t\tparentCtrl._lastRect = null;\n\t\t\t\t\t\tparentCtrl.recalc();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Update contentW/contentH so absEnd moves correctly\n\t\t\tif (contLayoutRect.autoResize) {\n\t\t\t\trect = container.layoutRect(rect);\n\t\t\t\trect.contentW = rect.minW - contLayoutRect.deltaW;\n\t\t\t\trect.contentH = rect.minH - contLayoutRect.deltaH;\n\t\t\t}\n\n\t\t\tvar flexV;\n\n\t\t\tif (settings.packV == 'start') {\n\t\t\t\tflexV = 0;\n\t\t\t} else {\n\t\t\t\tflexV = availableHeight > 0 ? Math.floor(availableHeight / rows) : 0;\n\t\t\t}\n\n\t\t\t// Calculate totalFlex\n\t\t\tvar totalFlex = 0;\n\t\t\tvar flexWidths = settings.flexWidths;\n\t\t\tif (flexWidths) {\n\t\t\t\tfor (x = 0; x < flexWidths.length; x++) {\n\t\t\t\t\ttotalFlex += flexWidths[x];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttotalFlex = cols;\n\t\t\t}\n\n\t\t\t// Calculate new column widths based on flex values\n\t\t\tvar ratio = availableWidth / totalFlex;\n\t\t\tfor (x = 0; x < cols; x++) {\n\t\t\t\tcolWidths[x] += flexWidths ? flexWidths[x] * ratio : ratio;\n\t\t\t}\n\n\t\t\t// Move/resize controls\n\t\t\tposY = contPaddingBox.top;\n\t\t\tfor (y = 0; y < rows; y++) {\n\t\t\t\tposX = contPaddingBox.left;\n\t\t\t\theight = rowHeights[y] + flexV;\n\n\t\t\t\tfor (x = 0; x < cols; x++) {\n\t\t\t\t\tif (reverseRows) {\n\t\t\t\t\t\tidx = y * cols + cols - 1 - x;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tidx = y * cols + x;\n\t\t\t\t\t}\n\n\t\t\t\t\tctrl = items[idx];\n\n\t\t\t\t\t// No more controls to render then break\n\t\t\t\t\tif (!ctrl) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Get control settings and calculate x, y\n\t\t\t\t\tctrlSettings = ctrl.settings;\n\t\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\n\t\t\t\t\twidth = Math.max(colWidths[x], ctrlLayoutRect.startMinWidth);\n\t\t\t\t\tctrlLayoutRect.x = posX;\n\t\t\t\t\tctrlLayoutRect.y = posY;\n\n\t\t\t\t\t// Align control horizontal\n\t\t\t\t\talign = ctrlSettings.alignH || (alignH ? (alignH[x] || alignH[0]) : null);\n\t\t\t\t\tif (align == \"center\") {\n\t\t\t\t\t\tctrlLayoutRect.x = posX + (width / 2) - (ctrlLayoutRect.w / 2);\n\t\t\t\t\t} else if (align == \"right\") {\n\t\t\t\t\t\tctrlLayoutRect.x = posX + width - ctrlLayoutRect.w;\n\t\t\t\t\t} else if (align == \"stretch\") {\n\t\t\t\t\t\tctrlLayoutRect.w = width;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Align control vertical\n\t\t\t\t\talign = ctrlSettings.alignV || (alignV ? (alignV[x] || alignV[0]) : null);\n\t\t\t\t\tif (align == \"center\") {\n\t\t\t\t\t\tctrlLayoutRect.y = posY + (height / 2) - (ctrlLayoutRect.h / 2);\n\t\t\t\t\t} else if (align == \"bottom\") {\n\t\t\t\t\t\tctrlLayoutRect.y = posY + height - ctrlLayoutRect.h;\n\t\t\t\t\t} else if (align == \"stretch\") {\n\t\t\t\t\t\tctrlLayoutRect.h = height;\n\t\t\t\t\t}\n\n\t\t\t\t\tctrl.layoutRect(ctrlLayoutRect);\n\n\t\t\t\t\tposX += width + spacingH;\n\n\t\t\t\t\tif (ctrl.recalc) {\n\t\t\t\t\t\tctrl.recalc();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tposY += height + spacingV;\n\t\t\t}\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Iframe.js\n\n/**\n * Iframe.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*jshint scripturl:true */\n\n/**\n * This class creates an iframe.\n *\n * @setting {String} url Url to open in the iframe.\n *\n * @-x-less Iframe.less\n * @class tinymce.ui.Iframe\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Iframe\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/util/Delay\"\n], function(Widget, Delay) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.classes.add('iframe');\n\t\t\tself.canFocus = false;\n\n\t\t\t/*eslint no-script-url:0 */\n\t\t\treturn (\n\t\t\t\t'<iframe id=\"' + self._id + '\" class=\"' + self.classes + '\" tabindex=\"-1\" src=\"' +\n\t\t\t\t(self.settings.url || \"javascript:''\") + '\" frameborder=\"0\"></iframe>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Setter for the iframe source.\n\t\t *\n\t\t * @method src\n\t\t * @param {String} src Source URL for iframe.\n\t\t */\n\t\tsrc: function(src) {\n\t\t\tthis.getEl().src = src;\n\t\t},\n\n\t\t/**\n\t\t * Inner HTML for the iframe.\n\t\t *\n\t\t * @method html\n\t\t * @param {String} html HTML string to set as HTML inside the iframe.\n\t\t * @param {function} callback Optional callback to execute when the iframe body is filled with contents.\n\t\t * @return {tinymce.ui.Iframe} Current iframe control.\n\t\t */\n\t\thtml: function(html, callback) {\n\t\t\tvar self = this, body = this.getEl().contentWindow.document.body;\n\n\t\t\t// Wait for iframe to initialize IE 10 takes time\n\t\t\tif (!body) {\n\t\t\t\tDelay.setTimeout(function() {\n\t\t\t\t\tself.html(html);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tbody.innerHTML = html;\n\n\t\t\t\tif (callback) {\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/InfoBox.js\n\n/**\n * InfoBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * ....\n *\n * @-x-less InfoBox.less\n * @class tinymce.ui.InfoBox\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/InfoBox\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Boolean} multiline Multiline label.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('widget').add('infobox');\n\t\t\tself.canFocus = false;\n\t\t},\n\n\t\tseverity: function(level) {\n\t\t\tthis.classes.remove('error');\n\t\t\tthis.classes.remove('warning');\n\t\t\tthis.classes.remove('success');\n\t\t\tthis.classes.add(level);\n\t\t},\n\n\t\thelp: function(state) {\n\t\t\tthis.state.set('help', state);\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, prefix = self.classPrefix;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<div id=\"' + self._id + '-body\">' +\n\t\t\t\t\t\tself.encode(self.state.get('text')) +\n\t\t\t\t\t\t'<button role=\"button\" tabindex=\"-1\">' +\n\t\t\t\t\t\t\t'<i class=\"' + prefix + 'ico ' + prefix + 'i-help\"></i>' +\n\t\t\t\t\t\t'</button>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:text', function(e) {\n\t\t\t\tself.getEl('body').firstChild.data = self.encode(e.value);\n\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.updateLayoutRect();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.state.on('change:help', function(e) {\n\t\t\t\tself.classes.toggle('has-help', e.value);\n\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.updateLayoutRect();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Label.js\n\n/**\n * Label.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates a label element. A label is a simple text control\n * that can be bound to other controls.\n *\n * @-x-less Label.less\n * @class tinymce.ui.Label\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Label\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/DomUtils\"\n], function(Widget, DomUtils) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Boolean} multiline Multiline label.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('widget').add('label');\n\t\t\tself.canFocus = false;\n\n\t\t\tif (settings.multiline) {\n\t\t\t\tself.classes.add('autoscroll');\n\t\t\t}\n\n\t\t\tif (settings.strong) {\n\t\t\t\tself.classes.add('strong');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Initializes the current controls layout rect.\n\t\t * This will be executed by the layout managers to determine the\n\t\t * default minWidth/minHeight etc.\n\t\t *\n\t\t * @method initLayoutRect\n\t\t * @return {Object} Layout rect instance.\n\t\t */\n\t\tinitLayoutRect: function() {\n\t\t\tvar self = this, layoutRect = self._super();\n\n\t\t\tif (self.settings.multiline) {\n\t\t\t\tvar size = DomUtils.getSize(self.getEl());\n\n\t\t\t\t// Check if the text fits within maxW if not then try word wrapping it\n\t\t\t\tif (size.width > layoutRect.maxW) {\n\t\t\t\t\tlayoutRect.minW = layoutRect.maxW;\n\t\t\t\t\tself.classes.add('multiline');\n\t\t\t\t}\n\n\t\t\t\tself.getEl().style.width = layoutRect.minW + 'px';\n\t\t\t\tlayoutRect.startMinH = layoutRect.h = layoutRect.minH = Math.min(layoutRect.maxH, DomUtils.getSize(self.getEl()).height);\n\t\t\t}\n\n\t\t\treturn layoutRect;\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (!self.settings.multiline) {\n\t\t\t\tself.getEl().style.lineHeight = self.layoutRect().h + 'px';\n\t\t\t}\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\tseverity: function(level) {\n\t\t\tthis.classes.remove('error');\n\t\t\tthis.classes.remove('warning');\n\t\t\tthis.classes.remove('success');\n\t\t\tthis.classes.add(level);\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, targetCtrl, forName, forId = self.settings.forId;\n\n\t\t\tif (!forId && (forName = self.settings.forName)) {\n\t\t\t\ttargetCtrl = self.getRoot().find('#' + forName)[0];\n\n\t\t\t\tif (targetCtrl) {\n\t\t\t\t\tforId = targetCtrl._id;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (forId) {\n\t\t\t\treturn (\n\t\t\t\t\t'<label id=\"' + self._id + '\" class=\"' + self.classes + '\"' + (forId ? ' for=\"' + forId + '\"' : '') + '>' +\n\t\t\t\t\t\tself.encode(self.state.get('text')) +\n\t\t\t\t\t'</label>'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<span id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\tself.encode(self.state.get('text')) +\n\t\t\t\t'</span>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:text', function(e) {\n\t\t\t\tself.innerHtml(self.encode(e.value));\n\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.updateLayoutRect();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Toolbar.js\n\n/**\n * Toolbar.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new toolbar.\n *\n * @class tinymce.ui.Toolbar\n * @extends tinymce.ui.Container\n */\ndefine(\"tinymce/ui/Toolbar\", [\n\t\"tinymce/ui/Container\"\n], function(Container) {\n\t\"use strict\";\n\n\treturn Container.extend({\n\t\tDefaults: {\n\t\t\trole: 'toolbar',\n\t\t\tlayout: 'flow'\n\t\t},\n\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('toolbar');\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.items().each(function(ctrl) {\n\t\t\t\tctrl.classes.add('toolbar-item');\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/MenuBar.js\n\n/**\n * MenuBar.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new menubar.\n *\n * @-x-less MenuBar.less\n * @class tinymce.ui.MenuBar\n * @extends tinymce.ui.Container\n */\ndefine(\"tinymce/ui/MenuBar\", [\n\t\"tinymce/ui/Toolbar\"\n], function(Toolbar) {\n\t\"use strict\";\n\n\treturn Toolbar.extend({\n\t\tDefaults: {\n\t\t\trole: 'menubar',\n\t\t\tcontainerCls: 'menubar',\n\t\t\tariaRoot: true,\n\t\t\tdefaults: {\n\t\t\t\ttype: 'menubutton'\n\t\t\t}\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/MenuButton.js\n\n/**\n * MenuButton.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new menu button.\n *\n * @-x-less MenuButton.less\n * @class tinymce.ui.MenuButton\n * @extends tinymce.ui.Button\n */\ndefine(\"tinymce/ui/MenuButton\", [\n\t\"tinymce/ui/Button\",\n\t\"tinymce/ui/Factory\",\n\t\"tinymce/ui/MenuBar\"\n], function(Button, Factory, MenuBar) {\n\t\"use strict\";\n\n\t// TODO: Maybe add as some global function\n\tfunction isChildOf(node, parent) {\n\t\twhile (node) {\n\t\t\tif (parent === node) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tvar MenuButton = Button.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._renderOpen = true;\n\n\t\t\tself._super(settings);\n\t\t\tsettings = self.settings;\n\n\t\t\tself.classes.add('menubtn');\n\n\t\t\tif (settings.fixedWidth) {\n\t\t\t\tself.classes.add('fixed-width');\n\t\t\t}\n\n\t\t\tself.aria('haspopup', true);\n\n\t\t\tself.state.set('menu', settings.menu || self.render());\n\t\t},\n\n\t\t/**\n\t\t * Shows the menu for the button.\n\t\t *\n\t\t * @method showMenu\n\t\t */\n\t\tshowMenu: function(toggle) {\n\t\t\tvar self = this, menu;\n\n\t\t\tif (self.menu && self.menu.visible() && toggle !== false) {\n\t\t\t\treturn self.hideMenu();\n\t\t\t}\n\n\t\t\tif (!self.menu) {\n\t\t\t\tmenu = self.state.get('menu') || [];\n\n\t\t\t\t// Is menu array then auto constuct menu control\n\t\t\t\tif (menu.length) {\n\t\t\t\t\tmenu = {\n\t\t\t\t\t\ttype: 'menu',\n\t\t\t\t\t\titems: menu\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tmenu.type = menu.type || 'menu';\n\t\t\t\t}\n\n\t\t\t\tif (!menu.renderTo) {\n\t\t\t\t\tself.menu = Factory.create(menu).parent(self).renderTo();\n\t\t\t\t} else {\n\t\t\t\t\tself.menu = menu.parent(self).show().renderTo();\n\t\t\t\t}\n\n\t\t\t\tself.fire('createmenu');\n\t\t\t\tself.menu.reflow();\n\t\t\t\tself.menu.on('cancel', function(e) {\n\t\t\t\t\tif (e.control.parent() === self.menu) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tself.focus();\n\t\t\t\t\t\tself.hideMenu();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Move focus to button when a menu item is selected/clicked\n\t\t\t\tself.menu.on('select', function() {\n\t\t\t\t\tself.focus();\n\t\t\t\t});\n\n\t\t\t\tself.menu.on('show hide', function(e) {\n\t\t\t\t\tif (e.control == self.menu) {\n\t\t\t\t\t\tself.activeMenu(e.type == 'show');\n\t\t\t\t\t}\n\n\t\t\t\t\tself.aria('expanded', e.type == 'show');\n\t\t\t\t}).fire('show');\n\t\t\t}\n\n\t\t\tself.menu.show();\n\t\t\tself.menu.layoutRect({w: self.layoutRect().w});\n\t\t\tself.menu.moveRel(self.getEl(), self.isRtl() ? ['br-tr', 'tr-br'] : ['bl-tl', 'tl-bl']);\n\t\t\tself.fire('showmenu');\n\t\t},\n\n\t\t/**\n\t\t * Hides the menu for the button.\n\t\t *\n\t\t * @method hideMenu\n\t\t */\n\t\thideMenu: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self.menu) {\n\t\t\t\tself.menu.items().each(function(item) {\n\t\t\t\t\tif (item.hideMenu) {\n\t\t\t\t\t\titem.hideMenu();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.menu.hide();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Sets the active menu state.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tactiveMenu: function(state) {\n\t\t\tthis.classes.toggle('active', state);\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix;\n\t\t\tvar icon = self.settings.icon, image, text = self.state.get('text'),\n\t\t\t\ttextHtml = '';\n\n\t\t\timage = self.settings.image;\n\t\t\tif (image) {\n\t\t\t\ticon = 'none';\n\n\t\t\t\t// Support for [high dpi, low dpi] image sources\n\t\t\t\tif (typeof image != \"string\") {\n\t\t\t\t\timage = window.getSelection ? image[0] : image[1];\n\t\t\t\t}\n\n\t\t\t\timage = ' style=\"background-image: url(\\'' + image + '\\')\"';\n\t\t\t} else {\n\t\t\t\timage = '';\n\t\t\t}\n\n\t\t\tif (text) {\n\t\t\t\tself.classes.add('btn-has-text');\n\t\t\t\ttextHtml = '<span class=\"' + prefix + 'txt\">' + self.encode(text) + '</span>';\n\t\t\t}\n\n\t\t\ticon = self.settings.icon ? prefix + 'ico ' + prefix + 'i-' + icon : '';\n\n\t\t\tself.aria('role', self.parent() instanceof MenuBar ? 'menuitem' : 'button');\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" tabindex=\"-1\" aria-labelledby=\"' + id + '\">' +\n\t\t\t\t\t'<button id=\"' + id + '-open\" role=\"presentation\" type=\"button\" tabindex=\"-1\">' +\n\t\t\t\t\t\t(icon ? '<i class=\"' + icon + '\"' + image + '></i>' : '') +\n\t\t\t\t\t\ttextHtml +\n\t\t\t\t\t\t' <i class=\"' + prefix + 'caret\"></i>' +\n\t\t\t\t\t'</button>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Gets invoked after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tif (e.control === self && isChildOf(e.target, self.getEl())) {\n\t\t\t\t\tself.focus();\n\t\t\t\t\tself.showMenu(!e.aria);\n\n\t\t\t\t\tif (e.aria) {\n\t\t\t\t\t\tself.menu.items().filter(':visible')[0].focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('mouseenter', function(e) {\n\t\t\t\tvar overCtrl = e.control, parent = self.parent(), hasVisibleSiblingMenu;\n\n\t\t\t\tif (overCtrl && parent && overCtrl instanceof MenuButton && overCtrl.parent() == parent) {\n\t\t\t\t\tparent.items().filter('MenuButton').each(function(ctrl) {\n\t\t\t\t\t\tif (ctrl.hideMenu && ctrl != overCtrl) {\n\t\t\t\t\t\t\tif (ctrl.menu && ctrl.menu.visible()) {\n\t\t\t\t\t\t\t\thasVisibleSiblingMenu = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tctrl.hideMenu();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (hasVisibleSiblingMenu) {\n\t\t\t\t\t\toverCtrl.focus(); // Fix for: #5887\n\t\t\t\t\t\toverCtrl.showMenu();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:menu', function() {\n\t\t\t\tif (self.menu) {\n\t\t\t\t\tself.menu.remove();\n\t\t\t\t}\n\n\t\t\t\tself.menu = null;\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\t/**\n\t\t * Removes the control and it's menus.\n\t\t *\n\t\t * @method remove\n\t\t */\n\t\tremove: function() {\n\t\t\tthis._super();\n\n\t\t\tif (this.menu) {\n\t\t\t\tthis.menu.remove();\n\t\t\t}\n\t\t}\n\t});\n\n\treturn MenuButton;\n});\n\n// Included from: js/tinymce/classes/ui/MenuItem.js\n\n/**\n * MenuItem.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new menu item.\n *\n * @-x-less MenuItem.less\n * @class tinymce.ui.MenuItem\n * @extends tinymce.ui.Control\n */\ndefine(\"tinymce/ui/MenuItem\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/Factory\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Delay\"\n], function(Widget, Factory, Env, Delay) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\tDefaults: {\n\t\t\tborder: 0,\n\t\t\trole: 'menuitem'\n\t\t},\n\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Boolean} selectable Selectable menu.\n\t\t * @setting {Array} menu Submenu array with items.\n\t\t * @setting {String} shortcut Shortcut to display for menu item. Example: Ctrl+X\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this, text;\n\n\t\t\tself._super(settings);\n\n\t\t\tsettings = self.settings;\n\n\t\t\tself.classes.add('menu-item');\n\n\t\t\tif (settings.menu) {\n\t\t\t\tself.classes.add('menu-item-expand');\n\t\t\t}\n\n\t\t\tif (settings.preview) {\n\t\t\t\tself.classes.add('menu-item-preview');\n\t\t\t}\n\n\t\t\ttext = self.state.get('text');\n\t\t\tif (text === '-' || text === '|') {\n\t\t\t\tself.classes.add('menu-item-sep');\n\t\t\t\tself.aria('role', 'separator');\n\t\t\t\tself.state.set('text', '-');\n\t\t\t}\n\n\t\t\tif (settings.selectable) {\n\t\t\t\tself.aria('role', 'menuitemcheckbox');\n\t\t\t\tself.classes.add('menu-item-checkbox');\n\t\t\t\tsettings.icon = 'selected';\n\t\t\t}\n\n\t\t\tif (!settings.preview && !settings.selectable) {\n\t\t\t\tself.classes.add('menu-item-normal');\n\t\t\t}\n\n\t\t\tself.on('mousedown', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\t\tif (settings.menu && !settings.ariaHideMenu) {\n\t\t\t\tself.aria('haspopup', true);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the menuitem has sub menu.\n\t\t *\n\t\t * @method hasMenus\n\t\t * @return {Boolean} True/false state if it has submenu.\n\t\t */\n\t\thasMenus: function() {\n\t\t\treturn !!this.settings.menu;\n\t\t},\n\n\t\t/**\n\t\t * Shows the menu for the menu item.\n\t\t *\n\t\t * @method showMenu\n\t\t */\n\t\tshowMenu: function() {\n\t\t\tvar self = this, settings = self.settings, menu, parent = self.parent();\n\n\t\t\tparent.items().each(function(ctrl) {\n\t\t\t\tif (ctrl !== self) {\n\t\t\t\t\tctrl.hideMenu();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (settings.menu) {\n\t\t\t\tmenu = self.menu;\n\n\t\t\t\tif (!menu) {\n\t\t\t\t\tmenu = settings.menu;\n\n\t\t\t\t\t// Is menu array then auto constuct menu control\n\t\t\t\t\tif (menu.length) {\n\t\t\t\t\t\tmenu = {\n\t\t\t\t\t\t\ttype: 'menu',\n\t\t\t\t\t\t\titems: menu\n\t\t\t\t\t\t};\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmenu.type = menu.type || 'menu';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (parent.settings.itemDefaults) {\n\t\t\t\t\t\tmenu.itemDefaults = parent.settings.itemDefaults;\n\t\t\t\t\t}\n\n\t\t\t\t\tmenu = self.menu = Factory.create(menu).parent(self).renderTo();\n\t\t\t\t\tmenu.reflow();\n\t\t\t\t\tmenu.on('cancel', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tself.focus();\n\t\t\t\t\t\tmenu.hide();\n\t\t\t\t\t});\n\t\t\t\t\tmenu.on('show hide', function(e) {\n\t\t\t\t\t\tif (e.control.items) {\n\t\t\t\t\t\t\te.control.items().each(function(ctrl) {\n\t\t\t\t\t\t\t\tctrl.active(ctrl.settings.selected);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}).fire('show');\n\n\t\t\t\t\tmenu.on('hide', function(e) {\n\t\t\t\t\t\tif (e.control === menu) {\n\t\t\t\t\t\t\tself.classes.remove('selected');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tmenu.submenu = true;\n\t\t\t\t} else {\n\t\t\t\t\tmenu.show();\n\t\t\t\t}\n\n\t\t\t\tmenu._parentMenu = parent;\n\n\t\t\t\tmenu.classes.add('menu-sub');\n\n\t\t\t\tvar rel = menu.testMoveRel(\n\t\t\t\t\tself.getEl(),\n\t\t\t\t\tself.isRtl() ? ['tl-tr', 'bl-br', 'tr-tl', 'br-bl'] : ['tr-tl', 'br-bl', 'tl-tr', 'bl-br']\n\t\t\t\t);\n\n\t\t\t\tmenu.moveRel(self.getEl(), rel);\n\t\t\t\tmenu.rel = rel;\n\n\t\t\t\trel = 'menu-sub-' + rel;\n\t\t\t\tmenu.classes.remove(menu._lastRel).add(rel);\n\t\t\t\tmenu._lastRel = rel;\n\n\t\t\t\tself.classes.add('selected');\n\t\t\t\tself.aria('expanded', true);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Hides the menu for the menu item.\n\t\t *\n\t\t * @method hideMenu\n\t\t */\n\t\thideMenu: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self.menu) {\n\t\t\t\tself.menu.items().each(function(item) {\n\t\t\t\t\tif (item.hideMenu) {\n\t\t\t\t\t\titem.hideMenu();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.menu.hide();\n\t\t\t\tself.aria('expanded', false);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, settings = self.settings, prefix = self.classPrefix, text = self.state.get('text');\n\t\t\tvar icon = self.settings.icon, image = '', shortcut = settings.shortcut;\n\t\t\tvar url = self.encode(settings.url), iconHtml = '';\n\n\t\t\t// Converts shortcut format to Mac/PC variants\n\t\t\tfunction convertShortcut(shortcut) {\n\t\t\t\tvar i, value, replace = {};\n\n\t\t\t\tif (Env.mac) {\n\t\t\t\t\treplace = {\n\t\t\t\t\t\talt: '&#x2325;',\n\t\t\t\t\t\tctrl: '&#x2318;',\n\t\t\t\t\t\tshift: '&#x21E7;',\n\t\t\t\t\t\tmeta: '&#x2318;'\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\treplace = {\n\t\t\t\t\t\tmeta: 'Ctrl'\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tshortcut = shortcut.split('+');\n\n\t\t\t\tfor (i = 0; i < shortcut.length; i++) {\n\t\t\t\t\tvalue = replace[shortcut[i].toLowerCase()];\n\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tshortcut[i] = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn shortcut.join('+');\n\t\t\t}\n\n\t\t\tfunction escapeRegExp(str) {\n\t\t\t\treturn str.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n\t\t\t}\n\n\t\t\tfunction markMatches(text) {\n\t\t\t\tvar match = settings.match || '';\n\n\t\t\t\treturn match ? text.replace(new RegExp(escapeRegExp(match), 'gi'), function (match) {\n\t\t\t\t\treturn '!mce~match[' + match + ']mce~match!';\n\t\t\t\t}) : text;\n\t\t\t}\n\n\t\t\tfunction boldMatches(text) {\n\t\t\t\treturn text.\n\t\t\t\t\treplace(new RegExp(escapeRegExp('!mce~match['), 'g'), '<b>').\n\t\t\t\t\treplace(new RegExp(escapeRegExp(']mce~match!'), 'g'), '</b>');\n\t\t\t}\n\n\t\t\tif (icon) {\n\t\t\t\tself.parent().classes.add('menu-has-icons');\n\t\t\t}\n\n\t\t\tif (settings.image) {\n\t\t\t\timage = ' style=\"background-image: url(\\'' + settings.image + '\\')\"';\n\t\t\t}\n\n\t\t\tif (shortcut) {\n\t\t\t\tshortcut = convertShortcut(shortcut);\n\t\t\t}\n\n\t\t\ticon = prefix + 'ico ' + prefix + 'i-' + (self.settings.icon || 'none');\n\t\t\ticonHtml = (text !== '-' ? '<i class=\"' + icon + '\"' + image + '></i>\\u00a0' : '');\n\n\t\t\ttext = boldMatches(self.encode(markMatches(text)));\n\t\t\turl = boldMatches(self.encode(markMatches(url)));\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" tabindex=\"-1\">' +\n\t\t\t\t\ticonHtml +\n\t\t\t\t\t(text !== '-' ? '<span id=\"' + id + '-text\" class=\"' + prefix + 'text\">' + text + '</span>' : '') +\n\t\t\t\t\t(shortcut ? '<div id=\"' + id + '-shortcut\" class=\"' + prefix + 'menu-shortcut\">' + shortcut + '</div>' : '') +\n\t\t\t\t\t(settings.menu ? '<div class=\"' + prefix + 'caret\"></div>' : '') +\n\t\t\t\t\t(url ? '<div class=\"' + prefix + 'menu-item-link\">' + url + '</div>' : '') +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Gets invoked after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, settings = self.settings;\n\n\t\t\tvar textStyle = settings.textStyle;\n\t\t\tif (typeof textStyle == \"function\") {\n\t\t\t\ttextStyle = textStyle.call(this);\n\t\t\t}\n\n\t\t\tif (textStyle) {\n\t\t\t\tvar textElm = self.getEl('text');\n\t\t\t\tif (textElm) {\n\t\t\t\t\ttextElm.setAttribute('style', textStyle);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.on('mouseenter click', function(e) {\n\t\t\t\tif (e.control === self) {\n\t\t\t\t\tif (!settings.menu && e.type === 'click') {\n\t\t\t\t\t\tself.fire('select');\n\n\t\t\t\t\t\t// Edge will crash if you stress it see #2660\n\t\t\t\t\t\tDelay.requestAnimationFrame(function() {\n\t\t\t\t\t\t\tself.parent().hideAll();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.showMenu();\n\n\t\t\t\t\t\tif (e.aria) {\n\t\t\t\t\t\t\tself.menu.focus(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself._super();\n\n\t\t\treturn self;\n\t\t},\n\n\t\thover: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.parent().items().each(function(ctrl) {\n\t\t\t\tctrl.classes.remove('selected');\n\t\t\t});\n\n\t\t\tself.classes.toggle('selected', true);\n\n\t\t\treturn self;\n\t\t},\n\n\t\tactive: function(state) {\n\t\t\tif (typeof state != \"undefined\") {\n\t\t\t\tthis.aria('checked', state);\n\t\t\t}\n\n\t\t\treturn this._super(state);\n\t\t},\n\n\t\t/**\n\t\t * Removes the control and it's menus.\n\t\t *\n\t\t * @method remove\n\t\t */\n\t\tremove: function() {\n\t\t\tthis._super();\n\n\t\t\tif (this.menu) {\n\t\t\t\tthis.menu.remove();\n\t\t\t}\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Throbber.js\n\n/**\n * Throbber.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class enables you to display a Throbber for any element.\n *\n * @-x-less Throbber.less\n * @class tinymce.ui.Throbber\n */\ndefine(\"tinymce/ui/Throbber\", [\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/ui/Control\",\n\t\"tinymce/util/Delay\"\n], function($, Control, Delay) {\n\t\"use strict\";\n\n\t/**\n\t * Constructs a new throbber.\n\t *\n\t * @constructor\n\t * @param {Element} elm DOM Html element to display throbber in.\n\t * @param {Boolean} inline Optional true/false state if the throbber should be appended to end of element for infinite scroll.\n\t */\n\treturn function(elm, inline) {\n\t\tvar self = this, state, classPrefix = Control.classPrefix, timer;\n\n\t\t/**\n\t\t * Shows the throbber.\n\t\t *\n\t\t * @method show\n\t\t * @param {Number} [time] Time to wait before showing.\n\t\t * @param {function} [callback] Optional callback to execute when the throbber is shown.\n\t\t * @return {tinymce.ui.Throbber} Current throbber instance.\n\t\t */\n\t\tself.show = function(time, callback) {\n\t\t\tfunction render() {\n\t\t\t\t\tif (state) {\n\t\t\t\t\t\t$(elm).append(\n\t\t\t\t\t\t\t'<div class=\"' + classPrefix + 'throbber' + (inline ? ' ' + classPrefix + 'throbber-inline' : '') + '\"></div>'\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.hide();\n\n\t\t\tstate = true;\n\n\t\t\tif (time) {\n\t\t\t\ttimer = Delay.setTimeout(render, time);\n\t\t\t} else {\n\t\t\t\trender();\n\t\t\t}\n\n\t\t\treturn self;\n\t\t};\n\n\t\t/**\n\t\t * Hides the throbber.\n\t\t *\n\t\t * @method hide\n\t\t * @return {tinymce.ui.Throbber} Current throbber instance.\n\t\t */\n\t\tself.hide = function() {\n\t\t\tvar child = elm.lastChild;\n\n\t\t\tDelay.clearTimeout(timer);\n\n\t\t\tif (child && child.className.indexOf('throbber') != -1) {\n\t\t\t\tchild.parentNode.removeChild(child);\n\t\t\t}\n\n\t\t\tstate = false;\n\n\t\t\treturn self;\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Menu.js\n\n/**\n * Menu.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new menu.\n *\n * @-x-less Menu.less\n * @class tinymce.ui.Menu\n * @extends tinymce.ui.FloatPanel\n */\ndefine(\"tinymce/ui/Menu\", [\n\t\"tinymce/ui/FloatPanel\",\n\t\"tinymce/ui/MenuItem\",\n\t\"tinymce/ui/Throbber\",\n\t\"tinymce/util/Tools\"\n], function(FloatPanel, MenuItem, Throbber, Tools) {\n\t\"use strict\";\n\n\treturn FloatPanel.extend({\n\t\tDefaults: {\n\t\t\tdefaultType: 'menuitem',\n\t\t\tborder: 1,\n\t\t\tlayout: 'stack',\n\t\t\trole: 'application',\n\t\t\tbodyRole: 'menu',\n\t\t\tariaRoot: true\n\t\t},\n\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tsettings.autohide = true;\n\t\t\tsettings.constrainToViewport = true;\n\n\t\t\tif (typeof settings.items === 'function') {\n\t\t\t\tsettings.itemsFactory = settings.items;\n\t\t\t\tsettings.items = [];\n\t\t\t}\n\n\t\t\tif (settings.itemDefaults) {\n\t\t\t\tvar items = settings.items, i = items.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\titems[i] = Tools.extend({}, settings.itemDefaults, items[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('menu');\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tthis.classes.toggle('menu-align', true);\n\n\t\t\tthis._super();\n\n\t\t\tthis.getEl().style.height = '';\n\t\t\tthis.getEl('body').style.height = '';\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Hides/closes the menu.\n\t\t *\n\t\t * @method cancel\n\t\t */\n\t\tcancel: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.hideAll();\n\t\t\tself.fire('select');\n\t\t},\n\n\t\t/**\n\t\t * Loads new items from the factory items function.\n\t\t *\n\t\t * @method load\n\t\t */\n\t\tload: function() {\n\t\t\tvar self = this, time, factory;\n\n\t\t\tfunction hideThrobber() {\n\t\t\t\tif (self.throbber) {\n\t\t\t\t\tself.throbber.hide();\n\t\t\t\t\tself.throbber = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfactory = self.settings.itemsFactory;\n\t\t\tif (!factory) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!self.throbber) {\n\t\t\t\tself.throbber = new Throbber(self.getEl('body'), true);\n\n\t\t\t\tif (self.items().length === 0) {\n\t\t\t\t\tself.throbber.show();\n\t\t\t\t\tself.fire('loading');\n\t\t\t\t} else {\n\t\t\t\t\tself.throbber.show(100, function() {\n\t\t\t\t\t\tself.items().remove();\n\t\t\t\t\t\tself.fire('loading');\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tself.on('hide close', hideThrobber);\n\t\t\t}\n\n\t\t\tself.requestTime = time = new Date().getTime();\n\n\t\t\tself.settings.itemsFactory(function(items) {\n\t\t\t\tif (items.length === 0) {\n\t\t\t\t\tself.hide();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (self.requestTime !== time) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tself.getEl().style.width = '';\n\t\t\t\tself.getEl('body').style.width = '';\n\n\t\t\t\thideThrobber();\n\t\t\t\tself.items().remove();\n\t\t\t\tself.getEl('body').innerHTML = '';\n\n\t\t\t\tself.add(items);\n\t\t\t\tself.renderNew();\n\t\t\t\tself.fire('loaded');\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Hide menu and all sub menus.\n\t\t *\n\t\t * @method hideAll\n\t\t */\n\t\thideAll: function() {\n\t\t\tvar self = this;\n\n\t\t\tthis.find('menuitem').exec('hideMenu');\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\t/**\n\t\t * Invoked before the menu is rendered.\n\t\t *\n\t\t * @method preRender\n\t\t */\n\t\tpreRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.items().each(function(ctrl) {\n\t\t\t\tvar settings = ctrl.settings;\n\n\t\t\t\tif (settings.icon || settings.image || settings.selectable) {\n\t\t\t\t\tself._hasIcons = true;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (self.settings.itemsFactory) {\n\t\t\t\tself.on('postrender', function() {\n\t\t\t\t\tif (self.settings.itemsFactory) {\n\t\t\t\t\t\tself.load();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ListBox.js\n\n/**\n * ListBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new list box control.\n *\n * @-x-less ListBox.less\n * @class tinymce.ui.ListBox\n * @extends tinymce.ui.MenuButton\n */\ndefine(\"tinymce/ui/ListBox\", [\n\t\"tinymce/ui/MenuButton\",\n\t\"tinymce/ui/Menu\"\n], function(MenuButton, Menu) {\n\t\"use strict\";\n\n\treturn MenuButton.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Array} values Array with values to add to list box.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this, values, selected, selectedText, lastItemCtrl;\n\n\t\t\tfunction setSelected(menuValues) {\n\t\t\t\t// Try to find a selected value\n\t\t\t\tfor (var i = 0; i < menuValues.length; i++) {\n\t\t\t\t\tselected = menuValues[i].selected || settings.value === menuValues[i].value;\n\n\t\t\t\t\tif (selected) {\n\t\t\t\t\t\tselectedText = selectedText || menuValues[i].text;\n\t\t\t\t\t\tself.state.set('value', menuValues[i].value);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// If the value has a submenu, try to find the selected values in that menu\n\t\t\t\t\tif (menuValues[i].menu) {\n\t\t\t\t\t\tif (setSelected(menuValues[i].menu)) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself._super(settings);\n\t\t\tsettings = self.settings;\n\n\t\t\tself._values = values = settings.values;\n\t\t\tif (values) {\n\t\t\t\tif (typeof settings.value != \"undefined\") {\n\t\t\t\t\tsetSelected(values);\n\t\t\t\t}\n\n\t\t\t\t// Default with first item\n\t\t\t\tif (!selected && values.length > 0) {\n\t\t\t\t\tselectedText = values[0].text;\n\t\t\t\t\tself.state.set('value', values[0].value);\n\t\t\t\t}\n\n\t\t\t\tself.state.set('menu', values);\n\t\t\t}\n\n\t\t\tself.state.set('text', settings.text || selectedText);\n\n\t\t\tself.classes.add('listbox');\n\n\t\t\tself.on('select', function(e) {\n\t\t\t\tvar ctrl = e.control;\n\n\t\t\t\tif (lastItemCtrl) {\n\t\t\t\t\te.lastControl = lastItemCtrl;\n\t\t\t\t}\n\n\t\t\t\tif (settings.multiple) {\n\t\t\t\t\tctrl.active(!ctrl.active());\n\t\t\t\t} else {\n\t\t\t\t\tself.value(e.control.value());\n\t\t\t\t}\n\n\t\t\t\tlastItemCtrl = ctrl;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Getter/setter function for the control value.\n\t\t *\n\t\t * @method value\n\t\t * @param {String} [value] Value to be set.\n\t\t * @return {Boolean/tinymce.ui.ListBox} Value or self if it's a set operation.\n\t\t */\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tfunction activateMenuItemsByValue(menu, value) {\n\t\t\t\tif (menu instanceof Menu) {\n\t\t\t\t\tmenu.items().each(function(ctrl) {\n\t\t\t\t\t\tif (!ctrl.hasMenus()) {\n\t\t\t\t\t\t\tctrl.active(ctrl.value() === value);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction getSelectedItem(menuValues, value) {\n\t\t\t\tvar selectedItem;\n\n\t\t\t\tif (!menuValues) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfor (var i = 0; i < menuValues.length; i++) {\n\t\t\t\t\tif (menuValues[i].value === value) {\n\t\t\t\t\t\treturn menuValues[i];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (menuValues[i].menu) {\n\t\t\t\t\t\tselectedItem = getSelectedItem(menuValues[i].menu, value);\n\t\t\t\t\t\tif (selectedItem) {\n\t\t\t\t\t\t\treturn selectedItem;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.on('show', function(e) {\n\t\t\t\tactivateMenuItemsByValue(e.control, self.value());\n\t\t\t});\n\n\t\t\tself.state.on('change:value', function(e) {\n\t\t\t\tvar selectedItem = getSelectedItem(self.state.get('menu'), e.value);\n\n\t\t\t\tif (selectedItem) {\n\t\t\t\t\tself.text(selectedItem.text);\n\t\t\t\t} else {\n\t\t\t\t\tself.text(self.settings.text);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Radio.js\n\n/**\n * Radio.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new radio button.\n *\n * @-x-less Radio.less\n * @class tinymce.ui.Radio\n * @extends tinymce.ui.Checkbox\n */\ndefine(\"tinymce/ui/Radio\", [\n\t\"tinymce/ui/Checkbox\"\n], function(Checkbox) {\n\t\"use strict\";\n\n\treturn Checkbox.extend({\n\t\tDefaults: {\n\t\t\tclasses: \"radio\",\n\t\t\trole: \"radio\"\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ResizeHandle.js\n\n/**\n * ResizeHandle.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Renders a resize handle that fires ResizeStart, Resize and ResizeEnd events.\n *\n * @-x-less ResizeHandle.less\n * @class tinymce.ui.ResizeHandle\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/ResizeHandle\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/DragHelper\"\n], function(Widget, DragHelper) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, prefix = self.classPrefix;\n\n\t\t\tself.classes.add('resizehandle');\n\n\t\t\tif (self.settings.direction == \"both\") {\n\t\t\t\tself.classes.add('resizehandle-both');\n\t\t\t}\n\n\t\t\tself.canFocus = false;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<i class=\"' + prefix + 'ico ' + prefix + 'i-resize\"></i>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself._super();\n\n\t\t\tself.resizeDragHelper = new DragHelper(this._id, {\n\t\t\t\tstart: function() {\n\t\t\t\t\tself.fire('ResizeStart');\n\t\t\t\t},\n\n\t\t\t\tdrag: function(e) {\n\t\t\t\t\tif (self.settings.direction != \"both\") {\n\t\t\t\t\t\te.deltaX = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tself.fire('Resize', e);\n\t\t\t\t},\n\n\t\t\t\tstop: function() {\n\t\t\t\t\tself.fire('ResizeEnd');\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tremove: function() {\n\t\t\tif (this.resizeDragHelper) {\n\t\t\t\tthis.resizeDragHelper.destroy();\n\t\t\t}\n\n\t\t\treturn this._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/SelectBox.js\n\n/**\n * SelectBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new select box control.\n *\n * @-x-less SelectBox.less\n * @class tinymce.ui.SelectBox\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/SelectBox\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\tfunction createOptions(options) {\n\t\tvar strOptions = '';\n\t\tif (options) {\n\t\t\tfor (var i = 0; i < options.length; i++) {\n\t\t\t\tstrOptions += '<option value=\"' + options[i] + '\">' + options[i] + '</option>';\n\t\t\t}\n\t\t}\n\t\treturn strOptions;\n\t}\n\n\treturn Widget.extend({\n\t\tDefaults: {\n\t\t\tclasses: \"selectbox\",\n\t\t\trole: \"selectbox\",\n\t\t\toptions: []\n\t\t},\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Array} options Array with options to add to the select box.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\n\t\t\tif (self.settings.size) {\n\t\t\t\tself.size = self.settings.size;\n\t\t\t}\n\n\t\t\tif (self.settings.options) {\n\t\t\t\tself._options = self.settings.options;\n\t\t\t}\n\n\t\t\tself.on('keydown', function(e) {\n\t\t\t\tvar rootControl;\n\n\t\t\t\tif (e.keyCode == 13) {\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t// Find root control that we can do toJSON on\n\t\t\t\t\tself.parents().reverse().each(function(ctrl) {\n\t\t\t\t\t\tif (ctrl.toJSON) {\n\t\t\t\t\t\t\trootControl = ctrl;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Fire event on current text box with the serialized data of the whole form\n\t\t\t\t\tself.fire('submit', {data: rootControl.toJSON()});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Getter/setter function for the options state.\n\t\t *\n\t\t * @method options\n\t\t * @param {Array} [state] State to be set.\n\t\t * @return {Array|tinymce.ui.SelectBox} Array of string options.\n\t\t */\n\t\toptions: function(state) {\n\t\t\tif (!arguments.length) {\n\t\t\t\treturn this.state.get('options');\n\t\t\t}\n\n\t\t\tthis.state.set('options', state);\n\n\t\t\treturn this;\n\t\t},\n\n\t\trenderHtml: function() {\n\t\t\tvar self = this, options, size = '';\n\n\t\t\toptions = createOptions(self._options);\n\n\t\t\tif (self.size) {\n\t\t\t\tsize = ' size = \"' + self.size + '\"';\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<select id=\"' + self._id + '\" class=\"' + self.classes + '\"' + size + '>' +\n\t\t\t\t\toptions +\n\t\t\t\t'</select>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:options', function(e) {\n\t\t\t\tself.getEl().innerHTML = createOptions(e.value);\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Slider.js\n\n/**\n * Slider.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Slider control.\n *\n * @-x-less Slider.less\n * @class tinymce.ui.Slider\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Slider\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/DragHelper\",\n\t\"tinymce/ui/DomUtils\"\n], function(Widget, DragHelper, DomUtils) {\n\t\"use strict\";\n\n\tfunction constrain(value, minVal, maxVal) {\n\t\tif (value < minVal) {\n\t\t\tvalue = minVal;\n\t\t}\n\n\t\tif (value > maxVal) {\n\t\t\tvalue = maxVal;\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tfunction setAriaProp(el, name, value) {\n\t\tel.setAttribute('aria-' + name, value);\n\t}\n\n\tfunction updateSliderHandle(ctrl, value) {\n\t\tvar maxHandlePos, shortSizeName, sizeName, stylePosName, styleValue, handleEl;\n\n\t\tif (ctrl.settings.orientation == \"v\") {\n\t\t\tstylePosName = \"top\";\n\t\t\tsizeName = \"height\";\n\t\t\tshortSizeName = \"h\";\n\t\t} else {\n\t\t\tstylePosName = \"left\";\n\t\t\tsizeName = \"width\";\n\t\t\tshortSizeName = \"w\";\n\t\t}\n\n\t\thandleEl = ctrl.getEl('handle');\n\t\tmaxHandlePos = (ctrl.layoutRect()[shortSizeName] || 100) - DomUtils.getSize(handleEl)[sizeName];\n\n\t\tstyleValue = (maxHandlePos * ((value - ctrl._minValue) / (ctrl._maxValue - ctrl._minValue))) + 'px';\n\t\thandleEl.style[stylePosName] = styleValue;\n\t\thandleEl.style.height = ctrl.layoutRect().h + 'px';\n\n\t\tsetAriaProp(handleEl, 'valuenow', value);\n\t\tsetAriaProp(handleEl, 'valuetext', '' + ctrl.settings.previewFilter(value));\n\t\tsetAriaProp(handleEl, 'valuemin', ctrl._minValue);\n\t\tsetAriaProp(handleEl, 'valuemax', ctrl._maxValue);\n\t}\n\n\treturn Widget.extend({\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tif (!settings.previewFilter) {\n\t\t\t\tsettings.previewFilter = function(value) {\n\t\t\t\t\treturn Math.round(value * 100) / 100.0;\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('slider');\n\n\t\t\tif (settings.orientation == \"v\") {\n\t\t\t\tself.classes.add('vertical');\n\t\t\t}\n\n\t\t\tself._minValue = settings.minValue || 0;\n\t\t\tself._maxValue = settings.maxValue || 100;\n\t\t\tself._initValue = self.state.get('value');\n\t\t},\n\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<div id=\"' + id + '-handle\" class=\"' + prefix + 'slider-handle\" role=\"slider\" tabindex=\"-1\"></div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\treset: function() {\n\t\t\tthis.value(this._initValue).repaint();\n\t\t},\n\n\t\tpostRender: function() {\n\t\t\tvar self = this, minValue, maxValue, screenCordName,\n\t\t\t\t\tstylePosName, sizeName, shortSizeName;\n\n\t\t\tfunction toFraction(min, max, val) {\n\t\t\t\treturn (val + min) / (max - min);\n\t\t\t}\n\n\t\t\tfunction fromFraction(min, max, val) {\n\t\t\t\treturn (val * (max - min)) - min;\n\t\t\t}\n\n\t\t\tfunction handleKeyboard(minValue, maxValue) {\n\t\t\t\tfunction alter(delta) {\n\t\t\t\t\tvar value;\n\n\t\t\t\t\tvalue = self.value();\n\t\t\t\t\tvalue = fromFraction(minValue, maxValue, toFraction(minValue, maxValue, value) + (delta * 0.05));\n\t\t\t\t\tvalue = constrain(value, minValue, maxValue);\n\n\t\t\t\t\tself.value(value);\n\n\t\t\t\t\tself.fire('dragstart', {value: value});\n\t\t\t\t\tself.fire('drag', {value: value});\n\t\t\t\t\tself.fire('dragend', {value: value});\n\t\t\t\t}\n\n\t\t\t\tself.on('keydown', function(e) {\n\t\t\t\t\tswitch (e.keyCode) {\n\t\t\t\t\t\tcase 37:\n\t\t\t\t\t\tcase 38:\n\t\t\t\t\t\t\talter(-1);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 39:\n\t\t\t\t\t\tcase 40:\n\t\t\t\t\t\t\talter(1);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction handleDrag(minValue, maxValue, handleEl) {\n\t\t\t\tvar startPos, startHandlePos, maxHandlePos, handlePos, value;\n\n\t\t\t\tself._dragHelper = new DragHelper(self._id, {\n\t\t\t\t\thandle: self._id + \"-handle\",\n\n\t\t\t\t\tstart: function(e) {\n\t\t\t\t\t\tstartPos = e[screenCordName];\n\t\t\t\t\t\tstartHandlePos = parseInt(self.getEl('handle').style[stylePosName], 10);\n\t\t\t\t\t\tmaxHandlePos = (self.layoutRect()[shortSizeName] || 100) - DomUtils.getSize(handleEl)[sizeName];\n\t\t\t\t\t\tself.fire('dragstart', {value: value});\n\t\t\t\t\t},\n\n\t\t\t\t\tdrag: function(e) {\n\t\t\t\t\t\tvar delta = e[screenCordName] - startPos;\n\n\t\t\t\t\t\thandlePos = constrain(startHandlePos + delta, 0, maxHandlePos);\n\t\t\t\t\t\thandleEl.style[stylePosName] = handlePos + 'px';\n\n\t\t\t\t\t\tvalue = minValue + (handlePos / maxHandlePos) * (maxValue - minValue);\n\t\t\t\t\t\tself.value(value);\n\n\t\t\t\t\t\tself.tooltip().text('' + self.settings.previewFilter(value)).show().moveRel(handleEl, 'bc tc');\n\n\t\t\t\t\t\tself.fire('drag', {value: value});\n\t\t\t\t\t},\n\n\t\t\t\t\tstop: function() {\n\t\t\t\t\t\tself.tooltip().hide();\n\t\t\t\t\t\tself.fire('dragend', {value: value});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tminValue = self._minValue;\n\t\t\tmaxValue = self._maxValue;\n\n\t\t\tif (self.settings.orientation == \"v\") {\n\t\t\t\tscreenCordName = \"screenY\";\n\t\t\t\tstylePosName = \"top\";\n\t\t\t\tsizeName = \"height\";\n\t\t\t\tshortSizeName = \"h\";\n\t\t\t} else {\n\t\t\t\tscreenCordName = \"screenX\";\n\t\t\t\tstylePosName = \"left\";\n\t\t\t\tsizeName = \"width\";\n\t\t\t\tshortSizeName = \"w\";\n\t\t\t}\n\n\t\t\tself._super();\n\n\t\t\thandleKeyboard(minValue, maxValue, self.getEl('handle'));\n\t\t\thandleDrag(minValue, maxValue, self.getEl('handle'));\n\t\t},\n\n\t\trepaint: function() {\n\t\t\tthis._super();\n\t\t\tupdateSliderHandle(this, this.value());\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:value', function(e) {\n\t\t\t\tupdateSliderHandle(self, e.value);\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Spacer.js\n\n/**\n * Spacer.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a spacer. This control is used in flex layouts for example.\n *\n * @-x-less Spacer.less\n * @class tinymce.ui.Spacer\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Spacer\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.classes.add('spacer');\n\t\t\tself.canFocus = false;\n\n\t\t\treturn '<div id=\"' + self._id + '\" class=\"' + self.classes + '\"></div>';\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/SplitButton.js\n\n/**\n * SplitButton.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a split button.\n *\n * @-x-less SplitButton.less\n * @class tinymce.ui.SplitButton\n * @extends tinymce.ui.Button\n */\ndefine(\"tinymce/ui/SplitButton\", [\n\t\"tinymce/ui/MenuButton\",\n\t\"tinymce/ui/DomUtils\",\n\t\"tinymce/dom/DomQuery\"\n], function(MenuButton, DomUtils, $) {\n\treturn MenuButton.extend({\n\t\tDefaults: {\n\t\t\tclasses: \"widget btn splitbtn\",\n\t\t\trole: \"button\"\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this, elm = self.getEl(), rect = self.layoutRect(), mainButtonElm, menuButtonElm;\n\n\t\t\tself._super();\n\n\t\t\tmainButtonElm = elm.firstChild;\n\t\t\tmenuButtonElm = elm.lastChild;\n\n\t\t\t$(mainButtonElm).css({\n\t\t\t\twidth: rect.w - DomUtils.getSize(menuButtonElm).width,\n\t\t\t\theight: rect.h - 2\n\t\t\t});\n\n\t\t\t$(menuButtonElm).css({\n\t\t\t\theight: rect.h - 2\n\t\t\t});\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Sets the active menu state.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tactiveMenu: function(state) {\n\t\t\tvar self = this;\n\n\t\t\t$(self.getEl().lastChild).toggleClass(self.classPrefix + 'active', state);\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix, image;\n\t\t\tvar icon = self.state.get('icon'), text = self.state.get('text'),\n\t\t\t\ttextHtml = '';\n\n\t\t\timage = self.settings.image;\n\t\t\tif (image) {\n\t\t\t\ticon = 'none';\n\n\t\t\t\t// Support for [high dpi, low dpi] image sources\n\t\t\t\tif (typeof image != \"string\") {\n\t\t\t\t\timage = window.getSelection ? image[0] : image[1];\n\t\t\t\t}\n\n\t\t\t\timage = ' style=\"background-image: url(\\'' + image + '\\')\"';\n\t\t\t} else {\n\t\t\t\timage = '';\n\t\t\t}\n\n\t\t\ticon = self.settings.icon ? prefix + 'ico ' + prefix + 'i-' + icon : '';\n\n\t\t\tif (text) {\n\t\t\t\tself.classes.add('btn-has-text');\n\t\t\t\ttextHtml = '<span class=\"' + prefix + 'txt\">' + self.encode(text) + '</span>';\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" role=\"button\" tabindex=\"-1\">' +\n\t\t\t\t\t'<button type=\"button\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t\t(icon ? '<i class=\"' + icon + '\"' + image + '></i>' : '') +\n\t\t\t\t\t\ttextHtml +\n\t\t\t\t\t'</button>' +\n\t\t\t\t\t'<button type=\"button\" class=\"' + prefix + 'open\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t\t//(icon ? '<i class=\"' + icon + '\"></i>' : '') +\n\t\t\t\t\t\t(self._menuBtnText ? (icon ? '\\u00a0' : '') + self._menuBtnText : '') +\n\t\t\t\t\t\t' <i class=\"' + prefix + 'caret\"></i>' +\n\t\t\t\t\t'</button>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, onClickHandler = self.settings.onclick;\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tvar node = e.target;\n\n\t\t\t\tif (e.control == this) {\n\t\t\t\t\t// Find clicks that is on the main button\n\t\t\t\t\twhile (node) {\n\t\t\t\t\t\tif ((e.aria && e.aria.key != 'down') || (node.nodeName == 'BUTTON' && node.className.indexOf('open') == -1)) {\n\t\t\t\t\t\t\te.stopImmediatePropagation();\n\n\t\t\t\t\t\t\tif (onClickHandler) {\n\t\t\t\t\t\t\t\tonClickHandler.call(this, e);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdelete self.settings.onclick;\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/StackLayout.js\n\n/**\n * StackLayout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This layout uses the browsers layout when the items are blocks.\n *\n * @-x-less StackLayout.less\n * @class tinymce.ui.StackLayout\n * @extends tinymce.ui.FlowLayout\n */\ndefine(\"tinymce/ui/StackLayout\", [\n\t\"tinymce/ui/FlowLayout\"\n], function(FlowLayout) {\n\t\"use strict\";\n\n\treturn FlowLayout.extend({\n\t\tDefaults: {\n\t\t\tcontainerClass: 'stack-layout',\n\t\t\tcontrolClass: 'stack-layout-item',\n\t\t\tendClass: 'break'\n\t\t},\n\n\t\tisNative: function() {\n\t\t\treturn true;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/TabPanel.js\n\n/**\n * TabPanel.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a tab panel control.\n *\n * @-x-less TabPanel.less\n * @class tinymce.ui.TabPanel\n * @extends tinymce.ui.Panel\n *\n * @setting {Number} activeTab Active tab index.\n */\ndefine(\"tinymce/ui/TabPanel\", [\n\t\"tinymce/ui/Panel\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/ui/DomUtils\"\n], function(Panel, $, DomUtils) {\n\t\"use strict\";\n\n\treturn Panel.extend({\n\t\tDefaults: {\n\t\t\tlayout: 'absolute',\n\t\t\tdefaults: {\n\t\t\t\ttype: 'panel'\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Activates the specified tab by index.\n\t\t *\n\t\t * @method activateTab\n\t\t * @param {Number} idx Index of the tab to activate.\n\t\t */\n\t\tactivateTab: function(idx) {\n\t\t\tvar activeTabElm;\n\n\t\t\tif (this.activeTabId) {\n\t\t\t\tactiveTabElm = this.getEl(this.activeTabId);\n\t\t\t\t$(activeTabElm).removeClass(this.classPrefix + 'active');\n\t\t\t\tactiveTabElm.setAttribute('aria-selected', \"false\");\n\t\t\t}\n\n\t\t\tthis.activeTabId = 't' + idx;\n\n\t\t\tactiveTabElm = this.getEl('t' + idx);\n\t\t\tactiveTabElm.setAttribute('aria-selected', \"true\");\n\t\t\t$(activeTabElm).addClass(this.classPrefix + 'active');\n\n\t\t\tthis.items()[idx].show().fire('showtab');\n\t\t\tthis.reflow();\n\n\t\t\tthis.items().each(function(item, i) {\n\t\t\t\tif (idx != i) {\n\t\t\t\t\titem.hide();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout, tabsHtml = '', prefix = self.classPrefix;\n\n\t\t\tself.preRender();\n\t\t\tlayout.preRender(self);\n\n\t\t\tself.items().each(function(ctrl, i) {\n\t\t\t\tvar id = self._id + '-t' + i;\n\n\t\t\t\tctrl.aria('role', 'tabpanel');\n\t\t\t\tctrl.aria('labelledby', id);\n\n\t\t\t\ttabsHtml += (\n\t\t\t\t\t'<div id=\"' + id + '\" class=\"' + prefix + 'tab\" ' +\n\t\t\t\t\t\t'unselectable=\"on\" role=\"tab\" aria-controls=\"' + ctrl._id + '\" aria-selected=\"false\" tabIndex=\"-1\">' +\n\t\t\t\t\t\tself.encode(ctrl.settings.title) +\n\t\t\t\t\t'</div>'\n\t\t\t\t);\n\t\t\t});\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t'<div id=\"' + self._id + '-head\" class=\"' + prefix + 'tabs\" role=\"tablist\">' +\n\t\t\t\t\t\ttabsHtml +\n\t\t\t\t\t'</div>' +\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\n\t\t\t\t\t\tlayout.renderHtml(self) +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself._super();\n\n\t\t\tself.settings.activeTab = self.settings.activeTab || 0;\n\t\t\tself.activateTab(self.settings.activeTab);\n\n\t\t\tthis.on('click', function(e) {\n\t\t\t\tvar targetParent = e.target.parentNode;\n\n\t\t\t\tif (targetParent && targetParent.id == self._id + '-head') {\n\t\t\t\t\tvar i = targetParent.childNodes.length;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (targetParent.childNodes[i] == e.target) {\n\t\t\t\t\t\t\tself.activateTab(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Initializes the current controls layout rect.\n\t\t * This will be executed by the layout managers to determine the\n\t\t * default minWidth/minHeight etc.\n\t\t *\n\t\t * @method initLayoutRect\n\t\t * @return {Object} Layout rect instance.\n\t\t */\n\t\tinitLayoutRect: function() {\n\t\t\tvar self = this, rect, minW, minH;\n\n\t\t\tminW = DomUtils.getSize(self.getEl('head')).width;\n\t\t\tminW = minW < 0 ? 0 : minW;\n\t\t\tminH = 0;\n\n\t\t\tself.items().each(function(item) {\n\t\t\t\tminW = Math.max(minW, item.layoutRect().minW);\n\t\t\t\tminH = Math.max(minH, item.layoutRect().minH);\n\t\t\t});\n\n\t\t\tself.items().each(function(ctrl) {\n\t\t\t\tctrl.settings.x = 0;\n\t\t\t\tctrl.settings.y = 0;\n\t\t\t\tctrl.settings.w = minW;\n\t\t\t\tctrl.settings.h = minH;\n\n\t\t\t\tctrl.layoutRect({\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tw: minW,\n\t\t\t\t\th: minH\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tvar headH = DomUtils.getSize(self.getEl('head')).height;\n\n\t\t\tself.settings.minWidth = minW;\n\t\t\tself.settings.minHeight = minH + headH;\n\n\t\t\trect = self._super();\n\t\t\trect.deltaH += headH;\n\t\t\trect.innerH = rect.h - rect.deltaH;\n\n\t\t\treturn rect;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/TextBox.js\n\n/**\n * TextBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new textbox.\n *\n * @-x-less TextBox.less\n * @class tinymce.ui.TextBox\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/TextBox\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/ui/DomUtils\"\n], function(Widget, Tools, DomUtils) {\n\treturn Widget.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Boolean} multiline True if the textbox is a multiline control.\n\t\t * @setting {Number} maxLength Max length for the textbox.\n\t\t * @setting {Number} size Size of the textbox in characters.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\n\t\t\tself.classes.add('textbox');\n\n\t\t\tif (settings.multiline) {\n\t\t\t\tself.classes.add('multiline');\n\t\t\t} else {\n\t\t\t\tself.on('keydown', function(e) {\n\t\t\t\t\tvar rootControl;\n\n\t\t\t\t\tif (e.keyCode == 13) {\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t// Find root control that we can do toJSON on\n\t\t\t\t\t\tself.parents().reverse().each(function(ctrl) {\n\t\t\t\t\t\t\tif (ctrl.toJSON) {\n\t\t\t\t\t\t\t\trootControl = ctrl;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Fire event on current text box with the serialized data of the whole form\n\t\t\t\t\t\tself.fire('submit', {data: rootControl.toJSON()});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.on('keyup', function(e) {\n\t\t\t\t\tself.state.set('value', e.target.value);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this, style, rect, borderBox, borderW, borderH = 0, lastRepaintRect;\n\n\t\t\tstyle = self.getEl().style;\n\t\t\trect = self._layoutRect;\n\t\t\tlastRepaintRect = self._lastRepaintRect || {};\n\n\t\t\t// Detect old IE 7+8 add lineHeight to align caret vertically in the middle\n\t\t\tvar doc = document;\n\t\t\tif (!self.settings.multiline && doc.all && (!doc.documentMode || doc.documentMode <= 8)) {\n\t\t\t\tstyle.lineHeight = (rect.h - borderH) + 'px';\n\t\t\t}\n\n\t\t\tborderBox = self.borderBox;\n\t\t\tborderW = borderBox.left + borderBox.right + 8;\n\t\t\tborderH = borderBox.top + borderBox.bottom + (self.settings.multiline ? 8 : 0);\n\n\t\t\tif (rect.x !== lastRepaintRect.x) {\n\t\t\t\tstyle.left = rect.x + 'px';\n\t\t\t\tlastRepaintRect.x = rect.x;\n\t\t\t}\n\n\t\t\tif (rect.y !== lastRepaintRect.y) {\n\t\t\t\tstyle.top = rect.y + 'px';\n\t\t\t\tlastRepaintRect.y = rect.y;\n\t\t\t}\n\n\t\t\tif (rect.w !== lastRepaintRect.w) {\n\t\t\t\tstyle.width = (rect.w - borderW) + 'px';\n\t\t\t\tlastRepaintRect.w = rect.w;\n\t\t\t}\n\n\t\t\tif (rect.h !== lastRepaintRect.h) {\n\t\t\t\tstyle.height = (rect.h - borderH) + 'px';\n\t\t\t\tlastRepaintRect.h = rect.h;\n\t\t\t}\n\n\t\t\tself._lastRepaintRect = lastRepaintRect;\n\t\t\tself.fire('repaint', {}, false);\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, settings = self.settings, attrs, elm;\n\n\t\t\tattrs = {\n\t\t\t\tid: self._id,\n\t\t\t\thidefocus: '1'\n\t\t\t};\n\n\t\t\tTools.each([\n\t\t\t\t'rows',\t'spellcheck',\t'maxLength', 'size', 'readonly', 'min',\n\t\t\t\t'max', 'step', 'list', 'pattern', 'placeholder', 'required', 'multiple'\n\t\t\t], function(name) {\n\t\t\t\tattrs[name] = settings[name];\n\t\t\t});\n\n\t\t\tif (self.disabled()) {\n\t\t\t\tattrs.disabled = 'disabled';\n\t\t\t}\n\n\t\t\tif (settings.subtype) {\n\t\t\t\tattrs.type = settings.subtype;\n\t\t\t}\n\n\t\t\telm = DomUtils.create(settings.multiline ? 'textarea' : 'input', attrs);\n\t\t\telm.value = self.state.get('value');\n\t\t\telm.className = self.classes;\n\n\t\t\treturn elm.outerHTML;\n\t\t},\n\n\t\tvalue: function(value) {\n\t\t\tif (arguments.length) {\n\t\t\t\tthis.state.set('value', value);\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\t// Make sure the real state is in sync\n\t\t\tif (this.state.get('rendered')) {\n\t\t\t\tthis.state.set('value', this.getEl().value);\n\t\t\t}\n\n\t\t\treturn this.state.get('value');\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.getEl().value = self.state.get('value');\n\t\t\tself._super();\n\n\t\t\tself.$el.on('change', function(e) {\n\t\t\t\tself.state.set('value', e.target.value);\n\t\t\t\tself.fire('change', e);\n\t\t\t});\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:value', function(e) {\n\t\t\t\tif (self.getEl().value != e.value) {\n\t\t\t\t\tself.getEl().value = e.value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.state.on('change:disabled', function(e) {\n\t\t\t\tself.getEl().disabled = e.value;\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\tremove: function() {\n\t\t\tthis.$el.off();\n\t\t\tthis._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/Register.js\n\n/**\n * Register.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This registers tinymce in common module loaders.\n *\n * @private\n * @class tinymce.Register\n */\ndefine(\"tinymce/Register\", [\n], function() {\n\t/*eslint consistent-this: 0 */\n\tvar context = this || window;\n\n\tvar tinymce = function() {\n\t\treturn context.tinymce;\n\t};\n\n\tif (typeof context.define === \"function\") {\n\t\t// Bolt\n\t\tif (!context.define.amd) {\n\t\t\tcontext.define(\"ephox/tinymce\", [], tinymce);\n\t\t}\n\t}\n\n\tif (typeof module === 'object') {\n\t\t/* global module */\n\t\tmodule.exports = window.tinymce;\n\t}\n\n\treturn {};\n});\n\nexpose([\"tinymce/geom/Rect\",\"tinymce/util/Promise\",\"tinymce/util/Delay\",\"tinymce/Env\",\"tinymce/dom/EventUtils\",\"tinymce/dom/Sizzle\",\"tinymce/util/Tools\",\"tinymce/dom/DomQuery\",\"tinymce/html/Styles\",\"tinymce/dom/TreeWalker\",\"tinymce/html/Entities\",\"tinymce/dom/DOMUtils\",\"tinymce/dom/ScriptLoader\",\"tinymce/AddOnManager\",\"tinymce/dom/RangeUtils\",\"tinymce/html/Node\",\"tinymce/html/Schema\",\"tinymce/html/SaxParser\",\"tinymce/html/DomParser\",\"tinymce/html/Writer\",\"tinymce/html/Serializer\",\"tinymce/dom/Serializer\",\"tinymce/util/VK\",\"tinymce/dom/ControlSelection\",\"tinymce/dom/BookmarkManager\",\"tinymce/dom/Selection\",\"tinymce/Formatter\",\"tinymce/UndoManager\",\"tinymce/EditorCommands\",\"tinymce/util/URI\",\"tinymce/util/Class\",\"tinymce/util/EventDispatcher\",\"tinymce/util/Observable\",\"tinymce/ui/Selector\",\"tinymce/ui/Collection\",\"tinymce/ui/ReflowQueue\",\"tinymce/ui/Control\",\"tinymce/ui/Factory\",\"tinymce/ui/KeyboardNavigation\",\"tinymce/ui/Container\",\"tinymce/ui/DragHelper\",\"tinymce/ui/Scrollable\",\"tinymce/ui/Panel\",\"tinymce/ui/Movable\",\"tinymce/ui/Resizable\",\"tinymce/ui/FloatPanel\",\"tinymce/ui/Window\",\"tinymce/ui/MessageBox\",\"tinymce/WindowManager\",\"tinymce/ui/Tooltip\",\"tinymce/ui/Widget\",\"tinymce/ui/Progress\",\"tinymce/ui/Notification\",\"tinymce/NotificationManager\",\"tinymce/EditorObservable\",\"tinymce/Shortcuts\",\"tinymce/Editor\",\"tinymce/util/I18n\",\"tinymce/FocusManager\",\"tinymce/EditorManager\",\"tinymce/util/XHR\",\"tinymce/util/JSON\",\"tinymce/util/JSONRequest\",\"tinymce/util/JSONP\",\"tinymce/util/LocalStorage\",\"tinymce/Compat\",\"tinymce/ui/Layout\",\"tinymce/ui/AbsoluteLayout\",\"tinymce/ui/Button\",\"tinymce/ui/ButtonGroup\",\"tinymce/ui/Checkbox\",\"tinymce/ui/ComboBox\",\"tinymce/ui/ColorBox\",\"tinymce/ui/PanelButton\",\"tinymce/ui/ColorButton\",\"tinymce/util/Color\",\"tinymce/ui/ColorPicker\",\"tinymce/ui/Path\",\"tinymce/ui/ElementPath\",\"tinymce/ui/FormItem\",\"tinymce/ui/Form\",\"tinymce/ui/FieldSet\",\"tinymce/ui/FilePicker\",\"tinymce/ui/FitLayout\",\"tinymce/ui/FlexLayout\",\"tinymce/ui/FlowLayout\",\"tinymce/ui/FormatControls\",\"tinymce/ui/GridLayout\",\"tinymce/ui/Iframe\",\"tinymce/ui/InfoBox\",\"tinymce/ui/Label\",\"tinymce/ui/Toolbar\",\"tinymce/ui/MenuBar\",\"tinymce/ui/MenuButton\",\"tinymce/ui/MenuItem\",\"tinymce/ui/Throbber\",\"tinymce/ui/Menu\",\"tinymce/ui/ListBox\",\"tinymce/ui/Radio\",\"tinymce/ui/ResizeHandle\",\"tinymce/ui/SelectBox\",\"tinymce/ui/Slider\",\"tinymce/ui/Spacer\",\"tinymce/ui/SplitButton\",\"tinymce/ui/StackLayout\",\"tinymce/ui/TabPanel\",\"tinymce/ui/TextBox\"]);\n})(window);"

/***/ })

},[1003]);
//# sourceMappingURL=scripts.bundle.js.map